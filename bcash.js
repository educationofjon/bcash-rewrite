!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).bcash=f()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";var bcash=exports;bcash.set=function(network){return bcash.Network.set(network),bcash},bcash.blockchain=require("./blockchain"),bcash.Chain=require("./blockchain/chain"),bcash.ChainEntry=require("./blockchain/chainentry"),bcash.btc=require("./btc"),bcash.Amount=require("./btc/amount"),bcash.URI=require("./btc/uri"),bcash.coins=require("./coins"),bcash.Coins=require("./coins/coins"),bcash.CoinEntry=require("./coins/coinentry"),bcash.CoinView=require("./coins/coinview"),bcash.hd=require("./hd"),bcash.HDPrivateKey=require("./hd/private"),bcash.HDPublicKey=require("./hd/public"),bcash.Mnemonic=require("./hd/mnemonic"),bcash.mempool=require("./mempool"),bcash.Fees=require("./mempool/fees"),bcash.Mempool=require("./mempool/mempool"),bcash.MempoolEntry=require("./mempool/mempoolentry"),bcash.mining=require("./mining"),bcash.Miner=require("./mining/miner"),bcash.net=require("./net"),bcash.packets=require("./net/packets"),bcash.Peer=require("./net/peer"),bcash.Pool=require("./net/pool"),bcash.node=require("./node"),bcash.Node=require("./node/node"),bcash.FullNode=require("./node/fullnode"),bcash.SPVNode=require("./node/spvnode"),bcash.primitives=require("./primitives"),bcash.Address=require("./primitives/address"),bcash.Block=require("./primitives/block"),bcash.Coin=require("./primitives/coin"),bcash.Headers=require("./primitives/headers"),bcash.Input=require("./primitives/input"),bcash.InvItem=require("./primitives/invitem"),bcash.KeyRing=require("./primitives/keyring"),bcash.MerkleBlock=require("./primitives/merkleblock"),bcash.MTX=require("./primitives/mtx"),bcash.Outpoint=require("./primitives/outpoint"),bcash.Output=require("./primitives/output"),bcash.TX=require("./primitives/tx"),bcash.protocol=require("./protocol"),bcash.consensus=require("./protocol/consensus"),bcash.Network=require("./protocol/network"),bcash.networks=require("./protocol/networks"),bcash.policy=require("./protocol/policy"),bcash.script=require("./script"),bcash.Opcode=require("./script/opcode"),bcash.Program=require("./script/program"),bcash.Script=require("./script/script"),bcash.ScriptNum=require("./script/scriptnum"),bcash.SigCache=require("./script/sigcache"),bcash.Stack=require("./script/stack"),bcash.utils=require("./utils"),bcash.util=require("./utils/util"),bcash.wallet=require("./wallet"),bcash.WalletDB=require("./wallet/walletdb"),bcash.workers=require("./workers"),bcash.WorkerPool=require("./workers/workerpool"),bcash.pkg=require("./pkg")},{"./blockchain":6,"./blockchain/chain":2,"./blockchain/chainentry":4,"./btc":9,"./btc/amount":8,"./btc/uri":10,"./coins":15,"./coins/coinentry":11,"./coins/coins":12,"./coins/coinview":13,"./hd":19,"./hd/mnemonic":20,"./hd/private":22,"./hd/public":23,"./mempool":36,"./mempool/fees":35,"./mempool/mempool":38,"./mempool/mempoolentry":39,"./mining":42,"./mining/miner":44,"./net":52,"./net/packets":54,"./net/peer":56,"./net/pool":57,"./node":63,"./node/fullnode":61,"./node/node":64,"./node/spvnode":66,"./pkg":67,"./primitives":73,"./primitives/address":69,"./primitives/block":70,"./primitives/coin":71,"./primitives/headers":72,"./primitives/input":74,"./primitives/invitem":75,"./primitives/keyring":76,"./primitives/merkleblock":78,"./primitives/mtx":79,"./primitives/outpoint":80,"./primitives/output":81,"./primitives/tx":82,"./protocol":86,"./protocol/consensus":84,"./protocol/network":87,"./protocol/networks":88,"./protocol/policy":89,"./script":92,"./script/opcode":93,"./script/program":94,"./script/script":95,"./script/scriptnum":97,"./script/sigcache":98,"./script/stack":99,"./utils":103,"./utils/util":106,"./wallet":111,"./wallet/walletdb":123,"./workers":127,"./workers/workerpool":131}],2:[function(require,module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),path=require("path"),AsyncEmitter=require("bevent"),Logger=require("blgr"),Lock=require("bmutex").Lock,Network=require("../protocol/network"),ChainDB=require("./chaindb"),common=require("./common"),consensus=require("../protocol/consensus"),util=require("../utils/util"),LRU=require("../utils/lru"),ChainEntry=require("./chainentry"),CoinView=require("../coins/coinview"),Script=require("../script/script"),VerifyError=require("../protocol/errors").VerifyError,thresholdStates=common.thresholdStates,Chain=function(_AsyncEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Chain,_AsyncEmitter);function Chain(options){_classCallCheck(this,Chain);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_AsyncEmitter.call(this));return _this.opened=!1,_this.options=new ChainOptions(options),_this.network=_this.options.network,_this.logger=_this.options.logger.context("chain"),_this.workers=_this.options.workers,_this.db=new ChainDB(_this.options),_this.locker=new Lock(!0),_this.invalid=new LRU(100),_this.state=new DeploymentState,_this.tip=new ChainEntry,_this.height=-1,_this.synced=!1,_this.orphanMap=new Map,_this.orphanPrev=new Map,_this}return Chain.prototype.open=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var tip,state;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return assert(!this.opened,"Chain is already open."),this.opened=!0,this.logger.info("Chain is loading."),this.options.checkpoints&&this.logger.info("Checkpoints are enabled."),this.options.coinCache&&this.logger.info("Coin cache is enabled."),_context.next=7,this.db.open();case 7:return _context.next=9,this.db.getTip();case 9:return tip=_context.sent,assert(tip),this.tip=tip,this.height=tip.height,this.logger.info("Chain Height: %d",tip.height),this.logger.memory(),_context.next=17,this.getDeploymentState();case 17:state=_context.sent,this.setDeploymentState(state),this.logger.memory(),this.emit("tip",tip),this.maybeSync();case 22:case"end":return _context.stop()}},_callee,this)}));return function(){return _ref.apply(this,arguments)}}(),Chain.prototype.close=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return assert(this.opened,"Chain is not open."),this.opened=!1,_context2.abrupt("return",this.db.close());case 3:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref2.apply(this,arguments)}}(),Chain.prototype.verifyContext=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(block,prev,flags){var state,_view,_view2,view;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,this.verify(block,prev,flags);case 2:if(state=_context3.sent,!this.options.spv){_context3.next=6;break}return _view=new CoinView,_context3.abrupt("return",[_view,state]);case 6:if(!this.isHistorical(prev)){_context3.next=11;break}return _context3.next=9,this.updateInputs(block,prev);case 9:return _view2=_context3.sent,_context3.abrupt("return",[_view2,state]);case 11:if(state.hasBIP34()){_context3.next=14;break}return _context3.next=14,this.verifyDuplicates(block,prev);case 14:return _context3.next=16,this.verifyInputs(block,prev,state);case 16:return view=_context3.sent,_context3.abrupt("return",[view,state]);case 18:case"end":return _context3.stop()}},_callee3,this)}));return function(_x,_x2,_x3){return _ref3.apply(this,arguments)}}(),Chain.prototype.verifyBlock=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(block){var unlock;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,this.locker.lock();case 2:return unlock=_context4.sent,_context4.prev=3,_context4.next=6,this._verifyBlock(block);case 6:return _context4.abrupt("return",_context4.sent);case 7:return _context4.prev=7,unlock(),_context4.finish(7);case 10:case"end":return _context4.stop()}},_callee4,this,[[3,,7,10]])}));return function(_x4){return _ref4.apply(this,arguments)}}(),Chain.prototype._verifyBlock=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(block){var flags;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return flags=common.flags.DEFAULT_FLAGS&~common.flags.VERIFY_POW,_context5.abrupt("return",this.verifyContext(block,this.tip,flags));case 2:case"end":return _context5.stop()}},_callee5,this)}));return function(_x5){return _ref5.apply(this,arguments)}}(),Chain.prototype.isMainHash=function(hash){return this.db.isMainHash(hash)},Chain.prototype.isMainChain=function(entry){return this.db.isMainChain(entry)},Chain.prototype.getAncestor=function(entry,height){return this.db.getAncestor(entry,height)},Chain.prototype.getPrevious=function(entry){return this.db.getPrevious(entry)},Chain.prototype.getPrevCache=function(entry){return this.db.getPrevCache(entry)},Chain.prototype.getNext=function(entry){return this.db.getNext(entry)},Chain.prototype.getNextEntry=function(entry){return this.db.getNextEntry(entry)},Chain.prototype.getMedianTime=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(prev,time){var timespan,median,entry,i,cache;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:timespan=consensus.MEDIAN_TIMESPAN,median=[],null!=time&&(median.push(time),timespan-=1),entry=prev,i=0;case 5:if(!(i<timespan&&entry)){_context6.next=18;break}if(median.push(entry.time),!(cache=this.getPrevCache(entry))){_context6.next=12;break}entry=cache,_context6.next=15;break;case 12:return _context6.next=14,this.getPrevious(entry);case 14:entry=_context6.sent;case 15:i++,_context6.next=5;break;case 18:return median.sort(cmp),_context6.abrupt("return",median[median.length>>>1]);case 20:case"end":return _context6.stop()}},_callee6,this)}));return function(_x6,_x7){return _ref6.apply(this,arguments)}}(),Chain.prototype.isHistorical=function(prev){return!!(this.options.checkpoints&&prev.height+1<=this.network.lastCheckpoint)},Chain.prototype.verify=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(block,prev,flags){var hash,_block$checkBody,valid,reason,score,bits,mtp,height,state,time,_iterator,_isArray,_i,_ref8,commit;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(assert("number"==typeof flags),block.prevBlock===prev.hash){_context7.next=3;break}throw new VerifyError(block,"invalid","bad-prevblk",0);case 3:if(hash=block.hash("hex"),this.verifyCheckpoint(prev,hash)){_context7.next=6;break}throw new VerifyError(block,"checkpoint","checkpoint mismatch",100);case 6:if(!this.isHistorical(prev)){_context7.next=12;break}if(!this.options.spv){_context7.next=9;break}return _context7.abrupt("return",this.state);case 9:if(block.hasWitness()||block.getCommitmentHash()){_context7.next=11;break}return _context7.abrupt("return",new DeploymentState);case 11:flags&=~common.flags.VERIFY_BODY;case 12:if(!(flags&common.flags.VERIFY_BODY)){_context7.next=16;break}if(_block$checkBody=block.checkBody(),valid=_block$checkBody[0],reason=_block$checkBody[1],score=_block$checkBody[2],valid){_context7.next=16;break}throw new VerifyError(block,"invalid",reason,score,!0);case 16:return _context7.next=18,this.getTarget(block.time,prev);case 18:if(bits=_context7.sent,block.bits===bits){_context7.next=21;break}throw new VerifyError(block,"invalid","bad-diffbits",100);case 21:if(!this.options.spv){_context7.next=23;break}return _context7.abrupt("return",this.state);case 23:return _context7.next=25,this.getMedianTime(prev);case 25:if(mtp=_context7.sent,!(block.time<=mtp)){_context7.next=28;break}throw new VerifyError(block,"invalid","time-too-old",0);case 28:if(!(block.time>this.network.now()+7200)){_context7.next=30;break}throw new VerifyError(block,"invalid","time-too-new",0,!0);case 30:if(height=prev.height+1,!(block.version<2&&height>=this.network.block.bip34height)){_context7.next=33;break}throw new VerifyError(block,"obsolete","bad-version",0);case 33:if(!(block.version<3&&height>=this.network.block.bip66height)){_context7.next=35;break}throw new VerifyError(block,"obsolete","bad-version",0);case 35:if(!(block.version<4&&height>=this.network.block.bip65height)){_context7.next=37;break}throw new VerifyError(block,"obsolete","bad-version",0);case 37:return _context7.next=39,this.getDeployments(block.time,prev);case 39:state=_context7.sent,time=state.hasMTP()?mtp:block.time,_iterator=block.txs,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();case 42:if(!_isArray){_context7.next=48;break}if(!(_i>=_iterator.length)){_context7.next=45;break}return _context7.abrupt("break",57);case 45:_ref8=_iterator[_i++],_context7.next=52;break;case 48:if(!(_i=_iterator.next()).done){_context7.next=51;break}return _context7.abrupt("break",57);case 51:_ref8=_i.value;case 52:if(_ref8.isFinal(height,time)){_context7.next=55;break}throw new VerifyError(block,"invalid","bad-txns-nonfinal",10);case 55:_context7.next=42;break;case 57:if(!state.hasBIP34()){_context7.next=60;break}if(block.getCoinbaseHeight()===height){_context7.next=60;break}throw new VerifyError(block,"invalid","bad-cb-height",100);case 60:if(commit=null,!state.hasWitness()){_context7.next=68;break}if(!(commit=block.getCommitmentHash())){_context7.next=68;break}if(block.getWitnessNonce()){_context7.next=66;break}throw new VerifyError(block,"invalid","bad-witness-nonce-size",100,!0);case 66:if(commit.equals(block.createCommitmentHash())){_context7.next=68;break}throw new VerifyError(block,"invalid","bad-witness-merkle-match",100,!0);case 68:if(commit){_context7.next=71;break}if(!block.hasWitness()){_context7.next=71;break}throw new VerifyError(block,"invalid","unexpected-witness",100,!0);case 71:if(!(block.getWeight()>consensus.MAX_BLOCK_WEIGHT)){_context7.next=73;break}throw new VerifyError(block,"invalid","bad-blk-weight",100);case 73:return _context7.abrupt("return",state);case 74:case"end":return _context7.stop()}},_callee7,this)}));return function(_x8,_x9,_x10){return _ref7.apply(this,arguments)}}(),Chain.prototype.getDeployments=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(time,prev){var deployments,height,state;return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return deployments=this.network.deployments,height=prev.height+1,state=new DeploymentState,time>=consensus.BIP16_TIME&&(state.flags|=Script.flags.VERIFY_P2SH),height>=this.network.block.UAHFHeight&&(state.flags|=Script.flags.VERIFY_STRICTENC,state.flags|=Script.flags.VERIFY_SIGHASH_FORKID),height>=this.network.block.daaHeight&&(state.flags|=Script.flags.VERIFY_LOW_S,state.flags|=Script.flags.VERIFY_NULLFAIL),height>=this.network.block.bip34height&&(state.bip34=!0),height>=this.network.block.bip66height&&(state.flags|=Script.flags.VERIFY_DERSIG),height>=this.network.block.bip65height&&(state.flags|=Script.flags.VERIFY_CHECKLOCKTIMEVERIFY),_context8.next=11,this.isActive(prev,deployments.csv);case 11:if(!_context8.sent){_context8.next=15;break}state.flags|=Script.flags.VERIFY_CHECKSEQUENCEVERIFY,state.lockFlags|=common.lockFlags.VERIFY_SEQUENCE,state.lockFlags|=common.lockFlags.MEDIAN_TIME_PAST;case 15:return _context8.abrupt("return",state);case 16:case"end":return _context8.stop()}},_callee8,this)}));return function(_x11,_x12){return _ref9.apply(this,arguments)}}(),Chain.prototype.setDeploymentState=function(state){this.options.checkpoints&&this.height<this.network.lastCheckpoint?this.state=state:(!this.state.hasP2SH()&&state.hasP2SH()&&this.logger.warning("P2SH has been activated."),!this.state.hasBIP34()&&state.hasBIP34()&&this.logger.warning("BIP34 has been activated."),!this.state.hasBIP66()&&state.hasBIP66()&&this.logger.warning("BIP66 has been activated."),!this.state.hasCLTV()&&state.hasCLTV()&&this.logger.warning("BIP65 has been activated."),!this.state.hasCSV()&&state.hasCSV()&&this.logger.warning("CSV has been activated."),!this.state.hasUAHF()&&state.hasUAHF()&&this.logger.warning("UAHF has been activated."),!this.state.isDAAEnabled()&&state.isDAAEnabled()&&this.logger.warning("Difficulty Adjustment Algorithm activated."),this.state=state)},Chain.prototype.verifyDuplicates=function(){var _ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(block,prev){var _iterator2,_isArray2,_i2,_ref11,tx,height,hash;return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:_iterator2=block.txs,_isArray2=Array.isArray(_iterator2),_i2=0,_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();case 1:if(!_isArray2){_context9.next=7;break}if(!(_i2>=_iterator2.length)){_context9.next=4;break}return _context9.abrupt("break",22);case 4:_ref11=_iterator2[_i2++],_context9.next=11;break;case 7:if(!(_i2=_iterator2.next()).done){_context9.next=10;break}return _context9.abrupt("break",22);case 10:_ref11=_i2.value;case 11:return tx=_ref11,_context9.next=14,this.hasCoins(tx);case 14:if(_context9.sent){_context9.next=16;break}return _context9.abrupt("continue",20);case 16:if(height=prev.height+1,(hash=this.network.bip30[height])&&block.hash("hex")===hash){_context9.next=20;break}throw new VerifyError(block,"invalid","bad-txns-BIP30",100);case 20:_context9.next=1;break;case 22:case"end":return _context9.stop()}},_callee9,this)}));return function(_x13,_x14){return _ref10.apply(this,arguments)}}(),Chain.prototype.updateInputs=function(){var _ref12=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(block,prev){var view,height,cb,i,tx;return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:view=new CoinView,height=prev.height+1,cb=block.txs[0],view.addTX(cb,height),i=1;case 5:if(!(i<block.txs.length)){_context10.next=16;break}return tx=block.txs[i],_context10.t0=assert,_context10.next=10,view.spendInputs(this.db,tx);case 10:_context10.t1=_context10.sent,(0,_context10.t0)(_context10.t1,"BUG: Spent inputs in historical data!"),view.addTX(tx,height);case 13:i++,_context10.next=5;break;case 16:return _context10.abrupt("return",view);case 17:case"end":return _context10.stop()}},_callee10,this)}));return function(_x15,_x16){return _ref12.apply(this,arguments)}}(),Chain.prototype.verifyInputs=function(){var _ref13=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(block,prev,state){var view,height,interval,sigops,reward,i,tx,_tx$checkInputs,fee,reason,score,jobs,_i3,_tx,results,_iterator3,_isArray3,_i4,_ref14;return regeneratorRuntime.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:view=new CoinView,height=prev.height+1,interval=this.network.halvingInterval,sigops=0,reward=0,i=0;case 6:if(!(i<block.txs.length)){_context11.next=33;break}if(tx=block.txs[i],!(i>0)){_context11.next=13;break}return _context11.next=11,view.spendInputs(this.db,tx);case 11:if(_context11.sent){_context11.next=13;break}throw new VerifyError(block,"invalid","bad-txns-inputs-missingorspent",100);case 13:if(!(i>0&&tx.version>=2)){_context11.next=19;break}return _context11.next=16,this.verifyLocks(prev,tx,view,state.lockFlags);case 16:if(_context11.sent){_context11.next=19;break}throw new VerifyError(block,"invalid","bad-txns-nonfinal",100);case 19:if(!((sigops+=tx.getSigopsCount(view,state.flags))>consensus.MAX_BLOCK_SIGOPS)){_context11.next=22;break}throw new VerifyError(block,"invalid","bad-blk-sigops",100);case 22:if(!(i>0)){_context11.next=29;break}if(_tx$checkInputs=tx.checkInputs(view,height),fee=_tx$checkInputs[0],reason=_tx$checkInputs[1],score=_tx$checkInputs[2],-1!==fee){_context11.next=26;break}throw new VerifyError(block,"invalid",reason,score);case 26:if(!((reward+=fee)>consensus.MAX_MONEY)){_context11.next=29;break}throw new VerifyError(block,"invalid","bad-cb-amount",100);case 29:view.addTX(tx,height);case 30:i++,_context11.next=6;break;case 33:if(reward+=consensus.getReward(height,interval),!(block.getClaimed()>reward)){_context11.next=36;break}throw new VerifyError(block,"invalid","bad-cb-amount",100);case 36:for(jobs=[],_i3=1;_i3<block.txs.length;_i3++)_tx=block.txs[_i3],jobs.push(_tx.verifyAsync(view,state.flags,this.workers));return _context11.next=40,Promise.all(jobs);case 40:results=_context11.sent,_iterator3=results,_isArray3=Array.isArray(_iterator3),_i4=0,_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();case 42:if(!_isArray3){_context11.next=48;break}if(!(_i4>=_iterator3.length)){_context11.next=45;break}return _context11.abrupt("break",57);case 45:_ref14=_iterator3[_i4++],_context11.next=52;break;case 48:if(!(_i4=_iterator3.next()).done){_context11.next=51;break}return _context11.abrupt("break",57);case 51:_ref14=_i4.value;case 52:if(_ref14){_context11.next=55;break}throw new VerifyError(block,"invalid","mandatory-script-verify-flag-failed",100);case 55:_context11.next=42;break;case 57:return _context11.abrupt("return",view);case 58:case"end":return _context11.stop()}},_callee11,this)}));return function(_x17,_x18,_x19){return _ref13.apply(this,arguments)}}(),Chain.prototype.findFork=function(){var _ref15=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(fork,longer){return regeneratorRuntime.wrap(function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:if(fork.hash===longer.hash){_context12.next=18;break}case 1:if(!(longer.height>fork.height)){_context12.next=9;break}return _context12.next=4,this.getPrevious(longer);case 4:if(longer=_context12.sent){_context12.next=7;break}throw new Error("No previous entry for new tip.");case 7:_context12.next=1;break;case 9:if(fork.hash!==longer.hash){_context12.next=11;break}return _context12.abrupt("return",fork);case 11:return _context12.next=13,this.getPrevious(fork);case 13:if(fork=_context12.sent){_context12.next=16;break}throw new Error("No previous entry for old tip.");case 16:_context12.next=0;break;case 18:return _context12.abrupt("return",fork);case 19:case"end":return _context12.stop()}},_callee12,this)}));return function(_x20,_x21){return _ref15.apply(this,arguments)}}(),Chain.prototype.reorganize=function(){var _ref16=_asyncToGenerator(regeneratorRuntime.mark(function _callee13(competitor){var tip,fork,disconnect,entry,connect,i,_entry,_i5,_entry2;return regeneratorRuntime.wrap(function(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:return tip=this.tip,_context13.next=3,this.findFork(tip,competitor);case 3:fork=_context13.sent,assert(fork,"No free space or data corruption."),disconnect=[],entry=tip;case 7:if(entry.hash===fork.hash){_context13.next=15;break}return disconnect.push(entry),_context13.next=11,this.getPrevious(entry);case 11:entry=_context13.sent,assert(entry),_context13.next=7;break;case 15:connect=[],entry=competitor;case 17:if(entry.hash===fork.hash){_context13.next=25;break}return connect.push(entry),_context13.next=21,this.getPrevious(entry);case 21:entry=_context13.sent,assert(entry),_context13.next=17;break;case 25:i=0;case 26:if(!(i<disconnect.length)){_context13.next=33;break}return _entry=disconnect[i],_context13.next=30,this.disconnect(_entry);case 30:i++,_context13.next=26;break;case 33:_i5=connect.length-1;case 34:if(!(_i5>=1)){_context13.next=41;break}return _entry2=connect[_i5],_context13.next=38,this.reconnect(_entry2);case 38:_i5--,_context13.next=34;break;case 41:return this.logger.warning("Chain reorganization: old=%s(%d) new=%s(%d)",tip.rhash(),tip.height,competitor.rhash(),competitor.height),_context13.next=44,this.emitAsync("reorganize",tip,competitor);case 44:case"end":return _context13.stop()}},_callee13,this)}));return function(_x22){return _ref16.apply(this,arguments)}}(),Chain.prototype.reorganizeSPV=function(){var _ref17=_asyncToGenerator(regeneratorRuntime.mark(function _callee14(competitor){var tip,fork,disconnect,entry,_iterator4,_isArray4,_i6,_ref18,_entry3,headers,view;return regeneratorRuntime.wrap(function(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:return tip=this.tip,_context14.next=3,this.findFork(tip,competitor);case 3:fork=_context14.sent,assert(fork,"No free space or data corruption."),disconnect=[],entry=tip;case 7:if(entry.hash===fork.hash){_context14.next=15;break}return disconnect.push(entry),_context14.next=11,this.getPrevious(entry);case 11:entry=_context14.sent,assert(entry),_context14.next=7;break;case 15:return _context14.next=17,this._reset(fork.hash,!0);case 17:_iterator4=disconnect,_isArray4=Array.isArray(_iterator4),_i6=0,_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();case 18:if(!_isArray4){_context14.next=24;break}if(!(_i6>=_iterator4.length)){_context14.next=21;break}return _context14.abrupt("break",35);case 21:_ref18=_iterator4[_i6++],_context14.next=28;break;case 24:if(!(_i6=_iterator4.next()).done){_context14.next=27;break}return _context14.abrupt("break",35);case 27:_ref18=_i6.value;case 28:return headers=(_entry3=_ref18).toHeaders(),view=new CoinView,_context14.next=33,this.emitAsync("disconnect",_entry3,headers,view);case 33:_context14.next=18;break;case 35:return this.logger.warning("SPV reorganization: old=%s(%d) new=%s(%d)",tip.rhash(),tip.height,competitor.rhash(),competitor.height),this.logger.warning("Chain replay from height %d necessary.",fork.height),_context14.abrupt("return",this.emitAsync("reorganize",tip,competitor));case 38:case"end":return _context14.stop()}},_callee14,this)}));return function(_x23){return _ref17.apply(this,arguments)}}(),Chain.prototype.disconnect=function(){var _ref19=_asyncToGenerator(regeneratorRuntime.mark(function _callee15(entry){var block,prev,view;return regeneratorRuntime.wrap(function(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:return _context15.next=2,this.getBlock(entry.hash);case 2:if(block=_context15.sent){_context15.next=7;break}if(this.options.spv){_context15.next=6;break}throw new Error("Block not found.");case 6:block=entry.toHeaders();case 7:return _context15.next=9,this.getPrevious(entry);case 9:return prev=_context15.sent,_context15.next=12,this.db.disconnect(entry,block);case 12:return view=_context15.sent,assert(prev),this.tip=prev,this.height=prev.height,this.emit("tip",prev),_context15.abrupt("return",this.emitAsync("disconnect",entry,block,view));case 18:case"end":return _context15.stop()}},_callee15,this)}));return function(_x24){return _ref19.apply(this,arguments)}}(),Chain.prototype.reconnect=function(){var _ref20=_asyncToGenerator(regeneratorRuntime.mark(function _callee16(entry){var flags,block,prev,view,state,_ref21;return regeneratorRuntime.wrap(function(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:return flags=common.flags.VERIFY_NONE,_context16.next=3,this.getBlock(entry.hash);case 3:if(block=_context16.sent){_context16.next=8;break}if(this.options.spv){_context16.next=7;break}throw new Error("Block not found.");case 7:block=entry.toHeaders();case 8:return _context16.next=10,this.getPrevious(entry);case 10:return prev=_context16.sent,assert(prev),view=void 0,state=void 0,_context16.prev=13,_context16.next=16,this.verifyContext(block,prev,flags);case 16:_ref21=_context16.sent,view=_ref21[0],state=_ref21[1],_context16.next=25;break;case 21:throw _context16.prev=21,_context16.t0=_context16.catch(13),"VerifyError"===_context16.t0.type&&(_context16.t0.malleated||this.setInvalid(entry.hash),this.logger.warning("Tried to reconnect invalid block: %s (%d).",entry.rhash(),entry.height)),_context16.t0;case 25:return _context16.next=27,this.db.reconnect(entry,block,view);case 27:return this.tip=entry,this.height=entry.height,this.setDeploymentState(state),this.emit("tip",entry),this.emit("reconnect",entry,block),_context16.abrupt("return",this.emitAsync("connect",entry,block,view));case 33:case"end":return _context16.stop()}},_callee16,this,[[13,21]])}));return function(_x25){return _ref20.apply(this,arguments)}}(),Chain.prototype.setBestChain=function(){var _ref22=_asyncToGenerator(regeneratorRuntime.mark(function _callee17(entry,block,prev,flags){var view,state,_ref23;return regeneratorRuntime.wrap(function(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:if(entry.prevBlock===this.tip.hash){_context17.next=6;break}if(this.logger.warning("WARNING: Reorganizing chain."),!this.options.spv){_context17.next=4;break}return _context17.abrupt("return",this.reorganizeSPV(entry));case 4:return _context17.next=6,this.reorganize(entry);case 6:return entry.hasUnknown(this.network)&&this.logger.warning("Unknown version bits in block %d: %s.",entry.height,entry.version.toString(16)),view=void 0,state=void 0,_context17.prev=8,_context17.next=11,this.verifyContext(block,prev,flags);case 11:_ref23=_context17.sent,view=_ref23[0],state=_ref23[1],_context17.next=20;break;case 16:throw _context17.prev=16,_context17.t0=_context17.catch(8),"VerifyError"===_context17.t0.type&&(_context17.t0.malleated||this.setInvalid(entry.hash),this.logger.warning("Tried to connect invalid block: %s (%d).",entry.rhash(),entry.height)),_context17.t0;case 20:return _context17.next=22,this.db.save(entry,block,view);case 22:return this.tip=entry,this.height=entry.height,this.setDeploymentState(state),this.emit("tip",entry),this.emit("block",block,entry),_context17.abrupt("return",this.emitAsync("connect",entry,block,view));case 28:case"end":return _context17.stop()}},_callee17,this,[[8,16]])}));return function(_x26,_x27,_x28,_x29){return _ref22.apply(this,arguments)}}(),Chain.prototype.saveAlternate=function(){var _ref24=_asyncToGenerator(regeneratorRuntime.mark(function _callee18(entry,block,prev,flags){return regeneratorRuntime.wrap(function(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:return _context18.prev=0,_context18.next=3,this.verify(block,prev,flags);case 3:_context18.next=9;break;case 5:throw _context18.prev=5,_context18.t0=_context18.catch(0),"VerifyError"===_context18.t0.type&&(_context18.t0.malleated||this.setInvalid(entry.hash),this.logger.warning("Invalid block on alternate chain: %s (%d).",entry.rhash(),entry.height)),_context18.t0;case 9:return entry.hasUnknown(this.network)&&this.logger.warning("Unknown version bits in block %d: %s.",entry.height,entry.version.toString(16)),_context18.next=12,this.db.save(entry,block);case 12:this.logger.warning("Heads up: Competing chain at height %d: tip-height=%d competitor-height=%d tip-hash=%s competitor-hash=%s tip-chainwork=%s competitor-chainwork=%s chainwork-diff=%s",entry.height,this.tip.height,entry.height,this.tip.rhash(),entry.rhash(),this.tip.chainwork.toString(),entry.chainwork.toString(),this.tip.chainwork.sub(entry.chainwork).toString()),this.emit("competitor",block,entry);case 14:case"end":return _context18.stop()}},_callee18,this,[[0,5]])}));return function(_x30,_x31,_x32,_x33){return _ref24.apply(this,arguments)}}(),Chain.prototype.reset=function(){var _ref25=_asyncToGenerator(regeneratorRuntime.mark(function _callee19(block){var unlock;return regeneratorRuntime.wrap(function(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:return _context19.next=2,this.locker.lock();case 2:return unlock=_context19.sent,_context19.prev=3,_context19.next=6,this._reset(block,!1);case 6:return _context19.abrupt("return",_context19.sent);case 7:return _context19.prev=7,unlock(),_context19.finish(7);case 10:case"end":return _context19.stop()}},_callee19,this,[[3,,7,10]])}));return function(_x34){return _ref25.apply(this,arguments)}}(),Chain.prototype._reset=function(){var _ref26=_asyncToGenerator(regeneratorRuntime.mark(function _callee20(block,silent){var tip,state;return regeneratorRuntime.wrap(function(_context20){for(;;)switch(_context20.prev=_context20.next){case 0:return _context20.next=2,this.db.reset(block);case 2:return tip=_context20.sent,this.tip=tip,this.height=tip.height,this.synced=!1,_context20.next=8,this.getDeploymentState();case 8:if(state=_context20.sent,this.setDeploymentState(state),this.emit("tip",tip),silent){_context20.next=14;break}return _context20.next=14,this.emitAsync("reset",tip);case 14:this.purgeOrphans(),this.maybeSync();case 16:case"end":return _context20.stop()}},_callee20,this)}));return function(_x35,_x36){return _ref26.apply(this,arguments)}}(),Chain.prototype.replay=function(){var _ref27=_asyncToGenerator(regeneratorRuntime.mark(function _callee21(block){var unlock;return regeneratorRuntime.wrap(function(_context21){for(;;)switch(_context21.prev=_context21.next){case 0:return _context21.next=2,this.locker.lock();case 2:return unlock=_context21.sent,_context21.prev=3,_context21.next=6,this._replay(block,!0);case 6:return _context21.abrupt("return",_context21.sent);case 7:return _context21.prev=7,unlock(),_context21.finish(7);case 10:case"end":return _context21.stop()}},_callee21,this,[[3,,7,10]])}));return function(_x37){return _ref27.apply(this,arguments)}}(),Chain.prototype._replay=function(){var _ref28=_asyncToGenerator(regeneratorRuntime.mark(function _callee22(block,silent){var entry;return regeneratorRuntime.wrap(function(_context22){for(;;)switch(_context22.prev=_context22.next){case 0:return _context22.next=2,this.getEntry(block);case 2:if(entry=_context22.sent){_context22.next=5;break}throw new Error("Block not found.");case 5:return _context22.next=7,this.isMainChain(entry);case 7:if(_context22.sent){_context22.next=9;break}throw new Error("Cannot reset on alternate chain.");case 9:if(!entry.isGenesis()){_context22.next=13;break}return _context22.next=12,this._reset(entry.hash,silent);case 12:return _context22.abrupt("return");case 13:return _context22.next=15,this._reset(entry.prevBlock,silent);case 15:case"end":return _context22.stop()}},_callee22,this)}));return function(_x38,_x39){return _ref28.apply(this,arguments)}}(),Chain.prototype.invalidate=function(){var _ref29=_asyncToGenerator(regeneratorRuntime.mark(function _callee23(hash){var unlock;return regeneratorRuntime.wrap(function(_context23){for(;;)switch(_context23.prev=_context23.next){case 0:return _context23.next=2,this.locker.lock();case 2:return unlock=_context23.sent,_context23.prev=3,_context23.next=6,this._invalidate(hash);case 6:return _context23.abrupt("return",_context23.sent);case 7:return _context23.prev=7,unlock(),_context23.finish(7);case 10:case"end":return _context23.stop()}},_callee23,this,[[3,,7,10]])}));return function(_x40){return _ref29.apply(this,arguments)}}(),Chain.prototype._invalidate=function(){var _ref30=_asyncToGenerator(regeneratorRuntime.mark(function _callee24(hash){return regeneratorRuntime.wrap(function(_context24){for(;;)switch(_context24.prev=_context24.next){case 0:return _context24.next=2,this._replay(hash,!1);case 2:this.setInvalid(hash);case 3:case"end":return _context24.stop()}},_callee24,this)}));return function(_x41){return _ref30.apply(this,arguments)}}(),Chain.prototype.prune=function(){var _ref31=_asyncToGenerator(regeneratorRuntime.mark(function _callee25(){var unlock;return regeneratorRuntime.wrap(function(_context25){for(;;)switch(_context25.prev=_context25.next){case 0:return _context25.next=2,this.locker.lock();case 2:return unlock=_context25.sent,_context25.prev=3,_context25.next=6,this.db.prune();case 6:return _context25.abrupt("return",_context25.sent);case 7:return _context25.prev=7,unlock(),_context25.finish(7);case 10:case"end":return _context25.stop()}},_callee25,this,[[3,,7,10]])}));return function(){return _ref31.apply(this,arguments)}}(),Chain.prototype.scan=function(){var _ref32=_asyncToGenerator(regeneratorRuntime.mark(function _callee26(start,filter,iter){var unlock;return regeneratorRuntime.wrap(function(_context26){for(;;)switch(_context26.prev=_context26.next){case 0:return _context26.next=2,this.locker.lock();case 2:return unlock=_context26.sent,_context26.prev=3,_context26.next=6,this.db.scan(start,filter,iter);case 6:return _context26.abrupt("return",_context26.sent);case 7:return _context26.prev=7,unlock(),_context26.finish(7);case 10:case"end":return _context26.stop()}},_callee26,this,[[3,,7,10]])}));return function(_x42,_x43,_x44){return _ref32.apply(this,arguments)}}(),Chain.prototype.add=function(){var _ref33=_asyncToGenerator(regeneratorRuntime.mark(function _callee27(block,flags,id){var hash,unlock;return regeneratorRuntime.wrap(function(_context27){for(;;)switch(_context27.prev=_context27.next){case 0:return hash=block.hash("hex"),_context27.next=3,this.locker.lock(hash);case 3:return unlock=_context27.sent,_context27.prev=4,_context27.next=7,this._add(block,flags,id);case 7:return _context27.abrupt("return",_context27.sent);case 8:return _context27.prev=8,unlock(),_context27.finish(8);case 11:case"end":return _context27.stop()}},_callee27,this,[[4,,8,11]])}));return function(_x45,_x46,_x47){return _ref33.apply(this,arguments)}}(),Chain.prototype._add=function(){var _ref34=_asyncToGenerator(regeneratorRuntime.mark(function _callee28(block,flags,id){var hash,prev,entry;return regeneratorRuntime.wrap(function(_context28){for(;;)switch(_context28.prev=_context28.next){case 0:if(hash=block.hash("hex"),null==flags&&(flags=common.flags.DEFAULT_FLAGS),null==id&&(id=-1),hash!==this.network.genesis.hash){_context28.next=6;break}throw this.logger.debug("Saw genesis block: %s.",block.rhash()),new VerifyError(block,"duplicate","duplicate",0);case 6:if(!this.hasPending(hash)){_context28.next=9;break}throw this.logger.debug("Already have pending block: %s.",block.rhash()),new VerifyError(block,"duplicate","duplicate",0);case 9:if(!this.hasOrphan(hash)){_context28.next=12;break}throw this.logger.debug("Already have orphan block: %s.",block.rhash()),new VerifyError(block,"duplicate","duplicate",0);case 12:if(!this.hasInvalid(block)){_context28.next=15;break}throw this.logger.debug("Invalid ancestors for block: %s.",block.rhash()),new VerifyError(block,"duplicate","duplicate",100);case 15:if(!(flags&common.flags.VERIFY_POW)){_context28.next=18;break}if(block.verifyPOW()){_context28.next=18;break}throw new VerifyError(block,"invalid","high-hash",50);case 18:return _context28.next=20,this.hasEntry(hash);case 20:if(!_context28.sent){_context28.next=23;break}throw this.logger.debug("Already have block: %s.",block.rhash()),new VerifyError(block,"duplicate","duplicate",0);case 23:return _context28.next=25,this.getEntry(block.prevBlock);case 25:if(prev=_context28.sent){_context28.next=29;break}return this.storeOrphan(block,flags,id),_context28.abrupt("return",null);case 29:return _context28.next=31,this.connect(prev,block,flags);case 31:if(entry=_context28.sent,!this.hasNextOrphan(hash)){_context28.next=35;break}return _context28.next=35,this.handleOrphans(entry);case 35:return _context28.abrupt("return",entry);case 36:case"end":return _context28.stop()}},_callee28,this)}));return function(_x48,_x49,_x50){return _ref34.apply(this,arguments)}}(),Chain.prototype.connect=function(){var _ref35=_asyncToGenerator(regeneratorRuntime.mark(function _callee29(prev,block,flags){var start,entry;return regeneratorRuntime.wrap(function(_context29){for(;;)switch(_context29.prev=_context29.next){case 0:if(start=util.bench(),assert(block.prevBlock===prev.hash),!block.isMemory()){_context29.next=11;break}_context29.prev=3,block=block.toBlock(),_context29.next=11;break;case 7:throw _context29.prev=7,_context29.t0=_context29.catch(3),this.logger.error(_context29.t0),new VerifyError(block,"malformed","error parsing message",10,!0);case 11:if(!(entry=ChainEntry.fromBlock(block,prev)).chainwork.lte(this.tip.chainwork)){_context29.next=17;break}return _context29.next=15,this.saveAlternate(entry,block,prev,flags);case 15:_context29.next=19;break;case 17:return _context29.next=19,this.setBestChain(entry,block,prev,flags);case 19:return this.logStatus(start,block,entry),this.maybeSync(),_context29.abrupt("return",entry);case 22:case"end":return _context29.stop()}},_callee29,this,[[3,7]])}));return function(_x51,_x52,_x53){return _ref35.apply(this,arguments)}}(),Chain.prototype.handleOrphans=function(){var _ref36=_asyncToGenerator(regeneratorRuntime.mark(function _callee30(entry){var orphan,_orphan,block,flags,id;return regeneratorRuntime.wrap(function(_context30){for(;;)switch(_context30.prev=_context30.next){case 0:orphan=this.resolveOrphan(entry.hash);case 1:if(!orphan){_context30.next=21;break}return block=(_orphan=orphan).block,flags=_orphan.flags,id=_orphan.id,_context30.prev=3,_context30.next=6,this.connect(entry,block,flags);case 6:entry=_context30.sent,_context30.next=16;break;case 9:if(_context30.prev=9,_context30.t0=_context30.catch(3),"VerifyError"!==_context30.t0.type){_context30.next=15;break}return this.logger.warning("Could not resolve orphan block %s: %s.",block.rhash(),_context30.t0.message),this.emit("bad orphan",_context30.t0,id),_context30.abrupt("break",21);case 15:throw _context30.t0;case 16:this.logger.debug("Orphan block was resolved: %s (%d).",block.rhash(),entry.height),this.emit("resolved",block,entry),orphan=this.resolveOrphan(entry.hash),_context30.next=1;break;case 21:case"end":return _context30.stop()}},_callee30,this,[[3,9]])}));return function(_x54){return _ref36.apply(this,arguments)}}(),Chain.prototype.isSlow=function(){return!this.options.spv&&(!!this.synced||(1===this.height||this.height%20==0||this.height>=this.network.block.slowHeight))},Chain.prototype.logStatus=function(start,block,entry){if(this.isSlow()){this.logger.memory();var elapsed=util.bench(start);this.logger.info("Block %s (%d) added to chain (size=%d txs=%d time=%d).",entry.rhash(),entry.height,block.getSize(),block.txs.length,elapsed),this.db.coinCache.capacity>0&&this.logger.debug("Coin Cache: size=%dmb, items=%d.",this.db.coinCache.size/(1<<20),this.db.coinCache.items)}},Chain.prototype.verifyCheckpoint=function(prev,hash){if(!this.options.checkpoints)return!0;var height=prev.height+1,checkpoint=this.network.checkpointMap[height];return!checkpoint||(hash===checkpoint?(this.logger.debug("Hit checkpoint block %s (%d).",util.revHex(hash),height),this.emit("checkpoint",hash,height),!0):(this.logger.warning("Checkpoint mismatch at height %d: expected=%s received=%s",height,util.revHex(checkpoint),util.revHex(hash)),this.purgeOrphans(),!1))},Chain.prototype.storeOrphan=function(block,flags,id){var height=block.getCoinbaseHeight(),orphan=this.orphanPrev.get(block.prevBlock);orphan&&(assert(orphan.block.hash("hex")!==block.hash("hex")),assert(orphan.block.prevBlock===block.prevBlock),this.logger.warning("Removing forked orphan block: %s (%d).",orphan.block.rhash(),height),this.removeOrphan(orphan)),this.limitOrphans(),this.addOrphan(new Orphan(block,flags,id)),this.logger.debug("Storing orphan block: %s (%d).",block.rhash(),height),this.emit("orphan",block)},Chain.prototype.addOrphan=function(orphan){var block=orphan.block,hash=block.hash("hex");return assert(!this.orphanMap.has(hash)),assert(!this.orphanPrev.has(block.prevBlock)),assert(this.orphanMap.size>=0),this.orphanMap.set(hash,orphan),this.orphanPrev.set(block.prevBlock,orphan),orphan},Chain.prototype.removeOrphan=function(orphan){var block=orphan.block,hash=block.hash("hex");return assert(this.orphanMap.has(hash)),assert(this.orphanPrev.has(block.prevBlock)),assert(this.orphanMap.size>0),this.orphanMap.delete(hash),this.orphanPrev.delete(block.prevBlock),orphan},Chain.prototype.hasNextOrphan=function(hash){return this.orphanPrev.has(hash)},Chain.prototype.resolveOrphan=function(hash){var orphan=this.orphanPrev.get(hash);return orphan?this.removeOrphan(orphan):null},Chain.prototype.purgeOrphans=function(){var count=this.orphanMap.size;0!==count&&(this.orphanMap.clear(),this.orphanPrev.clear(),this.logger.debug("Purged %d orphans.",count))},Chain.prototype.limitOrphans=function(){var now=util.now(),oldest=null,_iterator5=this.orphanMap.values(),_isArray5=Array.isArray(_iterator5),_i7=0;for(_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();;){var _ref37;if(_isArray5){if(_i7>=_iterator5.length)break;_ref37=_iterator5[_i7++]}else{if((_i7=_iterator5.next()).done)break;_ref37=_i7.value}var orphan=_ref37;now<orphan.time+3600?(!oldest||orphan.time<oldest.time)&&(oldest=orphan):this.removeOrphan(orphan)}this.orphanMap.size<this.options.maxOrphans||oldest&&this.removeOrphan(oldest)},Chain.prototype.hasInvalid=function(block){var hash=block.hash("hex");return!!this.invalid.has(hash)||!!this.invalid.has(block.prevBlock)&&(this.setInvalid(hash),!0)},Chain.prototype.setInvalid=function(hash){this.invalid.set(hash,!0)},Chain.prototype.removeInvalid=function(hash){this.invalid.remove(hash)},Chain.prototype.has=function(){var _ref38=_asyncToGenerator(regeneratorRuntime.mark(function _callee31(hash){return regeneratorRuntime.wrap(function(_context31){for(;;)switch(_context31.prev=_context31.next){case 0:if(!this.hasOrphan(hash)){_context31.next=2;break}return _context31.abrupt("return",!0);case 2:if(!this.locker.has(hash)){_context31.next=4;break}return _context31.abrupt("return",!0);case 4:if(!this.invalid.has(hash)){_context31.next=6;break}return _context31.abrupt("return",!0);case 6:return _context31.abrupt("return",this.hasEntry(hash));case 7:case"end":return _context31.stop()}},_callee31,this)}));return function(_x55){return _ref38.apply(this,arguments)}}(),Chain.prototype.getEntry=function(hash){return this.db.getEntry(hash)},Chain.prototype.getEntryByHeight=function(height){return this.db.getEntryByHeight(height)},Chain.prototype.getEntryByHash=function(hash){return this.db.getEntryByHash(hash)},Chain.prototype.getHash=function(height){return this.db.getHash(height)},Chain.prototype.getHeight=function(hash){return this.db.getHeight(hash)},Chain.prototype.hasEntry=function(hash){return this.db.hasEntry(hash)},Chain.prototype.getNextHash=function(hash){return this.db.getNextHash(hash)},Chain.prototype.hasCoins=function(tx){return this.db.hasCoins(tx)},Chain.prototype.getTips=function(){return this.db.getTips()},Chain.prototype.getHashes=function(){var start=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,end=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return this.db.getHashes(start,end)},Chain.prototype.readCoin=function(prevout){return this.db.readCoin(prevout)},Chain.prototype.getCoin=function(hash,index){return this.db.getCoin(hash,index)},Chain.prototype.getBlock=function(hash){return this.db.getBlock(hash)},Chain.prototype.getRawBlock=function(block){return this.db.getRawBlock(block)},Chain.prototype.getBlockView=function(block){return this.db.getBlockView(block)},Chain.prototype.getMeta=function(hash){return this.db.getMeta(hash)},Chain.prototype.getTX=function(hash){return this.db.getTX(hash)},Chain.prototype.hasTX=function(hash){return this.db.hasTX(hash)},Chain.prototype.getCoinsByAddress=function(addrs){return this.db.getCoinsByAddress(addrs)},Chain.prototype.getHashesByAddress=function(addrs){return this.db.getHashesByAddress(addrs)},Chain.prototype.getTXByAddress=function(addrs){return this.db.getTXByAddress(addrs)},Chain.prototype.getMetaByAddress=function(addrs){return this.db.getMetaByAddress(addrs)},Chain.prototype.getOrphan=function(hash){return this.orphanMap.get(hash)||null},Chain.prototype.hasOrphan=function(hash){return this.orphanMap.has(hash)},Chain.prototype.hasPending=function(hash){return this.locker.pending(hash)},Chain.prototype.getCoinView=function(tx){return this.db.getCoinView(tx)},Chain.prototype.getSpentView=function(){var _ref39=_asyncToGenerator(regeneratorRuntime.mark(function _callee32(tx){var unlock;return regeneratorRuntime.wrap(function(_context32){for(;;)switch(_context32.prev=_context32.next){case 0:return _context32.next=2,this.locker.lock();case 2:return unlock=_context32.sent,_context32.prev=3,_context32.next=6,this.db.getSpentView(tx);case 6:return _context32.abrupt("return",_context32.sent);case 7:return _context32.prev=7,unlock(),_context32.finish(7);case 10:case"end":return _context32.stop()}},_callee32,this,[[3,,7,10]])}));return function(_x58){return _ref39.apply(this,arguments)}}(),Chain.prototype.isFull=function(){return this.synced},Chain.prototype.maybeSync=function(){this.synced||this.options.checkpoints&&this.height<this.network.lastCheckpoint||this.tip.time<util.now()-this.network.block.maxTipAge||this.hasChainwork()&&(this.synced=!0,this.emit("full"))},Chain.prototype.hasChainwork=function(){return this.tip.chainwork.gte(this.network.pow.chainwork)},Chain.prototype.getProgress=function(){var start=this.network.genesis.time,current=this.tip.time-start,end=util.now()-start-2400;return Math.min(1,current/end)},Chain.prototype.getLocator=function(){var _ref40=_asyncToGenerator(regeneratorRuntime.mark(function _callee33(start){var unlock;return regeneratorRuntime.wrap(function(_context33){for(;;)switch(_context33.prev=_context33.next){case 0:return _context33.next=2,this.locker.lock();case 2:return unlock=_context33.sent,_context33.prev=3,_context33.next=6,this._getLocator(start);case 6:return _context33.abrupt("return",_context33.sent);case 7:return _context33.prev=7,unlock(),_context33.finish(7);case 10:case"end":return _context33.stop()}},_callee33,this,[[3,,7,10]])}));return function(_x59){return _ref40.apply(this,arguments)}}(),Chain.prototype._getLocator=function(){var _ref41=_asyncToGenerator(regeneratorRuntime.mark(function _callee34(start){var entry,hashes,main,hash,height,step,ancestor;return regeneratorRuntime.wrap(function(_context34){for(;;)switch(_context34.prev=_context34.next){case 0:return null==start&&(start=this.tip.hash),assert("string"==typeof start),_context34.next=4,this.getEntry(start);case 4:return entry=_context34.sent,hashes=[],entry||(entry=this.tip,hashes.push(start)),_context34.next=9,this.isMainChain(entry);case 9:main=_context34.sent,hash=entry.hash,height=entry.height,step=1,hashes.push(hash);case 14:if(!(height>0)){_context34.next=36;break}if((height-=step)<0&&(height=0),hashes.length>10&&(step*=2),!main){_context34.next=25;break}return _context34.next=21,this.getHash(height);case 21:hash=_context34.sent,assert(hash),_context34.next=33;break;case 25:return _context34.next=27,this.getAncestor(entry,height);case 27:return ancestor=_context34.sent,assert(ancestor),_context34.next=31,this.isMainChain(ancestor);case 31:main=_context34.sent,hash=ancestor.hash;case 33:hashes.push(hash),_context34.next=14;break;case 36:return _context34.abrupt("return",hashes);case 37:case"end":return _context34.stop()}},_callee34,this)}));return function(_x60){return _ref41.apply(this,arguments)}}(),Chain.prototype.getOrphanRoot=function(hash){var root=null;for(assert(hash);;){var orphan=this.orphanMap.get(hash);if(!orphan)break;root=hash,hash=orphan.block.prevBlock}return root},Chain.prototype.getProofTime=function(to,from){var pow=this.network.pow,sign=void 0,work=void 0;return to.chainwork.gt(from.chainwork)?(work=to.chainwork.sub(from.chainwork),sign=1):(work=from.chainwork.sub(to.chainwork),sign=-1),(work=(work=work.imuln(pow.targetSpacing)).div(this.tip.getProof())).bitLength()>53?sign*Number.MAX_SAFE_INTEGER:sign*work.toNumber()},Chain.prototype.getCurrentTarget=function(){var _ref42=_asyncToGenerator(regeneratorRuntime.mark(function _callee35(){return regeneratorRuntime.wrap(function(_context35){for(;;)switch(_context35.prev=_context35.next){case 0:return _context35.abrupt("return",this.getTarget(this.network.now(),this.tip));case 1:case"end":return _context35.stop()}},_callee35,this)}));return function(){return _ref42.apply(this,arguments)}}(),Chain.prototype.getTarget=function(){var _ref43=_asyncToGenerator(regeneratorRuntime.mark(function _callee36(time,prev){var pow,cache,height,first;return regeneratorRuntime.wrap(function(_context36){for(;;)switch(_context36.prev=_context36.next){case 0:if(pow=this.network.pow,prev){_context36.next=4;break}return assert(time===this.network.genesis.time),_context36.abrupt("return",pow.bits);case 4:if((prev.height+1)%pow.retargetInterval==0){_context36.next=21;break}if(!pow.targetReset){_context36.next=20;break}if(!(time>prev.time+2*pow.targetSpacing)){_context36.next=8;break}return _context36.abrupt("return",pow.bits);case 8:if(0===prev.height||prev.height%pow.retargetInterval==0||prev.bits!==pow.bits){_context36.next=20;break}if(!(cache=this.getPrevCache(prev))){_context36.next=14;break}prev=cache,_context36.next=17;break;case 14:return _context36.next=16,this.getPrevious(prev);case 16:prev=_context36.sent;case 17:assert(prev),_context36.next=8;break;case 20:return _context36.abrupt("return",prev.bits);case 21:return height=prev.height-(pow.retargetInterval-1),assert(height>=0),_context36.next=25,this.getAncestor(prev,height);case 25:return first=_context36.sent,assert(first),_context36.abrupt("return",this.retarget(prev,first));case 28:case"end":return _context36.stop()}},_callee36,this)}));return function(_x61,_x62){return _ref43.apply(this,arguments)}}(),Chain.prototype.retarget=function(prev,first){var pow=this.network.pow,targetTimespan=pow.targetTimespan;if(pow.noRetargeting)return prev.bits;var target=consensus.fromCompact(prev.bits),actualTimespan=prev.time-first.time;return actualTimespan<targetTimespan/4|0&&(actualTimespan=targetTimespan/4|0),actualTimespan>4*targetTimespan&&(actualTimespan=4*targetTimespan),target.imuln(actualTimespan),target.idivn(targetTimespan),target.gt(pow.limit)?pow.bits:consensus.toCompact(target)},Chain.prototype.computeTarget=function(){var _ref44=_asyncToGenerator(regeneratorRuntime.mark(function _callee37(prev,first){var pow,targetSpacing,target,actualTimespan;return regeneratorRuntime.wrap(function(_context37){for(;;)switch(_context37.prev=_context37.next){case 0:if(pow=this.network.pow,targetSpacing=pow.targetSpacing,target=consensus.fromCompact(prev.bits),prev.chainwork-first.chainwork,(actualTimespan=prev.time-first.time)>288*targetSpacing&&(actualTimespan=288*targetSpacing),actualTimespan<72*targetSpacing&&(actualTimespan=72*targetSpacing),target.imuln(targetSpacing),target.idivn(actualTimespan),!(target.cmp(pow.limit)>0)){_context37.next=11;break}return _context37.abrupt("return",pow.bits);case 11:return _context37.abrupt("return",consensus.toCompact(target));case 12:case"end":return _context37.stop()}},_callee37,this)}));return function(_x63,_x64){return _ref44.apply(this,arguments)}}(),Chain.prototype.findLocator=function(){var _ref45=_asyncToGenerator(regeneratorRuntime.mark(function _callee38(locator){var _iterator6,_isArray6,_i8,_ref46,hash;return regeneratorRuntime.wrap(function(_context38){for(;;)switch(_context38.prev=_context38.next){case 0:_iterator6=locator,_isArray6=Array.isArray(_iterator6),_i8=0,_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();case 1:if(!_isArray6){_context38.next=7;break}if(!(_i8>=_iterator6.length)){_context38.next=4;break}return _context38.abrupt("break",18);case 4:_ref46=_iterator6[_i8++],_context38.next=11;break;case 7:if(!(_i8=_iterator6.next()).done){_context38.next=10;break}return _context38.abrupt("break",18);case 10:_ref46=_i8.value;case 11:return hash=_ref46,_context38.next=14,this.isMainHash(hash);case 14:if(!_context38.sent){_context38.next=16;break}return _context38.abrupt("return",hash);case 16:_context38.next=1;break;case 18:return _context38.abrupt("return",this.network.genesis.hash);case 19:case"end":return _context38.stop()}},_callee38,this)}));return function(_x65){return _ref45.apply(this,arguments)}}(),Chain.prototype.isActive=function(){var _ref47=_asyncToGenerator(regeneratorRuntime.mark(function _callee39(prev,deployment){var state;return regeneratorRuntime.wrap(function(_context39){for(;;)switch(_context39.prev=_context39.next){case 0:return _context39.next=2,this.getState(prev,deployment);case 2:return state=_context39.sent,_context39.abrupt("return",state===thresholdStates.ACTIVE);case 4:case"end":return _context39.stop()}},_callee39,this)}));return function(_x66,_x67){return _ref47.apply(this,arguments)}}(),Chain.prototype.isUAHFEnabled=function(){var _ref48=_asyncToGenerator(regeneratorRuntime.mark(function _callee40(prev){var state;return regeneratorRuntime.wrap(function(_context40){for(;;)switch(_context40.prev=_context40.next){case 0:return state=new DeploymentState,prev.height+1>=this.network.block.UAHFHeight&&(state.flags|=Script.flags.VERIFY_STRICTENC,state.flags|=Script.flags.VERIFY_SIGHASH_FORKID),_context40.abrupt("return",state);case 4:case"end":return _context40.stop()}},_callee40,this)}));return function(_x68){return _ref48.apply(this,arguments)}}(),Chain.prototype.isDAAEnabled=function(){var _ref49=_asyncToGenerator(regeneratorRuntime.mark(function _callee41(prev){var state;return regeneratorRuntime.wrap(function(_context41){for(;;)switch(_context41.prev=_context41.next){case 0:return state=new DeploymentState,prev.height+1>=this.network.block.daaHeight&&(state.flags|=Script.flags.VERIFY_LOW_S,state.flags|=Script.flags.VERIFY_NULLFAILL),_context41.abrupt("return",state);case 4:case"end":return _context41.stop()}},_callee41,this)}));return function(_x69){return _ref49.apply(this,arguments)}}(),Chain.prototype.getState=function(){var _ref50=_asyncToGenerator(regeneratorRuntime.mark(function _callee42(prev,deployment){var bit,window,threshold,height,entry,state,compute,cached,_height,_entry4,_time,block,count,i;return regeneratorRuntime.wrap(function(_context42){for(;;)switch(_context42.prev=_context42.next){case 0:if(bit=deployment.bit,window=this.network.minerWindow,threshold=this.network.activationThreshold,-1!==deployment.threshold&&(threshold=deployment.threshold),-1!==deployment.window&&(window=deployment.window),(prev.height+1)%window==0){_context42.next=14;break}return height=prev.height-(prev.height+1)%window,_context42.next=9,this.getAncestor(prev,height);case 9:if(prev=_context42.sent){_context42.next=12;break}return _context42.abrupt("return",thresholdStates.DEFINED);case 12:assert(prev.height===height),assert((prev.height+1)%window==0);case 14:entry=prev,state=thresholdStates.DEFINED,compute=[];case 17:if(!entry){_context42.next=36;break}if(-1===(cached=this.db.stateCache.get(bit,entry))){_context42.next=22;break}return state=cached,_context42.abrupt("break",36);case 22:return _context42.next=24,this.getMedianTime(entry);case 24:if(!(_context42.sent<deployment.startTime)){_context42.next=29;break}return state=thresholdStates.DEFINED,this.db.stateCache.set(bit,entry,state),_context42.abrupt("break",36);case 29:return compute.push(entry),_height=entry.height-window,_context42.next=33,this.getAncestor(entry,_height);case 33:entry=_context42.sent,_context42.next=17;break;case 36:if(!compute.length){_context42.next=81;break}_entry4=compute.pop(),_context42.t0=state,_context42.next=_context42.t0===thresholdStates.DEFINED?41:_context42.t0===thresholdStates.STARTED?51:_context42.t0===thresholdStates.LOCKED_IN?73:_context42.t0===thresholdStates.FAILED?75:_context42.t0===thresholdStates.ACTIVE?75:76;break;case 41:return _context42.next=43,this.getMedianTime(_entry4);case 43:if(!((_time=_context42.sent)>=deployment.timeout)){_context42.next=47;break}return state=thresholdStates.FAILED,_context42.abrupt("break",78);case 47:if(!(_time>=deployment.startTime)){_context42.next=50;break}return state=thresholdStates.STARTED,_context42.abrupt("break",78);case 50:return _context42.abrupt("break",78);case 51:return _context42.next=53,this.getMedianTime(_entry4);case 53:if(!(_context42.sent>=deployment.timeout)){_context42.next=57;break}return state=thresholdStates.FAILED,_context42.abrupt("break",78);case 57:block=_entry4,count=0,i=0;case 60:if(!(i<window)){_context42.next=72;break}if(block.hasBit(bit)&&count++,!(count>=threshold)){_context42.next=65;break}return state=thresholdStates.LOCKED_IN,_context42.abrupt("break",72);case 65:return _context42.next=67,this.getPrevious(block);case 67:block=_context42.sent,assert(block);case 69:i++,_context42.next=60;break;case 72:return _context42.abrupt("break",78);case 73:return state=thresholdStates.ACTIVE,_context42.abrupt("break",78);case 75:return _context42.abrupt("break",78);case 76:return assert(!1,"Bad state."),_context42.abrupt("break",78);case 78:this.db.stateCache.set(bit,_entry4,state),_context42.next=36;break;case 81:return _context42.abrupt("return",state);case 82:case"end":return _context42.stop()}},_callee42,this)}));return function(_x70,_x71){return _ref50.apply(this,arguments)}}(),Chain.prototype.computeBlockVersion=function(){var _ref51=_asyncToGenerator(regeneratorRuntime.mark(function _callee43(prev){var version,_iterator7,_isArray7,_i9,_ref52,deployment,state;return regeneratorRuntime.wrap(function(_context43){for(;;)switch(_context43.prev=_context43.next){case 0:version=0,_iterator7=this.network.deploys,_isArray7=Array.isArray(_iterator7),_i9=0,_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();case 2:if(!_isArray7){_context43.next=8;break}if(!(_i9>=_iterator7.length)){_context43.next=5;break}return _context43.abrupt("break",19);case 5:_ref52=_iterator7[_i9++],_context43.next=12;break;case 8:if(!(_i9=_iterator7.next()).done){_context43.next=11;break}return _context43.abrupt("break",19);case 11:_ref52=_i9.value;case 12:return deployment=_ref52,_context43.next=15,this.getState(prev,deployment);case 15:(state=_context43.sent)!==thresholdStates.LOCKED_IN&&state!==thresholdStates.STARTED||(version|=1<<deployment.bit);case 17:_context43.next=2;break;case 19:return version|=consensus.VERSION_TOP_BITS,version>>>=0,_context43.abrupt("return",version);case 22:case"end":return _context43.stop()}},_callee43,this)}));return function(_x72){return _ref51.apply(this,arguments)}}(),Chain.prototype.getDeploymentState=function(){var _ref53=_asyncToGenerator(regeneratorRuntime.mark(function _callee44(){var prev;return regeneratorRuntime.wrap(function(_context44){for(;;)switch(_context44.prev=_context44.next){case 0:return _context44.next=2,this.getPrevious(this.tip);case 2:if(prev=_context44.sent){_context44.next=6;break}return assert(this.tip.isGenesis()),_context44.abrupt("return",this.state);case 6:if(!this.options.spv){_context44.next=8;break}return _context44.abrupt("return",this.state);case 8:return _context44.abrupt("return",this.getDeployments(this.tip.time,prev));case 9:case"end":return _context44.stop()}},_callee44,this)}));return function(){return _ref53.apply(this,arguments)}}(),Chain.prototype.verifyFinal=function(){var _ref54=_asyncToGenerator(regeneratorRuntime.mark(function _callee45(prev,tx,flags){var height,time;return regeneratorRuntime.wrap(function(_context45){for(;;)switch(_context45.prev=_context45.next){case 0:if(height=prev.height+1,!(tx.locktime<consensus.LOCKTIME_THRESHOLD)){_context45.next=3;break}return _context45.abrupt("return",tx.isFinal(height,-1));case 3:if(!(flags&common.lockFlags.MEDIAN_TIME_PAST)){_context45.next=8;break}return _context45.next=6,this.getMedianTime(prev);case 6:return time=_context45.sent,_context45.abrupt("return",tx.isFinal(height,time));case 8:return _context45.abrupt("return",tx.isFinal(height,this.network.now()));case 9:case"end":return _context45.stop()}},_callee45,this)}));return function(_x73,_x74,_x75){return _ref54.apply(this,arguments)}}(),Chain.prototype.getLocks=function(){var _ref55=_asyncToGenerator(regeneratorRuntime.mark(function _callee46(prev,tx,view,flags){var GRANULARITY,DISABLE_FLAG,TYPE_FLAG,MASK,minHeight,minTime,_iterator8,_isArray8,_i10,_ref57,_ref56,prevout,sequence,height,entry,time;return regeneratorRuntime.wrap(function(_context46){for(;;)switch(_context46.prev=_context46.next){case 0:if(GRANULARITY=consensus.SEQUENCE_GRANULARITY,DISABLE_FLAG=consensus.SEQUENCE_DISABLE_FLAG,TYPE_FLAG=consensus.SEQUENCE_TYPE_FLAG,MASK=consensus.SEQUENCE_MASK,flags&common.lockFlags.VERIFY_SEQUENCE){_context46.next=6;break}return _context46.abrupt("return",[-1,-1]);case 6:if(!(tx.isCoinbase()||tx.version<2)){_context46.next=8;break}return _context46.abrupt("return",[-1,-1]);case 8:minHeight=-1,minTime=-1,_iterator8=tx.inputs,_isArray8=Array.isArray(_iterator8),_i10=0,_iterator8=_isArray8?_iterator8:_iterator8[Symbol.iterator]();case 11:if(!_isArray8){_context46.next=17;break}if(!(_i10>=_iterator8.length)){_context46.next=14;break}return _context46.abrupt("break",44);case 14:_ref57=_iterator8[_i10++],_context46.next=21;break;case 17:if(!(_i10=_iterator8.next()).done){_context46.next=20;break}return _context46.abrupt("break",44);case 20:_ref57=_i10.value;case 21:if(prevout=(_ref56=_ref57).prevout,!((sequence=_ref56.sequence)&DISABLE_FLAG)){_context46.next=26;break}return _context46.abrupt("continue",42);case 26:if(-1===(height=view.getHeight(prevout))&&(height=this.height+1),sequence&TYPE_FLAG){_context46.next=32;break}return height+=(sequence&MASK)-1,minHeight=Math.max(minHeight,height),_context46.abrupt("continue",42);case 32:return height=Math.max(height-1,0),_context46.next=35,this.getAncestor(prev,height);case 35:return entry=_context46.sent,assert(entry,"Database is corrupt."),_context46.next=39,this.getMedianTime(entry);case 39:time=_context46.sent,time+=((sequence&MASK)<<GRANULARITY)-1,minTime=Math.max(minTime,time);case 42:_context46.next=11;break;case 44:return _context46.abrupt("return",[minHeight,minTime]);case 45:case"end":return _context46.stop()}},_callee46,this)}));return function(_x76,_x77,_x78,_x79){return _ref55.apply(this,arguments)}}(),Chain.prototype.verifyLocks=function(){var _ref58=_asyncToGenerator(regeneratorRuntime.mark(function _callee47(prev,tx,view,flags){var _ref59,height,time,mtp;return regeneratorRuntime.wrap(function(_context47){for(;;)switch(_context47.prev=_context47.next){case 0:return _context47.next=2,this.getLocks(prev,tx,view,flags);case 2:if(_ref59=_context47.sent,height=_ref59[0],time=_ref59[1],-1===height){_context47.next=8;break}if(!(height>=prev.height+1)){_context47.next=8;break}return _context47.abrupt("return",!1);case 8:if(-1===time){_context47.next=14;break}return _context47.next=11,this.getMedianTime(prev);case 11:if(mtp=_context47.sent,!(time>=mtp)){_context47.next=14;break}return _context47.abrupt("return",!1);case 14:return _context47.abrupt("return",!0);case 15:case"end":return _context47.stop()}},_callee47,this)}));return function(_x80,_x81,_x82,_x83){return _ref58.apply(this,arguments)}}(),Chain}(AsyncEmitter),ChainOptions=function(){function ChainOptions(options){_classCallCheck(this,ChainOptions),this.network=Network.primary,this.logger=Logger.global,this.workers=null,this.prefix=null,this.location=null,this.memory=!0,this.maxFiles=64,this.cacheSize=32<<20,this.compression=!0,this.spv=!1,this.prune=!1,this.indexTX=!1,this.indexAddress=!1,this.forceFlags=!1,this.coinCache=0,this.entryCache=5e3,this.maxOrphans=20,this.checkpoints=!0,options&&this.fromOptions(options)}return ChainOptions.prototype.fromOptions=function(options){return null!=options.network&&(this.network=Network.get(options.network)),null!=options.logger&&(assert("object"===_typeof(options.logger)),this.logger=options.logger),null!=options.workers&&(assert("object"===_typeof(options.workers)),this.workers=options.workers),null!=options.spv&&(assert("boolean"==typeof options.spv),this.spv=options.spv),null!=options.prefix&&(assert("string"==typeof options.prefix),this.prefix=options.prefix,this.location=this.spv?path.join(this.prefix,"spvchain"):path.join(this.prefix,"chain")),null!=options.location&&(assert("string"==typeof options.location),this.location=options.location),null!=options.memory&&(assert("boolean"==typeof options.memory),this.memory=options.memory),null!=options.maxFiles&&(assert(options.maxFiles>>>0===options.maxFiles),this.maxFiles=options.maxFiles),null!=options.cacheSize&&(assert(Number.isSafeInteger(options.cacheSize)),assert(options.cacheSize>=0),this.cacheSize=options.cacheSize),null!=options.compression&&(assert("boolean"==typeof options.compression),this.compression=options.compression),null!=options.prune&&(assert("boolean"==typeof options.prune),this.prune=options.prune),null!=options.indexTX&&(assert("boolean"==typeof options.indexTX),this.indexTX=options.indexTX),null!=options.indexAddress&&(assert("boolean"==typeof options.indexAddress),this.indexAddress=options.indexAddress),null!=options.forceFlags&&(assert("boolean"==typeof options.forceFlags),this.forceFlags=options.forceFlags),null!=options.coinCache&&(assert(options.coinCache>>>0===options.coinCache),this.coinCache=options.coinCache),null!=options.entryCache&&(assert(options.entryCache>>>0===options.entryCache),this.entryCache=options.entryCache),null!=options.maxOrphans&&(assert(options.maxOrphans>>>0===options.maxOrphans),this.maxOrphans=options.maxOrphans),null!=options.checkpoints&&(assert("boolean"==typeof options.checkpoints),this.checkpoints=options.checkpoints),this},ChainOptions.fromOptions=function(options){return(new ChainOptions).fromOptions(options)},ChainOptions}(),DeploymentState=function(){function DeploymentState(){_classCallCheck(this,DeploymentState),this.flags=Script.flags.MANDATORY_VERIFY_FLAGS,this.flags&=~Script.flags.VERIFY_P2SH,this.lockFlags=common.lockFlags.MANDATORY_LOCKTIME_FLAGS,this.bip34=!1}return DeploymentState.prototype.hasP2SH=function(){return 0!=(this.flags&Script.flags.VERIFY_P2SH)},DeploymentState.prototype.hasBIP34=function(){return this.bip34},DeploymentState.prototype.hasBIP66=function(){return 0!=(this.flags&Script.flags.VERIFY_DERSIG)},DeploymentState.prototype.hasCLTV=function(){return 0!=(this.flags&Script.flags.VERIFY_CHECKLOCKTIMEVERIFY)},DeploymentState.prototype.hasMTP=function(){return 0!=(this.lockFlags&common.lockFlags.MEDIAN_TIME_PAST)},DeploymentState.prototype.hasUAHF=function(){return 0!=(this.flags&Script.flags.VERIFY_SIGHASH_FORKID)},DeploymentState.prototype.isDAAEnabled=function(){return 0!=(this.flags&Script.flags.VERIFY_LOW_S)},DeploymentState.prototype.hasCSV=function(){return 0!=(this.flags&Script.flags.VERIFY_CHECKSEQUENCEVERIFY)},DeploymentState}(),Orphan=function Orphan(block,flags,id){_classCallCheck(this,Orphan),this.block=block,this.flags=flags,this.id=id,this.time=util.now()};function cmp(a,b){return a-b}module.exports=Chain},{"../coins/coinview":13,"../protocol/consensus":84,"../protocol/errors":85,"../protocol/network":87,"../script/script":95,"../utils/lru":105,"../utils/util":106,"./chaindb":3,"./chainentry":4,"./common":5,assert:146,bevent:200,blgr:211,bmutex:214,path:367}],3:[function(require,module,exports){(function(Buffer){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),bdb=require("bdb"),bio=require("bufio"),Amount=require("../btc/amount"),Network=require("../protocol/network"),CoinView=require("../coins/coinview"),UndoCoins=require("../coins/undocoins"),layout=require("./layout"),LRU=require("../utils/lru"),util=require("../utils/util"),consensus=require("../protocol/consensus"),Block=require("../primitives/block"),Outpoint=require("../primitives/outpoint"),Address=require("../primitives/address"),ChainEntry=require("./chainentry"),TXMeta=require("../primitives/txmeta"),CoinEntry=require("../coins/coinentry"),ChainDB=function(){function ChainDB(options){_classCallCheck(this,ChainDB),this.options=options,this.network=this.options.network,this.logger=this.options.logger.context("chaindb"),this.db=bdb.create(this.options),this.stateCache=new StateCache(this.network),this.state=new ChainState,this.pending=null,this.current=null,this.coinCache=new LRU(this.options.coinCache,getSize),this.cacheHash=new LRU(this.options.entryCache),this.cacheHeight=new LRU(this.options.entryCache)}return ChainDB.prototype.open=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var state;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return this.logger.info("Opening ChainDB..."),_context.next=3,this.db.open();case 3:return _context.next=5,this.db.verify(layout.V.build(),"chain",4);case 5:return _context.next=7,this.getState();case 7:if(!(state=_context.sent)){_context.next=20;break}return _context.next=11,this.verifyFlags(state);case 11:return _context.next=13,this.verifyDeployments();case 13:return _context.next=15,this.getStateCache();case 15:this.stateCache=_context.sent,this.state=state,this.logger.info("ChainDB successfully loaded."),_context.next=27;break;case 20:return _context.next=22,this.saveFlags();case 22:return _context.next=24,this.saveDeployments();case 24:return _context.next=26,this.saveGenesis();case 26:this.logger.info("ChainDB successfully initialized.");case 27:this.logger.info("Chain State: hash=%s tx=%d coin=%d value=%s.",this.state.rhash(),this.state.tx,this.state.coin,Amount.btc(this.state.value));case 28:case"end":return _context.stop()}},_callee,this)}));return function(){return _ref.apply(this,arguments)}}(),ChainDB.prototype.close=function(){return this.db.close()},ChainDB.prototype.start=function(){return assert(!this.current),assert(!this.pending),this.current=this.db.batch(),this.pending=this.state.clone(),this.coinCache.start(),this.cacheHash.start(),this.cacheHeight.start(),this.current},ChainDB.prototype.put=function(key,value){assert(this.current),this.current.put(key,value)},ChainDB.prototype.del=function(key){assert(this.current),this.current.del(key)},ChainDB.prototype.batch=function(){return assert(this.current),this.current},ChainDB.prototype.drop=function(){var batch=this.current;assert(this.current),assert(this.pending),this.current=null,this.pending=null,this.coinCache.drop(),this.cacheHash.drop(),this.cacheHeight.drop(),this.stateCache.drop(),batch.clear()},ChainDB.prototype.commit=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return assert(this.current),assert(this.pending),_context2.prev=2,_context2.next=5,this.current.write();case 5:_context2.next=15;break;case 7:throw _context2.prev=7,_context2.t0=_context2.catch(2),this.current=null,this.pending=null,this.coinCache.drop(),this.cacheHash.drop(),this.cacheHeight.drop(),_context2.t0;case 15:this.pending.committed&&(this.state=this.pending),this.current=null,this.pending=null,this.coinCache.commit(),this.cacheHash.commit(),this.cacheHeight.commit(),this.stateCache.commit();case 22:case"end":return _context2.stop()}},_callee2,this,[[2,7]])}));return function(){return _ref2.apply(this,arguments)}}(),ChainDB.prototype.hasCache=function(block){return"number"==typeof block?this.cacheHeight.has(block):(assert("string"==typeof block),this.cacheHash.has(block))},ChainDB.prototype.getCache=function(block){return"number"==typeof block?this.cacheHeight.get(block):(assert("string"==typeof block),this.cacheHash.get(block))},ChainDB.prototype.getHeight=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(hash){var entry,height;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if("number"!=typeof hash){_context3.next=2;break}return _context3.abrupt("return",hash);case 2:if(assert("string"==typeof hash),hash!==consensus.NULL_HASH){_context3.next=5;break}return _context3.abrupt("return",-1);case 5:if(!(entry=this.cacheHash.get(hash))){_context3.next=8;break}return _context3.abrupt("return",entry.height);case 8:return _context3.next=10,this.db.get(layout.h.build(hash));case 10:if(height=_context3.sent){_context3.next=13;break}return _context3.abrupt("return",-1);case 13:return _context3.abrupt("return",height.readUInt32LE(0,!0));case 14:case"end":return _context3.stop()}},_callee3,this)}));return function(_x){return _ref3.apply(this,arguments)}}(),ChainDB.prototype.getHash=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(height){var entry,hash;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if("string"!=typeof height){_context4.next=2;break}return _context4.abrupt("return",height);case 2:if(assert("number"==typeof height),!(height<0)){_context4.next=5;break}return _context4.abrupt("return",null);case 5:if(!(entry=this.cacheHeight.get(height))){_context4.next=8;break}return _context4.abrupt("return",entry.hash);case 8:return _context4.next=10,this.db.get(layout.H.build(height));case 10:if(hash=_context4.sent){_context4.next=13;break}return _context4.abrupt("return",null);case 13:return _context4.abrupt("return",hash.toString("hex"));case 14:case"end":return _context4.stop()}},_callee4,this)}));return function(_x2){return _ref4.apply(this,arguments)}}(),ChainDB.prototype.getEntryByHeight=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(height){var cache,data,hash,state,entry;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(assert("number"==typeof height),!(height<0)){_context5.next=3;break}return _context5.abrupt("return",null);case 3:if(!(cache=this.cacheHeight.get(height))){_context5.next=6;break}return _context5.abrupt("return",cache);case 6:return _context5.next=8,this.db.get(layout.H.build(height));case 8:if(data=_context5.sent){_context5.next=11;break}return _context5.abrupt("return",null);case 11:return hash=data.toString("hex"),state=this.state,_context5.next=15,this.getEntryByHash(hash);case 15:if(entry=_context5.sent){_context5.next=18;break}return _context5.abrupt("return",null);case 18:return this.state===state&&this.cacheHeight.set(entry.height,entry),_context5.abrupt("return",entry);case 20:case"end":return _context5.stop()}},_callee5,this)}));return function(_x3){return _ref5.apply(this,arguments)}}(),ChainDB.prototype.getEntryByHash=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(hash){var cache,raw,entry;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(assert("string"==typeof hash),hash!==consensus.NULL_HASH){_context6.next=3;break}return _context6.abrupt("return",null);case 3:if(!(cache=this.cacheHash.get(hash))){_context6.next=6;break}return _context6.abrupt("return",cache);case 6:return _context6.next=8,this.db.get(layout.e.build(hash));case 8:if(raw=_context6.sent){_context6.next=11;break}return _context6.abrupt("return",null);case 11:return entry=ChainEntry.fromRaw(raw),this.cacheHash.set(entry.hash,entry),_context6.abrupt("return",entry);case 14:case"end":return _context6.stop()}},_callee6,this)}));return function(_x4){return _ref6.apply(this,arguments)}}(),ChainDB.prototype.getEntry=function(block){return"number"==typeof block?this.getEntryByHeight(block):this.getEntryByHash(block)},ChainDB.prototype.hasEntry=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(hash){var height;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.next=2,this.getHeight(hash);case 2:return height=_context7.sent,_context7.abrupt("return",-1!==height);case 4:case"end":return _context7.stop()}},_callee7,this)}));return function(_x5){return _ref7.apply(this,arguments)}}(),ChainDB.prototype.getAncestor=function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(entry,height){var cache;return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(!(height<0)){_context8.next=2;break}return _context8.abrupt("return",null);case 2:return assert(height>=0),assert(height<=entry.height),_context8.next=6,this.isMainChain(entry);case 6:if(!_context8.sent){_context8.next=8;break}return _context8.abrupt("return",this.getEntryByHeight(height));case 8:if(entry.height===height){_context8.next=20;break}if(!(cache=this.getPrevCache(entry))){_context8.next=14;break}entry=cache,_context8.next=17;break;case 14:return _context8.next=16,this.getPrevious(entry);case 16:entry=_context8.sent;case 17:assert(entry),_context8.next=8;break;case 20:return _context8.abrupt("return",entry);case 21:case"end":return _context8.stop()}},_callee8,this)}));return function(_x6,_x7){return _ref8.apply(this,arguments)}}(),ChainDB.prototype.getPrevious=function(entry){return this.getEntryByHash(entry.prevBlock)},ChainDB.prototype.getPrevCache=function(entry){return this.cacheHash.get(entry.prevBlock)||null},ChainDB.prototype.getNext=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(entry){var hash;return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return _context9.next=2,this.getNextHash(entry.hash);case 2:if(hash=_context9.sent){_context9.next=5;break}return _context9.abrupt("return",null);case 5:return _context9.abrupt("return",this.getEntryByHash(hash));case 6:case"end":return _context9.stop()}},_callee9,this)}));return function(_x8){return _ref9.apply(this,arguments)}}(),ChainDB.prototype.getNextEntry=function(){var _ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(entry){var next;return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return _context10.next=2,this.getEntryByHeight(entry.height+1);case 2:if(next=_context10.sent){_context10.next=5;break}return _context10.abrupt("return",null);case 5:if(next.prevBlock===entry.hash){_context10.next=7;break}return _context10.abrupt("return",null);case 7:return _context10.abrupt("return",next);case 8:case"end":return _context10.stop()}},_callee10,this)}));return function(_x9){return _ref10.apply(this,arguments)}}(),ChainDB.prototype.getTip=function(){return this.getEntryByHash(this.state.tip)},ChainDB.prototype.getState=function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(){var data;return regeneratorRuntime.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:return _context11.next=2,this.db.get(layout.R.build());case 2:if(data=_context11.sent){_context11.next=5;break}return _context11.abrupt("return",null);case 5:return _context11.abrupt("return",ChainState.fromRaw(data));case 6:case"end":return _context11.stop()}},_callee11,this)}));return function(){return _ref11.apply(this,arguments)}}(),ChainDB.prototype.saveGenesis=function(){var _ref12=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(){var genesis,block,entry;return regeneratorRuntime.wrap(function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:return genesis=this.network.genesisBlock,block=Block.fromRaw(genesis,"hex"),entry=ChainEntry.fromBlock(block),this.logger.info("Writing genesis block to ChainDB."),_context12.abrupt("return",this.save(entry,block,new CoinView));case 5:case"end":return _context12.stop()}},_callee12,this)}));return function(){return _ref12.apply(this,arguments)}}(),ChainDB.prototype.getFlags=function(){var _ref13=_asyncToGenerator(regeneratorRuntime.mark(function _callee13(){var data;return regeneratorRuntime.wrap(function(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:return _context13.next=2,this.db.get(layout.O.build());case 2:if(data=_context13.sent){_context13.next=5;break}return _context13.abrupt("return",null);case 5:return _context13.abrupt("return",ChainFlags.fromRaw(data));case 6:case"end":return _context13.stop()}},_callee13,this)}));return function(){return _ref13.apply(this,arguments)}}(),ChainDB.prototype.verifyFlags=function(){var _ref14=_asyncToGenerator(regeneratorRuntime.mark(function _callee14(state){var options,flags,needsSave,needsPrune;return regeneratorRuntime.wrap(function(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:return options=this.options,_context14.next=3,this.getFlags();case 3:if(flags=_context14.sent,needsSave=!1,needsPrune=!1,flags){_context14.next=8;break}throw new Error("No flags found.");case 8:if(options.network===flags.network){_context14.next=10;break}throw new Error("Network mismatch for chain.");case 10:if(!options.spv||flags.spv){_context14.next=12;break}throw new Error("Cannot retroactively enable SPV.");case 12:if(options.spv||!flags.spv){_context14.next=14;break}throw new Error("Cannot retroactively disable SPV.");case 14:if(options.UAHF||!flags.UAHF){_context14.next=16;break}throw new Error("Cannot retroactively disable Bitcoin Cash Sighashing.");case 16:if(!options.prune||flags.prune){_context14.next=20;break}if(options.forceFlags){_context14.next=19;break}throw new Error("Cannot retroactively prune.");case 19:needsPrune=!0;case 20:if(options.prune||!flags.prune){_context14.next=22;break}throw new Error("Cannot retroactively unprune.");case 22:if(!options.indexTX||flags.indexTX){_context14.next=24;break}throw new Error("Cannot retroactively enable TX indexing.");case 24:if(options.indexTX||!flags.indexTX){_context14.next=26;break}throw new Error("Cannot retroactively disable TX indexing.");case 26:if(!options.indexAddress||flags.indexAddress){_context14.next=28;break}throw new Error("Cannot retroactively enable address indexing.");case 28:if(options.indexAddress||!flags.indexAddress){_context14.next=30;break}throw new Error("Cannot retroactively disable address indexing.");case 30:if(!needsSave){_context14.next=35;break}return _context14.next=33,this.logger.info("Rewriting chain flags.");case 33:return _context14.next=35,this.saveFlags();case 35:if(!needsPrune){_context14.next=40;break}return _context14.next=38,this.logger.info("Retroactively pruning chain.");case 38:return _context14.next=40,this.prune(state.tip);case 40:case"end":return _context14.stop()}},_callee14,this)}));return function(_x10){return _ref14.apply(this,arguments)}}(),ChainDB.prototype.getStateCache=function(){var _ref15=_asyncToGenerator(regeneratorRuntime.mark(function _callee15(){var stateCache,items,_iterator,_isArray,_i,_ref16,item,_layout$v$parse,bit,hash,state;return regeneratorRuntime.wrap(function(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:return stateCache=new StateCache(this.network),_context15.next=3,this.db.range({gte:layout.v.min(),lte:layout.v.max(),values:!0});case 3:items=_context15.sent,_iterator=items,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();case 5:if(!_isArray){_context15.next=11;break}if(!(_i>=_iterator.length)){_context15.next=8;break}return _context15.abrupt("break",21);case 8:_ref16=_iterator[_i++],_context15.next=15;break;case 11:if(!(_i=_iterator.next()).done){_context15.next=14;break}return _context15.abrupt("break",21);case 14:_ref16=_i.value;case 15:item=_ref16,_layout$v$parse=layout.v.parse(item.key),bit=_layout$v$parse[0],hash=_layout$v$parse[1],state=item.value[0],stateCache.insert(bit,hash,state);case 19:_context15.next=5;break;case 21:return _context15.abrupt("return",stateCache);case 22:case"end":return _context15.stop()}},_callee15,this)}));return function(){return _ref15.apply(this,arguments)}}(),ChainDB.prototype.saveDeployments=function(){var b=this.db.batch();return this.writeDeployments(b),b.write()},ChainDB.prototype.writeDeployments=function(b){var bw=bio.write(1+17*this.network.deploys.length);bw.writeU8(this.network.deploys.length);var _iterator2=this.network.deploys,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref17;if(_isArray2){if(_i2>=_iterator2.length)break;_ref17=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref17=_i2.value}var deployment=_ref17;bw.writeU8(deployment.bit),bw.writeU32(deployment.startTime),bw.writeU32(deployment.timeout),bw.writeI32(deployment.threshold),bw.writeI32(deployment.window)}b.put(layout.D.build(),bw.render())},ChainDB.prototype.checkDeployments=function(){var _ref18=_asyncToGenerator(regeneratorRuntime.mark(function _callee16(){var raw,br,count,invalid,i,bit,start,timeout,threshold,window,deployment;return regeneratorRuntime.wrap(function(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:return _context16.next=2,this.db.get(layout.D.build());case 2:raw=_context16.sent,assert(raw,"No deployment table found."),br=bio.read(raw),count=br.readU8(),invalid=[],i=0;case 8:if(!(i<count)){_context16.next=21;break}if(bit=br.readU8(),start=br.readU32(),timeout=br.readU32(),threshold=br.readI32(),window=br.readI32(),!(deployment=this.network.byBit(bit))||start!==deployment.startTime||timeout!==deployment.timeout||threshold!==deployment.threshold||window!==deployment.window){_context16.next=17;break}return _context16.abrupt("continue",18);case 17:invalid.push(bit);case 18:i++,_context16.next=8;break;case 21:return _context16.abrupt("return",invalid);case 22:case"end":return _context16.stop()}},_callee16,this)}));return function(){return _ref18.apply(this,arguments)}}(),ChainDB.prototype.verifyDeployments=function(){var _ref19=_asyncToGenerator(regeneratorRuntime.mark(function _callee17(){var invalid,i,b,_iterator3,_isArray3,_i3,_ref20,bit;return regeneratorRuntime.wrap(function(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:return invalid=void 0,_context17.prev=1,_context17.next=4,this.checkDeployments();case 4:invalid=_context17.sent,_context17.next=13;break;case 7:if(_context17.prev=7,_context17.t0=_context17.catch(1),"EncodingError"===_context17.t0.type){_context17.next=11;break}throw _context17.t0;case 11:for(invalid=[],i=0;i<32;i++)invalid.push(i);case 13:if(0!==invalid.length){_context17.next=15;break}return _context17.abrupt("return",!0);case 15:b=this.db.batch(),_iterator3=invalid,_isArray3=Array.isArray(_iterator3),_i3=0,_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();case 17:if(!_isArray3){_context17.next=23;break}if(!(_i3>=_iterator3.length)){_context17.next=20;break}return _context17.abrupt("break",34);case 20:_ref20=_iterator3[_i3++],_context17.next=27;break;case 23:if(!(_i3=_iterator3.next()).done){_context17.next=26;break}return _context17.abrupt("break",34);case 26:_ref20=_i3.value;case 27:return bit=_ref20,this.logger.warning("Versionbit deployment params modified."),this.logger.warning("Invalidating cache for bit %d.",bit),_context17.next=32,this.invalidateCache(bit,b);case 32:_context17.next=17;break;case 34:return this.writeDeployments(b),_context17.next=37,b.write();case 37:return _context17.abrupt("return",!1);case 38:case"end":return _context17.stop()}},_callee17,this,[[1,7]])}));return function(){return _ref19.apply(this,arguments)}}(),ChainDB.prototype.invalidateCache=function(){var _ref21=_asyncToGenerator(regeneratorRuntime.mark(function _callee18(bit,b){var keys,_iterator4,_isArray4,_i4,_ref22,key;return regeneratorRuntime.wrap(function(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:return _context18.next=2,this.db.keys({gte:layout.v.min(bit),lte:layout.v.max(bit)});case 2:keys=_context18.sent,_iterator4=keys,_isArray4=Array.isArray(_iterator4),_i4=0,_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();case 4:if(!_isArray4){_context18.next=10;break}if(!(_i4>=_iterator4.length)){_context18.next=7;break}return _context18.abrupt("break",18);case 7:_ref22=_iterator4[_i4++],_context18.next=14;break;case 10:if(!(_i4=_iterator4.next()).done){_context18.next=13;break}return _context18.abrupt("break",18);case 13:_ref22=_i4.value;case 14:key=_ref22,b.del(key);case 16:_context18.next=4;break;case 18:case"end":return _context18.stop()}},_callee18,this)}));return function(_x11,_x12){return _ref21.apply(this,arguments)}}(),ChainDB.prototype.prune=function(){var _ref23=_asyncToGenerator(regeneratorRuntime.mark(function _callee19(){var options,keepBlocks,pruneAfter,height,start,end,b,i,hash,_flags;return regeneratorRuntime.wrap(function(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:return options=this.options,keepBlocks=this.network.block.keepBlocks,pruneAfter=this.network.block.pruneAfterHeight,_context19.next=5,this.getFlags();case 5:if(!_context19.sent.prune){_context19.next=8;break}throw new Error("Chain is already pruned.");case 8:return _context19.next=10,this.getHeight(this.state.tip);case 10:if(!((height=_context19.sent)<=pruneAfter+keepBlocks)){_context19.next=13;break}return _context19.abrupt("return",!1);case 13:start=pruneAfter+1,end=height-keepBlocks,b=this.db.batch(),i=start;case 17:if(!(i<=end)){_context19.next=28;break}return _context19.next=20,this.getHash(i);case 20:if(hash=_context19.sent){_context19.next=23;break}throw new Error("Cannot find hash for "+i+".");case 23:b.del(layout.b.build(hash)),b.del(layout.u.build(hash));case 25:i++,_context19.next=17;break;case 28:return _context19.prev=28,options.prune=!0,_flags=ChainFlags.fromOptions(options),assert(_flags.prune),b.put(layout.O.build(),_flags.toRaw()),_context19.next=35,b.write();case 35:_context19.next=41;break;case 37:throw _context19.prev=37,_context19.t0=_context19.catch(28),options.prune=!1,_context19.t0;case 41:return _context19.next=43,this.db.compactRange();case 43:return _context19.abrupt("return",!0);case 44:case"end":return _context19.stop()}},_callee19,this,[[28,37]])}));return function(){return _ref23.apply(this,arguments)}}(),ChainDB.prototype.getNextHash=function(){var _ref24=_asyncToGenerator(regeneratorRuntime.mark(function _callee20(hash){var data;return regeneratorRuntime.wrap(function(_context20){for(;;)switch(_context20.prev=_context20.next){case 0:return _context20.next=2,this.db.get(layout.n.build(hash));case 2:if(data=_context20.sent){_context20.next=5;break}return _context20.abrupt("return",null);case 5:return _context20.abrupt("return",data.toString("hex"));case 6:case"end":return _context20.stop()}},_callee20,this)}));return function(_x13){return _ref24.apply(this,arguments)}}(),ChainDB.prototype.isMainHash=function(){var _ref25=_asyncToGenerator(regeneratorRuntime.mark(function _callee21(hash){var cacheHash,cacheHeight;return regeneratorRuntime.wrap(function(_context21){for(;;)switch(_context21.prev=_context21.next){case 0:if(assert("string"==typeof hash),hash!==consensus.NULL_HASH){_context21.next=3;break}return _context21.abrupt("return",!1);case 3:if(hash!==this.network.genesis.hash){_context21.next=5;break}return _context21.abrupt("return",!0);case 5:if(hash!==this.state.tip){_context21.next=7;break}return _context21.abrupt("return",!0);case 7:if(!(cacheHash=this.cacheHash.get(hash))){_context21.next=12;break}if(!(cacheHeight=this.cacheHeight.get(cacheHash.height))){_context21.next=12;break}return _context21.abrupt("return",cacheHeight.hash===hash);case 12:return _context21.next=14,this.getNextHash(hash);case 14:if(!_context21.sent){_context21.next=16;break}return _context21.abrupt("return",!0);case 16:return _context21.abrupt("return",!1);case 17:case"end":return _context21.stop()}},_callee21,this)}));return function(_x14){return _ref25.apply(this,arguments)}}(),ChainDB.prototype.isMainChain=function(){var _ref26=_asyncToGenerator(regeneratorRuntime.mark(function _callee22(entry){var cache;return regeneratorRuntime.wrap(function(_context22){for(;;)switch(_context22.prev=_context22.next){case 0:if(!entry.isGenesis()){_context22.next=2;break}return _context22.abrupt("return",!0);case 2:if(entry.hash!==this.state.tip){_context22.next=4;break}return _context22.abrupt("return",!0);case 4:if(!(cache=this.getCache(entry.height))){_context22.next=7;break}return _context22.abrupt("return",entry.hash===cache.hash);case 7:return _context22.next=9,this.getNextHash(entry.hash);case 9:if(!_context22.sent){_context22.next=11;break}return _context22.abrupt("return",!0);case 11:return _context22.abrupt("return",!1);case 12:case"end":return _context22.stop()}},_callee22,this)}));return function(_x15){return _ref26.apply(this,arguments)}}(),ChainDB.prototype.getHashes=function(){var _ref27=_asyncToGenerator(regeneratorRuntime.mark(function _callee23(){var start=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,end=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return regeneratorRuntime.wrap(function(_context23){for(;;)switch(_context23.prev=_context23.next){case 0:return-1===start&&(start=0),-1===end&&(end>>>=0),assert(start>>>0===start),assert(end>>>0===end),_context23.abrupt("return",this.db.values({gte:layout.H.min(start),lte:layout.H.max(end),parse:function(data){return data.toString("hex")}}));case 5:case"end":return _context23.stop()}},_callee23,this)}));return function(){return _ref27.apply(this,arguments)}}(),ChainDB.prototype.getEntries=function(){var _ref28=_asyncToGenerator(regeneratorRuntime.mark(function _callee24(){return regeneratorRuntime.wrap(function(_context24){for(;;)switch(_context24.prev=_context24.next){case 0:return _context24.abrupt("return",this.db.values({gte:layout.e.min(),lte:layout.e.max(),parse:function(data){return ChainEntry.fromRaw(data)}}));case 1:case"end":return _context24.stop()}},_callee24,this)}));return function(){return _ref28.apply(this,arguments)}}(),ChainDB.prototype.getTips=function(){var _ref29=_asyncToGenerator(regeneratorRuntime.mark(function _callee25(){return regeneratorRuntime.wrap(function(_context25){for(;;)switch(_context25.prev=_context25.next){case 0:return _context25.abrupt("return",this.db.keys({gte:layout.p.min(),lte:layout.p.max(),parse:function(key){return layout.p.parse(key)}}));case 1:case"end":return _context25.stop()}},_callee25,this)}));return function(){return _ref29.apply(this,arguments)}}(),ChainDB.prototype.readCoin=function(){var _ref30=_asyncToGenerator(regeneratorRuntime.mark(function _callee26(prevout){var hash,index,key,state,cache,raw;return regeneratorRuntime.wrap(function(_context26){for(;;)switch(_context26.prev=_context26.next){case 0:if(!this.options.spv){_context26.next=2;break}return _context26.abrupt("return",null);case 2:if(hash=prevout.hash,index=prevout.index,key=prevout.toKey(),state=this.state,!(cache=this.coinCache.get(key))){_context26.next=8;break}return _context26.abrupt("return",CoinEntry.fromRaw(cache));case 8:return _context26.next=10,this.db.get(layout.c.build(hash,index));case 10:if(raw=_context26.sent){_context26.next=13;break}return _context26.abrupt("return",null);case 13:return state===this.state&&this.coinCache.set(key,raw),_context26.abrupt("return",CoinEntry.fromRaw(raw));case 15:case"end":return _context26.stop()}},_callee26,this)}));return function(_x18){return _ref30.apply(this,arguments)}}(),ChainDB.prototype.getCoin=function(){var _ref31=_asyncToGenerator(regeneratorRuntime.mark(function _callee27(hash,index){var prevout,coin;return regeneratorRuntime.wrap(function(_context27){for(;;)switch(_context27.prev=_context27.next){case 0:return prevout=new Outpoint(hash,index),_context27.next=3,this.readCoin(prevout);case 3:if(coin=_context27.sent){_context27.next=6;break}return _context27.abrupt("return",null);case 6:return _context27.abrupt("return",coin.toCoin(prevout));case 7:case"end":return _context27.stop()}},_callee27,this)}));return function(_x19,_x20){return _ref31.apply(this,arguments)}}(),ChainDB.prototype.hasCoins=function(){var _ref32=_asyncToGenerator(regeneratorRuntime.mark(function _callee28(tx){var i,key;return regeneratorRuntime.wrap(function(_context28){for(;;)switch(_context28.prev=_context28.next){case 0:i=0;case 1:if(!(i<tx.outputs.length)){_context28.next=10;break}return key=layout.c.build(tx.hash(),i),_context28.next=5,this.db.has(key);case 5:if(!_context28.sent){_context28.next=7;break}return _context28.abrupt("return",!0);case 7:i++,_context28.next=1;break;case 10:return _context28.abrupt("return",!1);case 11:case"end":return _context28.stop()}},_callee28,this)}));return function(_x21){return _ref32.apply(this,arguments)}}(),ChainDB.prototype.getCoinView=function(){var _ref33=_asyncToGenerator(regeneratorRuntime.mark(function _callee29(tx){var view,_iterator5,_isArray5,_i5,_ref35,prevout,coin;return regeneratorRuntime.wrap(function(_context29){for(;;)switch(_context29.prev=_context29.next){case 0:view=new CoinView,_iterator5=tx.inputs,_isArray5=Array.isArray(_iterator5),_i5=0,_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();case 2:if(!_isArray5){_context29.next=8;break}if(!(_i5>=_iterator5.length)){_context29.next=5;break}return _context29.abrupt("break",20);case 5:_ref35=_iterator5[_i5++],_context29.next=12;break;case 8:if(!(_i5=_iterator5.next()).done){_context29.next=11;break}return _context29.abrupt("break",20);case 11:_ref35=_i5.value;case 12:return prevout=_ref35.prevout,_context29.next=16,this.readCoin(prevout);case 16:(coin=_context29.sent)&&view.addEntry(prevout,coin);case 18:_context29.next=2;break;case 20:return _context29.abrupt("return",view);case 21:case"end":return _context29.stop()}},_callee29,this)}));return function(_x22){return _ref33.apply(this,arguments)}}(),ChainDB.prototype.getSpentView=function(){var _ref36=_asyncToGenerator(regeneratorRuntime.mark(function _callee30(tx){var view,_iterator6,_isArray6,_i6,_ref38,prevout,hash,index,meta,_tx,height;return regeneratorRuntime.wrap(function(_context30){for(;;)switch(_context30.prev=_context30.next){case 0:return _context30.next=2,this.getCoinView(tx);case 2:view=_context30.sent,_iterator6=tx.inputs,_isArray6=Array.isArray(_iterator6),_i6=0,_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();case 4:if(!_isArray6){_context30.next=10;break}if(!(_i6>=_iterator6.length)){_context30.next=7;break}return _context30.abrupt("break",28);case 7:_ref38=_iterator6[_i6++],_context30.next=14;break;case 10:if(!(_i6=_iterator6.next()).done){_context30.next=13;break}return _context30.abrupt("break",28);case 13:_ref38=_i6.value;case 14:if(prevout=_ref38.prevout,!view.hasEntry(prevout)){_context30.next=18;break}return _context30.abrupt("continue",26);case 18:return hash=prevout.hash,index=prevout.index,_context30.next=21,this.getMeta(hash);case 21:if(meta=_context30.sent){_context30.next=24;break}return _context30.abrupt("continue",26);case 24:_tx=meta.tx,height=meta.height,index<_tx.outputs.length&&view.addIndex(_tx,index,height);case 26:_context30.next=4;break;case 28:return _context30.abrupt("return",view);case 29:case"end":return _context30.stop()}},_callee30,this)}));return function(_x23){return _ref36.apply(this,arguments)}}(),ChainDB.prototype.getUndoCoins=function(){var _ref39=_asyncToGenerator(regeneratorRuntime.mark(function _callee31(hash){var data;return regeneratorRuntime.wrap(function(_context31){for(;;)switch(_context31.prev=_context31.next){case 0:return _context31.next=2,this.db.get(layout.u.build(hash));case 2:if(data=_context31.sent){_context31.next=5;break}return _context31.abrupt("return",new UndoCoins);case 5:return _context31.abrupt("return",UndoCoins.fromRaw(data));case 6:case"end":return _context31.stop()}},_callee31,this)}));return function(_x24){return _ref39.apply(this,arguments)}}(),ChainDB.prototype.getBlock=function(){var _ref40=_asyncToGenerator(regeneratorRuntime.mark(function _callee32(hash){var data;return regeneratorRuntime.wrap(function(_context32){for(;;)switch(_context32.prev=_context32.next){case 0:return _context32.next=2,this.getRawBlock(hash);case 2:if(data=_context32.sent){_context32.next=5;break}return _context32.abrupt("return",null);case 5:return _context32.abrupt("return",Block.fromRaw(data));case 6:case"end":return _context32.stop()}},_callee32,this)}));return function(_x25){return _ref40.apply(this,arguments)}}(),ChainDB.prototype.getRawBlock=function(){var _ref41=_asyncToGenerator(regeneratorRuntime.mark(function _callee33(block){var hash;return regeneratorRuntime.wrap(function(_context33){for(;;)switch(_context33.prev=_context33.next){case 0:if(!this.options.spv){_context33.next=2;break}return _context33.abrupt("return",null);case 2:return _context33.next=4,this.getHash(block);case 4:if(hash=_context33.sent){_context33.next=7;break}return _context33.abrupt("return",null);case 7:return _context33.abrupt("return",this.db.get(layout.b.build(hash)));case 8:case"end":return _context33.stop()}},_callee33,this)}));return function(_x26){return _ref41.apply(this,arguments)}}(),ChainDB.prototype.getBlockView=function(){var _ref42=_asyncToGenerator(regeneratorRuntime.mark(function _callee34(block){var view,undo,i,tx,j,input;return regeneratorRuntime.wrap(function(_context34){for(;;)switch(_context34.prev=_context34.next){case 0:return view=new CoinView,_context34.next=3,this.getUndoCoins(block.hash());case 3:if(!(undo=_context34.sent).isEmpty()){_context34.next=6;break}return _context34.abrupt("return",view);case 6:for(i=block.txs.length-1;i>0;i--)for(tx=block.txs[i],j=tx.inputs.length-1;j>=0;j--)input=tx.inputs[j],undo.apply(view,input.prevout);return assert(undo.isEmpty(),"Undo coins data inconsistency."),_context34.abrupt("return",view);case 9:case"end":return _context34.stop()}},_callee34,this)}));return function(_x27){return _ref42.apply(this,arguments)}}(),ChainDB.prototype.getMeta=function(){var _ref43=_asyncToGenerator(regeneratorRuntime.mark(function _callee35(hash){var data;return regeneratorRuntime.wrap(function(_context35){for(;;)switch(_context35.prev=_context35.next){case 0:if(this.options.indexTX){_context35.next=2;break}return _context35.abrupt("return",null);case 2:return _context35.next=4,this.db.get(layout.t.build(hash));case 4:if(data=_context35.sent){_context35.next=7;break}return _context35.abrupt("return",null);case 7:return _context35.abrupt("return",TXMeta.fromRaw(data));case 8:case"end":return _context35.stop()}},_callee35,this)}));return function(_x28){return _ref43.apply(this,arguments)}}(),ChainDB.prototype.getTX=function(){var _ref44=_asyncToGenerator(regeneratorRuntime.mark(function _callee36(hash){var meta;return regeneratorRuntime.wrap(function(_context36){for(;;)switch(_context36.prev=_context36.next){case 0:return _context36.next=2,this.getMeta(hash);case 2:if(meta=_context36.sent){_context36.next=5;break}return _context36.abrupt("return",null);case 5:return _context36.abrupt("return",meta.tx);case 6:case"end":return _context36.stop()}},_callee36,this)}));return function(_x29){return _ref44.apply(this,arguments)}}(),ChainDB.prototype.hasTX=function(){var _ref45=_asyncToGenerator(regeneratorRuntime.mark(function _callee37(hash){return regeneratorRuntime.wrap(function(_context37){for(;;)switch(_context37.prev=_context37.next){case 0:if(this.options.indexTX){_context37.next=2;break}return _context37.abrupt("return",!1);case 2:return _context37.abrupt("return",this.db.has(layout.t.build(hash)));case 3:case"end":return _context37.stop()}},_callee37,this)}));return function(_x30){return _ref45.apply(this,arguments)}}(),ChainDB.prototype.getCoinsByAddress=function(){var _ref46=_asyncToGenerator(regeneratorRuntime.mark(function _callee38(addrs){var coins,_iterator7,_isArray7,_i7,_ref47,addr,hash,keys,_iterator8,_isArray8,_i8,_ref49,_ref48,_hash,index,coin;return regeneratorRuntime.wrap(function(_context38){for(;;)switch(_context38.prev=_context38.next){case 0:if(this.options.indexAddress){_context38.next=2;break}return _context38.abrupt("return",[]);case 2:Array.isArray(addrs)||(addrs=[addrs]),coins=[],_iterator7=addrs,_isArray7=Array.isArray(_iterator7),_i7=0,_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();case 5:if(!_isArray7){_context38.next=11;break}if(!(_i7>=_iterator7.length)){_context38.next=8;break}return _context38.abrupt("break",43);case 8:_ref47=_iterator7[_i7++],_context38.next=15;break;case 11:if(!(_i7=_iterator7.next()).done){_context38.next=14;break}return _context38.abrupt("break",43);case 14:_ref47=_i7.value;case 15:return addr=_ref47,hash=Address.getHash(addr),_context38.next=19,this.db.keys({gte:layout.C.min(hash),lte:layout.C.max(hash),parse:function(key){var _layout$C$parse=layout.C.parse(key);return[_layout$C$parse[1],_layout$C$parse[2]]}});case 19:keys=_context38.sent,_iterator8=keys,_isArray8=Array.isArray(_iterator8),_i8=0,_iterator8=_isArray8?_iterator8:_iterator8[Symbol.iterator]();case 21:if(!_isArray8){_context38.next=27;break}if(!(_i8>=_iterator8.length)){_context38.next=24;break}return _context38.abrupt("break",41);case 24:_ref49=_iterator8[_i8++],_context38.next=31;break;case 27:if(!(_i8=_iterator8.next()).done){_context38.next=30;break}return _context38.abrupt("break",41);case 30:_ref49=_i8.value;case 31:return _hash=(_ref48=_ref49)[0],index=_ref48[1],_context38.next=36,this.getCoin(_hash,index);case 36:coin=_context38.sent,assert(coin),coins.push(coin);case 39:_context38.next=21;break;case 41:_context38.next=5;break;case 43:return _context38.abrupt("return",coins);case 44:case"end":return _context38.stop()}},_callee38,this)}));return function(_x31){return _ref46.apply(this,arguments)}}(),ChainDB.prototype.getHashesByAddress=function(){var _ref50=_asyncToGenerator(regeneratorRuntime.mark(function _callee39(addrs){var hashes,_iterator9,_isArray9,_i9,_ref51,addr,hash;return regeneratorRuntime.wrap(function(_context39){for(;;)switch(_context39.prev=_context39.next){case 0:if(this.options.indexTX&&this.options.indexAddress){_context39.next=2;break}return _context39.abrupt("return",[]);case 2:hashes=Object.create(null),_iterator9=addrs,_isArray9=Array.isArray(_iterator9),_i9=0,_iterator9=_isArray9?_iterator9:_iterator9[Symbol.iterator]();case 4:if(!_isArray9){_context39.next=10;break}if(!(_i9>=_iterator9.length)){_context39.next=7;break}return _context39.abrupt("break",20);case 7:_ref51=_iterator9[_i9++],_context39.next=14;break;case 10:if(!(_i9=_iterator9.next()).done){_context39.next=13;break}return _context39.abrupt("break",20);case 13:_ref51=_i9.value;case 14:return addr=_ref51,hash=Address.getHash(addr),_context39.next=18,this.db.keys({gte:layout.T.min(hash),lte:layout.T.max(hash),parse:function(key){var txid=layout.T.parse(key)[1];hashes[txid]=!0}});case 18:_context39.next=4;break;case 20:return _context39.abrupt("return",Object.keys(hashes));case 21:case"end":return _context39.stop()}},_callee39,this)}));return function(_x32){return _ref50.apply(this,arguments)}}(),ChainDB.prototype.getTXByAddress=function(){var _ref52=_asyncToGenerator(regeneratorRuntime.mark(function _callee40(addrs){var mtxs,out,_iterator10,_isArray10,_i10,_ref53,mtx;return regeneratorRuntime.wrap(function(_context40){for(;;)switch(_context40.prev=_context40.next){case 0:return _context40.next=2,this.getMetaByAddress(addrs);case 2:mtxs=_context40.sent,out=[],_iterator10=mtxs,_isArray10=Array.isArray(_iterator10),_i10=0,_iterator10=_isArray10?_iterator10:_iterator10[Symbol.iterator]();case 5:if(!_isArray10){_context40.next=11;break}if(!(_i10>=_iterator10.length)){_context40.next=8;break}return _context40.abrupt("break",19);case 8:_ref53=_iterator10[_i10++],_context40.next=15;break;case 11:if(!(_i10=_iterator10.next()).done){_context40.next=14;break}return _context40.abrupt("break",19);case 14:_ref53=_i10.value;case 15:mtx=_ref53,out.push(mtx.tx);case 17:_context40.next=5;break;case 19:return _context40.abrupt("return",out);case 20:case"end":return _context40.stop()}},_callee40,this)}));return function(_x33){return _ref52.apply(this,arguments)}}(),ChainDB.prototype.getMetaByAddress=function(){var _ref54=_asyncToGenerator(regeneratorRuntime.mark(function _callee41(addrs){var hashes,mtxs,_iterator11,_isArray11,_i11,_ref55,hash,mtx;return regeneratorRuntime.wrap(function(_context41){for(;;)switch(_context41.prev=_context41.next){case 0:if(this.options.indexTX&&this.options.indexAddress){_context41.next=2;break}return _context41.abrupt("return",[]);case 2:return Array.isArray(addrs)||(addrs=[addrs]),_context41.next=5,this.getHashesByAddress(addrs);case 5:hashes=_context41.sent,mtxs=[],_iterator11=hashes,_isArray11=Array.isArray(_iterator11),_i11=0,_iterator11=_isArray11?_iterator11:_iterator11[Symbol.iterator]();case 8:if(!_isArray11){_context41.next=14;break}if(!(_i11>=_iterator11.length)){_context41.next=11;break}return _context41.abrupt("break",26);case 11:_ref55=_iterator11[_i11++],_context41.next=18;break;case 14:if(!(_i11=_iterator11.next()).done){_context41.next=17;break}return _context41.abrupt("break",26);case 17:_ref55=_i11.value;case 18:return hash=_ref55,_context41.next=21,this.getMeta(hash);case 21:mtx=_context41.sent,assert(mtx),mtxs.push(mtx);case 24:_context41.next=8;break;case 26:return _context41.abrupt("return",mtxs);case 27:case"end":return _context41.stop()}},_callee41,this)}));return function(_x34){return _ref54.apply(this,arguments)}}(),ChainDB.prototype.scan=function(){var _ref56=_asyncToGenerator(regeneratorRuntime.mark(function _callee42(start,filter,iter){var entry,total,block,txs,i,tx,found,j,output,hash,prevout,_iterator12,_isArray12,_i12,_ref58,_prevout;return regeneratorRuntime.wrap(function(_context42){for(;;)switch(_context42.prev=_context42.next){case 0:return null==start&&(start=this.network.genesis.hash),"number"==typeof start?this.logger.info("Scanning from height %d.",start):this.logger.info("Scanning from block %s.",util.revHex(start)),_context42.next=4,this.getEntry(start);case 4:if(entry=_context42.sent){_context42.next=7;break}return _context42.abrupt("return");case 7:return _context42.next=9,this.isMainChain(entry);case 9:if(_context42.sent){_context42.next=11;break}throw new Error("Cannot rescan an alternate chain.");case 11:total=0;case 12:if(!entry){_context42.next=75;break}return _context42.next=15,this.getBlock(entry.hash);case 15:if(block=_context42.sent,txs=[],total+=1,block){_context42.next=27;break}if(this.options.spv||this.options.prune){_context42.next=21;break}throw new Error("Block not found.");case 21:return _context42.next=23,iter(entry,txs);case 23:return _context42.next=25,this.getNext(entry);case 25:return entry=_context42.sent,_context42.abrupt("continue",12);case 27:this.logger.info("Scanning block %s (%d).",entry.rhash(),entry.height),i=0;case 29:if(!(i<block.txs.length)){_context42.next=68;break}tx=block.txs[i],found=!1,j=0;case 33:if(!(j<tx.outputs.length)){_context42.next=42;break}if(output=tx.outputs[j],hash=output.getHash()){_context42.next=38;break}return _context42.abrupt("continue",39);case 38:filter.test(hash)&&(prevout=Outpoint.fromTX(tx,j),filter.add(prevout.toRaw()),found=!0);case 39:j++,_context42.next=33;break;case 42:if(!found){_context42.next=45;break}return txs.push(tx),_context42.abrupt("continue",65);case 45:if(0!==i){_context42.next=47;break}return _context42.abrupt("continue",65);case 47:_iterator12=tx.inputs,_isArray12=Array.isArray(_iterator12),_i12=0,_iterator12=_isArray12?_iterator12:_iterator12[Symbol.iterator]();case 48:if(!_isArray12){_context42.next=54;break}if(!(_i12>=_iterator12.length)){_context42.next=51;break}return _context42.abrupt("break",65);case 51:_ref58=_iterator12[_i12++],_context42.next=58;break;case 54:if(!(_i12=_iterator12.next()).done){_context42.next=57;break}return _context42.abrupt("break",65);case 57:_ref58=_i12.value;case 58:if(_prevout=_ref58.prevout,!filter.test(_prevout.toRaw())){_context42.next=63;break}return txs.push(tx),_context42.abrupt("break",65);case 63:_context42.next=48;break;case 65:i++,_context42.next=29;break;case 68:return _context42.next=70,iter(entry,txs);case 70:return _context42.next=72,this.getNext(entry);case 72:entry=_context42.sent,_context42.next=12;break;case 75:this.logger.info("Finished scanning %d blocks.",total);case 76:case"end":return _context42.stop()}},_callee42,this)}));return function(_x35,_x36,_x37){return _ref56.apply(this,arguments)}}(),ChainDB.prototype.save=function(){var _ref59=_asyncToGenerator(regeneratorRuntime.mark(function _callee43(entry,block,view){return regeneratorRuntime.wrap(function(_context43){for(;;)switch(_context43.prev=_context43.next){case 0:return this.start(),_context43.prev=1,_context43.next=4,this._save(entry,block,view);case 4:_context43.next=10;break;case 6:throw _context43.prev=6,_context43.t0=_context43.catch(1),this.drop(),_context43.t0;case 10:return _context43.next=12,this.commit();case 12:case"end":return _context43.stop()}},_callee43,this,[[1,6]])}));return function(_x38,_x39,_x40){return _ref59.apply(this,arguments)}}(),ChainDB.prototype._save=function(){var _ref60=_asyncToGenerator(regeneratorRuntime.mark(function _callee44(entry,block,view){var hash;return regeneratorRuntime.wrap(function(_context44){for(;;)switch(_context44.prev=_context44.next){case 0:if(hash=block.hash(),this.put(layout.h.build(hash),fromU32(entry.height)),this.put(layout.e.build(hash),entry.toRaw()),this.cacheHash.push(entry.hash,entry),this.del(layout.p.build(entry.prevBlock)),this.put(layout.p.build(hash),null),this.saveUpdates(),view){_context44.next=11;break}return _context44.next=10,this.saveBlock(entry,block);case 10:return _context44.abrupt("return");case 11:return entry.isGenesis()||this.put(layout.n.build(entry.prevBlock),hash),this.put(layout.H.build(entry.height),hash),this.cacheHeight.push(entry.height,entry),_context44.next=16,this.saveBlock(entry,block,view);case 16:this.put(layout.R.build(),this.pending.commit(hash));case 17:case"end":return _context44.stop()}},_callee44,this)}));return function(_x41,_x42,_x43){return _ref60.apply(this,arguments)}}(),ChainDB.prototype.reconnect=function(){var _ref61=_asyncToGenerator(regeneratorRuntime.mark(function _callee45(entry,block,view){return regeneratorRuntime.wrap(function(_context45){for(;;)switch(_context45.prev=_context45.next){case 0:return this.start(),_context45.prev=1,_context45.next=4,this._reconnect(entry,block,view);case 4:_context45.next=10;break;case 6:throw _context45.prev=6,_context45.t0=_context45.catch(1),this.drop(),_context45.t0;case 10:return _context45.next=12,this.commit();case 12:case"end":return _context45.stop()}},_callee45,this,[[1,6]])}));return function(_x44,_x45,_x46){return _ref61.apply(this,arguments)}}(),ChainDB.prototype._reconnect=function(){var _ref62=_asyncToGenerator(regeneratorRuntime.mark(function _callee46(entry,block,view){var hash;return regeneratorRuntime.wrap(function(_context46){for(;;)switch(_context46.prev=_context46.next){case 0:return hash=block.hash(),assert(!entry.isGenesis()),this.put(layout.n.build(entry.prevBlock),hash),this.put(layout.H.build(entry.height),hash),this.cacheHeight.push(entry.height,entry),this.cacheHash.push(entry.hash,entry),this.saveUpdates(),_context46.next=9,this.connectBlock(entry,block,view);case 9:this.put(layout.R.build(),this.pending.commit(hash));case 10:case"end":return _context46.stop()}},_callee46,this)}));return function(_x47,_x48,_x49){return _ref62.apply(this,arguments)}}(),ChainDB.prototype.disconnect=function(){var _ref63=_asyncToGenerator(regeneratorRuntime.mark(function _callee47(entry,block){var view;return regeneratorRuntime.wrap(function(_context47){for(;;)switch(_context47.prev=_context47.next){case 0:return this.start(),view=void 0,_context47.prev=2,_context47.next=5,this._disconnect(entry,block);case 5:view=_context47.sent,_context47.next=12;break;case 8:throw _context47.prev=8,_context47.t0=_context47.catch(2),this.drop(),_context47.t0;case 12:return _context47.next=14,this.commit();case 14:return _context47.abrupt("return",view);case 15:case"end":return _context47.stop()}},_callee47,this,[[2,8]])}));return function(_x50,_x51){return _ref63.apply(this,arguments)}}(),ChainDB.prototype._disconnect=function(){var _ref64=_asyncToGenerator(regeneratorRuntime.mark(function _callee48(entry,block){var view;return regeneratorRuntime.wrap(function(_context48){for(;;)switch(_context48.prev=_context48.next){case 0:return this.del(layout.n.build(entry.prevBlock)),this.del(layout.H.build(entry.height)),this.cacheHeight.unpush(entry.height),this.saveUpdates(),_context48.next=6,this.disconnectBlock(entry,block);case 6:return view=_context48.sent,this.put(layout.R.build(),this.pending.commit(entry.prevBlock)),_context48.abrupt("return",view);case 9:case"end":return _context48.stop()}},_callee48,this)}));return function(_x52,_x53){return _ref64.apply(this,arguments)}}(),ChainDB.prototype.saveUpdates=function(){var updates=this.stateCache.updates;if(0!==updates.length){this.logger.info("Saving %d state cache updates.",updates.length);var _iterator13=updates,_isArray13=Array.isArray(_iterator13),_i13=0;for(_iterator13=_isArray13?_iterator13:_iterator13[Symbol.iterator]();;){var _ref65;if(_isArray13){if(_i13>=_iterator13.length)break;_ref65=_iterator13[_i13++]}else{if((_i13=_iterator13.next()).done)break;_ref65=_i13.value}var update=_ref65,bit=update.bit,hash=update.hash;this.put(layout.v.build(bit,hash),update.toRaw())}}},ChainDB.prototype.reset=function(){var _ref66=_asyncToGenerator(regeneratorRuntime.mark(function _callee49(block){var entry,tip;return regeneratorRuntime.wrap(function(_context49){for(;;)switch(_context49.prev=_context49.next){case 0:return _context49.next=2,this.getEntry(block);case 2:if(entry=_context49.sent){_context49.next=5;break}throw new Error("Block not found.");case 5:return _context49.next=7,this.isMainChain(entry);case 7:if(_context49.sent){_context49.next=9;break}throw new Error("Cannot reset on alternate chain.");case 9:if(!this.options.prune){_context49.next=11;break}throw new Error("Cannot reset when pruned.");case 11:return _context49.next=13,this.removeChains();case 13:return _context49.next=15,this.getTip();case 15:tip=_context49.sent,assert(tip),this.logger.debug("Resetting main chain to: %s",entry.rhash());case 18:if(this.start(),tip.hash!==entry.hash){_context49.next=24;break}return this.put(layout.R.build(),this.pending.commit(tip.hash)),_context49.next=23,this.commit();case 23:return _context49.abrupt("break",51);case 24:return assert(!tip.isGenesis()),this.del(layout.p.build(tip.hash)),this.put(layout.p.build(tip.prevBlock),null),this.del(layout.H.build(tip.height)),this.del(layout.h.build(tip.hash)),this.del(layout.e.build(tip.hash)),this.del(layout.n.build(tip.prevBlock)),_context49.prev=31,_context49.next=34,this.removeBlock(tip);case 34:_context49.next=40;break;case 36:throw _context49.prev=36,_context49.t0=_context49.catch(31),this.drop(),_context49.t0;case 40:return this.put(layout.R.build(),this.pending.commit(tip.prevBlock)),_context49.next=43,this.commit();case 43:return this.cacheHeight.remove(tip.height),this.cacheHash.remove(tip.hash),_context49.next=47,this.getPrevious(tip);case 47:tip=_context49.sent,assert(tip);case 49:_context49.next=18;break;case 51:return _context49.abrupt("return",tip);case 52:case"end":return _context49.stop()}},_callee49,this,[[31,36]])}));return function(_x54){return _ref66.apply(this,arguments)}}(),ChainDB.prototype.removeChains=function(){var _ref67=_asyncToGenerator(regeneratorRuntime.mark(function _callee50(){var tips,_iterator14,_isArray14,_i14,_ref68,tip;return regeneratorRuntime.wrap(function(_context50){for(;;)switch(_context50.prev=_context50.next){case 0:return _context50.next=2,this.getTips();case 2:tips=_context50.sent,this.start(),_context50.prev=4,_iterator14=tips,_isArray14=Array.isArray(_iterator14),_i14=0,_iterator14=_isArray14?_iterator14:_iterator14[Symbol.iterator]();case 6:if(!_isArray14){_context50.next=12;break}if(!(_i14>=_iterator14.length)){_context50.next=9;break}return _context50.abrupt("break",21);case 9:_ref68=_iterator14[_i14++],_context50.next=16;break;case 12:if(!(_i14=_iterator14.next()).done){_context50.next=15;break}return _context50.abrupt("break",21);case 15:_ref68=_i14.value;case 16:return tip=_ref68,_context50.next=19,this._removeChain(tip);case 19:_context50.next=6;break;case 21:_context50.next=27;break;case 23:throw _context50.prev=23,_context50.t0=_context50.catch(4),this.drop(),_context50.t0;case 27:return _context50.next=29,this.commit();case 29:case"end":return _context50.stop()}},_callee50,this,[[4,23]])}));return function(){return _ref67.apply(this,arguments)}}(),ChainDB.prototype._removeChain=function(){var _ref69=_asyncToGenerator(regeneratorRuntime.mark(function _callee51(hash){var tip;return regeneratorRuntime.wrap(function(_context51){for(;;)switch(_context51.prev=_context51.next){case 0:return _context51.next=2,this.getEntryByHash(hash);case 2:if(tip=_context51.sent){_context51.next=5;break}throw new Error("Alternate chain tip not found.");case 5:this.logger.debug("Removing alternate chain: %s.",tip.rhash());case 6:return _context51.next=8,this.isMainChain(tip);case 8:if(!_context51.sent){_context51.next=10;break}return _context51.abrupt("break",22);case 10:return assert(!tip.isGenesis()),this.del(layout.p.build(tip.hash)),this.del(layout.h.build(tip.hash)),this.del(layout.e.build(tip.hash)),this.del(layout.b.build(tip.hash)),this.cacheHash.unpush(tip.hash),_context51.next=18,this.getPrevious(tip);case 18:tip=_context51.sent,assert(tip);case 20:_context51.next=6;break;case 22:case"end":return _context51.stop()}},_callee51,this)}));return function(_x55){return _ref69.apply(this,arguments)}}(),ChainDB.prototype.saveBlock=function(){var _ref70=_asyncToGenerator(regeneratorRuntime.mark(function _callee52(entry,block,view){var hash;return regeneratorRuntime.wrap(function(_context52){for(;;)switch(_context52.prev=_context52.next){case 0:if(hash=block.hash(),!this.options.spv){_context52.next=3;break}return _context52.abrupt("return");case 3:if(this.put(layout.b.build(hash),block.toRaw()),view){_context52.next=6;break}return _context52.abrupt("return");case 6:return _context52.next=8,this.connectBlock(entry,block,view);case 8:case"end":return _context52.stop()}},_callee52,this)}));return function(_x56,_x57,_x58){return _ref70.apply(this,arguments)}}(),ChainDB.prototype.removeBlock=function(){var _ref71=_asyncToGenerator(regeneratorRuntime.mark(function _callee53(entry){var block;return regeneratorRuntime.wrap(function(_context53){for(;;)switch(_context53.prev=_context53.next){case 0:if(!this.options.spv){_context53.next=2;break}return _context53.abrupt("return",new CoinView);case 2:return _context53.next=4,this.getBlock(entry.hash);case 4:if(block=_context53.sent){_context53.next=7;break}throw new Error("Block not found.");case 7:return this.del(layout.b.build(block.hash())),_context53.abrupt("return",this.disconnectBlock(entry,block));case 9:case"end":return _context53.stop()}},_callee53,this)}));return function(_x59){return _ref71.apply(this,arguments)}}(),ChainDB.prototype.saveView=function(view){var _iterator15=view.map,_isArray15=Array.isArray(_iterator15),_i15=0;for(_iterator15=_isArray15?_iterator15:_iterator15[Symbol.iterator]();;){var _ref73;if(_isArray15){if(_i15>=_iterator15.length)break;_ref73=_iterator15[_i15++]}else{if((_i15=_iterator15.next()).done)break;_ref73=_i15.value}var _ref72=_ref73,hash=_ref72[0],_iterator16=_ref72[1].outputs,_isArray16=Array.isArray(_iterator16),_i16=0;for(_iterator16=_isArray16?_iterator16:_iterator16[Symbol.iterator]();;){var _ref75;if(_isArray16){if(_i16>=_iterator16.length)break;_ref75=_iterator16[_i16++]}else{if((_i16=_iterator16.next()).done)break;_ref75=_i16.value}var _ref74=_ref75,index=_ref74[0],coin=_ref74[1];if(coin.spent)this.del(layout.c.build(hash,index)),this.coinCache.unpush(hash+index);else{var raw=coin.toRaw();this.put(layout.c.build(hash,index),raw),this.coinCache.push(hash+index,raw)}}}},ChainDB.prototype.connectBlock=function(){var _ref76=_asyncToGenerator(regeneratorRuntime.mark(function _callee54(entry,block,view){var hash,i,tx,_iterator17,_isArray17,_i17,_ref78,prevout,_iterator18,_isArray18,_i18,_ref79,output;return regeneratorRuntime.wrap(function(_context54){for(;;)switch(_context54.prev=_context54.next){case 0:if(!this.options.spv){_context54.next=2;break}return _context54.abrupt("return",void 0);case 2:if(hash=block.hash(),this.pending.connect(block),!entry.isGenesis()){_context54.next=6;break}return _context54.abrupt("return",void 0);case 6:i=0;case 7:if(!(i<block.txs.length)){_context54.next=47;break}if(tx=block.txs[i],!(i>0)){_context54.next=26;break}_iterator17=tx.inputs,_isArray17=Array.isArray(_iterator17),_i17=0,_iterator17=_isArray17?_iterator17:_iterator17[Symbol.iterator]();case 11:if(!_isArray17){_context54.next=17;break}if(!(_i17>=_iterator17.length)){_context54.next=14;break}return _context54.abrupt("break",26);case 14:_ref78=_iterator17[_i17++],_context54.next=21;break;case 17:if(!(_i17=_iterator17.next()).done){_context54.next=20;break}return _context54.abrupt("break",26);case 20:_ref78=_i17.value;case 21:prevout=_ref78.prevout,this.pending.spend(view.getOutput(prevout));case 24:_context54.next=11;break;case 26:_iterator18=tx.outputs,_isArray18=Array.isArray(_iterator18),_i18=0,_iterator18=_isArray18?_iterator18:_iterator18[Symbol.iterator]();case 27:if(!_isArray18){_context54.next=33;break}if(!(_i18>=_iterator18.length)){_context54.next=30;break}return _context54.abrupt("break",43);case 30:_ref79=_iterator18[_i18++],_context54.next=37;break;case 33:if(!(_i18=_iterator18.next()).done){_context54.next=36;break}return _context54.abrupt("break",43);case 36:_ref79=_i18.value;case 37:if(!(output=_ref79).script.isUnspendable()){_context54.next=40;break}return _context54.abrupt("continue",41);case 40:this.pending.add(output);case 41:_context54.next=27;break;case 43:this.indexTX(tx,view,entry,i);case 44:i++,_context54.next=7;break;case 47:return this.saveView(view),view.undo.isEmpty()||this.put(layout.u.build(hash),view.undo.commit()),_context54.abrupt("return",this.pruneBlock(entry));case 50:case"end":return _context54.stop()}},_callee54,this)}));return function(_x60,_x61,_x62){return _ref76.apply(this,arguments)}}(),ChainDB.prototype.disconnectBlock=function(){var _ref80=_asyncToGenerator(regeneratorRuntime.mark(function _callee55(entry,block){var view,hash,undo,i,tx,j,prevout,_j,output;return regeneratorRuntime.wrap(function(_context55){for(;;)switch(_context55.prev=_context55.next){case 0:if(view=new CoinView,!this.options.spv){_context55.next=3;break}return _context55.abrupt("return",view);case 3:return hash=block.hash(),_context55.next=6,this.getUndoCoins(hash);case 6:undo=_context55.sent,this.pending.disconnect(block),i=block.txs.length-1;case 9:if(!(i>=0)){_context55.next=26;break}if(tx=block.txs[i],i>0)for(j=tx.inputs.length-1;j>=0;j--)prevout=tx.inputs[j].prevout,undo.apply(view,prevout),this.pending.add(view.getOutput(prevout));view.removeTX(tx,entry.height),_j=tx.outputs.length-1;case 14:if(!(_j>=0)){_context55.next=22;break}if(!(output=tx.outputs[_j]).script.isUnspendable()){_context55.next=18;break}return _context55.abrupt("continue",19);case 18:this.pending.spend(output);case 19:_j--,_context55.next=14;break;case 22:this.unindexTX(tx,view);case 23:i--,_context55.next=9;break;case 26:return assert(undo.isEmpty(),"Undo coins data inconsistency."),this.saveView(view),this.del(layout.u.build(hash)),_context55.abrupt("return",view);case 30:case"end":return _context55.stop()}},_callee55,this)}));return function(_x63,_x64){return _ref80.apply(this,arguments)}}(),ChainDB.prototype.pruneBlock=function(){var _ref81=_asyncToGenerator(regeneratorRuntime.mark(function _callee56(entry){var height,hash;return regeneratorRuntime.wrap(function(_context56){for(;;)switch(_context56.prev=_context56.next){case 0:if(!this.options.spv){_context56.next=2;break}return _context56.abrupt("return");case 2:if(this.options.prune){_context56.next=4;break}return _context56.abrupt("return");case 4:if(!((height=entry.height-this.network.block.keepBlocks)<=this.network.block.pruneAfterHeight)){_context56.next=7;break}return _context56.abrupt("return");case 7:return _context56.next=9,this.getHash(height);case 9:if(hash=_context56.sent){_context56.next=12;break}return _context56.abrupt("return");case 12:this.del(layout.b.build(hash)),this.del(layout.u.build(hash));case 14:case"end":return _context56.stop()}},_callee56,this)}));return function(_x65){return _ref81.apply(this,arguments)}}(),ChainDB.prototype.saveFlags=function(){var flags=ChainFlags.fromOptions(this.options),b=this.db.batch();return b.put(layout.O.build(),flags.toRaw()),b.write()},ChainDB.prototype.indexTX=function(tx,view,entry,index){var hash=tx.hash();if(this.options.indexTX){var meta=TXMeta.fromTX(tx,entry,index);if(this.put(layout.t.build(hash),meta.toRaw()),this.options.indexAddress){var _iterator19=tx.getHashes(view),_isArray19=Array.isArray(_iterator19),_i19=0;for(_iterator19=_isArray19?_iterator19:_iterator19[Symbol.iterator]();;){var _ref82;if(_isArray19){if(_i19>=_iterator19.length)break;_ref82=_iterator19[_i19++]}else{if((_i19=_iterator19.next()).done)break;_ref82=_i19.value}var addr=_ref82;this.put(layout.T.build(addr,hash),null)}}}if(this.options.indexAddress){if(!tx.isCoinbase()){var _iterator20=tx.inputs,_isArray20=Array.isArray(_iterator20),_i20=0;for(_iterator20=_isArray20?_iterator20:_iterator20[Symbol.iterator]();;){var _ref84;if(_isArray20){if(_i20>=_iterator20.length)break;_ref84=_iterator20[_i20++]}else{if((_i20=_iterator20.next()).done)break;_ref84=_i20.value}var prevout=_ref84.prevout,_hash2=prevout.hash,_index=prevout.index,coin=view.getOutput(prevout);assert(coin);var _addr=coin.getHash();_addr&&this.del(layout.C.build(_addr,_hash2,_index))}}for(var i=0;i<tx.outputs.length;i++){var _addr2=tx.outputs[i].getHash();_addr2&&this.put(layout.C.build(_addr2,hash,i),null)}}},ChainDB.prototype.unindexTX=function(tx,view){var hash=tx.hash();if(this.options.indexTX&&(this.del(layout.t.build(hash)),this.options.indexAddress)){var _iterator21=tx.getHashes(view),_isArray21=Array.isArray(_iterator21),_i21=0;for(_iterator21=_isArray21?_iterator21:_iterator21[Symbol.iterator]();;){var _ref85;if(_isArray21){if(_i21>=_iterator21.length)break;_ref85=_iterator21[_i21++]}else{if((_i21=_iterator21.next()).done)break;_ref85=_i21.value}var addr=_ref85;this.del(layout.T.build(addr,hash))}}if(this.options.indexAddress){if(!tx.isCoinbase()){var _iterator22=tx.inputs,_isArray22=Array.isArray(_iterator22),_i22=0;for(_iterator22=_isArray22?_iterator22:_iterator22[Symbol.iterator]();;){var _ref87;if(_isArray22){if(_i22>=_iterator22.length)break;_ref87=_iterator22[_i22++]}else{if((_i22=_iterator22.next()).done)break;_ref87=_i22.value}var prevout=_ref87.prevout,_hash3=prevout.hash,index=prevout.index,coin=view.getOutput(prevout);assert(coin);var _addr3=coin.getHash();_addr3&&this.put(layout.C.build(_addr3,_hash3,index),null)}}for(var i=0;i<tx.outputs.length;i++){var _addr4=tx.outputs[i].getHash();_addr4&&this.del(layout.C.build(_addr4,hash,i))}}},ChainDB}(),ChainFlags=function(){function ChainFlags(options){_classCallCheck(this,ChainFlags),this.network=Network.primary,this.spv=!1,this.UAHF=!0,this.prune=!1,this.indexTX=!1,this.indexAddress=!1,options&&this.fromOptions(options)}return ChainFlags.prototype.fromOptions=function(options){return this.network=Network.get(options.network),null!=options.spv&&(assert("boolean"==typeof options.spv),this.spv=options.spv),null!=options.UAHF&&(assert("boolean"==typeof options.UAHF),this.UAHF=options.UAHF),null!=options.prune&&(assert("boolean"==typeof options.prune),this.prune=options.prune),null!=options.indexTX&&(assert("boolean"==typeof options.indexTX),this.indexTX=options.indexTX),null!=options.indexAddress&&(assert("boolean"==typeof options.indexAddress),this.indexAddress=options.indexAddress),this},ChainFlags.fromOptions=function(data){return(new ChainFlags).fromOptions(data)},ChainFlags.prototype.toRaw=function(){var bw=bio.write(12),flags=0;return this.spv&&(flags|=1),this.prune&&(flags|=4),this.indexTX&&(flags|=8),this.indexAddress&&(flags|=16),this.UAHF&&(flags|=65536),bw.writeU32(this.network.magic),bw.writeU32(flags),bw.writeU32(0),bw.render()},ChainFlags.prototype.fromRaw=function(data){var br=bio.read(data);this.network=Network.fromMagic(br.readU32());var flags=br.readU32();return this.spv=0!=(1&flags),this.prune=0!=(4&flags),this.indexTX=0!=(8&flags),this.indexAddress=0!=(16&flags),this.UAHF=0!=(65536&flags),this},ChainFlags.fromRaw=function(data){return(new ChainFlags).fromRaw(data)},ChainFlags}(),ChainState=function(){function ChainState(){_classCallCheck(this,ChainState),this.tip=consensus.NULL_HASH,this.tx=0,this.coin=0,this.value=0,this.committed=!1}return ChainState.prototype.rhash=function(){return util.revHex(this.tip)},ChainState.prototype.clone=function(){var state=new ChainState;return state.tip=this.tip,state.tx=this.tx,state.coin=this.coin,state.value=this.value,state},ChainState.prototype.connect=function(block){this.tx+=block.txs.length},ChainState.prototype.disconnect=function(block){this.tx-=block.txs.length},ChainState.prototype.add=function(coin){this.coin+=1,this.value+=coin.value},ChainState.prototype.spend=function(coin){this.coin-=1,this.value-=coin.value},ChainState.prototype.commit=function(hash){return"string"!=typeof hash&&(hash=hash.toString("hex")),this.tip=hash,this.committed=!0,this.toRaw()},ChainState.prototype.toRaw=function(){var bw=bio.write(56);return bw.writeHash(this.tip),bw.writeU64(this.tx),bw.writeU64(this.coin),bw.writeU64(this.value),bw.render()},ChainState.fromRaw=function(data){var state=new ChainState,br=bio.read(data);return state.tip=br.readHash("hex"),state.tx=br.readU64(),state.coin=br.readU64(),state.value=br.readU64(),state},ChainState}(),StateCache=function(){function StateCache(network){_classCallCheck(this,StateCache),this.network=network,this.bits=[],this.updates=[],this.init()}return StateCache.prototype.init=function(){for(var i=0;i<32;i++)this.bits.push(null);var _iterator23=this.network.deploys,_isArray23=Array.isArray(_iterator23),_i23=0;for(_iterator23=_isArray23?_iterator23:_iterator23[Symbol.iterator]();;){var _ref89;if(_isArray23){if(_i23>=_iterator23.length)break;_ref89=_iterator23[_i23++]}else{if((_i23=_iterator23.next()).done)break;_ref89=_i23.value}var bit=_ref89.bit;assert(!this.bits[bit]),this.bits[bit]=new Map}},StateCache.prototype.set=function(bit,entry,state){var cache=this.bits[bit];assert(cache),cache.get(entry.hash)!==state&&(cache.set(entry.hash,state),this.updates.push(new CacheUpdate(bit,entry.hash,state)))},StateCache.prototype.get=function(bit,entry){var cache=this.bits[bit];assert(cache);var state=cache.get(entry.hash);return null==state?-1:state},StateCache.prototype.commit=function(){this.updates.length=0},StateCache.prototype.drop=function(){var _iterator24=this.updates,_isArray24=Array.isArray(_iterator24),_i24=0;for(_iterator24=_isArray24?_iterator24:_iterator24[Symbol.iterator]();;){var _ref91;if(_isArray24){if(_i24>=_iterator24.length)break;_ref91=_iterator24[_i24++]}else{if((_i24=_iterator24.next()).done)break;_ref91=_i24.value}var _ref90=_ref91,bit=_ref90.bit,hash=_ref90.hash,cache=this.bits[bit];assert(cache),cache.delete(hash)}this.updates.length=0},StateCache.prototype.insert=function(bit,hash,state){var cache=this.bits[bit];assert(cache),cache.set(hash,state)},StateCache}(),CacheUpdate=function(){function CacheUpdate(bit,hash,state){_classCallCheck(this,CacheUpdate),this.bit=bit,this.hash=hash,this.state=state}return CacheUpdate.prototype.toRaw=function(){var data=Buffer.allocUnsafe(1);return data[0]=this.state,data},CacheUpdate}();function getSize(value){return value.length+80}function fromU32(num){var data=Buffer.allocUnsafe(4);return data.writeUInt32LE(num,0,!0),data}module.exports=ChainDB}).call(this,require("buffer").Buffer)},{"../btc/amount":8,"../coins/coinentry":11,"../coins/coinview":13,"../coins/undocoins":16,"../primitives/address":69,"../primitives/block":70,"../primitives/outpoint":80,"../primitives/txmeta":83,"../protocol/consensus":84,"../protocol/network":87,"../utils/lru":105,"../utils/util":106,"./chainentry":4,"./layout":7,assert:146,bdb:191,buffer:269,bufio:270}],4:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),bio=require("bufio"),BN=require("bn.js"),consensus=require("../protocol/consensus"),hash256=require("bcrypto/lib/hash256"),util=require("../utils/util"),Headers=require("../primitives/headers"),InvItem=require("../primitives/invitem"),ZERO=new BN(0),ChainEntry=function(){function ChainEntry(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ChainEntry),this.hash=consensus.NULL_HASH,this.version=1,this.prevBlock=consensus.NULL_HASH,this.merkleRoot=consensus.NULL_HASH,this.time=0,this.bits=0,this.nonce=0,this.height=0,this.chainwork=ZERO,options&&this.fromOptions(options)}return ChainEntry.prototype.fromOptions=function(options){return assert(options,"Block data is required."),assert("string"==typeof options.hash),assert(options.version>>>0===options.version),assert("string"==typeof options.prevBlock),assert("string"==typeof options.merkleRoot),assert(options.time>>>0===options.time),assert(options.bits>>>0===options.bits),assert(options.nonce>>>0===options.nonce),assert(options.height>>>0===options.height),assert(!options.chainwork||BN.isBN(options.chainwork)),this.hash=options.hash,this.version=options.version,this.prevBlock=options.prevBlock,this.merkleRoot=options.merkleRoot,this.time=options.time,this.bits=options.bits,this.nonce=options.nonce,this.height=options.height,this.chainwork=options.chainwork||ZERO,this},ChainEntry.fromOptions=function(options,prev){return(new this).fromOptions(options,prev)},ChainEntry.prototype.getProof=function(){var target=consensus.fromCompact(this.bits);return target.isNeg()||target.isZero()?new BN(0):ChainEntry.MAX_CHAINWORK.div(target.iaddn(1))},ChainEntry.prototype.getChainwork=function(prev){var proof=this.getProof();return prev?proof.iadd(prev.chainwork):proof},ChainEntry.prototype.isGenesis=function(){return 0===this.height},ChainEntry.prototype.hasUnknown=function(network){var TOP_MASK=consensus.VERSION_TOP_MASK,TOP_BITS=consensus.VERSION_TOP_BITS;return(this.version&TOP_MASK)>>>0===TOP_BITS&&0!=(this.version&network.unknownBits)},ChainEntry.prototype.hasBit=function(bit){return consensus.hasBit(this.version,bit)},ChainEntry.prototype.rhash=function(){return util.revHex(this.hash)},ChainEntry.prototype.fromBlock=function(block,prev){return this.hash=block.hash("hex"),this.version=block.version,this.prevBlock=block.prevBlock,this.merkleRoot=block.merkleRoot,this.time=block.time,this.bits=block.bits,this.nonce=block.nonce,this.height=prev?prev.height+1:0,this.chainwork=this.getChainwork(prev),this},ChainEntry.fromBlock=function(block,prev){return(new this).fromBlock(block,prev)},ChainEntry.prototype.toRaw=function(){var bw=bio.write(116);return bw.writeU32(this.version),bw.writeHash(this.prevBlock),bw.writeHash(this.merkleRoot),bw.writeU32(this.time),bw.writeU32(this.bits),bw.writeU32(this.nonce),bw.writeU32(this.height),bw.writeBytes(this.chainwork.toArrayLike(Buffer,"le",32)),bw.render()},ChainEntry.prototype.fromRaw=function(data){var br=bio.read(data,!0),hash=hash256.digest(br.readBytes(80));return br.seek(-80),this.hash=hash.toString("hex"),this.version=br.readU32(),this.prevBlock=br.readHash("hex"),this.merkleRoot=br.readHash("hex"),this.time=br.readU32(),this.bits=br.readU32(),this.nonce=br.readU32(),this.height=br.readU32(),this.chainwork=new BN(br.readBytes(32),"le"),this},ChainEntry.fromRaw=function(data){return(new this).fromRaw(data)},ChainEntry.prototype.toJSON=function(){return{hash:util.revHex(this.hash),version:this.version,prevBlock:util.revHex(this.prevBlock),merkleRoot:util.revHex(this.merkleRoot),time:this.time,bits:this.bits,nonce:this.nonce,height:this.height,chainwork:this.chainwork.toString("hex",64)}},ChainEntry.prototype.fromJSON=function(json){return assert(json,"Block data is required."),assert("string"==typeof json.hash),assert(json.version>>>0===json.version),assert("string"==typeof json.prevBlock),assert("string"==typeof json.merkleRoot),assert(json.time>>>0===json.time),assert(json.bits>>>0===json.bits),assert(json.nonce>>>0===json.nonce),assert("string"==typeof json.chainwork),this.hash=util.revHex(json.hash),this.version=json.version,this.prevBlock=util.revHex(json.prevBlock),this.merkleRoot=util.revHex(json.merkleRoot),this.time=json.time,this.bits=json.bits,this.nonce=json.nonce,this.height=json.height,this.chainwork=new BN(json.chainwork,"hex"),this},ChainEntry.fromJSON=function(json){return(new this).fromJSON(json)},ChainEntry.prototype.toHeaders=function(){return Headers.fromEntry(this)},ChainEntry.prototype.toInv=function(){return new InvItem(InvItem.types.BLOCK,this.hash)},ChainEntry.prototype.inspect=function(){var json=this.toJSON();return json.version=json.version.toString(16),json},ChainEntry.isChainEntry=function(obj){return obj instanceof ChainEntry},ChainEntry}();ChainEntry.MAX_CHAINWORK=new BN(1).ushln(256),module.exports=ChainEntry}).call(this,require("buffer").Buffer)},{"../primitives/headers":72,"../primitives/invitem":75,"../protocol/consensus":84,"../utils/util":106,assert:146,"bcrypto/lib/hash256":160,"bn.js":217,buffer:269,bufio:270}],5:[function(require,module,exports){"use strict";exports.lockFlags={VERIFY_SEQUENCE:1,MEDIAN_TIME_PAST:2},exports.lockFlags.MANDATORY_LOCKTIME_FLAGS=0,exports.lockFlags.STANDARD_LOCKTIME_FLAGS=0|exports.lockFlags.VERIFY_SEQUENCE|exports.lockFlags.MEDIAN_TIME_PAST,exports.thresholdStates={DEFINED:0,STARTED:1,LOCKED_IN:2,ACTIVE:3,FAILED:4},exports.flags={VERIFY_NONE:0,VERIFY_POW:1,VERIFY_BODY:2},exports.flags.DEFAULT_FLAGS=0|exports.flags.VERIFY_POW|exports.flags.VERIFY_BODY},{}],6:[function(require,module,exports){"use strict";exports.ChainDB=require("./chaindb"),exports.ChainEntry=require("./chainentry"),exports.Chain=require("./chain"),exports.common=require("./common"),exports.layout=require("./layout")},{"./chain":2,"./chaindb":3,"./chainentry":4,"./common":5,"./layout":7}],7:[function(require,module,exports){"use strict";var bdb=require("bdb"),layout={V:bdb.key("V"),O:bdb.key("O"),R:bdb.key("R"),D:bdb.key("D"),e:bdb.key("e",["hash256"]),h:bdb.key("h",["hash256"]),H:bdb.key("H",["uint32"]),n:bdb.key("n",["hash256"]),p:bdb.key("p",["hash256"]),b:bdb.key("b",["hash256"]),t:bdb.key("t",["hash256"]),c:bdb.key("c",["hash256","uint32"]),u:bdb.key("u",["hash256"]),v:bdb.key("v",["uint8","hash256"]),T:bdb.key("T",["hash","hash256"]),C:bdb.key("C",["hash","hash256","uint32"])};module.exports=layout},{bdb:191}],8:[function(require,module,exports){"use strict";var assert=require("assert"),fixed=require("../utils/fixed"),Amount=function(){function Amount(value,unit){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Amount),this.value=0,null!=value&&this.fromOptions(value,unit)}return Amount.prototype.fromOptions=function(value,unit){return"string"==typeof unit?this.from(unit,value):"number"==typeof value?this.fromValue(value):this.fromBTC(value)},Amount.prototype.toValue=function(){return this.value},Amount.prototype.toSatoshis=function(num){return num?this.value:this.value.toString(10)},Amount.prototype.toBits=function(num){return Amount.encode(this.value,2,num)},Amount.prototype.toMBTC=function(num){return Amount.encode(this.value,5,num)},Amount.prototype.toBTC=function(num){return Amount.encode(this.value,8,num)},Amount.prototype.to=function(unit,num){switch(unit){case"sat":return this.toSatoshis(num);case"ubtc":case"bits":return this.toBits(num);case"mbtc":return this.toMBTC(num);case"btc":return this.toBTC(num)}throw new Error('Unknown unit "'+unit+'".')},Amount.prototype.toString=function(){return this.toBTC()},Amount.prototype.fromValue=function(value){return assert(Number.isSafeInteger(value)&&value>=0,"Value must be an int64."),this.value=value,this},Amount.prototype.fromSatoshis=function(value){return this.value=Amount.decode(value,0),this},Amount.prototype.fromBits=function(value){return this.value=Amount.decode(value,2),this},Amount.prototype.fromMBTC=function(value){return this.value=Amount.decode(value,5),this},Amount.prototype.fromBTC=function(value){return this.value=Amount.decode(value,8),this},Amount.prototype.from=function(unit,value){switch(unit){case"sat":return this.fromSatoshis(value);case"ubtc":case"bits":return this.fromBits(value);case"mbtc":return this.fromMBTC(value);case"btc":return this.fromBTC(value)}throw new Error('Unknown unit "'+unit+'".')},Amount.fromOptions=function(value,unit){return(new this).fromOptions(value,unit)},Amount.fromValue=function(value){return(new this).fromValue(value)},Amount.fromSatoshis=function(value){return(new this).fromSatoshis(value)},Amount.fromBits=function(value){return(new this).fromBits(value)},Amount.fromMBTC=function(value){return(new this).fromMBTC(value)},Amount.fromBTC=function(value){return(new this).fromBTC(value)},Amount.from=function(unit,value){return(new this).from(unit,value)},Amount.prototype.inspect=function(){return"<Amount: "+this.toString()+">"},Amount.btc=function(value,num){return"string"==typeof value?value:Amount.encode(value,8,num)},Amount.value=function(str){return"number"==typeof str?str:Amount.decode(str,8)},Amount.encode=function(value,exp,num){return num?fixed.toFloat(value,exp):fixed.encode(value,exp)},Amount.decode=function(value,exp){return"number"==typeof value?fixed.fromFloat(value,exp):fixed.decode(value,exp)},Amount}();module.exports=Amount},{"../utils/fixed":101,assert:146}],9:[function(require,module,exports){"use strict";exports.Amount=require("./amount"),exports.URI=require("./uri")},{"./amount":8,"./uri":10}],10:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),Address=require("../primitives/address"),Amount=require("./amount"),URI=function(){function URI(options){_classCallCheck(this,URI),this.address=new Address,this.amount=-1,this.label=null,this.message=null,this.request=null,options&&this.fromOptions(options)}return URI.prototype.fromOptions=function(options){return"string"==typeof options?this.fromString(options):(options.address&&this.address.fromOptions(options.address),null!=options.amount&&(assert(Number.isSafeInteger(options.amount)&&options.amount>=0,"Amount must be a uint64."),this.amount=options.amount),options.label&&(assert("string"==typeof options.label,"Label must be a string."),this.label=options.label),options.message&&(assert("string"==typeof options.message,"Message must be a string."),this.message=options.message),options.request&&(assert("string"==typeof options.request,"Request must be a string."),this.request=options.request),this)},URI.fromOptions=function(options){return(new this).fromOptions(options)},URI.prototype.fromString=function(str,network){assert("string"==typeof str),assert(str.length>8,"Not a bitcoin URI.");var prefix=str.substring(0,8);assert("bitcoin:"===prefix,"Not a bitcoin URI.");var index=(str=str.substring(8)).indexOf("?"),addr=void 0,qs=void 0;if(-1===index?addr=str:(addr=str.substring(0,index),qs=str.substring(index+1)),this.address.fromString(addr,network),!qs)return this;var query=function(str){for(var parts=str.split("&"),data=new BitcoinQuery,size=0,_iterator=parts,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var pair=_ref,index=pair.indexOf("="),key=void 0,value=void 0;if(-1===index?(key=pair,value=""):(key=pair.substring(0,index),value=pair.substring(index+1)),0!==key.length){switch(assert(size<4,"Too many keys in querystring."),key){case"amount":assert(null==data.amount,"Duplicate key in querystring (amount)."),data.amount=unescape(value);break;case"label":assert(null==data.label,"Duplicate key in querystring (label)."),data.label=unescape(value);break;case"message":assert(null==data.message,"Duplicate key in querystring (message)."),data.message=unescape(value);break;case"r":assert(null==data.r,"Duplicate key in querystring (r)."),data.r=unescape(value);break;default:assert(!1,"Unknown querystring key: "+value+".")}size+=1}else assert(0===value.length,"Empty key in querystring.")}return data}(qs);return query.amount&&(assert(query.amount.length>0,"Value is empty."),assert("-"!==query.amount[0],"Value is negative."),this.amount=Amount.value(query.amount)),query.label&&(this.label=query.label),query.message&&(this.message=query.message),query.r&&(this.request=query.r),this},URI.fromString=function(str,network){return(new this).fromString(str,network)},URI.prototype.toString=function(){var str="bitcoin:";str+=this.address.toString();var query=[];return-1!==this.amount&&query.push("amount="+Amount.btc(this.amount)),this.label&&query.push("label="+escape(this.label)),this.message&&query.push("message="+escape(this.message)),this.request&&query.push("r="+escape(this.request)),query.length>0&&(str+="?"+query.join("&")),str},URI.prototype.inspect=function(){return"<URI: "+this.toString()+">"},URI}(),BitcoinQuery=function BitcoinQuery(){_classCallCheck(this,BitcoinQuery),this.amount=null,this.label=null,this.message=null,this.r=null};function unescape(str){try{str=(str=decodeURIComponent(str)).replace(/\+/g," ")}catch(e){throw new Error("Malformed URI.")}if(-1!==str.indexOf("\0"))throw new Error("Malformed URI.");return str}function escape(str){return str=(str=encodeURIComponent(str)).replace(/%20/g,"+")}module.exports=URI},{"../primitives/address":69,"./amount":8,assert:146}],11:[function(require,module,exports){"use strict";var assert=require("assert"),bio=require("bufio"),Coin=require("../primitives/coin"),Output=require("../primitives/output"),compress=require("./compress"),encoding=bio.encoding,CoinEntry=function(){function CoinEntry(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CoinEntry),this.version=1,this.height=-1,this.coinbase=!1,this.output=new Output,this.spent=!1,this.raw=null}return CoinEntry.prototype.toOutput=function(){return this.output},CoinEntry.prototype.toCoin=function(prevout){var coin=new Coin;return coin.version=this.version,coin.height=this.height,coin.coinbase=this.coinbase,coin.script=this.output.script,coin.value=this.output.value,coin.hash=prevout.hash,coin.index=prevout.index,coin},CoinEntry.prototype.fromOutput=function(output){return this.output=output,this},CoinEntry.fromOutput=function(output){return(new this).fromOutput(output)},CoinEntry.prototype.fromCoin=function(coin){return this.version=coin.version,this.height=coin.height,this.coinbase=coin.coinbase,this.output.script=coin.script,this.output.value=coin.value,this},CoinEntry.fromCoin=function(coin){return(new this).fromCoin(coin)},CoinEntry.prototype.fromTX=function(tx,index,height){return assert("number"==typeof index),assert("number"==typeof height),assert(index>=0&&index<tx.outputs.length),this.version=tx.version,this.height=height,this.coinbase=tx.isCoinbase(),this.output=tx.outputs[index],this},CoinEntry.fromTX=function(tx,index,height){return(new this).fromTX(tx,index,height)},CoinEntry.prototype.getSize=function(){if(this.raw)return this.raw.length;var size=0;return size+=encoding.sizeVarint(this.version),size+=4,size+=compress.size(this.output)},CoinEntry.prototype.toWriter=function(bw){if(this.raw)return bw.writeBytes(this.raw),bw;var height=this.height,field=0;return this.coinbase&&(field|=1),-1===height&&(height=2147483647),field|=height<<1,bw.writeVarint(this.version),bw.writeU32(field),compress.pack(this.output,bw),bw},CoinEntry.prototype.toRaw=function(){if(this.raw)return this.raw;var size=this.getSize(),bw=bio.write(size);return this.toWriter(bw),this.raw=bw.render(),this.raw},CoinEntry.prototype.fromReader=function(br){var version=br.readVarint(),field=br.readU32(),height=field>>>1;return 2147483647===height&&(height=-1),this.version=version,this.coinbase=0!=(1&field),this.height=height,compress.unpack(this.output,br),this},CoinEntry.fromReader=function(data){return(new this).fromReader(data)},CoinEntry.prototype.fromRaw=function(data){return this.fromReader(bio.read(data)),this.raw=data,this},CoinEntry.fromRaw=function(data){return(new this).fromRaw(data)},CoinEntry}();module.exports=CoinEntry},{"../primitives/coin":71,"../primitives/output":81,"./compress":14,assert:146,bufio:270}],12:[function(require,module,exports){"use strict";var assert=require("assert"),CoinEntry=require("./coinentry"),Coins=function(){function Coins(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Coins),this.outputs=new Map}return Coins.prototype.add=function(index,coin){return assert(index>>>0===index),assert(coin),this.outputs.set(index,coin),coin},Coins.prototype.addOutput=function(index,output){return this.add(index,CoinEntry.fromOutput(output))},Coins.prototype.addIndex=function(tx,index,height){return this.add(index,CoinEntry.fromTX(tx,index,height))},Coins.prototype.addCoin=function(coin){return this.add(coin.index,CoinEntry.fromCoin(coin))},Coins.prototype.has=function(index){return this.outputs.has(index)},Coins.prototype.isUnspent=function(index){var coin=this.outputs.get(index);return!(!coin||coin.spent)},Coins.prototype.get=function(index){return this.outputs.get(index)||null},Coins.prototype.getOutput=function(index){var coin=this.outputs.get(index);return coin?coin.output:null},Coins.prototype.getCoin=function(prevout){var coin=this.outputs.get(prevout.index);return coin?coin.toCoin(prevout):null},Coins.prototype.spend=function(index){var coin=this.get(index);return!coin||coin.spent?null:(coin.spent=!0,coin)},Coins.prototype.remove=function(index){var coin=this.get(index);return coin?(this.outputs.delete(index),coin):null},Coins.prototype.isEmpty=function(){return 0===this.outputs.size},Coins.prototype.fromTX=function(tx,height){assert("number"==typeof height);for(var i=0;i<tx.outputs.length;i++){if(!tx.outputs[i].script.isUnspendable()){var entry=CoinEntry.fromTX(tx,i,height);this.outputs.set(i,entry)}}return this},Coins.fromTX=function(tx,height){return(new this).fromTX(tx,height)},Coins}();module.exports=Coins},{"./coinentry":11,assert:146}],13:[function(require,module,exports){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}var Coins=require("./coins"),UndoCoins=require("./undocoins"),CoinEntry=require("./coinentry"),CoinView=function(){function CoinView(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CoinView),this.map=new Map,this.undo=new UndoCoins}return CoinView.prototype.get=function(hash){return this.map.get(hash)},CoinView.prototype.has=function(hash){return this.map.has(hash)},CoinView.prototype.add=function(hash,coins){return this.map.set(hash,coins),coins},CoinView.prototype.ensure=function(hash){var coins=this.map.get(hash);return coins||this.add(hash,new Coins)},CoinView.prototype.remove=function(hash){var coins=this.map.get(hash);return coins?(this.map.delete(hash),coins):null},CoinView.prototype.addTX=function(tx,height){var hash=tx.hash("hex"),coins=Coins.fromTX(tx,height);return this.add(hash,coins)},CoinView.prototype.removeTX=function(tx,height){var hash=tx.hash("hex"),coins=Coins.fromTX(tx,height),_iterator=coins.outputs.values(),_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}_ref.spent=!0}return this.add(hash,coins)},CoinView.prototype.addEntry=function(prevout,coin){var hash=prevout.hash,index=prevout.index;return this.ensure(hash).add(index,coin)},CoinView.prototype.addCoin=function(coin){return this.ensure(coin.hash).addCoin(coin)},CoinView.prototype.addOutput=function(prevout,output){var hash=prevout.hash,index=prevout.index;return this.ensure(hash).addOutput(index,output)},CoinView.prototype.addIndex=function(tx,index,height){var hash=tx.hash("hex");return this.ensure(hash).addIndex(tx,index,height)},CoinView.prototype.spendEntry=function(prevout){var hash=prevout.hash,index=prevout.index,coins=this.get(hash);if(!coins)return null;var coin=coins.spend(index);return coin?(this.undo.push(coin),coin):null},CoinView.prototype.removeEntry=function(prevout){var hash=prevout.hash,index=prevout.index,coins=this.get(hash);return coins?coins.remove(index):null},CoinView.prototype.hasEntry=function(prevout){var hash=prevout.hash,index=prevout.index,coins=this.get(hash);return!!coins&&coins.has(index)},CoinView.prototype.getEntry=function(prevout){var hash=prevout.hash,index=prevout.index,coins=this.get(hash);return coins?coins.get(index):null},CoinView.prototype.isUnspent=function(prevout){var hash=prevout.hash,index=prevout.index,coins=this.get(hash);return!!coins&&coins.isUnspent(index)},CoinView.prototype.getCoin=function(prevout){var coins=this.get(prevout.hash);return coins?coins.getCoin(prevout):null},CoinView.prototype.getOutput=function(prevout){var hash=prevout.hash,index=prevout.index,coins=this.get(hash);return coins?coins.getOutput(index):null},CoinView.prototype.getHeight=function(prevout){var coin=this.getEntry(prevout);return coin?coin.height:-1},CoinView.prototype.isCoinbase=function(prevout){var coin=this.getEntry(prevout);return!!coin&&coin.coinbase},CoinView.prototype.hasEntryFor=function(input){return this.hasEntry(input.prevout)},CoinView.prototype.getEntryFor=function(input){return this.getEntry(input.prevout)},CoinView.prototype.isUnspentFor=function(input){return this.isUnspent(input.prevout)},CoinView.prototype.getCoinFor=function(input){return this.getCoin(input.prevout)},CoinView.prototype.getOutputFor=function(input){return this.getOutput(input.prevout)},CoinView.prototype.getHeightFor=function(input){return this.getHeight(input.prevout)},CoinView.prototype.isCoinbaseFor=function(input){return this.isCoinbase(input.prevout)},CoinView.prototype.readCoin=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(db,prevout){var cache,coin;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!(cache=this.getEntry(prevout))){_context.next=3;break}return _context.abrupt("return",cache);case 3:return _context.next=5,db.readCoin(prevout);case 5:if(coin=_context.sent){_context.next=8;break}return _context.abrupt("return",null);case 8:return _context.abrupt("return",this.addEntry(prevout,coin));case 9:case"end":return _context.stop()}},_callee,this)}));return function(_x,_x2){return _ref2.apply(this,arguments)}}(),CoinView.prototype.readInputs=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(db,tx){var found,_iterator2,_isArray2,_i2,_ref5,prevout;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:found=!0,_iterator2=tx.inputs,_isArray2=Array.isArray(_iterator2),_i2=0,_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();case 2:if(!_isArray2){_context2.next=8;break}if(!(_i2>=_iterator2.length)){_context2.next=5;break}return _context2.abrupt("break",20);case 5:_ref5=_iterator2[_i2++],_context2.next=12;break;case 8:if(!(_i2=_iterator2.next()).done){_context2.next=11;break}return _context2.abrupt("break",20);case 11:_ref5=_i2.value;case 12:return prevout=_ref5.prevout,_context2.next=16,this.readCoin(db,prevout);case 16:if(_context2.sent){_context2.next=18;break}found=!1;case 18:_context2.next=2;break;case 20:return _context2.abrupt("return",found);case 21:case"end":return _context2.stop()}},_callee2,this)}));return function(_x3,_x4){return _ref3.apply(this,arguments)}}(),CoinView.prototype.spendInputs=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(db,tx){var i,len,jobs,prevout,coins,_iterator3,_isArray3,_i3,_ref7,coin;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:i=0;case 1:if(!(i<tx.inputs.length)){_context3.next=28;break}for(len=Math.min(i+4,tx.inputs.length),jobs=[];i<len;i++)prevout=tx.inputs[i].prevout,jobs.push(this.readCoin(db,prevout));return _context3.next=7,Promise.all(jobs);case 7:coins=_context3.sent,_iterator3=coins,_isArray3=Array.isArray(_iterator3),_i3=0,_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();case 9:if(!_isArray3){_context3.next=15;break}if(!(_i3>=_iterator3.length)){_context3.next=12;break}return _context3.abrupt("break",26);case 12:_ref7=_iterator3[_i3++],_context3.next=19;break;case 15:if(!(_i3=_iterator3.next()).done){_context3.next=18;break}return _context3.abrupt("break",26);case 18:_ref7=_i3.value;case 19:if((coin=_ref7)&&!coin.spent){_context3.next=22;break}return _context3.abrupt("return",!1);case 22:coin.spent=!0,this.undo.push(coin);case 24:_context3.next=9;break;case 26:_context3.next=1;break;case 28:return _context3.abrupt("return",!0);case 29:case"end":return _context3.stop()}},_callee3,this)}));return function(_x5,_x6){return _ref6.apply(this,arguments)}}(),CoinView.prototype.getSize=function(tx){var size=0;size+=tx.inputs.length;var _iterator4=tx.inputs,_isArray4=Array.isArray(_iterator4),_i4=0;for(_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();;){var _ref9;if(_isArray4){if(_i4>=_iterator4.length)break;_ref9=_iterator4[_i4++]}else{if((_i4=_iterator4.next()).done)break;_ref9=_i4.value}var prevout=_ref9.prevout,coin=this.getEntry(prevout);coin&&(size+=coin.getSize())}return size},CoinView.prototype.toWriter=function(bw,tx){var _iterator5=tx.inputs,_isArray5=Array.isArray(_iterator5),_i5=0;for(_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();;){var _ref11;if(_isArray5){if(_i5>=_iterator5.length)break;_ref11=_iterator5[_i5++]}else{if((_i5=_iterator5.next()).done)break;_ref11=_i5.value}var prevout=_ref11.prevout,coin=this.getEntry(prevout);coin?(bw.writeU8(1),coin.toWriter(bw)):bw.writeU8(0)}return bw},CoinView.prototype.fromReader=function(br,tx){var _iterator6=tx.inputs,_isArray6=Array.isArray(_iterator6),_i6=0;for(_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();;){var _ref13;if(_isArray6){if(_i6>=_iterator6.length)break;_ref13=_iterator6[_i6++]}else{if((_i6=_iterator6.next()).done)break;_ref13=_i6.value}var prevout=_ref13.prevout;if(0!==br.readU8()){var coin=CoinEntry.fromReader(br);this.addEntry(prevout,coin)}}return this},CoinView.fromReader=function(br,tx){return(new this).fromReader(br,tx)},CoinView}();module.exports=CoinView},{"./coinentry":11,"./coins":12,"./undocoins":16}],14:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),encoding=require("bufio").encoding,secp256k1=require("bcrypto/lib/secp256k1"),consensus=require("../protocol/consensus"),COMPRESS_TYPES=6,EMPTY_BUFFER=Buffer.alloc(0);function compressScript(script,bw){var pkh=script.getPubkeyhash(!0);if(pkh)return bw.writeU8(0),bw.writeBytes(pkh),bw;var sh=script.getScripthash();if(sh)return bw.writeU8(1),bw.writeBytes(sh),bw;var pk=script.getPubkey(!0);if(pk&&publicKeyVerify(pk)){var key=function(key){var out=void 0;switch(key[0]){case 2:case 3:out=key;break;case 4:(out=secp256k1.publicKeyConvert(key,!0))[0]=4|1&key[64];break;default:throw new Error("Bad point format.")}return assert(33===out.length),out}(pk);return bw.writeBytes(key),bw}return bw.writeVarint(script.raw.length+COMPRESS_TYPES),bw.writeBytes(script.raw),bw}function decompressScript(script,br){switch(br.readU8()){case 0:var hash=br.readBytes(20,!0);script.fromPubkeyhash(hash);break;case 1:var _hash=br.readBytes(20,!0);script.fromScripthash(_hash);break;case 2:case 3:case 4:case 5:br.offset-=1;var key=function(key){var format=key[0];switch(assert(33===key.length),format){case 2:case 3:return key;case 4:key[0]=2;break;case 5:key[0]=3;break;default:throw new Error("Bad point format.")}var out=secp256k1.publicKeyConvert(key,!1);return key[0]=format,out}(br.readBytes(33,!0));script.fromPubkey(key);break;default:br.offset-=1;var size=br.readVarint()-COMPRESS_TYPES;if(size>consensus.MAX_SCRIPT_SIZE)script.fromNulldata(EMPTY_BUFFER),br.seek(size);else{var _data=br.readBytes(size);script.fromRaw(_data)}}return script}function publicKeyVerify(key){if(0===key.length)return!1;switch(key[0]){case 2:case 3:return 33===key.length;case 4:return 65===key.length&&secp256k1.publicKeyVerify(key);default:return!1}}exports.pack=function(output,bw){return bw.writeVarint(output.value),compressScript(output.script,bw),bw},exports.unpack=function(output,br){return output.value=br.readVarint(),decompressScript(output.script,br),output},exports.size=function(output){var size=0;return size+=encoding.sizeVarint(output.value),size+=function(script){if(script.isPubkeyhash(!0))return 21;if(script.isScripthash())return 21;var pk=script.getPubkey(!0);if(pk&&publicKeyVerify(pk))return 33;var size=0;return size+=encoding.sizeVarint(script.raw.length+COMPRESS_TYPES),size+=script.raw.length}(output.script)}}).call(this,require("buffer").Buffer)},{"../protocol/consensus":84,assert:146,"bcrypto/lib/secp256k1":184,buffer:269,bufio:270}],15:[function(require,module,exports){"use strict";exports.Coins=require("./coins"),exports.CoinView=require("./coinview"),exports.compress=require("./compress"),exports.UndoCoins=require("./undocoins")},{"./coins":12,"./coinview":13,"./compress":14,"./undocoins":16}],16:[function(require,module,exports){"use strict";var assert=require("assert"),bio=require("bufio"),CoinEntry=require("../coins/coinentry"),UndoCoins=function(){function UndoCoins(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,UndoCoins),this.items=[]}return UndoCoins.prototype.push=function(coin){return this.items.push(coin)},UndoCoins.prototype.getSize=function(){var size=0;size+=4;var _iterator=this.items,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}size+=_ref.getSize()}return size},UndoCoins.prototype.toRaw=function(){var size=this.getSize(),bw=bio.write(size);bw.writeU32(this.items.length);var _iterator2=this.items,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref2=_i2.value}_ref2.toWriter(bw)}return bw.render()},UndoCoins.prototype.fromRaw=function(data){for(var br=bio.read(data),count=br.readU32(),i=0;i<count;i++)this.items.push(CoinEntry.fromReader(br));return this},UndoCoins.fromRaw=function(data){return(new this).fromRaw(data)},UndoCoins.prototype.isEmpty=function(){return 0===this.items.length},UndoCoins.prototype.commit=function(){var raw=this.toRaw();return this.items.length=0,raw},UndoCoins.prototype.apply=function(view,prevout){var undo=this.items.pop();assert(undo),view.addEntry(prevout,undo)},UndoCoins}();module.exports=UndoCoins},{"../coins/coinentry":11,assert:146,bufio:270}],17:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),LRU=require("../utils/lru"),common=exports;common.HARDENED=2147483648,common.MIN_ENTROPY=128,common.MAX_ENTROPY=512,common.cache=new LRU(500),common.parsePath=function(path,hard){assert("string"==typeof path),assert("boolean"==typeof hard),assert(path.length>=1),assert(path.length<=3062);var parts=path.split("/"),root=parts[0];if("m"!==root&&"M"!==root&&"m'"!==root&&"M'"!==root)throw new Error("Invalid path root.");for(var result=[],i=1;i<parts.length;i++){var part=parts[i],hardened="'"===part[part.length-1];if(hardened&&(part=part.slice(0,-1)),part.length>10)throw new Error("Path index too large.");if(!/^\d+$/.test(part))throw new Error("Path index is non-numeric.");var index=parseInt(part,10);if(index>>>0!==index)throw new Error("Path index out of range.");if(hardened&&(index|=common.HARDENED,index>>>=0),!hard&&index&common.HARDENED)throw new Error("Path index cannot be hardened.");result.push(index)}return result},common.isMaster=function(key){return 0===key.depth&&0===key.childIndex&&0===key.parentFingerPrint},common.isAccount=function(key,account){if(null!=account){var index=(common.HARDENED|account)>>>0;if(key.childIndex!==index)return!1}return 3===key.depth&&0!=(key.childIndex&common.HARDENED)},common.ZERO_KEY=Buffer.alloc(33,0)}).call(this,require("buffer").Buffer)},{"../utils/lru":105,assert:146,buffer:269}],18:[function(require,module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},assert=require("assert"),common=require("./common"),Mnemonic=require("./mnemonic"),HDPrivateKey=require("./private"),HDPublicKey=require("./public"),wordlist=require("./wordlist"),HD=exports;HD.fromBase58=function(xkey,network){return HDPrivateKey.isBase58(xkey)?HDPrivateKey.fromBase58(xkey,network):HDPublicKey.fromBase58(xkey,network)},HD.generate=function(){return HDPrivateKey.generate()},HD.fromSeed=function(options){return HDPrivateKey.fromSeed(options)},HD.fromMnemonic=function(options){return HDPrivateKey.fromMnemonic(options)},HD.fromJSON=function(json,network){return json.xprivkey?HDPrivateKey.fromJSON(json,network):HDPublicKey.fromJSON(json,network)},HD.fromRaw=function(data,network){return HDPrivateKey.isRaw(data,network)?HDPrivateKey.fromRaw(data,network):HDPublicKey.fromRaw(data,network)},HD.from=function(options,network){if(assert(options,"Options required."),HD.isHD(options))return options;if(HD.isBase58(options,network))return HD.fromBase58(options,network);if(HD.isRaw(options,network))return HD.fromRaw(options,network);if(options&&"object"===(void 0===options?"undefined":_typeof(options)))return HD.fromMnemonic(options);throw new Error("Cannot create HD key from bad options.")},HD.isBase58=function(data,network){return HDPrivateKey.isBase58(data,network)||HDPublicKey.isBase58(data,network)},HD.isRaw=function(data,network){return HDPrivateKey.isRaw(data,network)||HDPublicKey.isRaw(data,network)},HD.isHD=function(obj){return HDPrivateKey.isHDPrivateKey(obj)||HDPublicKey.isHDPublicKey(obj)},HD.isPrivate=function(obj){return HDPrivateKey.isHDPrivateKey(obj)},HD.isPublic=function(obj){return HDPublicKey.isHDPublicKey(obj)},HD.common=common,HD.HD=HD,HD.Mnemonic=Mnemonic,HD.PrivateKey=HDPrivateKey,HD.PublicKey=HDPublicKey,HD.HDPrivateKey=HDPrivateKey,HD.HDPublicKey=HDPublicKey,HD.wordlist=wordlist},{"./common":17,"./mnemonic":20,"./private":22,"./public":23,"./wordlist":26,assert:146}],19:[function(require,module,exports){"use strict";module.exports=require("./hd")},{"./hd":18}],20:[function(require,module,exports){(function(Buffer){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),bio=require("bufio"),sha256=require("bcrypto/lib/sha256"),cleanse=require("bcrypto/lib/cleanse"),random=require("bcrypto/lib/random"),pbkdf2=require("bcrypto/lib/pbkdf2"),sha512=require("bcrypto/lib/sha512"),wordlist=require("./wordlist"),common=require("./common"),nfkd=require("./nfkd"),wordlistCache=Object.create(null),Mnemonic=function(){function Mnemonic(options){_classCallCheck(this,Mnemonic),this.bits=common.MIN_ENTROPY,this.language="english",this.entropy=null,this.phrase=null,options&&this.fromOptions(options)}return Mnemonic.prototype.fromOptions=function(options){return"string"==typeof options&&(options={phrase:options}),null!=options.bits&&(assert((65535&options.bits)===options.bits),assert(options.bits>=common.MIN_ENTROPY),assert(options.bits<=common.MAX_ENTROPY),assert(options.bits%32==0),this.bits=options.bits),options.language&&(assert("string"==typeof options.language),assert(-1!==Mnemonic.languages.indexOf(options.language)),this.language=options.language),options.phrase?(this.fromPhrase(options.phrase),this):options.entropy?(this.fromEntropy(options.entropy),this):this},Mnemonic.fromOptions=function(options){return(new this).fromOptions(options)},Mnemonic.prototype.destroy=function(){this.bits=common.MIN_ENTROPY,this.language="english",this.entropy&&(cleanse(this.entropy),this.entropy=null),this.phrase=null},Mnemonic.prototype.toSeed=function(passphrase){passphrase||(passphrase="");var phrase=nfkd(this.getPhrase()),passwd=nfkd("mnemonic"+passphrase);return pbkdf2.derive(sha512,Buffer.from(phrase,"utf8"),Buffer.from(passwd,"utf8"),2048,64)},Mnemonic.prototype.getEntropy=function(){return this.entropy||(this.entropy=random.randomBytes(this.bits/8)),assert(this.bits/8===this.entropy.length),this.entropy},Mnemonic.prototype.getPhrase=function(){if(this.phrase)return this.phrase;var wbits=this.bits+this.bits/32,entropy=this.getEntropy(),chk=sha256.digest(entropy),size=Math.ceil(wbits/8),data=Buffer.allocUnsafe(size);entropy.copy(data,0),chk.copy(data,entropy.length);for(var list=Mnemonic.getWordlist(this.language),phrase=[],i=0;i<wbits/11;i++){for(var index=0,j=0;j<11;j++){var pos=11*i+j,bit=pos%8;index<<=1,index|=data[(pos-bit)/8]>>>7-bit&1}phrase.push(list.words[index])}return phrase="japanese"===this.language?phrase.join(""):phrase.join(" "),this.phrase=phrase,phrase},Mnemonic.prototype.fromPhrase=function(phrase){assert("string"==typeof phrase),assert(phrase.length<=1e3);var words=phrase.trim().split(/[\s\u3000]+/),wbits=11*words.length,cbits=wbits%32;assert(0!==cbits,"Invalid checksum.");var bits=wbits-cbits;assert(bits>=common.MIN_ENTROPY),assert(bits<=common.MAX_ENTROPY),assert(bits%32==0);var size=Math.ceil(wbits/8),data=Buffer.allocUnsafe(size);data.fill(0);for(var lang=Mnemonic.getLanguage(words[0]),list=Mnemonic.getWordlist(lang),i=0;i<words.length;i++){var word=words[i],index=list.map[word];if(null==index)throw new Error("Could not find word.");for(var j=0;j<11;j++){var pos=11*i+j,bit=pos%8,val=index>>>10-j&1;data[(pos-bit)/8]|=val<<7-bit}}for(var cbytes=Math.ceil(cbits/8),entropy=data.slice(0,data.length-cbytes),chk1=data.slice(data.length-cbytes),chk2=sha256.digest(entropy),_i=0;_i<cbits;_i++){var _bit=_i%8,_oct=(_i-_bit)/8;if((chk1[_oct]>>>7-_bit&1)!==(chk2[_oct]>>>7-_bit&1))throw new Error("Invalid checksum.")}return assert(bits/8===entropy.length),this.bits=bits,this.language=lang,this.entropy=entropy,this.phrase=phrase,this},Mnemonic.fromPhrase=function(phrase){return(new this).fromPhrase(phrase)},Mnemonic.prototype.fromEntropy=function(entropy,lang){return assert(Buffer.isBuffer(entropy)),assert(8*entropy.length>=common.MIN_ENTROPY),assert(8*entropy.length<=common.MAX_ENTROPY),assert(8*entropy.length%32==0),assert(!lang||-1!==Mnemonic.languages.indexOf(lang)),this.entropy=entropy,this.bits=8*entropy.length,lang&&(this.language=lang),this},Mnemonic.fromEntropy=function(entropy,lang){return(new this).fromEntropy(entropy,lang)},Mnemonic.getLanguage=function(word){var _iterator=Mnemonic.languages,_isArray=Array.isArray(_iterator),_i2=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i2>=_iterator.length)break;_ref=_iterator[_i2++]}else{if((_i2=_iterator.next()).done)break;_ref=_i2.value}var lang=_ref;if(null!=Mnemonic.getWordlist(lang).map[word])return lang}throw new Error("Could not determine language.")},Mnemonic.getWordlist=function(lang){var cache=wordlistCache[lang];if(cache)return cache;var words=wordlist.get(lang),list=new WordList(words);return wordlistCache[lang]=list,list},Mnemonic.prototype.toJSON=function(){return{bits:this.bits,language:this.language,entropy:this.getEntropy().toString("hex"),phrase:this.getPhrase()}},Mnemonic.prototype.fromJSON=function(json){return assert(json),assert((65535&json.bits)===json.bits),assert("string"==typeof json.language),assert("string"==typeof json.entropy),assert("string"==typeof json.phrase),assert(json.bits>=common.MIN_ENTROPY),assert(json.bits<=common.MAX_ENTROPY),assert(json.bits%32==0),assert(json.bits/8==json.entropy.length/2),this.bits=json.bits,this.language=json.language,this.entropy=Buffer.from(json.entropy,"hex"),this.phrase=json.phrase,this},Mnemonic.fromJSON=function(json){return(new this).fromJSON(json)},Mnemonic.prototype.getSize=function(){var size=0;return size+=3,size+=this.getEntropy().length},Mnemonic.prototype.toWriter=function(bw){var lang=Mnemonic.languages.indexOf(this.language);return assert(-1!==lang),bw.writeU16(this.bits),bw.writeU8(lang),bw.writeBytes(this.getEntropy()),bw},Mnemonic.prototype.toRaw=function(writer){var size=this.getSize();return this.toWriter(bio.write(size)).render()},Mnemonic.prototype.fromReader=function(br){var bits=br.readU16();assert(bits>=common.MIN_ENTROPY),assert(bits<=common.MAX_ENTROPY),assert(bits%32==0);var language=Mnemonic.languages[br.readU8()];return assert(language),this.bits=bits,this.language=language,this.entropy=br.readBytes(bits/8),this},Mnemonic.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},Mnemonic.fromReader=function(br){return(new this).fromReader(br)},Mnemonic.fromRaw=function(data){return(new this).fromRaw(data)},Mnemonic.prototype.toString=function(){return this.getPhrase()},Mnemonic.prototype.inspect=function(){return"<Mnemonic: "+this.getPhrase()+">"},Mnemonic.isMnemonic=function(obj){return obj instanceof Mnemonic},Mnemonic}();Mnemonic.languages=["simplified chinese","traditional chinese","english","french","italian","japanese","spanish"];var WordList=function WordList(words){_classCallCheck(this,WordList),this.words=words,this.map=Object.create(null);for(var i=0;i<words.length;i++){var word=words[i];this.map[word]=i}};module.exports=Mnemonic}).call(this,require("buffer").Buffer)},{"./common":17,"./nfkd":21,"./wordlist":26,assert:146,"bcrypto/lib/cleanse":158,"bcrypto/lib/pbkdf2":178,"bcrypto/lib/random":180,"bcrypto/lib/sha256":186,"bcrypto/lib/sha512":187,buffer:269,bufio:270}],21:[function(require,module,exports){"use strict";var unorm=require("./unorm");module.exports=function(str){return str.normalize?str.normalize("NFKD"):unorm.nfkd(str)}},{"./unorm":25}],22:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),bio=require("bufio"),base58=require("bstring").base58,sha512=require("bcrypto/lib/sha512"),hash160=require("bcrypto/lib/hash160"),hash256=require("bcrypto/lib/hash256"),cleanse=require("bcrypto/lib/cleanse"),random=require("bcrypto/lib/random"),secp256k1=require("bcrypto/lib/secp256k1"),Network=require("../protocol/network"),consensus=require("../protocol/consensus"),common=require("./common"),Mnemonic=require("./mnemonic"),HDPublicKey=require("./public"),SEED_SALT=Buffer.from("Bitcoin seed","ascii"),HDPrivateKey=function(){function HDPrivateKey(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HDPrivateKey),this.depth=0,this.parentFingerPrint=0,this.childIndex=0,this.chainCode=consensus.ZERO_HASH,this.privateKey=consensus.ZERO_HASH,this.publicKey=common.ZERO_KEY,this.fingerPrint=-1,this._hdPublicKey=null,options&&this.fromOptions(options)}return HDPrivateKey.prototype.fromOptions=function(options){return assert(options,"No options for HD private key."),assert((255&options.depth)===options.depth),assert(options.parentFingerPrint>>>0===options.parentFingerPrint),assert(options.childIndex>>>0===options.childIndex),assert(Buffer.isBuffer(options.chainCode)),assert(Buffer.isBuffer(options.privateKey)),this.depth=options.depth,this.parentFingerPrint=options.parentFingerPrint,this.childIndex=options.childIndex,this.chainCode=options.chainCode,this.privateKey=options.privateKey,this.publicKey=secp256k1.publicKeyCreate(options.privateKey,!0),this},HDPrivateKey.fromOptions=function(options){return(new this).fromOptions(options)},HDPrivateKey.prototype.toPublic=function(){var key=this._hdPublicKey;return key||((key=new HDPublicKey).depth=this.depth,key.parentFingerPrint=this.parentFingerPrint,key.childIndex=this.childIndex,key.chainCode=this.chainCode,key.publicKey=this.publicKey,this._hdPublicKey=key),key},HDPrivateKey.prototype.xprivkey=function(network){return this.toBase58(network)},HDPrivateKey.prototype.xpubkey=function(network){return this.toPublic().xpubkey(network)},HDPrivateKey.prototype.destroy=function(pub){this.depth=0,this.childIndex=0,this.parentFingerPrint=0,cleanse(this.chainCode),cleanse(this.privateKey),cleanse(this.publicKey),this.fingerPrint=-1,this._hdPublicKey&&(pub&&this._hdPublicKey.destroy(),this._hdPublicKey=null)},HDPrivateKey.prototype.derive=function(index,hardened){if(assert("number"==typeof index),index>>>0!==index)throw new Error("Index out of range.");if(this.depth>=255)throw new Error("Depth too high.");hardened&&(index|=common.HARDENED,index>>>=0);var id=this.getID(index),cache=common.cache.get(id);if(cache)return cache;var bw=bio.pool(37);index&common.HARDENED?(bw.writeU8(0),bw.writeBytes(this.privateKey),bw.writeU32BE(index)):(bw.writeBytes(this.publicKey),bw.writeU32BE(index));var data=bw.render(),hash=sha512.mac(data,this.chainCode),left=hash.slice(0,32),right=hash.slice(32,64),key=void 0;try{key=secp256k1.privateKeyTweakAdd(this.privateKey,left)}catch(e){return this.derive(index+1)}if(-1===this.fingerPrint){var fp=hash160.digest(this.publicKey);this.fingerPrint=fp.readUInt32BE(0,!0)}var child=new this.constructor;return child.depth=this.depth+1,child.parentFingerPrint=this.fingerPrint,child.childIndex=index,child.chainCode=right,child.privateKey=key,child.publicKey=secp256k1.publicKeyCreate(key,!0),common.cache.set(id,child),child},HDPrivateKey.prototype.getID=function(index){return"v"+this.publicKey.toString("hex")+index},HDPrivateKey.prototype.deriveAccount=function(purpose,type,account){return assert(purpose>>>0===purpose,"Purpose must be a number."),assert(type>>>0===type,"Account index must be a number."),assert(account>>>0===account,"Account index must be a number."),assert(this.isMaster(),"Cannot derive account index."),this.derive(purpose,!0).derive(type,!0).derive(account,!0)},HDPrivateKey.prototype.isMaster=function(){return common.isMaster(this)},HDPrivateKey.prototype.isAccount=function(account){return common.isAccount(this,account)},HDPrivateKey.isBase58=function(data,network){if("string"!=typeof data)return!1;if(data.length<4)return!1;var prefix=data.substring(0,4);try{return Network.fromPrivate58(prefix,network),!0}catch(e){return!1}},HDPrivateKey.isRaw=function(data,network){if(!Buffer.isBuffer(data))return!1;if(data.length<4)return!1;var version=data.readUInt32BE(0,!0);try{return Network.fromPrivate(version,network),!0}catch(e){return!1}},HDPrivateKey.isValidPath=function(path){try{return common.parsePath(path,!0),!0}catch(e){return!1}},HDPrivateKey.prototype.derivePath=function(path){var key=this,_iterator=common.parsePath(path,!0),_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var index=_ref;key=key.derive(index)}return key},HDPrivateKey.prototype.equals=function(obj){return assert(HDPrivateKey.isHDPrivateKey(obj)),this.depth===obj.depth&&this.parentFingerPrint===obj.parentFingerPrint&&this.childIndex===obj.childIndex&&this.chainCode.equals(obj.chainCode)&&this.privateKey.equals(obj.privateKey)},HDPrivateKey.prototype.compare=function(key){assert(HDPrivateKey.isHDPrivateKey(key));var cmp=this.depth-key.depth;return 0!==cmp?cmp:0!==(cmp=this.parentFingerPrint-key.parentFingerPrint)?cmp:0!==(cmp=this.childIndex-key.childIndex)?cmp:0!==(cmp=this.chainCode.compare(key.chainCode))?cmp:0!==(cmp=this.privateKey.compare(key.privateKey))?cmp:0},HDPrivateKey.prototype.fromSeed=function(seed){if(assert(Buffer.isBuffer(seed)),8*seed.length<common.MIN_ENTROPY||8*seed.length>common.MAX_ENTROPY)throw new Error("Entropy not in range.");var hash=sha512.mac(seed,SEED_SALT),left=hash.slice(0,32),right=hash.slice(32,64);if(!secp256k1.privateKeyVerify(left))throw new Error("Master private key is invalid.");return this.depth=0,this.parentFingerPrint=0,this.childIndex=0,this.chainCode=right,this.privateKey=left,this.publicKey=secp256k1.publicKeyCreate(left,!0),this},HDPrivateKey.fromSeed=function(seed){return(new this).fromSeed(seed)},HDPrivateKey.prototype.fromMnemonic=function(mnemonic,passphrase){return assert(mnemonic instanceof Mnemonic),this.fromSeed(mnemonic.toSeed(passphrase))},HDPrivateKey.fromMnemonic=function(mnemonic,passphrase){return(new this).fromMnemonic(mnemonic,passphrase)},HDPrivateKey.prototype.fromPhrase=function(phrase){var mnemonic=Mnemonic.fromPhrase(phrase);return this.fromMnemonic(mnemonic),this},HDPrivateKey.fromPhrase=function(phrase){return(new this).fromPhrase(phrase)},HDPrivateKey.prototype.fromKey=function(key,entropy){return assert(Buffer.isBuffer(key)&&32===key.length),assert(Buffer.isBuffer(entropy)&&32===entropy.length),this.depth=0,this.parentFingerPrint=0,this.childIndex=0,this.chainCode=entropy,this.privateKey=key,this.publicKey=secp256k1.publicKeyCreate(key,!0),this},HDPrivateKey.fromKey=function(key,entropy){return(new this).fromKey(key,entropy)},HDPrivateKey.generate=function(){var key=secp256k1.generatePrivateKey(),entropy=random.randomBytes(32);return HDPrivateKey.fromKey(key,entropy)},HDPrivateKey.prototype.fromBase58=function(xkey,network){return assert("string"==typeof xkey),this.fromRaw(base58.decode(xkey),network)},HDPrivateKey.prototype.fromReader=function(br,network){var version=br.readU32BE();return Network.fromPrivate(version,network),this.depth=br.readU8(),this.parentFingerPrint=br.readU32BE(),this.childIndex=br.readU32BE(),this.chainCode=br.readBytes(32),assert(0===br.readU8()),this.privateKey=br.readBytes(32),this.publicKey=secp256k1.publicKeyCreate(this.privateKey,!0),br.verifyChecksum(hash256.digest),this},HDPrivateKey.prototype.fromRaw=function(data,network){return this.fromReader(bio.read(data),network)},HDPrivateKey.prototype.toBase58=function(network){return base58.encode(this.toRaw(network))},HDPrivateKey.prototype.getSize=function(){return 82},HDPrivateKey.prototype.toWriter=function(bw,network){return network=Network.get(network),bw.writeU32BE(network.keyPrefix.xprivkey),bw.writeU8(this.depth),bw.writeU32BE(this.parentFingerPrint),bw.writeU32BE(this.childIndex),bw.writeBytes(this.chainCode),bw.writeU8(0),bw.writeBytes(this.privateKey),bw.writeChecksum(hash256.digest),bw},HDPrivateKey.prototype.toRaw=function(network){return this.toWriter(bio.write(82),network).render()},HDPrivateKey.fromBase58=function(xkey,network){return(new this).fromBase58(xkey,network)},HDPrivateKey.fromReader=function(br,network){return(new this).fromReader(br,network)},HDPrivateKey.fromRaw=function(data,network){return(new this).fromRaw(data,network)},HDPrivateKey.prototype.toJSON=function(network){return{xprivkey:this.xprivkey(network)}},HDPrivateKey.prototype.fromJSON=function(json,network){return assert(json.xprivkey,"Could not handle key JSON."),this.fromBase58(json.xprivkey,network),this},HDPrivateKey.fromJSON=function(json,network){return(new this).fromJSON(json,network)},HDPrivateKey.isHDPrivateKey=function(obj){return obj instanceof HDPrivateKey},HDPrivateKey}();module.exports=HDPrivateKey}).call(this,require("buffer").Buffer)},{"../protocol/consensus":84,"../protocol/network":87,"./common":17,"./mnemonic":20,"./public":23,assert:146,"bcrypto/lib/cleanse":158,"bcrypto/lib/hash160":159,"bcrypto/lib/hash256":160,"bcrypto/lib/random":180,"bcrypto/lib/secp256k1":184,"bcrypto/lib/sha512":187,bstring:265,buffer:269,bufio:270}],23:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),bio=require("bufio"),base58=require("bstring").base58,sha512=require("bcrypto/lib/sha512"),hash160=require("bcrypto/lib/hash160"),hash256=require("bcrypto/lib/hash256"),cleanse=require("bcrypto/lib/cleanse"),secp256k1=require("bcrypto/lib/secp256k1"),Network=require("../protocol/network"),consensus=require("../protocol/consensus"),common=require("./common"),HDPublicKey=function(){function HDPublicKey(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HDPublicKey),this.depth=0,this.parentFingerPrint=0,this.childIndex=0,this.chainCode=consensus.ZERO_HASH,this.publicKey=common.ZERO_KEY,this.fingerPrint=-1,options&&this.fromOptions(options)}return HDPublicKey.prototype.fromOptions=function(options){return assert(options,"No options for HDPublicKey"),assert((255&options.depth)===options.depth),assert(options.parentFingerPrint>>>0===options.parentFingerPrint),assert(options.childIndex>>>0===options.childIndex),assert(Buffer.isBuffer(options.chainCode)),assert(Buffer.isBuffer(options.publicKey)),this.depth=options.depth,this.parentFingerPrint=options.parentFingerPrint,this.childIndex=options.childIndex,this.chainCode=options.chainCode,this.publicKey=options.publicKey,this},HDPublicKey.fromOptions=function(options){return(new this).fromOptions(options)},HDPublicKey.prototype.toPublic=function(){return this},HDPublicKey.prototype.xprivkey=function(network){return null},HDPublicKey.prototype.xpubkey=function(network){return this.toBase58(network)},HDPublicKey.prototype.destroy=function(){this.depth=0,this.childIndex=0,this.parentFingerPrint=0,cleanse(this.chainCode),cleanse(this.publicKey),this.fingerPrint=-1},HDPublicKey.prototype.derive=function(index,hardened){if(assert("number"==typeof index),index>>>0!==index)throw new Error("Index out of range.");if(index&common.HARDENED||hardened)throw new Error("Cannot derive hardened.");if(this.depth>=255)throw new Error("Depth too high.");var id=this.getID(index),cache=common.cache.get(id);if(cache)return cache;var bw=bio.pool(37);bw.writeBytes(this.publicKey),bw.writeU32BE(index);var data=bw.render(),hash=sha512.mac(data,this.chainCode),left=hash.slice(0,32),right=hash.slice(32,64),key=void 0;try{key=secp256k1.publicKeyTweakAdd(this.publicKey,left,!0)}catch(e){return this.derive(index+1)}if(-1===this.fingerPrint){var fp=hash160.digest(this.publicKey);this.fingerPrint=fp.readUInt32BE(0,!0)}var child=new this.constructor;return child.depth=this.depth+1,child.parentFingerPrint=this.fingerPrint,child.childIndex=index,child.chainCode=right,child.publicKey=key,common.cache.set(id,child),child},HDPublicKey.prototype.getID=function(index){return"b"+this.publicKey.toString("hex")+index},HDPublicKey.prototype.deriveAccount=function(purpose,type,account){return assert(purpose>>>0===purpose),assert(type>>>0===type),assert(account>>>0===account),assert(this.isAccount(account),"Cannot derive account index."),this},HDPublicKey.prototype.isMaster=function(){return common.isMaster(this)},HDPublicKey.prototype.isAccount=function(account){return common.isAccount(this,account)},HDPublicKey.isValidPath=function(path){try{return common.parsePath(path,!1),!0}catch(e){return!1}},HDPublicKey.prototype.derivePath=function(path){var key=this,_iterator=common.parsePath(path,!1),_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var index=_ref;key=key.derive(index)}return key},HDPublicKey.prototype.equals=function(obj){return assert(HDPublicKey.isHDPublicKey(obj)),this.depth===obj.depth&&this.parentFingerPrint===obj.parentFingerPrint&&this.childIndex===obj.childIndex&&this.chainCode.equals(obj.chainCode)&&this.publicKey.equals(obj.publicKey)},HDPublicKey.prototype.compare=function(key){assert(HDPublicKey.isHDPublicKey(key));var cmp=this.depth-key.depth;return 0!==cmp?cmp:0!==(cmp=this.parentFingerPrint-key.parentFingerPrint)?cmp:0!==(cmp=this.childIndex-key.childIndex)?cmp:0!==(cmp=this.chainCode.compare(key.chainCode))?cmp:0!==(cmp=this.publicKey.compare(key.publicKey))?cmp:0},HDPublicKey.prototype.toJSON=function(network){return{xpubkey:this.xpubkey(network)}},HDPublicKey.prototype.fromJSON=function(json,network){return assert(json.xpubkey,"Could not handle HD key JSON."),this.fromBase58(json.xpubkey,network),this},HDPublicKey.fromJSON=function(json,network){return(new this).fromJSON(json,network)},HDPublicKey.isBase58=function(data,network){if("string"!=typeof data)return!1;if(data.length<4)return!1;var prefix=data.substring(0,4);try{return Network.fromPublic58(prefix,network),!0}catch(e){return!1}},HDPublicKey.isRaw=function(data,network){if(!Buffer.isBuffer(data))return!1;if(data.length<4)return!1;var version=data.readUInt32BE(0,!0);try{return Network.fromPublic(version,network),!0}catch(e){return!1}},HDPublicKey.prototype.fromBase58=function(xkey,network){return assert("string"==typeof xkey),this.fromRaw(base58.decode(xkey),network)},HDPublicKey.prototype.fromReader=function(br,network){var version=br.readU32BE();return Network.fromPublic(version,network),this.depth=br.readU8(),this.parentFingerPrint=br.readU32BE(),this.childIndex=br.readU32BE(),this.chainCode=br.readBytes(32),this.publicKey=br.readBytes(33),br.verifyChecksum(hash256.digest),this},HDPublicKey.prototype.fromRaw=function(data,network){return this.fromReader(bio.read(data),network)},HDPublicKey.prototype.toBase58=function(network){return base58.encode(this.toRaw(network))},HDPublicKey.prototype.toWriter=function(bw,network){return network=Network.get(network),bw.writeU32BE(network.keyPrefix.xpubkey),bw.writeU8(this.depth),bw.writeU32BE(this.parentFingerPrint),bw.writeU32BE(this.childIndex),bw.writeBytes(this.chainCode),bw.writeBytes(this.publicKey),bw.writeChecksum(hash256.digest),bw},HDPublicKey.prototype.getSize=function(){return 82},HDPublicKey.prototype.toRaw=function(network){return this.toWriter(bio.write(82),network).render()},HDPublicKey.fromBase58=function(xkey,network){return(new this).fromBase58(xkey,network)},HDPublicKey.fromReader=function(br,network){return(new this).fromReader(br,network)},HDPublicKey.fromRaw=function(data,network){return(new this).fromRaw(data,network)},HDPublicKey.isHDPublicKey=function(obj){return obj instanceof HDPublicKey},HDPublicKey}();module.exports=HDPublicKey}).call(this,{isBuffer:require("../../node_modules/is-buffer/index.js")})},{"../../node_modules/is-buffer/index.js":353,"../protocol/consensus":84,"../protocol/network":87,"./common":17,assert:146,"bcrypto/lib/cleanse":158,"bcrypto/lib/hash160":159,"bcrypto/lib/hash256":160,"bcrypto/lib/secp256k1":184,"bcrypto/lib/sha512":187,bstring:265,bufio:270}],24:[function(require,module,exports){module.exports={0:{60:[null,null,{824:8814}],61:[null,null,{824:8800}],62:[null,null,{824:8815}],65:[null,null,{768:192,769:193,770:194,771:195,772:256,774:258,775:550,776:196,777:7842,778:197,780:461,783:512,785:514,803:7840,805:7680,808:260}],66:[null,null,{775:7682,803:7684,817:7686}],67:[null,null,{769:262,770:264,775:266,780:268,807:199}],68:[null,null,{775:7690,780:270,803:7692,807:7696,813:7698,817:7694}],69:[null,null,{768:200,769:201,770:202,771:7868,772:274,774:276,775:278,776:203,777:7866,780:282,783:516,785:518,803:7864,807:552,808:280,813:7704,816:7706}],70:[null,null,{775:7710}],71:[null,null,{769:500,770:284,772:7712,774:286,775:288,780:486,807:290}],72:[null,null,{770:292,775:7714,776:7718,780:542,803:7716,807:7720,814:7722}],73:[null,null,{768:204,769:205,770:206,771:296,772:298,774:300,775:304,776:207,777:7880,780:463,783:520,785:522,803:7882,808:302,816:7724}],74:[null,null,{770:308}],75:[null,null,{769:7728,780:488,803:7730,807:310,817:7732}],76:[null,null,{769:313,780:317,803:7734,807:315,813:7740,817:7738}],77:[null,null,{769:7742,775:7744,803:7746}],78:[null,null,{768:504,769:323,771:209,775:7748,780:327,803:7750,807:325,813:7754,817:7752}],79:[null,null,{768:210,769:211,770:212,771:213,772:332,774:334,775:558,776:214,777:7886,779:336,780:465,783:524,785:526,795:416,803:7884,808:490}],80:[null,null,{769:7764,775:7766}],82:[null,null,{769:340,775:7768,780:344,783:528,785:530,803:7770,807:342,817:7774}],83:[null,null,{769:346,770:348,775:7776,780:352,803:7778,806:536,807:350}],84:[null,null,{775:7786,780:356,803:7788,806:538,807:354,813:7792,817:7790}],85:[null,null,{768:217,769:218,770:219,771:360,772:362,774:364,776:220,777:7910,778:366,779:368,780:467,783:532,785:534,795:431,803:7908,804:7794,808:370,813:7798,816:7796}],86:[null,null,{771:7804,803:7806}],87:[null,null,{768:7808,769:7810,770:372,775:7814,776:7812,803:7816}],88:[null,null,{775:7818,776:7820}],89:[null,null,{768:7922,769:221,770:374,771:7928,772:562,775:7822,776:376,777:7926,803:7924}],90:[null,null,{769:377,770:7824,775:379,780:381,803:7826,817:7828}],97:[null,null,{768:224,769:225,770:226,771:227,772:257,774:259,775:551,776:228,777:7843,778:229,780:462,783:513,785:515,803:7841,805:7681,808:261}],98:[null,null,{775:7683,803:7685,817:7687}],99:[null,null,{769:263,770:265,775:267,780:269,807:231}],100:[null,null,{775:7691,780:271,803:7693,807:7697,813:7699,817:7695}],101:[null,null,{768:232,769:233,770:234,771:7869,772:275,774:277,775:279,776:235,777:7867,780:283,783:517,785:519,803:7865,807:553,808:281,813:7705,816:7707}],102:[null,null,{775:7711}],103:[null,null,{769:501,770:285,772:7713,774:287,775:289,780:487,807:291}],104:[null,null,{770:293,775:7715,776:7719,780:543,803:7717,807:7721,814:7723,817:7830}],105:[null,null,{768:236,769:237,770:238,771:297,772:299,774:301,776:239,777:7881,780:464,783:521,785:523,803:7883,808:303,816:7725}],106:[null,null,{770:309,780:496}],107:[null,null,{769:7729,780:489,803:7731,807:311,817:7733}],108:[null,null,{769:314,780:318,803:7735,807:316,813:7741,817:7739}],109:[null,null,{769:7743,775:7745,803:7747}],110:[null,null,{768:505,769:324,771:241,775:7749,780:328,803:7751,807:326,813:7755,817:7753}],111:[null,null,{768:242,769:243,770:244,771:245,772:333,774:335,775:559,776:246,777:7887,779:337,780:466,783:525,785:527,795:417,803:7885,808:491}],112:[null,null,{769:7765,775:7767}],114:[null,null,{769:341,775:7769,780:345,783:529,785:531,803:7771,807:343,817:7775}],115:[null,null,{769:347,770:349,775:7777,780:353,803:7779,806:537,807:351}],116:[null,null,{775:7787,776:7831,780:357,803:7789,806:539,807:355,813:7793,817:7791}],117:[null,null,{768:249,769:250,770:251,771:361,772:363,774:365,776:252,777:7911,778:367,779:369,780:468,783:533,785:535,795:432,803:7909,804:7795,808:371,813:7799,816:7797}],118:[null,null,{771:7805,803:7807}],119:[null,null,{768:7809,769:7811,770:373,775:7815,776:7813,778:7832,803:7817}],120:[null,null,{775:7819,776:7821}],121:[null,null,{768:7923,769:253,770:375,771:7929,772:563,775:7823,776:255,777:7927,778:7833,803:7925}],122:[null,null,{769:378,770:7825,775:380,780:382,803:7827,817:7829}],160:[[32],256],168:[[32,776],256,{768:8173,769:901,834:8129}],170:[[97],256],175:[[32,772],256],178:[[50],256],179:[[51],256],180:[[32,769],256],181:[[956],256],184:[[32,807],256],185:[[49],256],186:[[111],256],188:[[49,8260,52],256],189:[[49,8260,50],256],190:[[51,8260,52],256],192:[[65,768]],193:[[65,769]],194:[[65,770],null,{768:7846,769:7844,771:7850,777:7848}],195:[[65,771]],196:[[65,776],null,{772:478}],197:[[65,778],null,{769:506}],198:[null,null,{769:508,772:482}],199:[[67,807],null,{769:7688}],200:[[69,768]],201:[[69,769]],202:[[69,770],null,{768:7872,769:7870,771:7876,777:7874}],203:[[69,776]],204:[[73,768]],205:[[73,769]],206:[[73,770]],207:[[73,776],null,{769:7726}],209:[[78,771]],210:[[79,768]],211:[[79,769]],212:[[79,770],null,{768:7890,769:7888,771:7894,777:7892}],213:[[79,771],null,{769:7756,772:556,776:7758}],214:[[79,776],null,{772:554}],216:[null,null,{769:510}],217:[[85,768]],218:[[85,769]],219:[[85,770]],220:[[85,776],null,{768:475,769:471,772:469,780:473}],221:[[89,769]],224:[[97,768]],225:[[97,769]],226:[[97,770],null,{768:7847,769:7845,771:7851,777:7849}],227:[[97,771]],228:[[97,776],null,{772:479}],229:[[97,778],null,{769:507}],230:[null,null,{769:509,772:483}],231:[[99,807],null,{769:7689}],232:[[101,768]],233:[[101,769]],234:[[101,770],null,{768:7873,769:7871,771:7877,777:7875}],235:[[101,776]],236:[[105,768]],237:[[105,769]],238:[[105,770]],239:[[105,776],null,{769:7727}],241:[[110,771]],242:[[111,768]],243:[[111,769]],244:[[111,770],null,{768:7891,769:7889,771:7895,777:7893}],245:[[111,771],null,{769:7757,772:557,776:7759}],246:[[111,776],null,{772:555}],248:[null,null,{769:511}],249:[[117,768]],250:[[117,769]],251:[[117,770]],252:[[117,776],null,{768:476,769:472,772:470,780:474}],253:[[121,769]],255:[[121,776]]},256:{256:[[65,772]],257:[[97,772]],258:[[65,774],null,{768:7856,769:7854,771:7860,777:7858}],259:[[97,774],null,{768:7857,769:7855,771:7861,777:7859}],260:[[65,808]],261:[[97,808]],262:[[67,769]],263:[[99,769]],264:[[67,770]],265:[[99,770]],266:[[67,775]],267:[[99,775]],268:[[67,780]],269:[[99,780]],270:[[68,780]],271:[[100,780]],274:[[69,772],null,{768:7700,769:7702}],275:[[101,772],null,{768:7701,769:7703}],276:[[69,774]],277:[[101,774]],278:[[69,775]],279:[[101,775]],280:[[69,808]],281:[[101,808]],282:[[69,780]],283:[[101,780]],284:[[71,770]],285:[[103,770]],286:[[71,774]],287:[[103,774]],288:[[71,775]],289:[[103,775]],290:[[71,807]],291:[[103,807]],292:[[72,770]],293:[[104,770]],296:[[73,771]],297:[[105,771]],298:[[73,772]],299:[[105,772]],300:[[73,774]],301:[[105,774]],302:[[73,808]],303:[[105,808]],304:[[73,775]],306:[[73,74],256],307:[[105,106],256],308:[[74,770]],309:[[106,770]],310:[[75,807]],311:[[107,807]],313:[[76,769]],314:[[108,769]],315:[[76,807]],316:[[108,807]],317:[[76,780]],318:[[108,780]],319:[[76,183],256],320:[[108,183],256],323:[[78,769]],324:[[110,769]],325:[[78,807]],326:[[110,807]],327:[[78,780]],328:[[110,780]],329:[[700,110],256],332:[[79,772],null,{768:7760,769:7762}],333:[[111,772],null,{768:7761,769:7763}],334:[[79,774]],335:[[111,774]],336:[[79,779]],337:[[111,779]],340:[[82,769]],341:[[114,769]],342:[[82,807]],343:[[114,807]],344:[[82,780]],345:[[114,780]],346:[[83,769],null,{775:7780}],347:[[115,769],null,{775:7781}],348:[[83,770]],349:[[115,770]],350:[[83,807]],351:[[115,807]],352:[[83,780],null,{775:7782}],353:[[115,780],null,{775:7783}],354:[[84,807]],355:[[116,807]],356:[[84,780]],357:[[116,780]],360:[[85,771],null,{769:7800}],361:[[117,771],null,{769:7801}],362:[[85,772],null,{776:7802}],363:[[117,772],null,{776:7803}],364:[[85,774]],365:[[117,774]],366:[[85,778]],367:[[117,778]],368:[[85,779]],369:[[117,779]],370:[[85,808]],371:[[117,808]],372:[[87,770]],373:[[119,770]],374:[[89,770]],375:[[121,770]],376:[[89,776]],377:[[90,769]],378:[[122,769]],379:[[90,775]],380:[[122,775]],381:[[90,780]],382:[[122,780]],383:[[115],256,{775:7835}],416:[[79,795],null,{768:7900,769:7898,771:7904,777:7902,803:7906}],417:[[111,795],null,{768:7901,769:7899,771:7905,777:7903,803:7907}],431:[[85,795],null,{768:7914,769:7912,771:7918,777:7916,803:7920}],432:[[117,795],null,{768:7915,769:7913,771:7919,777:7917,803:7921}],439:[null,null,{780:494}],452:[[68,381],256],453:[[68,382],256],454:[[100,382],256],455:[[76,74],256],456:[[76,106],256],457:[[108,106],256],458:[[78,74],256],459:[[78,106],256],460:[[110,106],256],461:[[65,780]],462:[[97,780]],463:[[73,780]],464:[[105,780]],465:[[79,780]],466:[[111,780]],467:[[85,780]],468:[[117,780]],469:[[220,772]],470:[[252,772]],471:[[220,769]],472:[[252,769]],473:[[220,780]],474:[[252,780]],475:[[220,768]],476:[[252,768]],478:[[196,772]],479:[[228,772]],480:[[550,772]],481:[[551,772]],482:[[198,772]],483:[[230,772]],486:[[71,780]],487:[[103,780]],488:[[75,780]],489:[[107,780]],490:[[79,808],null,{772:492}],491:[[111,808],null,{772:493}],492:[[490,772]],493:[[491,772]],494:[[439,780]],495:[[658,780]],496:[[106,780]],497:[[68,90],256],498:[[68,122],256],499:[[100,122],256],500:[[71,769]],501:[[103,769]],504:[[78,768]],505:[[110,768]],506:[[197,769]],507:[[229,769]],508:[[198,769]],509:[[230,769]],510:[[216,769]],511:[[248,769]],66045:[null,220]},512:{512:[[65,783]],513:[[97,783]],514:[[65,785]],515:[[97,785]],516:[[69,783]],517:[[101,783]],518:[[69,785]],519:[[101,785]],520:[[73,783]],521:[[105,783]],522:[[73,785]],523:[[105,785]],524:[[79,783]],525:[[111,783]],526:[[79,785]],527:[[111,785]],528:[[82,783]],529:[[114,783]],530:[[82,785]],531:[[114,785]],532:[[85,783]],533:[[117,783]],534:[[85,785]],535:[[117,785]],536:[[83,806]],537:[[115,806]],538:[[84,806]],539:[[116,806]],542:[[72,780]],543:[[104,780]],550:[[65,775],null,{772:480}],551:[[97,775],null,{772:481}],552:[[69,807],null,{774:7708}],553:[[101,807],null,{774:7709}],554:[[214,772]],555:[[246,772]],556:[[213,772]],557:[[245,772]],558:[[79,775],null,{772:560}],559:[[111,775],null,{772:561}],560:[[558,772]],561:[[559,772]],562:[[89,772]],563:[[121,772]],658:[null,null,{780:495}],688:[[104],256],689:[[614],256],690:[[106],256],691:[[114],256],692:[[633],256],693:[[635],256],694:[[641],256],695:[[119],256],696:[[121],256],728:[[32,774],256],729:[[32,775],256],730:[[32,778],256],731:[[32,808],256],732:[[32,771],256],733:[[32,779],256],736:[[611],256],737:[[108],256],738:[[115],256],739:[[120],256],740:[[661],256],66272:[null,220]},768:{768:[null,230],769:[null,230],770:[null,230],771:[null,230],772:[null,230],773:[null,230],774:[null,230],775:[null,230],776:[null,230,{769:836}],777:[null,230],778:[null,230],779:[null,230],780:[null,230],781:[null,230],782:[null,230],783:[null,230],784:[null,230],785:[null,230],786:[null,230],787:[null,230],788:[null,230],789:[null,232],790:[null,220],791:[null,220],792:[null,220],793:[null,220],794:[null,232],795:[null,216],796:[null,220],797:[null,220],798:[null,220],799:[null,220],800:[null,220],801:[null,202],802:[null,202],803:[null,220],804:[null,220],805:[null,220],806:[null,220],807:[null,202],808:[null,202],809:[null,220],810:[null,220],811:[null,220],812:[null,220],813:[null,220],814:[null,220],815:[null,220],816:[null,220],817:[null,220],818:[null,220],819:[null,220],820:[null,1],821:[null,1],822:[null,1],823:[null,1],824:[null,1],825:[null,220],826:[null,220],827:[null,220],828:[null,220],829:[null,230],830:[null,230],831:[null,230],832:[[768],230],833:[[769],230],834:[null,230],835:[[787],230],836:[[776,769],230],837:[null,240],838:[null,230],839:[null,220],840:[null,220],841:[null,220],842:[null,230],843:[null,230],844:[null,230],845:[null,220],846:[null,220],848:[null,230],849:[null,230],850:[null,230],851:[null,220],852:[null,220],853:[null,220],854:[null,220],855:[null,230],856:[null,232],857:[null,220],858:[null,220],859:[null,230],860:[null,233],861:[null,234],862:[null,234],863:[null,233],864:[null,234],865:[null,234],866:[null,233],867:[null,230],868:[null,230],869:[null,230],870:[null,230],871:[null,230],872:[null,230],873:[null,230],874:[null,230],875:[null,230],876:[null,230],877:[null,230],878:[null,230],879:[null,230],884:[[697]],890:[[32,837],256],894:[[59]],900:[[32,769],256],901:[[168,769]],902:[[913,769]],903:[[183]],904:[[917,769]],905:[[919,769]],906:[[921,769]],908:[[927,769]],910:[[933,769]],911:[[937,769]],912:[[970,769]],913:[null,null,{768:8122,769:902,772:8121,774:8120,787:7944,788:7945,837:8124}],917:[null,null,{768:8136,769:904,787:7960,788:7961}],919:[null,null,{768:8138,769:905,787:7976,788:7977,837:8140}],921:[null,null,{768:8154,769:906,772:8153,774:8152,776:938,787:7992,788:7993}],927:[null,null,{768:8184,769:908,787:8008,788:8009}],929:[null,null,{788:8172}],933:[null,null,{768:8170,769:910,772:8169,774:8168,776:939,788:8025}],937:[null,null,{768:8186,769:911,787:8040,788:8041,837:8188}],938:[[921,776]],939:[[933,776]],940:[[945,769],null,{837:8116}],941:[[949,769]],942:[[951,769],null,{837:8132}],943:[[953,769]],944:[[971,769]],945:[null,null,{768:8048,769:940,772:8113,774:8112,787:7936,788:7937,834:8118,837:8115}],949:[null,null,{768:8050,769:941,787:7952,788:7953}],951:[null,null,{768:8052,769:942,787:7968,788:7969,834:8134,837:8131}],953:[null,null,{768:8054,769:943,772:8145,774:8144,776:970,787:7984,788:7985,834:8150}],959:[null,null,{768:8056,769:972,787:8e3,788:8001}],961:[null,null,{787:8164,788:8165}],965:[null,null,{768:8058,769:973,772:8161,774:8160,776:971,787:8016,788:8017,834:8166}],969:[null,null,{768:8060,769:974,787:8032,788:8033,834:8182,837:8179}],970:[[953,776],null,{768:8146,769:912,834:8151}],971:[[965,776],null,{768:8162,769:944,834:8167}],972:[[959,769]],973:[[965,769]],974:[[969,769],null,{837:8180}],976:[[946],256],977:[[952],256],978:[[933],256,{769:979,776:980}],979:[[978,769]],980:[[978,776]],981:[[966],256],982:[[960],256],1008:[[954],256],1009:[[961],256],1010:[[962],256],1012:[[920],256],1013:[[949],256],1017:[[931],256],66422:[null,230],66423:[null,230],66424:[null,230],66425:[null,230],66426:[null,230]},1024:{1024:[[1045,768]],1025:[[1045,776]],1027:[[1043,769]],1030:[null,null,{776:1031}],1031:[[1030,776]],1036:[[1050,769]],1037:[[1048,768]],1038:[[1059,774]],1040:[null,null,{774:1232,776:1234}],1043:[null,null,{769:1027}],1045:[null,null,{768:1024,774:1238,776:1025}],1046:[null,null,{774:1217,776:1244}],1047:[null,null,{776:1246}],1048:[null,null,{768:1037,772:1250,774:1049,776:1252}],1049:[[1048,774]],1050:[null,null,{769:1036}],1054:[null,null,{776:1254}],1059:[null,null,{772:1262,774:1038,776:1264,779:1266}],1063:[null,null,{776:1268}],1067:[null,null,{776:1272}],1069:[null,null,{776:1260}],1072:[null,null,{774:1233,776:1235}],1075:[null,null,{769:1107}],1077:[null,null,{768:1104,774:1239,776:1105}],1078:[null,null,{774:1218,776:1245}],1079:[null,null,{776:1247}],1080:[null,null,{768:1117,772:1251,774:1081,776:1253}],1081:[[1080,774]],1082:[null,null,{769:1116}],1086:[null,null,{776:1255}],1091:[null,null,{772:1263,774:1118,776:1265,779:1267}],1095:[null,null,{776:1269}],1099:[null,null,{776:1273}],1101:[null,null,{776:1261}],1104:[[1077,768]],1105:[[1077,776]],1107:[[1075,769]],1110:[null,null,{776:1111}],1111:[[1110,776]],1116:[[1082,769]],1117:[[1080,768]],1118:[[1091,774]],1140:[null,null,{783:1142}],1141:[null,null,{783:1143}],1142:[[1140,783]],1143:[[1141,783]],1155:[null,230],1156:[null,230],1157:[null,230],1158:[null,230],1159:[null,230],1217:[[1046,774]],1218:[[1078,774]],1232:[[1040,774]],1233:[[1072,774]],1234:[[1040,776]],1235:[[1072,776]],1238:[[1045,774]],1239:[[1077,774]],1240:[null,null,{776:1242}],1241:[null,null,{776:1243}],1242:[[1240,776]],1243:[[1241,776]],1244:[[1046,776]],1245:[[1078,776]],1246:[[1047,776]],1247:[[1079,776]],1250:[[1048,772]],1251:[[1080,772]],1252:[[1048,776]],1253:[[1080,776]],1254:[[1054,776]],1255:[[1086,776]],1256:[null,null,{776:1258}],1257:[null,null,{776:1259}],1258:[[1256,776]],1259:[[1257,776]],1260:[[1069,776]],1261:[[1101,776]],1262:[[1059,772]],1263:[[1091,772]],1264:[[1059,776]],1265:[[1091,776]],1266:[[1059,779]],1267:[[1091,779]],1268:[[1063,776]],1269:[[1095,776]],1272:[[1067,776]],1273:[[1099,776]]},1280:{1415:[[1381,1410],256],1425:[null,220],1426:[null,230],1427:[null,230],1428:[null,230],1429:[null,230],1430:[null,220],1431:[null,230],1432:[null,230],1433:[null,230],1434:[null,222],1435:[null,220],1436:[null,230],1437:[null,230],1438:[null,230],1439:[null,230],1440:[null,230],1441:[null,230],1442:[null,220],1443:[null,220],1444:[null,220],1445:[null,220],1446:[null,220],1447:[null,220],1448:[null,230],1449:[null,230],1450:[null,220],1451:[null,230],1452:[null,230],1453:[null,222],1454:[null,228],1455:[null,230],1456:[null,10],1457:[null,11],1458:[null,12],1459:[null,13],1460:[null,14],1461:[null,15],1462:[null,16],1463:[null,17],1464:[null,18],1465:[null,19],1466:[null,19],1467:[null,20],1468:[null,21],1469:[null,22],1471:[null,23],1473:[null,24],1474:[null,25],1476:[null,230],1477:[null,220],1479:[null,18]},1536:{1552:[null,230],1553:[null,230],1554:[null,230],1555:[null,230],1556:[null,230],1557:[null,230],1558:[null,230],1559:[null,230],1560:[null,30],1561:[null,31],1562:[null,32],1570:[[1575,1619]],1571:[[1575,1620]],1572:[[1608,1620]],1573:[[1575,1621]],1574:[[1610,1620]],1575:[null,null,{1619:1570,1620:1571,1621:1573}],1608:[null,null,{1620:1572}],1610:[null,null,{1620:1574}],1611:[null,27],1612:[null,28],1613:[null,29],1614:[null,30],1615:[null,31],1616:[null,32],1617:[null,33],1618:[null,34],1619:[null,230],1620:[null,230],1621:[null,220],1622:[null,220],1623:[null,230],1624:[null,230],1625:[null,230],1626:[null,230],1627:[null,230],1628:[null,220],1629:[null,230],1630:[null,230],1631:[null,220],1648:[null,35],1653:[[1575,1652],256],1654:[[1608,1652],256],1655:[[1735,1652],256],1656:[[1610,1652],256],1728:[[1749,1620]],1729:[null,null,{1620:1730}],1730:[[1729,1620]],1746:[null,null,{1620:1747}],1747:[[1746,1620]],1749:[null,null,{1620:1728}],1750:[null,230],1751:[null,230],1752:[null,230],1753:[null,230],1754:[null,230],1755:[null,230],1756:[null,230],1759:[null,230],1760:[null,230],1761:[null,230],1762:[null,230],1763:[null,220],1764:[null,230],1767:[null,230],1768:[null,230],1770:[null,220],1771:[null,230],1772:[null,230],1773:[null,220]},1792:{1809:[null,36],1840:[null,230],1841:[null,220],1842:[null,230],1843:[null,230],1844:[null,220],1845:[null,230],1846:[null,230],1847:[null,220],1848:[null,220],1849:[null,220],1850:[null,230],1851:[null,220],1852:[null,220],1853:[null,230],1854:[null,220],1855:[null,230],1856:[null,230],1857:[null,230],1858:[null,220],1859:[null,230],1860:[null,220],1861:[null,230],1862:[null,220],1863:[null,230],1864:[null,220],1865:[null,230],1866:[null,230],2027:[null,230],2028:[null,230],2029:[null,230],2030:[null,230],2031:[null,230],2032:[null,230],2033:[null,230],2034:[null,220],2035:[null,230]},2048:{2070:[null,230],2071:[null,230],2072:[null,230],2073:[null,230],2075:[null,230],2076:[null,230],2077:[null,230],2078:[null,230],2079:[null,230],2080:[null,230],2081:[null,230],2082:[null,230],2083:[null,230],2085:[null,230],2086:[null,230],2087:[null,230],2089:[null,230],2090:[null,230],2091:[null,230],2092:[null,230],2093:[null,230],2137:[null,220],2138:[null,220],2139:[null,220],2276:[null,230],2277:[null,230],2278:[null,220],2279:[null,230],2280:[null,230],2281:[null,220],2282:[null,230],2283:[null,230],2284:[null,230],2285:[null,220],2286:[null,220],2287:[null,220],2288:[null,27],2289:[null,28],2290:[null,29],2291:[null,230],2292:[null,230],2293:[null,230],2294:[null,220],2295:[null,230],2296:[null,230],2297:[null,220],2298:[null,220],2299:[null,230],2300:[null,230],2301:[null,230],2302:[null,230],2303:[null,230]},2304:{2344:[null,null,{2364:2345}],2345:[[2344,2364]],2352:[null,null,{2364:2353}],2353:[[2352,2364]],2355:[null,null,{2364:2356}],2356:[[2355,2364]],2364:[null,7],2381:[null,9],2385:[null,230],2386:[null,220],2387:[null,230],2388:[null,230],2392:[[2325,2364],512],2393:[[2326,2364],512],2394:[[2327,2364],512],2395:[[2332,2364],512],2396:[[2337,2364],512],2397:[[2338,2364],512],2398:[[2347,2364],512],2399:[[2351,2364],512],2492:[null,7],2503:[null,null,{2494:2507,2519:2508}],2507:[[2503,2494]],2508:[[2503,2519]],2509:[null,9],2524:[[2465,2492],512],2525:[[2466,2492],512],2527:[[2479,2492],512]},2560:{2611:[[2610,2620],512],2614:[[2616,2620],512],2620:[null,7],2637:[null,9],2649:[[2582,2620],512],2650:[[2583,2620],512],2651:[[2588,2620],512],2654:[[2603,2620],512],2748:[null,7],2765:[null,9],68109:[null,220],68111:[null,230],68152:[null,230],68153:[null,1],68154:[null,220],68159:[null,9],68325:[null,230],68326:[null,220]},2816:{2876:[null,7],2887:[null,null,{2878:2891,2902:2888,2903:2892}],2888:[[2887,2902]],2891:[[2887,2878]],2892:[[2887,2903]],2893:[null,9],2908:[[2849,2876],512],2909:[[2850,2876],512],2962:[null,null,{3031:2964}],2964:[[2962,3031]],3014:[null,null,{3006:3018,3031:3020}],3015:[null,null,{3006:3019}],3018:[[3014,3006]],3019:[[3015,3006]],3020:[[3014,3031]],3021:[null,9]},3072:{3142:[null,null,{3158:3144}],3144:[[3142,3158]],3149:[null,9],3157:[null,84],3158:[null,91],3260:[null,7],3263:[null,null,{3285:3264}],3264:[[3263,3285]],3270:[null,null,{3266:3274,3285:3271,3286:3272}],3271:[[3270,3285]],3272:[[3270,3286]],3274:[[3270,3266],null,{3285:3275}],3275:[[3274,3285]],3277:[null,9]},3328:{3398:[null,null,{3390:3402,3415:3404}],3399:[null,null,{3390:3403}],3402:[[3398,3390]],3403:[[3399,3390]],3404:[[3398,3415]],3405:[null,9],3530:[null,9],3545:[null,null,{3530:3546,3535:3548,3551:3550}],3546:[[3545,3530]],3548:[[3545,3535],null,{3530:3549}],3549:[[3548,3530]],3550:[[3545,3551]]},3584:{3635:[[3661,3634],256],3640:[null,103],3641:[null,103],3642:[null,9],3656:[null,107],3657:[null,107],3658:[null,107],3659:[null,107],3763:[[3789,3762],256],3768:[null,118],3769:[null,118],3784:[null,122],3785:[null,122],3786:[null,122],3787:[null,122],3804:[[3755,3737],256],3805:[[3755,3745],256]},3840:{3852:[[3851],256],3864:[null,220],3865:[null,220],3893:[null,220],3895:[null,220],3897:[null,216],3907:[[3906,4023],512],3917:[[3916,4023],512],3922:[[3921,4023],512],3927:[[3926,4023],512],3932:[[3931,4023],512],3945:[[3904,4021],512],3953:[null,129],3954:[null,130],3955:[[3953,3954],512],3956:[null,132],3957:[[3953,3956],512],3958:[[4018,3968],512],3959:[[4018,3969],256],3960:[[4019,3968],512],3961:[[4019,3969],256],3962:[null,130],3963:[null,130],3964:[null,130],3965:[null,130],3968:[null,130],3969:[[3953,3968],512],3970:[null,230],3971:[null,230],3972:[null,9],3974:[null,230],3975:[null,230],3987:[[3986,4023],512],3997:[[3996,4023],512],4002:[[4001,4023],512],4007:[[4006,4023],512],4012:[[4011,4023],512],4025:[[3984,4021],512],4038:[null,220]},4096:{4133:[null,null,{4142:4134}],4134:[[4133,4142]],4151:[null,7],4153:[null,9],4154:[null,9],4237:[null,220],4348:[[4316],256],69702:[null,9],69759:[null,9],69785:[null,null,{69818:69786}],69786:[[69785,69818]],69787:[null,null,{69818:69788}],69788:[[69787,69818]],69797:[null,null,{69818:69803}],69803:[[69797,69818]],69817:[null,9],69818:[null,7]},4352:{69888:[null,230],69889:[null,230],69890:[null,230],69934:[[69937,69927]],69935:[[69938,69927]],69937:[null,null,{69927:69934}],69938:[null,null,{69927:69935}],69939:[null,9],69940:[null,9],70003:[null,7],70080:[null,9]},4608:{70197:[null,9],70198:[null,7],70377:[null,7],70378:[null,9]},4864:{4957:[null,230],4958:[null,230],4959:[null,230],70460:[null,7],70471:[null,null,{70462:70475,70487:70476}],70475:[[70471,70462]],70476:[[70471,70487]],70477:[null,9],70502:[null,230],70503:[null,230],70504:[null,230],70505:[null,230],70506:[null,230],70507:[null,230],70508:[null,230],70512:[null,230],70513:[null,230],70514:[null,230],70515:[null,230],70516:[null,230]},5120:{70841:[null,null,{70832:70844,70842:70843,70845:70846}],70843:[[70841,70842]],70844:[[70841,70832]],70846:[[70841,70845]],70850:[null,9],70851:[null,7]},5376:{71096:[null,null,{71087:71098}],71097:[null,null,{71087:71099}],71098:[[71096,71087]],71099:[[71097,71087]],71103:[null,9],71104:[null,7]},5632:{71231:[null,9],71350:[null,9],71351:[null,7]},5888:{5908:[null,9],5940:[null,9],6098:[null,9],6109:[null,230]},6144:{6313:[null,228]},6400:{6457:[null,222],6458:[null,230],6459:[null,220]},6656:{6679:[null,230],6680:[null,220],6752:[null,9],6773:[null,230],6774:[null,230],6775:[null,230],6776:[null,230],6777:[null,230],6778:[null,230],6779:[null,230],6780:[null,230],6783:[null,220],6832:[null,230],6833:[null,230],6834:[null,230],6835:[null,230],6836:[null,230],6837:[null,220],6838:[null,220],6839:[null,220],6840:[null,220],6841:[null,220],6842:[null,220],6843:[null,230],6844:[null,230],6845:[null,220]},6912:{6917:[null,null,{6965:6918}],6918:[[6917,6965]],6919:[null,null,{6965:6920}],6920:[[6919,6965]],6921:[null,null,{6965:6922}],6922:[[6921,6965]],6923:[null,null,{6965:6924}],6924:[[6923,6965]],6925:[null,null,{6965:6926}],6926:[[6925,6965]],6929:[null,null,{6965:6930}],6930:[[6929,6965]],6964:[null,7],6970:[null,null,{6965:6971}],6971:[[6970,6965]],6972:[null,null,{6965:6973}],6973:[[6972,6965]],6974:[null,null,{6965:6976}],6975:[null,null,{6965:6977}],6976:[[6974,6965]],6977:[[6975,6965]],6978:[null,null,{6965:6979}],6979:[[6978,6965]],6980:[null,9],7019:[null,230],7020:[null,220],7021:[null,230],7022:[null,230],7023:[null,230],7024:[null,230],7025:[null,230],7026:[null,230],7027:[null,230],7082:[null,9],7083:[null,9],7142:[null,7],7154:[null,9],7155:[null,9]},7168:{7223:[null,7],7376:[null,230],7377:[null,230],7378:[null,230],7380:[null,1],7381:[null,220],7382:[null,220],7383:[null,220],7384:[null,220],7385:[null,220],7386:[null,230],7387:[null,230],7388:[null,220],7389:[null,220],7390:[null,220],7391:[null,220],7392:[null,230],7394:[null,1],7395:[null,1],7396:[null,1],7397:[null,1],7398:[null,1],7399:[null,1],7400:[null,1],7405:[null,220],7412:[null,230],7416:[null,230],7417:[null,230]},7424:{7468:[[65],256],7469:[[198],256],7470:[[66],256],7472:[[68],256],7473:[[69],256],7474:[[398],256],7475:[[71],256],7476:[[72],256],7477:[[73],256],7478:[[74],256],7479:[[75],256],7480:[[76],256],7481:[[77],256],7482:[[78],256],7484:[[79],256],7485:[[546],256],7486:[[80],256],7487:[[82],256],7488:[[84],256],7489:[[85],256],7490:[[87],256],7491:[[97],256],7492:[[592],256],7493:[[593],256],7494:[[7426],256],7495:[[98],256],7496:[[100],256],7497:[[101],256],7498:[[601],256],7499:[[603],256],7500:[[604],256],7501:[[103],256],7503:[[107],256],7504:[[109],256],7505:[[331],256],7506:[[111],256],7507:[[596],256],7508:[[7446],256],7509:[[7447],256],7510:[[112],256],7511:[[116],256],7512:[[117],256],7513:[[7453],256],7514:[[623],256],7515:[[118],256],7516:[[7461],256],7517:[[946],256],7518:[[947],256],7519:[[948],256],7520:[[966],256],7521:[[967],256],7522:[[105],256],7523:[[114],256],7524:[[117],256],7525:[[118],256],7526:[[946],256],7527:[[947],256],7528:[[961],256],7529:[[966],256],7530:[[967],256],7544:[[1085],256],7579:[[594],256],7580:[[99],256],7581:[[597],256],7582:[[240],256],7583:[[604],256],7584:[[102],256],7585:[[607],256],7586:[[609],256],7587:[[613],256],7588:[[616],256],7589:[[617],256],7590:[[618],256],7591:[[7547],256],7592:[[669],256],7593:[[621],256],7594:[[7557],256],7595:[[671],256],7596:[[625],256],7597:[[624],256],7598:[[626],256],7599:[[627],256],7600:[[628],256],7601:[[629],256],7602:[[632],256],7603:[[642],256],7604:[[643],256],7605:[[427],256],7606:[[649],256],7607:[[650],256],7608:[[7452],256],7609:[[651],256],7610:[[652],256],7611:[[122],256],7612:[[656],256],7613:[[657],256],7614:[[658],256],7615:[[952],256],7616:[null,230],7617:[null,230],7618:[null,220],7619:[null,230],7620:[null,230],7621:[null,230],7622:[null,230],7623:[null,230],7624:[null,230],7625:[null,230],7626:[null,220],7627:[null,230],7628:[null,230],7629:[null,234],7630:[null,214],7631:[null,220],7632:[null,202],7633:[null,230],7634:[null,230],7635:[null,230],7636:[null,230],7637:[null,230],7638:[null,230],7639:[null,230],7640:[null,230],7641:[null,230],7642:[null,230],7643:[null,230],7644:[null,230],7645:[null,230],7646:[null,230],7647:[null,230],7648:[null,230],7649:[null,230],7650:[null,230],7651:[null,230],7652:[null,230],7653:[null,230],7654:[null,230],7655:[null,230],7656:[null,230],7657:[null,230],7658:[null,230],7659:[null,230],7660:[null,230],7661:[null,230],7662:[null,230],7663:[null,230],7664:[null,230],7665:[null,230],7666:[null,230],7667:[null,230],7668:[null,230],7669:[null,230],7676:[null,233],7677:[null,220],7678:[null,230],7679:[null,220]},7680:{7680:[[65,805]],7681:[[97,805]],7682:[[66,775]],7683:[[98,775]],7684:[[66,803]],7685:[[98,803]],7686:[[66,817]],7687:[[98,817]],7688:[[199,769]],7689:[[231,769]],7690:[[68,775]],7691:[[100,775]],7692:[[68,803]],7693:[[100,803]],7694:[[68,817]],7695:[[100,817]],7696:[[68,807]],7697:[[100,807]],7698:[[68,813]],7699:[[100,813]],7700:[[274,768]],7701:[[275,768]],7702:[[274,769]],7703:[[275,769]],7704:[[69,813]],7705:[[101,813]],7706:[[69,816]],7707:[[101,816]],7708:[[552,774]],7709:[[553,774]],7710:[[70,775]],7711:[[102,775]],7712:[[71,772]],7713:[[103,772]],7714:[[72,775]],7715:[[104,775]],7716:[[72,803]],7717:[[104,803]],7718:[[72,776]],7719:[[104,776]],7720:[[72,807]],7721:[[104,807]],7722:[[72,814]],7723:[[104,814]],7724:[[73,816]],7725:[[105,816]],7726:[[207,769]],7727:[[239,769]],7728:[[75,769]],7729:[[107,769]],7730:[[75,803]],7731:[[107,803]],7732:[[75,817]],7733:[[107,817]],7734:[[76,803],null,{772:7736}],7735:[[108,803],null,{772:7737}],7736:[[7734,772]],7737:[[7735,772]],7738:[[76,817]],7739:[[108,817]],7740:[[76,813]],7741:[[108,813]],7742:[[77,769]],7743:[[109,769]],7744:[[77,775]],7745:[[109,775]],7746:[[77,803]],7747:[[109,803]],7748:[[78,775]],7749:[[110,775]],7750:[[78,803]],7751:[[110,803]],7752:[[78,817]],7753:[[110,817]],7754:[[78,813]],7755:[[110,813]],7756:[[213,769]],7757:[[245,769]],7758:[[213,776]],7759:[[245,776]],7760:[[332,768]],7761:[[333,768]],7762:[[332,769]],7763:[[333,769]],7764:[[80,769]],7765:[[112,769]],7766:[[80,775]],7767:[[112,775]],7768:[[82,775]],7769:[[114,775]],7770:[[82,803],null,{772:7772}],7771:[[114,803],null,{772:7773}],7772:[[7770,772]],7773:[[7771,772]],7774:[[82,817]],7775:[[114,817]],7776:[[83,775]],7777:[[115,775]],7778:[[83,803],null,{775:7784}],7779:[[115,803],null,{775:7785}],7780:[[346,775]],7781:[[347,775]],7782:[[352,775]],7783:[[353,775]],7784:[[7778,775]],7785:[[7779,775]],7786:[[84,775]],7787:[[116,775]],7788:[[84,803]],7789:[[116,803]],7790:[[84,817]],7791:[[116,817]],7792:[[84,813]],7793:[[116,813]],7794:[[85,804]],7795:[[117,804]],7796:[[85,816]],7797:[[117,816]],7798:[[85,813]],7799:[[117,813]],7800:[[360,769]],7801:[[361,769]],7802:[[362,776]],7803:[[363,776]],7804:[[86,771]],7805:[[118,771]],7806:[[86,803]],7807:[[118,803]],7808:[[87,768]],7809:[[119,768]],7810:[[87,769]],7811:[[119,769]],7812:[[87,776]],7813:[[119,776]],7814:[[87,775]],7815:[[119,775]],7816:[[87,803]],7817:[[119,803]],7818:[[88,775]],7819:[[120,775]],7820:[[88,776]],7821:[[120,776]],7822:[[89,775]],7823:[[121,775]],7824:[[90,770]],7825:[[122,770]],7826:[[90,803]],7827:[[122,803]],7828:[[90,817]],7829:[[122,817]],7830:[[104,817]],7831:[[116,776]],7832:[[119,778]],7833:[[121,778]],7834:[[97,702],256],7835:[[383,775]],7840:[[65,803],null,{770:7852,774:7862}],7841:[[97,803],null,{770:7853,774:7863}],7842:[[65,777]],7843:[[97,777]],7844:[[194,769]],7845:[[226,769]],7846:[[194,768]],7847:[[226,768]],7848:[[194,777]],7849:[[226,777]],7850:[[194,771]],7851:[[226,771]],7852:[[7840,770]],7853:[[7841,770]],7854:[[258,769]],7855:[[259,769]],7856:[[258,768]],7857:[[259,768]],7858:[[258,777]],7859:[[259,777]],7860:[[258,771]],7861:[[259,771]],7862:[[7840,774]],7863:[[7841,774]],7864:[[69,803],null,{770:7878}],7865:[[101,803],null,{770:7879}],7866:[[69,777]],7867:[[101,777]],7868:[[69,771]],7869:[[101,771]],7870:[[202,769]],7871:[[234,769]],7872:[[202,768]],7873:[[234,768]],7874:[[202,777]],7875:[[234,777]],7876:[[202,771]],7877:[[234,771]],7878:[[7864,770]],7879:[[7865,770]],7880:[[73,777]],7881:[[105,777]],7882:[[73,803]],7883:[[105,803]],7884:[[79,803],null,{770:7896}],7885:[[111,803],null,{770:7897}],7886:[[79,777]],7887:[[111,777]],7888:[[212,769]],7889:[[244,769]],7890:[[212,768]],7891:[[244,768]],7892:[[212,777]],7893:[[244,777]],7894:[[212,771]],7895:[[244,771]],7896:[[7884,770]],7897:[[7885,770]],7898:[[416,769]],7899:[[417,769]],7900:[[416,768]],7901:[[417,768]],7902:[[416,777]],7903:[[417,777]],7904:[[416,771]],7905:[[417,771]],7906:[[416,803]],7907:[[417,803]],7908:[[85,803]],7909:[[117,803]],7910:[[85,777]],7911:[[117,777]],7912:[[431,769]],7913:[[432,769]],7914:[[431,768]],7915:[[432,768]],7916:[[431,777]],7917:[[432,777]],7918:[[431,771]],7919:[[432,771]],7920:[[431,803]],7921:[[432,803]],7922:[[89,768]],7923:[[121,768]],7924:[[89,803]],7925:[[121,803]],7926:[[89,777]],7927:[[121,777]],7928:[[89,771]],7929:[[121,771]]},7936:{7936:[[945,787],null,{768:7938,769:7940,834:7942,837:8064}],7937:[[945,788],null,{768:7939,769:7941,834:7943,837:8065}],7938:[[7936,768],null,{837:8066}],7939:[[7937,768],null,{837:8067}],7940:[[7936,769],null,{837:8068}],7941:[[7937,769],null,{837:8069}],7942:[[7936,834],null,{837:8070}],7943:[[7937,834],null,{837:8071}],7944:[[913,787],null,{768:7946,769:7948,834:7950,837:8072}],7945:[[913,788],null,{768:7947,769:7949,834:7951,837:8073}],7946:[[7944,768],null,{837:8074}],7947:[[7945,768],null,{837:8075}],7948:[[7944,769],null,{837:8076}],7949:[[7945,769],null,{837:8077}],7950:[[7944,834],null,{837:8078}],7951:[[7945,834],null,{837:8079}],7952:[[949,787],null,{768:7954,769:7956}],7953:[[949,788],null,{768:7955,769:7957}],7954:[[7952,768]],7955:[[7953,768]],7956:[[7952,769]],7957:[[7953,769]],7960:[[917,787],null,{768:7962,769:7964}],7961:[[917,788],null,{768:7963,769:7965}],7962:[[7960,768]],7963:[[7961,768]],7964:[[7960,769]],7965:[[7961,769]],7968:[[951,787],null,{768:7970,769:7972,834:7974,837:8080}],7969:[[951,788],null,{768:7971,769:7973,834:7975,837:8081}],7970:[[7968,768],null,{837:8082}],7971:[[7969,768],null,{837:8083}],7972:[[7968,769],null,{837:8084}],7973:[[7969,769],null,{837:8085}],7974:[[7968,834],null,{837:8086}],7975:[[7969,834],null,{837:8087}],7976:[[919,787],null,{768:7978,769:7980,834:7982,837:8088}],7977:[[919,788],null,{768:7979,769:7981,834:7983,837:8089}],7978:[[7976,768],null,{837:8090}],7979:[[7977,768],null,{837:8091}],7980:[[7976,769],null,{837:8092}],7981:[[7977,769],null,{837:8093}],7982:[[7976,834],null,{837:8094}],7983:[[7977,834],null,{837:8095}],7984:[[953,787],null,{768:7986,769:7988,834:7990}],7985:[[953,788],null,{768:7987,769:7989,834:7991}],7986:[[7984,768]],7987:[[7985,768]],7988:[[7984,769]],7989:[[7985,769]],7990:[[7984,834]],7991:[[7985,834]],7992:[[921,787],null,{768:7994,769:7996,834:7998}],7993:[[921,788],null,{768:7995,769:7997,834:7999}],7994:[[7992,768]],7995:[[7993,768]],7996:[[7992,769]],7997:[[7993,769]],7998:[[7992,834]],7999:[[7993,834]],8000:[[959,787],null,{768:8002,769:8004}],8001:[[959,788],null,{768:8003,769:8005}],8002:[[8e3,768]],8003:[[8001,768]],8004:[[8e3,769]],8005:[[8001,769]],8008:[[927,787],null,{768:8010,769:8012}],8009:[[927,788],null,{768:8011,769:8013}],8010:[[8008,768]],8011:[[8009,768]],8012:[[8008,769]],8013:[[8009,769]],8016:[[965,787],null,{768:8018,769:8020,834:8022}],8017:[[965,788],null,{768:8019,769:8021,834:8023}],8018:[[8016,768]],8019:[[8017,768]],8020:[[8016,769]],8021:[[8017,769]],8022:[[8016,834]],8023:[[8017,834]],8025:[[933,788],null,{768:8027,769:8029,834:8031}],8027:[[8025,768]],8029:[[8025,769]],8031:[[8025,834]],8032:[[969,787],null,{768:8034,769:8036,834:8038,837:8096}],8033:[[969,788],null,{768:8035,769:8037,834:8039,837:8097}],8034:[[8032,768],null,{837:8098}],8035:[[8033,768],null,{837:8099}],8036:[[8032,769],null,{837:8100}],8037:[[8033,769],null,{837:8101}],8038:[[8032,834],null,{837:8102}],8039:[[8033,834],null,{837:8103}],8040:[[937,787],null,{768:8042,769:8044,834:8046,837:8104}],8041:[[937,788],null,{768:8043,769:8045,834:8047,837:8105}],8042:[[8040,768],null,{837:8106}],8043:[[8041,768],null,{837:8107}],8044:[[8040,769],null,{837:8108}],8045:[[8041,769],null,{837:8109}],8046:[[8040,834],null,{837:8110}],8047:[[8041,834],null,{837:8111}],8048:[[945,768],null,{837:8114}],8049:[[940]],8050:[[949,768]],8051:[[941]],8052:[[951,768],null,{837:8130}],8053:[[942]],8054:[[953,768]],8055:[[943]],8056:[[959,768]],8057:[[972]],8058:[[965,768]],8059:[[973]],8060:[[969,768],null,{837:8178}],8061:[[974]],8064:[[7936,837]],8065:[[7937,837]],8066:[[7938,837]],8067:[[7939,837]],8068:[[7940,837]],8069:[[7941,837]],8070:[[7942,837]],8071:[[7943,837]],8072:[[7944,837]],8073:[[7945,837]],8074:[[7946,837]],8075:[[7947,837]],8076:[[7948,837]],8077:[[7949,837]],8078:[[7950,837]],8079:[[7951,837]],8080:[[7968,837]],8081:[[7969,837]],8082:[[7970,837]],8083:[[7971,837]],8084:[[7972,837]],8085:[[7973,837]],8086:[[7974,837]],8087:[[7975,837]],8088:[[7976,837]],8089:[[7977,837]],8090:[[7978,837]],8091:[[7979,837]],8092:[[7980,837]],8093:[[7981,837]],8094:[[7982,837]],8095:[[7983,837]],8096:[[8032,837]],8097:[[8033,837]],8098:[[8034,837]],8099:[[8035,837]],8100:[[8036,837]],8101:[[8037,837]],8102:[[8038,837]],8103:[[8039,837]],8104:[[8040,837]],8105:[[8041,837]],8106:[[8042,837]],8107:[[8043,837]],8108:[[8044,837]],8109:[[8045,837]],8110:[[8046,837]],8111:[[8047,837]],8112:[[945,774]],8113:[[945,772]],8114:[[8048,837]],8115:[[945,837]],8116:[[940,837]],8118:[[945,834],null,{837:8119}],8119:[[8118,837]],8120:[[913,774]],8121:[[913,772]],8122:[[913,768]],8123:[[902]],8124:[[913,837]],8125:[[32,787],256],8126:[[953]],8127:[[32,787],256,{768:8141,769:8142,834:8143}],8128:[[32,834],256],8129:[[168,834]],8130:[[8052,837]],8131:[[951,837]],8132:[[942,837]],8134:[[951,834],null,{837:8135}],8135:[[8134,837]],8136:[[917,768]],8137:[[904]],8138:[[919,768]],8139:[[905]],8140:[[919,837]],8141:[[8127,768]],8142:[[8127,769]],8143:[[8127,834]],8144:[[953,774]],8145:[[953,772]],8146:[[970,768]],8147:[[912]],8150:[[953,834]],8151:[[970,834]],8152:[[921,774]],8153:[[921,772]],8154:[[921,768]],8155:[[906]],8157:[[8190,768]],8158:[[8190,769]],8159:[[8190,834]],8160:[[965,774]],8161:[[965,772]],8162:[[971,768]],8163:[[944]],8164:[[961,787]],8165:[[961,788]],8166:[[965,834]],8167:[[971,834]],8168:[[933,774]],8169:[[933,772]],8170:[[933,768]],8171:[[910]],8172:[[929,788]],8173:[[168,768]],8174:[[901]],8175:[[96]],8178:[[8060,837]],8179:[[969,837]],8180:[[974,837]],8182:[[969,834],null,{837:8183}],8183:[[8182,837]],8184:[[927,768]],8185:[[908]],8186:[[937,768]],8187:[[911]],8188:[[937,837]],8189:[[180]],8190:[[32,788],256,{768:8157,769:8158,834:8159}]},8192:{8192:[[8194]],8193:[[8195]],8194:[[32],256],8195:[[32],256],8196:[[32],256],8197:[[32],256],8198:[[32],256],8199:[[32],256],8200:[[32],256],8201:[[32],256],8202:[[32],256],8209:[[8208],256],8215:[[32,819],256],8228:[[46],256],8229:[[46,46],256],8230:[[46,46,46],256],8239:[[32],256],8243:[[8242,8242],256],8244:[[8242,8242,8242],256],8246:[[8245,8245],256],8247:[[8245,8245,8245],256],8252:[[33,33],256],8254:[[32,773],256],8263:[[63,63],256],8264:[[63,33],256],8265:[[33,63],256],8279:[[8242,8242,8242,8242],256],8287:[[32],256],8304:[[48],256],8305:[[105],256],8308:[[52],256],8309:[[53],256],8310:[[54],256],8311:[[55],256],8312:[[56],256],8313:[[57],256],8314:[[43],256],8315:[[8722],256],8316:[[61],256],8317:[[40],256],8318:[[41],256],8319:[[110],256],8320:[[48],256],8321:[[49],256],8322:[[50],256],8323:[[51],256],8324:[[52],256],8325:[[53],256],8326:[[54],256],8327:[[55],256],8328:[[56],256],8329:[[57],256],8330:[[43],256],8331:[[8722],256],8332:[[61],256],8333:[[40],256],8334:[[41],256],8336:[[97],256],8337:[[101],256],8338:[[111],256],8339:[[120],256],8340:[[601],256],8341:[[104],256],8342:[[107],256],8343:[[108],256],8344:[[109],256],8345:[[110],256],8346:[[112],256],8347:[[115],256],8348:[[116],256],8360:[[82,115],256],8400:[null,230],8401:[null,230],8402:[null,1],8403:[null,1],8404:[null,230],8405:[null,230],8406:[null,230],8407:[null,230],8408:[null,1],8409:[null,1],8410:[null,1],8411:[null,230],8412:[null,230],8417:[null,230],8421:[null,1],8422:[null,1],8423:[null,230],8424:[null,220],8425:[null,230],8426:[null,1],8427:[null,1],8428:[null,220],8429:[null,220],8430:[null,220],8431:[null,220],8432:[null,230]},8448:{8448:[[97,47,99],256],8449:[[97,47,115],256],8450:[[67],256],8451:[[176,67],256],8453:[[99,47,111],256],8454:[[99,47,117],256],8455:[[400],256],8457:[[176,70],256],8458:[[103],256],8459:[[72],256],8460:[[72],256],8461:[[72],256],8462:[[104],256],8463:[[295],256],8464:[[73],256],8465:[[73],256],8466:[[76],256],8467:[[108],256],8469:[[78],256],8470:[[78,111],256],8473:[[80],256],8474:[[81],256],8475:[[82],256],8476:[[82],256],8477:[[82],256],8480:[[83,77],256],8481:[[84,69,76],256],8482:[[84,77],256],8484:[[90],256],8486:[[937]],8488:[[90],256],8490:[[75]],8491:[[197]],8492:[[66],256],8493:[[67],256],8495:[[101],256],8496:[[69],256],8497:[[70],256],8499:[[77],256],8500:[[111],256],8501:[[1488],256],8502:[[1489],256],8503:[[1490],256],8504:[[1491],256],8505:[[105],256],8507:[[70,65,88],256],8508:[[960],256],8509:[[947],256],8510:[[915],256],8511:[[928],256],8512:[[8721],256],8517:[[68],256],8518:[[100],256],8519:[[101],256],8520:[[105],256],8521:[[106],256],8528:[[49,8260,55],256],8529:[[49,8260,57],256],8530:[[49,8260,49,48],256],8531:[[49,8260,51],256],8532:[[50,8260,51],256],8533:[[49,8260,53],256],8534:[[50,8260,53],256],8535:[[51,8260,53],256],8536:[[52,8260,53],256],8537:[[49,8260,54],256],8538:[[53,8260,54],256],8539:[[49,8260,56],256],8540:[[51,8260,56],256],8541:[[53,8260,56],256],8542:[[55,8260,56],256],8543:[[49,8260],256],8544:[[73],256],8545:[[73,73],256],8546:[[73,73,73],256],8547:[[73,86],256],8548:[[86],256],8549:[[86,73],256],8550:[[86,73,73],256],8551:[[86,73,73,73],256],8552:[[73,88],256],8553:[[88],256],8554:[[88,73],256],8555:[[88,73,73],256],8556:[[76],256],8557:[[67],256],8558:[[68],256],8559:[[77],256],8560:[[105],256],8561:[[105,105],256],8562:[[105,105,105],256],8563:[[105,118],256],8564:[[118],256],8565:[[118,105],256],8566:[[118,105,105],256],8567:[[118,105,105,105],256],8568:[[105,120],256],8569:[[120],256],8570:[[120,105],256],8571:[[120,105,105],256],8572:[[108],256],8573:[[99],256],8574:[[100],256],8575:[[109],256],8585:[[48,8260,51],256],8592:[null,null,{824:8602}],8594:[null,null,{824:8603}],8596:[null,null,{824:8622}],8602:[[8592,824]],8603:[[8594,824]],8622:[[8596,824]],8653:[[8656,824]],8654:[[8660,824]],8655:[[8658,824]],8656:[null,null,{824:8653}],8658:[null,null,{824:8655}],8660:[null,null,{824:8654}]},8704:{8707:[null,null,{824:8708}],8708:[[8707,824]],8712:[null,null,{824:8713}],8713:[[8712,824]],8715:[null,null,{824:8716}],8716:[[8715,824]],8739:[null,null,{824:8740}],8740:[[8739,824]],8741:[null,null,{824:8742}],8742:[[8741,824]],8748:[[8747,8747],256],8749:[[8747,8747,8747],256],8751:[[8750,8750],256],8752:[[8750,8750,8750],256],8764:[null,null,{824:8769}],8769:[[8764,824]],8771:[null,null,{824:8772}],8772:[[8771,824]],8773:[null,null,{824:8775}],8775:[[8773,824]],8776:[null,null,{824:8777}],8777:[[8776,824]],8781:[null,null,{824:8813}],8800:[[61,824]],8801:[null,null,{824:8802}],8802:[[8801,824]],8804:[null,null,{824:8816}],8805:[null,null,{824:8817}],8813:[[8781,824]],8814:[[60,824]],8815:[[62,824]],8816:[[8804,824]],8817:[[8805,824]],8818:[null,null,{824:8820}],8819:[null,null,{824:8821}],8820:[[8818,824]],8821:[[8819,824]],8822:[null,null,{824:8824}],8823:[null,null,{824:8825}],8824:[[8822,824]],8825:[[8823,824]],8826:[null,null,{824:8832}],8827:[null,null,{824:8833}],8828:[null,null,{824:8928}],8829:[null,null,{824:8929}],8832:[[8826,824]],8833:[[8827,824]],8834:[null,null,{824:8836}],8835:[null,null,{824:8837}],8836:[[8834,824]],8837:[[8835,824]],8838:[null,null,{824:8840}],8839:[null,null,{824:8841}],8840:[[8838,824]],8841:[[8839,824]],8849:[null,null,{824:8930}],8850:[null,null,{824:8931}],8866:[null,null,{824:8876}],8872:[null,null,{824:8877}],8873:[null,null,{824:8878}],8875:[null,null,{824:8879}],8876:[[8866,824]],8877:[[8872,824]],8878:[[8873,824]],8879:[[8875,824]],8882:[null,null,{824:8938}],8883:[null,null,{824:8939}],8884:[null,null,{824:8940}],8885:[null,null,{824:8941}],8928:[[8828,824]],8929:[[8829,824]],8930:[[8849,824]],8931:[[8850,824]],8938:[[8882,824]],8939:[[8883,824]],8940:[[8884,824]],8941:[[8885,824]]},8960:{9001:[[12296]],9002:[[12297]]},9216:{9312:[[49],256],9313:[[50],256],9314:[[51],256],9315:[[52],256],9316:[[53],256],9317:[[54],256],9318:[[55],256],9319:[[56],256],9320:[[57],256],9321:[[49,48],256],9322:[[49,49],256],9323:[[49,50],256],9324:[[49,51],256],9325:[[49,52],256],9326:[[49,53],256],9327:[[49,54],256],9328:[[49,55],256],9329:[[49,56],256],9330:[[49,57],256],9331:[[50,48],256],9332:[[40,49,41],256],9333:[[40,50,41],256],9334:[[40,51,41],256],9335:[[40,52,41],256],9336:[[40,53,41],256],9337:[[40,54,41],256],9338:[[40,55,41],256],9339:[[40,56,41],256],9340:[[40,57,41],256],9341:[[40,49,48,41],256],9342:[[40,49,49,41],256],9343:[[40,49,50,41],256],9344:[[40,49,51,41],256],9345:[[40,49,52,41],256],9346:[[40,49,53,41],256],9347:[[40,49,54,41],256],9348:[[40,49,55,41],256],9349:[[40,49,56,41],256],9350:[[40,49,57,41],256],9351:[[40,50,48,41],256],9352:[[49,46],256],9353:[[50,46],256],9354:[[51,46],256],9355:[[52,46],256],9356:[[53,46],256],9357:[[54,46],256],9358:[[55,46],256],9359:[[56,46],256],9360:[[57,46],256],9361:[[49,48,46],256],9362:[[49,49,46],256],9363:[[49,50,46],256],9364:[[49,51,46],256],9365:[[49,52,46],256],9366:[[49,53,46],256],9367:[[49,54,46],256],9368:[[49,55,46],256],9369:[[49,56,46],256],9370:[[49,57,46],256],9371:[[50,48,46],256],9372:[[40,97,41],256],9373:[[40,98,41],256],9374:[[40,99,41],256],9375:[[40,100,41],256],9376:[[40,101,41],256],9377:[[40,102,41],256],9378:[[40,103,41],256],9379:[[40,104,41],256],9380:[[40,105,41],256],9381:[[40,106,41],256],9382:[[40,107,41],256],9383:[[40,108,41],256],9384:[[40,109,41],256],9385:[[40,110,41],256],9386:[[40,111,41],256],9387:[[40,112,41],256],9388:[[40,113,41],256],9389:[[40,114,41],256],9390:[[40,115,41],256],9391:[[40,116,41],256],9392:[[40,117,41],256],9393:[[40,118,41],256],9394:[[40,119,41],256],9395:[[40,120,41],256],9396:[[40,121,41],256],9397:[[40,122,41],256],9398:[[65],256],9399:[[66],256],9400:[[67],256],9401:[[68],256],9402:[[69],256],9403:[[70],256],9404:[[71],256],9405:[[72],256],9406:[[73],256],9407:[[74],256],9408:[[75],256],9409:[[76],256],9410:[[77],256],9411:[[78],256],9412:[[79],256],9413:[[80],256],9414:[[81],256],9415:[[82],256],9416:[[83],256],9417:[[84],256],9418:[[85],256],9419:[[86],256],9420:[[87],256],9421:[[88],256],9422:[[89],256],9423:[[90],256],9424:[[97],256],9425:[[98],256],9426:[[99],256],9427:[[100],256],9428:[[101],256],9429:[[102],256],9430:[[103],256],9431:[[104],256],9432:[[105],256],9433:[[106],256],9434:[[107],256],9435:[[108],256],9436:[[109],256],9437:[[110],256],9438:[[111],256],9439:[[112],256],9440:[[113],256],9441:[[114],256],9442:[[115],256],9443:[[116],256],9444:[[117],256],9445:[[118],256],9446:[[119],256],9447:[[120],256],9448:[[121],256],9449:[[122],256],9450:[[48],256]},10752:{10764:[[8747,8747,8747,8747],256],10868:[[58,58,61],256],10869:[[61,61],256],10870:[[61,61,61],256],10972:[[10973,824],512]},11264:{11388:[[106],256],11389:[[86],256],11503:[null,230],11504:[null,230],11505:[null,230]},11520:{11631:[[11617],256],11647:[null,9],11744:[null,230],11745:[null,230],11746:[null,230],11747:[null,230],11748:[null,230],11749:[null,230],11750:[null,230],11751:[null,230],11752:[null,230],11753:[null,230],11754:[null,230],11755:[null,230],11756:[null,230],11757:[null,230],11758:[null,230],11759:[null,230],11760:[null,230],11761:[null,230],11762:[null,230],11763:[null,230],11764:[null,230],11765:[null,230],11766:[null,230],11767:[null,230],11768:[null,230],11769:[null,230],11770:[null,230],11771:[null,230],11772:[null,230],11773:[null,230],11774:[null,230],11775:[null,230]},11776:{11935:[[27597],256],12019:[[40863],256]},12032:{12032:[[19968],256],12033:[[20008],256],12034:[[20022],256],12035:[[20031],256],12036:[[20057],256],12037:[[20101],256],12038:[[20108],256],12039:[[20128],256],12040:[[20154],256],12041:[[20799],256],12042:[[20837],256],12043:[[20843],256],12044:[[20866],256],12045:[[20886],256],12046:[[20907],256],12047:[[20960],256],12048:[[20981],256],12049:[[20992],256],12050:[[21147],256],12051:[[21241],256],12052:[[21269],256],12053:[[21274],256],12054:[[21304],256],12055:[[21313],256],12056:[[21340],256],12057:[[21353],256],12058:[[21378],256],12059:[[21430],256],12060:[[21448],256],12061:[[21475],256],12062:[[22231],256],12063:[[22303],256],12064:[[22763],256],12065:[[22786],256],12066:[[22794],256],12067:[[22805],256],12068:[[22823],256],12069:[[22899],256],12070:[[23376],256],12071:[[23424],256],12072:[[23544],256],12073:[[23567],256],12074:[[23586],256],12075:[[23608],256],12076:[[23662],256],12077:[[23665],256],12078:[[24027],256],12079:[[24037],256],12080:[[24049],256],12081:[[24062],256],12082:[[24178],256],12083:[[24186],256],12084:[[24191],256],12085:[[24308],256],12086:[[24318],256],12087:[[24331],256],12088:[[24339],256],12089:[[24400],256],12090:[[24417],256],12091:[[24435],256],12092:[[24515],256],12093:[[25096],256],12094:[[25142],256],12095:[[25163],256],12096:[[25903],256],12097:[[25908],256],12098:[[25991],256],12099:[[26007],256],12100:[[26020],256],12101:[[26041],256],12102:[[26080],256],12103:[[26085],256],12104:[[26352],256],12105:[[26376],256],12106:[[26408],256],12107:[[27424],256],12108:[[27490],256],12109:[[27513],256],12110:[[27571],256],12111:[[27595],256],12112:[[27604],256],12113:[[27611],256],12114:[[27663],256],12115:[[27668],256],12116:[[27700],256],12117:[[28779],256],12118:[[29226],256],12119:[[29238],256],12120:[[29243],256],12121:[[29247],256],12122:[[29255],256],12123:[[29273],256],12124:[[29275],256],12125:[[29356],256],12126:[[29572],256],12127:[[29577],256],12128:[[29916],256],12129:[[29926],256],12130:[[29976],256],12131:[[29983],256],12132:[[29992],256],12133:[[3e4],256],12134:[[30091],256],12135:[[30098],256],12136:[[30326],256],12137:[[30333],256],12138:[[30382],256],12139:[[30399],256],12140:[[30446],256],12141:[[30683],256],12142:[[30690],256],12143:[[30707],256],12144:[[31034],256],12145:[[31160],256],12146:[[31166],256],12147:[[31348],256],12148:[[31435],256],12149:[[31481],256],12150:[[31859],256],12151:[[31992],256],12152:[[32566],256],12153:[[32593],256],12154:[[32650],256],12155:[[32701],256],12156:[[32769],256],12157:[[32780],256],12158:[[32786],256],12159:[[32819],256],12160:[[32895],256],12161:[[32905],256],12162:[[33251],256],12163:[[33258],256],12164:[[33267],256],12165:[[33276],256],12166:[[33292],256],12167:[[33307],256],12168:[[33311],256],12169:[[33390],256],12170:[[33394],256],12171:[[33400],256],12172:[[34381],256],12173:[[34411],256],12174:[[34880],256],12175:[[34892],256],12176:[[34915],256],12177:[[35198],256],12178:[[35211],256],12179:[[35282],256],12180:[[35328],256],12181:[[35895],256],12182:[[35910],256],12183:[[35925],256],12184:[[35960],256],12185:[[35997],256],12186:[[36196],256],12187:[[36208],256],12188:[[36275],256],12189:[[36523],256],12190:[[36554],256],12191:[[36763],256],12192:[[36784],256],12193:[[36789],256],12194:[[37009],256],12195:[[37193],256],12196:[[37318],256],12197:[[37324],256],12198:[[37329],256],12199:[[38263],256],12200:[[38272],256],12201:[[38428],256],12202:[[38582],256],12203:[[38585],256],12204:[[38632],256],12205:[[38737],256],12206:[[38750],256],12207:[[38754],256],12208:[[38761],256],12209:[[38859],256],12210:[[38893],256],12211:[[38899],256],12212:[[38913],256],12213:[[39080],256],12214:[[39131],256],12215:[[39135],256],12216:[[39318],256],12217:[[39321],256],12218:[[39340],256],12219:[[39592],256],12220:[[39640],256],12221:[[39647],256],12222:[[39717],256],12223:[[39727],256],12224:[[39730],256],12225:[[39740],256],12226:[[39770],256],12227:[[40165],256],12228:[[40565],256],12229:[[40575],256],12230:[[40613],256],12231:[[40635],256],12232:[[40643],256],12233:[[40653],256],12234:[[40657],256],12235:[[40697],256],12236:[[40701],256],12237:[[40718],256],12238:[[40723],256],12239:[[40736],256],12240:[[40763],256],12241:[[40778],256],12242:[[40786],256],12243:[[40845],256],12244:[[40860],256],12245:[[40864],256]},12288:{12288:[[32],256],12330:[null,218],12331:[null,228],12332:[null,232],12333:[null,222],12334:[null,224],12335:[null,224],12342:[[12306],256],12344:[[21313],256],12345:[[21316],256],12346:[[21317],256],12358:[null,null,{12441:12436}],12363:[null,null,{12441:12364}],12364:[[12363,12441]],12365:[null,null,{12441:12366}],12366:[[12365,12441]],12367:[null,null,{12441:12368}],12368:[[12367,12441]],12369:[null,null,{12441:12370}],12370:[[12369,12441]],12371:[null,null,{12441:12372}],12372:[[12371,12441]],12373:[null,null,{12441:12374}],12374:[[12373,12441]],12375:[null,null,{12441:12376}],12376:[[12375,12441]],12377:[null,null,{12441:12378}],12378:[[12377,12441]],12379:[null,null,{12441:12380}],12380:[[12379,12441]],12381:[null,null,{12441:12382}],12382:[[12381,12441]],12383:[null,null,{12441:12384}],12384:[[12383,12441]],12385:[null,null,{12441:12386}],12386:[[12385,12441]],12388:[null,null,{12441:12389}],12389:[[12388,12441]],12390:[null,null,{12441:12391}],12391:[[12390,12441]],12392:[null,null,{12441:12393}],12393:[[12392,12441]],12399:[null,null,{12441:12400,12442:12401}],12400:[[12399,12441]],12401:[[12399,12442]],12402:[null,null,{12441:12403,12442:12404}],12403:[[12402,12441]],12404:[[12402,12442]],12405:[null,null,{12441:12406,12442:12407}],12406:[[12405,12441]],12407:[[12405,12442]],12408:[null,null,{12441:12409,12442:12410}],12409:[[12408,12441]],12410:[[12408,12442]],12411:[null,null,{12441:12412,12442:12413}],12412:[[12411,12441]],12413:[[12411,12442]],12436:[[12358,12441]],12441:[null,8],12442:[null,8],12443:[[32,12441],256],12444:[[32,12442],256],12445:[null,null,{12441:12446}],12446:[[12445,12441]],12447:[[12424,12426],256],12454:[null,null,{12441:12532}],12459:[null,null,{12441:12460}],12460:[[12459,12441]],12461:[null,null,{12441:12462}],12462:[[12461,12441]],12463:[null,null,{12441:12464}],12464:[[12463,12441]],12465:[null,null,{12441:12466}],12466:[[12465,12441]],12467:[null,null,{12441:12468}],12468:[[12467,12441]],12469:[null,null,{12441:12470}],12470:[[12469,12441]],12471:[null,null,{12441:12472}],12472:[[12471,12441]],12473:[null,null,{12441:12474}],12474:[[12473,12441]],12475:[null,null,{12441:12476}],12476:[[12475,12441]],12477:[null,null,{12441:12478}],12478:[[12477,12441]],12479:[null,null,{12441:12480}],12480:[[12479,12441]],12481:[null,null,{12441:12482}],12482:[[12481,12441]],12484:[null,null,{12441:12485}],12485:[[12484,12441]],12486:[null,null,{12441:12487}],12487:[[12486,12441]],12488:[null,null,{12441:12489}],12489:[[12488,12441]],12495:[null,null,{12441:12496,12442:12497}],12496:[[12495,12441]],12497:[[12495,12442]],12498:[null,null,{12441:12499,12442:12500}],12499:[[12498,12441]],12500:[[12498,12442]],12501:[null,null,{12441:12502,12442:12503}],12502:[[12501,12441]],12503:[[12501,12442]],12504:[null,null,{12441:12505,12442:12506}],12505:[[12504,12441]],12506:[[12504,12442]],12507:[null,null,{12441:12508,12442:12509}],12508:[[12507,12441]],12509:[[12507,12442]],12527:[null,null,{12441:12535}],12528:[null,null,{12441:12536}],12529:[null,null,{12441:12537}],12530:[null,null,{12441:12538}],12532:[[12454,12441]],12535:[[12527,12441]],12536:[[12528,12441]],12537:[[12529,12441]],12538:[[12530,12441]],12541:[null,null,{12441:12542}],12542:[[12541,12441]],12543:[[12467,12488],256]},12544:{12593:[[4352],256],12594:[[4353],256],12595:[[4522],256],12596:[[4354],256],12597:[[4524],256],12598:[[4525],256],12599:[[4355],256],12600:[[4356],256],12601:[[4357],256],12602:[[4528],256],12603:[[4529],256],12604:[[4530],256],12605:[[4531],256],12606:[[4532],256],12607:[[4533],256],12608:[[4378],256],12609:[[4358],256],12610:[[4359],256],12611:[[4360],256],12612:[[4385],256],12613:[[4361],256],12614:[[4362],256],12615:[[4363],256],12616:[[4364],256],12617:[[4365],256],12618:[[4366],256],12619:[[4367],256],12620:[[4368],256],12621:[[4369],256],12622:[[4370],256],12623:[[4449],256],12624:[[4450],256],12625:[[4451],256],12626:[[4452],256],12627:[[4453],256],12628:[[4454],256],12629:[[4455],256],12630:[[4456],256],12631:[[4457],256],12632:[[4458],256],12633:[[4459],256],12634:[[4460],256],12635:[[4461],256],12636:[[4462],256],12637:[[4463],256],12638:[[4464],256],12639:[[4465],256],12640:[[4466],256],12641:[[4467],256],12642:[[4468],256],12643:[[4469],256],12644:[[4448],256],12645:[[4372],256],12646:[[4373],256],12647:[[4551],256],12648:[[4552],256],12649:[[4556],256],12650:[[4558],256],12651:[[4563],256],12652:[[4567],256],12653:[[4569],256],12654:[[4380],256],12655:[[4573],256],12656:[[4575],256],12657:[[4381],256],12658:[[4382],256],12659:[[4384],256],12660:[[4386],256],12661:[[4387],256],12662:[[4391],256],12663:[[4393],256],12664:[[4395],256],12665:[[4396],256],12666:[[4397],256],12667:[[4398],256],12668:[[4399],256],12669:[[4402],256],12670:[[4406],256],12671:[[4416],256],12672:[[4423],256],12673:[[4428],256],12674:[[4593],256],12675:[[4594],256],12676:[[4439],256],12677:[[4440],256],12678:[[4441],256],12679:[[4484],256],12680:[[4485],256],12681:[[4488],256],12682:[[4497],256],12683:[[4498],256],12684:[[4500],256],12685:[[4510],256],12686:[[4513],256],12690:[[19968],256],12691:[[20108],256],12692:[[19977],256],12693:[[22235],256],12694:[[19978],256],12695:[[20013],256],12696:[[19979],256],12697:[[30002],256],12698:[[20057],256],12699:[[19993],256],12700:[[19969],256],12701:[[22825],256],12702:[[22320],256],12703:[[20154],256]},12800:{12800:[[40,4352,41],256],12801:[[40,4354,41],256],12802:[[40,4355,41],256],12803:[[40,4357,41],256],12804:[[40,4358,41],256],12805:[[40,4359,41],256],12806:[[40,4361,41],256],12807:[[40,4363,41],256],12808:[[40,4364,41],256],12809:[[40,4366,41],256],12810:[[40,4367,41],256],12811:[[40,4368,41],256],12812:[[40,4369,41],256],12813:[[40,4370,41],256],12814:[[40,4352,4449,41],256],12815:[[40,4354,4449,41],256],12816:[[40,4355,4449,41],256],12817:[[40,4357,4449,41],256],12818:[[40,4358,4449,41],256],12819:[[40,4359,4449,41],256],12820:[[40,4361,4449,41],256],12821:[[40,4363,4449,41],256],12822:[[40,4364,4449,41],256],12823:[[40,4366,4449,41],256],12824:[[40,4367,4449,41],256],12825:[[40,4368,4449,41],256],12826:[[40,4369,4449,41],256],12827:[[40,4370,4449,41],256],12828:[[40,4364,4462,41],256],12829:[[40,4363,4457,4364,4453,4523,41],256],12830:[[40,4363,4457,4370,4462,41],256],12832:[[40,19968,41],256],12833:[[40,20108,41],256],12834:[[40,19977,41],256],12835:[[40,22235,41],256],12836:[[40,20116,41],256],12837:[[40,20845,41],256],12838:[[40,19971,41],256],12839:[[40,20843,41],256],12840:[[40,20061,41],256],12841:[[40,21313,41],256],12842:[[40,26376,41],256],12843:[[40,28779,41],256],12844:[[40,27700,41],256],12845:[[40,26408,41],256],12846:[[40,37329,41],256],12847:[[40,22303,41],256],12848:[[40,26085,41],256],12849:[[40,26666,41],256],12850:[[40,26377,41],256],12851:[[40,31038,41],256],12852:[[40,21517,41],256],12853:[[40,29305,41],256],12854:[[40,36001,41],256],12855:[[40,31069,41],256],12856:[[40,21172,41],256],12857:[[40,20195,41],256],12858:[[40,21628,41],256],12859:[[40,23398,41],256],12860:[[40,30435,41],256],12861:[[40,20225,41],256],12862:[[40,36039,41],256],12863:[[40,21332,41],256],12864:[[40,31085,41],256],12865:[[40,20241,41],256],12866:[[40,33258,41],256],12867:[[40,33267,41],256],12868:[[21839],256],12869:[[24188],256],12870:[[25991],256],12871:[[31631],256],12880:[[80,84,69],256],12881:[[50,49],256],12882:[[50,50],256],12883:[[50,51],256],12884:[[50,52],256],12885:[[50,53],256],12886:[[50,54],256],12887:[[50,55],256],12888:[[50,56],256],12889:[[50,57],256],12890:[[51,48],256],12891:[[51,49],256],12892:[[51,50],256],12893:[[51,51],256],12894:[[51,52],256],12895:[[51,53],256],12896:[[4352],256],12897:[[4354],256],12898:[[4355],256],12899:[[4357],256],12900:[[4358],256],12901:[[4359],256],12902:[[4361],256],12903:[[4363],256],12904:[[4364],256],12905:[[4366],256],12906:[[4367],256],12907:[[4368],256],12908:[[4369],256],12909:[[4370],256],12910:[[4352,4449],256],12911:[[4354,4449],256],12912:[[4355,4449],256],12913:[[4357,4449],256],12914:[[4358,4449],256],12915:[[4359,4449],256],12916:[[4361,4449],256],12917:[[4363,4449],256],12918:[[4364,4449],256],12919:[[4366,4449],256],12920:[[4367,4449],256],12921:[[4368,4449],256],12922:[[4369,4449],256],12923:[[4370,4449],256],12924:[[4366,4449,4535,4352,4457],256],12925:[[4364,4462,4363,4468],256],12926:[[4363,4462],256],12928:[[19968],256],12929:[[20108],256],12930:[[19977],256],12931:[[22235],256],12932:[[20116],256],12933:[[20845],256],12934:[[19971],256],12935:[[20843],256],12936:[[20061],256],12937:[[21313],256],12938:[[26376],256],12939:[[28779],256],12940:[[27700],256],12941:[[26408],256],12942:[[37329],256],12943:[[22303],256],12944:[[26085],256],12945:[[26666],256],12946:[[26377],256],12947:[[31038],256],12948:[[21517],256],12949:[[29305],256],12950:[[36001],256],12951:[[31069],256],12952:[[21172],256],12953:[[31192],256],12954:[[30007],256],12955:[[22899],256],12956:[[36969],256],12957:[[20778],256],12958:[[21360],256],12959:[[27880],256],12960:[[38917],256],12961:[[20241],256],12962:[[20889],256],12963:[[27491],256],12964:[[19978],256],12965:[[20013],256],12966:[[19979],256],12967:[[24038],256],12968:[[21491],256],12969:[[21307],256],12970:[[23447],256],12971:[[23398],256],12972:[[30435],256],12973:[[20225],256],12974:[[36039],256],12975:[[21332],256],12976:[[22812],256],12977:[[51,54],256],12978:[[51,55],256],12979:[[51,56],256],12980:[[51,57],256],12981:[[52,48],256],12982:[[52,49],256],12983:[[52,50],256],12984:[[52,51],256],12985:[[52,52],256],12986:[[52,53],256],12987:[[52,54],256],12988:[[52,55],256],12989:[[52,56],256],12990:[[52,57],256],12991:[[53,48],256],12992:[[49,26376],256],12993:[[50,26376],256],12994:[[51,26376],256],12995:[[52,26376],256],12996:[[53,26376],256],12997:[[54,26376],256],12998:[[55,26376],256],12999:[[56,26376],256],13000:[[57,26376],256],13001:[[49,48,26376],256],13002:[[49,49,26376],256],13003:[[49,50,26376],256],13004:[[72,103],256],13005:[[101,114,103],256],13006:[[101,86],256],13007:[[76,84,68],256],13008:[[12450],256],13009:[[12452],256],13010:[[12454],256],13011:[[12456],256],13012:[[12458],256],13013:[[12459],256],13014:[[12461],256],13015:[[12463],256],13016:[[12465],256],13017:[[12467],256],13018:[[12469],256],13019:[[12471],256],13020:[[12473],256],13021:[[12475],256],13022:[[12477],256],13023:[[12479],256],13024:[[12481],256],13025:[[12484],256],13026:[[12486],256],13027:[[12488],256],13028:[[12490],256],13029:[[12491],256],13030:[[12492],256],13031:[[12493],256],13032:[[12494],256],13033:[[12495],256],13034:[[12498],256],13035:[[12501],256],13036:[[12504],256],13037:[[12507],256],13038:[[12510],256],13039:[[12511],256],13040:[[12512],256],13041:[[12513],256],13042:[[12514],256],13043:[[12516],256],13044:[[12518],256],13045:[[12520],256],13046:[[12521],256],13047:[[12522],256],13048:[[12523],256],13049:[[12524],256],13050:[[12525],256],13051:[[12527],256],13052:[[12528],256],13053:[[12529],256],13054:[[12530],256]},13056:{13056:[[12450,12497,12540,12488],256],13057:[[12450,12523,12501,12449],256],13058:[[12450,12531,12506,12450],256],13059:[[12450,12540,12523],256],13060:[[12452,12491,12531,12464],256],13061:[[12452,12531,12481],256],13062:[[12454,12457,12531],256],13063:[[12456,12473,12463,12540,12489],256],13064:[[12456,12540,12459,12540],256],13065:[[12458,12531,12473],256],13066:[[12458,12540,12512],256],13067:[[12459,12452,12522],256],13068:[[12459,12521,12483,12488],256],13069:[[12459,12525,12522,12540],256],13070:[[12460,12525,12531],256],13071:[[12460,12531,12510],256],13072:[[12462,12460],256],13073:[[12462,12491,12540],256],13074:[[12461,12517,12522,12540],256],13075:[[12462,12523,12480,12540],256],13076:[[12461,12525],256],13077:[[12461,12525,12464,12521,12512],256],13078:[[12461,12525,12513,12540,12488,12523],256],13079:[[12461,12525,12527,12483,12488],256],13080:[[12464,12521,12512],256],13081:[[12464,12521,12512,12488,12531],256],13082:[[12463,12523,12476,12452,12525],256],13083:[[12463,12525,12540,12493],256],13084:[[12465,12540,12473],256],13085:[[12467,12523,12490],256],13086:[[12467,12540,12509],256],13087:[[12469,12452,12463,12523],256],13088:[[12469,12531,12481,12540,12512],256],13089:[[12471,12522,12531,12464],256],13090:[[12475,12531,12481],256],13091:[[12475,12531,12488],256],13092:[[12480,12540,12473],256],13093:[[12487,12471],256],13094:[[12489,12523],256],13095:[[12488,12531],256],13096:[[12490,12494],256],13097:[[12494,12483,12488],256],13098:[[12495,12452,12484],256],13099:[[12497,12540,12475,12531,12488],256],13100:[[12497,12540,12484],256],13101:[[12496,12540,12524,12523],256],13102:[[12500,12450,12473,12488,12523],256],13103:[[12500,12463,12523],256],13104:[[12500,12467],256],13105:[[12499,12523],256],13106:[[12501,12449,12521,12483,12489],256],13107:[[12501,12451,12540,12488],256],13108:[[12502,12483,12471,12455,12523],256],13109:[[12501,12521,12531],256],13110:[[12504,12463,12479,12540,12523],256],13111:[[12506,12477],256],13112:[[12506,12491,12498],256],13113:[[12504,12523,12484],256],13114:[[12506,12531,12473],256],13115:[[12506,12540,12472],256],13116:[[12505,12540,12479],256],13117:[[12509,12452,12531,12488],256],13118:[[12508,12523,12488],256],13119:[[12507,12531],256],13120:[[12509,12531,12489],256],13121:[[12507,12540,12523],256],13122:[[12507,12540,12531],256],13123:[[12510,12452,12463,12525],256],13124:[[12510,12452,12523],256],13125:[[12510,12483,12495],256],13126:[[12510,12523,12463],256],13127:[[12510,12531,12471,12519,12531],256],13128:[[12511,12463,12525,12531],256],13129:[[12511,12522],256],13130:[[12511,12522,12496,12540,12523],256],13131:[[12513,12460],256],13132:[[12513,12460,12488,12531],256],13133:[[12513,12540,12488,12523],256],13134:[[12516,12540,12489],256],13135:[[12516,12540,12523],256],13136:[[12518,12450,12531],256],13137:[[12522,12483,12488,12523],256],13138:[[12522,12521],256],13139:[[12523,12500,12540],256],13140:[[12523,12540,12502,12523],256],13141:[[12524,12512],256],13142:[[12524,12531,12488,12466,12531],256],13143:[[12527,12483,12488],256],13144:[[48,28857],256],13145:[[49,28857],256],13146:[[50,28857],256],13147:[[51,28857],256],13148:[[52,28857],256],13149:[[53,28857],256],13150:[[54,28857],256],13151:[[55,28857],256],13152:[[56,28857],256],13153:[[57,28857],256],13154:[[49,48,28857],256],13155:[[49,49,28857],256],13156:[[49,50,28857],256],13157:[[49,51,28857],256],13158:[[49,52,28857],256],13159:[[49,53,28857],256],13160:[[49,54,28857],256],13161:[[49,55,28857],256],13162:[[49,56,28857],256],13163:[[49,57,28857],256],13164:[[50,48,28857],256],13165:[[50,49,28857],256],13166:[[50,50,28857],256],13167:[[50,51,28857],256],13168:[[50,52,28857],256],13169:[[104,80,97],256],13170:[[100,97],256],13171:[[65,85],256],13172:[[98,97,114],256],13173:[[111,86],256],13174:[[112,99],256],13175:[[100,109],256],13176:[[100,109,178],256],13177:[[100,109,179],256],13178:[[73,85],256],13179:[[24179,25104],256],13180:[[26157,21644],256],13181:[[22823,27491],256],13182:[[26126,27835],256],13183:[[26666,24335,20250,31038],256],13184:[[112,65],256],13185:[[110,65],256],13186:[[956,65],256],13187:[[109,65],256],13188:[[107,65],256],13189:[[75,66],256],13190:[[77,66],256],13191:[[71,66],256],13192:[[99,97,108],256],13193:[[107,99,97,108],256],13194:[[112,70],256],13195:[[110,70],256],13196:[[956,70],256],13197:[[956,103],256],13198:[[109,103],256],13199:[[107,103],256],13200:[[72,122],256],13201:[[107,72,122],256],13202:[[77,72,122],256],13203:[[71,72,122],256],13204:[[84,72,122],256],13205:[[956,8467],256],13206:[[109,8467],256],13207:[[100,8467],256],13208:[[107,8467],256],13209:[[102,109],256],13210:[[110,109],256],13211:[[956,109],256],13212:[[109,109],256],13213:[[99,109],256],13214:[[107,109],256],13215:[[109,109,178],256],13216:[[99,109,178],256],13217:[[109,178],256],13218:[[107,109,178],256],13219:[[109,109,179],256],13220:[[99,109,179],256],13221:[[109,179],256],13222:[[107,109,179],256],13223:[[109,8725,115],256],13224:[[109,8725,115,178],256],13225:[[80,97],256],13226:[[107,80,97],256],13227:[[77,80,97],256],13228:[[71,80,97],256],13229:[[114,97,100],256],13230:[[114,97,100,8725,115],256],13231:[[114,97,100,8725,115,178],256],13232:[[112,115],256],13233:[[110,115],256],13234:[[956,115],256],13235:[[109,115],256],13236:[[112,86],256],13237:[[110,86],256],13238:[[956,86],256],13239:[[109,86],256],13240:[[107,86],256],13241:[[77,86],256],13242:[[112,87],256],13243:[[110,87],256],13244:[[956,87],256],13245:[[109,87],256],13246:[[107,87],256],13247:[[77,87],256],13248:[[107,937],256],13249:[[77,937],256],13250:[[97,46,109,46],256],13251:[[66,113],256],13252:[[99,99],256],13253:[[99,100],256],13254:[[67,8725,107,103],256],13255:[[67,111,46],256],13256:[[100,66],256],13257:[[71,121],256],13258:[[104,97],256],13259:[[72,80],256],13260:[[105,110],256],13261:[[75,75],256],13262:[[75,77],256],13263:[[107,116],256],13264:[[108,109],256],13265:[[108,110],256],13266:[[108,111,103],256],13267:[[108,120],256],13268:[[109,98],256],13269:[[109,105,108],256],13270:[[109,111,108],256],13271:[[80,72],256],13272:[[112,46,109,46],256],13273:[[80,80,77],256],13274:[[80,82],256],13275:[[115,114],256],13276:[[83,118],256],13277:[[87,98],256],13278:[[86,8725,109],256],13279:[[65,8725,109],256],13280:[[49,26085],256],13281:[[50,26085],256],13282:[[51,26085],256],13283:[[52,26085],256],13284:[[53,26085],256],13285:[[54,26085],256],13286:[[55,26085],256],13287:[[56,26085],256],13288:[[57,26085],256],13289:[[49,48,26085],256],13290:[[49,49,26085],256],13291:[[49,50,26085],256],13292:[[49,51,26085],256],13293:[[49,52,26085],256],13294:[[49,53,26085],256],13295:[[49,54,26085],256],13296:[[49,55,26085],256],13297:[[49,56,26085],256],13298:[[49,57,26085],256],13299:[[50,48,26085],256],13300:[[50,49,26085],256],13301:[[50,50,26085],256],13302:[[50,51,26085],256],13303:[[50,52,26085],256],13304:[[50,53,26085],256],13305:[[50,54,26085],256],13306:[[50,55,26085],256],13307:[[50,56,26085],256],13308:[[50,57,26085],256],13309:[[51,48,26085],256],13310:[[51,49,26085],256],13311:[[103,97,108],256]},27136:{92912:[null,1],92913:[null,1],92914:[null,1],92915:[null,1],92916:[null,1]},27392:{92976:[null,230],92977:[null,230],92978:[null,230],92979:[null,230],92980:[null,230],92981:[null,230],92982:[null,230]},42496:{42607:[null,230],42612:[null,230],42613:[null,230],42614:[null,230],42615:[null,230],42616:[null,230],42617:[null,230],42618:[null,230],42619:[null,230],42620:[null,230],42621:[null,230],42652:[[1098],256],42653:[[1100],256],42655:[null,230],42736:[null,230],42737:[null,230]},42752:{42864:[[42863],256],43000:[[294],256],43001:[[339],256]},43008:{43014:[null,9],43204:[null,9],43232:[null,230],43233:[null,230],43234:[null,230],43235:[null,230],43236:[null,230],43237:[null,230],43238:[null,230],43239:[null,230],43240:[null,230],43241:[null,230],43242:[null,230],43243:[null,230],43244:[null,230],43245:[null,230],43246:[null,230],43247:[null,230],43248:[null,230],43249:[null,230]},43264:{43307:[null,220],43308:[null,220],43309:[null,220],43347:[null,9],43443:[null,7],43456:[null,9]},43520:{43696:[null,230],43698:[null,230],43699:[null,230],43700:[null,220],43703:[null,230],43704:[null,230],43710:[null,230],43711:[null,230],43713:[null,230],43766:[null,9]},43776:{43868:[[42791],256],43869:[[43831],256],43870:[[619],256],43871:[[43858],256],44013:[null,9]},48128:{113822:[null,1]},53504:{119134:[[119127,119141],512],119135:[[119128,119141],512],119136:[[119135,119150],512],119137:[[119135,119151],512],119138:[[119135,119152],512],119139:[[119135,119153],512],119140:[[119135,119154],512],119141:[null,216],119142:[null,216],119143:[null,1],119144:[null,1],119145:[null,1],119149:[null,226],119150:[null,216],119151:[null,216],119152:[null,216],119153:[null,216],119154:[null,216],119163:[null,220],119164:[null,220],119165:[null,220],119166:[null,220],119167:[null,220],119168:[null,220],119169:[null,220],119170:[null,220],119173:[null,230],119174:[null,230],119175:[null,230],119176:[null,230],119177:[null,230],119178:[null,220],119179:[null,220],119210:[null,230],119211:[null,230],119212:[null,230],119213:[null,230],119227:[[119225,119141],512],119228:[[119226,119141],512],119229:[[119227,119150],512],119230:[[119228,119150],512],119231:[[119227,119151],512],119232:[[119228,119151],512]},53760:{119362:[null,230],119363:[null,230],119364:[null,230]},54272:{119808:[[65],256],119809:[[66],256],119810:[[67],256],119811:[[68],256],119812:[[69],256],119813:[[70],256],119814:[[71],256],119815:[[72],256],119816:[[73],256],119817:[[74],256],119818:[[75],256],119819:[[76],256],119820:[[77],256],119821:[[78],256],119822:[[79],256],119823:[[80],256],119824:[[81],256],119825:[[82],256],119826:[[83],256],119827:[[84],256],119828:[[85],256],119829:[[86],256],119830:[[87],256],119831:[[88],256],119832:[[89],256],119833:[[90],256],119834:[[97],256],119835:[[98],256],119836:[[99],256],119837:[[100],256],119838:[[101],256],119839:[[102],256],119840:[[103],256],119841:[[104],256],119842:[[105],256],119843:[[106],256],119844:[[107],256],119845:[[108],256],119846:[[109],256],119847:[[110],256],119848:[[111],256],119849:[[112],256],119850:[[113],256],119851:[[114],256],119852:[[115],256],119853:[[116],256],119854:[[117],256],119855:[[118],256],119856:[[119],256],119857:[[120],256],119858:[[121],256],119859:[[122],256],119860:[[65],256],119861:[[66],256],119862:[[67],256],119863:[[68],256],119864:[[69],256],119865:[[70],256],119866:[[71],256],119867:[[72],256],119868:[[73],256],119869:[[74],256],119870:[[75],256],119871:[[76],256],119872:[[77],256],119873:[[78],256],119874:[[79],256],119875:[[80],256],119876:[[81],256],119877:[[82],256],119878:[[83],256],119879:[[84],256],119880:[[85],256],119881:[[86],256],119882:[[87],256],119883:[[88],256],119884:[[89],256],119885:[[90],256],119886:[[97],256],119887:[[98],256],119888:[[99],256],119889:[[100],256],119890:[[101],256],119891:[[102],256],119892:[[103],256],119894:[[105],256],119895:[[106],256],119896:[[107],256],119897:[[108],256],119898:[[109],256],119899:[[110],256],119900:[[111],256],119901:[[112],256],119902:[[113],256],119903:[[114],256],119904:[[115],256],119905:[[116],256],119906:[[117],256],119907:[[118],256],119908:[[119],256],119909:[[120],256],119910:[[121],256],119911:[[122],256],119912:[[65],256],119913:[[66],256],119914:[[67],256],119915:[[68],256],119916:[[69],256],119917:[[70],256],119918:[[71],256],119919:[[72],256],119920:[[73],256],119921:[[74],256],119922:[[75],256],119923:[[76],256],119924:[[77],256],119925:[[78],256],119926:[[79],256],119927:[[80],256],119928:[[81],256],119929:[[82],256],119930:[[83],256],119931:[[84],256],119932:[[85],256],119933:[[86],256],119934:[[87],256],119935:[[88],256],119936:[[89],256],119937:[[90],256],119938:[[97],256],119939:[[98],256],119940:[[99],256],119941:[[100],256],119942:[[101],256],119943:[[102],256],119944:[[103],256],119945:[[104],256],119946:[[105],256],119947:[[106],256],119948:[[107],256],119949:[[108],256],119950:[[109],256],119951:[[110],256],119952:[[111],256],119953:[[112],256],119954:[[113],256],119955:[[114],256],119956:[[115],256],119957:[[116],256],119958:[[117],256],119959:[[118],256],119960:[[119],256],119961:[[120],256],119962:[[121],256],119963:[[122],256],119964:[[65],256],119966:[[67],256],119967:[[68],256],119970:[[71],256],119973:[[74],256],119974:[[75],256],119977:[[78],256],119978:[[79],256],119979:[[80],256],119980:[[81],256],119982:[[83],256],119983:[[84],256],119984:[[85],256],119985:[[86],256],119986:[[87],256],119987:[[88],256],119988:[[89],256],119989:[[90],256],119990:[[97],256],119991:[[98],256],119992:[[99],256],119993:[[100],256],119995:[[102],256],119997:[[104],256],119998:[[105],256],119999:[[106],256],120000:[[107],256],120001:[[108],256],120002:[[109],256],120003:[[110],256],120005:[[112],256],120006:[[113],256],120007:[[114],256],120008:[[115],256],120009:[[116],256],120010:[[117],256],120011:[[118],256],120012:[[119],256],120013:[[120],256],120014:[[121],256],120015:[[122],256],120016:[[65],256],120017:[[66],256],120018:[[67],256],120019:[[68],256],120020:[[69],256],120021:[[70],256],120022:[[71],256],120023:[[72],256],120024:[[73],256],120025:[[74],256],120026:[[75],256],120027:[[76],256],120028:[[77],256],120029:[[78],256],120030:[[79],256],120031:[[80],256],120032:[[81],256],120033:[[82],256],120034:[[83],256],120035:[[84],256],120036:[[85],256],120037:[[86],256],120038:[[87],256],120039:[[88],256],120040:[[89],256],120041:[[90],256],120042:[[97],256],120043:[[98],256],120044:[[99],256],120045:[[100],256],120046:[[101],256],120047:[[102],256],120048:[[103],256],120049:[[104],256],120050:[[105],256],120051:[[106],256],120052:[[107],256],120053:[[108],256],120054:[[109],256],120055:[[110],256],120056:[[111],256],120057:[[112],256],120058:[[113],256],120059:[[114],256],120060:[[115],256],120061:[[116],256],120062:[[117],256],120063:[[118],256]},54528:{120064:[[119],256],120065:[[120],256],120066:[[121],256],120067:[[122],256],120068:[[65],256],120069:[[66],256],120071:[[68],256],120072:[[69],256],120073:[[70],256],120074:[[71],256],120077:[[74],256],120078:[[75],256],120079:[[76],256],120080:[[77],256],120081:[[78],256],120082:[[79],256],120083:[[80],256],120084:[[81],256],120086:[[83],256],120087:[[84],256],120088:[[85],256],120089:[[86],256],120090:[[87],256],120091:[[88],256],120092:[[89],256],120094:[[97],256],120095:[[98],256],120096:[[99],256],120097:[[100],256],120098:[[101],256],120099:[[102],256],120100:[[103],256],120101:[[104],256],120102:[[105],256],120103:[[106],256],120104:[[107],256],120105:[[108],256],120106:[[109],256],120107:[[110],256],120108:[[111],256],120109:[[112],256],120110:[[113],256],120111:[[114],256],120112:[[115],256],120113:[[116],256],120114:[[117],256],120115:[[118],256],120116:[[119],256],120117:[[120],256],120118:[[121],256],120119:[[122],256],120120:[[65],256],120121:[[66],256],120123:[[68],256],120124:[[69],256],120125:[[70],256],120126:[[71],256],120128:[[73],256],120129:[[74],256],120130:[[75],256],120131:[[76],256],120132:[[77],256],120134:[[79],256],120138:[[83],256],120139:[[84],256],120140:[[85],256],120141:[[86],256],120142:[[87],256],120143:[[88],256],120144:[[89],256],120146:[[97],256],120147:[[98],256],120148:[[99],256],120149:[[100],256],120150:[[101],256],120151:[[102],256],120152:[[103],256],120153:[[104],256],120154:[[105],256],120155:[[106],256],120156:[[107],256],120157:[[108],256],120158:[[109],256],120159:[[110],256],120160:[[111],256],120161:[[112],256],120162:[[113],256],120163:[[114],256],120164:[[115],256],120165:[[116],256],120166:[[117],256],120167:[[118],256],120168:[[119],256],120169:[[120],256],120170:[[121],256],120171:[[122],256],120172:[[65],256],120173:[[66],256],120174:[[67],256],120175:[[68],256],120176:[[69],256],120177:[[70],256],120178:[[71],256],120179:[[72],256],120180:[[73],256],120181:[[74],256],120182:[[75],256],120183:[[76],256],120184:[[77],256],120185:[[78],256],120186:[[79],256],120187:[[80],256],120188:[[81],256],120189:[[82],256],120190:[[83],256],120191:[[84],256],120192:[[85],256],120193:[[86],256],120194:[[87],256],120195:[[88],256],120196:[[89],256],120197:[[90],256],120198:[[97],256],120199:[[98],256],120200:[[99],256],120201:[[100],256],120202:[[101],256],120203:[[102],256],120204:[[103],256],120205:[[104],256],120206:[[105],256],120207:[[106],256],120208:[[107],256],120209:[[108],256],120210:[[109],256],120211:[[110],256],120212:[[111],256],120213:[[112],256],120214:[[113],256],120215:[[114],256],120216:[[115],256],120217:[[116],256],120218:[[117],256],120219:[[118],256],120220:[[119],256],120221:[[120],256],120222:[[121],256],120223:[[122],256],120224:[[65],256],120225:[[66],256],120226:[[67],256],120227:[[68],256],120228:[[69],256],120229:[[70],256],120230:[[71],256],120231:[[72],256],120232:[[73],256],120233:[[74],256],120234:[[75],256],120235:[[76],256],120236:[[77],256],120237:[[78],256],120238:[[79],256],120239:[[80],256],120240:[[81],256],120241:[[82],256],120242:[[83],256],120243:[[84],256],120244:[[85],256],120245:[[86],256],120246:[[87],256],120247:[[88],256],120248:[[89],256],120249:[[90],256],120250:[[97],256],120251:[[98],256],120252:[[99],256],120253:[[100],256],120254:[[101],256],120255:[[102],256],120256:[[103],256],120257:[[104],256],120258:[[105],256],120259:[[106],256],120260:[[107],256],120261:[[108],256],120262:[[109],256],120263:[[110],256],120264:[[111],256],120265:[[112],256],120266:[[113],256],120267:[[114],256],120268:[[115],256],120269:[[116],256],120270:[[117],256],120271:[[118],256],120272:[[119],256],120273:[[120],256],120274:[[121],256],120275:[[122],256],120276:[[65],256],120277:[[66],256],120278:[[67],256],120279:[[68],256],120280:[[69],256],120281:[[70],256],120282:[[71],256],120283:[[72],256],120284:[[73],256],120285:[[74],256],120286:[[75],256],120287:[[76],256],120288:[[77],256],120289:[[78],256],120290:[[79],256],120291:[[80],256],120292:[[81],256],120293:[[82],256],120294:[[83],256],120295:[[84],256],120296:[[85],256],120297:[[86],256],120298:[[87],256],120299:[[88],256],120300:[[89],256],120301:[[90],256],120302:[[97],256],120303:[[98],256],120304:[[99],256],120305:[[100],256],120306:[[101],256],120307:[[102],256],120308:[[103],256],120309:[[104],256],120310:[[105],256],120311:[[106],256],120312:[[107],256],120313:[[108],256],120314:[[109],256],120315:[[110],256],120316:[[111],256],120317:[[112],256],120318:[[113],256],120319:[[114],256]},54784:{120320:[[115],256],120321:[[116],256],120322:[[117],256],120323:[[118],256],120324:[[119],256],120325:[[120],256],120326:[[121],256],120327:[[122],256],120328:[[65],256],120329:[[66],256],120330:[[67],256],120331:[[68],256],120332:[[69],256],120333:[[70],256],120334:[[71],256],120335:[[72],256],120336:[[73],256],120337:[[74],256],120338:[[75],256],120339:[[76],256],120340:[[77],256],120341:[[78],256],120342:[[79],256],120343:[[80],256],120344:[[81],256],120345:[[82],256],120346:[[83],256],120347:[[84],256],120348:[[85],256],120349:[[86],256],120350:[[87],256],120351:[[88],256],120352:[[89],256],120353:[[90],256],120354:[[97],256],120355:[[98],256],120356:[[99],256],120357:[[100],256],120358:[[101],256],120359:[[102],256],120360:[[103],256],120361:[[104],256],120362:[[105],256],120363:[[106],256],120364:[[107],256],120365:[[108],256],120366:[[109],256],120367:[[110],256],120368:[[111],256],120369:[[112],256],120370:[[113],256],120371:[[114],256],120372:[[115],256],120373:[[116],256],120374:[[117],256],120375:[[118],256],120376:[[119],256],120377:[[120],256],120378:[[121],256],120379:[[122],256],120380:[[65],256],120381:[[66],256],120382:[[67],256],120383:[[68],256],120384:[[69],256],120385:[[70],256],120386:[[71],256],120387:[[72],256],120388:[[73],256],120389:[[74],256],120390:[[75],256],120391:[[76],256],120392:[[77],256],120393:[[78],256],120394:[[79],256],120395:[[80],256],120396:[[81],256],120397:[[82],256],120398:[[83],256],120399:[[84],256],120400:[[85],256],120401:[[86],256],120402:[[87],256],120403:[[88],256],120404:[[89],256],120405:[[90],256],120406:[[97],256],120407:[[98],256],120408:[[99],256],120409:[[100],256],120410:[[101],256],120411:[[102],256],120412:[[103],256],120413:[[104],256],120414:[[105],256],120415:[[106],256],120416:[[107],256],120417:[[108],256],120418:[[109],256],120419:[[110],256],120420:[[111],256],120421:[[112],256],120422:[[113],256],120423:[[114],256],120424:[[115],256],120425:[[116],256],120426:[[117],256],120427:[[118],256],120428:[[119],256],120429:[[120],256],120430:[[121],256],120431:[[122],256],120432:[[65],256],120433:[[66],256],120434:[[67],256],120435:[[68],256],120436:[[69],256],120437:[[70],256],120438:[[71],256],120439:[[72],256],120440:[[73],256],120441:[[74],256],120442:[[75],256],120443:[[76],256],120444:[[77],256],120445:[[78],256],120446:[[79],256],120447:[[80],256],120448:[[81],256],120449:[[82],256],120450:[[83],256],120451:[[84],256],120452:[[85],256],120453:[[86],256],120454:[[87],256],120455:[[88],256],120456:[[89],256],120457:[[90],256],120458:[[97],256],120459:[[98],256],120460:[[99],256],120461:[[100],256],120462:[[101],256],120463:[[102],256],120464:[[103],256],120465:[[104],256],120466:[[105],256],120467:[[106],256],120468:[[107],256],120469:[[108],256],120470:[[109],256],120471:[[110],256],120472:[[111],256],120473:[[112],256],120474:[[113],256],120475:[[114],256],120476:[[115],256],120477:[[116],256],120478:[[117],256],120479:[[118],256],120480:[[119],256],120481:[[120],256],120482:[[121],256],120483:[[122],256],120484:[[305],256],120485:[[567],256],120488:[[913],256],120489:[[914],256],120490:[[915],256],120491:[[916],256],120492:[[917],256],120493:[[918],256],120494:[[919],256],120495:[[920],256],120496:[[921],256],120497:[[922],256],120498:[[923],256],120499:[[924],256],120500:[[925],256],120501:[[926],256],120502:[[927],256],120503:[[928],256],120504:[[929],256],120505:[[1012],256],120506:[[931],256],120507:[[932],256],120508:[[933],256],120509:[[934],256],120510:[[935],256],120511:[[936],256],120512:[[937],256],120513:[[8711],256],120514:[[945],256],120515:[[946],256],120516:[[947],256],120517:[[948],256],120518:[[949],256],120519:[[950],256],120520:[[951],256],120521:[[952],256],120522:[[953],256],120523:[[954],256],120524:[[955],256],120525:[[956],256],120526:[[957],256],120527:[[958],256],120528:[[959],256],120529:[[960],256],120530:[[961],256],120531:[[962],256],120532:[[963],256],120533:[[964],256],120534:[[965],256],120535:[[966],256],120536:[[967],256],120537:[[968],256],120538:[[969],256],120539:[[8706],256],120540:[[1013],256],120541:[[977],256],120542:[[1008],256],120543:[[981],256],120544:[[1009],256],120545:[[982],256],120546:[[913],256],120547:[[914],256],120548:[[915],256],120549:[[916],256],120550:[[917],256],120551:[[918],256],120552:[[919],256],120553:[[920],256],120554:[[921],256],120555:[[922],256],120556:[[923],256],120557:[[924],256],120558:[[925],256],120559:[[926],256],120560:[[927],256],120561:[[928],256],120562:[[929],256],120563:[[1012],256],120564:[[931],256],120565:[[932],256],120566:[[933],256],120567:[[934],256],120568:[[935],256],120569:[[936],256],120570:[[937],256],120571:[[8711],256],120572:[[945],256],120573:[[946],256],120574:[[947],256],120575:[[948],256]},55040:{120576:[[949],256],120577:[[950],256],120578:[[951],256],120579:[[952],256],120580:[[953],256],120581:[[954],256],120582:[[955],256],120583:[[956],256],120584:[[957],256],120585:[[958],256],120586:[[959],256],120587:[[960],256],120588:[[961],256],120589:[[962],256],120590:[[963],256],120591:[[964],256],120592:[[965],256],120593:[[966],256],120594:[[967],256],120595:[[968],256],120596:[[969],256],120597:[[8706],256],120598:[[1013],256],120599:[[977],256],120600:[[1008],256],120601:[[981],256],120602:[[1009],256],120603:[[982],256],120604:[[913],256],120605:[[914],256],120606:[[915],256],120607:[[916],256],120608:[[917],256],120609:[[918],256],120610:[[919],256],120611:[[920],256],120612:[[921],256],120613:[[922],256],120614:[[923],256],120615:[[924],256],120616:[[925],256],120617:[[926],256],120618:[[927],256],120619:[[928],256],120620:[[929],256],120621:[[1012],256],120622:[[931],256],120623:[[932],256],120624:[[933],256],120625:[[934],256],120626:[[935],256],120627:[[936],256],120628:[[937],256],120629:[[8711],256],120630:[[945],256],120631:[[946],256],120632:[[947],256],120633:[[948],256],120634:[[949],256],120635:[[950],256],120636:[[951],256],120637:[[952],256],120638:[[953],256],120639:[[954],256],120640:[[955],256],120641:[[956],256],120642:[[957],256],120643:[[958],256],120644:[[959],256],120645:[[960],256],120646:[[961],256],120647:[[962],256],120648:[[963],256],120649:[[964],256],120650:[[965],256],120651:[[966],256],120652:[[967],256],120653:[[968],256],120654:[[969],256],120655:[[8706],256],120656:[[1013],256],120657:[[977],256],120658:[[1008],256],120659:[[981],256],120660:[[1009],256],120661:[[982],256],120662:[[913],256],120663:[[914],256],120664:[[915],256],120665:[[916],256],120666:[[917],256],120667:[[918],256],120668:[[919],256],120669:[[920],256],120670:[[921],256],120671:[[922],256],120672:[[923],256],120673:[[924],256],120674:[[925],256],120675:[[926],256],120676:[[927],256],120677:[[928],256],120678:[[929],256],120679:[[1012],256],120680:[[931],256],120681:[[932],256],120682:[[933],256],120683:[[934],256],120684:[[935],256],120685:[[936],256],120686:[[937],256],120687:[[8711],256],120688:[[945],256],120689:[[946],256],120690:[[947],256],120691:[[948],256],120692:[[949],256],120693:[[950],256],120694:[[951],256],120695:[[952],256],120696:[[953],256],120697:[[954],256],120698:[[955],256],120699:[[956],256],120700:[[957],256],120701:[[958],256],120702:[[959],256],120703:[[960],256],120704:[[961],256],120705:[[962],256],120706:[[963],256],120707:[[964],256],120708:[[965],256],120709:[[966],256],120710:[[967],256],120711:[[968],256],120712:[[969],256],120713:[[8706],256],120714:[[1013],256],120715:[[977],256],120716:[[1008],256],120717:[[981],256],120718:[[1009],256],120719:[[982],256],120720:[[913],256],120721:[[914],256],120722:[[915],256],120723:[[916],256],120724:[[917],256],120725:[[918],256],120726:[[919],256],120727:[[920],256],120728:[[921],256],120729:[[922],256],120730:[[923],256],120731:[[924],256],120732:[[925],256],120733:[[926],256],120734:[[927],256],120735:[[928],256],120736:[[929],256],120737:[[1012],256],120738:[[931],256],120739:[[932],256],120740:[[933],256],120741:[[934],256],120742:[[935],256],120743:[[936],256],120744:[[937],256],120745:[[8711],256],120746:[[945],256],120747:[[946],256],120748:[[947],256],120749:[[948],256],120750:[[949],256],120751:[[950],256],120752:[[951],256],120753:[[952],256],120754:[[953],256],120755:[[954],256],120756:[[955],256],120757:[[956],256],120758:[[957],256],120759:[[958],256],120760:[[959],256],120761:[[960],256],120762:[[961],256],120763:[[962],256],120764:[[963],256],120765:[[964],256],120766:[[965],256],120767:[[966],256],120768:[[967],256],120769:[[968],256],120770:[[969],256],120771:[[8706],256],120772:[[1013],256],120773:[[977],256],120774:[[1008],256],120775:[[981],256],120776:[[1009],256],120777:[[982],256],120778:[[988],256],120779:[[989],256],120782:[[48],256],120783:[[49],256],120784:[[50],256],120785:[[51],256],120786:[[52],256],120787:[[53],256],120788:[[54],256],120789:[[55],256],120790:[[56],256],120791:[[57],256],120792:[[48],256],120793:[[49],256],120794:[[50],256],120795:[[51],256],120796:[[52],256],120797:[[53],256],120798:[[54],256],120799:[[55],256],120800:[[56],256],120801:[[57],256],120802:[[48],256],120803:[[49],256],120804:[[50],256],120805:[[51],256],120806:[[52],256],120807:[[53],256],120808:[[54],256],120809:[[55],256],120810:[[56],256],120811:[[57],256],120812:[[48],256],120813:[[49],256],120814:[[50],256],120815:[[51],256],120816:[[52],256],120817:[[53],256],120818:[[54],256],120819:[[55],256],120820:[[56],256],120821:[[57],256],120822:[[48],256],120823:[[49],256],120824:[[50],256],120825:[[51],256],120826:[[52],256],120827:[[53],256],120828:[[54],256],120829:[[55],256],120830:[[56],256],120831:[[57],256]},59392:{125136:[null,220],125137:[null,220],125138:[null,220],125139:[null,220],125140:[null,220],125141:[null,220],125142:[null,220]},60928:{126464:[[1575],256],126465:[[1576],256],126466:[[1580],256],126467:[[1583],256],126469:[[1608],256],126470:[[1586],256],126471:[[1581],256],126472:[[1591],256],126473:[[1610],256],126474:[[1603],256],126475:[[1604],256],126476:[[1605],256],126477:[[1606],256],126478:[[1587],256],126479:[[1593],256],126480:[[1601],256],126481:[[1589],256],126482:[[1602],256],126483:[[1585],256],126484:[[1588],256],126485:[[1578],256],126486:[[1579],256],126487:[[1582],256],126488:[[1584],256],126489:[[1590],256],126490:[[1592],256],126491:[[1594],256],126492:[[1646],256],126493:[[1722],256],126494:[[1697],256],126495:[[1647],256],126497:[[1576],256],126498:[[1580],256],126500:[[1607],256],126503:[[1581],256],126505:[[1610],256],126506:[[1603],256],126507:[[1604],256],126508:[[1605],256],126509:[[1606],256],126510:[[1587],256],126511:[[1593],256],126512:[[1601],256],126513:[[1589],256],126514:[[1602],256],126516:[[1588],256],126517:[[1578],256],126518:[[1579],256],126519:[[1582],256],126521:[[1590],256],126523:[[1594],256],126530:[[1580],256],126535:[[1581],256],126537:[[1610],256],126539:[[1604],256],126541:[[1606],256],126542:[[1587],256],126543:[[1593],256],126545:[[1589],256],126546:[[1602],256],126548:[[1588],256],126551:[[1582],256],126553:[[1590],256],126555:[[1594],256],126557:[[1722],256],126559:[[1647],256],126561:[[1576],256],126562:[[1580],256],126564:[[1607],256],126567:[[1581],256],126568:[[1591],256],126569:[[1610],256],126570:[[1603],256],126572:[[1605],256],126573:[[1606],256],126574:[[1587],256],126575:[[1593],256],126576:[[1601],256],126577:[[1589],256],126578:[[1602],256],126580:[[1588],256],126581:[[1578],256],126582:[[1579],256],126583:[[1582],256],126585:[[1590],256],126586:[[1592],256],126587:[[1594],256],126588:[[1646],256],126590:[[1697],256],126592:[[1575],256],126593:[[1576],256],126594:[[1580],256],126595:[[1583],256],126596:[[1607],256],126597:[[1608],256],126598:[[1586],256],126599:[[1581],256],126600:[[1591],256],126601:[[1610],256],126603:[[1604],256],126604:[[1605],256],126605:[[1606],256],126606:[[1587],256],126607:[[1593],256],126608:[[1601],256],126609:[[1589],256],126610:[[1602],256],126611:[[1585],256],126612:[[1588],256],126613:[[1578],256],126614:[[1579],256],126615:[[1582],256],126616:[[1584],256],126617:[[1590],256],126618:[[1592],256],126619:[[1594],256],126625:[[1576],256],126626:[[1580],256],126627:[[1583],256],126629:[[1608],256],126630:[[1586],256],126631:[[1581],256],126632:[[1591],256],126633:[[1610],256],126635:[[1604],256],126636:[[1605],256],126637:[[1606],256],126638:[[1587],256],126639:[[1593],256],126640:[[1601],256],126641:[[1589],256],126642:[[1602],256],126643:[[1585],256],126644:[[1588],256],126645:[[1578],256],126646:[[1579],256],126647:[[1582],256],126648:[[1584],256],126649:[[1590],256],126650:[[1592],256],126651:[[1594],256]},61696:{127232:[[48,46],256],127233:[[48,44],256],127234:[[49,44],256],127235:[[50,44],256],127236:[[51,44],256],127237:[[52,44],256],127238:[[53,44],256],127239:[[54,44],256],127240:[[55,44],256],127241:[[56,44],256],127242:[[57,44],256],127248:[[40,65,41],256],127249:[[40,66,41],256],127250:[[40,67,41],256],127251:[[40,68,41],256],127252:[[40,69,41],256],127253:[[40,70,41],256],127254:[[40,71,41],256],127255:[[40,72,41],256],127256:[[40,73,41],256],127257:[[40,74,41],256],127258:[[40,75,41],256],127259:[[40,76,41],256],127260:[[40,77,41],256],127261:[[40,78,41],256],127262:[[40,79,41],256],127263:[[40,80,41],256],127264:[[40,81,41],256],127265:[[40,82,41],256],127266:[[40,83,41],256],127267:[[40,84,41],256],127268:[[40,85,41],256],127269:[[40,86,41],256],127270:[[40,87,41],256],127271:[[40,88,41],256],127272:[[40,89,41],256],127273:[[40,90,41],256],127274:[[12308,83,12309],256],127275:[[67],256],127276:[[82],256],127277:[[67,68],256],127278:[[87,90],256],127280:[[65],256],127281:[[66],256],127282:[[67],256],127283:[[68],256],127284:[[69],256],127285:[[70],256],127286:[[71],256],127287:[[72],256],127288:[[73],256],127289:[[74],256],127290:[[75],256],127291:[[76],256],127292:[[77],256],127293:[[78],256],127294:[[79],256],127295:[[80],256],127296:[[81],256],127297:[[82],256],127298:[[83],256],127299:[[84],256],127300:[[85],256],127301:[[86],256],127302:[[87],256],127303:[[88],256],127304:[[89],256],127305:[[90],256],127306:[[72,86],256],127307:[[77,86],256],127308:[[83,68],256],127309:[[83,83],256],127310:[[80,80,86],256],127311:[[87,67],256],127338:[[77,67],256],127339:[[77,68],256],127376:[[68,74],256]},61952:{127488:[[12411,12363],256],127489:[[12467,12467],256],127490:[[12469],256],127504:[[25163],256],127505:[[23383],256],127506:[[21452],256],127507:[[12487],256],127508:[[20108],256],127509:[[22810],256],127510:[[35299],256],127511:[[22825],256],127512:[[20132],256],127513:[[26144],256],127514:[[28961],256],127515:[[26009],256],127516:[[21069],256],127517:[[24460],256],127518:[[20877],256],127519:[[26032],256],127520:[[21021],256],127521:[[32066],256],127522:[[29983],256],127523:[[36009],256],127524:[[22768],256],127525:[[21561],256],127526:[[28436],256],127527:[[25237],256],127528:[[25429],256],127529:[[19968],256],127530:[[19977],256],127531:[[36938],256],127532:[[24038],256],127533:[[20013],256],127534:[[21491],256],127535:[[25351],256],127536:[[36208],256],127537:[[25171],256],127538:[[31105],256],127539:[[31354],256],127540:[[21512],256],127541:[[28288],256],127542:[[26377],256],127543:[[26376],256],127544:[[30003],256],127545:[[21106],256],127546:[[21942],256],127552:[[12308,26412,12309],256],127553:[[12308,19977,12309],256],127554:[[12308,20108,12309],256],127555:[[12308,23433,12309],256],127556:[[12308,28857,12309],256],127557:[[12308,25171,12309],256],127558:[[12308,30423,12309],256],127559:[[12308,21213,12309],256],127560:[[12308,25943,12309],256],127568:[[24471],256],127569:[[21487],256]},63488:{194560:[[20029]],194561:[[20024]],194562:[[20033]],194563:[[131362]],194564:[[20320]],194565:[[20398]],194566:[[20411]],194567:[[20482]],194568:[[20602]],194569:[[20633]],194570:[[20711]],194571:[[20687]],194572:[[13470]],194573:[[132666]],194574:[[20813]],194575:[[20820]],194576:[[20836]],194577:[[20855]],194578:[[132380]],194579:[[13497]],194580:[[20839]],194581:[[20877]],194582:[[132427]],194583:[[20887]],194584:[[20900]],194585:[[20172]],194586:[[20908]],194587:[[20917]],194588:[[168415]],194589:[[20981]],194590:[[20995]],194591:[[13535]],194592:[[21051]],194593:[[21062]],194594:[[21106]],194595:[[21111]],194596:[[13589]],194597:[[21191]],194598:[[21193]],194599:[[21220]],194600:[[21242]],194601:[[21253]],194602:[[21254]],194603:[[21271]],194604:[[21321]],194605:[[21329]],194606:[[21338]],194607:[[21363]],194608:[[21373]],194609:[[21375]],194610:[[21375]],194611:[[21375]],194612:[[133676]],194613:[[28784]],194614:[[21450]],194615:[[21471]],194616:[[133987]],194617:[[21483]],194618:[[21489]],194619:[[21510]],194620:[[21662]],194621:[[21560]],194622:[[21576]],194623:[[21608]],194624:[[21666]],194625:[[21750]],194626:[[21776]],194627:[[21843]],194628:[[21859]],194629:[[21892]],194630:[[21892]],194631:[[21913]],194632:[[21931]],194633:[[21939]],194634:[[21954]],194635:[[22294]],194636:[[22022]],194637:[[22295]],194638:[[22097]],194639:[[22132]],194640:[[20999]],194641:[[22766]],194642:[[22478]],194643:[[22516]],194644:[[22541]],194645:[[22411]],194646:[[22578]],194647:[[22577]],194648:[[22700]],194649:[[136420]],194650:[[22770]],194651:[[22775]],194652:[[22790]],194653:[[22810]],194654:[[22818]],194655:[[22882]],194656:[[136872]],194657:[[136938]],194658:[[23020]],194659:[[23067]],194660:[[23079]],194661:[[23e3]],194662:[[23142]],194663:[[14062]],194664:[[14076]],194665:[[23304]],194666:[[23358]],194667:[[23358]],194668:[[137672]],194669:[[23491]],194670:[[23512]],194671:[[23527]],194672:[[23539]],194673:[[138008]],194674:[[23551]],194675:[[23558]],194676:[[24403]],194677:[[23586]],194678:[[14209]],194679:[[23648]],194680:[[23662]],194681:[[23744]],194682:[[23693]],194683:[[138724]],194684:[[23875]],194685:[[138726]],194686:[[23918]],194687:[[23915]],194688:[[23932]],194689:[[24033]],194690:[[24034]],194691:[[14383]],194692:[[24061]],194693:[[24104]],194694:[[24125]],194695:[[24169]],194696:[[14434]],194697:[[139651]],194698:[[14460]],194699:[[24240]],194700:[[24243]],194701:[[24246]],194702:[[24266]],194703:[[172946]],194704:[[24318]],194705:[[140081]],194706:[[140081]],194707:[[33281]],194708:[[24354]],194709:[[24354]],194710:[[14535]],194711:[[144056]],194712:[[156122]],194713:[[24418]],194714:[[24427]],194715:[[14563]],194716:[[24474]],194717:[[24525]],194718:[[24535]],194719:[[24569]],194720:[[24705]],194721:[[14650]],194722:[[14620]],194723:[[24724]],194724:[[141012]],194725:[[24775]],194726:[[24904]],194727:[[24908]],194728:[[24910]],194729:[[24908]],194730:[[24954]],194731:[[24974]],194732:[[25010]],194733:[[24996]],194734:[[25007]],194735:[[25054]],194736:[[25074]],194737:[[25078]],194738:[[25104]],194739:[[25115]],194740:[[25181]],194741:[[25265]],194742:[[25300]],194743:[[25424]],194744:[[142092]],194745:[[25405]],194746:[[25340]],194747:[[25448]],194748:[[25475]],194749:[[25572]],194750:[[142321]],194751:[[25634]],194752:[[25541]],194753:[[25513]],194754:[[14894]],194755:[[25705]],194756:[[25726]],194757:[[25757]],194758:[[25719]],194759:[[14956]],194760:[[25935]],194761:[[25964]],194762:[[143370]],194763:[[26083]],194764:[[26360]],194765:[[26185]],194766:[[15129]],194767:[[26257]],194768:[[15112]],194769:[[15076]],194770:[[20882]],194771:[[20885]],194772:[[26368]],194773:[[26268]],194774:[[32941]],194775:[[17369]],194776:[[26391]],194777:[[26395]],194778:[[26401]],194779:[[26462]],194780:[[26451]],194781:[[144323]],194782:[[15177]],194783:[[26618]],194784:[[26501]],194785:[[26706]],194786:[[26757]],194787:[[144493]],194788:[[26766]],194789:[[26655]],194790:[[26900]],194791:[[15261]],194792:[[26946]],194793:[[27043]],194794:[[27114]],194795:[[27304]],194796:[[145059]],194797:[[27355]],194798:[[15384]],194799:[[27425]],194800:[[145575]],194801:[[27476]],194802:[[15438]],194803:[[27506]],194804:[[27551]],194805:[[27578]],194806:[[27579]],194807:[[146061]],194808:[[138507]],194809:[[146170]],194810:[[27726]],194811:[[146620]],194812:[[27839]],194813:[[27853]],194814:[[27751]],194815:[[27926]]},63744:{63744:[[35912]],63745:[[26356]],63746:[[36554]],63747:[[36040]],63748:[[28369]],63749:[[20018]],63750:[[21477]],63751:[[40860]],63752:[[40860]],63753:[[22865]],63754:[[37329]],63755:[[21895]],63756:[[22856]],63757:[[25078]],63758:[[30313]],63759:[[32645]],63760:[[34367]],63761:[[34746]],63762:[[35064]],63763:[[37007]],63764:[[27138]],63765:[[27931]],63766:[[28889]],63767:[[29662]],63768:[[33853]],63769:[[37226]],63770:[[39409]],63771:[[20098]],63772:[[21365]],63773:[[27396]],63774:[[29211]],63775:[[34349]],63776:[[40478]],63777:[[23888]],63778:[[28651]],63779:[[34253]],63780:[[35172]],63781:[[25289]],63782:[[33240]],63783:[[34847]],63784:[[24266]],63785:[[26391]],63786:[[28010]],63787:[[29436]],63788:[[37070]],63789:[[20358]],63790:[[20919]],63791:[[21214]],63792:[[25796]],63793:[[27347]],63794:[[29200]],63795:[[30439]],63796:[[32769]],63797:[[34310]],63798:[[34396]],63799:[[36335]],63800:[[38706]],63801:[[39791]],63802:[[40442]],63803:[[30860]],63804:[[31103]],63805:[[32160]],63806:[[33737]],63807:[[37636]],63808:[[40575]],63809:[[35542]],63810:[[22751]],63811:[[24324]],63812:[[31840]],63813:[[32894]],63814:[[29282]],63815:[[30922]],63816:[[36034]],63817:[[38647]],63818:[[22744]],63819:[[23650]],63820:[[27155]],63821:[[28122]],63822:[[28431]],63823:[[32047]],63824:[[32311]],63825:[[38475]],63826:[[21202]],63827:[[32907]],63828:[[20956]],63829:[[20940]],63830:[[31260]],63831:[[32190]],63832:[[33777]],63833:[[38517]],63834:[[35712]],63835:[[25295]],63836:[[27138]],63837:[[35582]],63838:[[20025]],63839:[[23527]],63840:[[24594]],63841:[[29575]],63842:[[30064]],63843:[[21271]],63844:[[30971]],63845:[[20415]],63846:[[24489]],63847:[[19981]],63848:[[27852]],63849:[[25976]],63850:[[32034]],63851:[[21443]],63852:[[22622]],63853:[[30465]],63854:[[33865]],63855:[[35498]],63856:[[27578]],63857:[[36784]],63858:[[27784]],63859:[[25342]],63860:[[33509]],63861:[[25504]],63862:[[30053]],63863:[[20142]],63864:[[20841]],63865:[[20937]],63866:[[26753]],63867:[[31975]],63868:[[33391]],63869:[[35538]],63870:[[37327]],63871:[[21237]],63872:[[21570]],63873:[[22899]],63874:[[24300]],63875:[[26053]],63876:[[28670]],63877:[[31018]],63878:[[38317]],63879:[[39530]],63880:[[40599]],63881:[[40654]],63882:[[21147]],63883:[[26310]],63884:[[27511]],63885:[[36706]],63886:[[24180]],63887:[[24976]],63888:[[25088]],63889:[[25754]],63890:[[28451]],63891:[[29001]],63892:[[29833]],63893:[[31178]],63894:[[32244]],63895:[[32879]],63896:[[36646]],63897:[[34030]],63898:[[36899]],63899:[[37706]],63900:[[21015]],63901:[[21155]],63902:[[21693]],63903:[[28872]],63904:[[35010]],63905:[[35498]],63906:[[24265]],63907:[[24565]],63908:[[25467]],63909:[[27566]],63910:[[31806]],63911:[[29557]],63912:[[20196]],63913:[[22265]],63914:[[23527]],63915:[[23994]],63916:[[24604]],63917:[[29618]],63918:[[29801]],63919:[[32666]],63920:[[32838]],63921:[[37428]],63922:[[38646]],63923:[[38728]],63924:[[38936]],63925:[[20363]],63926:[[31150]],63927:[[37300]],63928:[[38584]],63929:[[24801]],63930:[[20102]],63931:[[20698]],63932:[[23534]],63933:[[23615]],63934:[[26009]],63935:[[27138]],63936:[[29134]],63937:[[30274]],63938:[[34044]],63939:[[36988]],63940:[[40845]],63941:[[26248]],63942:[[38446]],63943:[[21129]],63944:[[26491]],63945:[[26611]],63946:[[27969]],63947:[[28316]],63948:[[29705]],63949:[[30041]],63950:[[30827]],63951:[[32016]],63952:[[39006]],63953:[[20845]],63954:[[25134]],63955:[[38520]],63956:[[20523]],63957:[[23833]],63958:[[28138]],63959:[[36650]],63960:[[24459]],63961:[[24900]],63962:[[26647]],63963:[[29575]],63964:[[38534]],63965:[[21033]],63966:[[21519]],63967:[[23653]],63968:[[26131]],63969:[[26446]],63970:[[26792]],63971:[[27877]],63972:[[29702]],63973:[[30178]],63974:[[32633]],63975:[[35023]],63976:[[35041]],63977:[[37324]],63978:[[38626]],63979:[[21311]],63980:[[28346]],63981:[[21533]],63982:[[29136]],63983:[[29848]],63984:[[34298]],63985:[[38563]],63986:[[40023]],63987:[[40607]],63988:[[26519]],63989:[[28107]],63990:[[33256]],63991:[[31435]],63992:[[31520]],63993:[[31890]],63994:[[29376]],63995:[[28825]],63996:[[35672]],63997:[[20160]],63998:[[33590]],63999:[[21050]],194816:[[27966]],194817:[[28023]],194818:[[27969]],194819:[[28009]],194820:[[28024]],194821:[[28037]],194822:[[146718]],194823:[[27956]],194824:[[28207]],194825:[[28270]],194826:[[15667]],194827:[[28363]],194828:[[28359]],194829:[[147153]],194830:[[28153]],194831:[[28526]],194832:[[147294]],194833:[[147342]],194834:[[28614]],194835:[[28729]],194836:[[28702]],194837:[[28699]],194838:[[15766]],194839:[[28746]],194840:[[28797]],194841:[[28791]],194842:[[28845]],194843:[[132389]],194844:[[28997]],194845:[[148067]],194846:[[29084]],194847:[[148395]],194848:[[29224]],194849:[[29237]],194850:[[29264]],194851:[[149e3]],194852:[[29312]],194853:[[29333]],194854:[[149301]],194855:[[149524]],194856:[[29562]],194857:[[29579]],194858:[[16044]],194859:[[29605]],194860:[[16056]],194861:[[16056]],194862:[[29767]],194863:[[29788]],194864:[[29809]],194865:[[29829]],194866:[[29898]],194867:[[16155]],194868:[[29988]],194869:[[150582]],194870:[[30014]],194871:[[150674]],194872:[[30064]],194873:[[139679]],194874:[[30224]],194875:[[151457]],194876:[[151480]],194877:[[151620]],194878:[[16380]],194879:[[16392]],194880:[[30452]],194881:[[151795]],194882:[[151794]],194883:[[151833]],194884:[[151859]],194885:[[30494]],194886:[[30495]],194887:[[30495]],194888:[[30538]],194889:[[16441]],194890:[[30603]],194891:[[16454]],194892:[[16534]],194893:[[152605]],194894:[[30798]],194895:[[30860]],194896:[[30924]],194897:[[16611]],194898:[[153126]],194899:[[31062]],194900:[[153242]],194901:[[153285]],194902:[[31119]],194903:[[31211]],194904:[[16687]],194905:[[31296]],194906:[[31306]],194907:[[31311]],194908:[[153980]],194909:[[154279]],194910:[[154279]],194911:[[31470]],194912:[[16898]],194913:[[154539]],194914:[[31686]],194915:[[31689]],194916:[[16935]],194917:[[154752]],194918:[[31954]],194919:[[17056]],194920:[[31976]],194921:[[31971]],194922:[[32e3]],194923:[[155526]],194924:[[32099]],194925:[[17153]],194926:[[32199]],194927:[[32258]],194928:[[32325]],194929:[[17204]],194930:[[156200]],194931:[[156231]],194932:[[17241]],194933:[[156377]],194934:[[32634]],194935:[[156478]],194936:[[32661]],194937:[[32762]],194938:[[32773]],194939:[[156890]],194940:[[156963]],194941:[[32864]],194942:[[157096]],194943:[[32880]],194944:[[144223]],194945:[[17365]],194946:[[32946]],194947:[[33027]],194948:[[17419]],194949:[[33086]],194950:[[23221]],194951:[[157607]],194952:[[157621]],194953:[[144275]],194954:[[144284]],194955:[[33281]],194956:[[33284]],194957:[[36766]],194958:[[17515]],194959:[[33425]],194960:[[33419]],194961:[[33437]],194962:[[21171]],194963:[[33457]],194964:[[33459]],194965:[[33469]],194966:[[33510]],194967:[[158524]],194968:[[33509]],194969:[[33565]],194970:[[33635]],194971:[[33709]],194972:[[33571]],194973:[[33725]],194974:[[33767]],194975:[[33879]],194976:[[33619]],194977:[[33738]],194978:[[33740]],194979:[[33756]],194980:[[158774]],194981:[[159083]],194982:[[158933]],194983:[[17707]],194984:[[34033]],194985:[[34035]],194986:[[34070]],194987:[[160714]],194988:[[34148]],194989:[[159532]],194990:[[17757]],194991:[[17761]],194992:[[159665]],194993:[[159954]],194994:[[17771]],194995:[[34384]],194996:[[34396]],194997:[[34407]],194998:[[34409]],194999:[[34473]],195000:[[34440]],195001:[[34574]],195002:[[34530]],195003:[[34681]],195004:[[34600]],195005:[[34667]],195006:[[34694]],195007:[[17879]],195008:[[34785]],195009:[[34817]],195010:[[17913]],195011:[[34912]],195012:[[34915]],195013:[[161383]],195014:[[35031]],195015:[[35038]],195016:[[17973]],195017:[[35066]],195018:[[13499]],195019:[[161966]],195020:[[162150]],195021:[[18110]],195022:[[18119]],195023:[[35488]],195024:[[35565]],195025:[[35722]],195026:[[35925]],195027:[[162984]],195028:[[36011]],195029:[[36033]],195030:[[36123]],195031:[[36215]],195032:[[163631]],195033:[[133124]],195034:[[36299]],195035:[[36284]],195036:[[36336]],195037:[[133342]],195038:[[36564]],195039:[[36664]],195040:[[165330]],195041:[[165357]],195042:[[37012]],195043:[[37105]],195044:[[37137]],195045:[[165678]],195046:[[37147]],195047:[[37432]],195048:[[37591]],195049:[[37592]],195050:[[37500]],195051:[[37881]],195052:[[37909]],195053:[[166906]],195054:[[38283]],195055:[[18837]],195056:[[38327]],195057:[[167287]],195058:[[18918]],195059:[[38595]],195060:[[23986]],195061:[[38691]],195062:[[168261]],195063:[[168474]],195064:[[19054]],195065:[[19062]],195066:[[38880]],195067:[[168970]],195068:[[19122]],195069:[[169110]],195070:[[38923]],195071:[[38923]]},64000:{64000:[[20999]],64001:[[24230]],64002:[[25299]],64003:[[31958]],64004:[[23429]],64005:[[27934]],64006:[[26292]],64007:[[36667]],64008:[[34892]],64009:[[38477]],64010:[[35211]],64011:[[24275]],64012:[[20800]],64013:[[21952]],64016:[[22618]],64018:[[26228]],64021:[[20958]],64022:[[29482]],64023:[[30410]],64024:[[31036]],64025:[[31070]],64026:[[31077]],64027:[[31119]],64028:[[38742]],64029:[[31934]],64030:[[32701]],64032:[[34322]],64034:[[35576]],64037:[[36920]],64038:[[37117]],64042:[[39151]],64043:[[39164]],64044:[[39208]],64045:[[40372]],64046:[[37086]],64047:[[38583]],64048:[[20398]],64049:[[20711]],64050:[[20813]],64051:[[21193]],64052:[[21220]],64053:[[21329]],64054:[[21917]],64055:[[22022]],64056:[[22120]],64057:[[22592]],64058:[[22696]],64059:[[23652]],64060:[[23662]],64061:[[24724]],64062:[[24936]],64063:[[24974]],64064:[[25074]],64065:[[25935]],64066:[[26082]],64067:[[26257]],64068:[[26757]],64069:[[28023]],64070:[[28186]],64071:[[28450]],64072:[[29038]],64073:[[29227]],64074:[[29730]],64075:[[30865]],64076:[[31038]],64077:[[31049]],64078:[[31048]],64079:[[31056]],64080:[[31062]],64081:[[31069]],64082:[[31117]],64083:[[31118]],64084:[[31296]],64085:[[31361]],64086:[[31680]],64087:[[32244]],64088:[[32265]],64089:[[32321]],64090:[[32626]],64091:[[32773]],64092:[[33261]],64093:[[33401]],64094:[[33401]],64095:[[33879]],64096:[[35088]],64097:[[35222]],64098:[[35585]],64099:[[35641]],64100:[[36051]],64101:[[36104]],64102:[[36790]],64103:[[36920]],64104:[[38627]],64105:[[38911]],64106:[[38971]],64107:[[24693]],64108:[[148206]],64109:[[33304]],64112:[[20006]],64113:[[20917]],64114:[[20840]],64115:[[20352]],64116:[[20805]],64117:[[20864]],64118:[[21191]],64119:[[21242]],64120:[[21917]],64121:[[21845]],64122:[[21913]],64123:[[21986]],64124:[[22618]],64125:[[22707]],64126:[[22852]],64127:[[22868]],64128:[[23138]],64129:[[23336]],64130:[[24274]],64131:[[24281]],64132:[[24425]],64133:[[24493]],64134:[[24792]],64135:[[24910]],64136:[[24840]],64137:[[24974]],64138:[[24928]],64139:[[25074]],64140:[[25140]],64141:[[25540]],64142:[[25628]],64143:[[25682]],64144:[[25942]],64145:[[26228]],64146:[[26391]],64147:[[26395]],64148:[[26454]],64149:[[27513]],64150:[[27578]],64151:[[27969]],64152:[[28379]],64153:[[28363]],64154:[[28450]],64155:[[28702]],64156:[[29038]],64157:[[30631]],64158:[[29237]],64159:[[29359]],64160:[[29482]],64161:[[29809]],64162:[[29958]],64163:[[30011]],64164:[[30237]],64165:[[30239]],64166:[[30410]],64167:[[30427]],64168:[[30452]],64169:[[30538]],64170:[[30528]],64171:[[30924]],64172:[[31409]],64173:[[31680]],64174:[[31867]],64175:[[32091]],64176:[[32244]],64177:[[32574]],64178:[[32773]],64179:[[33618]],64180:[[33775]],64181:[[34681]],64182:[[35137]],64183:[[35206]],64184:[[35222]],64185:[[35519]],64186:[[35576]],64187:[[35531]],64188:[[35585]],64189:[[35582]],64190:[[35565]],64191:[[35641]],64192:[[35722]],64193:[[36104]],64194:[[36664]],64195:[[36978]],64196:[[37273]],64197:[[37494]],64198:[[38524]],64199:[[38627]],64200:[[38742]],64201:[[38875]],64202:[[38911]],64203:[[38923]],64204:[[38971]],64205:[[39698]],64206:[[40860]],64207:[[141386]],64208:[[141380]],64209:[[144341]],64210:[[15261]],64211:[[16408]],64212:[[16441]],64213:[[152137]],64214:[[154832]],64215:[[163539]],64216:[[40771]],64217:[[40846]],195072:[[38953]],195073:[[169398]],195074:[[39138]],195075:[[19251]],195076:[[39209]],195077:[[39335]],195078:[[39362]],195079:[[39422]],195080:[[19406]],195081:[[170800]],195082:[[39698]],195083:[[4e4]],195084:[[40189]],195085:[[19662]],195086:[[19693]],195087:[[40295]],195088:[[172238]],195089:[[19704]],195090:[[172293]],195091:[[172558]],195092:[[172689]],195093:[[40635]],195094:[[19798]],195095:[[40697]],195096:[[40702]],195097:[[40709]],195098:[[40719]],195099:[[40726]],195100:[[40763]],195101:[[173568]]},64256:{64256:[[102,102],256],64257:[[102,105],256],64258:[[102,108],256],64259:[[102,102,105],256],64260:[[102,102,108],256],64261:[[383,116],256],64262:[[115,116],256],64275:[[1396,1398],256],64276:[[1396,1381],256],64277:[[1396,1387],256],64278:[[1406,1398],256],64279:[[1396,1389],256],64285:[[1497,1460],512],64286:[null,26],64287:[[1522,1463],512],64288:[[1506],256],64289:[[1488],256],64290:[[1491],256],64291:[[1492],256],64292:[[1499],256],64293:[[1500],256],64294:[[1501],256],64295:[[1512],256],64296:[[1514],256],64297:[[43],256],64298:[[1513,1473],512],64299:[[1513,1474],512],64300:[[64329,1473],512],64301:[[64329,1474],512],64302:[[1488,1463],512],64303:[[1488,1464],512],64304:[[1488,1468],512],64305:[[1489,1468],512],64306:[[1490,1468],512],64307:[[1491,1468],512],64308:[[1492,1468],512],64309:[[1493,1468],512],64310:[[1494,1468],512],64312:[[1496,1468],512],64313:[[1497,1468],512],64314:[[1498,1468],512],64315:[[1499,1468],512],64316:[[1500,1468],512],64318:[[1502,1468],512],64320:[[1504,1468],512],64321:[[1505,1468],512],64323:[[1507,1468],512],64324:[[1508,1468],512],64326:[[1510,1468],512],64327:[[1511,1468],512],64328:[[1512,1468],512],64329:[[1513,1468],512],64330:[[1514,1468],512],64331:[[1493,1465],512],64332:[[1489,1471],512],64333:[[1499,1471],512],64334:[[1508,1471],512],64335:[[1488,1500],256],64336:[[1649],256],64337:[[1649],256],64338:[[1659],256],64339:[[1659],256],64340:[[1659],256],64341:[[1659],256],64342:[[1662],256],64343:[[1662],256],64344:[[1662],256],64345:[[1662],256],64346:[[1664],256],64347:[[1664],256],64348:[[1664],256],64349:[[1664],256],64350:[[1658],256],64351:[[1658],256],64352:[[1658],256],64353:[[1658],256],64354:[[1663],256],64355:[[1663],256],64356:[[1663],256],64357:[[1663],256],64358:[[1657],256],64359:[[1657],256],64360:[[1657],256],64361:[[1657],256],64362:[[1700],256],64363:[[1700],256],64364:[[1700],256],64365:[[1700],256],64366:[[1702],256],64367:[[1702],256],64368:[[1702],256],64369:[[1702],256],64370:[[1668],256],64371:[[1668],256],64372:[[1668],256],64373:[[1668],256],64374:[[1667],256],64375:[[1667],256],64376:[[1667],256],64377:[[1667],256],64378:[[1670],256],64379:[[1670],256],64380:[[1670],256],64381:[[1670],256],64382:[[1671],256],64383:[[1671],256],64384:[[1671],256],64385:[[1671],256],64386:[[1677],256],64387:[[1677],256],64388:[[1676],256],64389:[[1676],256],64390:[[1678],256],64391:[[1678],256],64392:[[1672],256],64393:[[1672],256],64394:[[1688],256],64395:[[1688],256],64396:[[1681],256],64397:[[1681],256],64398:[[1705],256],64399:[[1705],256],64400:[[1705],256],64401:[[1705],256],64402:[[1711],256],64403:[[1711],256],64404:[[1711],256],64405:[[1711],256],64406:[[1715],256],64407:[[1715],256],64408:[[1715],256],64409:[[1715],256],64410:[[1713],256],64411:[[1713],256],64412:[[1713],256],64413:[[1713],256],64414:[[1722],256],64415:[[1722],256],64416:[[1723],256],64417:[[1723],256],64418:[[1723],256],64419:[[1723],256],64420:[[1728],256],64421:[[1728],256],64422:[[1729],256],64423:[[1729],256],64424:[[1729],256],64425:[[1729],256],64426:[[1726],256],64427:[[1726],256],64428:[[1726],256],64429:[[1726],256],64430:[[1746],256],64431:[[1746],256],64432:[[1747],256],64433:[[1747],256],64467:[[1709],256],64468:[[1709],256],64469:[[1709],256],64470:[[1709],256],64471:[[1735],256],64472:[[1735],256],64473:[[1734],256],64474:[[1734],256],64475:[[1736],256],64476:[[1736],256],64477:[[1655],256],64478:[[1739],256],64479:[[1739],256],64480:[[1733],256],64481:[[1733],256],64482:[[1737],256],64483:[[1737],256],64484:[[1744],256],64485:[[1744],256],64486:[[1744],256],64487:[[1744],256],64488:[[1609],256],64489:[[1609],256],64490:[[1574,1575],256],64491:[[1574,1575],256],64492:[[1574,1749],256],64493:[[1574,1749],256],64494:[[1574,1608],256],64495:[[1574,1608],256],64496:[[1574,1735],256],64497:[[1574,1735],256],64498:[[1574,1734],256],64499:[[1574,1734],256],64500:[[1574,1736],256],64501:[[1574,1736],256],64502:[[1574,1744],256],64503:[[1574,1744],256],64504:[[1574,1744],256],64505:[[1574,1609],256],64506:[[1574,1609],256],64507:[[1574,1609],256],64508:[[1740],256],64509:[[1740],256],64510:[[1740],256],64511:[[1740],256]},64512:{64512:[[1574,1580],256],64513:[[1574,1581],256],64514:[[1574,1605],256],64515:[[1574,1609],256],64516:[[1574,1610],256],64517:[[1576,1580],256],64518:[[1576,1581],256],64519:[[1576,1582],256],64520:[[1576,1605],256],64521:[[1576,1609],256],64522:[[1576,1610],256],64523:[[1578,1580],256],64524:[[1578,1581],256],64525:[[1578,1582],256],64526:[[1578,1605],256],64527:[[1578,1609],256],64528:[[1578,1610],256],64529:[[1579,1580],256],64530:[[1579,1605],256],64531:[[1579,1609],256],64532:[[1579,1610],256],64533:[[1580,1581],256],64534:[[1580,1605],256],64535:[[1581,1580],256],64536:[[1581,1605],256],64537:[[1582,1580],256],64538:[[1582,1581],256],64539:[[1582,1605],256],64540:[[1587,1580],256],64541:[[1587,1581],256],64542:[[1587,1582],256],64543:[[1587,1605],256],64544:[[1589,1581],256],64545:[[1589,1605],256],64546:[[1590,1580],256],64547:[[1590,1581],256],64548:[[1590,1582],256],64549:[[1590,1605],256],64550:[[1591,1581],256],64551:[[1591,1605],256],64552:[[1592,1605],256],64553:[[1593,1580],256],64554:[[1593,1605],256],64555:[[1594,1580],256],64556:[[1594,1605],256],64557:[[1601,1580],256],64558:[[1601,1581],256],64559:[[1601,1582],256],64560:[[1601,1605],256],64561:[[1601,1609],256],64562:[[1601,1610],256],64563:[[1602,1581],256],64564:[[1602,1605],256],64565:[[1602,1609],256],64566:[[1602,1610],256],64567:[[1603,1575],256],64568:[[1603,1580],256],64569:[[1603,1581],256],64570:[[1603,1582],256],64571:[[1603,1604],256],64572:[[1603,1605],256],64573:[[1603,1609],256],64574:[[1603,1610],256],64575:[[1604,1580],256],64576:[[1604,1581],256],64577:[[1604,1582],256],64578:[[1604,1605],256],64579:[[1604,1609],256],64580:[[1604,1610],256],64581:[[1605,1580],256],64582:[[1605,1581],256],64583:[[1605,1582],256],64584:[[1605,1605],256],64585:[[1605,1609],256],64586:[[1605,1610],256],64587:[[1606,1580],256],64588:[[1606,1581],256],64589:[[1606,1582],256],64590:[[1606,1605],256],64591:[[1606,1609],256],64592:[[1606,1610],256],64593:[[1607,1580],256],64594:[[1607,1605],256],64595:[[1607,1609],256],64596:[[1607,1610],256],64597:[[1610,1580],256],64598:[[1610,1581],256],64599:[[1610,1582],256],64600:[[1610,1605],256],64601:[[1610,1609],256],64602:[[1610,1610],256],64603:[[1584,1648],256],64604:[[1585,1648],256],64605:[[1609,1648],256],64606:[[32,1612,1617],256],64607:[[32,1613,1617],256],64608:[[32,1614,1617],256],64609:[[32,1615,1617],256],64610:[[32,1616,1617],256],64611:[[32,1617,1648],256],64612:[[1574,1585],256],64613:[[1574,1586],256],64614:[[1574,1605],256],64615:[[1574,1606],256],64616:[[1574,1609],256],64617:[[1574,1610],256],64618:[[1576,1585],256],64619:[[1576,1586],256],64620:[[1576,1605],256],64621:[[1576,1606],256],64622:[[1576,1609],256],64623:[[1576,1610],256],64624:[[1578,1585],256],64625:[[1578,1586],256],64626:[[1578,1605],256],64627:[[1578,1606],256],64628:[[1578,1609],256],64629:[[1578,1610],256],64630:[[1579,1585],256],64631:[[1579,1586],256],64632:[[1579,1605],256],64633:[[1579,1606],256],64634:[[1579,1609],256],64635:[[1579,1610],256],64636:[[1601,1609],256],64637:[[1601,1610],256],64638:[[1602,1609],256],64639:[[1602,1610],256],64640:[[1603,1575],256],64641:[[1603,1604],256],64642:[[1603,1605],256],64643:[[1603,1609],256],64644:[[1603,1610],256],64645:[[1604,1605],256],64646:[[1604,1609],256],64647:[[1604,1610],256],64648:[[1605,1575],256],64649:[[1605,1605],256],64650:[[1606,1585],256],64651:[[1606,1586],256],64652:[[1606,1605],256],64653:[[1606,1606],256],64654:[[1606,1609],256],64655:[[1606,1610],256],64656:[[1609,1648],256],64657:[[1610,1585],256],64658:[[1610,1586],256],64659:[[1610,1605],256],64660:[[1610,1606],256],64661:[[1610,1609],256],64662:[[1610,1610],256],64663:[[1574,1580],256],64664:[[1574,1581],256],64665:[[1574,1582],256],64666:[[1574,1605],256],64667:[[1574,1607],256],64668:[[1576,1580],256],64669:[[1576,1581],256],64670:[[1576,1582],256],64671:[[1576,1605],256],64672:[[1576,1607],256],64673:[[1578,1580],256],64674:[[1578,1581],256],64675:[[1578,1582],256],64676:[[1578,1605],256],64677:[[1578,1607],256],64678:[[1579,1605],256],64679:[[1580,1581],256],64680:[[1580,1605],256],64681:[[1581,1580],256],64682:[[1581,1605],256],64683:[[1582,1580],256],64684:[[1582,1605],256],64685:[[1587,1580],256],64686:[[1587,1581],256],64687:[[1587,1582],256],64688:[[1587,1605],256],64689:[[1589,1581],256],64690:[[1589,1582],256],64691:[[1589,1605],256],64692:[[1590,1580],256],64693:[[1590,1581],256],64694:[[1590,1582],256],64695:[[1590,1605],256],64696:[[1591,1581],256],64697:[[1592,1605],256],64698:[[1593,1580],256],64699:[[1593,1605],256],64700:[[1594,1580],256],64701:[[1594,1605],256],64702:[[1601,1580],256],64703:[[1601,1581],256],64704:[[1601,1582],256],64705:[[1601,1605],256],64706:[[1602,1581],256],64707:[[1602,1605],256],64708:[[1603,1580],256],64709:[[1603,1581],256],64710:[[1603,1582],256],64711:[[1603,1604],256],64712:[[1603,1605],256],64713:[[1604,1580],256],64714:[[1604,1581],256],64715:[[1604,1582],256],64716:[[1604,1605],256],64717:[[1604,1607],256],64718:[[1605,1580],256],64719:[[1605,1581],256],64720:[[1605,1582],256],64721:[[1605,1605],256],64722:[[1606,1580],256],64723:[[1606,1581],256],64724:[[1606,1582],256],64725:[[1606,1605],256],64726:[[1606,1607],256],64727:[[1607,1580],256],64728:[[1607,1605],256],64729:[[1607,1648],256],64730:[[1610,1580],256],64731:[[1610,1581],256],64732:[[1610,1582],256],64733:[[1610,1605],256],64734:[[1610,1607],256],64735:[[1574,1605],256],64736:[[1574,1607],256],64737:[[1576,1605],256],64738:[[1576,1607],256],64739:[[1578,1605],256],64740:[[1578,1607],256],64741:[[1579,1605],256],64742:[[1579,1607],256],64743:[[1587,1605],256],64744:[[1587,1607],256],64745:[[1588,1605],256],64746:[[1588,1607],256],64747:[[1603,1604],256],64748:[[1603,1605],256],64749:[[1604,1605],256],64750:[[1606,1605],256],64751:[[1606,1607],256],64752:[[1610,1605],256],64753:[[1610,1607],256],64754:[[1600,1614,1617],256],64755:[[1600,1615,1617],256],64756:[[1600,1616,1617],256],64757:[[1591,1609],256],64758:[[1591,1610],256],64759:[[1593,1609],256],64760:[[1593,1610],256],64761:[[1594,1609],256],64762:[[1594,1610],256],64763:[[1587,1609],256],64764:[[1587,1610],256],64765:[[1588,1609],256],64766:[[1588,1610],256],64767:[[1581,1609],256]},64768:{64768:[[1581,1610],256],64769:[[1580,1609],256],64770:[[1580,1610],256],64771:[[1582,1609],256],64772:[[1582,1610],256],64773:[[1589,1609],256],64774:[[1589,1610],256],64775:[[1590,1609],256],64776:[[1590,1610],256],64777:[[1588,1580],256],64778:[[1588,1581],256],64779:[[1588,1582],256],64780:[[1588,1605],256],64781:[[1588,1585],256],64782:[[1587,1585],256],64783:[[1589,1585],256],64784:[[1590,1585],256],64785:[[1591,1609],256],64786:[[1591,1610],256],64787:[[1593,1609],256],64788:[[1593,1610],256],64789:[[1594,1609],256],64790:[[1594,1610],256],64791:[[1587,1609],256],64792:[[1587,1610],256],64793:[[1588,1609],256],64794:[[1588,1610],256],64795:[[1581,1609],256],64796:[[1581,1610],256],64797:[[1580,1609],256],64798:[[1580,1610],256],64799:[[1582,1609],256],64800:[[1582,1610],256],64801:[[1589,1609],256],64802:[[1589,1610],256],64803:[[1590,1609],256],64804:[[1590,1610],256],64805:[[1588,1580],256],64806:[[1588,1581],256],64807:[[1588,1582],256],64808:[[1588,1605],256],64809:[[1588,1585],256],64810:[[1587,1585],256],64811:[[1589,1585],256],64812:[[1590,1585],256],64813:[[1588,1580],256],64814:[[1588,1581],256],64815:[[1588,1582],256],64816:[[1588,1605],256],64817:[[1587,1607],256],64818:[[1588,1607],256],64819:[[1591,1605],256],64820:[[1587,1580],256],64821:[[1587,1581],256],64822:[[1587,1582],256],64823:[[1588,1580],256],64824:[[1588,1581],256],64825:[[1588,1582],256],64826:[[1591,1605],256],64827:[[1592,1605],256],64828:[[1575,1611],256],64829:[[1575,1611],256],64848:[[1578,1580,1605],256],64849:[[1578,1581,1580],256],64850:[[1578,1581,1580],256],64851:[[1578,1581,1605],256],64852:[[1578,1582,1605],256],64853:[[1578,1605,1580],256],64854:[[1578,1605,1581],256],64855:[[1578,1605,1582],256],64856:[[1580,1605,1581],256],64857:[[1580,1605,1581],256],64858:[[1581,1605,1610],256],64859:[[1581,1605,1609],256],64860:[[1587,1581,1580],256],64861:[[1587,1580,1581],256],64862:[[1587,1580,1609],256],64863:[[1587,1605,1581],256],64864:[[1587,1605,1581],256],64865:[[1587,1605,1580],256],64866:[[1587,1605,1605],256],64867:[[1587,1605,1605],256],64868:[[1589,1581,1581],256],64869:[[1589,1581,1581],256],64870:[[1589,1605,1605],256],64871:[[1588,1581,1605],256],64872:[[1588,1581,1605],256],64873:[[1588,1580,1610],256],64874:[[1588,1605,1582],256],64875:[[1588,1605,1582],256],64876:[[1588,1605,1605],256],64877:[[1588,1605,1605],256],64878:[[1590,1581,1609],256],64879:[[1590,1582,1605],256],64880:[[1590,1582,1605],256],64881:[[1591,1605,1581],256],64882:[[1591,1605,1581],256],64883:[[1591,1605,1605],256],64884:[[1591,1605,1610],256],64885:[[1593,1580,1605],256],64886:[[1593,1605,1605],256],64887:[[1593,1605,1605],256],64888:[[1593,1605,1609],256],64889:[[1594,1605,1605],256],64890:[[1594,1605,1610],256],64891:[[1594,1605,1609],256],64892:[[1601,1582,1605],256],64893:[[1601,1582,1605],256],64894:[[1602,1605,1581],256],64895:[[1602,1605,1605],256],64896:[[1604,1581,1605],256],64897:[[1604,1581,1610],256],64898:[[1604,1581,1609],256],64899:[[1604,1580,1580],256],64900:[[1604,1580,1580],256],64901:[[1604,1582,1605],256],64902:[[1604,1582,1605],256],64903:[[1604,1605,1581],256],64904:[[1604,1605,1581],256],64905:[[1605,1581,1580],256],64906:[[1605,1581,1605],256],64907:[[1605,1581,1610],256],64908:[[1605,1580,1581],256],64909:[[1605,1580,1605],256],64910:[[1605,1582,1580],256],64911:[[1605,1582,1605],256],64914:[[1605,1580,1582],256],64915:[[1607,1605,1580],256],64916:[[1607,1605,1605],256],64917:[[1606,1581,1605],256],64918:[[1606,1581,1609],256],64919:[[1606,1580,1605],256],64920:[[1606,1580,1605],256],64921:[[1606,1580,1609],256],64922:[[1606,1605,1610],256],64923:[[1606,1605,1609],256],64924:[[1610,1605,1605],256],64925:[[1610,1605,1605],256],64926:[[1576,1582,1610],256],64927:[[1578,1580,1610],256],64928:[[1578,1580,1609],256],64929:[[1578,1582,1610],256],64930:[[1578,1582,1609],256],64931:[[1578,1605,1610],256],64932:[[1578,1605,1609],256],64933:[[1580,1605,1610],256],64934:[[1580,1581,1609],256],64935:[[1580,1605,1609],256],64936:[[1587,1582,1609],256],64937:[[1589,1581,1610],256],64938:[[1588,1581,1610],256],64939:[[1590,1581,1610],256],64940:[[1604,1580,1610],256],64941:[[1604,1605,1610],256],64942:[[1610,1581,1610],256],64943:[[1610,1580,1610],256],64944:[[1610,1605,1610],256],64945:[[1605,1605,1610],256],64946:[[1602,1605,1610],256],64947:[[1606,1581,1610],256],64948:[[1602,1605,1581],256],64949:[[1604,1581,1605],256],64950:[[1593,1605,1610],256],64951:[[1603,1605,1610],256],64952:[[1606,1580,1581],256],64953:[[1605,1582,1610],256],64954:[[1604,1580,1605],256],64955:[[1603,1605,1605],256],64956:[[1604,1580,1605],256],64957:[[1606,1580,1581],256],64958:[[1580,1581,1610],256],64959:[[1581,1580,1610],256],64960:[[1605,1580,1610],256],64961:[[1601,1605,1610],256],64962:[[1576,1581,1610],256],64963:[[1603,1605,1605],256],64964:[[1593,1580,1605],256],64965:[[1589,1605,1605],256],64966:[[1587,1582,1610],256],64967:[[1606,1580,1610],256],65008:[[1589,1604,1746],256],65009:[[1602,1604,1746],256],65010:[[1575,1604,1604,1607],256],65011:[[1575,1603,1576,1585],256],65012:[[1605,1581,1605,1583],256],65013:[[1589,1604,1593,1605],256],65014:[[1585,1587,1608,1604],256],65015:[[1593,1604,1610,1607],256],65016:[[1608,1587,1604,1605],256],65017:[[1589,1604,1609],256],65018:[[1589,1604,1609,32,1575,1604,1604,1607,32,1593,1604,1610,1607,32,1608,1587,1604,1605],256],65019:[[1580,1604,32,1580,1604,1575,1604,1607],256],65020:[[1585,1740,1575,1604],256]},65024:{65040:[[44],256],65041:[[12289],256],65042:[[12290],256],65043:[[58],256],65044:[[59],256],65045:[[33],256],65046:[[63],256],65047:[[12310],256],65048:[[12311],256],65049:[[8230],256],65056:[null,230],65057:[null,230],65058:[null,230],65059:[null,230],65060:[null,230],65061:[null,230],65062:[null,230],65063:[null,220],65064:[null,220],65065:[null,220],65066:[null,220],65067:[null,220],65068:[null,220],65069:[null,220],65072:[[8229],256],65073:[[8212],256],65074:[[8211],256],65075:[[95],256],65076:[[95],256],65077:[[40],256],65078:[[41],256],65079:[[123],256],65080:[[125],256],65081:[[12308],256],65082:[[12309],256],65083:[[12304],256],65084:[[12305],256],65085:[[12298],256],65086:[[12299],256],65087:[[12296],256],65088:[[12297],256],65089:[[12300],256],65090:[[12301],256],65091:[[12302],256],65092:[[12303],256],65095:[[91],256],65096:[[93],256],65097:[[8254],256],65098:[[8254],256],65099:[[8254],256],65100:[[8254],256],65101:[[95],256],65102:[[95],256],65103:[[95],256],65104:[[44],256],65105:[[12289],256],65106:[[46],256],65108:[[59],256],65109:[[58],256],65110:[[63],256],65111:[[33],256],65112:[[8212],256],65113:[[40],256],65114:[[41],256],65115:[[123],256],65116:[[125],256],65117:[[12308],256],65118:[[12309],256],65119:[[35],256],65120:[[38],256],65121:[[42],256],65122:[[43],256],65123:[[45],256],65124:[[60],256],65125:[[62],256],65126:[[61],256],65128:[[92],256],65129:[[36],256],65130:[[37],256],65131:[[64],256],65136:[[32,1611],256],65137:[[1600,1611],256],65138:[[32,1612],256],65140:[[32,1613],256],65142:[[32,1614],256],65143:[[1600,1614],256],65144:[[32,1615],256],65145:[[1600,1615],256],65146:[[32,1616],256],65147:[[1600,1616],256],65148:[[32,1617],256],65149:[[1600,1617],256],65150:[[32,1618],256],65151:[[1600,1618],256],65152:[[1569],256],65153:[[1570],256],65154:[[1570],256],65155:[[1571],256],65156:[[1571],256],65157:[[1572],256],65158:[[1572],256],65159:[[1573],256],65160:[[1573],256],65161:[[1574],256],65162:[[1574],256],65163:[[1574],256],65164:[[1574],256],65165:[[1575],256],65166:[[1575],256],65167:[[1576],256],65168:[[1576],256],65169:[[1576],256],65170:[[1576],256],65171:[[1577],256],65172:[[1577],256],65173:[[1578],256],65174:[[1578],256],65175:[[1578],256],65176:[[1578],256],65177:[[1579],256],65178:[[1579],256],65179:[[1579],256],65180:[[1579],256],65181:[[1580],256],65182:[[1580],256],65183:[[1580],256],65184:[[1580],256],65185:[[1581],256],65186:[[1581],256],65187:[[1581],256],65188:[[1581],256],65189:[[1582],256],65190:[[1582],256],65191:[[1582],256],65192:[[1582],256],65193:[[1583],256],65194:[[1583],256],65195:[[1584],256],65196:[[1584],256],65197:[[1585],256],65198:[[1585],256],65199:[[1586],256],65200:[[1586],256],65201:[[1587],256],65202:[[1587],256],65203:[[1587],256],65204:[[1587],256],65205:[[1588],256],65206:[[1588],256],65207:[[1588],256],65208:[[1588],256],65209:[[1589],256],65210:[[1589],256],65211:[[1589],256],65212:[[1589],256],65213:[[1590],256],65214:[[1590],256],65215:[[1590],256],65216:[[1590],256],65217:[[1591],256],65218:[[1591],256],65219:[[1591],256],65220:[[1591],256],65221:[[1592],256],65222:[[1592],256],65223:[[1592],256],65224:[[1592],256],65225:[[1593],256],65226:[[1593],256],65227:[[1593],256],65228:[[1593],256],65229:[[1594],256],65230:[[1594],256],65231:[[1594],256],65232:[[1594],256],65233:[[1601],256],65234:[[1601],256],65235:[[1601],256],65236:[[1601],256],65237:[[1602],256],65238:[[1602],256],65239:[[1602],256],65240:[[1602],256],65241:[[1603],256],65242:[[1603],256],65243:[[1603],256],65244:[[1603],256],65245:[[1604],256],65246:[[1604],256],65247:[[1604],256],65248:[[1604],256],65249:[[1605],256],65250:[[1605],256],65251:[[1605],256],65252:[[1605],256],65253:[[1606],256],65254:[[1606],256],65255:[[1606],256],65256:[[1606],256],65257:[[1607],256],65258:[[1607],256],65259:[[1607],256],65260:[[1607],256],65261:[[1608],256],65262:[[1608],256],65263:[[1609],256],65264:[[1609],256],65265:[[1610],256],65266:[[1610],256],65267:[[1610],256],65268:[[1610],256],65269:[[1604,1570],256],65270:[[1604,1570],256],65271:[[1604,1571],256],65272:[[1604,1571],256],65273:[[1604,1573],256],65274:[[1604,1573],256],65275:[[1604,1575],256],65276:[[1604,1575],256]},65280:{65281:[[33],256],65282:[[34],256],65283:[[35],256],65284:[[36],256],65285:[[37],256],65286:[[38],256],65287:[[39],256],65288:[[40],256],65289:[[41],256],65290:[[42],256],65291:[[43],256],65292:[[44],256],65293:[[45],256],65294:[[46],256],65295:[[47],256],65296:[[48],256],65297:[[49],256],65298:[[50],256],65299:[[51],256],65300:[[52],256],65301:[[53],256],65302:[[54],256],65303:[[55],256],65304:[[56],256],65305:[[57],256],65306:[[58],256],65307:[[59],256],65308:[[60],256],65309:[[61],256],65310:[[62],256],65311:[[63],256],65312:[[64],256],65313:[[65],256],65314:[[66],256],65315:[[67],256],65316:[[68],256],65317:[[69],256],65318:[[70],256],65319:[[71],256],65320:[[72],256],65321:[[73],256],65322:[[74],256],65323:[[75],256],65324:[[76],256],65325:[[77],256],65326:[[78],256],65327:[[79],256],65328:[[80],256],65329:[[81],256],65330:[[82],256],65331:[[83],256],65332:[[84],256],65333:[[85],256],65334:[[86],256],65335:[[87],256],65336:[[88],256],65337:[[89],256],65338:[[90],256],65339:[[91],256],65340:[[92],256],65341:[[93],256],65342:[[94],256],65343:[[95],256],65344:[[96],256],65345:[[97],256],65346:[[98],256],65347:[[99],256],65348:[[100],256],65349:[[101],256],65350:[[102],256],65351:[[103],256],65352:[[104],256],65353:[[105],256],65354:[[106],256],65355:[[107],256],65356:[[108],256],65357:[[109],256],65358:[[110],256],65359:[[111],256],65360:[[112],256],65361:[[113],256],65362:[[114],256],65363:[[115],256],65364:[[116],256],65365:[[117],256],65366:[[118],256],65367:[[119],256],65368:[[120],256],65369:[[121],256],65370:[[122],256],65371:[[123],256],65372:[[124],256],65373:[[125],256],65374:[[126],256],65375:[[10629],256],65376:[[10630],256],65377:[[12290],256],65378:[[12300],256],65379:[[12301],256],65380:[[12289],256],65381:[[12539],256],65382:[[12530],256],65383:[[12449],256],65384:[[12451],256],65385:[[12453],256],65386:[[12455],256],65387:[[12457],256],65388:[[12515],256],65389:[[12517],256],65390:[[12519],256],65391:[[12483],256],65392:[[12540],256],65393:[[12450],256],65394:[[12452],256],65395:[[12454],256],65396:[[12456],256],65397:[[12458],256],65398:[[12459],256],65399:[[12461],256],65400:[[12463],256],65401:[[12465],256],65402:[[12467],256],65403:[[12469],256],65404:[[12471],256],65405:[[12473],256],65406:[[12475],256],65407:[[12477],256],65408:[[12479],256],65409:[[12481],256],65410:[[12484],256],65411:[[12486],256],65412:[[12488],256],65413:[[12490],256],65414:[[12491],256],65415:[[12492],256],65416:[[12493],256],65417:[[12494],256],65418:[[12495],256],65419:[[12498],256],65420:[[12501],256],65421:[[12504],256],65422:[[12507],256],65423:[[12510],256],65424:[[12511],256],65425:[[12512],256],65426:[[12513],256],65427:[[12514],256],65428:[[12516],256],65429:[[12518],256],65430:[[12520],256],65431:[[12521],256],65432:[[12522],256],65433:[[12523],256],65434:[[12524],256],65435:[[12525],256],65436:[[12527],256],65437:[[12531],256],65438:[[12441],256],65439:[[12442],256],65440:[[12644],256],65441:[[12593],256],65442:[[12594],256],65443:[[12595],256],65444:[[12596],256],65445:[[12597],256],65446:[[12598],256],65447:[[12599],256],65448:[[12600],256],65449:[[12601],256],65450:[[12602],256],65451:[[12603],256],65452:[[12604],256],65453:[[12605],256],65454:[[12606],256],65455:[[12607],256],65456:[[12608],256],65457:[[12609],256],65458:[[12610],256],65459:[[12611],256],65460:[[12612],256],65461:[[12613],256],65462:[[12614],256],65463:[[12615],256],65464:[[12616],256],65465:[[12617],256],65466:[[12618],256],65467:[[12619],256],65468:[[12620],256],65469:[[12621],256],65470:[[12622],256],65474:[[12623],256],65475:[[12624],256],65476:[[12625],256],65477:[[12626],256],65478:[[12627],256],65479:[[12628],256],65482:[[12629],256],65483:[[12630],256],65484:[[12631],256],65485:[[12632],256],65486:[[12633],256],65487:[[12634],256],65490:[[12635],256],65491:[[12636],256],65492:[[12637],256],65493:[[12638],256],65494:[[12639],256],65495:[[12640],256],65498:[[12641],256],65499:[[12642],256],65500:[[12643],256],65504:[[162],256],65505:[[163],256],65506:[[172],256],65507:[[175],256],65508:[[166],256],65509:[[165],256],65510:[[8361],256],65512:[[9474],256],65513:[[8592],256],65514:[[8593],256],65515:[[8594],256],65516:[[8595],256],65517:[[9632],256],65518:[[9675],256]}}},{}],25:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}for(var udata=require("./udata.json"),DEFAULT_FEATURE=[null,0,{}],CACHE_THRESHOLD=10,SBase=44032,LBase=4352,VBase=4449,TBase=4519,LCount=19,VCount=21,TCount=28,NCount=VCount*TCount,SCount=LCount*NCount,cache={},cacheCounter=[],i=0;i<=255;i++)cacheCounter[i]=0;var fromCharCode=null,UChar=function(){function UChar(cp,feature){_classCallCheck(this,UChar),this.codepoint=cp,this.feature=feature}return UChar.isHighSurrogate=function(cp){return cp>=55296&&cp<=56319},UChar.isLowSurrogate=function(cp){return cp>=56320&&cp<=57343},UChar.prototype.prepFeature=function(){this.feature||(this.feature=fromCharCode(this.codepoint,!0).feature)},UChar.prototype.toString=function(){if(this.codepoint<65536)return String.fromCharCode(this.codepoint);var x=this.codepoint-65536;return String.fromCharCode(Math.floor(x/1024)+55296,x%1024+56320)},UChar.prototype.getDecomp=function(){return this.prepFeature(),this.feature[0]||null},UChar.prototype.isCompatibility=function(){return this.prepFeature(),Boolean(this.feature[1])&&0!=(256&this.feature[1])},UChar.prototype.isExclude=function(){return this.prepFeature(),Boolean(this.feature[1])&&0!=(512&this.feature[1])},UChar.prototype.getCanonicalClass=function(){return this.prepFeature(),this.feature[1]?255&this.feature[1]:0},UChar.prototype.getComposite=function(following){if(this.prepFeature(),!this.feature[2])return null;var cp=this.feature[2][following.codepoint];return cp?fromCharCode(cp):null},UChar}();fromCharCode=[function(next,cp,needFeature){return cp<60||13311<cp&&cp<42607?new UChar(cp,DEFAULT_FEATURE):next(cp,needFeature)},function(next,cp,needFeature){var ret=cache[cp];return ret||(ret=next(cp,needFeature)).feature&&++cacheCounter[cp>>8&255]>CACHE_THRESHOLD&&(cache[cp]=ret),ret},function(next,cp,needFeature){return needFeature?next(cp,needFeature):new UChar(cp,null)},function(next,cp,needFeature){if(cp<LBase||LBase+LCount<=cp&&cp<SBase||SBase+SCount<cp)return next(cp,needFeature);if(LBase<=cp&&cp<LBase+LCount){for(var c={},base=(cp-LBase)*VCount,j=0;j<VCount;j++)c[VBase+j]=SBase+TCount*(j+base);return new UChar(cp,[null,null,c])}var SIndex=cp-SBase,TIndex=SIndex%TCount,feature=[];if(0!==TIndex)feature[0]=[SBase+SIndex-TIndex,TBase+TIndex];else{feature[0]=[LBase+Math.floor(SIndex/NCount),VBase+Math.floor(SIndex%NCount/TCount)],feature[2]={};for(var _j=1;_j<TCount;_j++)feature[2][TBase+_j]=cp+_j}return new UChar(cp,feature)},function(next,cp,needFeature){var f=(udata[65280&cp]||{})[cp];return new UChar(cp,f||DEFAULT_FEATURE)}].reduceRight(function(next,strategy){return function(cp,needFeature){return strategy(next,cp,needFeature)}},null);var UCharIterator=function(){function UCharIterator(str){_classCallCheck(this,UCharIterator),this.str=str,this.cursor=0}return UCharIterator.prototype.next=function(){if(this.str&&this.cursor<this.str.length){var cp=this.str.charCodeAt(this.cursor++);if(UChar.isHighSurrogate(cp)&&this.cursor<this.str.length){var d=this.str.charCodeAt(this.cursor);UChar.isLowSurrogate(d)&&(cp=1024*(cp-55296)+(d-56320)+65536,this.cursor+=1)}return fromCharCode(cp)}return this.str=null,null},UCharIterator}(),RecursDecompIterator=function(){function RecursDecompIterator(it,cano){_classCallCheck(this,RecursDecompIterator),this.it=it,this.canonical=cano,this.resBuf=[]}return RecursDecompIterator.prototype.recursiveDecomp=function(uchar){var cano=this.canonical,decomp=uchar.getDecomp();if(decomp&&(!cano||!uchar.isCompatibility())){for(var ret=[],_i=0;_i<decomp.length;_i++){var a=this.recursiveDecomp(fromCharCode(decomp[_i]));ret=ret.concat(a)}return ret}return[uchar]},RecursDecompIterator.prototype.next=function(){if(0===this.resBuf.length){var uchar=this.it.next();if(!uchar)return null;this.resBuf=this.recursiveDecomp(uchar)}return this.resBuf.shift()},RecursDecompIterator}(),DecompIterator=function(){function DecompIterator(it){_classCallCheck(this,DecompIterator),this.it=it,this.resBuf=[]}return DecompIterator.prototype.next=function(){if(0===this.resBuf.length)for(;;){var uchar=this.it.next();if(!uchar)break;var cc=uchar.getCanonicalClass(),inspt=this.resBuf.length;if(0!==cc)for(;inspt>0;){if(this.resBuf[inspt-1].getCanonicalClass()<=cc)break;inspt-=1}if(this.resBuf.splice(inspt,0,uchar),0===cc)break}return this.resBuf.shift()},DecompIterator}(),CompIterator=function(){function CompIterator(it){_classCallCheck(this,CompIterator),this.it=it,this.procBuf=[],this.resBuf=[],this.lastClass=null}return CompIterator.prototype.next=function(){for(;0===this.resBuf.length;){var uchar=this.it.next();if(!uchar){this.resBuf=this.procBuf,this.procBuf=[];break}if(0!==this.procBuf.length){var composite=this.procBuf[0].getComposite(uchar),cc=uchar.getCanonicalClass();composite&&(this.lastClass<cc||0===this.lastClass)?this.procBuf[0]=composite:(0===cc&&(this.resBuf=this.procBuf,this.procBuf=[]),this.lastClass=cc,this.procBuf.push(uchar))}else this.lastClass=uchar.getCanonicalClass(),this.procBuf.push(uchar)}return this.resBuf.shift()},CompIterator}();function normalize(mode,str){for(var it=function(mode,str){switch(mode){case"NFD":var it1=new UCharIterator(str),it2=new RecursDecompIterator(it1,!0);return new DecompIterator(it2);case"NFKD":var _it=new UCharIterator(str),_it2=new RecursDecompIterator(_it,!1);return new DecompIterator(_it2);case"NFC":var _it3=new UCharIterator(str),_it4=new RecursDecompIterator(_it3,!0),it3=new DecompIterator(_it4);return new CompIterator(it3);case"NFKC":var _it5=new UCharIterator(str),_it6=new RecursDecompIterator(_it5,!1),_it7=new DecompIterator(_it6);return new CompIterator(_it7)}throw new Error(mode+" is invalid.")}(mode,str),ret="",uchar=void 0;uchar=it.next();)ret+=uchar.toString();return ret}exports.nfc=function(str){return normalize("NFC",str)},exports.nfd=function(str){return normalize("NFD",str)},exports.nfkc=function(str){return normalize("NFKC",str)},exports.nfkd=function(str){return normalize("NFKD",str)}},{"./udata.json":24}],26:[function(require,module,exports){"use strict";var words=require("./words");exports.get=function(name){switch(name){case"simplified chinese":return words.chinese.simplified;case"traditional chinese":return words.chinese.traditional;case"english":return words.english;case"french":return words.french;case"italian":return words.italian;case"japanese":return words.japanese;case"spanish":return words.spanish;default:throw new Error("Unknown language: "+name+".")}}},{"./words":31}],27:[function(require,module,exports){"use strict";module.exports=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},{}],28:[function(require,module,exports){"use strict";module.exports=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},{}],29:[function(require,module,exports){"use strict";module.exports=["abandon","ability","able","about","above","absent","absorb","abstract","absurd","abuse","access","accident","account","accuse","achieve","acid","acoustic","acquire","across","act","action","actor","actress","actual","adapt","add","addict","address","adjust","admit","adult","advance","advice","aerobic","affair","afford","afraid","again","age","agent","agree","ahead","aim","air","airport","aisle","alarm","album","alcohol","alert","alien","all","alley","allow","almost","alone","alpha","already","also","alter","always","amateur","amazing","among","amount","amused","analyst","anchor","ancient","anger","angle","angry","animal","ankle","announce","annual","another","answer","antenna","antique","anxiety","any","apart","apology","appear","apple","approve","april","arch","arctic","area","arena","argue","arm","armed","armor","army","around","arrange","arrest","arrive","arrow","art","artefact","artist","artwork","ask","aspect","assault","asset","assist","assume","asthma","athlete","atom","attack","attend","attitude","attract","auction","audit","august","aunt","author","auto","autumn","average","avocado","avoid","awake","aware","away","awesome","awful","awkward","axis","baby","bachelor","bacon","badge","bag","balance","balcony","ball","bamboo","banana","banner","bar","barely","bargain","barrel","base","basic","basket","battle","beach","bean","beauty","because","become","beef","before","begin","behave","behind","believe","below","belt","bench","benefit","best","betray","better","between","beyond","bicycle","bid","bike","bind","biology","bird","birth","bitter","black","blade","blame","blanket","blast","bleak","bless","blind","blood","blossom","blouse","blue","blur","blush","board","boat","body","boil","bomb","bone","bonus","book","boost","border","boring","borrow","boss","bottom","bounce","box","boy","bracket","brain","brand","brass","brave","bread","breeze","brick","bridge","brief","bright","bring","brisk","broccoli","broken","bronze","broom","brother","brown","brush","bubble","buddy","budget","buffalo","build","bulb","bulk","bullet","bundle","bunker","burden","burger","burst","bus","business","busy","butter","buyer","buzz","cabbage","cabin","cable","cactus","cage","cake","call","calm","camera","camp","can","canal","cancel","candy","cannon","canoe","canvas","canyon","capable","capital","captain","car","carbon","card","cargo","carpet","carry","cart","case","cash","casino","castle","casual","cat","catalog","catch","category","cattle","caught","cause","caution","cave","ceiling","celery","cement","census","century","cereal","certain","chair","chalk","champion","change","chaos","chapter","charge","chase","chat","cheap","check","cheese","chef","cherry","chest","chicken","chief","child","chimney","choice","choose","chronic","chuckle","chunk","churn","cigar","cinnamon","circle","citizen","city","civil","claim","clap","clarify","claw","clay","clean","clerk","clever","click","client","cliff","climb","clinic","clip","clock","clog","close","cloth","cloud","clown","club","clump","cluster","clutch","coach","coast","coconut","code","coffee","coil","coin","collect","color","column","combine","come","comfort","comic","common","company","concert","conduct","confirm","congress","connect","consider","control","convince","cook","cool","copper","copy","coral","core","corn","correct","cost","cotton","couch","country","couple","course","cousin","cover","coyote","crack","cradle","craft","cram","crane","crash","crater","crawl","crazy","cream","credit","creek","crew","cricket","crime","crisp","critic","crop","cross","crouch","crowd","crucial","cruel","cruise","crumble","crunch","crush","cry","crystal","cube","culture","cup","cupboard","curious","current","curtain","curve","cushion","custom","cute","cycle","dad","damage","damp","dance","danger","daring","dash","daughter","dawn","day","deal","debate","debris","decade","december","decide","decline","decorate","decrease","deer","defense","define","defy","degree","delay","deliver","demand","demise","denial","dentist","deny","depart","depend","deposit","depth","deputy","derive","describe","desert","design","desk","despair","destroy","detail","detect","develop","device","devote","diagram","dial","diamond","diary","dice","diesel","diet","differ","digital","dignity","dilemma","dinner","dinosaur","direct","dirt","disagree","discover","disease","dish","dismiss","disorder","display","distance","divert","divide","divorce","dizzy","doctor","document","dog","doll","dolphin","domain","donate","donkey","donor","door","dose","double","dove","draft","dragon","drama","drastic","draw","dream","dress","drift","drill","drink","drip","drive","drop","drum","dry","duck","dumb","dune","during","dust","dutch","duty","dwarf","dynamic","eager","eagle","early","earn","earth","easily","east","easy","echo","ecology","economy","edge","edit","educate","effort","egg","eight","either","elbow","elder","electric","elegant","element","elephant","elevator","elite","else","embark","embody","embrace","emerge","emotion","employ","empower","empty","enable","enact","end","endless","endorse","enemy","energy","enforce","engage","engine","enhance","enjoy","enlist","enough","enrich","enroll","ensure","enter","entire","entry","envelope","episode","equal","equip","era","erase","erode","erosion","error","erupt","escape","essay","essence","estate","eternal","ethics","evidence","evil","evoke","evolve","exact","example","excess","exchange","excite","exclude","excuse","execute","exercise","exhaust","exhibit","exile","exist","exit","exotic","expand","expect","expire","explain","expose","express","extend","extra","eye","eyebrow","fabric","face","faculty","fade","faint","faith","fall","false","fame","family","famous","fan","fancy","fantasy","farm","fashion","fat","fatal","father","fatigue","fault","favorite","feature","february","federal","fee","feed","feel","female","fence","festival","fetch","fever","few","fiber","fiction","field","figure","file","film","filter","final","find","fine","finger","finish","fire","firm","first","fiscal","fish","fit","fitness","fix","flag","flame","flash","flat","flavor","flee","flight","flip","float","flock","floor","flower","fluid","flush","fly","foam","focus","fog","foil","fold","follow","food","foot","force","forest","forget","fork","fortune","forum","forward","fossil","foster","found","fox","fragile","frame","frequent","fresh","friend","fringe","frog","front","frost","frown","frozen","fruit","fuel","fun","funny","furnace","fury","future","gadget","gain","galaxy","gallery","game","gap","garage","garbage","garden","garlic","garment","gas","gasp","gate","gather","gauge","gaze","general","genius","genre","gentle","genuine","gesture","ghost","giant","gift","giggle","ginger","giraffe","girl","give","glad","glance","glare","glass","glide","glimpse","globe","gloom","glory","glove","glow","glue","goat","goddess","gold","good","goose","gorilla","gospel","gossip","govern","gown","grab","grace","grain","grant","grape","grass","gravity","great","green","grid","grief","grit","grocery","group","grow","grunt","guard","guess","guide","guilt","guitar","gun","gym","habit","hair","half","hammer","hamster","hand","happy","harbor","hard","harsh","harvest","hat","have","hawk","hazard","head","health","heart","heavy","hedgehog","height","hello","helmet","help","hen","hero","hidden","high","hill","hint","hip","hire","history","hobby","hockey","hold","hole","holiday","hollow","home","honey","hood","hope","horn","horror","horse","hospital","host","hotel","hour","hover","hub","huge","human","humble","humor","hundred","hungry","hunt","hurdle","hurry","hurt","husband","hybrid","ice","icon","idea","identify","idle","ignore","ill","illegal","illness","image","imitate","immense","immune","impact","impose","improve","impulse","inch","include","income","increase","index","indicate","indoor","industry","infant","inflict","inform","inhale","inherit","initial","inject","injury","inmate","inner","innocent","input","inquiry","insane","insect","inside","inspire","install","intact","interest","into","invest","invite","involve","iron","island","isolate","issue","item","ivory","jacket","jaguar","jar","jazz","jealous","jeans","jelly","jewel","job","join","joke","journey","joy","judge","juice","jump","jungle","junior","junk","just","kangaroo","keen","keep","ketchup","key","kick","kid","kidney","kind","kingdom","kiss","kit","kitchen","kite","kitten","kiwi","knee","knife","knock","know","lab","label","labor","ladder","lady","lake","lamp","language","laptop","large","later","latin","laugh","laundry","lava","law","lawn","lawsuit","layer","lazy","leader","leaf","learn","leave","lecture","left","leg","legal","legend","leisure","lemon","lend","length","lens","leopard","lesson","letter","level","liar","liberty","library","license","life","lift","light","like","limb","limit","link","lion","liquid","list","little","live","lizard","load","loan","lobster","local","lock","logic","lonely","long","loop","lottery","loud","lounge","love","loyal","lucky","luggage","lumber","lunar","lunch","luxury","lyrics","machine","mad","magic","magnet","maid","mail","main","major","make","mammal","man","manage","mandate","mango","mansion","manual","maple","marble","march","margin","marine","market","marriage","mask","mass","master","match","material","math","matrix","matter","maximum","maze","meadow","mean","measure","meat","mechanic","medal","media","melody","melt","member","memory","mention","menu","mercy","merge","merit","merry","mesh","message","metal","method","middle","midnight","milk","million","mimic","mind","minimum","minor","minute","miracle","mirror","misery","miss","mistake","mix","mixed","mixture","mobile","model","modify","mom","moment","monitor","monkey","monster","month","moon","moral","more","morning","mosquito","mother","motion","motor","mountain","mouse","move","movie","much","muffin","mule","multiply","muscle","museum","mushroom","music","must","mutual","myself","mystery","myth","naive","name","napkin","narrow","nasty","nation","nature","near","neck","need","negative","neglect","neither","nephew","nerve","nest","net","network","neutral","never","news","next","nice","night","noble","noise","nominee","noodle","normal","north","nose","notable","note","nothing","notice","novel","now","nuclear","number","nurse","nut","oak","obey","object","oblige","obscure","observe","obtain","obvious","occur","ocean","october","odor","off","offer","office","often","oil","okay","old","olive","olympic","omit","once","one","onion","online","only","open","opera","opinion","oppose","option","orange","orbit","orchard","order","ordinary","organ","orient","original","orphan","ostrich","other","outdoor","outer","output","outside","oval","oven","over","own","owner","oxygen","oyster","ozone","pact","paddle","page","pair","palace","palm","panda","panel","panic","panther","paper","parade","parent","park","parrot","party","pass","patch","path","patient","patrol","pattern","pause","pave","payment","peace","peanut","pear","peasant","pelican","pen","penalty","pencil","people","pepper","perfect","permit","person","pet","phone","photo","phrase","physical","piano","picnic","picture","piece","pig","pigeon","pill","pilot","pink","pioneer","pipe","pistol","pitch","pizza","place","planet","plastic","plate","play","please","pledge","pluck","plug","plunge","poem","poet","point","polar","pole","police","pond","pony","pool","popular","portion","position","possible","post","potato","pottery","poverty","powder","power","practice","praise","predict","prefer","prepare","present","pretty","prevent","price","pride","primary","print","priority","prison","private","prize","problem","process","produce","profit","program","project","promote","proof","property","prosper","protect","proud","provide","public","pudding","pull","pulp","pulse","pumpkin","punch","pupil","puppy","purchase","purity","purpose","purse","push","put","puzzle","pyramid","quality","quantum","quarter","question","quick","quit","quiz","quote","rabbit","raccoon","race","rack","radar","radio","rail","rain","raise","rally","ramp","ranch","random","range","rapid","rare","rate","rather","raven","raw","razor","ready","real","reason","rebel","rebuild","recall","receive","recipe","record","recycle","reduce","reflect","reform","refuse","region","regret","regular","reject","relax","release","relief","rely","remain","remember","remind","remove","render","renew","rent","reopen","repair","repeat","replace","report","require","rescue","resemble","resist","resource","response","result","retire","retreat","return","reunion","reveal","review","reward","rhythm","rib","ribbon","rice","rich","ride","ridge","rifle","right","rigid","ring","riot","ripple","risk","ritual","rival","river","road","roast","robot","robust","rocket","romance","roof","rookie","room","rose","rotate","rough","round","route","royal","rubber","rude","rug","rule","run","runway","rural","sad","saddle","sadness","safe","sail","salad","salmon","salon","salt","salute","same","sample","sand","satisfy","satoshi","sauce","sausage","save","say","scale","scan","scare","scatter","scene","scheme","school","science","scissors","scorpion","scout","scrap","screen","script","scrub","sea","search","season","seat","second","secret","section","security","seed","seek","segment","select","sell","seminar","senior","sense","sentence","series","service","session","settle","setup","seven","shadow","shaft","shallow","share","shed","shell","sheriff","shield","shift","shine","ship","shiver","shock","shoe","shoot","shop","short","shoulder","shove","shrimp","shrug","shuffle","shy","sibling","sick","side","siege","sight","sign","silent","silk","silly","silver","similar","simple","since","sing","siren","sister","situate","six","size","skate","sketch","ski","skill","skin","skirt","skull","slab","slam","sleep","slender","slice","slide","slight","slim","slogan","slot","slow","slush","small","smart","smile","smoke","smooth","snack","snake","snap","sniff","snow","soap","soccer","social","sock","soda","soft","solar","soldier","solid","solution","solve","someone","song","soon","sorry","sort","soul","sound","soup","source","south","space","spare","spatial","spawn","speak","special","speed","spell","spend","sphere","spice","spider","spike","spin","spirit","split","spoil","sponsor","spoon","sport","spot","spray","spread","spring","spy","square","squeeze","squirrel","stable","stadium","staff","stage","stairs","stamp","stand","start","state","stay","steak","steel","stem","step","stereo","stick","still","sting","stock","stomach","stone","stool","story","stove","strategy","street","strike","strong","struggle","student","stuff","stumble","style","subject","submit","subway","success","such","sudden","suffer","sugar","suggest","suit","summer","sun","sunny","sunset","super","supply","supreme","sure","surface","surge","surprise","surround","survey","suspect","sustain","swallow","swamp","swap","swarm","swear","sweet","swift","swim","swing","switch","sword","symbol","symptom","syrup","system","table","tackle","tag","tail","talent","talk","tank","tape","target","task","taste","tattoo","taxi","teach","team","tell","ten","tenant","tennis","tent","term","test","text","thank","that","theme","then","theory","there","they","thing","this","thought","three","thrive","throw","thumb","thunder","ticket","tide","tiger","tilt","timber","time","tiny","tip","tired","tissue","title","toast","tobacco","today","toddler","toe","together","toilet","token","tomato","tomorrow","tone","tongue","tonight","tool","tooth","top","topic","topple","torch","tornado","tortoise","toss","total","tourist","toward","tower","town","toy","track","trade","traffic","tragic","train","transfer","trap","trash","travel","tray","treat","tree","trend","trial","tribe","trick","trigger","trim","trip","trophy","trouble","truck","true","truly","trumpet","trust","truth","try","tube","tuition","tumble","tuna","tunnel","turkey","turn","turtle","twelve","twenty","twice","twin","twist","two","type","typical","ugly","umbrella","unable","unaware","uncle","uncover","under","undo","unfair","unfold","unhappy","uniform","unique","unit","universe","unknown","unlock","until","unusual","unveil","update","upgrade","uphold","upon","upper","upset","urban","urge","usage","use","used","useful","useless","usual","utility","vacant","vacuum","vague","valid","valley","valve","van","vanish","vapor","various","vast","vault","vehicle","velvet","vendor","venture","venue","verb","verify","version","very","vessel","veteran","viable","vibrant","vicious","victory","video","view","village","vintage","violin","virtual","virus","visa","visit","visual","vital","vivid","vocal","voice","void","volcano","volume","vote","voyage","wage","wagon","wait","walk","wall","walnut","want","warfare","warm","warrior","wash","wasp","waste","water","wave","way","wealth","weapon","wear","weasel","weather","web","wedding","weekend","weird","welcome","west","wet","whale","what","wheat","wheel","when","where","whip","whisper","wide","width","wife","wild","will","win","window","wine","wing","wink","winner","winter","wire","wisdom","wise","wish","witness","wolf","woman","wonder","wood","wool","word","work","world","worry","worth","wrap","wreck","wrestle","wrist","write","wrong","yard","year","yellow","you","young","youth","zebra","zero","zone","zoo"]},{}],30:[function(require,module,exports){"use strict";module.exports=["abaisser","abandon","abdiquer","abeille","abolir","aborder","aboutir","aboyer","abrasif","abreuver","abriter","abroger","abrupt","absence","absolu","absurde","abusif","abyssal","academie","acajou","acarien","accabler","accepter","acclamer","accolade","accroche","accuser","acerbe","achat","acheter","aciduler","acier","acompte","acquerir","acronyme","acteur","actif","actuel","adepte","adequat","adhesif","adjectif","adjuger","admettre","admirer","adopter","adorer","adoucir","adresse","adroit","adulte","adverbe","aerer","aeronef","affaire","affecter","affiche","affreux","affubler","agacer","agencer","agile","agiter","agrafer","agreable","agrume","aider","aiguille","ailier","aimable","aisance","ajouter","ajuster","alarmer","alchimie","alerte","algebre","algue","aliener","aliment","alleger","alliage","allouer","allumer","alourdir","alpaga","altesse","alveole","amateur","ambigu","ambre","amenager","amertume","amidon","amiral","amorcer","amour","amovible","amphibie","ampleur","amusant","analyse","anaphore","anarchie","anatomie","ancien","aneantir","angle","angoisse","anguleux","animal","annexer","annonce","annuel","anodin","anomalie","anonyme","anormal","antenne","antidote","anxieux","apaiser","aperitif","aplanir","apologie","appareil","appeler","apporter","appuyer","aquarium","aqueduc","arbitre","arbuste","ardeur","ardoise","argent","arlequin","armature","armement","armoire","armure","arpenter","arracher","arriver","arroser","arsenic","arteriel","article","aspect","asphalte","aspirer","assaut","asservir","assiette","associer","assurer","asticot","astre","astuce","atelier","atome","atrium","atroce","attaque","attentif","attirer","attraper","aubaine","auberge","audace","audible","augurer","aurore","automne","autruche","avaler","avancer","avarice","avenir","averse","aveugle","aviateur","avide","avion","aviser","avoine","avouer","avril","axial","axiome","badge","bafouer","bagage","baguette","baignade","balancer","balcon","baleine","balisage","bambin","bancaire","bandage","banlieue","banniere","banquier","barbier","baril","baron","barque","barrage","bassin","bastion","bataille","bateau","batterie","baudrier","bavarder","belette","belier","belote","benefice","berceau","berger","berline","bermuda","besace","besogne","betail","beurre","biberon","bicycle","bidule","bijou","bilan","bilingue","billard","binaire","biologie","biopsie","biotype","biscuit","bison","bistouri","bitume","bizarre","blafard","blague","blanchir","blessant","blinder","blond","bloquer","blouson","bobard","bobine","boire","boiser","bolide","bonbon","bondir","bonheur","bonifier","bonus","bordure","borne","botte","boucle","boueux","bougie","boulon","bouquin","bourse","boussole","boutique","boxeur","branche","brasier","brave","brebis","breche","breuvage","bricoler","brigade","brillant","brioche","brique","brochure","broder","bronzer","brousse","broyeur","brume","brusque","brutal","bruyant","buffle","buisson","bulletin","bureau","burin","bustier","butiner","butoir","buvable","buvette","cabanon","cabine","cachette","cadeau","cadre","cafeine","caillou","caisson","calculer","calepin","calibre","calmer","calomnie","calvaire","camarade","camera","camion","campagne","canal","caneton","canon","cantine","canular","capable","caporal","caprice","capsule","capter","capuche","carabine","carbone","caresser","caribou","carnage","carotte","carreau","carton","cascade","casier","casque","cassure","causer","caution","cavalier","caverne","caviar","cedille","ceinture","celeste","cellule","cendrier","censurer","central","cercle","cerebral","cerise","cerner","cerveau","cesser","chagrin","chaise","chaleur","chambre","chance","chapitre","charbon","chasseur","chaton","chausson","chavirer","chemise","chenille","chequier","chercher","cheval","chien","chiffre","chignon","chimere","chiot","chlorure","chocolat","choisir","chose","chouette","chrome","chute","cigare","cigogne","cimenter","cinema","cintrer","circuler","cirer","cirque","citerne","citoyen","citron","civil","clairon","clameur","claquer","classe","clavier","client","cligner","climat","clivage","cloche","clonage","cloporte","cobalt","cobra","cocasse","cocotier","coder","codifier","coffre","cogner","cohesion","coiffer","coincer","colere","colibri","colline","colmater","colonel","combat","comedie","commande","compact","concert","conduire","confier","congeler","connoter","consonne","contact","convexe","copain","copie","corail","corbeau","cordage","corniche","corpus","correct","cortege","cosmique","costume","coton","coude","coupure","courage","couteau","couvrir","coyote","crabe","crainte","cravate","crayon","creature","crediter","cremeux","creuser","crevette","cribler","crier","cristal","critere","croire","croquer","crotale","crucial","cruel","crypter","cubique","cueillir","cuillere","cuisine","cuivre","culminer","cultiver","cumuler","cupide","curatif","curseur","cyanure","cycle","cylindre","cynique","daigner","damier","danger","danseur","dauphin","debattre","debiter","deborder","debrider","debutant","decaler","decembre","dechirer","decider","declarer","decorer","decrire","decupler","dedale","deductif","deesse","defensif","defiler","defrayer","degager","degivrer","deglutir","degrafer","dejeuner","delice","deloger","demander","demeurer","demolir","denicher","denouer","dentelle","denuder","depart","depenser","dephaser","deplacer","deposer","deranger","derober","desastre","descente","desert","designer","desobeir","dessiner","destrier","detacher","detester","detourer","detresse","devancer","devenir","deviner","devoir","diable","dialogue","diamant","dicter","differer","digerer","digital","digne","diluer","dimanche","diminuer","dioxyde","directif","diriger","discuter","disposer","dissiper","distance","divertir","diviser","docile","docteur","dogme","doigt","domaine","domicile","dompter","donateur","donjon","donner","dopamine","dortoir","dorure","dosage","doseur","dossier","dotation","douanier","double","douceur","douter","doyen","dragon","draper","dresser","dribbler","droiture","duperie","duplexe","durable","durcir","dynastie","eblouir","ecarter","echarpe","echelle","eclairer","eclipse","eclore","ecluse","ecole","economie","ecorce","ecouter","ecraser","ecremer","ecrivain","ecrou","ecume","ecureuil","edifier","eduquer","effacer","effectif","effigie","effort","effrayer","effusion","egaliser","egarer","ejecter","elaborer","elargir","electron","elegant","elephant","eleve","eligible","elitisme","eloge","elucider","eluder","emballer","embellir","embryon","emeraude","emission","emmener","emotion","emouvoir","empereur","employer","emporter","emprise","emulsion","encadrer","enchere","enclave","encoche","endiguer","endosser","endroit","enduire","energie","enfance","enfermer","enfouir","engager","engin","englober","enigme","enjamber","enjeu","enlever","ennemi","ennuyeux","enrichir","enrobage","enseigne","entasser","entendre","entier","entourer","entraver","enumerer","envahir","enviable","envoyer","enzyme","eolien","epaissir","epargne","epatant","epaule","epicerie","epidemie","epier","epilogue","epine","episode","epitaphe","epoque","epreuve","eprouver","epuisant","equerre","equipe","eriger","erosion","erreur","eruption","escalier","espadon","espece","espiegle","espoir","esprit","esquiver","essayer","essence","essieu","essorer","estime","estomac","estrade","etagere","etaler","etanche","etatique","eteindre","etendoir","eternel","ethanol","ethique","ethnie","etirer","etoffer","etoile","etonnant","etourdir","etrange","etroit","etude","euphorie","evaluer","evasion","eventail","evidence","eviter","evolutif","evoquer","exact","exagerer","exaucer","exceller","excitant","exclusif","excuse","executer","exemple","exercer","exhaler","exhorter","exigence","exiler","exister","exotique","expedier","explorer","exposer","exprimer","exquis","extensif","extraire","exulter","fable","fabuleux","facette","facile","facture","faiblir","falaise","fameux","famille","farceur","farfelu","farine","farouche","fasciner","fatal","fatigue","faucon","fautif","faveur","favori","febrile","feconder","federer","felin","femme","femur","fendoir","feodal","fermer","feroce","ferveur","festival","feuille","feutre","fevrier","fiasco","ficeler","fictif","fidele","figure","filature","filetage","filiere","filleul","filmer","filou","filtrer","financer","finir","fiole","firme","fissure","fixer","flairer","flamme","flasque","flatteur","fleau","fleche","fleur","flexion","flocon","flore","fluctuer","fluide","fluvial","folie","fonderie","fongible","fontaine","forcer","forgeron","formuler","fortune","fossile","foudre","fougere","fouiller","foulure","fourmi","fragile","fraise","franchir","frapper","frayeur","fregate","freiner","frelon","fremir","frenesie","frere","friable","friction","frisson","frivole","froid","fromage","frontal","frotter","fruit","fugitif","fuite","fureur","furieux","furtif","fusion","futur","gagner","galaxie","galerie","gambader","garantir","gardien","garnir","garrigue","gazelle","gazon","geant","gelatine","gelule","gendarme","general","genie","genou","gentil","geologie","geometre","geranium","germe","gestuel","geyser","gibier","gicler","girafe","givre","glace","glaive","glisser","globe","gloire","glorieux","golfeur","gomme","gonfler","gorge","gorille","goudron","gouffre","goulot","goupille","gourmand","goutte","graduel","graffiti","graine","grand","grappin","gratuit","gravir","grenat","griffure","griller","grimper","grogner","gronder","grotte","groupe","gruger","grutier","gruyere","guepard","guerrier","guide","guimauve","guitare","gustatif","gymnaste","gyrostat","habitude","hachoir","halte","hameau","hangar","hanneton","haricot","harmonie","harpon","hasard","helium","hematome","herbe","herisson","hermine","heron","hesiter","heureux","hiberner","hibou","hilarant","histoire","hiver","homard","hommage","homogene","honneur","honorer","honteux","horde","horizon","horloge","hormone","horrible","houleux","housse","hublot","huileux","humain","humble","humide","humour","hurler","hydromel","hygiene","hymne","hypnose","idylle","ignorer","iguane","illicite","illusion","image","imbiber","imiter","immense","immobile","immuable","impact","imperial","implorer","imposer","imprimer","imputer","incarner","incendie","incident","incliner","incolore","indexer","indice","inductif","inedit","ineptie","inexact","infini","infliger","informer","infusion","ingerer","inhaler","inhiber","injecter","injure","innocent","inoculer","inonder","inscrire","insecte","insigne","insolite","inspirer","instinct","insulter","intact","intense","intime","intrigue","intuitif","inutile","invasion","inventer","inviter","invoquer","ironique","irradier","irreel","irriter","isoler","ivoire","ivresse","jaguar","jaillir","jambe","janvier","jardin","jauger","jaune","javelot","jetable","jeton","jeudi","jeunesse","joindre","joncher","jongler","joueur","jouissif","journal","jovial","joyau","joyeux","jubiler","jugement","junior","jupon","juriste","justice","juteux","juvenile","kayak","kimono","kiosque","label","labial","labourer","lacerer","lactose","lagune","laine","laisser","laitier","lambeau","lamelle","lampe","lanceur","langage","lanterne","lapin","largeur","larme","laurier","lavabo","lavoir","lecture","legal","leger","legume","lessive","lettre","levier","lexique","lezard","liasse","liberer","libre","licence","licorne","liege","lievre","ligature","ligoter","ligue","limer","limite","limonade","limpide","lineaire","lingot","lionceau","liquide","lisiere","lister","lithium","litige","littoral","livreur","logique","lointain","loisir","lombric","loterie","louer","lourd","loutre","louve","loyal","lubie","lucide","lucratif","lueur","lugubre","luisant","lumiere","lunaire","lundi","luron","lutter","luxueux","machine","magasin","magenta","magique","maigre","maillon","maintien","mairie","maison","majorer","malaxer","malefice","malheur","malice","mallette","mammouth","mandater","maniable","manquant","manteau","manuel","marathon","marbre","marchand","mardi","maritime","marqueur","marron","marteler","mascotte","massif","materiel","matiere","matraque","maudire","maussade","mauve","maximal","mechant","meconnu","medaille","medecin","mediter","meduse","meilleur","melange","melodie","membre","memoire","menacer","mener","menhir","mensonge","mentor","mercredi","merite","merle","messager","mesure","metal","meteore","methode","metier","meuble","miauler","microbe","miette","mignon","migrer","milieu","million","mimique","mince","mineral","minimal","minorer","minute","miracle","miroiter","missile","mixte","mobile","moderne","moelleux","mondial","moniteur","monnaie","monotone","monstre","montagne","monument","moqueur","morceau","morsure","mortier","moteur","motif","mouche","moufle","moulin","mousson","mouton","mouvant","multiple","munition","muraille","murene","murmure","muscle","museum","musicien","mutation","muter","mutuel","myriade","myrtille","mystere","mythique","nageur","nappe","narquois","narrer","natation","nation","nature","naufrage","nautique","navire","nebuleux","nectar","nefaste","negation","negliger","negocier","neige","nerveux","nettoyer","neurone","neutron","neveu","niche","nickel","nitrate","niveau","noble","nocif","nocturne","noirceur","noisette","nomade","nombreux","nommer","normatif","notable","notifier","notoire","nourrir","nouveau","novateur","novembre","novice","nuage","nuancer","nuire","nuisible","numero","nuptial","nuque","nutritif","obeir","objectif","obliger","obscur","observer","obstacle","obtenir","obturer","occasion","occuper","ocean","octobre","octroyer","octupler","oculaire","odeur","odorant","offenser","officier","offrir","ogive","oiseau","oisillon","olfactif","olivier","ombrage","omettre","onctueux","onduler","onereux","onirique","opale","opaque","operer","opinion","opportun","opprimer","opter","optique","orageux","orange","orbite","ordonner","oreille","organe","orgueil","orifice","ornement","orque","ortie","osciller","osmose","ossature","otarie","ouragan","ourson","outil","outrager","ouvrage","ovation","oxyde","oxygene","ozone","paisible","palace","palmares","palourde","palper","panache","panda","pangolin","paniquer","panneau","panorama","pantalon","papaye","papier","papoter","papyrus","paradoxe","parcelle","paresse","parfumer","parler","parole","parrain","parsemer","partager","parure","parvenir","passion","pasteque","paternel","patience","patron","pavillon","pavoiser","payer","paysage","peigne","peintre","pelage","pelican","pelle","pelouse","peluche","pendule","penetrer","penible","pensif","penurie","pepite","peplum","perdrix","perforer","periode","permuter","perplexe","persil","perte","peser","petale","petit","petrir","peuple","pharaon","phobie","phoque","photon","phrase","physique","piano","pictural","piece","pierre","pieuvre","pilote","pinceau","pipette","piquer","pirogue","piscine","piston","pivoter","pixel","pizza","placard","plafond","plaisir","planer","plaque","plastron","plateau","pleurer","plexus","pliage","plomb","plonger","pluie","plumage","pochette","poesie","poete","pointe","poirier","poisson","poivre","polaire","policier","pollen","polygone","pommade","pompier","ponctuel","ponderer","poney","portique","position","posseder","posture","potager","poteau","potion","pouce","poulain","poumon","pourpre","poussin","pouvoir","prairie","pratique","precieux","predire","prefixe","prelude","prenom","presence","pretexte","prevoir","primitif","prince","prison","priver","probleme","proceder","prodige","profond","progres","proie","projeter","prologue","promener","propre","prospere","proteger","prouesse","proverbe","prudence","pruneau","psychose","public","puceron","puiser","pulpe","pulsar","punaise","punitif","pupitre","purifier","puzzle","pyramide","quasar","querelle","question","quietude","quitter","quotient","racine","raconter","radieux","ragondin","raideur","raisin","ralentir","rallonge","ramasser","rapide","rasage","ratisser","ravager","ravin","rayonner","reactif","reagir","realiser","reanimer","recevoir","reciter","reclamer","recolter","recruter","reculer","recycler","rediger","redouter","refaire","reflexe","reformer","refrain","refuge","regalien","region","reglage","regulier","reiterer","rejeter","rejouer","relatif","relever","relief","remarque","remede","remise","remonter","remplir","remuer","renard","renfort","renifler","renoncer","rentrer","renvoi","replier","reporter","reprise","reptile","requin","reserve","resineux","resoudre","respect","rester","resultat","retablir","retenir","reticule","retomber","retracer","reunion","reussir","revanche","revivre","revolte","revulsif","richesse","rideau","rieur","rigide","rigoler","rincer","riposter","risible","risque","rituel","rival","riviere","rocheux","romance","rompre","ronce","rondin","roseau","rosier","rotatif","rotor","rotule","rouge","rouille","rouleau","routine","royaume","ruban","rubis","ruche","ruelle","rugueux","ruiner","ruisseau","ruser","rustique","rythme","sabler","saboter","sabre","sacoche","safari","sagesse","saisir","salade","salive","salon","saluer","samedi","sanction","sanglier","sarcasme","sardine","saturer","saugrenu","saumon","sauter","sauvage","savant","savonner","scalpel","scandale","scelerat","scenario","sceptre","schema","science","scinder","score","scrutin","sculpter","seance","secable","secher","secouer","secreter","sedatif","seduire","seigneur","sejour","selectif","semaine","sembler","semence","seminal","senateur","sensible","sentence","separer","sequence","serein","sergent","serieux","serrure","serum","service","sesame","sevir","sevrage","sextuple","sideral","siecle","sieger","siffler","sigle","signal","silence","silicium","simple","sincere","sinistre","siphon","sirop","sismique","situer","skier","social","socle","sodium","soigneux","soldat","soleil","solitude","soluble","sombre","sommeil","somnoler","sonde","songeur","sonnette","sonore","sorcier","sortir","sosie","sottise","soucieux","soudure","souffle","soulever","soupape","source","soutirer","souvenir","spacieux","spatial","special","sphere","spiral","stable","station","sternum","stimulus","stipuler","strict","studieux","stupeur","styliste","sublime","substrat","subtil","subvenir","succes","sucre","suffixe","suggerer","suiveur","sulfate","superbe","supplier","surface","suricate","surmener","surprise","sursaut","survie","suspect","syllabe","symbole","symetrie","synapse","syntaxe","systeme","tabac","tablier","tactile","tailler","talent","talisman","talonner","tambour","tamiser","tangible","tapis","taquiner","tarder","tarif","tartine","tasse","tatami","tatouage","taupe","taureau","taxer","temoin","temporel","tenaille","tendre","teneur","tenir","tension","terminer","terne","terrible","tetine","texte","theme","theorie","therapie","thorax","tibia","tiede","timide","tirelire","tiroir","tissu","titane","titre","tituber","toboggan","tolerant","tomate","tonique","tonneau","toponyme","torche","tordre","tornade","torpille","torrent","torse","tortue","totem","toucher","tournage","tousser","toxine","traction","trafic","tragique","trahir","train","trancher","travail","trefle","tremper","tresor","treuil","triage","tribunal","tricoter","trilogie","triomphe","tripler","triturer","trivial","trombone","tronc","tropical","troupeau","tuile","tulipe","tumulte","tunnel","turbine","tuteur","tutoyer","tuyau","tympan","typhon","typique","tyran","ubuesque","ultime","ultrason","unanime","unifier","union","unique","unitaire","univers","uranium","urbain","urticant","usage","usine","usuel","usure","utile","utopie","vacarme","vaccin","vagabond","vague","vaillant","vaincre","vaisseau","valable","valise","vallon","valve","vampire","vanille","vapeur","varier","vaseux","vassal","vaste","vecteur","vedette","vegetal","vehicule","veinard","veloce","vendredi","venerer","venger","venimeux","ventouse","verdure","verin","vernir","verrou","verser","vertu","veston","veteran","vetuste","vexant","vexer","viaduc","viande","victoire","vidange","video","vignette","vigueur","vilain","village","vinaigre","violon","vipere","virement","virtuose","virus","visage","viseur","vision","visqueux","visuel","vital","vitesse","viticole","vitrine","vivace","vivipare","vocation","voguer","voile","voisin","voiture","volaille","volcan","voltiger","volume","vorace","vortex","voter","vouloir","voyage","voyelle","wagon","xenon","yacht","zebre","zenith","zeste","zoologie"]},{}],31:[function(require,module,exports){"use strict";exports.chinese={simplified:require("./chinese-simplified.js"),traditional:require("./chinese-traditional.js")},exports.english=require("./english.js"),exports.french=require("./french.js"),exports.italian=require("./italian.js"),exports.japanese=require("./japanese.js"),exports.spanish=require("./spanish.js")},{"./chinese-simplified.js":27,"./chinese-traditional.js":28,"./english.js":29,"./french.js":30,"./italian.js":32,"./japanese.js":33,"./spanish.js":34}],32:[function(require,module,exports){"use strict";module.exports=["abaco","abbaglio","abbinato","abete","abisso","abolire","abrasivo","abrogato","accadere","accenno","accusato","acetone","achille","acido","acqua","acre","acrilico","acrobata","acuto","adagio","addebito","addome","adeguato","aderire","adipe","adottare","adulare","affabile","affetto","affisso","affranto","aforisma","afoso","africano","agave","agente","agevole","aggancio","agire","agitare","agonismo","agricolo","agrumeto","aguzzo","alabarda","alato","albatro","alberato","albo","albume","alce","alcolico","alettone","alfa","algebra","aliante","alibi","alimento","allagato","allegro","allievo","allodola","allusivo","almeno","alogeno","alpaca","alpestre","altalena","alterno","alticcio","altrove","alunno","alveolo","alzare","amalgama","amanita","amarena","ambito","ambrato","ameba","america","ametista","amico","ammasso","ammenda","ammirare","ammonito","amore","ampio","ampliare","amuleto","anacardo","anagrafe","analista","anarchia","anatra","anca","ancella","ancora","andare","andrea","anello","angelo","angolare","angusto","anima","annegare","annidato","anno","annuncio","anonimo","anticipo","anzi","apatico","apertura","apode","apparire","appetito","appoggio","approdo","appunto","aprile","arabica","arachide","aragosta","araldica","arancio","aratura","arazzo","arbitro","archivio","ardito","arenile","argento","argine","arguto","aria","armonia","arnese","arredato","arringa","arrosto","arsenico","arso","artefice","arzillo","asciutto","ascolto","asepsi","asettico","asfalto","asino","asola","aspirato","aspro","assaggio","asse","assoluto","assurdo","asta","astenuto","astice","astratto","atavico","ateismo","atomico","atono","attesa","attivare","attorno","attrito","attuale","ausilio","austria","autista","autonomo","autunno","avanzato","avere","avvenire","avviso","avvolgere","azione","azoto","azzimo","azzurro","babele","baccano","bacino","baco","badessa","badilata","bagnato","baita","balcone","baldo","balena","ballata","balzano","bambino","bandire","baraonda","barbaro","barca","baritono","barlume","barocco","basilico","basso","batosta","battuto","baule","bava","bavosa","becco","beffa","belgio","belva","benda","benevole","benigno","benzina","bere","berlina","beta","bibita","bici","bidone","bifido","biga","bilancia","bimbo","binocolo","biologo","bipede","bipolare","birbante","birra","biscotto","bisesto","bisnonno","bisonte","bisturi","bizzarro","blando","blatta","bollito","bonifico","bordo","bosco","botanico","bottino","bozzolo","braccio","bradipo","brama","branca","bravura","bretella","brevetto","brezza","briglia","brillante","brindare","broccolo","brodo","bronzina","brullo","bruno","bubbone","buca","budino","buffone","buio","bulbo","buono","burlone","burrasca","bussola","busta","cadetto","caduco","calamaro","calcolo","calesse","calibro","calmo","caloria","cambusa","camerata","camicia","cammino","camola","campale","canapa","candela","cane","canino","canotto","cantina","capace","capello","capitolo","capogiro","cappero","capra","capsula","carapace","carcassa","cardo","carisma","carovana","carretto","cartolina","casaccio","cascata","caserma","caso","cassone","castello","casuale","catasta","catena","catrame","cauto","cavillo","cedibile","cedrata","cefalo","celebre","cellulare","cena","cenone","centesimo","ceramica","cercare","certo","cerume","cervello","cesoia","cespo","ceto","chela","chiaro","chicca","chiedere","chimera","china","chirurgo","chitarra","ciao","ciclismo","cifrare","cigno","cilindro","ciottolo","circa","cirrosi","citrico","cittadino","ciuffo","civetta","civile","classico","clinica","cloro","cocco","codardo","codice","coerente","cognome","collare","colmato","colore","colposo","coltivato","colza","coma","cometa","commando","comodo","computer","comune","conciso","condurre","conferma","congelare","coniuge","connesso","conoscere","consumo","continuo","convegno","coperto","copione","coppia","copricapo","corazza","cordata","coricato","cornice","corolla","corpo","corredo","corsia","cortese","cosmico","costante","cottura","covato","cratere","cravatta","creato","credere","cremoso","crescita","creta","criceto","crinale","crisi","critico","croce","cronaca","crostata","cruciale","crusca","cucire","cuculo","cugino","cullato","cupola","curatore","cursore","curvo","cuscino","custode","dado","daino","dalmata","damerino","daniela","dannoso","danzare","datato","davanti","davvero","debutto","decennio","deciso","declino","decollo","decreto","dedicato","definito","deforme","degno","delegare","delfino","delirio","delta","demenza","denotato","dentro","deposito","derapata","derivare","deroga","descritto","deserto","desiderio","desumere","detersivo","devoto","diametro","dicembre","diedro","difeso","diffuso","digerire","digitale","diluvio","dinamico","dinnanzi","dipinto","diploma","dipolo","diradare","dire","dirotto","dirupo","disagio","discreto","disfare","disgelo","disposto","distanza","disumano","dito","divano","divelto","dividere","divorato","doblone","docente","doganale","dogma","dolce","domato","domenica","dominare","dondolo","dono","dormire","dote","dottore","dovuto","dozzina","drago","druido","dubbio","dubitare","ducale","duna","duomo","duplice","duraturo","ebano","eccesso","ecco","eclissi","economia","edera","edicola","edile","editoria","educare","egemonia","egli","egoismo","egregio","elaborato","elargire","elegante","elencato","eletto","elevare","elfico","elica","elmo","elsa","eluso","emanato","emblema","emesso","emiro","emotivo","emozione","empirico","emulo","endemico","enduro","energia","enfasi","enoteca","entrare","enzima","epatite","epilogo","episodio","epocale","eppure","equatore","erario","erba","erboso","erede","eremita","erigere","ermetico","eroe","erosivo","errante","esagono","esame","esanime","esaudire","esca","esempio","esercito","esibito","esigente","esistere","esito","esofago","esortato","esoso","espanso","espresso","essenza","esso","esteso","estimare","estonia","estroso","esultare","etilico","etnico","etrusco","etto","euclideo","europa","evaso","evidenza","evitato","evoluto","evviva","fabbrica","faccenda","fachiro","falco","famiglia","fanale","fanfara","fango","fantasma","fare","farfalla","farinoso","farmaco","fascia","fastoso","fasullo","faticare","fato","favoloso","febbre","fecola","fede","fegato","felpa","feltro","femmina","fendere","fenomeno","fermento","ferro","fertile","fessura","festivo","fetta","feudo","fiaba","fiducia","fifa","figurato","filo","finanza","finestra","finire","fiore","fiscale","fisico","fiume","flacone","flamenco","flebo","flemma","florido","fluente","fluoro","fobico","focaccia","focoso","foderato","foglio","folata","folclore","folgore","fondente","fonetico","fonia","fontana","forbito","forchetta","foresta","formica","fornaio","foro","fortezza","forzare","fosfato","fosso","fracasso","frana","frassino","fratello","freccetta","frenata","fresco","frigo","frollino","fronde","frugale","frutta","fucilata","fucsia","fuggente","fulmine","fulvo","fumante","fumetto","fumoso","fune","funzione","fuoco","furbo","furgone","furore","fuso","futile","gabbiano","gaffe","galateo","gallina","galoppo","gambero","gamma","garanzia","garbo","garofano","garzone","gasdotto","gasolio","gastrico","gatto","gaudio","gazebo","gazzella","geco","gelatina","gelso","gemello","gemmato","gene","genitore","gennaio","genotipo","gergo","ghepardo","ghiaccio","ghisa","giallo","gilda","ginepro","giocare","gioiello","giorno","giove","girato","girone","gittata","giudizio","giurato","giusto","globulo","glutine","gnomo","gobba","golf","gomito","gommone","gonfio","gonna","governo","gracile","grado","grafico","grammo","grande","grattare","gravoso","grazia","greca","gregge","grifone","grigio","grinza","grotta","gruppo","guadagno","guaio","guanto","guardare","gufo","guidare","ibernato","icona","identico","idillio","idolo","idra","idrico","idrogeno","igiene","ignaro","ignorato","ilare","illeso","illogico","illudere","imballo","imbevuto","imbocco","imbuto","immane","immerso","immolato","impacco","impeto","impiego","importo","impronta","inalare","inarcare","inattivo","incanto","incendio","inchino","incisivo","incluso","incontro","incrocio","incubo","indagine","india","indole","inedito","infatti","infilare","inflitto","ingaggio","ingegno","inglese","ingordo","ingrosso","innesco","inodore","inoltrare","inondato","insano","insetto","insieme","insonnia","insulina","intasato","intero","intonaco","intuito","inumidire","invalido","invece","invito","iperbole","ipnotico","ipotesi","ippica","iride","irlanda","ironico","irrigato","irrorare","isolato","isotopo","isterico","istituto","istrice","italia","iterare","labbro","labirinto","lacca","lacerato","lacrima","lacuna","laddove","lago","lampo","lancetta","lanterna","lardoso","larga","laringe","lastra","latenza","latino","lattuga","lavagna","lavoro","legale","leggero","lembo","lentezza","lenza","leone","lepre","lesivo","lessato","lesto","letterale","leva","levigato","libero","lido","lievito","lilla","limatura","limitare","limpido","lineare","lingua","liquido","lira","lirica","lisca","lite","litigio","livrea","locanda","lode","logica","lombare","londra","longevo","loquace","lorenzo","loto","lotteria","luce","lucidato","lumaca","luminoso","lungo","lupo","luppolo","lusinga","lusso","lutto","macabro","macchina","macero","macinato","madama","magico","maglia","magnete","magro","maiolica","malafede","malgrado","malinteso","malsano","malto","malumore","mana","mancia","mandorla","mangiare","manifesto","mannaro","manovra","mansarda","mantide","manubrio","mappa","maratona","marcire","maretta","marmo","marsupio","maschera","massaia","mastino","materasso","matricola","mattone","maturo","mazurca","meandro","meccanico","mecenate","medesimo","meditare","mega","melassa","melis","melodia","meninge","meno","mensola","mercurio","merenda","merlo","meschino","mese","messere","mestolo","metallo","metodo","mettere","miagolare","mica","micelio","michele","microbo","midollo","miele","migliore","milano","milite","mimosa","minerale","mini","minore","mirino","mirtillo","miscela","missiva","misto","misurare","mitezza","mitigare","mitra","mittente","mnemonico","modello","modifica","modulo","mogano","mogio","mole","molosso","monastero","monco","mondina","monetario","monile","monotono","monsone","montato","monviso","mora","mordere","morsicato","mostro","motivato","motosega","motto","movenza","movimento","mozzo","mucca","mucosa","muffa","mughetto","mugnaio","mulatto","mulinello","multiplo","mummia","munto","muovere","murale","musa","muscolo","musica","mutevole","muto","nababbo","nafta","nanometro","narciso","narice","narrato","nascere","nastrare","naturale","nautica","naviglio","nebulosa","necrosi","negativo","negozio","nemmeno","neofita","neretto","nervo","nessuno","nettuno","neutrale","neve","nevrotico","nicchia","ninfa","nitido","nobile","nocivo","nodo","nome","nomina","nordico","normale","norvegese","nostrano","notare","notizia","notturno","novella","nucleo","nulla","numero","nuovo","nutrire","nuvola","nuziale","oasi","obbedire","obbligo","obelisco","oblio","obolo","obsoleto","occasione","occhio","occidente","occorrere","occultare","ocra","oculato","odierno","odorare","offerta","offrire","offuscato","oggetto","oggi","ognuno","olandese","olfatto","oliato","oliva","ologramma","oltre","omaggio","ombelico","ombra","omega","omissione","ondoso","onere","onice","onnivoro","onorevole","onta","operato","opinione","opposto","oracolo","orafo","ordine","orecchino","orefice","orfano","organico","origine","orizzonte","orma","ormeggio","ornativo","orologio","orrendo","orribile","ortensia","ortica","orzata","orzo","osare","oscurare","osmosi","ospedale","ospite","ossa","ossidare","ostacolo","oste","otite","otre","ottagono","ottimo","ottobre","ovale","ovest","ovino","oviparo","ovocito","ovunque","ovviare","ozio","pacchetto","pace","pacifico","padella","padrone","paese","paga","pagina","palazzina","palesare","pallido","palo","palude","pandoro","pannello","paolo","paonazzo","paprica","parabola","parcella","parere","pargolo","pari","parlato","parola","partire","parvenza","parziale","passivo","pasticca","patacca","patologia","pattume","pavone","peccato","pedalare","pedonale","peggio","peloso","penare","pendice","penisola","pennuto","penombra","pensare","pentola","pepe","pepita","perbene","percorso","perdonato","perforare","pergamena","periodo","permesso","perno","perplesso","persuaso","pertugio","pervaso","pesatore","pesista","peso","pestifero","petalo","pettine","petulante","pezzo","piacere","pianta","piattino","piccino","picozza","piega","pietra","piffero","pigiama","pigolio","pigro","pila","pilifero","pillola","pilota","pimpante","pineta","pinna","pinolo","pioggia","piombo","piramide","piretico","pirite","pirolisi","pitone","pizzico","placebo","planare","plasma","platano","plenario","pochezza","poderoso","podismo","poesia","poggiare","polenta","poligono","pollice","polmonite","polpetta","polso","poltrona","polvere","pomice","pomodoro","ponte","popoloso","porfido","poroso","porpora","porre","portata","posa","positivo","possesso","postulato","potassio","potere","pranzo","prassi","pratica","precluso","predica","prefisso","pregiato","prelievo","premere","prenotare","preparato","presenza","pretesto","prevalso","prima","principe","privato","problema","procura","produrre","profumo","progetto","prolunga","promessa","pronome","proposta","proroga","proteso","prova","prudente","prugna","prurito","psiche","pubblico","pudica","pugilato","pugno","pulce","pulito","pulsante","puntare","pupazzo","pupilla","puro","quadro","qualcosa","quasi","querela","quota","raccolto","raddoppio","radicale","radunato","raffica","ragazzo","ragione","ragno","ramarro","ramingo","ramo","randagio","rantolare","rapato","rapina","rappreso","rasatura","raschiato","rasente","rassegna","rastrello","rata","ravveduto","reale","recepire","recinto","recluta","recondito","recupero","reddito","redimere","regalato","registro","regola","regresso","relazione","remare","remoto","renna","replica","reprimere","reputare","resa","residente","responso","restauro","rete","retina","retorica","rettifica","revocato","riassunto","ribadire","ribelle","ribrezzo","ricarica","ricco","ricevere","riciclato","ricordo","ricreduto","ridicolo","ridurre","rifasare","riflesso","riforma","rifugio","rigare","rigettato","righello","rilassato","rilevato","rimanere","rimbalzo","rimedio","rimorchio","rinascita","rincaro","rinforzo","rinnovo","rinomato","rinsavito","rintocco","rinuncia","rinvenire","riparato","ripetuto","ripieno","riportare","ripresa","ripulire","risata","rischio","riserva","risibile","riso","rispetto","ristoro","risultato","risvolto","ritardo","ritegno","ritmico","ritrovo","riunione","riva","riverso","rivincita","rivolto","rizoma","roba","robotico","robusto","roccia","roco","rodaggio","rodere","roditore","rogito","rollio","romantico","rompere","ronzio","rosolare","rospo","rotante","rotondo","rotula","rovescio","rubizzo","rubrica","ruga","rullino","rumine","rumoroso","ruolo","rupe","russare","rustico","sabato","sabbiare","sabotato","sagoma","salasso","saldatura","salgemma","salivare","salmone","salone","saltare","saluto","salvo","sapere","sapido","saporito","saraceno","sarcasmo","sarto","sassoso","satellite","satira","satollo","saturno","savana","savio","saziato","sbadiglio","sbalzo","sbancato","sbarra","sbattere","sbavare","sbendare","sbirciare","sbloccato","sbocciato","sbrinare","sbruffone","sbuffare","scabroso","scadenza","scala","scambiare","scandalo","scapola","scarso","scatenare","scavato","scelto","scenico","scettro","scheda","schiena","sciarpa","scienza","scindere","scippo","sciroppo","scivolo","sclerare","scodella","scolpito","scomparto","sconforto","scoprire","scorta","scossone","scozzese","scriba","scrollare","scrutinio","scuderia","scultore","scuola","scuro","scusare","sdebitare","sdoganare","seccatura","secondo","sedano","seggiola","segnalato","segregato","seguito","selciato","selettivo","sella","selvaggio","semaforo","sembrare","seme","seminato","sempre","senso","sentire","sepolto","sequenza","serata","serbato","sereno","serio","serpente","serraglio","servire","sestina","setola","settimana","sfacelo","sfaldare","sfamato","sfarzoso","sfaticato","sfera","sfida","sfilato","sfinge","sfocato","sfoderare","sfogo","sfoltire","sforzato","sfratto","sfruttato","sfuggito","sfumare","sfuso","sgabello","sgarbato","sgonfiare","sgorbio","sgrassato","sguardo","sibilo","siccome","sierra","sigla","signore","silenzio","sillaba","simbolo","simpatico","simulato","sinfonia","singolo","sinistro","sino","sintesi","sinusoide","sipario","sisma","sistole","situato","slitta","slogatura","sloveno","smarrito","smemorato","smentito","smeraldo","smilzo","smontare","smottato","smussato","snellire","snervato","snodo","sobbalzo","sobrio","soccorso","sociale","sodale","soffitto","sogno","soldato","solenne","solido","sollazzo","solo","solubile","solvente","somatico","somma","sonda","sonetto","sonnifero","sopire","soppeso","sopra","sorgere","sorpasso","sorriso","sorso","sorteggio","sorvolato","sospiro","sosta","sottile","spada","spalla","spargere","spatola","spavento","spazzola","specie","spedire","spegnere","spelatura","speranza","spessore","spettrale","spezzato","spia","spigoloso","spillato","spinoso","spirale","splendido","sportivo","sposo","spranga","sprecare","spronato","spruzzo","spuntino","squillo","sradicare","srotolato","stabile","stacco","staffa","stagnare","stampato","stantio","starnuto","stasera","statuto","stelo","steppa","sterzo","stiletto","stima","stirpe","stivale","stizzoso","stonato","storico","strappo","stregato","stridulo","strozzare","strutto","stuccare","stufo","stupendo","subentro","succoso","sudore","suggerito","sugo","sultano","suonare","superbo","supporto","surgelato","surrogato","sussurro","sutura","svagare","svedese","sveglio","svelare","svenuto","svezia","sviluppo","svista","svizzera","svolta","svuotare","tabacco","tabulato","tacciare","taciturno","tale","talismano","tampone","tannino","tara","tardivo","targato","tariffa","tarpare","tartaruga","tasto","tattico","taverna","tavolata","tazza","teca","tecnico","telefono","temerario","tempo","temuto","tendone","tenero","tensione","tentacolo","teorema","terme","terrazzo","terzetto","tesi","tesserato","testato","tetro","tettoia","tifare","tigella","timbro","tinto","tipico","tipografo","tiraggio","tiro","titanio","titolo","titubante","tizio","tizzone","toccare","tollerare","tolto","tombola","tomo","tonfo","tonsilla","topazio","topologia","toppa","torba","tornare","torrone","tortora","toscano","tossire","tostatura","totano","trabocco","trachea","trafila","tragedia","tralcio","tramonto","transito","trapano","trarre","trasloco","trattato","trave","treccia","tremolio","trespolo","tributo","tricheco","trifoglio","trillo","trincea","trio","tristezza","triturato","trivella","tromba","trono","troppo","trottola","trovare","truccato","tubatura","tuffato","tulipano","tumulto","tunisia","turbare","turchino","tuta","tutela","ubicato","uccello","uccisore","udire","uditivo","uffa","ufficio","uguale","ulisse","ultimato","umano","umile","umorismo","uncinetto","ungere","ungherese","unicorno","unificato","unisono","unitario","unte","uovo","upupa","uragano","urgenza","urlo","usanza","usato","uscito","usignolo","usuraio","utensile","utilizzo","utopia","vacante","vaccinato","vagabondo","vagliato","valanga","valgo","valico","valletta","valoroso","valutare","valvola","vampata","vangare","vanitoso","vano","vantaggio","vanvera","vapore","varano","varcato","variante","vasca","vedetta","vedova","veduto","vegetale","veicolo","velcro","velina","velluto","veloce","venato","vendemmia","vento","verace","verbale","vergogna","verifica","vero","verruca","verticale","vescica","vessillo","vestale","veterano","vetrina","vetusto","viandante","vibrante","vicenda","vichingo","vicinanza","vidimare","vigilia","vigneto","vigore","vile","villano","vimini","vincitore","viola","vipera","virgola","virologo","virulento","viscoso","visione","vispo","vissuto","visura","vita","vitello","vittima","vivanda","vivido","viziare","voce","voga","volatile","volere","volpe","voragine","vulcano","zampogna","zanna","zappato","zattera","zavorra","zefiro","zelante","zelo","zenzero","zerbino","zibetto","zinco","zircone","zitto","zolla","zotico","zucchero","zufolo","zulu","zuppa"]},{}],33:[function(require,module,exports){"use strict";module.exports=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},{}],34:[function(require,module,exports){"use strict";module.exports=["abaco","abdomen","abeja","abierto","abogado","abono","aborto","abrazo","abrir","abuelo","abuso","acabar","academia","acceso","accion","aceite","acelga","acento","aceptar","acido","aclarar","acne","acoger","acoso","activo","acto","actriz","actuar","acudir","acuerdo","acusar","adicto","admitir","adoptar","adorno","aduana","adulto","aereo","afectar","aficion","afinar","afirmar","agil","agitar","agonia","agosto","agotar","agregar","agrio","agua","agudo","aguila","aguja","ahogo","ahorro","aire","aislar","ajedrez","ajeno","ajuste","alacran","alambre","alarma","alba","album","alcalde","aldea","alegre","alejar","alerta","aleta","alfiler","alga","algodon","aliado","aliento","alivio","alma","almeja","almibar","altar","alteza","altivo","alto","altura","alumno","alzar","amable","amante","amapola","amargo","amasar","ambar","ambito","ameno","amigo","amistad","amor","amparo","amplio","ancho","anciano","ancla","andar","anden","anemia","angulo","anillo","animo","anis","anotar","antena","antiguo","antojo","anual","anular","anuncio","anadir","anejo","ano","apagar","aparato","apetito","apio","aplicar","apodo","aporte","apoyo","aprender","aprobar","apuesta","apuro","arado","arana","arar","arbitro","arbol","arbusto","archivo","arco","arder","ardilla","arduo","area","arido","aries","armonia","arnes","aroma","arpa","arpon","arreglo","arroz","arruga","arte","artista","asa","asado","asalto","ascenso","asegurar","aseo","asesor","asiento","asilo","asistir","asno","asombro","aspero","astilla","astro","astuto","asumir","asunto","atajo","ataque","atar","atento","ateo","atico","atleta","atomo","atraer","atroz","atun","audaz","audio","auge","aula","aumento","ausente","autor","aval","avance","avaro","ave","avellana","avena","avestruz","avion","aviso","ayer","ayuda","ayuno","azafran","azar","azote","azucar","azufre","azul","baba","babor","bache","bahia","baile","bajar","balanza","balcon","balde","bambu","banco","banda","bano","barba","barco","barniz","barro","bascula","baston","basura","batalla","bateria","batir","batuta","baul","bazar","bebe","bebida","bello","besar","beso","bestia","bicho","bien","bingo","blanco","bloque","blusa","boa","bobina","bobo","boca","bocina","boda","bodega","boina","bola","bolero","bolsa","bomba","bondad","bonito","bono","bonsai","borde","borrar","bosque","bote","botin","boveda","bozal","bravo","brazo","brecha","breve","brillo","brinco","brisa","broca","broma","bronce","brote","bruja","brusco","bruto","buceo","bucle","bueno","buey","bufanda","bufon","buho","buitre","bulto","burbuja","burla","burro","buscar","butaca","buzon","caballo","cabeza","cabina","cabra","cacao","cadaver","cadena","caer","cafe","caida","caiman","caja","cajon","cal","calamar","calcio","caldo","calidad","calle","calma","calor","calvo","cama","cambio","camello","camino","campo","cancer","candil","canela","canguro","canica","canto","cana","canon","caoba","caos","capaz","capitan","capote","captar","capucha","cara","carbon","carcel","careta","carga","carino","carne","carpeta","carro","carta","casa","casco","casero","caspa","castor","catorce","catre","caudal","causa","cazo","cebolla","ceder","cedro","celda","celebre","celoso","celula","cemento","ceniza","centro","cerca","cerdo","cereza","cero","cerrar","certeza","cesped","cetro","chacal","chaleco","champu","chancla","chapa","charla","chico","chiste","chivo","choque","choza","chuleta","chupar","ciclon","ciego","cielo","cien","cierto","cifra","cigarro","cima","cinco","cine","cinta","cipres","circo","ciruela","cisne","cita","ciudad","clamor","clan","claro","clase","clave","cliente","clima","clinica","cobre","coccion","cochino","cocina","coco","codigo","codo","cofre","coger","cohete","cojin","cojo","cola","colcha","colegio","colgar","colina","collar","colmo","columna","combate","comer","comida","comodo","compra","conde","conejo","conga","conocer","consejo","contar","copa","copia","corazon","corbata","corcho","cordon","corona","correr","coser","cosmos","costa","craneo","crater","crear","crecer","creido","crema","cria","crimen","cripta","crisis","cromo","cronica","croqueta","crudo","cruz","cuadro","cuarto","cuatro","cubo","cubrir","cuchara","cuello","cuento","cuerda","cuesta","cueva","cuidar","culebra","culpa","culto","cumbre","cumplir","cuna","cuneta","cuota","cupon","cupula","curar","curioso","curso","curva","cutis","dama","danza","dar","dardo","datil","deber","debil","decada","decir","dedo","defensa","definir","dejar","delfin","delgado","delito","demora","denso","dental","deporte","derecho","derrota","desayuno","deseo","desfile","desnudo","destino","desvio","detalle","detener","deuda","dia","diablo","diadema","diamante","diana","diario","dibujo","dictar","diente","dieta","diez","dificil","digno","dilema","diluir","dinero","directo","dirigir","disco","diseno","disfraz","diva","divino","doble","doce","dolor","domingo","don","donar","dorado","dormir","dorso","dos","dosis","dragon","droga","ducha","duda","duelo","dueno","dulce","duo","duque","durar","dureza","duro","ebano","ebrio","echar","eco","ecuador","edad","edicion","edificio","editor","educar","efecto","eficaz","eje","ejemplo","elefante","elegir","elemento","elevar","elipse","elite","elixir","elogio","eludir","embudo","emitir","emocion","empate","empeno","empleo","empresa","enano","encargo","enchufe","encia","enemigo","enero","enfado","enfermo","engano","enigma","enlace","enorme","enredo","ensayo","ensenar","entero","entrar","envase","envio","epoca","equipo","erizo","escala","escena","escolar","escribir","escudo","esencia","esfera","esfuerzo","espada","espejo","espia","esposa","espuma","esqui","estar","este","estilo","estufa","etapa","eterno","etica","etnia","evadir","evaluar","evento","evitar","exacto","examen","exceso","excusa","exento","exigir","exilio","existir","exito","experto","explicar","exponer","extremo","fabrica","fabula","fachada","facil","factor","faena","faja","falda","fallo","falso","faltar","fama","familia","famoso","faraon","farmacia","farol","farsa","fase","fatiga","fauna","favor","fax","febrero","fecha","feliz","feo","feria","feroz","fertil","fervor","festin","fiable","fianza","fiar","fibra","ficcion","ficha","fideo","fiebre","fiel","fiera","fiesta","figura","fijar","fijo","fila","filete","filial","filtro","fin","finca","fingir","finito","firma","flaco","flauta","flecha","flor","flota","fluir","flujo","fluor","fobia","foca","fogata","fogon","folio","folleto","fondo","forma","forro","fortuna","forzar","fosa","foto","fracaso","fragil","franja","frase","fraude","freir","freno","fresa","frio","frito","fruta","fuego","fuente","fuerza","fuga","fumar","funcion","funda","furgon","furia","fusil","futbol","futuro","gacela","gafas","gaita","gajo","gala","galeria","gallo","gamba","ganar","gancho","ganga","ganso","garaje","garza","gasolina","gastar","gato","gavilan","gemelo","gemir","gen","genero","genio","gente","geranio","gerente","germen","gesto","gigante","gimnasio","girar","giro","glaciar","globo","gloria","gol","golfo","goloso","golpe","goma","gordo","gorila","gorra","gota","goteo","gozar","grada","grafico","grano","grasa","gratis","grave","grieta","grillo","gripe","gris","grito","grosor","grua","grueso","grumo","grupo","guante","guapo","guardia","guerra","guia","guino","guion","guiso","guitarra","gusano","gustar","haber","habil","hablar","hacer","hacha","hada","hallar","hamaca","harina","haz","hazana","hebilla","hebra","hecho","helado","helio","hembra","herir","hermano","heroe","hervir","hielo","hierro","higado","higiene","hijo","himno","historia","hocico","hogar","hoguera","hoja","hombre","hongo","honor","honra","hora","hormiga","horno","hostil","hoyo","hueco","huelga","huerta","hueso","huevo","huida","huir","humano","humedo","humilde","humo","hundir","huracan","hurto","icono","ideal","idioma","idolo","iglesia","iglu","igual","ilegal","ilusion","imagen","iman","imitar","impar","imperio","imponer","impulso","incapaz","indice","inerte","infiel","informe","ingenio","inicio","inmenso","inmune","innato","insecto","instante","interes","intimo","intuir","inutil","invierno","ira","iris","ironia","isla","islote","jabali","jabon","jamon","jarabe","jardin","jarra","jaula","jazmin","jefe","jeringa","jinete","jornada","joroba","joven","joya","juerga","jueves","juez","jugador","jugo","juguete","juicio","junco","jungla","junio","juntar","jupiter","jurar","justo","juvenil","juzgar","kilo","koala","labio","lacio","lacra","lado","ladron","lagarto","lagrima","laguna","laico","lamer","lamina","lampara","lana","lancha","langosta","lanza","lapiz","largo","larva","lastima","lata","latex","latir","laurel","lavar","lazo","leal","leccion","leche","lector","leer","legion","legumbre","lejano","lengua","lento","lena","leon","leopardo","lesion","letal","letra","leve","leyenda","libertad","libro","licor","lider","lidiar","lienzo","liga","ligero","lima","limite","limon","limpio","lince","lindo","linea","lingote","lino","linterna","liquido","liso","lista","litera","litio","litro","llaga","llama","llanto","llave","llegar","llenar","llevar","llorar","llover","lluvia","lobo","locion","loco","locura","logica","logro","lombriz","lomo","lonja","lote","lucha","lucir","lugar","lujo","luna","lunes","lupa","lustro","luto","luz","maceta","macho","madera","madre","maduro","maestro","mafia","magia","mago","maiz","maldad","maleta","malla","malo","mama","mambo","mamut","manco","mando","manejar","manga","maniqui","manjar","mano","manso","manta","manana","mapa","maquina","mar","marco","marea","marfil","margen","marido","marmol","marron","martes","marzo","masa","mascara","masivo","matar","materia","matiz","matriz","maximo","mayor","mazorca","mecha","medalla","medio","medula","mejilla","mejor","melena","melon","memoria","menor","mensaje","mente","menu","mercado","merengue","merito","mes","meson","meta","meter","metodo","metro","mezcla","miedo","miel","miembro","miga","mil","milagro","militar","millon","mimo","mina","minero","minimo","minuto","miope","mirar","misa","miseria","misil","mismo","mitad","mito","mochila","mocion","moda","modelo","moho","mojar","molde","moler","molino","momento","momia","monarca","moneda","monja","monto","mono","morada","morder","moreno","morir","morro","morsa","mortal","mosca","mostrar","motivo","mover","movil","mozo","mucho","mudar","mueble","muela","muerte","muestra","mugre","mujer","mula","muleta","multa","mundo","muneca","mural","muro","musculo","museo","musgo","musica","muslo","nacar","nacion","nadar","naipe","naranja","nariz","narrar","nasal","natal","nativo","natural","nausea","naval","nave","navidad","necio","nectar","negar","negocio","negro","neon","nervio","neto","neutro","nevar","nevera","nicho","nido","niebla","nieto","ninez","nino","nitido","nivel","nobleza","noche","nomina","noria","norma","norte","nota","noticia","novato","novela","novio","nube","nuca","nucleo","nudillo","nudo","nuera","nueve","nuez","nulo","numero","nutria","oasis","obeso","obispo","objeto","obra","obrero","observar","obtener","obvio","oca","ocaso","oceano","ochenta","ocho","ocio","ocre","octavo","octubre","oculto","ocupar","ocurrir","odiar","odio","odisea","oeste","ofensa","oferta","oficio","ofrecer","ogro","oido","oir","ojo","ola","oleada","olfato","olivo","olla","olmo","olor","olvido","ombligo","onda","onza","opaco","opcion","opera","opinar","oponer","optar","optica","opuesto","oracion","orador","oral","orbita","orca","orden","oreja","organo","orgia","orgullo","oriente","origen","orilla","oro","orquesta","oruga","osadia","oscuro","osezno","oso","ostra","otono","otro","oveja","ovulo","oxido","oxigeno","oyente","ozono","pacto","padre","paella","pagina","pago","pais","pajaro","palabra","palco","paleta","palido","palma","paloma","palpar","pan","panal","panico","pantera","panuelo","papa","papel","papilla","paquete","parar","parcela","pared","parir","paro","parpado","parque","parrafo","parte","pasar","paseo","pasion","paso","pasta","pata","patio","patria","pausa","pauta","pavo","payaso","peaton","pecado","pecera","pecho","pedal","pedir","pegar","peine","pelar","peldano","pelea","peligro","pellejo","pelo","peluca","pena","pensar","penon","peon","peor","pepino","pequeno","pera","percha","perder","pereza","perfil","perico","perla","permiso","perro","persona","pesa","pesca","pesimo","pestana","petalo","petroleo","pez","pezuna","picar","pichon","pie","piedra","pierna","pieza","pijama","pilar","piloto","pimienta","pino","pintor","pinza","pina","piojo","pipa","pirata","pisar","piscina","piso","pista","piton","pizca","placa","plan","plata","playa","plaza","pleito","pleno","plomo","pluma","plural","pobre","poco","poder","podio","poema","poesia","poeta","polen","policia","pollo","polvo","pomada","pomelo","pomo","pompa","poner","porcion","portal","posada","poseer","posible","poste","potencia","potro","pozo","prado","precoz","pregunta","premio","prensa","preso","previo","primo","principe","prision","privar","proa","probar","proceso","producto","proeza","profesor","programa","prole","promesa","pronto","propio","proximo","prueba","publico","puchero","pudor","pueblo","puerta","puesto","pulga","pulir","pulmon","pulpo","pulso","puma","punto","punal","puno","pupa","pupila","pure","quedar","queja","quemar","querer","queso","quieto","quimica","quince","quitar","rabano","rabia","rabo","racion","radical","raiz","rama","rampa","rancho","rango","rapaz","rapido","rapto","rasgo","raspa","rato","rayo","raza","razon","reaccion","realidad","rebano","rebote","recaer","receta","rechazo","recoger","recreo","recto","recurso","red","redondo","reducir","reflejo","reforma","refran","refugio","regalo","regir","regla","regreso","rehen","reino","reir","reja","relato","relevo","relieve","relleno","reloj","remar","remedio","remo","rencor","rendir","renta","reparto","repetir","reposo","reptil","res","rescate","resina","respeto","resto","resumen","retiro","retorno","retrato","reunir","reves","revista","rey","rezar","rico","riego","rienda","riesgo","rifa","rigido","rigor","rincon","rinon","rio","riqueza","risa","ritmo","rito","rizo","roble","roce","rociar","rodar","rodeo","rodilla","roer","rojizo","rojo","romero","romper","ron","ronco","ronda","ropa","ropero","rosa","rosca","rostro","rotar","rubi","rubor","rudo","rueda","rugir","ruido","ruina","ruleta","rulo","rumbo","rumor","ruptura","ruta","rutina","sabado","saber","sabio","sable","sacar","sagaz","sagrado","sala","saldo","salero","salir","salmon","salon","salsa","salto","salud","salvar","samba","sancion","sandia","sanear","sangre","sanidad","sano","santo","sapo","saque","sardina","sarten","sastre","satan","sauna","saxofon","seccion","seco","secreto","secta","sed","seguir","seis","sello","selva","semana","semilla","senda","sensor","senal","senor","separar","sepia","sequia","ser","serie","sermon","servir","sesenta","sesion","seta","setenta","severo","sexo","sexto","sidra","siesta","siete","siglo","signo","silaba","silbar","silencio","silla","simbolo","simio","sirena","sistema","sitio","situar","sobre","socio","sodio","sol","solapa","soldado","soledad","solido","soltar","solucion","sombra","sondeo","sonido","sonoro","sonrisa","sopa","soplar","soporte","sordo","sorpresa","sorteo","sosten","sotano","suave","subir","suceso","sudor","suegra","suelo","sueno","suerte","sufrir","sujeto","sultan","sumar","superar","suplir","suponer","supremo","sur","surco","sureno","surgir","susto","sutil","tabaco","tabique","tabla","tabu","taco","tacto","tajo","talar","talco","talento","talla","talon","tamano","tambor","tango","tanque","tapa","tapete","tapia","tapon","taquilla","tarde","tarea","tarifa","tarjeta","tarot","tarro","tarta","tatuaje","tauro","taza","tazon","teatro","techo","tecla","tecnica","tejado","tejer","tejido","tela","telefono","tema","temor","templo","tenaz","tender","tener","tenis","tenso","teoria","terapia","terco","termino","ternura","terror","tesis","tesoro","testigo","tetera","texto","tez","tibio","tiburon","tiempo","tienda","tierra","tieso","tigre","tijera","tilde","timbre","timido","timo","tinta","tio","tipico","tipo","tira","tiron","titan","titere","titulo","tiza","toalla","tobillo","tocar","tocino","todo","toga","toldo","tomar","tono","tonto","topar","tope","toque","torax","torero","tormenta","torneo","toro","torpedo","torre","torso","tortuga","tos","tosco","toser","toxico","trabajo","tractor","traer","trafico","trago","traje","tramo","trance","trato","trauma","trazar","trebol","tregua","treinta","tren","trepar","tres","tribu","trigo","tripa","triste","triunfo","trofeo","trompa","tronco","tropa","trote","trozo","truco","trueno","trufa","tuberia","tubo","tuerto","tumba","tumor","tunel","tunica","turbina","turismo","turno","tutor","ubicar","ulcera","umbral","unidad","unir","universo","uno","untar","una","urbano","urbe","urgente","urna","usar","usuario","util","utopia","uva","vaca","vacio","vacuna","vagar","vago","vaina","vajilla","vale","valido","valle","valor","valvula","vampiro","vara","variar","varon","vaso","vecino","vector","vehiculo","veinte","vejez","vela","velero","veloz","vena","vencer","venda","veneno","vengar","venir","venta","venus","ver","verano","verbo","verde","vereda","verja","verso","verter","via","viaje","vibrar","vicio","victima","vida","video","vidrio","viejo","viernes","vigor","vil","villa","vinagre","vino","vinedo","violin","viral","virgo","virtud","visor","vispera","vista","vitamina","viudo","vivaz","vivero","vivir","vivo","volcan","volumen","volver","voraz","votar","voto","voz","vuelo","vulgar","yacer","yate","yegua","yema","yerno","yeso","yodo","yoga","yogur","zafiro","zanja","zapato","zarza","zona","zorro","zumo","zurdo"]},{}],35:[function(require,module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),bio=require("bufio"),Logger=require("blgr"),util=require("../utils/util"),binary=require("../utils/binary"),consensus=require("../protocol/consensus"),policy=require("../protocol/policy"),encoding=bio.encoding,MIN_FEERATE=10,INF_FEERATE=consensus.MAX_MONEY,MIN_PRIORITY=10,INF_PRIORITY=1e9*consensus.MAX_MONEY,ConfirmStats=function(){function ConfirmStats(type,logger){_classCallCheck(this,ConfirmStats),this.logger=Logger.global,this.type=type,this.decay=0,this.maxConfirms=0,this.buckets=new Float64Array(0),this.bucketMap=new DoubleMap,this.confAvg=[],this.curBlockConf=[],this.unconfTX=[],this.oldUnconfTX=new Int32Array(0),this.curBlockTX=new Int32Array(0),this.txAvg=new Float64Array(0),this.curBlockVal=new Float64Array(0),this.avg=new Float64Array(0),logger&&(assert("object"===(void 0===logger?"undefined":_typeof(logger))),this.logger=logger.context("fees"))}return ConfirmStats.prototype.init=function(buckets,maxConfirms,decay){this.maxConfirms=maxConfirms,this.decay=decay,this.buckets=new Float64Array(buckets.length),this.bucketMap=new DoubleMap;for(var i=0;i<buckets.length;i++)this.buckets[i]=buckets[i],this.bucketMap.insert(buckets[i],i);this.confAvg=new Array(maxConfirms),this.curBlockConf=new Array(maxConfirms),this.unconfTX=new Array(maxConfirms);for(var _i=0;_i<maxConfirms;_i++)this.confAvg[_i]=new Float64Array(buckets.length),this.curBlockConf[_i]=new Int32Array(buckets.length),this.unconfTX[_i]=new Int32Array(buckets.length);this.oldUnconfTX=new Int32Array(buckets.length),this.curBlockTX=new Int32Array(buckets.length),this.txAvg=new Float64Array(buckets.length),this.curBlockVal=new Float64Array(buckets.length),this.avg=new Float64Array(buckets.length)},ConfirmStats.prototype.clearCurrent=function(height){for(var i=0;i<this.buckets.length;i++){this.oldUnconfTX[i]=this.unconfTX[height%this.unconfTX.length][i],this.unconfTX[height%this.unconfTX.length][i]=0;for(var j=0;j<this.curBlockConf.length;j++)this.curBlockConf[j][i]=0;this.curBlockTX[i]=0,this.curBlockVal[i]=0}},ConfirmStats.prototype.record=function(blocks,val){if(!(blocks<1)){for(var bucketIndex=this.bucketMap.search(val),i=blocks;i<=this.curBlockConf.length;i++)this.curBlockConf[i-1][bucketIndex]++;this.curBlockTX[bucketIndex]++,this.curBlockVal[bucketIndex]+=val}},ConfirmStats.prototype.updateAverages=function(){for(var i=0;i<this.buckets.length;i++){for(var j=0;j<this.confAvg.length;j++)this.confAvg[j][i]=this.confAvg[j][i]*this.decay+this.curBlockConf[j][i];this.avg[i]=this.avg[i]*this.decay+this.curBlockVal[i],this.txAvg[i]=this.txAvg[i]*this.decay+this.curBlockTX[i]}},ConfirmStats.prototype.estimateMedian=function(target,needed,breakpoint,greater,height){for(var max=this.buckets.length-1,start=greater?max:0,step=greater?-1:1,bins=this.unconfTX.length,conf=0,total=0,extra=0,near=start,far=start,bestNear=start,bestFar=start,found=!1,median=-1,sum=0,i=start;i>=0&&i<=max;i+=step){far=i,conf+=this.confAvg[target-1][i],total+=this.txAvg[i];for(var j=target;j<this.maxConfirms;j++)extra+=this.unconfTX[Math.max(height-j,0)%bins][i];if(extra+=this.oldUnconfTX[i],total>=needed/(1-this.decay)){var perc=conf/(total+extra);if(greater&&perc<breakpoint)break;if(!greater&&perc>breakpoint)break;found=!0,conf=0,total=0,extra=0,bestNear=near,bestFar=far,near=i+step}}for(var minBucket=bestNear<bestFar?bestNear:bestFar,maxBucket=bestNear>bestFar?bestNear:bestFar,_i2=minBucket;_i2<=maxBucket;_i2++)sum+=this.txAvg[_i2];if(found&&0!==sum){sum/=2;for(var _j=minBucket;_j<=maxBucket;_j++){if(!(this.txAvg[_j]<sum)){median=this.avg[_j]/this.txAvg[_j];break}sum-=this.txAvg[_j]}}return median},ConfirmStats.prototype.addTX=function(height,val){var bucketIndex=this.bucketMap.search(val),blockIndex=height%this.unconfTX.length;return this.unconfTX[blockIndex][bucketIndex]++,this.logger.spam("Adding tx to %s.",this.type),bucketIndex},ConfirmStats.prototype.removeTX=function(entryHeight,bestHeight,bucketIndex){var blocksAgo=bestHeight-entryHeight;if(0===bestHeight&&(blocksAgo=0),blocksAgo<0)this.logger.debug("Blocks ago is negative for mempool tx.");else if(blocksAgo>=this.unconfTX.length)this.oldUnconfTX[bucketIndex]>0?this.oldUnconfTX[bucketIndex]--:this.logger.debug("Mempool tx removed >25 blocks (bucket=%d).",bucketIndex);else{var blockIndex=entryHeight%this.unconfTX.length;this.unconfTX[blockIndex][bucketIndex]>0?this.unconfTX[blockIndex][bucketIndex]--:this.logger.debug("Mempool tx removed (block=%d, bucket=%d).",blockIndex,bucketIndex)}},ConfirmStats.prototype.getSize=function(){var size=0;size+=8,size+=sizeArray(this.buckets),size+=sizeArray(this.avg),size+=sizeArray(this.txAvg),size+=encoding.sizeVarint(this.maxConfirms);for(var i=0;i<this.maxConfirms;i++)size+=sizeArray(this.confAvg[i]);return size},ConfirmStats.prototype.toRaw=function(){var size=this.getSize(),bw=bio.write(size);bw.writeDouble(this.decay),writeArray(bw,this.buckets),writeArray(bw,this.avg),writeArray(bw,this.txAvg),bw.writeVarint(this.maxConfirms);for(var i=0;i<this.maxConfirms;i++)writeArray(bw,this.confAvg[i]);return bw.render()},ConfirmStats.prototype.fromRaw=function(data){for(var br=bio.read(data),decay=br.readDouble(),buckets=readArray(br),avg=readArray(br),txAvg=readArray(br),maxConfirms=br.readVarint(),confAvg=new Array(maxConfirms),i=0;i<maxConfirms;i++)confAvg[i]=readArray(br);if(decay<=0||decay>=1)throw new Error("Decay must be between 0 and 1 (non-inclusive).");if(buckets.length<=1||buckets.length>1e3)throw new Error("Must have between 2 and 1000 fee/pri buckets.");if(avg.length!==buckets.length)throw new Error("Mismatch in fee/pri average bucket count.");if(txAvg.length!==buckets.length)throw new Error("Mismatch in tx count bucket count.");if(maxConfirms<=0||maxConfirms>1008)throw new Error("Must maintain estimates for between 1-1008 confirms.");for(var _i3=0;_i3<maxConfirms;_i3++)if(confAvg[_i3].length!==buckets.length)throw new Error("Mismatch in fee/pri conf average bucket count.");return this.init(buckets,maxConfirms,decay),this.avg=avg,this.txAvg=txAvg,this.confAvg=confAvg,this},ConfirmStats.fromRaw=function(data,type,logger){return new this(type,logger).fromRaw(data)},ConfirmStats}(),PolicyEstimator=function(){function PolicyEstimator(logger){_classCallCheck(this,PolicyEstimator),this.logger=Logger.global,this.minTrackedFee=MIN_FEERATE,this.minTrackedPri=MIN_PRIORITY,this.feeStats=new ConfirmStats("FeeRate"),this.priStats=new ConfirmStats("Priority"),this.feeUnlikely=0,this.feeLikely=INF_FEERATE,this.priUnlikely=0,this.priLikely=INF_PRIORITY,this.map=new Map,this.bestHeight=0,policy.MIN_RELAY>=MIN_FEERATE&&(this.minTrackedFee=policy.MIN_RELAY),policy.FREE_THRESHOLD>=MIN_PRIORITY&&(this.minTrackedPri=policy.FREE_THRESHOLD),logger&&(assert("object"===(void 0===logger?"undefined":_typeof(logger))),this.logger=logger.context("fees"),this.feeStats.logger=this.logger,this.priStats.logger=this.logger)}return PolicyEstimator.prototype.init=function(){for(var minFee=this.minTrackedFee,minPri=this.minTrackedPri,fee=[],b=minFee;b<=1e6;b*=1.1)fee.push(b);fee.push(INF_FEERATE);for(var priority=[],_b=minPri;_b<=1e16;_b*=2)priority.push(_b);priority.push(INF_PRIORITY),this.feeStats.init(fee,15,.998),this.priStats.init(priority,15,.998)},PolicyEstimator.prototype.reset=function(){this.feeUnlikely=0,this.feeLikely=INF_FEERATE,this.priUnlikely=0,this.priLikely=INF_PRIORITY,this.map.clear(),this.bestHeight=0,this.init()},PolicyEstimator.prototype.removeTX=function(hash){var item=this.map.get(hash);item?(this.feeStats.removeTX(item.blockHeight,this.bestHeight,item.bucketIndex),this.map.delete(hash)):this.logger.spam("Mempool tx %s not found.",util.revHex(hash))},PolicyEstimator.prototype.isFeePoint=function(fee,priority){return priority<this.minTrackedPri&&fee>=this.minTrackedFee||priority<this.priUnlikely&&fee>this.feeLikely},PolicyEstimator.prototype.isPriPoint=function(fee,priority){return fee<this.minTrackedFee&&priority>=this.minTrackedPri||fee<this.feeUnlikely&&priority>this.priLikely},PolicyEstimator.prototype.processTX=function(entry,current){var height=entry.height,hash=entry.hash("hex");if(this.map.has(hash))this.logger.debug("Mempool tx %s already tracked.",entry.txid());else if(!(height<this.bestHeight)&&current&&!entry.dependencies){var fee=entry.getFee(),rate=entry.getRate(),priority=entry.getPriority(height);if(this.logger.spam("Processing mempool tx %s.",entry.txid()),0===fee||this.isPriPoint(rate,priority)){var item=new StatEntry;item.blockHeight=height,item.bucketIndex=this.priStats.addTX(height,priority),this.map.set(hash,item)}else if(this.isFeePoint(rate,priority)){var _item=new StatEntry;_item.blockHeight=height,_item.bucketIndex=this.feeStats.addTX(height,rate),this.map.set(hash,_item)}else this.logger.spam("Not adding tx %s.",entry.txid())}},PolicyEstimator.prototype.processBlockTX=function(height,entry){if(!entry.dependencies){var blocks=height-entry.height;if(blocks<=0)this.logger.debug("Block tx %s had negative blocks to confirm (%d, %d).",entry.txid(),height,entry.height);else{var fee=entry.getFee(),rate=entry.getRate(),priority=entry.getPriority(height);0===fee||this.isPriPoint(rate,priority)?this.priStats.record(blocks,priority):this.isFeePoint(rate,priority)&&this.feeStats.record(blocks,rate)}}},PolicyEstimator.prototype.processBlock=function(height,entries,current){if(!(height<=this.bestHeight)&&(this.bestHeight=height,0!==entries.length&&current)){this.logger.debug("Recalculating dynamic cutoffs."),this.feeLikely=this.feeStats.estimateMedian(2,1,.95,!0,height),-1===this.feeLikely&&(this.feeLikely=INF_FEERATE),this.feeUnlikely=this.feeStats.estimateMedian(10,1,.5,!1,height),-1===this.feeUnlikely&&(this.feeUnlikely=0),this.priLikely=this.priStats.estimateMedian(2,.2,.95,!0,height),-1===this.priLikely&&(this.priLikely=INF_PRIORITY),this.priUnlikely=this.priStats.estimateMedian(10,.2,.5,!1,height),-1===this.priUnlikely&&(this.priUnlikely=0),this.feeStats.clearCurrent(height),this.priStats.clearCurrent(height);var _iterator=entries,_isArray=Array.isArray(_iterator),_i4=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i4>=_iterator.length)break;_ref=_iterator[_i4++]}else{if((_i4=_iterator.next()).done)break;_ref=_i4.value}var entry=_ref;this.processBlockTX(height,entry)}this.feeStats.updateAverages(),this.priStats.updateAverages(),this.logger.debug("Done updating estimates for %d confirmed entries. New mempool map size %d.",entries.length,this.map.size),this.logger.debug("New fee rate: %d.",this.estimateFee())}},PolicyEstimator.prototype.estimateFee=function(target,smart){if(target||(target=1),null==smart&&(smart=!0),assert(target>>>0===target,"Target must be a number."),assert(target<=this.feeStats.maxConfirms,"Too many confirmations for estimate."),!smart){var _rate=this.feeStats.estimateMedian(target,1,.95,!0,this.bestHeight);return _rate<0?0:Math.floor(_rate)}for(var rate=-1;rate<0&&target<=this.feeStats.maxConfirms;)rate=this.feeStats.estimateMedian(target++,1,.95,!0,this.bestHeight);return target-=1,rate<0?0:Math.floor(rate)},PolicyEstimator.prototype.estimatePriority=function(target,smart){if(target||(target=1),null==smart&&(smart=!0),assert(target>>>0===target,"Target must be a number."),assert(target<=this.priStats.maxConfirms,"Too many confirmations for estimate."),!smart){var _priority=this.priStats.estimateMedian(target,.2,.95,!0,this.bestHeight);return Math.floor(_priority)}for(var priority=-1;priority<0&&target<=this.priStats.maxConfirms;)priority=this.priStats.estimateMedian(target++,.2,.95,!0,this.bestHeight);return target-=1,priority<0?0:Math.floor(priority)},PolicyEstimator.prototype.getSize=function(){var size=0;return size+=5,size+=encoding.sizeVarlen(this.feeStats.getSize())},PolicyEstimator.prototype.toRaw=function(){var size=this.getSize(),bw=bio.write(size);return bw.writeU8(PolicyEstimator.VERSION),bw.writeU32(this.bestHeight),bw.writeVarBytes(this.feeStats.toRaw()),bw.render()},PolicyEstimator.prototype.fromRaw=function(data){var br=bio.read(data);if(br.readU8()!==PolicyEstimator.VERSION)throw new Error("Bad serialization version for estimator.");return this.bestHeight=br.readU32(),this.feeStats.fromRaw(br.readVarBytes()),this},PolicyEstimator.fromRaw=function(data,logger){return new this(logger).fromRaw(data)},PolicyEstimator.prototype.inject=function(estimator){return this.bestHeight=estimator.bestHeight,this.feeStats=estimator.feeStats,this},PolicyEstimator}();PolicyEstimator.VERSION=0;var StatEntry=function StatEntry(){_classCallCheck(this,StatEntry),this.blockHeight=-1,this.bucketIndex=-1},DoubleMap=function(){function DoubleMap(){_classCallCheck(this,DoubleMap),this.buckets=[]}return DoubleMap.prototype.insert=function(key,value){var i=binary.search(this.buckets,key,compare,!0);this.buckets.splice(i,0,[key,value])},DoubleMap.prototype.search=function(key){assert(0!==this.buckets.length,"Cannot search.");var i=binary.search(this.buckets,key,compare,!0);return this.buckets[i][1]},DoubleMap}();function compare(a,b){return a[0]-b}function sizeArray(buckets){return encoding.sizeVarint(buckets.length)+8*buckets.length}function writeArray(bw,buckets){bw.writeVarint(buckets.length);for(var i=0;i<buckets.length;i++)bw.writeDouble(buckets[i])}function readArray(br){for(var buckets=new Float64Array(br.readVarint()),i=0;i<buckets.length;i++)buckets[i]=br.readDouble();return buckets}module.exports=PolicyEstimator},{"../protocol/consensus":84,"../protocol/policy":89,"../utils/binary":100,"../utils/util":106,assert:146,blgr:211,bufio:270}],36:[function(require,module,exports){"use strict";exports.Fees=require("./fees"),exports.layout=require("./layout"),exports.MempoolEntry=require("./mempoolentry"),exports.Mempool=require("./mempool")},{"./fees":35,"./layout":37,"./mempool":38,"./mempoolentry":39}],37:[function(require,module,exports){"use strict";var bdb=require("bdb"),layout={V:bdb.key("V"),v:bdb.key("v"),R:bdb.key("R"),F:bdb.key("F"),e:bdb.key("e",["hash256"])};module.exports=layout},{bdb:191}],38:[function(require,module,exports){(function(Buffer){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),path=require("path"),EventEmitter=require("events"),bdb=require("bdb"),RollingFilter=require("bfilter").RollingFilter,common=require("../blockchain/common"),consensus=require("../protocol/consensus"),policy=require("../protocol/policy"),util=require("../utils/util"),random=require("bcrypto/lib/random"),VerifyError=require("../protocol/errors").VerifyError,Address=require("../primitives/address"),Script=require("../script/script"),Outpoint=require("../primitives/outpoint"),TX=require("../primitives/tx"),Coin=require("../primitives/coin"),TXMeta=require("../primitives/txmeta"),MempoolEntry=require("./mempoolentry"),Network=require("../protocol/network"),layout=require("./layout"),Fees=require("./fees"),CoinView=require("../coins/coinview"),Heap=require("../utils/heap"),Mempool=function(_EventEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Mempool,_EventEmitter);function Mempool(options){_classCallCheck(this,Mempool);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return _this.opened=!1,_this.options=new MempoolOptions(options),_this.network=_this.options.network,_this.logger=_this.options.logger.context("mempool"),_this.workers=_this.options.workers,_this.chain=_this.options.chain,_this.fees=_this.options.fees,_this.locker=_this.chain.locker,_this.cache=new MempoolCache(_this.options),_this.size=0,_this.freeCount=0,_this.lastTime=0,_this.lastFlush=0,_this.tip=_this.network.genesis.hash,_this.waiting=new Map,_this.orphans=new Map,_this.map=new Map,_this.spents=new Map,_this.rejects=new RollingFilter(12e4,1e-6),_this.coinIndex=new CoinIndex,_this.txIndex=new TXIndex,_this}return Mempool.prototype.open=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var entries,_iterator,_isArray,_i,_ref2,entry,_iterator2,_isArray2,_i2,_ref3,_entry,view,fees,size;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return assert(!this.opened,"Mempool is already open."),this.opened=!0,_context.next=4,this.cache.open();case 4:if(!this.options.persistent){_context.next=49;break}return _context.next=7,this.cache.getEntries();case 7:entries=_context.sent,_iterator=entries,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();case 9:if(!_isArray){_context.next=15;break}if(!(_i>=_iterator.length)){_context.next=12;break}return _context.abrupt("break",23);case 12:_ref2=_iterator[_i++],_context.next=19;break;case 15:if(!(_i=_iterator.next()).done){_context.next=18;break}return _context.abrupt("break",23);case 18:_ref2=_i.value;case 19:entry=_ref2,this.trackEntry(entry);case 21:_context.next=9;break;case 23:_iterator2=entries,_isArray2=Array.isArray(_iterator2),_i2=0,_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();case 24:if(!_isArray2){_context.next=30;break}if(!(_i2>=_iterator2.length)){_context.next=27;break}return _context.abrupt("break",43);case 27:_ref3=_iterator2[_i2++],_context.next=34;break;case 30:if(!(_i2=_iterator2.next()).done){_context.next=33;break}return _context.abrupt("break",43);case 33:_ref3=_i2.value;case 34:if(_entry=_ref3,this.updateAncestors(_entry,addFee),!this.options.indexAddress){_context.next=41;break}return _context.next=39,this.getCoinView(_entry.tx);case 39:view=_context.sent,this.indexEntry(_entry,view);case 41:_context.next=24;break;case 43:if(this.logger.info("Loaded mempool from disk (%d entries).",entries.length),!this.fees){_context.next=49;break}return _context.next=47,this.cache.getFees();case 47:(fees=_context.sent)&&(this.fees.inject(fees),this.logger.info("Loaded mempool fee data (rate=%d).",this.fees.estimateFee()));case 49:this.tip=this.chain.tip.hash,size=(this.options.maxSize/1024).toFixed(2),this.logger.info("Mempool loaded (maxsize=%dkb).",size);case 52:case"end":return _context.stop()}},_callee,this)}));return function(){return _ref.apply(this,arguments)}}(),Mempool.prototype.close=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return assert(this.opened,"Mempool is not open."),this.opened=!1,_context2.abrupt("return",this.cache.close());case 3:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref4.apply(this,arguments)}}(),Mempool.prototype.addBlock=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(block,txs){var unlock;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,this.locker.lock();case 2:return unlock=_context3.sent,_context3.prev=3,_context3.next=6,this._addBlock(block,txs);case 6:return _context3.abrupt("return",_context3.sent);case 7:return _context3.prev=7,unlock(),_context3.finish(7);case 10:case"end":return _context3.stop()}},_callee3,this,[[3,,7,10]])}));return function(_x,_x2){return _ref5.apply(this,arguments)}}(),Mempool.prototype._addBlock=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(block,txs){var entries,i,tx,hash,entry;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(0!==this.map.size){_context4.next=3;break}return this.tip=block.hash,_context4.abrupt("return");case 3:entries=[],i=txs.length-1;case 5:if(!(i>=1)){_context4.next=22;break}if(tx=txs[i],hash=tx.hash("hex"),entry=this.getEntry(hash)){_context4.next=16;break}if(this.removeOrphan(hash),this.removeDoubleSpends(tx),!this.waiting.has(hash)){_context4.next=15;break}return _context4.next=15,this.handleOrphans(tx);case 15:return _context4.abrupt("continue",19);case 16:this.removeEntry(entry),this.emit("confirmed",tx,block),entries.push(entry);case 19:i--,_context4.next=5;break;case 22:return this.rejects.reset(),this.fees&&(this.fees.processBlock(block.height,entries,this.chain.synced),this.cache.writeFees(this.fees)),this.cache.sync(block.hash),_context4.next=27,this.cache.flush();case 27:if(this.tip=block.hash,0!==entries.length){_context4.next=30;break}return _context4.abrupt("return");case 30:this.logger.debug("Removed %d txs from mempool for block %d.",entries.length,block.height);case 31:case"end":return _context4.stop()}},_callee4,this)}));return function(_x3,_x4){return _ref6.apply(this,arguments)}}(),Mempool.prototype.removeBlock=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(block,txs){var unlock;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,this.locker.lock();case 2:return unlock=_context5.sent,_context5.prev=3,_context5.next=6,this._removeBlock(block,txs);case 6:return _context5.abrupt("return",_context5.sent);case 7:return _context5.prev=7,unlock(),_context5.finish(7);case 10:case"end":return _context5.stop()}},_callee5,this,[[3,,7,10]])}));return function(_x5,_x6){return _ref7.apply(this,arguments)}}(),Mempool.prototype._removeBlock=function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(block,txs){var total,i,tx,hash;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(0!==this.map.size){_context6.next=3;break}return this.tip=block.prevBlock,_context6.abrupt("return");case 3:total=0,i=1;case 5:if(!(i<txs.length)){_context6.next=24;break}if(tx=txs[i],hash=tx.hash("hex"),!this.hasEntry(hash)){_context6.next=10;break}return _context6.abrupt("continue",21);case 10:return _context6.prev=10,_context6.next=13,this.insertTX(tx,-1);case 13:total++,_context6.next=20;break;case 16:return _context6.prev=16,_context6.t0=_context6.catch(10),this.emit("error",_context6.t0),_context6.abrupt("continue",21);case 20:this.emit("unconfirmed",tx,block);case 21:i++,_context6.next=5;break;case 24:return this.rejects.reset(),this.cache.sync(block.prevBlock),_context6.next=28,this.cache.flush();case 28:if(this.tip=block.prevBlock,0!==total){_context6.next=31;break}return _context6.abrupt("return");case 31:this.logger.debug("Added %d txs back into the mempool for block %d.",total,block.height);case 32:case"end":return _context6.stop()}},_callee6,this,[[10,16]])}));return function(_x7,_x8){return _ref8.apply(this,arguments)}}(),Mempool.prototype._handleReorg=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(){var height,mtp,remove,_iterator3,_isArray3,_i3,_ref11,_ref10,hash,entry,tx,hasLocks,_iterator5,_isArray5,_i5,_ref14,_iterator4,_isArray4,_i4,_ref12,_hash,_entry2;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return height=this.chain.height+1,_context7.next=3,this.chain.getMedianTime(this.chain.tip);case 3:mtp=_context7.sent,remove=[],_iterator3=this.map,_isArray3=Array.isArray(_iterator3),_i3=0,_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();case 6:if(!_isArray3){_context7.next=12;break}if(!(_i3>=_iterator3.length)){_context7.next=9;break}return _context7.abrupt("break",49);case 9:_ref11=_iterator3[_i3++],_context7.next=16;break;case 12:if(!(_i3=_iterator3.next()).done){_context7.next=15;break}return _context7.abrupt("break",49);case 15:_ref11=_i3.value;case 16:if(hash=(_ref10=_ref11)[0],entry=_ref10[1],(tx=entry.tx).isFinal(height,mtp)){_context7.next=23;break}return remove.push(hash),_context7.abrupt("continue",47);case 23:if(!(tx.version>1)){_context7.next=46;break}hasLocks=!1,_iterator5=tx.inputs,_isArray5=Array.isArray(_iterator5),_i5=0,_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();case 26:if(!_isArray5){_context7.next=32;break}if(!(_i5>=_iterator5.length)){_context7.next=29;break}return _context7.abrupt("break",43);case 29:_ref14=_iterator5[_i5++],_context7.next=36;break;case 32:if(!(_i5=_iterator5.next()).done){_context7.next=35;break}return _context7.abrupt("break",43);case 35:_ref14=_i5.value;case 36:if(_ref14.sequence&consensus.SEQUENCE_DISABLE_FLAG){_context7.next=41;break}return hasLocks=!0,_context7.abrupt("break",43);case 41:_context7.next=26;break;case 43:if(!hasLocks){_context7.next=46;break}return remove.push(hash),_context7.abrupt("continue",47);case 46:entry.coinbase&&remove.push(hash);case 47:_context7.next=6;break;case 49:_iterator4=remove,_isArray4=Array.isArray(_iterator4),_i4=0,_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();case 50:if(!_isArray4){_context7.next=56;break}if(!(_i4>=_iterator4.length)){_context7.next=53;break}return _context7.abrupt("break",67);case 53:_ref12=_iterator4[_i4++],_context7.next=60;break;case 56:if(!(_i4=_iterator4.next()).done){_context7.next=59;break}return _context7.abrupt("break",67);case 59:_ref12=_i4.value;case 60:if(_hash=_ref12,_entry2=this.getEntry(_hash)){_context7.next=64;break}return _context7.abrupt("continue",65);case 64:this.evictEntry(_entry2);case 65:_context7.next=50;break;case 67:case"end":return _context7.stop()}},_callee7,this)}));return function(){return _ref9.apply(this,arguments)}}(),Mempool.prototype.reset=function(){var _ref15=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(){var unlock;return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return _context8.next=2,this.locker.lock();case 2:return unlock=_context8.sent,_context8.prev=3,_context8.next=6,this._reset();case 6:return _context8.abrupt("return",_context8.sent);case 7:return _context8.prev=7,unlock(),_context8.finish(7);case 10:case"end":return _context8.stop()}},_callee8,this,[[3,,7,10]])}));return function(){return _ref15.apply(this,arguments)}}(),Mempool.prototype._reset=function(){var _ref16=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(){return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:if(this.logger.info("Mempool reset (%d txs removed).",this.map.size),this.size=0,this.waiting.clear(),this.orphans.clear(),this.map.clear(),this.spents.clear(),this.coinIndex.reset(),this.txIndex.reset(),this.freeCount=0,this.lastTime=0,this.fees&&this.fees.reset(),this.rejects.reset(),!this.options.persistent){_context9.next=16;break}return _context9.next=15,this.cache.wipe();case 15:this.cache.clear();case 16:this.tip=this.chain.tip.hash;case 17:case"end":return _context9.stop()}},_callee9,this)}));return function(){return _ref16.apply(this,arguments)}}(),Mempool.prototype.limitSize=function(added){var maxSize=this.options.maxSize;if(this.size<=maxSize)return!1;var threshold=maxSize-maxSize/10,expiryTime=this.options.expiryTime,now=util.now(),start=util.bench(),queue=new Heap(cmpRate),_iterator6=this.map.values(),_isArray6=Array.isArray(_iterator6),_i6=0;for(_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();;){var _ref17;if(_isArray6){if(_i6>=_iterator6.length)break;_ref17=_iterator6[_i6++]}else{if((_i6=_iterator6.next()).done)break;_ref17=_i6.value}var entry=_ref17;this.hasDepends(entry.tx)||(now<entry.time+expiryTime?queue.insert(entry):(this.logger.debug("Removing package %s from mempool (too old).",entry.txid()),this.evictEntry(entry)))}if(this.size<=threshold)return!this.hasEntry(added);for(this.logger.debug("(bench) Heap mempool traversal: %d.",util.bench(start)),start=util.bench(),this.logger.debug("(bench) Heap mempool queue size: %d.",queue.size());queue.size()>0;){var _entry3=queue.shift(),hash=_entry3.hash("hex");if(assert(this.hasEntry(hash)),this.logger.debug("Removing package %s from mempool (low fee).",_entry3.txid()),this.evictEntry(_entry3),this.size<=threshold)break}return this.logger.debug("(bench) Heap mempool map removal: %d.",util.bench(start)),!this.hasEntry(added)},Mempool.prototype.getTX=function(hash){var entry=this.map.get(hash);return entry?entry.tx:null},Mempool.prototype.getEntry=function(hash){return this.map.get(hash)},Mempool.prototype.getCoin=function(hash,index){var entry=this.map.get(hash);return entry?this.isSpent(hash,index)?null:index>=entry.tx.outputs.length?null:Coin.fromTX(entry.tx,index,-1):null},Mempool.prototype.isSpent=function(hash,index){var key=Outpoint.toKey(hash,index);return this.spents.has(key)},Mempool.prototype.getSpent=function(hash,index){var key=Outpoint.toKey(hash,index);return this.spents.get(key)},Mempool.prototype.getSpentTX=function(hash,index){var key=Outpoint.toKey(hash,index),entry=this.spents.get(key);return entry?entry.tx:null},Mempool.prototype.getCoinsByAddress=function(addrs){Array.isArray(addrs)||(addrs=[addrs]);var out=[],_iterator7=addrs,_isArray7=Array.isArray(_iterator7),_i7=0;for(_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();;){var _ref18;if(_isArray7){if(_i7>=_iterator7.length)break;_ref18=_iterator7[_i7++]}else{if((_i7=_iterator7.next()).done)break;_ref18=_i7.value}var addr=_ref18,hash=Address.getHash(addr,"hex"),_iterator8=this.coinIndex.get(hash),_isArray8=Array.isArray(_iterator8),_i8=0;for(_iterator8=_isArray8?_iterator8:_iterator8[Symbol.iterator]();;){var _ref19;if(_isArray8){if(_i8>=_iterator8.length)break;_ref19=_iterator8[_i8++]}else{if((_i8=_iterator8.next()).done)break;_ref19=_i8.value}var coin=_ref19;out.push(coin)}}return out},Mempool.prototype.getTXByAddress=function(addrs){Array.isArray(addrs)||(addrs=[addrs]);var out=[],_iterator9=addrs,_isArray9=Array.isArray(_iterator9),_i9=0;for(_iterator9=_isArray9?_iterator9:_iterator9[Symbol.iterator]();;){var _ref20;if(_isArray9){if(_i9>=_iterator9.length)break;_ref20=_iterator9[_i9++]}else{if((_i9=_iterator9.next()).done)break;_ref20=_i9.value}var addr=_ref20,hash=Address.getHash(addr,"hex"),_iterator10=this.txIndex.get(hash),_isArray10=Array.isArray(_iterator10),_i10=0;for(_iterator10=_isArray10?_iterator10:_iterator10[Symbol.iterator]();;){var _ref21;if(_isArray10){if(_i10>=_iterator10.length)break;_ref21=_iterator10[_i10++]}else{if((_i10=_iterator10.next()).done)break;_ref21=_i10.value}var tx=_ref21;out.push(tx)}}return out},Mempool.prototype.getMetaByAddress=function(addrs){Array.isArray(addrs)||(addrs=[addrs]);var out=[],_iterator11=addrs,_isArray11=Array.isArray(_iterator11),_i11=0;for(_iterator11=_isArray11?_iterator11:_iterator11[Symbol.iterator]();;){var _ref22;if(_isArray11){if(_i11>=_iterator11.length)break;_ref22=_iterator11[_i11++]}else{if((_i11=_iterator11.next()).done)break;_ref22=_i11.value}var addr=_ref22,hash=Address.getHash(addr,"hex"),_iterator12=this.txIndex.getMeta(hash),_isArray12=Array.isArray(_iterator12),_i12=0;for(_iterator12=_isArray12?_iterator12:_iterator12[Symbol.iterator]();;){var _ref23;if(_isArray12){if(_i12>=_iterator12.length)break;_ref23=_iterator12[_i12++]}else{if((_i12=_iterator12.next()).done)break;_ref23=_i12.value}var tx=_ref23;out.push(tx)}}return out},Mempool.prototype.getMeta=function(hash){var entry=this.getEntry(hash);if(!entry)return null;var meta=TXMeta.fromTX(entry.tx);return meta.mtime=entry.time,meta},Mempool.prototype.hasEntry=function(hash){return this.map.has(hash)},Mempool.prototype.has=function(hash){return!!this.locker.has(hash)||(!!this.hasOrphan(hash)||this.hasEntry(hash))},Mempool.prototype.exists=function(hash){return!!this.locker.pending(hash)||(!!this.hasOrphan(hash)||this.hasEntry(hash))},Mempool.prototype.hasReject=function(hash){return this.rejects.test(hash,"hex")},Mempool.prototype.addTX=function(){var _ref24=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(tx,id){var hash,unlock;return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return hash=tx.hash("hex"),_context10.next=3,this.locker.lock(hash);case 3:return unlock=_context10.sent,_context10.prev=4,_context10.next=7,this._addTX(tx,id);case 7:return _context10.abrupt("return",_context10.sent);case 8:return _context10.prev=8,unlock(),_context10.finish(8);case 11:case"end":return _context10.stop()}},_callee10,this,[[4,,8,11]])}));return function(_x9,_x10){return _ref24.apply(this,arguments)}}(),Mempool.prototype._addTX=function(){var _ref25=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(tx,id){var missing;return regeneratorRuntime.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:return null==id&&(id=-1),missing=void 0,_context11.prev=2,_context11.next=5,this.insertTX(tx,id);case 5:missing=_context11.sent,_context11.next=12;break;case 8:throw _context11.prev=8,_context11.t0=_context11.catch(2),"VerifyError"===_context11.t0.type&&(tx.hasWitness()||_context11.t0.malleated||this.rejects.add(tx.hash())),_context11.t0;case 12:if(!(util.now()-this.lastFlush>10)){_context11.next=16;break}return _context11.next=15,this.cache.flush();case 15:this.lastFlush=util.now();case 16:return _context11.abrupt("return",missing);case 17:case"end":return _context11.stop()}},_callee11,this,[[2,8]])}));return function(_x11,_x12){return _ref25.apply(this,arguments)}}(),Mempool.prototype.insertTX=function(){var _ref26=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(tx,id){var lockFlags,height,hash,_tx$checkSanity,valid,reason,score,_tx$checkStandard,_valid,_reason,_score,view,missing,entry;return regeneratorRuntime.wrap(function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:if(assert(!tx.mutable,"Cannot add mutable TX to mempool."),lockFlags=common.lockFlags.STANDARD_LOCKTIME_FLAGS,height=this.chain.height,hash=tx.hash("hex"),_tx$checkSanity=tx.checkSanity(),valid=_tx$checkSanity[0],reason=_tx$checkSanity[1],score=_tx$checkSanity[2],valid){_context12.next=7;break}throw new VerifyError(tx,"invalid",reason,score);case 7:if(!tx.isCoinbase()){_context12.next=9;break}throw new VerifyError(tx,"invalid","coinbase",100);case 9:if(!this.options.requireStandard){_context12.next=12;break}if(this.chain.state.hasCSV()||!(tx.version>=2)){_context12.next=12;break}throw new VerifyError(tx,"nonstandard","premature-version2-tx",0);case 12:if(!this.options.requireStandard){_context12.next=16;break}if(_tx$checkStandard=tx.checkStandard(),_valid=_tx$checkStandard[0],_reason=_tx$checkStandard[1],_score=_tx$checkStandard[2],_valid){_context12.next=16;break}throw new VerifyError(tx,"nonstandard",_reason,_score);case 16:return _context12.next=18,this.verifyFinal(tx,lockFlags);case 18:if(_context12.sent){_context12.next=20;break}throw new VerifyError(tx,"nonstandard","non-final",0);case 20:if(!this.exists(hash)){_context12.next=22;break}throw new VerifyError(tx,"alreadyknown","txn-already-in-mempool",0);case 22:return _context12.next=24,this.chain.hasCoins(tx);case 24:if(!_context12.sent){_context12.next=26;break}throw new VerifyError(tx,"alreadyknown","txn-already-known",0);case 26:if(!this.isDoubleSpend(tx)){_context12.next=29;break}throw this.emit("conflict",tx),new VerifyError(tx,"duplicate","bad-txns-inputs-spent",0);case 29:return _context12.next=31,this.getCoinView(tx);case 31:if(view=_context12.sent,!(missing=this.maybeOrphan(tx,view,id))){_context12.next=35;break}return _context12.abrupt("return",missing);case 35:return entry=MempoolEntry.fromTX(tx,view,height),_context12.next=38,this.verify(entry,view);case 38:return _context12.next=40,this.addEntry(entry,view);case 40:if(!this.limitSize(hash)){_context12.next=42;break}throw new VerifyError(tx,"insufficientfee","mempool full",0);case 42:return _context12.abrupt("return",null);case 43:case"end":return _context12.stop()}},_callee12,this)}));return function(_x13,_x14){return _ref26.apply(this,arguments)}}(),Mempool.prototype.verify=function(){var _ref27=_asyncToGenerator(regeneratorRuntime.mark(function _callee13(entry,view){var height,lockFlags,tx,minFee,now,_tx$checkInputs,fee,reason,score,flags,_flags;return regeneratorRuntime.wrap(function(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:return height=this.chain.height+1,lockFlags=common.lockFlags.STANDARD_LOCKTIME_FLAGS,tx=entry.tx,_context13.next=5,this.verifyLocks(tx,view,lockFlags);case 5:if(_context13.sent){_context13.next=7;break}throw new VerifyError(tx,"nonstandard","non-BIP68-final",0);case 7:if(!this.options.requireStandard){_context13.next=10;break}if(tx.hasStandardInputs(view)){_context13.next=10;break}throw new VerifyError(tx,"nonstandard","bad-txns-nonstandard-inputs",0);case 10:if(!(entry.sigops>policy.MAX_TX_SIGOPS)){_context13.next=12;break}throw new VerifyError(tx,"nonstandard","bad-txns-too-many-sigops",0);case 12:if(minFee=policy.getMinFee(entry.size,this.options.minRelay),!(this.options.relayPriority&&entry.fee<minFee)){_context13.next=16;break}if(entry.isFree(height)){_context13.next=16;break}throw new VerifyError(tx,"insufficientfee","insufficient priority",0);case 16:if(!(this.options.limitFree&&entry.fee<minFee)){_context13.next=23;break}if(now=util.now(),this.freeCount*=Math.pow(1-1/600,now-this.lastTime),this.lastTime=now,!(this.freeCount>10*this.options.limitFreeRelay*1e3)){_context13.next=22;break}throw new VerifyError(tx,"insufficientfee","rate limited free transaction",0);case 22:this.freeCount+=entry.size;case 23:if(!(this.options.rejectAbsurdFees&&entry.fee>1e4*minFee)){_context13.next=25;break}throw new VerifyError(tx,"highfee","absurdly-high-fee",0);case 25:if(!(this.countAncestors(entry)+1>this.options.maxAncestors)){_context13.next=27;break}throw new VerifyError(tx,"nonstandard","too-long-mempool-chain",0);case 27:if(_tx$checkInputs=tx.checkInputs(view,height),fee=_tx$checkInputs[0],reason=_tx$checkInputs[1],score=_tx$checkInputs[2],-1!==fee){_context13.next=30;break}throw new VerifyError(tx,"invalid",reason,score);case 30:return flags=Script.flags.STANDARD_VERIFY_FLAGS,_context13.prev=31,_context13.next=34,this.verifyInputs(tx,view,flags);case 34:_context13.next=52;break;case 36:if(_context13.prev=36,_context13.t0=_context13.catch(31),!tx.hasWitness()){_context13.next=40;break}throw _context13.t0;case 40:return flags&=~Script.flags.VERIFY_CLEANSTACK,_context13.next=43,this.verifyResult(tx,view,flags);case 43:if(_context13.sent){_context13.next=45;break}throw _context13.t0;case 45:return flags|=Script.flags.VERIFY_CLEANSTACK,_context13.next=48,this.verifyResult(tx,view,flags);case 48:if(!_context13.sent){_context13.next=50;break}throw _context13.t0;case 50:throw _context13.t0.malleated=!0,_context13.t0;case 52:if(!this.options.paranoidChecks){_context13.next=59;break}return _flags=Script.flags.MANDATORY_VERIFY_FLAGS,_context13.t1=assert,_context13.next=57,this.verifyResult(tx,view,_flags);case 57:_context13.t2=_context13.sent,(0,_context13.t1)(_context13.t2,"BUG: Verify failed for mandatory but not standard.");case 59:case"end":return _context13.stop()}},_callee13,this,[[31,36]])}));return function(_x15,_x16){return _ref27.apply(this,arguments)}}(),Mempool.prototype.verifyResult=function(){var _ref28=_asyncToGenerator(regeneratorRuntime.mark(function _callee14(tx,view,flags){return regeneratorRuntime.wrap(function(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:return _context14.prev=0,_context14.next=3,this.verifyInputs(tx,view,flags);case 3:_context14.next=10;break;case 5:if(_context14.prev=5,_context14.t0=_context14.catch(0),"VerifyError"!==_context14.t0.type){_context14.next=9;break}return _context14.abrupt("return",!1);case 9:throw _context14.t0;case 10:return _context14.abrupt("return",!0);case 11:case"end":return _context14.stop()}},_callee14,this,[[0,5]])}));return function(_x17,_x18,_x19){return _ref28.apply(this,arguments)}}(),Mempool.prototype.verifyInputs=function(){var _ref29=_asyncToGenerator(regeneratorRuntime.mark(function _callee15(tx,view,flags){return regeneratorRuntime.wrap(function(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:return _context15.next=2,tx.verifyAsync(view,flags,this.workers);case 2:if(!_context15.sent){_context15.next=4;break}return _context15.abrupt("return");case 4:if(!(flags&Script.flags.ONLY_STANDARD_VERIFY_FLAGS)){_context15.next=10;break}return flags&=~Script.flags.ONLY_STANDARD_VERIFY_FLAGS,_context15.next=8,tx.verifyAsync(view,flags,this.workers);case 8:if(!_context15.sent){_context15.next=10;break}throw new VerifyError(tx,"nonstandard","non-mandatory-script-verify-flag",0);case 10:throw new VerifyError(tx,"nonstandard","mandatory-script-verify-flag",100);case 11:case"end":return _context15.stop()}},_callee15,this)}));return function(_x20,_x21,_x22){return _ref29.apply(this,arguments)}}(),Mempool.prototype.addEntry=function(){var _ref30=_asyncToGenerator(regeneratorRuntime.mark(function _callee16(entry,view){var tx;return regeneratorRuntime.wrap(function(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:return tx=entry.tx,this.trackEntry(entry,view),this.updateAncestors(entry,addFee),this.emit("tx",tx,view),this.emit("add entry",entry),this.fees&&this.fees.processTX(entry,this.chain.synced),this.logger.debug("Added %s to mempool (txs=%d).",tx.txid(),this.map.size),this.cache.save(entry),_context16.next=10,this.handleOrphans(tx);case 10:case"end":return _context16.stop()}},_callee16,this)}));return function(_x23,_x24){return _ref30.apply(this,arguments)}}(),Mempool.prototype.removeEntry=function(entry){var tx=entry.tx,hash=tx.hash("hex");this.untrackEntry(entry),this.fees&&this.fees.removeTX(hash),this.cache.remove(tx.hash()),this.emit("remove entry",entry)},Mempool.prototype.evictEntry=function(entry){this.removeSpenders(entry),this.updateAncestors(entry,removeFee),this.removeEntry(entry)},Mempool.prototype.removeSpenders=function(entry){for(var tx=entry.tx,hash=tx.hash("hex"),i=0;i<tx.outputs.length;i++){var spender=this.getSpent(hash,i);spender&&(this.removeSpenders(spender),this.removeEntry(spender))}},Mempool.prototype.countAncestors=function(entry){return this._countAncestors(entry,new Set,entry,nop)},Mempool.prototype.updateAncestors=function(entry,map){return this._countAncestors(entry,new Set,entry,map)},Mempool.prototype._countAncestors=function(entry,set,child,map){var _iterator13=entry.tx.inputs,_isArray13=Array.isArray(_iterator13),_i13=0;for(_iterator13=_isArray13?_iterator13:_iterator13[Symbol.iterator]();;){var _ref32;if(_isArray13){if(_i13>=_iterator13.length)break;_ref32=_iterator13[_i13++]}else{if((_i13=_iterator13.next()).done)break;_ref32=_i13.value}var hash=_ref32.prevout.hash,parent=this.getEntry(hash);if(parent&&!set.has(hash)){if(set.add(hash),map(parent,child),set.size>this.options.maxAncestors)break;if(this._countAncestors(parent,set,child,map),set.size>this.options.maxAncestors)break}}return set.size},Mempool.prototype.countDescendants=function(entry){return this._countDescendants(entry,new Set)},Mempool.prototype._countDescendants=function(entry,set){for(var tx=entry.tx,hash=tx.hash("hex"),i=0;i<tx.outputs.length;i++){var child=this.getSpent(hash,i);if(child){var next=child.hash("hex");set.has(next)||(set.add(next),this._countDescendants(child,set))}}return set.size},Mempool.prototype.getAncestors=function(entry){return this._getAncestors(entry,[],new Set)},Mempool.prototype._getAncestors=function(entry,entries,set){var _iterator14=entry.tx.inputs,_isArray14=Array.isArray(_iterator14),_i14=0;for(_iterator14=_isArray14?_iterator14:_iterator14[Symbol.iterator]();;){var _ref34;if(_isArray14){if(_i14>=_iterator14.length)break;_ref34=_iterator14[_i14++]}else{if((_i14=_iterator14.next()).done)break;_ref34=_i14.value}var hash=_ref34.prevout.hash,parent=this.getEntry(hash);parent&&(set.has(hash)||(set.add(hash),entries.push(parent),this._getAncestors(parent,entries,set)))}return entries},Mempool.prototype.getDescendants=function(entry){return this._getDescendants(entry,[],new Set)},Mempool.prototype._getDescendants=function(entry,entries,set){for(var tx=entry.tx,hash=tx.hash("hex"),i=0;i<tx.outputs.length;i++){var child=this.getSpent(hash,i);if(child){var next=child.hash("hex");set.has(next)||(set.add(next),entries.push(child),this._getDescendants(child,entries,set))}}return entries},Mempool.prototype.getDepends=function(tx){var depends=[],_iterator15=tx.getPrevout(),_isArray15=Array.isArray(_iterator15),_i15=0;for(_iterator15=_isArray15?_iterator15:_iterator15[Symbol.iterator]();;){var _ref35;if(_isArray15){if(_i15>=_iterator15.length)break;_ref35=_iterator15[_i15++]}else{if((_i15=_iterator15.next()).done)break;_ref35=_i15.value}var hash=_ref35;this.hasEntry(hash)&&depends.push(hash)}return depends},Mempool.prototype.hasDepends=function(tx){var _iterator16=tx.inputs,_isArray16=Array.isArray(_iterator16),_i16=0;for(_iterator16=_isArray16?_iterator16:_iterator16[Symbol.iterator]();;){var _ref37;if(_isArray16){if(_i16>=_iterator16.length)break;_ref37=_iterator16[_i16++]}else{if((_i16=_iterator16.next()).done)break;_ref37=_i16.value}var prevout=_ref37.prevout;if(this.hasEntry(prevout.hash))return!0}return!1},Mempool.prototype.getBalance=function(){var total=0,_iterator17=this.map,_isArray17=Array.isArray(_iterator17),_i17=0;for(_iterator17=_isArray17?_iterator17:_iterator17[Symbol.iterator]();;){var _ref39;if(_isArray17){if(_i17>=_iterator17.length)break;_ref39=_iterator17[_i17++]}else{if((_i17=_iterator17.next()).done)break;_ref39=_i17.value}for(var _ref38=_ref39,hash=_ref38[0],tx=_ref38[1].tx,i=0;i<tx.outputs.length;i++){var coin=this.getCoin(hash,i);coin&&(total+=coin.value)}}return total},Mempool.prototype.getHistory=function(){var txs=[],_iterator18=this.map.values(),_isArray18=Array.isArray(_iterator18),_i18=0;for(_iterator18=_isArray18?_iterator18:_iterator18[Symbol.iterator]();;){var _ref40;if(_isArray18){if(_i18>=_iterator18.length)break;_ref40=_iterator18[_i18++]}else{if((_i18=_iterator18.next()).done)break;_ref40=_i18.value}var entry=_ref40;txs.push(entry.tx)}return txs},Mempool.prototype.getOrphan=function(hash){return this.orphans.get(hash)},Mempool.prototype.hasOrphan=function(hash){return this.orphans.has(hash)},Mempool.prototype.maybeOrphan=function(tx,view,id){var hashes=new Set,missing=[],_iterator19=tx.inputs,_isArray19=Array.isArray(_iterator19),_i19=0;for(_iterator19=_isArray19?_iterator19:_iterator19[Symbol.iterator]();;){var _ref42;if(_isArray19){if(_i19>=_iterator19.length)break;_ref42=_iterator19[_i19++]}else{if((_i19=_iterator19.next()).done)break;_ref42=_i19.value}var prevout=_ref42.prevout;if(!view.hasEntry(prevout)){if(this.hasReject(prevout.hash))return this.logger.debug("Not storing orphan %s (rejected parents).",tx.txid()),this.rejects.add(tx.hash()),missing;if(this.hasEntry(prevout.hash))return this.logger.debug("Not storing orphan %s (non-existent output).",tx.txid()),this.rejects.add(tx.hash()),missing;hashes.add(prevout.hash)}}if(0===hashes.size)return null;if(tx.getWeight()>policy.MAX_TX_WEIGHT)return this.logger.debug("Ignoring large orphan: %s",tx.txid()),tx.hasWitness()||this.rejects.add(tx.hash()),missing;if(0===this.options.maxOrphans)return missing;this.limitOrphans();var hash=tx.hash("hex"),_iterator20=hashes.keys(),_isArray20=Array.isArray(_iterator20),_i20=0;for(_iterator20=_isArray20?_iterator20:_iterator20[Symbol.iterator]();;){var _ref43;if(_isArray20){if(_i20>=_iterator20.length)break;_ref43=_iterator20[_i20++]}else{if((_i20=_iterator20.next()).done)break;_ref43=_i20.value}var prev=_ref43;this.waiting.has(prev)||this.waiting.set(prev,new Set),this.waiting.get(prev).add(hash),missing.push(prev)}return this.orphans.set(hash,new Orphan(tx,missing.length,id)),this.logger.debug("Added orphan %s to mempool.",tx.txid()),this.emit("add orphan",tx),missing},Mempool.prototype.handleOrphans=function(){var _ref44=_asyncToGenerator(regeneratorRuntime.mark(function _callee17(parent){var resolved,_iterator21,_isArray21,_i21,_ref45,orphan,tx,missing;return regeneratorRuntime.wrap(function(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:resolved=this.resolveOrphans(parent),_iterator21=resolved,_isArray21=Array.isArray(_iterator21),_i21=0,_iterator21=_isArray21?_iterator21:_iterator21[Symbol.iterator]();case 2:if(!_isArray21){_context17.next=8;break}if(!(_i21>=_iterator21.length)){_context17.next=5;break}return _context17.abrupt("break",43);case 5:_ref45=_iterator21[_i21++],_context17.next=12;break;case 8:if(!(_i21=_iterator21.next()).done){_context17.next=11;break}return _context17.abrupt("break",43);case 11:_ref45=_i21.value;case 12:orphan=_ref45,tx=void 0,missing=void 0,_context17.prev=14,tx=orphan.toTX(),_context17.next=22;break;case 18:return _context17.prev=18,_context17.t0=_context17.catch(14),this.logger.warning("%s %s","Warning: possible memory corruption.","Orphan failed deserialization."),_context17.abrupt("continue",41);case 22:return _context17.prev=22,_context17.next=25,this.insertTX(tx,orphan.id);case 25:missing=_context17.sent,_context17.next=36;break;case 28:if(_context17.prev=28,_context17.t1=_context17.catch(22),"VerifyError"!==_context17.t1.type){_context17.next=35;break}return this.logger.debug("Could not resolve orphan %s: %s.",tx.txid(),_context17.t1.message),tx.hasWitness()||_context17.t1.malleated||this.rejects.add(tx.hash()),this.emit("bad orphan",_context17.t1,orphan.id),_context17.abrupt("continue",41);case 35:throw _context17.t1;case 36:if(!(missing&&missing.length>0)){_context17.next=40;break}return this.logger.debug("Transaction %s was double-orphaned in mempool.",tx.txid()),this.removeOrphan(tx.hash("hex")),_context17.abrupt("continue",41);case 40:this.logger.debug("Resolved orphan %s in mempool.",tx.txid());case 41:_context17.next=2;break;case 43:case"end":return _context17.stop()}},_callee17,this,[[14,18],[22,28]])}));return function(_x25){return _ref44.apply(this,arguments)}}(),Mempool.prototype.resolveOrphans=function(parent){var hash=parent.hash("hex"),set=this.waiting.get(hash);if(!set)return[];assert(set.size>0);var resolved=[],_iterator22=set.keys(),_isArray22=Array.isArray(_iterator22),_i22=0;for(_iterator22=_isArray22?_iterator22:_iterator22[Symbol.iterator]();;){var _ref46;if(_isArray22){if(_i22>=_iterator22.length)break;_ref46=_iterator22[_i22++]}else{if((_i22=_iterator22.next()).done)break;_ref46=_i22.value}var _hash2=_ref46,orphan=this.getOrphan(_hash2);assert(orphan),0==--orphan.missing&&(this.orphans.delete(_hash2),resolved.push(orphan))}return this.waiting.delete(hash),resolved},Mempool.prototype.removeOrphan=function(hash){var orphan=this.getOrphan(hash);if(!orphan)return!1;var tx=void 0;try{tx=orphan.toTX()}catch(e){return this.orphans.delete(hash),this.logger.warning("%s %s","Warning: possible memory corruption.","Orphan failed deserialization."),!1}var _iterator23=tx.getPrevout(),_isArray23=Array.isArray(_iterator23),_i23=0;for(_iterator23=_isArray23?_iterator23:_iterator23[Symbol.iterator]();;){var _ref47;if(_isArray23){if(_i23>=_iterator23.length)break;_ref47=_iterator23[_i23++]}else{if((_i23=_iterator23.next()).done)break;_ref47=_i23.value}var prev=_ref47,set=this.waiting.get(prev);set&&(assert(set.has(hash)),set.delete(hash),0===set.size&&this.waiting.delete(prev))}return this.orphans.delete(hash),this.emit("remove orphan",tx),!0},Mempool.prototype.limitOrphans=function(){if(this.orphans.size<this.options.maxOrphans)return!1;var index=random.randomRange(0,this.orphans.size),hash=void 0,_iterator24=this.orphans.keys(),_isArray24=Array.isArray(_iterator24),_i24=0;for(_iterator24=_isArray24?_iterator24:_iterator24[Symbol.iterator]();;){if(_isArray24){if(_i24>=_iterator24.length)break;hash=_iterator24[_i24++]}else{if((_i24=_iterator24.next()).done)break;hash=_i24.value}if(0===index)break;index--}return assert(hash),this.logger.debug("Removing orphan %s from mempool.",util.revHex(hash)),this.removeOrphan(hash),!0},Mempool.prototype.isDoubleSpend=function(tx){var _iterator25=tx.inputs,_isArray25=Array.isArray(_iterator25),_i25=0;for(_iterator25=_isArray25?_iterator25:_iterator25[Symbol.iterator]();;){var _ref49;if(_isArray25){if(_i25>=_iterator25.length)break;_ref49=_iterator25[_i25++]}else{if((_i25=_iterator25.next()).done)break;_ref49=_i25.value}var prevout=_ref49.prevout,hash=prevout.hash,index=prevout.index;if(this.isSpent(hash,index))return!0}return!1},Mempool.prototype.getSpentView=function(){var _ref50=_asyncToGenerator(regeneratorRuntime.mark(function _callee18(tx){var unlock;return regeneratorRuntime.wrap(function(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:return _context18.next=2,this.locker.lock();case 2:return unlock=_context18.sent,_context18.prev=3,_context18.next=6,this.getCoinView(tx);case 6:return _context18.abrupt("return",_context18.sent);case 7:return _context18.prev=7,unlock(),_context18.finish(7);case 10:case"end":return _context18.stop()}},_callee18,this,[[3,,7,10]])}));return function(_x26){return _ref50.apply(this,arguments)}}(),Mempool.prototype.getCoinView=function(){var _ref51=_asyncToGenerator(regeneratorRuntime.mark(function _callee19(tx){var view,_iterator26,_isArray26,_i26,_ref53,prevout,hash,index,_tx,coin;return regeneratorRuntime.wrap(function(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:view=new CoinView,_iterator26=tx.inputs,_isArray26=Array.isArray(_iterator26),_i26=0,_iterator26=_isArray26?_iterator26:_iterator26[Symbol.iterator]();case 2:if(!_isArray26){_context19.next=8;break}if(!(_i26>=_iterator26.length)){_context19.next=5;break}return _context19.abrupt("break",25);case 5:_ref53=_iterator26[_i26++],_context19.next=12;break;case 8:if(!(_i26=_iterator26.next()).done){_context19.next=11;break}return _context19.abrupt("break",25);case 11:_ref53=_i26.value;case 12:if(prevout=_ref53.prevout,hash=prevout.hash,index=prevout.index,!(_tx=this.getTX(hash))){_context19.next=19;break}return index<_tx.outputs.length&&view.addIndex(_tx,index,-1),_context19.abrupt("continue",23);case 19:return _context19.next=21,this.chain.readCoin(prevout);case 21:(coin=_context19.sent)&&view.addEntry(prevout,coin);case 23:_context19.next=2;break;case 25:return _context19.abrupt("return",view);case 26:case"end":return _context19.stop()}},_callee19,this)}));return function(_x27){return _ref51.apply(this,arguments)}}(),Mempool.prototype.getSnapshot=function(){var keys=[],_iterator27=this.map.keys(),_isArray27=Array.isArray(_iterator27),_i27=0;for(_iterator27=_isArray27?_iterator27:_iterator27[Symbol.iterator]();;){var _ref54;if(_isArray27){if(_i27>=_iterator27.length)break;_ref54=_iterator27[_i27++]}else{if((_i27=_iterator27.next()).done)break;_ref54=_i27.value}var hash=_ref54;keys.push(hash)}return keys},Mempool.prototype.verifyLocks=function(tx,view,flags){return this.chain.verifyLocks(this.chain.tip,tx,view,flags)},Mempool.prototype.verifyFinal=function(tx,flags){return this.chain.verifyFinal(this.chain.tip,tx,flags)},Mempool.prototype.trackEntry=function(entry,view){var tx=entry.tx,hash=tx.hash("hex");assert(!this.map.has(hash)),this.map.set(hash,entry),assert(!tx.isCoinbase());var _iterator28=tx.inputs,_isArray28=Array.isArray(_iterator28),_i28=0;for(_iterator28=_isArray28?_iterator28:_iterator28[Symbol.iterator]();;){var _ref56;if(_isArray28){if(_i28>=_iterator28.length)break;_ref56=_iterator28[_i28++]}else{if((_i28=_iterator28.next()).done)break;_ref56=_i28.value}var key=_ref56.prevout.toKey();this.spents.set(key,entry)}this.options.indexAddress&&view&&this.indexEntry(entry,view),this.size+=entry.memUsage()},Mempool.prototype.untrackEntry=function(entry){var tx=entry.tx,hash=tx.hash("hex");assert(this.map.has(hash)),this.map.delete(hash),assert(!tx.isCoinbase());var _iterator29=tx.inputs,_isArray29=Array.isArray(_iterator29),_i29=0;for(_iterator29=_isArray29?_iterator29:_iterator29[Symbol.iterator]();;){var _ref58;if(_isArray29){if(_i29>=_iterator29.length)break;_ref58=_iterator29[_i29++]}else{if((_i29=_iterator29.next()).done)break;_ref58=_i29.value}var key=_ref58.prevout.toKey();this.spents.delete(key)}this.options.indexAddress&&this.unindexEntry(entry),this.size-=entry.memUsage()},Mempool.prototype.indexEntry=function(entry,view){var tx=entry.tx;this.txIndex.insert(entry,view);var _iterator30=tx.inputs,_isArray30=Array.isArray(_iterator30),_i30=0;for(_iterator30=_isArray30?_iterator30:_iterator30[Symbol.iterator]();;){var _ref60;if(_isArray30){if(_i30>=_iterator30.length)break;_ref60=_iterator30[_i30++]}else{if((_i30=_iterator30.next()).done)break;_ref60=_i30.value}var prevout=_ref60.prevout,hash=prevout.hash,index=prevout.index;this.coinIndex.remove(hash,index)}for(var i=0;i<tx.outputs.length;i++)this.coinIndex.insert(tx,i)},Mempool.prototype.unindexEntry=function(entry){var tx=entry.tx,hash=tx.hash("hex");this.txIndex.remove(hash);var _iterator31=tx.inputs,_isArray31=Array.isArray(_iterator31),_i31=0;for(_iterator31=_isArray31?_iterator31:_iterator31[Symbol.iterator]();;){var _ref62;if(_isArray31){if(_i31>=_iterator31.length)break;_ref62=_iterator31[_i31++]}else{if((_i31=_iterator31.next()).done)break;_ref62=_i31.value}var prevout=_ref62.prevout,_hash3=prevout.hash,index=prevout.index,prev=this.getTX(_hash3);prev&&this.coinIndex.insert(prev,index)}for(var i=0;i<tx.outputs.length;i++)this.coinIndex.remove(hash,i)},Mempool.prototype.removeDoubleSpends=function(tx){var _iterator32=tx.inputs,_isArray32=Array.isArray(_iterator32),_i32=0;for(_iterator32=_isArray32?_iterator32:_iterator32[Symbol.iterator]();;){var _ref64;if(_isArray32){if(_i32>=_iterator32.length)break;_ref64=_iterator32[_i32++]}else{if((_i32=_iterator32.next()).done)break;_ref64=_i32.value}var prevout=_ref64.prevout,hash=prevout.hash,index=prevout.index,spent=this.getSpent(hash,index);spent&&(this.logger.debug("Removing double spender from mempool: %s.",spent.txid()),this.evictEntry(spent),this.emit("double spend",spent))}},Mempool.prototype.getSize=function(){return this.size},Mempool.prototype.prioritise=function(entry,pri,fee){-pri>entry.priority&&(pri=-entry.priority),entry.priority+=pri,-fee>entry.deltaFee&&(fee=-entry.deltaFee),0!==fee&&(this.updateAncestors(entry,prePrioritise),entry.deltaFee+=fee,entry.descFee+=fee,this.updateAncestors(entry,postPrioritise))},Mempool}(EventEmitter),MempoolOptions=function(){function MempoolOptions(options){_classCallCheck(this,MempoolOptions),this.network=Network.primary,this.chain=null,this.logger=null,this.workers=null,this.fees=null,this.limitFree=!0,this.limitFreeRelay=15,this.relayPriority=!0,this.requireStandard=this.network.requireStandard,this.rejectAbsurdFees=!0,this.prematureWitness=!1,this.paranoidChecks=!1,this.replaceByFee=!1,this.maxSize=policy.MEMPOOL_MAX_SIZE,this.maxOrphans=policy.MEMPOOL_MAX_ORPHANS,this.maxAncestors=policy.MEMPOOL_MAX_ANCESTORS,this.expiryTime=policy.MEMPOOL_EXPIRY_TIME,this.minRelay=this.network.minRelay,this.prefix=null,this.location=null,this.memory=!0,this.maxFiles=64,this.cacheSize=32<<20,this.compression=!0,this.persistent=!1,this.fromOptions(options)}return MempoolOptions.prototype.fromOptions=function(options){return assert(options,"Mempool requires options."),assert(options.chain&&"object"===_typeof(options.chain),"Mempool requires a blockchain."),this.chain=options.chain,this.network=options.chain.network,this.logger=options.chain.logger,this.workers=options.chain.workers,this.requireStandard=this.network.requireStandard,this.minRelay=this.network.minRelay,null!=options.logger&&(assert("object"===_typeof(options.logger)),this.logger=options.logger),null!=options.workers&&(assert("object"===_typeof(options.workers)),this.workers=options.workers),null!=options.fees&&(assert("object"===_typeof(options.fees)),this.fees=options.fees),null!=options.limitFree&&(assert("boolean"==typeof options.limitFree),this.limitFree=options.limitFree),null!=options.limitFreeRelay&&(assert(options.limitFreeRelay>>>0===options.limitFreeRelay),this.limitFreeRelay=options.limitFreeRelay),null!=options.relayPriority&&(assert("boolean"==typeof options.relayPriority),this.relayPriority=options.relayPriority),null!=options.requireStandard&&(assert("boolean"==typeof options.requireStandard),this.requireStandard=options.requireStandard),null!=options.rejectAbsurdFees&&(assert("boolean"==typeof options.rejectAbsurdFees),this.rejectAbsurdFees=options.rejectAbsurdFees),null!=options.prematureWitness&&(assert("boolean"==typeof options.prematureWitness),this.prematureWitness=options.prematureWitness),null!=options.paranoidChecks&&(assert("boolean"==typeof options.paranoidChecks),this.paranoidChecks=options.paranoidChecks),null!=options.replaceByFee&&(assert("boolean"==typeof options.replaceByFee),this.replaceByFee=options.replaceByFee),null!=options.maxSize&&(assert(options.maxSize>>>0===options.maxSize),this.maxSize=options.maxSize),null!=options.maxOrphans&&(assert(options.maxOrphans>>>0===options.maxOrphans),this.maxOrphans=options.maxOrphans),null!=options.maxAncestors&&(assert(options.maxAncestors>>>0===options.maxAncestors),this.maxAncestors=options.maxAncestors),null!=options.expiryTime&&(assert(options.expiryTime>>>0===options.expiryTime),this.expiryTime=options.expiryTime),null!=options.minRelay&&(assert(options.minRelay>>>0===options.minRelay),this.minRelay=options.minRelay),null!=options.prefix&&(assert("string"==typeof options.prefix),this.prefix=options.prefix,this.location=path.join(this.prefix,"mempool")),null!=options.location&&(assert("string"==typeof options.location),this.location=options.location),null!=options.memory&&(assert("boolean"==typeof options.memory),this.memory=options.memory),null!=options.maxFiles&&(assert(options.maxFiles>>>0===options.maxFiles),this.maxFiles=options.maxFiles),null!=options.cacheSize&&(assert(Number.isSafeInteger(options.cacheSize)),assert(options.cacheSize>=0),this.cacheSize=options.cacheSize),null!=options.compression&&(assert("boolean"==typeof options.compression),this.compression=options.compression),null!=options.persistent&&(assert("boolean"==typeof options.persistent),this.persistent=options.persistent),null!=options.indexAddress&&(assert("boolean"==typeof options.indexAddress),this.indexAddress=options.indexAddress),this},MempoolOptions.fromOptions=function(options){return(new MempoolOptions).fromOptions(options)},MempoolOptions}(),TXIndex=function(){function TXIndex(){_classCallCheck(this,TXIndex),this.index=new Map,this.map=new Map}return TXIndex.prototype.reset=function(){this.index.clear(),this.map.clear()},TXIndex.prototype.get=function(addr){var items=this.index.get(addr);if(!items)return[];var out=[],_iterator33=items.values(),_isArray33=Array.isArray(_iterator33),_i33=0;for(_iterator33=_isArray33?_iterator33:_iterator33[Symbol.iterator]();;){var _ref65;if(_isArray33){if(_i33>=_iterator33.length)break;_ref65=_iterator33[_i33++]}else{if((_i33=_iterator33.next()).done)break;_ref65=_i33.value}var entry=_ref65;out.push(entry.tx)}return out},TXIndex.prototype.getMeta=function(addr){var items=this.index.get(addr);if(!items)return[];var out=[],_iterator34=items.values(),_isArray34=Array.isArray(_iterator34),_i34=0;for(_iterator34=_isArray34?_iterator34:_iterator34[Symbol.iterator]();;){var _ref66;if(_isArray34){if(_i34>=_iterator34.length)break;_ref66=_iterator34[_i34++]}else{if((_i34=_iterator34.next()).done)break;_ref66=_i34.value}var entry=_ref66,meta=TXMeta.fromTX(entry.tx);meta.mtime=entry.time,out.push(meta)}return out},TXIndex.prototype.insert=function(entry,view){var tx=entry.tx,hash=tx.hash("hex"),addrs=tx.getHashes(view,"hex");if(0!==addrs.length){var _iterator35=addrs,_isArray35=Array.isArray(_iterator35),_i35=0;for(_iterator35=_isArray35?_iterator35:_iterator35[Symbol.iterator]();;){var _ref67;if(_isArray35){if(_i35>=_iterator35.length)break;_ref67=_iterator35[_i35++]}else{if((_i35=_iterator35.next()).done)break;_ref67=_i35.value}var addr=_ref67,items=this.index.get(addr);items||(items=new Map,this.index.set(addr,items)),assert(!items.has(hash)),items.set(hash,entry)}this.map.set(hash,addrs)}},TXIndex.prototype.remove=function(hash){var addrs=this.map.get(hash);if(addrs){var _iterator36=addrs,_isArray36=Array.isArray(_iterator36),_i36=0;for(_iterator36=_isArray36?_iterator36:_iterator36[Symbol.iterator]();;){var _ref68;if(_isArray36){if(_i36>=_iterator36.length)break;_ref68=_iterator36[_i36++]}else{if((_i36=_iterator36.next()).done)break;_ref68=_i36.value}var addr=_ref68,items=this.index.get(addr);assert(items),assert(items.has(hash)),items.delete(hash),0===items.size&&this.index.delete(addr)}this.map.delete(hash)}},TXIndex}(),CoinIndex=function(){function CoinIndex(){_classCallCheck(this,CoinIndex),this.index=new Map,this.map=new Map}return CoinIndex.prototype.reset=function(){this.index.clear(),this.map.clear()},CoinIndex.prototype.get=function(addr){var items=this.index.get(addr);if(!items)return[];var out=[],_iterator37=items.values(),_isArray37=Array.isArray(_iterator37),_i37=0;for(_iterator37=_isArray37?_iterator37:_iterator37[Symbol.iterator]();;){var _ref69;if(_isArray37){if(_i37>=_iterator37.length)break;_ref69=_iterator37[_i37++]}else{if((_i37=_iterator37.next()).done)break;_ref69=_i37.value}var coin=_ref69;out.push(coin.toCoin())}return out},CoinIndex.prototype.insert=function(tx,index){var output=tx.outputs[index],hash=tx.hash("hex"),addr=output.getHash("hex");if(addr){var items=this.index.get(addr);items||(items=new Map,this.index.set(addr,items));var key=Outpoint.toKey(hash,index);assert(!items.has(key)),items.set(key,new IndexedCoin(tx,index)),this.map.set(key,addr)}},CoinIndex.prototype.remove=function(hash,index){var key=Outpoint.toKey(hash,index),addr=this.map.get(key);if(addr){var items=this.index.get(addr);assert(items),assert(items.has(key)),items.delete(key),0===items.size&&this.index.delete(addr),this.map.delete(key)}},CoinIndex}(),IndexedCoin=function(){function IndexedCoin(tx,index){_classCallCheck(this,IndexedCoin),this.tx=tx,this.index=index}return IndexedCoin.prototype.toCoin=function(){return Coin.fromTX(this.tx,this.index,-1)},IndexedCoin}(),Orphan=function(){function Orphan(tx,missing,id){_classCallCheck(this,Orphan),this.raw=tx.toRaw(),this.missing=missing,this.id=id}return Orphan.prototype.toTX=function(){return TX.fromRaw(this.raw)},Orphan}(),MempoolCache=function(){function MempoolCache(options){_classCallCheck(this,MempoolCache),this.logger=options.logger,this.chain=options.chain,this.network=options.network,this.db=null,this.batch=null,options.persistent&&(this.db=bdb.create(options))}return MempoolCache.prototype.getVersion=function(){var _ref70=_asyncToGenerator(regeneratorRuntime.mark(function _callee20(){var data;return regeneratorRuntime.wrap(function(_context20){for(;;)switch(_context20.prev=_context20.next){case 0:return _context20.next=2,this.db.get(layout.v.build());case 2:if(data=_context20.sent){_context20.next=5;break}return _context20.abrupt("return",-1);case 5:return _context20.abrupt("return",data.readUInt32LE(0,!0));case 6:case"end":return _context20.stop()}},_callee20,this)}));return function(){return _ref70.apply(this,arguments)}}(),MempoolCache.prototype.getTip=function(){var _ref71=_asyncToGenerator(regeneratorRuntime.mark(function _callee21(){var hash;return regeneratorRuntime.wrap(function(_context21){for(;;)switch(_context21.prev=_context21.next){case 0:return _context21.next=2,this.db.get(layout.R.build());case 2:if(hash=_context21.sent){_context21.next=5;break}return _context21.abrupt("return",null);case 5:return _context21.abrupt("return",hash.toString("hex"));case 6:case"end":return _context21.stop()}},_callee21,this)}));return function(){return _ref71.apply(this,arguments)}}(),MempoolCache.prototype.getFees=function(){var _ref72=_asyncToGenerator(regeneratorRuntime.mark(function _callee22(){var data,fees;return regeneratorRuntime.wrap(function(_context22){for(;;)switch(_context22.prev=_context22.next){case 0:return _context22.next=2,this.db.get(layout.F.build());case 2:if(data=_context22.sent){_context22.next=5;break}return _context22.abrupt("return",null);case 5:fees=null;try{fees=Fees.fromRaw(data)}catch(e){this.logger.warning("Fee data failed deserialization: %s.",e.message)}return _context22.abrupt("return",fees);case 8:case"end":return _context22.stop()}},_callee22,this)}));return function(){return _ref72.apply(this,arguments)}}(),MempoolCache.prototype.getEntries=function(){return this.db.values({gte:layout.e.min(),lte:layout.e.max(),parse:function(data){return MempoolEntry.fromRaw(data)}})},MempoolCache.prototype.getKeys=function(){return this.db.keys({gte:layout.e.min(),lte:layout.e.max()})},MempoolCache.prototype.open=function(){var _ref73=_asyncToGenerator(regeneratorRuntime.mark(function _callee23(){return regeneratorRuntime.wrap(function(_context23){for(;;)switch(_context23.prev=_context23.next){case 0:if(this.db){_context23.next=2;break}return _context23.abrupt("return");case 2:return _context23.next=4,this.db.open();case 4:return _context23.next=6,this.db.verify(layout.V.build(),"mempool",0);case 6:return _context23.next=8,this.verify();case 8:this.batch=this.db.batch();case 9:case"end":return _context23.stop()}},_callee23,this)}));return function(){return _ref73.apply(this,arguments)}}(),MempoolCache.prototype.close=function(){var _ref74=_asyncToGenerator(regeneratorRuntime.mark(function _callee24(){return regeneratorRuntime.wrap(function(_context24){for(;;)switch(_context24.prev=_context24.next){case 0:if(this.db){_context24.next=2;break}return _context24.abrupt("return");case 2:return _context24.next=4,this.db.close();case 4:this.batch=null;case 5:case"end":return _context24.stop()}},_callee24,this)}));return function(){return _ref74.apply(this,arguments)}}(),MempoolCache.prototype.save=function(entry){this.db&&this.batch.put(layout.e.build(entry.hash()),entry.toRaw())},MempoolCache.prototype.remove=function(hash){this.db&&this.batch.del(layout.e.build(hash))},MempoolCache.prototype.sync=function(tip){this.db&&this.batch.put(layout.R.build(),Buffer.from(tip,"hex"))},MempoolCache.prototype.writeFees=function(fees){this.db&&this.batch.put(layout.F.build(),fees.toRaw())},MempoolCache.prototype.clear=function(){this.batch.clear(),this.batch=this.db.batch()},MempoolCache.prototype.flush=function(){var _ref75=_asyncToGenerator(regeneratorRuntime.mark(function _callee25(){return regeneratorRuntime.wrap(function(_context25){for(;;)switch(_context25.prev=_context25.next){case 0:if(this.db){_context25.next=2;break}return _context25.abrupt("return");case 2:return _context25.next=4,this.batch.write();case 4:this.batch=this.db.batch();case 5:case"end":return _context25.stop()}},_callee25,this)}));return function(){return _ref75.apply(this,arguments)}}(),MempoolCache.prototype.init=function(){var _ref76=_asyncToGenerator(regeneratorRuntime.mark(function _callee26(hash){var batch;return regeneratorRuntime.wrap(function(_context26){for(;;)switch(_context26.prev=_context26.next){case 0:return(batch=this.db.batch()).put(layout.v.build(),fromU32(MempoolCache.VERSION)),batch.put(layout.R.build(),Buffer.from(hash,"hex")),_context26.next=5,batch.write();case 5:case"end":return _context26.stop()}},_callee26,this)}));return function(_x28){return _ref76.apply(this,arguments)}}(),MempoolCache.prototype.verify=function(){var _ref77=_asyncToGenerator(regeneratorRuntime.mark(function _callee27(){var version,tip;return regeneratorRuntime.wrap(function(_context27){for(;;)switch(_context27.prev=_context27.next){case 0:return _context27.next=2,this.getVersion();case 2:if(version=_context27.sent,tip=void 0,-1!==version){_context27.next=10;break}return version=MempoolCache.VERSION,tip=this.chain.tip.hash,this.logger.info("Mempool cache is empty. Writing tip %s.",util.revHex(tip)),_context27.next=10,this.init(tip);case 10:if(version===MempoolCache.VERSION){_context27.next=16;break}return this.logger.warning("Mempool cache version mismatch (%d != %d)!",version,MempoolCache.VERSION),this.logger.warning("Invalidating mempool cache."),_context27.next=15,this.wipe();case 15:return _context27.abrupt("return",!1);case 16:return _context27.next=18,this.getTip();case 18:if((tip=_context27.sent)===this.chain.tip.hash){_context27.next=25;break}return this.logger.warning("Mempool tip not consistent with chain tip (%s != %s)!",util.revHex(tip),this.chain.tip.rhash()),this.logger.warning("Invalidating mempool cache."),_context27.next=24,this.wipe();case 24:return _context27.abrupt("return",!1);case 25:return _context27.abrupt("return",!0);case 26:case"end":return _context27.stop()}},_callee27,this)}));return function(){return _ref77.apply(this,arguments)}}(),MempoolCache.prototype.wipe=function(){var _ref78=_asyncToGenerator(regeneratorRuntime.mark(function _callee28(){var batch,keys,_iterator38,_isArray38,_i38,_ref79,key;return regeneratorRuntime.wrap(function(_context28){for(;;)switch(_context28.prev=_context28.next){case 0:return batch=this.db.batch(),_context28.next=3,this.getKeys();case 3:keys=_context28.sent,_iterator38=keys,_isArray38=Array.isArray(_iterator38),_i38=0,_iterator38=_isArray38?_iterator38:_iterator38[Symbol.iterator]();case 5:if(!_isArray38){_context28.next=11;break}if(!(_i38>=_iterator38.length)){_context28.next=8;break}return _context28.abrupt("break",19);case 8:_ref79=_iterator38[_i38++],_context28.next=15;break;case 11:if(!(_i38=_iterator38.next()).done){_context28.next=14;break}return _context28.abrupt("break",19);case 14:_ref79=_i38.value;case 15:key=_ref79,batch.del(key);case 17:_context28.next=5;break;case 19:return batch.put(layout.v.build(),fromU32(MempoolCache.VERSION)),batch.put(layout.R.build(),Buffer.from(this.chain.tip.hash,"hex")),batch.del(layout.F.build()),_context28.next=24,batch.write();case 24:this.logger.info("Removed %d mempool entries from disk.",keys.length);case 25:case"end":return _context28.stop()}},_callee28,this)}));return function(){return _ref78.apply(this,arguments)}}(),MempoolCache}();MempoolCache.VERSION=2;function nop(parent,child){}function addFee(parent,child){parent.descFee+=child.deltaFee,parent.descSize+=child.size}function removeFee(parent,child){parent.descFee-=child.descFee,parent.descSize-=child.descSize}function prePrioritise(parent,child){parent.descFee-=child.deltaFee}function postPrioritise(parent,child){parent.descFee+=child.deltaFee}function cmpRate(a,b){var xf=a.deltaFee,xs=a.size,yf=b.deltaFee,ys=b.size,x=void 0,y=void 0;return useDesc(a)&&(xf=a.descFee,xs=a.descSize),useDesc(b)&&(yf=b.descFee,ys=b.descSize),(x=xf*ys)===(y=xs*yf)&&(x=a.time,y=b.time),x-y}function useDesc(a){var x=a.deltaFee*a.descSize;return a.descFee*a.size>x}function fromU32(num){var data=Buffer.allocUnsafe(4);return data.writeUInt32LE(num,0,!0),data}module.exports=Mempool}).call(this,require("buffer").Buffer)},{"../blockchain/common":5,"../coins/coinview":13,"../primitives/address":69,"../primitives/coin":71,"../primitives/outpoint":80,"../primitives/tx":82,"../primitives/txmeta":83,"../protocol/consensus":84,"../protocol/errors":85,"../protocol/network":87,"../protocol/policy":89,"../script/script":95,"../utils/heap":102,"../utils/util":106,"./fees":35,"./layout":37,"./mempoolentry":39,assert:146,"bcrypto/lib/random":180,bdb:191,bfilter:203,buffer:269,events:334,path:367}],39:[function(require,module,exports){"use strict";var bio=require("bufio"),policy=require("../protocol/policy"),util=require("../utils/util"),Script=require("../script/script"),TX=require("../primitives/tx"),MempoolEntry=function(){function MempoolEntry(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MempoolEntry),this.tx=null,this.height=-1,this.size=0,this.sigops=0,this.priority=0,this.fee=0,this.deltaFee=0,this.time=0,this.value=0,this.coinbase=!1,this.dependencies=!1,this.descFee=0,this.descSize=0,options&&this.fromOptions(options)}return MempoolEntry.prototype.fromOptions=function(options){return this.tx=options.tx,this.height=options.height,this.size=options.size,this.sigops=options.sigops,this.priority=options.priority,this.fee=options.fee,this.deltaFee=options.deltaFee,this.time=options.time,this.value=options.value,this.coinbase=options.coinbase,this.dependencies=options.dependencies,this.descFee=options.descFee,this.descSize=options.descSize,this},MempoolEntry.fromOptions=function(options){return(new this).fromOptions(options)},MempoolEntry.prototype.fromTX=function(tx,view,height){var flags=Script.flags.STANDARD_VERIFY_FLAGS,value=tx.getChainValue(view),sigops=tx.getSigopsCount(view,flags),size=tx.getSigopsSize(sigops),priority=tx.getPriority(view,height,size),fee=tx.getFee(view),dependencies=!1,coinbase=!1,_iterator=tx.inputs,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref2;if(_isArray){if(_i>=_iterator.length)break;_ref2=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref2=_i.value}var prevout=_ref2.prevout;view.isCoinbase(prevout)&&(coinbase=!0),-1===view.getHeight(prevout)&&(dependencies=!0)}return this.tx=tx,this.height=height,this.size=size,this.sigops=sigops,this.priority=priority,this.fee=fee,this.deltaFee=fee,this.time=util.now(),this.value=value,this.coinbase=coinbase,this.dependencies=dependencies,this.descFee=fee,this.descSize=size,this},MempoolEntry.fromTX=function(tx,view,height){return(new this).fromTX(tx,view,height)},MempoolEntry.prototype.hash=function(enc){return this.tx.hash(enc)},MempoolEntry.prototype.txid=function(){return this.tx.txid()},MempoolEntry.prototype.getPriority=function(height){var priority=(height-this.height)*this.value/this.size,result=this.priority+Math.floor(priority);return result<0&&(result=0),result},MempoolEntry.prototype.getFee=function(){return this.fee},MempoolEntry.prototype.getDeltaFee=function(){return this.deltaFee},MempoolEntry.prototype.getRate=function(){return policy.getRate(this.size,this.fee)},MempoolEntry.prototype.getDeltaRate=function(){return policy.getRate(this.size,this.deltaFee)},MempoolEntry.prototype.getDescRate=function(){return policy.getRate(this.descSize,this.descFee)},MempoolEntry.prototype.memUsage=function(){var tx=this.tx,total=0;total+=176,total+=48,total+=48,total+=208,total+=80,total+=88,total+=80,total+=80,total+=48,total+=32;var _iterator2=tx.inputs,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref3;if(_isArray2){if(_i2>=_iterator2.length)break;_ref3=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref3=_i2.value}var input=_ref3;total+=120,total+=104,total+=88,total+=40,total+=80,total+=32,total+=40*input.script.code.length;var _iterator4=input.script.code,_isArray4=Array.isArray(_iterator4),_i4=0;for(_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();;){var _ref5;if(_isArray4){if(_i4>=_iterator4.length)break;_ref5=_iterator4[_i4++]}else{if((_i4=_iterator4.next()).done)break;_ref5=_i4.value}_ref5.data&&(total+=80)}}total+=32;var _iterator3=tx.outputs,_isArray3=Array.isArray(_iterator3),_i3=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref4;if(_isArray3){if(_i3>=_iterator3.length)break;_ref4=_iterator3[_i3++]}else{if((_i3=_iterator3.next()).done)break;_ref4=_i3.value}var output=_ref4;total+=104,total+=40,total+=80,total+=32,total+=40*output.script.code.length;var _iterator5=output.script.code,_isArray5=Array.isArray(_iterator5),_i5=0;for(_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();;){var _ref6;if(_isArray5){if(_i5>=_iterator5.length)break;_ref6=_iterator5[_i5++]}else{if((_i5=_iterator5.next()).done)break;_ref6=_i5.value}_ref6.data&&(total+=80)}}return total},MempoolEntry.prototype.isFree=function(height){return this.getPriority(height)>policy.FREE_THRESHOLD},MempoolEntry.prototype.getSize=function(){return this.tx.getSize()+42},MempoolEntry.prototype.toRaw=function(){var bw=bio.write(this.getSize());return bw.writeBytes(this.tx.toRaw()),bw.writeU32(this.height),bw.writeU32(this.size),bw.writeU32(this.sigops),bw.writeDouble(this.priority),bw.writeU64(this.fee),bw.writeU32(this.time),bw.writeU64(this.value),bw.writeU8(this.coinbase?1:0),bw.writeU8(this.dependencies?1:0),bw.render()},MempoolEntry.prototype.fromRaw=function(data){var br=bio.read(data);return this.tx=TX.fromReader(br),this.height=br.readU32(),this.size=br.readU32(),this.sigops=br.readU32(),this.priority=br.readDouble(),this.fee=br.readU64(),this.deltaFee=this.fee,this.time=br.readU32(),this.value=br.readU64(),this.coinbase=1===br.readU8(),this.dependencies=1===br.readU8(),this.descFee=this.fee,this.descSize=this.size,this},MempoolEntry.fromRaw=function(data){return(new this).fromRaw(data)},MempoolEntry}();module.exports=MempoolEntry},{"../primitives/tx":82,"../protocol/policy":89,"../script/script":95,"../utils/util":106,bufio:270}],40:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),consensus=require("../protocol/consensus"),BN=require("bn.js"),common=exports;common.swap32=function(data){for(var i=0;i<data.length;i+=4){var field=data.readUInt32LE(i,!0);data.writeUInt32BE(field,i,!0)}return data},common.swap32hex=function(str){var data=Buffer.from(str,"hex");return common.swap32(data).toString("hex")},common.rcmp=function(a,b){assert(a.length===b.length);for(var i=a.length-1;i>=0;i--){if(a[i]<b[i])return-1;if(a[i]>b[i])return 1}return 0},common.double256=function(target){var n=0;return assert(32===target.length),n+=6.277101735386681e57*(4294967296*target.readUInt32LE(28,!0)+target.readUInt32LE(24,!0)),n+=3.402823669209385e38*(4294967296*target.readUInt32LE(20,!0)+target.readUInt32LE(16,!0)),n+=0x10000000000000000*(4294967296*target.readUInt32LE(12,!0)+target.readUInt32LE(8,!0)),n+=1*(4294967296*target.readUInt32LE(4,!0)+target.readUInt32LE(0,!0))},common.getDifficulty=function(target){var d=2.695953529101131e67,n=common.double256(target);return 0===n?d:Math.floor(d/n)},common.getTarget=function(bits){var target=consensus.fromCompact(bits);if(target.isNeg())throw new Error("Target is negative.");if(target.isZero())throw new Error("Target is zero.");return target.toArrayLike(Buffer,"le",32)},common.getBits=function(data){var target=new BN(data,"le");if(target.isZero())throw new Error("Target is zero.");return consensus.toCompact(target)}}).call(this,require("buffer").Buffer)},{"../protocol/consensus":84,assert:146,"bn.js":217,buffer:269}],41:[function(require,module,exports){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),EventEmitter=require("events"),Lock=require("bmutex").Lock,util=require("../utils/util"),mine=require("./mine"),CPUMiner=function(_EventEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(CPUMiner,_EventEmitter);function CPUMiner(miner){_classCallCheck(this,CPUMiner);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return _this.opened=!1,_this.miner=miner,_this.network=_this.miner.network,_this.logger=_this.miner.logger.context("cpuminer"),_this.workers=_this.miner.workers,_this.chain=_this.miner.chain,_this.locker=new Lock,_this.running=!1,_this.stopping=!1,_this.job=null,_this.stopJob=null,_this.init(),_this}return CPUMiner.prototype.init=function(){var _this2=this;this.chain.on("tip",function(tip){_this2.job&&_this2.job.attempt.prevBlock===tip.prevBlock&&_this2.job.destroy()})},CPUMiner.prototype.open=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:assert(!this.opened,"CPUMiner is already open."),this.opened=!0;case 2:case"end":return _context.stop()}},_callee,this)}));return function(){return _ref.apply(this,arguments)}}(),CPUMiner.prototype.close=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return assert(this.opened,"CPUMiner is not open."),this.opened=!1,_context2.abrupt("return",this.stop());case 3:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref2.apply(this,arguments)}}(),CPUMiner.prototype.start=function(){assert(!this.running,"Miner is already running."),this._start().catch(function(){})},CPUMiner.prototype._start=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var block,entry,job;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:assert(!this.running,"Miner is already running."),this.running=!0,this.stopping=!1;case 3:return this.job=null,_context3.prev=4,_context3.next=7,this.createJob();case 7:this.job=_context3.sent,_context3.next=16;break;case 10:if(_context3.prev=10,_context3.t0=_context3.catch(4),!this.stopping){_context3.next=14;break}return _context3.abrupt("break",62);case 14:return this.emit("error",_context3.t0),_context3.abrupt("break",62);case 16:if(!this.stopping){_context3.next=18;break}return _context3.abrupt("break",62);case 18:return block=void 0,_context3.prev=19,_context3.next=22,this.mineAsync(this.job);case 22:block=_context3.sent,_context3.next=31;break;case 25:if(_context3.prev=25,_context3.t1=_context3.catch(19),!this.stopping){_context3.next=29;break}return _context3.abrupt("break",62);case 29:return this.emit("error",_context3.t1),_context3.abrupt("break",62);case 31:if(!this.stopping){_context3.next=33;break}return _context3.abrupt("break",62);case 33:if(block){_context3.next=35;break}return _context3.abrupt("continue",60);case 35:return entry=void 0,_context3.prev=36,_context3.next=39,this.chain.add(block);case 39:entry=_context3.sent,_context3.next=52;break;case 42:if(_context3.prev=42,_context3.t2=_context3.catch(36),!this.stopping){_context3.next=46;break}return _context3.abrupt("break",62);case 46:if("VerifyError"!==_context3.t2.type){_context3.next=50;break}return this.logger.warning("Mined an invalid block!"),this.logger.error(_context3.t2),_context3.abrupt("continue",60);case 50:return this.emit("error",_context3.t2),_context3.abrupt("break",62);case 52:if(entry){_context3.next=55;break}return this.logger.warning("Mined a bad-prevblk (race condition?)"),_context3.abrupt("continue",60);case 55:if(!this.stopping){_context3.next=57;break}return _context3.abrupt("break",62);case 57:this.logger.info("Found block: %d (%s).",entry.height,entry.rhash()),this.logger.debug("Raw: %s",block.toRaw().toString("hex")),this.emit("block",block,entry);case 60:_context3.next=3;break;case 62:(job=this.stopJob)&&(this.stopJob=null,job.resolve());case 64:case"end":return _context3.stop()}},_callee3,this,[[4,10],[19,25],[36,42]])}));return function(){return _ref3.apply(this,arguments)}}(),CPUMiner.prototype.stop=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){var unlock;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,this.locker.lock();case 2:return unlock=_context4.sent,_context4.prev=3,_context4.next=6,this._stop();case 6:return _context4.abrupt("return",_context4.sent);case 7:return _context4.prev=7,unlock(),_context4.finish(7);case 10:case"end":return _context4.stop()}},_callee4,this,[[3,,7,10]])}));return function(){return _ref4.apply(this,arguments)}}(),CPUMiner.prototype._stop=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(this.running){_context5.next=2;break}return _context5.abrupt("return");case 2:return assert(this.running,"Miner is not running."),assert(!this.stopping,"Miner is already stopping."),this.stopping=!0,this.job&&(this.job.destroy(),this.job=null),_context5.next=8,this.wait();case 8:this.running=!1,this.stopping=!1,this.job=null;case 11:case"end":return _context5.stop()}},_callee5,this)}));return function(){return _ref5.apply(this,arguments)}}(),CPUMiner.prototype.wait=function(){var _this3=this;return new Promise(function(resolve,reject){assert(!_this3.stopJob),_this3.stopJob={resolve:resolve,reject:reject}})},CPUMiner.prototype.createJob=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(tip,address){var attempt;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=2,this.miner.createBlock(tip,address);case 2:return attempt=_context6.sent,_context6.abrupt("return",new CPUJob(this,attempt));case 4:case"end":return _context6.stop()}},_callee6,this)}));return function(_x,_x2){return _ref6.apply(this,arguments)}}(),CPUMiner.prototype.mineBlock=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(tip,address){var job;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.next=2,this.createJob(tip,address);case 2:return job=_context7.sent,_context7.next=5,this.mineAsync(job);case 5:return _context7.abrupt("return",_context7.sent);case 6:case"end":return _context7.stop()}},_callee7,this)}));return function(_x3,_x4){return _ref7.apply(this,arguments)}}(),CPUMiner.prototype.notifyEntry=function(){this.running&&this.job&&util.now()-this.job.start>10&&(this.job.destroy(),this.job=null)},CPUMiner.prototype.findNonce=function(job){for(var data=job.getHeader(),target=job.attempt.target,interval=CPUMiner.INTERVAL,min=0,max=interval,nonce=void 0;max<=4294967295&&-1===(nonce=mine(data,target,min,max));)this.sendStatus(job,max),min+=interval,max+=interval;return nonce},CPUMiner.prototype.findNonceAsync=function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(job){var data,target,interval,min,max,nonce;return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(this.workers){_context8.next=2;break}return _context8.abrupt("return",this.findNonce(job));case 2:data=job.getHeader(),target=job.attempt.target,interval=CPUMiner.INTERVAL,min=0,max=interval,nonce=void 0;case 8:if(!(max<=4294967295)){_context8.next=21;break}return _context8.next=11,this.workers.mine(data,target,min,max);case 11:if(-1===(nonce=_context8.sent)){_context8.next=14;break}return _context8.abrupt("break",21);case 14:if(!job.destroyed){_context8.next=16;break}return _context8.abrupt("return",nonce);case 16:this.sendStatus(job,max),min+=interval,max+=interval,_context8.next=8;break;case 21:return _context8.abrupt("return",nonce);case 22:case"end":return _context8.stop()}},_callee8,this)}));return function(_x5){return _ref8.apply(this,arguments)}}(),CPUMiner.prototype.mine=function(job){job.start=util.now();for(var nonce=void 0;-1===(nonce=this.findNonce(job));)job.updateNonce(),this.sendStatus(job,0);return job.commit(nonce)},CPUMiner.prototype.mineAsync=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(job){var nonce;return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:nonce=void 0,job.start=util.now();case 2:return _context9.next=4,this.findNonceAsync(job);case 4:if(-1===(nonce=_context9.sent)){_context9.next=7;break}return _context9.abrupt("break",13);case 7:if(!job.destroyed){_context9.next=9;break}return _context9.abrupt("return",null);case 9:job.updateNonce(),this.sendStatus(job,0);case 11:_context9.next=2;break;case 13:return _context9.abrupt("return",job.commit(nonce));case 14:case"end":return _context9.stop()}},_callee9,this)}));return function(_x6){return _ref9.apply(this,arguments)}}(),CPUMiner.prototype.sendStatus=function(job,nonce){var attempt=job.attempt,tip=util.revHex(attempt.prevBlock),hashes=job.getHashes(nonce),hashrate=job.getRate(nonce);this.logger.info("Status: hashrate=%dkhs hashes=%d target=%d height=%d tip=%s",Math.floor(hashrate/1e3),hashes,attempt.bits,attempt.height,tip),this.emit("status",job,hashes,hashrate)},CPUMiner}(EventEmitter);CPUMiner.INTERVAL=2863311;var CPUJob=function(){function CPUJob(miner,attempt){_classCallCheck(this,CPUJob),this.miner=miner,this.attempt=attempt,this.destroyed=!1,this.committed=!1,this.start=util.now(),this.nonce1=0,this.nonce2=0,this.refresh()}return CPUJob.prototype.getHeader=function(){var attempt=this.attempt,n1=this.nonce1,n2=this.nonce2,time=attempt.time,root=attempt.getRoot(n1,n2);return attempt.getHeader(root,time,0)},CPUJob.prototype.commit=function(nonce){var attempt=this.attempt,n1=this.nonce1,n2=this.nonce2,time=attempt.time;assert(!this.committed,"Job already committed."),this.committed=!0;var proof=attempt.getProof(n1,n2,time,nonce);return attempt.commit(proof)},CPUJob.prototype.mine=function(){return this.miner.mine(this)},CPUJob.prototype.mineAsync=function(){return this.miner.mineAsync(this)},CPUJob.prototype.refresh=function(){return this.attempt.refresh()},CPUJob.prototype.updateNonce=function(){4294967296==++this.nonce2&&(this.nonce2=0,this.nonce1++)},CPUJob.prototype.destroy=function(){assert(!this.destroyed,"Job already destroyed."),this.destroyed=!0},CPUJob.prototype.getHashes=function(nonce){return 4294967295*(4294967296*this.nonce1+this.nonce2)+nonce},CPUJob.prototype.getRate=function(nonce){var hashes=this.getHashes(nonce),seconds=util.now()-this.start;return Math.floor(hashes/Math.max(1,seconds))},CPUJob.prototype.addTX=function(tx,view){return this.attempt.addTX(tx,view)},CPUJob.prototype.pushTX=function(tx,view){return this.attempt.pushTX(tx,view)},CPUJob}();module.exports=CPUMiner},{"../utils/util":106,"./mine":43,assert:146,bmutex:214,events:334}],42:[function(require,module,exports){"use strict";exports.common=require("./common"),exports.CPUMiner=require("./cpuminer"),exports.mine=require("./mine"),exports.Miner=require("./miner"),exports.BlockTemplate=require("./template")},{"./common":40,"./cpuminer":41,"./mine":43,"./miner":44,"./template":45}],43:[function(require,module,exports){"use strict";var assert=require("assert"),hash256=require("bcrypto/lib/hash256");function rcmp(a,b){assert(a.length===b.length);for(var i=a.length-1;i>=0;i--){if(a[i]<b[i])return-1;if(a[i]>b[i])return 1}return 0}module.exports=function(data,target,min,max){var nonce=min;for(data.writeUInt32LE(nonce,76,!0);nonce<=max;){if(rcmp(hash256.digest(data),target)<=0)return nonce;nonce+=1,data.writeUInt32LE(nonce,76,!0)}return-1}},{assert:146,"bcrypto/lib/hash256":160}],44:[function(require,module,exports){(function(Buffer){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),EventEmitter=require("events"),Heap=require("../utils/heap"),Amount=require("../btc/amount"),Address=require("../primitives/address"),BlockTemplate=require("./template"),Network=require("../protocol/network"),consensus=require("../protocol/consensus"),policy=require("../protocol/policy"),CPUMiner=require("./cpuminer"),BlockEntry=BlockTemplate.BlockEntry,Miner=function(_EventEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Miner,_EventEmitter);function Miner(options){_classCallCheck(this,Miner);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return _this.opened=!1,_this.options=new MinerOptions(options),_this.network=_this.options.network,_this.logger=_this.options.logger.context("miner"),_this.workers=_this.options.workers,_this.chain=_this.options.chain,_this.mempool=_this.options.mempool,_this.addresses=_this.options.addresses,_this.locker=_this.chain.locker,_this.cpu=new CPUMiner(_this),_this.init(),_this}return Miner.prototype.init=function(){var _this2=this;this.cpu.on("error",function(err){_this2.emit("error",err)})},Miner.prototype.open=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return assert(!this.opened,"Miner is already open."),this.opened=!0,_context.next=4,this.cpu.open();case 4:this.logger.info("Miner loaded (flags=%s).",this.options.coinbaseFlags.toString("utf8")),0===this.addresses.length&&this.logger.warning("No reward address is set for miner!");case 6:case"end":return _context.stop()}},_callee,this)}));return function(){return _ref.apply(this,arguments)}}(),Miner.prototype.close=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return assert(this.opened,"Miner is not open."),this.opened=!1,_context2.abrupt("return",this.cpu.close());case 3:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref2.apply(this,arguments)}}(),Miner.prototype.createBlock=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(tip,address){var unlock;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,this.locker.lock();case 2:return unlock=_context3.sent,_context3.prev=3,_context3.next=6,this._createBlock(tip,address);case 6:return _context3.abrupt("return",_context3.sent);case 7:return _context3.prev=7,unlock(),_context3.finish(7);case 10:case"end":return _context3.stop()}},_callee3,this,[[3,,7,10]])}));return function(_x,_x2){return _ref3.apply(this,arguments)}}(),Miner.prototype._createBlock=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(tip,address){var version,mtp,time,state,target,locktime,attempt,block;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(version=this.options.version,tip||(tip=this.chain.tip),address||(address=this.getAddress()),-1!==version){_context4.next=7;break}return _context4.next=6,this.chain.computeBlockVersion(tip);case 6:version=_context4.sent;case 7:return _context4.next=9,this.chain.getMedianTime(tip);case 9:return mtp=_context4.sent,time=Math.max(this.network.now(),mtp+1),_context4.next=13,this.chain.getDeployments(time,tip);case 13:return state=_context4.sent,_context4.next=16,this.chain.getTarget(time,tip);case 16:if(target=_context4.sent,locktime=state.hasMTP()?mtp:time,attempt=new BlockTemplate({prevBlock:tip.hash,height:tip.height+1,version:version,time:time,bits:target,locktime:locktime,mtp:mtp,flags:state.flags,address:address,coinbaseFlags:this.options.coinbaseFlags,interval:this.network.halvingInterval,weight:this.options.reservedWeight,sigops:this.options.reservedSigops}),this.assemble(attempt),this.logger.debug("Created block tmpl (height=%d, weight=%d, fees=%d, txs=%s, diff=%d).",attempt.height,attempt.weight,Amount.btc(attempt.fees),attempt.items.length+1,attempt.getDifficulty()),!this.options.preverify){_context4.next=36;break}return block=attempt.toBlock(),_context4.prev=23,_context4.next=26,this.chain._verifyBlock(block);case 26:_context4.next=35;break;case 28:if(_context4.prev=28,_context4.t0=_context4.catch(23),"VerifyError"!==_context4.t0.type){_context4.next=34;break}throw this.logger.warning("Miner created invalid block!"),this.logger.error(_context4.t0),new Error("BUG: Miner created invalid block.");case 34:throw _context4.t0;case 35:this.logger.debug("Preverified block %d successfully!",attempt.height);case 36:return _context4.abrupt("return",attempt);case 37:case"end":return _context4.stop()}},_callee4,this,[[23,28]])}));return function(_x3,_x4){return _ref4.apply(this,arguments)}}(),Miner.prototype.updateTime=function(attempt){attempt.time=Math.max(this.network.now(),attempt.mtp+1)},Miner.prototype.createJob=function(tip,address){return this.cpu.createJob(tip,address)},Miner.prototype.mineBlock=function(tip,address){return this.cpu.mineBlock(tip,address)},Miner.prototype.addAddress=function(address){this.addresses.push(new Address(address))},Miner.prototype.getAddress=function(){return 0===this.addresses.length?new Address:this.addresses[Math.random()*this.addresses.length|0]},Miner.prototype.assemble=function(attempt){if(this.mempool){assert(this.mempool.tip===this.chain.tip.hash,"Mempool/chain tip mismatch! Unsafe to create block.");var depMap=new Map,queue=new Heap(cmpRate),priority=this.options.priorityWeight>0;priority&&queue.set(cmpPriority);var _iterator=this.mempool.map.values(),_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref5;if(_isArray){if(_i>=_iterator.length)break;_ref5=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref5=_i.value}var entry=_ref5;if((tx=(item=BlockEntry.fromEntry(entry,attempt)).tx).isCoinbase())throw new Error("Cannot add coinbase to block.");var _iterator3=tx.inputs,_isArray3=Array.isArray(_iterator3),_i3=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref8;if(_isArray3){if(_i3>=_iterator3.length)break;_ref8=_iterator3[_i3++]}else{if((_i3=_iterator3.next()).done)break;_ref8=_i3.value}var _hash=_ref8.prevout.hash;this.mempool.hasEntry(_hash)&&(item.depCount+=1,depMap.has(_hash)||depMap.set(_hash,[]),depMap.get(_hash).push(item))}item.depCount>0||queue.insert(item)}for(;queue.size()>0;){var item,tx=(item=queue.shift()).tx,hash=item.hash,weight=attempt.weight,sigops=attempt.sigops;if(tx.isFinal(attempt.height,attempt.locktime)&&!((weight+=tx.getWeight())>this.options.maxWeight||(sigops+=item.sigops)>this.options.maxSigops)){if(priority){if(weight>this.options.priorityWeight||item.priority<this.options.priorityThreshold){priority=!1,queue.set(cmpRate),queue.init(),queue.insert(item);continue}}else if(item.free&&weight>=this.options.minWeight)continue;attempt.weight=weight,attempt.sigops=sigops,attempt.fees+=item.fee,attempt.items.push(item);var deps=depMap.get(hash);if(deps){var _iterator2=deps,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref6;if(_isArray2){if(_i2>=_iterator2.length)break;_ref6=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref6=_i2.value}var _item=_ref6;0==--_item.depCount&&queue.insert(_item)}}}}if(attempt.refresh(),assert(attempt.weight<=consensus.MAX_BLOCK_WEIGHT,"Block exceeds reserved weight!"),this.options.preverify){var block=attempt.toBlock();assert(block.getWeight()<=attempt.weight,"Block exceeds reserved weight!"),assert(block.getBaseSize()<=consensus.MAX_BLOCK_SIZE,"Block exceeds max block size.")}}else attempt.refresh()},Miner}(EventEmitter),MinerOptions=function(){function MinerOptions(options){_classCallCheck(this,MinerOptions),this.network=Network.primary,this.logger=null,this.workers=null,this.chain=null,this.mempool=null,this.version=-1,this.addresses=[],this.coinbaseFlags=Buffer.from("mined by bcash","ascii"),this.preverify=!1,this.minWeight=policy.MIN_BLOCK_WEIGHT,this.maxWeight=policy.MAX_BLOCK_WEIGHT,this.priorityWeight=policy.BLOCK_PRIORITY_WEIGHT,this.priorityThreshold=policy.BLOCK_PRIORITY_THRESHOLD,this.maxSigops=consensus.MAX_BLOCK_SIGOPS,this.reservedWeight=4e3,this.reservedSigops=400,this.fromOptions(options)}return MinerOptions.prototype.fromOptions=function(options){if(assert(options,"Miner requires options."),assert(options.chain&&"object"===_typeof(options.chain),"Miner requires a blockchain."),this.chain=options.chain,this.network=options.chain.network,this.logger=options.chain.logger,this.workers=options.chain.workers,null!=options.logger&&(assert("object"===_typeof(options.logger)),this.logger=options.logger),null!=options.workers&&(assert("object"===_typeof(options.workers)),this.workers=options.workers),null!=options.mempool&&(assert("object"===_typeof(options.mempool)),this.mempool=options.mempool),null!=options.version&&(assert(options.version>>>0===options.version),this.version=options.version),options.address)if(Array.isArray(options.address)){var _iterator4=options.address,_isArray4=Array.isArray(_iterator4),_i4=0;for(_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();;){var _ref9;if(_isArray4){if(_i4>=_iterator4.length)break;_ref9=_iterator4[_i4++]}else{if((_i4=_iterator4.next()).done)break;_ref9=_i4.value}var item=_ref9;this.addresses.push(new Address(item))}}else this.addresses.push(new Address(options.address));if(options.addresses){assert(Array.isArray(options.addresses));var _iterator5=options.addresses,_isArray5=Array.isArray(_iterator5),_i5=0;for(_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();;){var _ref10;if(_isArray5){if(_i5>=_iterator5.length)break;_ref10=_iterator5[_i5++]}else{if((_i5=_iterator5.next()).done)break;_ref10=_i5.value}var _item2=_ref10;this.addresses.push(new Address(_item2))}}if(options.coinbaseFlags){var flags=options.coinbaseFlags;"string"==typeof flags&&(flags=Buffer.from(flags,"utf8")),assert(Buffer.isBuffer(flags)),assert(flags.length<=20,"Coinbase flags > 20 bytes."),this.coinbaseFlags=flags}return null!=options.preverify&&(assert("boolean"==typeof options.preverify),this.preverify=options.preverify),null!=options.minWeight&&(assert(options.minWeight>>>0===options.minWeight),this.minWeight=options.minWeight),null!=options.maxWeight&&(assert(options.maxWeight>>>0===options.maxWeight),assert(options.maxWeight<=consensus.MAX_BLOCK_WEIGHT,"Max weight must be below MAX_BLOCK_WEIGHT"),this.maxWeight=options.maxWeight),null!=options.maxSigops&&(assert(options.maxSigops>>>0===options.maxSigops),assert(options.maxSigops<=consensus.MAX_BLOCK_SIGOPS,"Max sigops must be below MAX_BLOCK_SIGOPS"),this.maxSigops=options.maxSigops),null!=options.priorityWeight&&(assert(options.priorityWeight>>>0===options.priorityWeight),this.priorityWeight=options.priorityWeight),null!=options.priorityThreshold&&(assert(options.priorityThreshold>>>0===options.priorityThreshold),this.priorityThreshold=options.priorityThreshold),null!=options.reservedWeight&&(assert(options.reservedWeight>>>0===options.reservedWeight),this.reservedWeight=options.reservedWeight),null!=options.reservedSigops&&(assert(options.reservedSigops>>>0===options.reservedSigops),this.reservedSigops=options.reservedSigops),this},MinerOptions.fromOptions=function(options){return(new this).fromOptions(options)},MinerOptions}();function cmpPriority(a,b){return a.priority===b.priority?cmpRate(a,b):b.priority-a.priority}function cmpRate(a,b){var x=a.rate,y=b.rate;return a.descRate>a.rate&&(x=a.descRate),b.descRate>b.rate&&(y=b.descRate),x===y&&(x=a.priority,y=b.priority),y-x}module.exports=Miner}).call(this,require("buffer").Buffer)},{"../btc/amount":8,"../primitives/address":69,"../protocol/consensus":84,"../protocol/network":87,"../protocol/policy":89,"../utils/heap":102,"./cpuminer":41,"./template":45,assert:146,buffer:269,events:334}],45:[function(require,module,exports){(function(Buffer){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),bio=require("bufio"),hash256=require("bcrypto/lib/hash256"),merkle=require("bcrypto/lib/merkle"),util=require("../utils/util"),Address=require("../primitives/address"),TX=require("../primitives/tx"),Block=require("../primitives/block"),Input=require("../primitives/input"),Output=require("../primitives/output"),consensus=require("../protocol/consensus"),policy=require("../protocol/policy"),CoinView=require("../coins/coinview"),Script=require("../script/script"),common=require("./common"),DUMMY=Buffer.alloc(0),BlockTemplate=function(){function BlockTemplate(options){_classCallCheck(this,BlockTemplate),this.prevBlock=consensus.NULL_HASH,this.version=1,this.height=0,this.time=0,this.bits=0,this.target=consensus.ZERO_HASH,this.locktime=0,this.mtp=0,this.flags=0,this.coinbaseFlags=DUMMY,this.witness=!1,this.address=new Address,this.sigops=400,this.weight=4e3,this.interval=21e4,this.fees=0,this.tree=new MerkleTree,this.commitment=consensus.ZERO_HASH,this.left=DUMMY,this.right=DUMMY,this.items=[],options&&this.fromOptions(options)}return BlockTemplate.prototype.fromOptions=function(options){return assert(options),null!=options.prevBlock&&(assert("string"==typeof options.prevBlock),this.prevBlock=options.prevBlock),null!=options.version&&(assert("number"==typeof options.version),this.version=options.version),null!=options.height&&(assert("number"==typeof options.height),this.height=options.height),null!=options.time&&(assert("number"==typeof options.time),this.time=options.time),null!=options.bits&&this.setBits(options.bits),null!=options.target&&this.setTarget(options.target),null!=options.locktime&&(assert("number"==typeof options.locktime),this.locktime=options.locktime),null!=options.mtp&&(assert("number"==typeof options.mtp),this.mtp=options.mtp),null!=options.flags&&(assert("number"==typeof options.flags),this.flags=options.flags),null!=options.coinbaseFlags&&(assert(Buffer.isBuffer(options.coinbaseFlags)),this.coinbaseFlags=options.coinbaseFlags),null!=options.witness&&(assert("boolean"==typeof options.witness),this.witness=options.witness),null!=options.address&&this.address.fromOptions(options.address),null!=options.sigops&&(assert("number"==typeof options.sigops),this.sigops=options.sigops),null!=options.weight&&(assert("number"==typeof options.weight),this.weight=options.weight),null!=options.interval&&(assert("number"==typeof options.interval),this.interval=options.interval),null!=options.fees&&(assert("number"==typeof options.fees),this.fees=options.fees),null!=options.items&&(assert(Array.isArray(options.items)),this.items=options.items),this},BlockTemplate.fromOptions=function(options){return(new this).fromOptions(options)},BlockTemplate.prototype.getWitnessHash=function(){var nonce=consensus.ZERO_HASH,leaves=[];leaves.push(consensus.ZERO_HASH);var _iterator=this.items,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref2;if(_isArray){if(_i>=_iterator.length)break;_ref2=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref2=_i.value}var tx=_ref2.tx;leaves.push(tx.witnessHash())}var _merkle$createRoot=merkle.createRoot(hash256,leaves),root=_merkle$createRoot[0],malleated=_merkle$createRoot[1];return assert(!malleated),hash256.root(root,nonce)},BlockTemplate.prototype.getWitnessScript=function(){return Script.fromCommitment(this.commitment)},BlockTemplate.prototype.setBits=function(bits){assert("number"==typeof bits),this.bits=bits,this.target=common.getTarget(bits)},BlockTemplate.prototype.setTarget=function(target){assert(Buffer.isBuffer(target)),this.bits=common.getBits(target),this.target=target},BlockTemplate.prototype.getReward=function(){return consensus.getReward(this.height,this.interval)+this.fees},BlockTemplate.prototype.createCoinbase=function(hash){var scale=consensus.WITNESS_SCALE_FACTOR,cb=new TX,input=new Input;input.script.pushInt(this.height),input.script.pushData(Buffer.alloc(20,0));var nonce=Buffer.allocUnsafe(4);nonce.writeUInt32LE(4294967296*Math.random(),0,!0),input.script.pushData(nonce),input.script.pushData(Buffer.alloc(8,0)),input.script.compile(),this.witness&&(input.witness.push(consensus.ZERO_HASH),input.witness.compile()),cb.inputs.push(input);var output=new Output;if(output.script.fromPubkeyhash(Buffer.alloc(20,0)),output.value=this.getReward(),cb.outputs.push(output),this.witness){var commit=new Output;commit.script.fromCommitment(hash),cb.outputs.push(commit)}var op=input.script.get(0);assert(op);var padding=5-op.getSize();return assert(padding>=0),this.witness?(assert.strictEqual(cb.getWeight()+padding*scale,724),assert.strictEqual(cb.getBaseSize()+padding,172),assert.strictEqual(cb.getSize()+padding,208)):(assert.strictEqual(cb.getWeight()+padding*scale,500),assert.strictEqual(cb.getBaseSize()+padding,125),assert.strictEqual(cb.getSize()+padding,125)),input.script.setData(1,this.coinbaseFlags),input.script.compile(),output.script.fromAddress(this.address),cb.refresh(),assert(input.script.getSize()<=100,"Coinbase input script is too large!"),cb},BlockTemplate.prototype.refresh=function(){var hash=this.getWitnessHash(),cb=this.createCoinbase(hash),raw=cb.toNormal(),size=0;size+=4,size+=1,size+=cb.inputs[0].getSize(),size-=12;var left=raw.slice(0,size);size+=8;var right=raw.slice(size);this.commitment=hash,this.left=left,this.right=right,this.tree=MerkleTree.fromItems(this.items)},BlockTemplate.prototype.getRawCoinbase=function(nonce1,nonce2){var size=0;size+=this.left.length,size+=8,size+=this.right.length;var bw=bio.write(size);return bw.writeBytes(this.left),bw.writeU32BE(nonce1),bw.writeU32BE(nonce2),bw.writeBytes(this.right),bw.render()},BlockTemplate.prototype.getRoot=function(nonce1,nonce2){var raw=this.getRawCoinbase(nonce1,nonce2),hash=hash256.digest(raw);return this.tree.withFirst(hash)},BlockTemplate.prototype.getHeader=function(root,time,nonce){var bw=bio.write(80);return bw.writeU32(this.version),bw.writeHash(this.prevBlock),bw.writeHash(root),bw.writeU32(time),bw.writeU32(this.bits),bw.writeU32(nonce),bw.render()},BlockTemplate.prototype.getProof=function(nonce1,nonce2,time,nonce){var root=this.getRoot(nonce1,nonce2),data=this.getHeader(root,time,nonce),hash=hash256.digest(data);return new BlockProof(hash,root,nonce1,nonce2,time,nonce)},BlockTemplate.prototype.getCoinbase=function(nonce1,nonce2){var raw=this.getRawCoinbase(nonce1,nonce2),tx=TX.fromRaw(raw);if(this.witness){var input=tx.inputs[0];input.witness.push(consensus.ZERO_HASH),input.witness.compile(),tx.refresh()}return tx},BlockTemplate.prototype.commit=function(proof){var root=proof.root,n1=proof.nonce1,n2=proof.nonce2,time=proof.time,nonce=proof.nonce,block=new Block;block.version=this.version,block.prevBlock=this.prevBlock,block.merkleRoot=root.toString("hex"),block.time=time,block.bits=this.bits,block.nonce=nonce;var tx=this.getCoinbase(n1,n2);block.txs.push(tx);var _iterator2=this.items,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref3;if(_isArray2){if(_i2>=_iterator2.length)break;_ref3=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref3=_i2.value}var item=_ref3;block.txs.push(item.tx)}return block},BlockTemplate.prototype.toCoinbase=function(){return this.getCoinbase(0,0)},BlockTemplate.prototype.toBlock=function(){var proof=this.getProof(0,0,this.time,0);return this.commit(proof)},BlockTemplate.prototype.getDifficulty=function(){return common.getDifficulty(this.target)},BlockTemplate.prototype.setAddress=function(address){this.address=new Address(address),this.refresh()},BlockTemplate.prototype.addTX=function(tx,view){assert(!tx.mutable,"Cannot add mutable TX to block.");var item=BlockEntry.fromTX(tx,view,this),weight=item.tx.getWeight(),sigops=item.sigops;return!!tx.isFinal(this.height,this.locktime)&&(!(this.weight+weight>consensus.MAX_BLOCK_WEIGHT)&&(!(this.sigops+sigops>consensus.MAX_BLOCK_SIGOPS_COST)&&(!(!this.witness&&tx.hasWitness())&&(this.weight+=weight,this.sigops+=sigops,this.fees+=item.fee,this.items.push(item),!0))))},BlockTemplate.prototype.pushTX=function(tx,view){assert(!tx.mutable,"Cannot add mutable TX to block."),view||(view=new CoinView);var item=BlockEntry.fromTX(tx,view,this),weight=item.tx.getWeight(),sigops=item.sigops;return this.weight+=weight,this.sigops+=sigops,this.fees+=item.fee,this.items.push(item),!0},BlockTemplate}(),BlockEntry=function(){function BlockEntry(tx){_classCallCheck(this,BlockEntry),this.tx=tx,this.hash=tx.hash("hex"),this.fee=0,this.rate=0,this.priority=0,this.free=!1,this.sigops=0,this.descRate=0,this.depCount=0}return BlockEntry.fromTX=function(tx,view,attempt){var item=new this(tx);return item.fee=tx.getFee(view),item.rate=tx.getRate(view),item.priority=tx.getPriority(view,attempt.height),item.free=!1,item.sigops=tx.getSigopsCost(view,attempt.flags),item.descRate=item.rate,item},BlockEntry.fromEntry=function(entry,attempt){var item=new this(entry.tx);return item.fee=entry.getFee(),item.rate=entry.getDeltaRate(),item.priority=entry.getPriority(attempt.height),item.free=entry.getDeltaFee()<policy.getMinFee(entry.size),item.sigops=entry.sigops,item.descRate=entry.getDescRate(),item},BlockEntry}(),BlockProof=function(){function BlockProof(hash,root,nonce1,nonce2,time,nonce){_classCallCheck(this,BlockProof),this.hash=hash,this.root=root,this.nonce1=nonce1,this.nonce2=nonce2,this.time=time,this.nonce=nonce}return BlockProof.prototype.rhash=function(){return util.revHex(this.hash.toString("hex"))},BlockProof.prototype.verify=function(target){return common.rcmp(this.hash,target)<=0},BlockProof.prototype.getDifficulty=function(){return common.getDifficulty(this.hash)},BlockProof}(),MerkleTree=function(){function MerkleTree(){_classCallCheck(this,MerkleTree),this.steps=[]}return MerkleTree.prototype.withFirst=function(hash){var _iterator3=this.steps,_isArray3=Array.isArray(_iterator3),_i3=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref4;if(_isArray3){if(_i3>=_iterator3.length)break;_ref4=_iterator3[_i3++]}else{if((_i3=_iterator3.next()).done)break;_ref4=_i3.value}var step=_ref4;hash=hash256.root(hash,step)}return hash},MerkleTree.prototype.toJSON=function(){var steps=[],_iterator4=this.steps,_isArray4=Array.isArray(_iterator4),_i4=0;for(_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();;){var _ref5;if(_isArray4){if(_i4>=_iterator4.length)break;_ref5=_iterator4[_i4++]}else{if((_i4=_iterator4.next()).done)break;_ref5=_i4.value}var step=_ref5;steps.push(step.toString("hex"))}return steps},MerkleTree.prototype.fromItems=function(items){var leaves=[];leaves.push(consensus.ZERO_HASH);var _iterator5=items,_isArray5=Array.isArray(_iterator5),_i5=0;for(_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();;){var _ref6;if(_isArray5){if(_i5>=_iterator5.length)break;_ref6=_iterator5[_i5++]}else{if((_i5=_iterator5.next()).done)break;_ref6=_i5.value}var item=_ref6;leaves.push(item.tx.hash())}return this.fromLeaves(leaves)},MerkleTree.fromItems=function(items){return(new this).fromItems(items)},MerkleTree.prototype.fromBlock=function(txs){var leaves=[];leaves.push(consensus.ZERO_HASH);for(var i=1;i<txs.length;i++){var tx=txs[i];leaves.push(tx.hash())}return this.fromLeaves(leaves)},MerkleTree.fromBlock=function(txs){return(new this).fromBlock(txs)},MerkleTree.prototype.fromLeaves=function(leaves){for(var len=leaves.length;len>1;){var hashes=[consensus.ZERO_HASH];this.steps.push(leaves[1]),len%2&&leaves.push(leaves[len-1]);for(var i=2;i<len;i+=2){var hash=hash256.root(leaves[i],leaves[i+1]);hashes.push(hash)}len=(leaves=hashes).length}return this},MerkleTree.fromLeaves=function(leaves){return(new this).fromLeaves(leaves)},MerkleTree}();(exports=BlockTemplate).BlockTemplate=BlockTemplate,exports.BlockEntry=BlockEntry,module.exports=exports}).call(this,require("buffer").Buffer)},{"../coins/coinview":13,"../primitives/address":69,"../primitives/block":70,"../primitives/input":74,"../primitives/output":81,"../primitives/tx":82,"../protocol/consensus":84,"../protocol/policy":89,"../script/script":95,"../utils/util":106,"./common":40,assert:146,"bcrypto/lib/hash256":160,"bcrypto/lib/merkle":177,buffer:269,bufio:270}],46:[function(require,module,exports){(function(Buffer){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),path=require("path"),EventEmitter=require("events"),bio=require("bufio"),fs=require("bfile"),dns=require("bdns"),IP=require("binet"),Logger=require("blgr"),base58=require("bstring").base58,ccmp=require("bcrypto/lib/ccmp"),hash160=require("bcrypto/lib/hash160"),hash256=require("bcrypto/lib/hash256"),random=require("bcrypto/lib/random"),secp256k1=require("bcrypto/lib/secp256k1"),consensus=require("../protocol/consensus"),packets=require("./packets"),common=require("./common"),BIP150=function(_EventEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(BIP150,_EventEmitter);function BIP150(bip151,host,outbound,db,key){_classCallCheck(this,BIP150);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return assert(bip151,"BIP150 requires BIP151."),assert("string"==typeof host,"Hostname required."),assert("boolean"==typeof outbound,"Outbound flag required."),assert(db instanceof AuthDB,"Auth DB required."),assert(Buffer.isBuffer(key),"Identity key required."),_this.bip151=bip151,_this.input=bip151.input,_this.output=bip151.output,_this.hostname=host,_this.outbound=outbound,_this.db=db,_this.privateKey=key,_this.publicKey=secp256k1.publicKeyCreate(key,!0),_this.peerIdentity=null,_this.challengeReceived=!1,_this.replyReceived=!1,_this.proposeReceived=!1,_this.challengeSent=!1,_this.auth=!1,_this.completed=!1,_this.job=null,_this.timeout=null,_this.onAuth=null,_this.init(),_this}return BIP150.prototype.init=function(){this.outbound&&(this.peerIdentity=this.db.getKnown(this.hostname))},BIP150.prototype.isAuthed=function(){return this.outbound?this.challengeSent&&this.challengeReceived:this.challengeReceived&&this.replyReceived},BIP150.prototype.challenge=function(hash){var type=this.outbound?"r":"i";if(assert(this.bip151.handshake,"No BIP151 handshake before challenge."),assert(!this.challengeReceived,"Peer challenged twice."),this.challengeReceived=!0,hash.equals(consensus.ZERO_HASH))throw new Error("Auth failure.");var msg=this.hash(this.input.sid,type,this.publicKey);if(!ccmp(hash,msg))return common.ZERO_SIG;this.isAuthed()&&(this.auth=!0,this.emit("auth"));var sig=secp256k1.sign(msg,this.privateKey);return secp256k1.fromDER(sig)},BIP150.prototype.reply=function(data){var type=this.outbound?"i":"r";if(assert(this.challengeSent,"Unsolicited reply."),assert(!this.replyReceived,"Peer replied twice."),this.replyReceived=!0,data.equals(common.ZERO_SIG))throw new Error("Auth failure.");if(!this.peerIdentity)return random.randomBytes(32);var sig=secp256k1.toDER(data),msg=this.hash(this.output.sid,type,this.peerIdentity);return secp256k1.verify(msg,sig,this.peerIdentity)?this.isAuthed()?(this.auth=!0,this.emit("auth"),null):(assert(this.outbound,"No challenge received before reply on inbound."),this.hash(this.input.sid,"p",this.publicKey)):random.randomBytes(32)},BIP150.prototype.propose=function(hash){assert(!this.outbound,"Outbound peer tried to propose."),assert(!this.challengeSent,"Unsolicited propose."),assert(!this.proposeReceived,"Peer proposed twice."),this.proposeReceived=!0;var match=this.findAuthorized(hash);return match?(this.peerIdentity=match,this.db.addKnown(this.hostname,this.peerIdentity),this.challengeSent=!0,this.hash(this.output.sid,"r",this.peerIdentity)):consensus.ZERO_HASH},BIP150.prototype.toChallenge=function(){assert(this.bip151.handshake,"No BIP151 handshake before challenge."),assert(this.outbound,"Cannot challenge an inbound connection."),assert(this.peerIdentity,"Cannot challenge without a peer identity.");var msg=this.hash(this.output.sid,"i",this.peerIdentity);return assert(!this.challengeSent,"Cannot initiate challenge twice."),this.challengeSent=!0,new packets.AuthChallengePacket(msg)},BIP150.prototype.rekey=function(sid,key,req,res){var seed=Buffer.allocUnsafe(130);return sid.copy(seed,0),key.copy(seed,32),req.copy(seed,64),res.copy(seed,97),hash256.digest(seed)},BIP150.prototype.rekeyInput=function(){var stream=this.input,req=this.peerIdentity,res=this.publicKey,k1=this.rekey(stream.sid,stream.k1,req,res),k2=this.rekey(stream.sid,stream.k2,req,res);stream.rekey(k1,k2)},BIP150.prototype.rekeyOutput=function(){var stream=this.output,req=this.publicKey,res=this.peerIdentity,k1=this.rekey(stream.sid,stream.k1,req,res),k2=this.rekey(stream.sid,stream.k2,req,res);stream.rekey(k1,k2)},BIP150.prototype.hash=function(sid,ch,key){var data=Buffer.allocUnsafe(66);return sid.copy(data,0),data[32]=ch.charCodeAt(0),key.copy(data,33),hash256.digest(data)},BIP150.prototype.findAuthorized=function(hash){var _iterator=this.db.authorized,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var key=_ref,msg=this.hash(this.output.sid,"p",key);if(ccmp(msg,hash))return key}return null},BIP150.prototype.destroy=function(){this.job&&this.reject(new Error("BIP150 stream was destroyed."))},BIP150.prototype.cleanup=function(){var job=this.job;return assert(!this.completed,"Already completed."),assert(job,"No completion job."),this.completed=!0,this.job=null,null!=this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.onAuth&&(this.removeListener("auth",this.onAuth),this.onAuth=null),job},BIP150.prototype.resolve=function(result){this.cleanup().resolve(result)},BIP150.prototype.reject=function(err){this.cleanup().reject(err)},BIP150.prototype.wait=function(timeout){var _this2=this;return new Promise(function(resolve,reject){_this2._wait(timeout,resolve,reject)})},BIP150.prototype._wait=function(timeout,resolve,reject){var _this3=this;assert(!this.auth,"Cannot wait for init after handshake."),this.job={resolve:resolve,reject:reject},!this.outbound||this.peerIdentity?(this.timeout=setTimeout(function(){_this3.reject(new Error("BIP150 handshake timed out."))},timeout),this.onAuth=this.resolve.bind(this),this.once("auth",this.onAuth)):this.reject(new Error("No identity for "+this.hostname+"."))},BIP150.prototype.getAddress=function(){return assert(this.peerIdentity,"Cannot serialize address."),BIP150.address(this.peerIdentity)},BIP150.address=function(key){var bw=bio.write(27);return bw.writeU8(15),bw.writeU16BE(65281),bw.writeBytes(hash160.digest(key)),bw.writeChecksum(hash256.digest),base58.encode(bw.render())},BIP150}(EventEmitter),AuthDB=function(){function AuthDB(options){_classCallCheck(this,AuthDB),this.logger=Logger.global,this.resolve=dns.lookup,this.prefix=null,this.dnsKnown=[],this.known=new Map,this.authorized=[],this.init(options)}return AuthDB.prototype.init=function(options){options&&(null!=options.logger&&(assert("object"===_typeof(options.logger)),this.logger=options.logger.context("authdb")),null!=options.resolve&&(assert("function"==typeof options.resolve),this.resolve=options.resolve),null!=options.knownPeers&&(assert("object"===_typeof(options.knownPeers)),this.setKnown(options.knownPeers)),null!=options.authPeers&&(assert(Array.isArray(options.authPeers)),this.setAuthorized(options.authPeers)),null!=options.prefix&&(assert("string"==typeof options.prefix),this.prefix=options.prefix))},AuthDB.prototype.open=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,this.readKnown();case 2:return _context.next=4,this.readAuth();case 4:return _context.next=6,this.lookup();case 6:case"end":return _context.stop()}},_callee,this)}));return function(){return _ref2.apply(this,arguments)}}(),AuthDB.prototype.close=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:case 1:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref3.apply(this,arguments)}}(),AuthDB.prototype.addKnown=function(host,key){assert("string"==typeof host,"Known host must be a string."),assert(Buffer.isBuffer(key)&&33===key.length,"Invalid public key for known peer.");var addr=IP.fromHostname(host);addr.type!==IP.types.DNS?this.known.set(host,key):this.dnsKnown.push([addr,key])},AuthDB.prototype.addAuthorized=function(key){assert(Buffer.isBuffer(key)&&33===key.length,"Invalid public key for authorized peer."),this.authorized.push(key)},AuthDB.prototype.setKnown=function(map){this.known.clear();var _iterator2=Object.keys(map),_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref4;if(_isArray2){if(_i2>=_iterator2.length)break;_ref4=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref4=_i2.value}var host=_ref4,key=map[host];this.addKnown(host,key)}},AuthDB.prototype.setAuthorized=function(keys){this.authorized.length=0;var _iterator3=keys,_isArray3=Array.isArray(_iterator3),_i3=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref5;if(_isArray3){if(_i3>=_iterator3.length)break;_ref5=_iterator3[_i3++]}else{if((_i3=_iterator3.next()).done)break;_ref5=_i3.value}var key=_ref5;this.addAuthorized(key)}},AuthDB.prototype.getKnown=function(hostname){var known=this.known.get(hostname);if(known)return known;var addr=IP.fromHostname(hostname);return this.known.get(addr.host)},AuthDB.prototype.lookup=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var jobs,_iterator4,_isArray4,_i4,_ref8,_ref7,addr,key;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:jobs=[],_iterator4=this.dnsKnown,_isArray4=Array.isArray(_iterator4),_i4=0,_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();case 2:if(!_isArray4){_context3.next=8;break}if(!(_i4>=_iterator4.length)){_context3.next=5;break}return _context3.abrupt("break",18);case 5:_ref8=_iterator4[_i4++],_context3.next=12;break;case 8:if(!(_i4=_iterator4.next()).done){_context3.next=11;break}return _context3.abrupt("break",18);case 11:_ref8=_i4.value;case 12:addr=(_ref7=_ref8)[0],key=_ref7[1],jobs.push(this.populate(addr,key));case 16:_context3.next=2;break;case 18:return _context3.next=20,Promise.all(jobs);case 20:case"end":return _context3.stop()}},_callee3,this)}));return function(){return _ref6.apply(this,arguments)}}(),AuthDB.prototype.populate=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(addr,key){var hosts,_iterator5,_isArray5,_i5,_ref10,host;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return assert(addr.type===IP.types.DNS,"Resolved host passed."),this.logger.info("Resolving authorized hosts from: %s.",addr.host),hosts=void 0,_context4.prev=3,_context4.next=6,this.resolve(addr.host);case 6:hosts=_context4.sent,_context4.next=13;break;case 9:return _context4.prev=9,_context4.t0=_context4.catch(3),this.logger.error(_context4.t0),_context4.abrupt("return");case 13:_iterator5=hosts,_isArray5=Array.isArray(_iterator5),_i5=0,_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();case 14:if(!_isArray5){_context4.next=20;break}if(!(_i5>=_iterator5.length)){_context4.next=17;break}return _context4.abrupt("break",29);case 17:_ref10=_iterator5[_i5++],_context4.next=24;break;case 20:if(!(_i5=_iterator5.next()).done){_context4.next=23;break}return _context4.abrupt("break",29);case 23:_ref10=_i5.value;case 24:host=_ref10,0!==addr.port&&(host=IP.toHostname(host,addr.port)),this.known.set(host,key);case 27:_context4.next=14;break;case 29:case"end":return _context4.stop()}},_callee4,this,[[3,9]])}));return function(_x,_x2){return _ref9.apply(this,arguments)}}(),AuthDB.prototype.readKnown=function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){var file,text;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(!fs.unsupported){_context5.next=2;break}return _context5.abrupt("return");case 2:if(this.prefix){_context5.next=4;break}return _context5.abrupt("return");case 4:return file=path.join(this.prefix,"known-peers"),text=void 0,_context5.prev=6,_context5.next=9,fs.readFile(file,"utf8");case 9:text=_context5.sent,_context5.next=17;break;case 12:if(_context5.prev=12,_context5.t0=_context5.catch(6),"ENOENT"!==_context5.t0.code){_context5.next=16;break}return _context5.abrupt("return");case 16:throw _context5.t0;case 17:this.parseKnown(text);case 18:case"end":return _context5.stop()}},_callee5,this,[[6,12]])}));return function(){return _ref11.apply(this,arguments)}}(),AuthDB.prototype.parseKnown=function(text){assert("string"==typeof text),65279===text.charCodeAt(0)&&(text=text.substring(1));var num=0,_iterator6=(text=(text=text.replace(/\r\n/g,"\n")).replace(/\r/g,"\n")).split("\n"),_isArray6=Array.isArray(_iterator6),_i6=0;for(_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();;){var _ref12;if(_isArray6){if(_i6>=_iterator6.length)break;_ref12=_iterator6[_i6++]}else{if((_i6=_iterator6.next()).done)break;_ref12=_i6.value}var line=_ref12.trim();if(num+=1,0!==line.length&&"#"!==line[0]){var parts=line.split(/\s+/);if(parts.length<2)throw new Error("No key present on line "+num+': "'+line+'".');var hosts=parts[0].split(","),host=void 0,addr=void 0;hosts.length>=2?(host=hosts[0],addr=hosts[1]):(host=null,addr=hosts[0]);var key=Buffer.from(parts[1],"hex");if(33!==key.length)throw new Error("Invalid key on line "+num+': "'+parts[1]+'".');host&&host.length>0&&this.addKnown(host,key),0!==addr.length&&this.addKnown(addr,key)}}},AuthDB.prototype.readAuth=function(){var _ref13=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(){var file,text;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(!fs.unsupported){_context6.next=2;break}return _context6.abrupt("return");case 2:if(this.prefix){_context6.next=4;break}return _context6.abrupt("return");case 4:return file=path.join(this.prefix,"authorized-peers"),text=void 0,_context6.prev=6,_context6.next=9,fs.readFile(file,"utf8");case 9:text=_context6.sent,_context6.next=17;break;case 12:if(_context6.prev=12,_context6.t0=_context6.catch(6),"ENOENT"!==_context6.t0.code){_context6.next=16;break}return _context6.abrupt("return");case 16:throw _context6.t0;case 17:this.parseAuth(text);case 18:case"end":return _context6.stop()}},_callee6,this,[[6,12]])}));return function(){return _ref13.apply(this,arguments)}}(),AuthDB.prototype.parseAuth=function(text){assert("string"==typeof text),65279===text.charCodeAt(0)&&(text=text.substring(1));var num=0,_iterator7=(text=(text=text.replace(/\r\n/g,"\n")).replace(/\r/g,"\n")).split("\n"),_isArray7=Array.isArray(_iterator7),_i7=0;for(_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();;){var _ref14;if(_isArray7){if(_i7>=_iterator7.length)break;_ref14=_iterator7[_i7++]}else{if((_i7=_iterator7.next()).done)break;_ref14=_i7.value}var line=_ref14.trim();if(num+=1,0!==line.length&&"#"!==line[0]){var key=Buffer.from(line,"hex");if(33!==key.length)throw new Error("Invalid key on line "+num+': "'+line+'".');this.addAuthorized(key)}}},AuthDB}();(exports=BIP150).BIP150=BIP150,exports.AuthDB=AuthDB,module.exports=exports}).call(this,require("buffer").Buffer)},{"../protocol/consensus":84,"./common":49,"./packets":54,assert:146,"bcrypto/lib/ccmp":156,"bcrypto/lib/hash160":159,"bcrypto/lib/hash256":160,"bcrypto/lib/random":180,"bcrypto/lib/secp256k1":184,bdns:197,bfile:201,binet:208,blgr:211,bstring:265,buffer:269,bufio:270,events:334,path:367}],47:[function(require,module,exports){(function(Buffer){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),EventEmitter=require("events"),format=require("util").format,bio=require("bufio"),util=require("../utils/util"),hash256=require("bcrypto/lib/hash256"),sha256=require("bcrypto/lib/sha256"),ChaCha20=require("bcrypto/lib/chacha20"),Poly1305=require("bcrypto/lib/poly1305"),AEAD=require("bcrypto/lib/aead"),hkdf=require("bcrypto/lib/hkdf"),secp256k1=require("bcrypto/lib/secp256k1"),packets=require("./packets"),common=require("./common"),encoding=bio.encoding,EncinitPacket=packets.EncinitPacket,EncackPacket=packets.EncackPacket,HKDF_SALT=Buffer.from("bitcoinecdh","ascii"),INFO_KEY1=Buffer.from("BitcoinK1","ascii"),INFO_KEY2=Buffer.from("BitcoinK2","ascii"),INFO_SID=Buffer.from("BitcoinSessionID","ascii"),BIP151Stream=function(){function BIP151Stream(cipher){_classCallCheck(this,BIP151Stream),this.cipher=BIP151.ciphers.CHACHAPOLY,this.privateKey=secp256k1.generatePrivateKey(),this.publicKey=null,this.k1=null,this.k2=null,this.sid=null,null!=cipher&&(assert(cipher===BIP151.ciphers.CHACHAPOLY,"Unknown cipher type."),this.cipher=cipher),this.chacha=new ChaCha20,this.aead=new AEAD,this.tag=null,this.seq=0,this.iv=Buffer.allocUnsafe(8),this.iv.fill(0),this.processed=0,this.lastRekey=0}return BIP151Stream.prototype.init=function(publicKey){assert(Buffer.isBuffer(publicKey)),this.publicKey=publicKey;var secret=secp256k1.ecdh(this.publicKey,this.privateKey),bw=bio.pool(33);bw.writeBytes(secret),bw.writeU8(this.cipher);var data=bw.render(),prk=hkdf.extract(sha256,data,HKDF_SALT);this.k1=hkdf.expand(sha256,prk,INFO_KEY1,32),this.k2=hkdf.expand(sha256,prk,INFO_KEY2,32),this.sid=hkdf.expand(sha256,prk,INFO_SID,32),this.seq=0,this.update(),this.chacha.init(this.k1,this.iv),this.aead.init(this.k2,this.iv),this.lastRekey=util.now()},BIP151Stream.prototype.shouldRekey=function(packet){var now=util.now();return this.processed+=packet.length,(now>=this.lastRekey+10||this.processed>=1073741824)&&(this.lastRekey=now,this.processed=0,!0)},BIP151Stream.prototype.rekey=function(k1,k2){assert(this.sid,"Cannot rekey before initialization."),k1?(this.k1=k1,this.k2=k2):(this.k1=hash256.root(this.sid,this.k1),this.k2=hash256.root(this.sid,this.k2)),assert(this.k1),assert(this.k2),this.chacha.init(this.k1,this.iv),this.aead.init(this.k2,this.iv)},BIP151Stream.prototype.sequence=function(){4294967296==++this.seq&&(this.seq=0),this.update(),this.chacha.init(null,this.iv),this.aead.init(null,this.iv)},BIP151Stream.prototype.update=function(){return this.iv.writeUInt32LE(this.seq,0,!0),this.iv},BIP151Stream.prototype.getPublicKey=function(){return secp256k1.publicKeyCreate(this.privateKey,!0)},BIP151Stream.prototype.encryptSize=function(data){return this.chacha.encrypt(data.slice(0,4))},BIP151Stream.prototype.decryptSize=function(data){return this.chacha.encrypt(data),data.readUInt32LE(0,!0)},BIP151Stream.prototype.encrypt=function(data){return this.aead.encrypt(data)},BIP151Stream.prototype.decrypt=function(data){return this.aead.chacha20.encrypt(data)},BIP151Stream.prototype.auth=function(data){return this.aead.auth(data)},BIP151Stream.prototype.final=function(){return this.tag=this.aead.final(),this.tag},BIP151Stream.prototype.verify=function(tag){return Poly1305.verify(this.tag,tag)},BIP151Stream}(),BIP151=function(_EventEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(BIP151,_EventEmitter);function BIP151(cipher){_classCallCheck(this,BIP151);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return _this.input=new BIP151Stream(cipher),_this.output=new BIP151Stream(cipher),_this.initReceived=!1,_this.ackReceived=!1,_this.initSent=!1,_this.ackSent=!1,_this.completed=!1,_this.handshake=!1,_this.pending=[],_this.total=0,_this.waiting=4,_this.hasSize=!1,_this.timeout=null,_this.job=null,_this.onShake=null,_this.bip150=null,_this}return BIP151.prototype.error=function(){var msg=format.apply(null,arguments);this.emit("error",new Error(msg))},BIP151.prototype.isReady=function(){return this.initSent&&this.ackReceived&&this.initReceived&&this.ackSent},BIP151.prototype.toEncinit=function(){return assert(!this.initSent,"Cannot init twice."),this.initSent=!0,new EncinitPacket(this.input.getPublicKey(),this.input.cipher)},BIP151.prototype.toEncack=function(){return assert(this.output.sid,"Cannot ack before init."),assert(!this.ackSent,"Cannot ack twice."),this.ackSent=!0,this.isReady()&&(assert(!this.completed,"No encack after timeout."),this.handshake=!0,this.emit("handshake")),new EncackPacket(this.output.getPublicKey())},BIP151.prototype.toRekey=function(){return assert(this.handshake,"Cannot rekey before handshake."),new EncackPacket(common.ZERO_KEY)},BIP151.prototype.encinit=function(publicKey,cipher){assert(cipher===this.output.cipher,"Cipher mismatch."),assert(!this.initReceived,"Already initialized."),assert(!this.completed,"No encinit after timeout."),this.initReceived=!0,this.output.init(publicKey)},BIP151.prototype.encack=function(publicKey){if(assert(this.initSent,"Unsolicited ACK."),publicKey.equals(common.ZERO_KEY))return assert(this.handshake,"No initialization before rekey."),this.bip150&&this.bip150.auth?void this.bip150.rekeyInput():void this.input.rekey();assert(!this.ackReceived,"Already ACKed."),assert(!this.completed,"No encack after timeout."),this.ackReceived=!0,this.input.init(publicKey),this.isReady()&&(this.handshake=!0,this.emit("handshake"))},BIP151.prototype.cleanup=function(){var job=this.job;return assert(!this.completed,"Already completed."),assert(job,"No completion job."),this.completed=!0,this.job=null,null!=this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.onShake&&(this.removeListener("handshake",this.onShake),this.onShake=null),job},BIP151.prototype.resolve=function(result){this.cleanup().resolve(result)},BIP151.prototype.reject=function(err){this.cleanup().reject(err)},BIP151.prototype.wait=function(timeout){var _this2=this;return new Promise(function(resolve,reject){_this2._wait(timeout,resolve,reject)})},BIP151.prototype._wait=function(timeout,resolve,reject){var _this3=this;assert(!this.handshake,"Cannot wait for init after handshake."),this.job={resolve:resolve,reject:reject},this.timeout=setTimeout(function(){_this3.reject(new Error("BIP151 handshake timed out."))},timeout),this.onShake=this.resolve.bind(this),this.once("handshake",this.onShake)},BIP151.prototype.destroy=function(){this.job&&this.reject(new Error("BIP151 stream was destroyed."))},BIP151.prototype.maybeRekey=function(packet){this.output.shouldRekey(packet)&&(this.emit("rekey"),this.bip150&&this.bip150.auth?this.bip150.rekeyOutput():this.output.rekey())},BIP151.prototype.packetSize=function(cmd,body){var size=0;return size+=4,size+=encoding.sizeVarString(cmd,"ascii"),size+=4,size+=body.length,size+=16},BIP151.prototype.packet=function(cmd,body){var size=this.packetSize(cmd,body),bw=bio.write(size),payloadSize=size-20;bw.writeU32(payloadSize),bw.writeVarString(cmd,"ascii"),bw.writeU32(body.length),bw.writeBytes(body),bw.seek(16);var msg=bw.render(),payload=msg.slice(4,4+payloadSize);return this.maybeRekey(msg),this.output.encryptSize(msg),this.output.encrypt(payload),this.output.final().copy(msg,4+payloadSize),this.output.sequence(),msg},BIP151.prototype.feed=function(data){for(this.total+=data.length,this.pending.push(data);this.total>=this.waiting;){var chunk=this.read(this.waiting);this.parse(chunk)}},BIP151.prototype.read=function(size){if(assert(this.total>=size,"Reading too much."),0===size)return Buffer.alloc(0);var pending=this.pending[0];if(pending.length>size){var _chunk=pending.slice(0,size);return this.pending[0]=pending.slice(size),this.total-=_chunk.length,_chunk}if(pending.length===size){var _chunk2=this.pending.shift();return this.total-=_chunk2.length,_chunk2}for(var chunk=Buffer.allocUnsafe(size),off=0;off<chunk.length;){var _pending=this.pending[0],len=_pending.copy(chunk,off);len===_pending.length?this.pending.shift():this.pending[0]=_pending.slice(len),off+=len}return assert.strictEqual(off,chunk.length),this.total-=chunk.length,chunk},BIP151.prototype.parse=function(data){if(!this.hasSize){var size=this.input.decryptSize(data);return assert(4===this.waiting),assert(4===data.length),size<6||size>BIP151.MAX_MESSAGE?void this.error("Bad packet size: %d.",size):(this.hasSize=!0,void(this.waiting=size+16))}var payload=data.slice(0,this.waiting-16),tag=data.slice(this.waiting-16,this.waiting);if(this.hasSize=!1,this.waiting=4,this.input.auth(payload),this.input.final(),!this.input.verify(tag))return this.input.sequence(),void this.error("Bad tag: %s.",tag.toString("hex"));this.input.decrypt(payload),this.input.sequence();for(var br=bio.read(payload);br.left();){var cmd=void 0,body=void 0;try{cmd=br.readVarString("ascii"),body=br.readBytes(br.readU32())}catch(e){return void this.emit("error",e)}this.emit("packet",cmd,body)}},BIP151}(EventEmitter);BIP151.ciphers={CHACHAPOLY:0},BIP151.MAX_MESSAGE=12e6,module.exports=BIP151}).call(this,require("buffer").Buffer)},{"../utils/util":106,"./common":49,"./packets":54,assert:146,"bcrypto/lib/aead":154,"bcrypto/lib/chacha20":157,"bcrypto/lib/hash256":160,"bcrypto/lib/hkdf":161,"bcrypto/lib/poly1305":179,"bcrypto/lib/secp256k1":184,"bcrypto/lib/sha256":186,buffer:269,bufio:270,events:334,util:428}],48:[function(require,module,exports){(function(Buffer){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),bio=require("bufio"),consensus=require("../protocol/consensus"),sha256=require("bcrypto/lib/sha256"),siphash=require("bcrypto/lib/siphash").siphash,AbstractBlock=require("../primitives/abstractblock"),TX=require("../primitives/tx"),Headers=require("../primitives/headers"),Block=require("../primitives/block"),common=require("./common"),encoding=bio.encoding,CompactBlock=function(_AbstractBlock){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(CompactBlock,_AbstractBlock);function CompactBlock(options){_classCallCheck(this,CompactBlock);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_AbstractBlock.call(this));return _this.keyNonce=null,_this.ids=[],_this.ptx=[],_this.available=[],_this.idMap=new Map,_this.count=0,_this.sipKey=null,_this.totalTX=0,_this.now=0,options&&_this.fromOptions(options),_this}return CompactBlock.prototype.fromOptions=function(options){return this.parseOptions(options),assert(Buffer.isBuffer(options.keyNonce)),assert(Array.isArray(options.ids)),assert(Array.isArray(options.ptx)),this.keyNonce=options.keyNonce,this.ids=options.ids,this.ptx=options.ptx,options.available&&(this.available=options.available),options.idMap&&(this.idMap=options.idMap),options.count&&(this.count=options.count),null!=options.totalTX&&(this.totalTX=options.totalTX),this.sipKey=this.getKey(),this},CompactBlock.fromOptions=function(options){return(new this).fromOptions(options)},CompactBlock.prototype.verifyBody=function(){return!0},CompactBlock.prototype.fromRaw=function(data){var br=bio.read(data);this.readHead(br),this.keyNonce=br.readBytes(8),this.sipKey=this.getKey();var idCount=br.readVarint();this.totalTX+=idCount;for(var i=0;i<idCount;i++){var lo=br.readU32(),hi=br.readU16();this.ids.push(4294967296*hi+lo)}var txCount=br.readVarint();this.totalTX+=txCount;for(var _i=0;_i<txCount;_i++){var index=br.readVarint();assert(index<=65535),assert(index<this.totalTX);var tx=TX.fromReader(br);this.ptx.push([index,tx])}return this},CompactBlock.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},CompactBlock.prototype.toRaw=function(){return this.frameRaw(!0)},CompactBlock.prototype.toNormal=function(){return this.frameRaw(!1)},CompactBlock.prototype.toWriter=function(bw){return this.writeRaw(bw,!0)},CompactBlock.prototype.toNormalWriter=function(bw){return this.writeRaw(bw,!1)},CompactBlock.prototype.frameRaw=function(witness){var size=this.getSize(witness);return this.writeRaw(bio.write(size),witness).render()},CompactBlock.prototype.getSize=function(witness){var size=0;size+=80,size+=8,size+=encoding.sizeVarint(this.ids.length),size+=6*this.ids.length,size+=encoding.sizeVarint(this.ptx.length);var _iterator=this.ptx,_isArray=Array.isArray(_iterator),_i2=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref2;if(_isArray){if(_i2>=_iterator.length)break;_ref2=_iterator[_i2++]}else{if((_i2=_iterator.next()).done)break;_ref2=_i2.value}var _ref=_ref2,index=_ref[0],tx=_ref[1];size+=encoding.sizeVarint(index),size+=witness?tx.getSize():tx.getBaseSize()}return size},CompactBlock.prototype.writeRaw=function(bw,witness){this.writeHead(bw),bw.writeBytes(this.keyNonce),bw.writeVarint(this.ids.length);var _iterator2=this.ids,_isArray2=Array.isArray(_iterator2),_i3=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref3;if(_isArray2){if(_i3>=_iterator2.length)break;_ref3=_iterator2[_i3++]}else{if((_i3=_iterator2.next()).done)break;_ref3=_i3.value}var lo=_ref3%4294967296,hi=(_ref3-lo)/4294967296;assert(hi<=65535),bw.writeU32(lo),bw.writeU16(hi)}bw.writeVarint(this.ptx.length);var _iterator3=this.ptx,_isArray3=Array.isArray(_iterator3),_i4=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref5;if(_isArray3){if(_i4>=_iterator3.length)break;_ref5=_iterator3[_i4++]}else{if((_i4=_iterator3.next()).done)break;_ref5=_i4.value}var _ref4=_ref5,index=_ref4[0],tx=_ref4[1];bw.writeVarint(index),witness?tx.toWriter(bw):tx.toNormalWriter(bw)}return bw},CompactBlock.prototype.toRequest=function(){return TXRequest.fromCompact(this)},CompactBlock.prototype.fillMempool=function(witness,mempool){if(this.count===this.totalTX)return!0;var set=new Set,_iterator4=mempool.map.values(),_isArray4=Array.isArray(_iterator4),_i5=0;for(_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();;){var _ref7;if(_isArray4){if(_i5>=_iterator4.length)break;_ref7=_iterator4[_i5++]}else{if((_i5=_iterator4.next()).done)break;_ref7=_i5.value}var tx=_ref7.tx,hash=tx.hash();witness&&(hash=tx.witnessHash());var id=this.sid(hash),index=this.idMap.get(id);if(null!=index)if(set.has(index))this.available[index]=null,this.count-=1;else if(this.available[index]=tx,set.add(index),this.count+=1,this.count===this.totalTX)return!0}return!1},CompactBlock.prototype.fillMissing=function(res){for(var offset=0,i=0;i<this.available.length;i++)if(!this.available[i]){if(offset>=res.txs.length)return!1;this.available[i]=res.txs[offset++]}return offset===res.txs.length},CompactBlock.prototype.sid=function(hash){"string"==typeof hash&&(hash=Buffer.from(hash,"hex"));var _siphash=siphash(hash,this.sipKey);return 4294967296*(65535&_siphash[0])+(_siphash[1]>>>0)},CompactBlock.prototype.hasIndex=function(index){return null!=this.available[index]},CompactBlock.prototype.getKey=function(){var data=Buffer.concat([this.toHead(),this.keyNonce]);return sha256.digest(data).slice(0,16)},CompactBlock.prototype.init=function(){if(0===this.totalTX)throw new Error("Empty vectors.");if(this.totalTX>consensus.MAX_BLOCK_SIZE/10)throw new Error("Compact block too big.");if(this.totalTX>(consensus.MAX_BLOCK_SIZE-81)/60)throw new Error("Compact block too big.");for(var i=0;i<this.totalTX;i++)this.available.push(null);for(var last=-1,offset=0,_i6=0;_i6<this.ptx.length;_i6++){var _ptx$_i=this.ptx[_i6],index=_ptx$_i[0],tx=_ptx$_i[1];assert((last+=index+1)<=65535),assert(last<=this.ids.length+_i6),this.available[last]=tx,this.count+=1}for(var _i7=0;_i7<this.ids.length;_i7++){for(var id=this.ids[_i7];this.available[_i7+offset];)offset+=1;if(this.idMap.has(id))return!1;this.idMap.set(id,_i7+offset)}return!0},CompactBlock.prototype.toBlock=function(){var block=new Block;block.version=this.version,block.prevBlock=this.prevBlock,block.merkleRoot=this.merkleRoot,block.time=this.time,block.bits=this.bits,block.nonce=this.nonce,block._hash=this._hash,block._hhash=this._hhash;var _iterator5=this.available,_isArray5=Array.isArray(_iterator5),_i8=0;for(_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();;){var _ref8;if(_isArray5){if(_i8>=_iterator5.length)break;_ref8=_iterator5[_i8++]}else{if((_i8=_iterator5.next()).done)break;_ref8=_i8.value}var tx=_ref8;assert(tx,"Compact block is not full."),block.txs.push(tx)}return block},CompactBlock.prototype.fromBlock=function(block,witness,nonce){this.version=block.version,this.prevBlock=block.prevBlock,this.merkleRoot=block.merkleRoot,this.time=block.time,this.bits=block.bits,this.nonce=block.nonce,this.totalTX=block.txs.length,this._hash=block._hash,this._hhash=block._hhash,nonce||(nonce=common.nonce()),this.keyNonce=nonce,this.sipKey=this.getKey();for(var i=1;i<block.txs.length;i++){var tx=block.txs[i],hash=tx.hash();witness&&(hash=tx.witnessHash());var id=this.sid(hash);this.ids.push(id)}return this.ptx.push([0,block.txs[0]]),this},CompactBlock.fromBlock=function(block,witness,nonce){return(new this).fromBlock(block,witness,nonce)},CompactBlock.prototype.toHeaders=function(){return Headers.fromBlock(this)},CompactBlock}(AbstractBlock),TXRequest=function(){function TXRequest(options){_classCallCheck(this,TXRequest),this.hash=consensus.NULL_HASH,this.indexes=[],options&&this.fromOptions(options)}return TXRequest.prototype.fromOptions=function(options){return this.hash=options.hash,options.indexes&&(this.indexes=options.indexes),this},TXRequest.fromOptions=function(options){return(new this).fromOptions(options)},TXRequest.prototype.fromCompact=function(block){this.hash=block.hash("hex");for(var i=0;i<block.available.length;i++)block.available[i]||this.indexes.push(i);return this},TXRequest.fromCompact=function(block){return(new this).fromCompact(block)},TXRequest.prototype.fromReader=function(br){this.hash=br.readHash("hex");for(var count=br.readVarint(),i=0;i<count;i++){var index=br.readVarint();assert(index<=65535),this.indexes.push(index)}for(var offset=0,_i9=0;_i9<count;_i9++){var _index=this.indexes[_i9];assert((_index+=offset)<=65535),this.indexes[_i9]=_index,offset=_index+1}return this},TXRequest.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},TXRequest.fromReader=function(br){return(new this).fromReader(br)},TXRequest.fromRaw=function(data){return(new this).fromRaw(data)},TXRequest.prototype.getSize=function(){var size=0;size+=32,size+=encoding.sizeVarint(this.indexes.length);for(var i=0;i<this.indexes.length;i++){var index=this.indexes[i];i>0&&(index-=this.indexes[i-1]+1),size+=encoding.sizeVarint(index)}return size},TXRequest.prototype.toWriter=function(bw){bw.writeHash(this.hash),bw.writeVarint(this.indexes.length);for(var i=0;i<this.indexes.length;i++){var index=this.indexes[i];i>0&&(index-=this.indexes[i-1]+1),bw.writeVarint(index)}return bw},TXRequest.prototype.toRaw=function(){var size=this.getSize();return this.toWriter(bio.write(size)).render()},TXRequest}(),TXResponse=function(){function TXResponse(options){_classCallCheck(this,TXResponse),this.hash=consensus.NULL_HASH,this.txs=[],options&&this.fromOptions(options)}return TXResponse.prototype.fromOptions=function(options){return this.hash=options.hash,options.txs&&(this.txs=options.txs),this},TXResponse.fromOptions=function(options){return(new this).fromOptions(options)},TXResponse.prototype.fromReader=function(br){this.hash=br.readHash("hex");for(var count=br.readVarint(),i=0;i<count;i++)this.txs.push(TX.fromReader(br));return this},TXResponse.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},TXResponse.fromReader=function(br){return(new this).fromReader(br)},TXResponse.fromRaw=function(data){return(new this).fromRaw(data)},TXResponse.prototype.fromBlock=function(block,req){this.hash=req.hash;var _iterator6=req.indexes,_isArray6=Array.isArray(_iterator6),_i10=0;for(_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();;){var _ref9;if(_isArray6){if(_i10>=_iterator6.length)break;_ref9=_iterator6[_i10++]}else{if((_i10=_iterator6.next()).done)break;_ref9=_i10.value}var index=_ref9;if(index>=block.txs.length)break;this.txs.push(block.txs[index])}return this},TXResponse.fromBlock=function(block,req){return(new this).fromBlock(block,req)},TXResponse.prototype.toRaw=function(){return this.frameRaw(!0)},TXResponse.prototype.toNormal=function(){return this.frameRaw(!1)},TXResponse.prototype.toWriter=function(bw){return this.writeRaw(bw,!0)},TXResponse.prototype.toNormalWriter=function(bw){return this.writeRaw(bw,!1)},TXResponse.prototype.getSize=function(witness){var size=0;size+=32,size+=encoding.sizeVarint(this.txs.length);var _iterator7=this.txs,_isArray7=Array.isArray(_iterator7),_i11=0;for(_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();;){var _ref10;if(_isArray7){if(_i11>=_iterator7.length)break;_ref10=_iterator7[_i11++]}else{if((_i11=_iterator7.next()).done)break;_ref10=_i11.value}var tx=_ref10;size+=witness?tx.getSize():tx.getBaseSize()}return size},TXResponse.prototype.writeRaw=function(bw,witness){bw.writeHash(this.hash),bw.writeVarint(this.txs.length);var _iterator8=this.txs,_isArray8=Array.isArray(_iterator8),_i12=0;for(_iterator8=_isArray8?_iterator8:_iterator8[Symbol.iterator]();;){var _ref11;if(_isArray8){if(_i12>=_iterator8.length)break;_ref11=_iterator8[_i12++]}else{if((_i12=_iterator8.next()).done)break;_ref11=_i12.value}var tx=_ref11;witness?tx.toWriter(bw):tx.toNormalWriter(bw)}return bw},TXResponse.prototype.frameRaw=function(witness){var size=this.getSize(witness);return this.writeRaw(bio.write(size),witness).render()},TXResponse}();exports.CompactBlock=CompactBlock,exports.TXRequest=TXRequest,exports.TXResponse=TXResponse}).call(this,require("buffer").Buffer)},{"../primitives/abstractblock":68,"../primitives/block":70,"../primitives/headers":72,"../primitives/tx":82,"../protocol/consensus":84,"./common":49,assert:146,"bcrypto/lib/sha256":186,"bcrypto/lib/siphash":188,buffer:269,bufio:270}],49:[function(require,module,exports){(function(Buffer){"use strict";var pkg=require("../pkg");exports.PROTOCOL_VERSION=70015,exports.MIN_VERSION=70001,exports.HEADERS_VERSION=31800,exports.PONG_VERSION=6e4,exports.BLOOM_VERSION=70011,exports.SENDHEADERS_VERSION=7012,exports.COMPACT_VERSION=70014,exports.COMPACT_WITNESS_VERSION=70015,exports.services={NETWORK:1,GETUTXO:2,BLOOM:4,CASH:32},exports.LOCAL_SERVICES=0|exports.services.NETWORK,exports.REQUIRED_SERVICES=0|exports.services.NETWORK,exports.USER_AGENT="/bcash:"+pkg.version+"/",exports.MAX_MESSAGE=8e6,exports.BAN_TIME=86400,exports.BAN_SCORE=100,exports.nonce=function(){var data=Buffer.allocUnsafe(8);return data.writeUInt32LE(4294967296*Math.random(),!0,0),data.writeUInt32LE(4294967296*Math.random(),!0,4),data},exports.ZERO_KEY=Buffer.alloc(33,0),exports.ZERO_SIG=Buffer.alloc(64,0),exports.ZERO_NONCE=Buffer.alloc(8,0)}).call(this,require("buffer").Buffer)},{"../pkg":67,buffer:269}],50:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),Network=require("../protocol/network"),hash256=require("bcrypto/lib/hash256"),Framer=function(){function Framer(network){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Framer),this.network=Network.get(network)}return Framer.prototype.packet=function(cmd,payload,checksum){assert(payload,"No payload."),assert(cmd.length<12),assert(payload.length<=4294967295);var msg=Buffer.allocUnsafe(24+payload.length);msg.writeUInt32LE(this.network.magic,0,!0),msg.write(cmd,4,"ascii");for(var i=4+cmd.length;i<16;i++)msg[i]=0;return msg.writeUInt32LE(payload.length,16,!0),checksum||(checksum=hash256.digest(payload)),checksum.copy(msg,20,0,4),payload.copy(msg,24),msg},Framer}();module.exports=Framer}).call(this,require("buffer").Buffer)},{"../protocol/network":87,assert:146,"bcrypto/lib/hash256":160,buffer:269}],51:[function(require,module,exports){(function(Buffer){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),path=require("path"),fs=require("bfile"),IP=require("binet"),dns=require("bdns"),Logger=require("blgr"),murmur3=require("bfilter").murmur3,util=require("../utils/util"),Network=require("../protocol/network"),NetAddress=require("./netaddress"),List=require("../utils/list"),common=require("./common"),seeds=require("./seeds"),POOL32=Buffer.allocUnsafe(32),HostList=function(){function HostList(options){_classCallCheck(this,HostList),this.options=new HostListOptions(options),this.network=this.options.network,this.logger=this.options.logger.context("hostlist"),this.address=this.options.address,this.resolve=this.options.resolve,this.dnsSeeds=[],this.dnsNodes=[],this.map=new Map,this.fresh=[],this.totalFresh=0,this.used=[],this.totalUsed=0,this.nodes=[],this.local=new Map,this.banned=new Map,this.timer=null,this.needsFlush=!1,this.flushing=!1,this.init()}return HostList.prototype.init=function(){for(var options=this.options,scores=HostList.scores,i=0;i<options.maxBuckets;i++)this.fresh.push(new Map);for(var _i=0;_i<options.maxBuckets;_i++)this.used.push(new List);this.setSeeds(options.seeds),this.setNodes(options.nodes),this.pushLocal(this.address,scores.MANUAL),this.addLocal(options.host,options.port,scores.BIND);var hosts=IP.getPublic(),port=this.address.port,_iterator=hosts,_isArray=Array.isArray(_iterator),_i2=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i2>=_iterator.length)break;_ref=_iterator[_i2++]}else{if((_i2=_iterator.next()).done)break;_ref=_i2.value}var host=_ref;this.addLocal(host,port,scores.IF)}},HostList.prototype.open=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,_context.next=3,this.loadFile();case 3:_context.next=9;break;case 5:_context.prev=5,_context.t0=_context.catch(0),this.logger.warning("Hosts deserialization failed."),this.logger.error(_context.t0);case 9:return 0===this.size()&&this.injectSeeds(),_context.next=12,this.discoverNodes();case 12:this.start();case 13:case"end":return _context.stop()}},_callee,this,[[0,5]])}));return function(){return _ref2.apply(this,arguments)}}(),HostList.prototype.close=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return this.stop(),_context2.next=3,this.flush();case 3:this.reset();case 4:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref3.apply(this,arguments)}}(),HostList.prototype.start=function(){var _this=this;this.options.memory||this.options.filename&&(assert(null==this.timer),this.timer=setInterval(function(){return _this.flush()},this.options.flushInterval))},HostList.prototype.stop=function(){this.options.memory||this.options.filename&&(assert(null!=this.timer),clearInterval(this.timer),this.timer=null)},HostList.prototype.injectSeeds=function(){var _iterator2=seeds.get(this.network.type),_isArray2=Array.isArray(_iterator2),_i3=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref4;if(_isArray2){if(_i3>=_iterator2.length)break;_ref4=_iterator2[_i3++]}else{if((_i3=_iterator2.next()).done)break;_ref4=_i3.value}var node=_ref4,addr=NetAddress.fromHostname(node,this.network);addr.isRoutable()&&(!this.options.onion&&addr.isOnion()||0!==addr.port&&this.add(addr))}},HostList.prototype.loadFile=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var filename,data,json;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(filename=this.options.filename,!fs.unsupported){_context3.next=3;break}return _context3.abrupt("return");case 3:if(!this.options.memory){_context3.next=5;break}return _context3.abrupt("return");case 5:if(filename){_context3.next=7;break}return _context3.abrupt("return");case 7:return data=void 0,_context3.prev=8,_context3.next=11,fs.readFile(filename,"utf8");case 11:data=_context3.sent,_context3.next=19;break;case 14:if(_context3.prev=14,_context3.t0=_context3.catch(8),"ENOENT"!==_context3.t0.code){_context3.next=18;break}return _context3.abrupt("return");case 18:throw _context3.t0;case 19:json=JSON.parse(data),this.fromJSON(json);case 21:case"end":return _context3.stop()}},_callee3,this,[[8,14]])}));return function(){return _ref5.apply(this,arguments)}}(),HostList.prototype.flush=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){var filename,json,data;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(filename=this.options.filename,!fs.unsupported){_context4.next=3;break}return _context4.abrupt("return");case 3:if(!this.options.memory){_context4.next=5;break}return _context4.abrupt("return");case 5:if(filename){_context4.next=7;break}return _context4.abrupt("return");case 7:if(this.needsFlush){_context4.next=9;break}return _context4.abrupt("return");case 9:if(!this.flushing){_context4.next=11;break}return _context4.abrupt("return");case 11:return this.needsFlush=!1,this.logger.debug("Writing hosts to %s.",filename),json=this.toJSON(),data=JSON.stringify(json),this.flushing=!0,_context4.prev=16,_context4.next=19,fs.writeFile(filename,data,"utf8");case 19:_context4.next=25;break;case 21:_context4.prev=21,_context4.t0=_context4.catch(16),this.logger.warning("Writing hosts failed."),this.logger.error(_context4.t0);case 25:this.flushing=!1;case 26:case"end":return _context4.stop()}},_callee4,this,[[16,21]])}));return function(){return _ref6.apply(this,arguments)}}(),HostList.prototype.size=function(){return this.totalFresh+this.totalUsed},HostList.prototype.isFull=function(){var max=this.options.maxBuckets*this.options.maxEntries;return this.size()>=max},HostList.prototype.reset=function(){this.map.clear();var _iterator3=this.fresh,_isArray3=Array.isArray(_iterator3),_i4=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref7;if(_isArray3){if(_i4>=_iterator3.length)break;_ref7=_iterator3[_i4++]}else{if((_i4=_iterator3.next()).done)break;_ref7=_i4.value}_ref7.clear()}var _iterator4=this.used,_isArray4=Array.isArray(_iterator4),_i5=0;for(_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();;){var _ref8;if(_isArray4){if(_i5>=_iterator4.length)break;_ref8=_iterator4[_i5++]}else{if((_i5=_iterator4.next()).done)break;_ref8=_i5.value}_ref8.reset()}this.totalFresh=0,this.totalUsed=0,this.nodes.length=0},HostList.prototype.ban=function(host){this.banned.set(host,util.now())},HostList.prototype.unban=function(host){this.banned.delete(host)},HostList.prototype.clearBanned=function(){this.banned.clear()},HostList.prototype.isBanned=function(host){var time=this.banned.get(host);return null!=time&&(!(util.now()>time+this.options.banTime)||(this.banned.delete(host),!1))},HostList.prototype.getHost=function(){var buckets=null;if(this.totalFresh>0&&(buckets=this.fresh),this.totalUsed>0&&(0!==this.totalFresh&&0!==random(2)||(buckets=this.used)),!buckets)return null;for(var now=this.network.now(),factor=1;;){var bucket=buckets[random(buckets.length)];if(0!==bucket.size){var index=random(bucket.size),entry=void 0;if(buckets===this.used)for(entry=bucket.head;index--;)entry=entry.next;else{var _iterator5=bucket.values(),_isArray5=Array.isArray(_iterator5),_i6=0;for(_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();;){if(_isArray5){if(_i6>=_iterator5.length)break;entry=_iterator5[_i6++]}else{if((_i6=_iterator5.next()).done)break;entry=_i6.value}if(0===index)break;index-=1}}if(random(1<<30)<factor*entry.chance(now)*(1<<30))return entry;factor*=1.2}}},HostList.prototype.freshBucket=function(entry){var addr=entry.addr,src=entry.src,data=function(left,right){var data=POOL32;return left.copy(data,0),right.copy(data,32),data}(addr.raw,src.raw),index=murmur3.sum(data,4221880213)%this.fresh.length;return this.fresh[index]},HostList.prototype.usedBucket=function(entry){var addr=entry.addr,index=murmur3.sum(addr.raw,4221880213)%this.used.length;return this.used[index]},HostList.prototype.add=function(addr,src){assert(0!==addr.port);var entry=this.map.get(addr.hostname);if(entry){var penalty=7200,interval=86400;src||(penalty=0),entry.addr.services|=addr.services,entry.addr.services>>>=0;if(this.network.now()-addr.time<86400&&(interval=3600),entry.addr.time<addr.time-interval-penalty&&(entry.addr.time=addr.time,this.needsFlush=!0),entry.addr.time&&addr.time<=entry.addr.time)return!1;if(entry.used)return!1;if(assert(entry.refCount>0),entry.refCount===HostList.MAX_REFS)return!1;assert(entry.refCount<HostList.MAX_REFS);for(var factor=1,i=0;i<entry.refCount;i++)factor*=2;if(0!==random(factor))return!1}else{if(this.isFull())return!1;src||(src=this.address),entry=new HostEntry(addr,src),this.totalFresh+=1}var bucket=this.freshBucket(entry);return!bucket.has(entry.key())&&(bucket.size>=this.options.maxEntries&&this.evictFresh(bucket),bucket.set(entry.key(),entry),entry.refCount+=1,this.map.set(entry.key(),entry),this.needsFlush=!0,!0)},HostList.prototype.evictFresh=function(bucket){var old=null,_iterator6=bucket.values(),_isArray6=Array.isArray(_iterator6),_i7=0;for(_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();;){var _ref9;if(_isArray6){if(_i7>=_iterator6.length)break;_ref9=_iterator6[_i7++]}else{if((_i7=_iterator6.next()).done)break;_ref9=_i7.value}var entry=_ref9;this.isStale(entry)?(bucket.delete(entry.key()),0==--entry.refCount&&(this.map.delete(entry.key()),this.totalFresh-=1)):old?entry.addr.time<old.addr.time&&(old=entry):old=entry}old&&(bucket.delete(old.key()),0==--old.refCount&&(this.map.delete(old.key()),this.totalFresh-=1))},HostList.prototype.isStale=function(entry){var now=this.network.now();return!(entry.lastAttempt&&entry.lastAttempt>=now-60)&&(entry.addr.time>now+600||(0===entry.addr.time||(now-entry.addr.time>24*HostList.HORIZON_DAYS*60*60||(0===entry.lastSuccess&&entry.attempts>=HostList.RETRIES||now-entry.lastSuccess>24*HostList.MIN_FAIL_DAYS*60*60&&entry.attempts>=HostList.MAX_FAILURES))))},HostList.prototype.remove=function(hostname){var entry=this.map.get(hostname);if(!entry)return null;if(entry.used){var head=entry;for(assert(0===entry.refCount);head.prev;)head=head.prev;var _iterator7=this.used,_isArray7=Array.isArray(_iterator7),_i8=0;for(_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();;){var _ref10;if(_isArray7){if(_i8>=_iterator7.length)break;_ref10=_iterator7[_i8++]}else{if((_i8=_iterator7.next()).done)break;_ref10=_i8.value}var bucket=_ref10;if(bucket.head===head){bucket.remove(entry),this.totalUsed-=1,head=null;break}}assert(!head)}else{var _iterator8=this.fresh,_isArray8=Array.isArray(_iterator8),_i9=0;for(_iterator8=_isArray8?_iterator8:_iterator8[Symbol.iterator]();;){var _ref11;if(_isArray8){if(_i9>=_iterator8.length)break;_ref11=_iterator8[_i9++]}else{if((_i9=_iterator8.next()).done)break;_ref11=_i9.value}_ref11.delete(entry.key())&&(entry.refCount-=1)}this.totalFresh-=1,assert(0===entry.refCount)}return this.map.delete(entry.key()),entry.addr},HostList.prototype.markAttempt=function(hostname){var entry=this.map.get(hostname),now=this.network.now();entry&&(entry.attempts+=1,entry.lastAttempt=now)},HostList.prototype.markSuccess=function(hostname){var entry=this.map.get(hostname),now=this.network.now();entry&&now-entry.addr.time>1200&&(entry.addr.time=now)},HostList.prototype.markAck=function(hostname,services){var entry=this.map.get(hostname);if(entry){var now=this.network.now();if(entry.addr.services|=services,entry.addr.services>>>=0,entry.lastSuccess=now,entry.lastAttempt=now,entry.attempts=0,!entry.used){assert(entry.refCount>0);var old=null,_iterator9=this.fresh,_isArray9=Array.isArray(_iterator9),_i10=0;for(_iterator9=_isArray9?_iterator9:_iterator9[Symbol.iterator]();;){var _ref12;if(_isArray9){if(_i10>=_iterator9.length)break;_ref12=_iterator9[_i10++]}else{if((_i10=_iterator9.next()).done)break;_ref12=_i10.value}var _bucket3=_ref12;_bucket3.delete(entry.key())&&(entry.refCount-=1,old=_bucket3)}assert(old),assert(0===entry.refCount),this.totalFresh-=1;var bucket=this.usedBucket(entry);if(bucket.size<this.options.maxEntries)return entry.used=!0,bucket.push(entry),void(this.totalUsed+=1);var evicted=this.evictUsed(bucket),fresh=this.freshBucket(evicted);fresh.size>=this.options.maxEntries&&(fresh=old),entry.used=!0,bucket.replace(evicted,entry),evicted.used=!1,fresh.set(evicted.key(),evicted),assert(0===evicted.refCount),evicted.refCount+=1,this.totalFresh+=1}}},HostList.prototype.evictUsed=function(bucket){for(var old=bucket.head,entry=bucket.head;entry;entry=entry.next)entry.addr.time<old.addr.time&&(old=entry);return old},HostList.prototype.toArray=function(){var out=[],_iterator10=this.map.values(),_isArray10=Array.isArray(_iterator10),_i11=0;for(_iterator10=_isArray10?_iterator10:_iterator10[Symbol.iterator]();;){var _ref13;if(_isArray10){if(_i11>=_iterator10.length)break;_ref13=_iterator10[_i11++]}else{if((_i11=_iterator10.next()).done)break;_ref13=_i11.value}var entry=_ref13;out.push(entry.addr)}return assert.strictEqual(out.length,this.size()),out},HostList.prototype.addSeed=function(host){var ip=IP.fromHostname(host,this.network.port);if(ip.type===IP.types.DNS)return this.dnsSeeds.push(ip),null;var addr=NetAddress.fromHost(ip.host,ip.port,this.network);return this.add(addr),addr},HostList.prototype.addNode=function(host){var ip=IP.fromHostname(host,this.network.port);if(ip.type===IP.types.DNS)return this.dnsNodes.push(ip),null;var addr=NetAddress.fromHost(ip.host,ip.port,this.network);return this.nodes.push(addr),this.add(addr),addr},HostList.prototype.removeNode=function(host){for(var addr=IP.fromHostname(host,this.network.port),i=0;i<this.nodes.length;i++){var node=this.nodes[i];if(node.host===addr.host&&node.port===addr.port)return this.nodes.splice(i,1),!0}return!1},HostList.prototype.setSeeds=function(seeds){this.dnsSeeds.length=0;var _iterator11=seeds,_isArray11=Array.isArray(_iterator11),_i12=0;for(_iterator11=_isArray11?_iterator11:_iterator11[Symbol.iterator]();;){var _ref14;if(_isArray11){if(_i12>=_iterator11.length)break;_ref14=_iterator11[_i12++]}else{if((_i12=_iterator11.next()).done)break;_ref14=_i12.value}var host=_ref14;this.addSeed(host)}},HostList.prototype.setNodes=function(nodes){this.dnsNodes.length=0,this.nodes.length=0;var _iterator12=nodes,_isArray12=Array.isArray(_iterator12),_i13=0;for(_iterator12=_isArray12?_iterator12:_iterator12[Symbol.iterator]();;){var _ref15;if(_isArray12){if(_i13>=_iterator12.length)break;_ref15=_iterator12[_i13++]}else{if((_i13=_iterator12.next()).done)break;_ref15=_i13.value}var host=_ref15;this.addNode(host)}},HostList.prototype.addLocal=function(host,port,score){var addr=NetAddress.fromHost(host,port,this.network);return addr.services=this.options.services,this.pushLocal(addr,score)},HostList.prototype.pushLocal=function(addr,score){if(!addr.isRoutable())return!1;if(this.local.has(addr.hostname))return!1;var local=new LocalAddress(addr,score);return this.local.set(addr.hostname,local),!0},HostList.prototype.getLocal=function(src){var bestReach=-1,bestScore=-1,bestDest=null;if(src||(src=this.address),0===this.local.size)return null;var _iterator13=this.local.values(),_isArray13=Array.isArray(_iterator13),_i14=0;for(_iterator13=_isArray13?_iterator13:_iterator13[Symbol.iterator]();;){var _ref16;if(_isArray13){if(_i14>=_iterator13.length)break;_ref16=_iterator13[_i14++]}else{if((_i14=_iterator13.next()).done)break;_ref16=_i14.value}var dest=_ref16,reach=src.getReachability(dest.addr);reach<bestReach||(reach>bestReach||dest.score>bestScore)&&(bestReach=reach,bestScore=dest.score,bestDest=dest.addr)}return bestDest.time=this.network.now(),bestDest},HostList.prototype.markLocal=function(addr){var local=this.local.get(addr.hostname);return!!local&&(local.score+=1,!0)},HostList.prototype.discoverSeeds=function(){var _ref17=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){var jobs,_iterator14,_isArray14,_i15,_ref18,seed;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:jobs=[],_iterator14=this.dnsSeeds,_isArray14=Array.isArray(_iterator14),_i15=0,_iterator14=_isArray14?_iterator14:_iterator14[Symbol.iterator]();case 2:if(!_isArray14){_context5.next=8;break}if(!(_i15>=_iterator14.length)){_context5.next=5;break}return _context5.abrupt("break",16);case 5:_ref18=_iterator14[_i15++],_context5.next=12;break;case 8:if(!(_i15=_iterator14.next()).done){_context5.next=11;break}return _context5.abrupt("break",16);case 11:_ref18=_i15.value;case 12:seed=_ref18,jobs.push(this.populateSeed(seed));case 14:_context5.next=2;break;case 16:return _context5.abrupt("return",Promise.all(jobs));case 17:case"end":return _context5.stop()}},_callee5,this)}));return function(){return _ref17.apply(this,arguments)}}(),HostList.prototype.discoverNodes=function(){var _ref19=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(){var jobs,_iterator15,_isArray15,_i16,_ref20,node;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:jobs=[],_iterator15=this.dnsNodes,_isArray15=Array.isArray(_iterator15),_i16=0,_iterator15=_isArray15?_iterator15:_iterator15[Symbol.iterator]();case 2:if(!_isArray15){_context6.next=8;break}if(!(_i16>=_iterator15.length)){_context6.next=5;break}return _context6.abrupt("break",16);case 5:_ref20=_iterator15[_i16++],_context6.next=12;break;case 8:if(!(_i16=_iterator15.next()).done){_context6.next=11;break}return _context6.abrupt("break",16);case 11:_ref20=_i16.value;case 12:node=_ref20,jobs.push(this.populateNode(node));case 14:_context6.next=2;break;case 16:return _context6.abrupt("return",Promise.all(jobs));case 17:case"end":return _context6.stop()}},_callee6,this)}));return function(){return _ref19.apply(this,arguments)}}(),HostList.prototype.populateNode=function(){var _ref21=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(addr){var addrs;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.next=2,this.populate(addr);case 2:if(0!==(addrs=_context7.sent).length){_context7.next=5;break}return _context7.abrupt("return");case 5:this.nodes.push(addrs[0]),this.add(addrs[0]);case 7:case"end":return _context7.stop()}},_callee7,this)}));return function(_x){return _ref21.apply(this,arguments)}}(),HostList.prototype.populateSeed=function(){var _ref22=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(seed){var addrs,_iterator16,_isArray16,_i17,_ref23,addr;return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return _context8.next=2,this.populate(seed);case 2:addrs=_context8.sent,_iterator16=addrs,_isArray16=Array.isArray(_iterator16),_i17=0,_iterator16=_isArray16?_iterator16:_iterator16[Symbol.iterator]();case 4:if(!_isArray16){_context8.next=10;break}if(!(_i17>=_iterator16.length)){_context8.next=7;break}return _context8.abrupt("break",18);case 7:_ref23=_iterator16[_i17++],_context8.next=14;break;case 10:if(!(_i17=_iterator16.next()).done){_context8.next=13;break}return _context8.abrupt("break",18);case 13:_ref23=_i17.value;case 14:addr=_ref23,this.add(addr);case 16:_context8.next=4;break;case 18:case"end":return _context8.stop()}},_callee8,this)}));return function(_x2){return _ref22.apply(this,arguments)}}(),HostList.prototype.populate=function(){var _ref24=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(target){var addrs,hosts,_iterator17,_isArray17,_i18,_ref25,host,addr;return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return addrs=[],assert(target.type===IP.types.DNS,"Resolved host passed."),this.logger.info("Resolving host: %s.",target.host),hosts=void 0,_context9.prev=4,_context9.next=7,this.resolve(target.host);case 7:hosts=_context9.sent,_context9.next=14;break;case 10:return _context9.prev=10,_context9.t0=_context9.catch(4),this.logger.error(_context9.t0),_context9.abrupt("return",addrs);case 14:_iterator17=hosts,_isArray17=Array.isArray(_iterator17),_i18=0,_iterator17=_isArray17?_iterator17:_iterator17[Symbol.iterator]();case 15:if(!_isArray17){_context9.next=21;break}if(!(_i18>=_iterator17.length)){_context9.next=18;break}return _context9.abrupt("break",30);case 18:_ref25=_iterator17[_i18++],_context9.next=25;break;case 21:if(!(_i18=_iterator17.next()).done){_context9.next=24;break}return _context9.abrupt("break",30);case 24:_ref25=_i18.value;case 25:host=_ref25,addr=NetAddress.fromHost(host,target.port,this.network),addrs.push(addr);case 28:_context9.next=15;break;case 30:return _context9.abrupt("return",addrs);case 31:case"end":return _context9.stop()}},_callee9,this,[[4,10]])}));return function(_x3){return _ref24.apply(this,arguments)}}(),HostList.prototype.toJSON=function(){var addrs=[],fresh=[],used=[],_iterator18=this.map.values(),_isArray18=Array.isArray(_iterator18),_i19=0;for(_iterator18=_isArray18?_iterator18:_iterator18[Symbol.iterator]();;){var _ref26;if(_isArray18){if(_i19>=_iterator18.length)break;_ref26=_iterator18[_i19++]}else{if((_i19=_iterator18.next()).done)break;_ref26=_i19.value}var entry=_ref26;addrs.push(entry.toJSON())}var _iterator19=this.fresh,_isArray19=Array.isArray(_iterator19),_i20=0;for(_iterator19=_isArray19?_iterator19:_iterator19[Symbol.iterator]();;){var _ref27;if(_isArray19){if(_i20>=_iterator19.length)break;_ref27=_iterator19[_i20++]}else{if((_i20=_iterator19.next()).done)break;_ref27=_i20.value}var keys=[],_iterator21=_ref27.keys(),_isArray21=Array.isArray(_iterator21),_i22=0;for(_iterator21=_isArray21?_iterator21:_iterator21[Symbol.iterator]();;){var _ref29;if(_isArray21){if(_i22>=_iterator21.length)break;_ref29=_iterator21[_i22++]}else{if((_i22=_iterator21.next()).done)break;_ref29=_i22.value}var key=_ref29;keys.push(key)}fresh.push(keys)}var _iterator20=this.used,_isArray20=Array.isArray(_iterator20),_i21=0;for(_iterator20=_isArray20?_iterator20:_iterator20[Symbol.iterator]();;){var _ref28;if(_isArray20){if(_i21>=_iterator20.length)break;_ref28=_iterator20[_i21++]}else{if((_i21=_iterator20.next()).done)break;_ref28=_i21.value}keys=[];for(var _entry=_ref28.head;_entry;_entry=_entry.next)keys.push(_entry.key());used.push(keys)}return{version:HostList.VERSION,network:this.network.type,addrs:addrs,fresh:fresh,used:used}},HostList.prototype.fromJSON=function(json){var sources=new Map,map=new Map,fresh=[],used=[],totalFresh=0,totalUsed=0;assert(json&&"object"===(void 0===json?"undefined":_typeof(json))),assert(!json.network||json.network===this.network.type,"Network mistmatch."),assert(json.version===HostList.VERSION,"Bad address serialization version."),assert(Array.isArray(json.addrs));var _iterator22=json.addrs,_isArray22=Array.isArray(_iterator22),_i23=0;for(_iterator22=_isArray22?_iterator22:_iterator22[Symbol.iterator]();;){var _ref30;if(_isArray22){if(_i23>=_iterator22.length)break;_ref30=_iterator22[_i23++]}else{if((_i23=_iterator22.next()).done)break;_ref30=_i23.value}var addr=_ref30,entry=HostEntry.fromJSON(addr,this.network),src=sources.get(entry.src.hostname);src||(src=entry.src,sources.set(src.hostname,src)),entry.src=src,map.set(entry.key(),entry)}assert(Array.isArray(json.fresh)),assert(json.fresh.length<=this.options.maxBuckets,"Buckets mismatch.");var _iterator23=json.fresh,_isArray23=Array.isArray(_iterator23),_i24=0;for(_iterator23=_isArray23?_iterator23:_iterator23[Symbol.iterator]();;){var _ref31;if(_isArray23){if(_i24>=_iterator23.length)break;_ref31=_iterator23[_i24++]}else{if((_i24=_iterator23.next()).done)break;_ref31=_i24.value}var keys=_ref31,bucket=new Map,_iterator26=keys,_isArray26=Array.isArray(_iterator26),_i27=0;for(_iterator26=_isArray26?_iterator26:_iterator26[Symbol.iterator]();;){var _ref34;if(_isArray26){if(_i27>=_iterator26.length)break;_ref34=_iterator26[_i27++]}else{if((_i27=_iterator26.next()).done)break;_ref34=_i27.value}var key=_ref34,_entry2=map.get(key);assert(_entry2),0===_entry2.refCount&&(totalFresh+=1),_entry2.refCount+=1,bucket.set(key,_entry2)}assert(bucket.size<=this.options.maxEntries,"Bucket size mismatch."),fresh.push(bucket)}assert(fresh.length===this.fresh.length,"Buckets mismatch."),assert(Array.isArray(json.used)),assert(json.used.length<=this.options.maxBuckets,"Buckets mismatch.");var _iterator24=json.used,_isArray24=Array.isArray(_iterator24),_i25=0;for(_iterator24=_isArray24?_iterator24:_iterator24[Symbol.iterator]();;){var _ref32;if(_isArray24){if(_i25>=_iterator24.length)break;_ref32=_iterator24[_i25++]}else{if((_i25=_iterator24.next()).done)break;_ref32=_i25.value}var _keys=_ref32,_iterator27=(bucket=new List,_keys),_isArray27=Array.isArray(_iterator27),_i28=0;for(_iterator27=_isArray27?_iterator27:_iterator27[Symbol.iterator]();;){var _ref35;if(_isArray27){if(_i28>=_iterator27.length)break;_ref35=_iterator27[_i28++]}else{if((_i28=_iterator27.next()).done)break;_ref35=_i28.value}var _key=_ref35,_entry3=map.get(_key);assert(_entry3),assert(0===_entry3.refCount),assert(!_entry3.used),_entry3.used=!0,totalUsed+=1,bucket.push(_entry3)}assert(bucket.size<=this.options.maxEntries,"Bucket size mismatch."),used.push(bucket)}assert(used.length===this.used.length,"Buckets mismatch.");var _iterator25=map.values(),_isArray25=Array.isArray(_iterator25),_i26=0;for(_iterator25=_isArray25?_iterator25:_iterator25[Symbol.iterator]();;){var _ref33;if(_isArray25){if(_i26>=_iterator25.length)break;_ref33=_iterator25[_i26++]}else{if((_i26=_iterator25.next()).done)break;_ref33=_i26.value}assert((entry=_ref33).used||entry.refCount>0)}return this.map=map,this.fresh=fresh,this.totalFresh=totalFresh,this.used=used,this.totalUsed=totalUsed,this},HostList.fromJSON=function(options,json){return new this(options).fromJSON(json)},HostList}();HostList.HORIZON_DAYS=30,HostList.RETRIES=3,HostList.MIN_FAIL_DAYS=7,HostList.MAX_FAILURES=10,HostList.MAX_REFS=8,HostList.VERSION=0,HostList.scores={NONE:0,IF:1,BIND:2,UPNP:3,DNS:3,MANUAL:4,MAX:5};var HostEntry=function(){function HostEntry(addr,src){_classCallCheck(this,HostEntry),this.addr=addr||new NetAddress,this.src=src||new NetAddress,this.prev=null,this.next=null,this.used=!1,this.refCount=0,this.attempts=0,this.lastSuccess=0,this.lastAttempt=0,addr&&this.fromOptions(addr,src)}return HostEntry.prototype.fromOptions=function(addr,src){return assert(addr instanceof NetAddress),assert(src instanceof NetAddress),this.addr=addr,this.src=src,this},HostEntry.fromOptions=function(addr,src){return(new this).fromOptions(addr,src)},HostEntry.prototype.key=function(){return this.addr.hostname},HostEntry.prototype.chance=function(now){var c=1;return now-this.lastAttempt<600&&(c*=.01),c*=Math.pow(.66,Math.min(this.attempts,8))},HostEntry.prototype.inspect=function(){return{addr:this.addr,src:this.src,used:this.used,refCount:this.refCount,attempts:this.attempts,lastSuccess:util.date(this.lastSuccess),lastAttempt:util.date(this.lastAttempt)}},HostEntry.prototype.toJSON=function(){return{addr:this.addr.hostname,src:this.src.hostname,services:this.addr.services.toString(2),time:this.addr.time,attempts:this.attempts,lastSuccess:this.lastSuccess,lastAttempt:this.lastAttempt}},HostEntry.prototype.fromJSON=function(json,network){if(assert(json&&"object"===(void 0===json?"undefined":_typeof(json))),assert("string"==typeof json.addr),assert("string"==typeof json.src),this.addr.fromHostname(json.addr,network),null!=json.services){assert("string"==typeof json.services),assert(json.services.length>0),assert(json.services.length<=32);var services=parseInt(json.services,2);assert(services>>>0===services),this.addr.services=services}return null!=json.time&&(assert(Number.isSafeInteger(json.time)),assert(json.time>=0),this.addr.time=json.time),null!=json.src&&(assert("string"==typeof json.src),this.src.fromHostname(json.src,network)),null!=json.attempts&&(assert(json.attempts>>>0===json.attempts),this.attempts=json.attempts),null!=json.lastSuccess&&(assert(Number.isSafeInteger(json.lastSuccess)),assert(json.lastSuccess>=0),this.lastSuccess=json.lastSuccess),null!=json.lastAttempt&&(assert(Number.isSafeInteger(json.lastAttempt)),assert(json.lastAttempt>=0),this.lastAttempt=json.lastAttempt),this},HostEntry.fromJSON=function(json,network){return(new this).fromJSON(json,network)},HostEntry}(),LocalAddress=function LocalAddress(addr,score){_classCallCheck(this,LocalAddress),this.addr=addr,this.score=score||0},HostListOptions=function(){function HostListOptions(options){_classCallCheck(this,HostListOptions),this.network=Network.primary,this.logger=Logger.global,this.resolve=dns.lookup,this.host="0.0.0.0",this.port=this.network.port,this.services=common.LOCAL_SERVICES,this.onion=!1,this.banTime=common.BAN_TIME,this.address=new NetAddress,this.address.services=this.services,this.address.time=this.network.now(),this.seeds=this.network.seeds,this.nodes=[],this.maxBuckets=20,this.maxEntries=50,this.prefix=null,this.filename=null,this.memory=!0,this.flushInterval=12e4,options&&this.fromOptions(options)}return HostListOptions.prototype.fromOptions=function(options){if(assert(options,"Options are required."),null!=options.network&&(this.network=Network.get(options.network),this.seeds=this.network.seeds,this.address.port=this.network.port,this.port=this.network.port),null!=options.logger&&(assert("object"===_typeof(options.logger)),this.logger=options.logger),null!=options.resolve&&(assert("function"==typeof options.resolve),this.resolve=options.resolve),null!=options.banTime&&(assert(options.banTime>=0),this.banTime=options.banTime),options.seeds&&(assert(Array.isArray(options.seeds)),this.seeds=options.seeds),options.nodes&&(assert(Array.isArray(options.nodes)),this.nodes=options.nodes),null!=options.host){assert("string"==typeof options.host);var raw=IP.toBuffer(options.host);this.host=IP.toString(raw),IP.isRoutable(raw)&&this.address.setHost(this.host)}return null!=options.port&&(assert("number"==typeof options.port),assert(options.port>0&&options.port<=65535),this.port=options.port,this.address.setPort(this.port)),null!=options.publicHost&&(assert("string"==typeof options.publicHost),this.address.setHost(options.publicHost)),null!=options.publicPort&&(assert("number"==typeof options.publicPort),assert(options.publicPort>0&&options.publicPort<=65535),this.address.setPort(options.publicPort)),null!=options.services&&(assert("number"==typeof options.services),this.services=options.services),null!=options.onion&&(assert("boolean"==typeof options.onion),this.onion=options.onion),null!=options.maxBuckets&&(assert("number"==typeof options.maxBuckets),this.maxBuckets=options.maxBuckets),null!=options.maxEntries&&(assert("number"==typeof options.maxEntries),this.maxEntries=options.maxEntries),null!=options.memory&&(assert("boolean"==typeof options.memory),this.memory=options.memory),null!=options.prefix&&(assert("string"==typeof options.prefix),this.prefix=options.prefix,this.filename=path.join(this.prefix,"hosts.json")),null!=options.filename&&(assert("string"==typeof options.filename),this.filename=options.filename),null!=options.flushInterval&&(assert(options.flushInterval>=0),this.flushInterval=options.flushInterval),this.address.time=this.network.now(),this.address.services=this.services,this},HostListOptions}();function random(max){return Math.floor(Math.random()*max)}module.exports=HostList}).call(this,require("buffer").Buffer)},{"../protocol/network":87,"../utils/list":104,"../utils/util":106,"./common":49,"./netaddress":53,"./seeds":58,assert:146,bdns:197,bfile:201,bfilter:203,binet:208,blgr:211,buffer:269,path:367}],52:[function(require,module,exports){"use strict";exports.BIP150=require("./bip150"),exports.BIP151=require("./bip151"),exports.bip152=require("./bip152"),exports.common=require("./common"),exports.Framer=require("./framer"),exports.HostList=require("./hostlist"),exports.NetAddress=require("./netaddress"),exports.packets=require("./packets"),exports.Parser=require("./parser"),exports.Peer=require("./peer"),exports.Pool=require("./pool")},{"./bip150":46,"./bip151":47,"./bip152":48,"./common":49,"./framer":50,"./hostlist":51,"./netaddress":53,"./packets":54,"./parser":55,"./peer":56,"./pool":57}],53:[function(require,module,exports){"use strict";var assert=require("assert"),bio=require("bufio"),IP=require("binet"),Network=require("../protocol/network"),util=require("../utils/util"),common=require("./common"),NetAddress=function(){function NetAddress(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,NetAddress),this.host="0.0.0.0",this.port=0,this.services=0,this.time=0,this.hostname="0.0.0.0:0",this.raw=IP.ZERO_IP,options&&this.fromOptions(options)}return NetAddress.prototype.fromOptions=function(options){return assert("string"==typeof options.host),assert("number"==typeof options.port),this.raw=IP.toBuffer(options.host),this.host=IP.toString(this.raw),this.port=options.port,options.services&&(assert("number"==typeof options.services),this.services=options.services),options.time&&(assert("number"==typeof options.time),this.time=options.time),this.hostname=IP.toHostname(this.host,this.port),this},NetAddress.fromOptions=function(options){return(new this).fromOptions(options)},NetAddress.prototype.hasServices=function(services){return(this.services&services)===services},NetAddress.isIPv4=function(){return IP.isIPv4(this.raw)},NetAddress.isIPv6=function(){return IP.isIPv6(this.raw)},NetAddress.prototype.isNull=function(){return IP.isNull(this.raw)},NetAddress.prototype.isLocal=function(){return IP.isLocal(this.raw)},NetAddress.prototype.isValid=function(){return IP.isValid(this.raw)},NetAddress.prototype.isRoutable=function(){return IP.isRoutable(this.raw)},NetAddress.prototype.isOnion=function(){return IP.isOnion(this.raw)},NetAddress.prototype.equal=function(addr){return 0===this.compare(addr)},NetAddress.prototype.compare=function(addr){var cmp=this.raw.compare(addr.raw);return 0!==cmp?cmp:this.port-addr.port},NetAddress.prototype.getReachability=function(dest){return IP.getReachability(this.raw,dest.raw)},NetAddress.prototype.setNull=function(){this.raw=IP.ZERO_IP,this.host="0.0.0.0",this.hostname=IP.toHostname(this.host,this.port)},NetAddress.prototype.setHost=function(host){this.raw=IP.toBuffer(host),this.host=IP.toString(this.raw),this.hostname=IP.toHostname(this.host,this.port)},NetAddress.prototype.setPort=function(port){assert(port>=0&&port<=65535),this.port=port,this.hostname=IP.toHostname(this.host,port)},NetAddress.prototype.fromHost=function(host,port,network){return network=Network.get(network),assert(port>=0&&port<=65535),this.raw=IP.toBuffer(host),this.host=IP.toString(this.raw),this.port=port,this.services=NetAddress.DEFAULT_SERVICES,this.time=network.now(),this.hostname=IP.toHostname(this.host,this.port),this},NetAddress.fromHost=function(host,port,network){return(new this).fromHost(host,port,network)},NetAddress.prototype.fromHostname=function(hostname,network){network=Network.get(network);var addr=IP.fromHostname(hostname,network.port);return this.fromHost(addr.host,addr.port,network)},NetAddress.fromHostname=function(hostname,network){return(new this).fromHostname(hostname,network)},NetAddress.prototype.fromSocket=function(socket,network){var host=socket.remoteAddress,port=socket.remotePort;return assert("string"==typeof host),assert("number"==typeof port),this.fromHost(IP.normalize(host),port,network)},NetAddress.fromSocket=function(hostname,network){return(new this).fromSocket(hostname,network)},NetAddress.prototype.fromReader=function(br,full){return this.time=full?br.readU32():0,this.services=br.readU32(),br.readU32(),this.raw=br.readBytes(16),this.host=IP.toString(this.raw),this.port=br.readU16BE(),this.hostname=IP.toHostname(this.host,this.port),this},NetAddress.prototype.fromRaw=function(data,full){return this.fromReader(bio.read(data),full)},NetAddress.fromReader=function(br,full){return(new this).fromReader(br,full)},NetAddress.fromRaw=function(data,full){return(new this).fromRaw(data,full)},NetAddress.prototype.toWriter=function(bw,full){return full&&bw.writeU32(this.time),bw.writeU32(this.services),bw.writeU32(0),bw.writeBytes(this.raw),bw.writeU16BE(this.port),bw},NetAddress.prototype.getSize=function(full){return 26+(full?4:0)},NetAddress.prototype.toRaw=function(full){var size=this.getSize(full);return this.toWriter(bio.write(size),full).render()},NetAddress.prototype.toJSON=function(){return{host:this.host,port:this.port,services:this.services,time:this.time}},NetAddress.prototype.fromJSON=function(json){return assert((65535&json.port)===json.port),assert(json.services>>>0===json.services),assert(json.time>>>0===json.time),this.raw=IP.toBuffer(json.host),this.host=json.host,this.port=json.port,this.services=json.services,this.time=json.time,this.hostname=IP.toHostname(this.host,this.port),this},NetAddress.fromJSON=function(json){return(new this).fromJSON(json)},NetAddress.prototype.inspect=function(){return"<NetAddress: hostname="+this.hostname+" services="+this.services.toString(2)+" date="+util.date(this.time)+">"},NetAddress}();NetAddress.DEFAULT_SERVICES=0|common.services.NETWORK|common.services.BLOOM,module.exports=NetAddress},{"../protocol/network":87,"../utils/util":106,"./common":49,assert:146,binet:208,bufio:270}],54:[function(require,module,exports){(function(Buffer){"use strict";function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),bio=require("bufio"),BloomFilter=require("bfilter").BloomFilter,common=require("./common"),util=require("../utils/util"),bip152=require("./bip152"),NetAddress=require("./netaddress"),consensus=require("../protocol/consensus"),Headers=require("../primitives/headers"),InvItem=require("../primitives/invitem"),MemBlock=require("../primitives/memblock"),MerkleBlock=require("../primitives/merkleblock"),TX=require("../primitives/tx"),encoding=bio.encoding,DUMMY=Buffer.alloc(0);exports.types={VERSION:0,VERACK:1,PING:2,PONG:3,GETADDR:4,ADDR:5,INV:6,GETDATA:7,NOTFOUND:8,GETBLOCKS:9,GETHEADERS:10,HEADERS:11,SENDHEADERS:12,BLOCK:13,TX:14,REJECT:15,MEMPOOL:16,FILTERLOAD:17,FILTERADD:18,FILTERCLEAR:19,MERKLEBLOCK:20,FEEFILTER:21,SENDCMPCT:22,CMPCTBLOCK:23,GETBLOCKTXN:24,BLOCKTXN:25,ENCINIT:26,ENCACK:27,AUTHCHALLENGE:28,AUTHREPLY:29,AUTHPROPOSE:30,UNKNOWN:31,INTERNAL:32,DATA:33},exports.typesByVal=["VERSION","VERACK","PING","PONG","GETADDR","ADDR","INV","GETDATA","NOTFOUND","GETBLOCKS","GETHEADERS","HEADERS","SENDHEADERS","BLOCK","TX","REJECT","MEMPOOL","FILTERLOAD","FILTERADD","FILTERCLEAR","MERKLEBLOCK","FEEFILTER","SENDCMPCT","CMPCTBLOCK","GETBLOCKTXN","BLOCKTXN","ENCINIT","ENCACK","AUTHCHALLENGE","AUTHREPLY","AUTHPROPOSE","UNKNOWN","INTERNAL","DATA"];var Packet=function(){function Packet(){_classCallCheck(this,Packet),this.type=-1,this.cmd=""}return Packet.prototype.getSize=function(){return 0},Packet.prototype.toWriter=function(bw){return bw},Packet.prototype.toRaw=function(){return DUMMY},Packet.prototype.fromReader=function(br){return this},Packet.prototype.fromRaw=function(data){return this},Packet}(),VersionPacket=function(_Packet){_inherits(VersionPacket,_Packet);function VersionPacket(options){_classCallCheck(this,VersionPacket);var _this=_possibleConstructorReturn(this,_Packet.call(this));return _this.cmd="version",_this.type=exports.types.VERSION,_this.version=common.PROTOCOL_VERSION,_this.services=common.LOCAL_SERVICES,_this.time=util.now(),_this.remote=new NetAddress,_this.local=new NetAddress,_this.nonce=common.ZERO_NONCE,_this.agent=common.USER_AGENT,_this.height=0,_this.noRelay=!1,options&&_this.fromOptions(options),_this}return VersionPacket.prototype.fromOptions=function(options){return null!=options.version&&(this.version=options.version),null!=options.services&&(this.services=options.services),null!=options.time&&(this.time=options.time),options.remote&&this.remote.fromOptions(options.remote),options.local&&this.local.fromOptions(options.local),options.nonce&&(this.nonce=options.nonce),options.agent&&(this.agent=options.agent),null!=options.height&&(this.height=options.height),null!=options.noRelay&&(this.noRelay=options.noRelay),this},VersionPacket.fromOptions=function(options){return(new this).fromOptions(options)},VersionPacket.prototype.getSize=function(){var size=0;return size+=20,size+=this.remote.getSize(!1),size+=this.local.getSize(!1),size+=8,size+=encoding.sizeVarString(this.agent,"ascii"),size+=5},VersionPacket.prototype.toWriter=function(bw){return bw.writeI32(this.version),bw.writeU32(this.services),bw.writeU32(0),bw.writeI64(this.time),this.remote.toWriter(bw,!1),this.local.toWriter(bw,!1),bw.writeBytes(this.nonce),bw.writeVarString(this.agent,"ascii"),bw.writeI32(this.height),bw.writeU8(this.noRelay?0:1),bw},VersionPacket.prototype.toRaw=function(){var size=this.getSize();return this.toWriter(bio.write(size)).render()},VersionPacket.prototype.fromReader=function(br){return this.version=br.readI32(),this.services=br.readU32(),br.readU32(),this.time=br.readI64(),this.remote.fromReader(br,!1),br.left()>0&&(this.local.fromReader(br,!1),this.nonce=br.readBytes(8)),br.left()>0&&(this.agent=br.readVarString("ascii",256)),br.left()>0&&(this.height=br.readI32()),br.left()>0&&(this.noRelay=0===br.readU8()),10300===this.version&&(this.version=300),assert(this.version>=0,"Version is negative."),assert(this.time>=0,"Timestamp is negative."),this.height<0&&(this.height=0),this},VersionPacket.fromReader=function(br){return(new this).fromReader(br)},VersionPacket.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},VersionPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data,enc)},VersionPacket}(Packet),VerackPacket=function(_Packet2){_inherits(VerackPacket,_Packet2);function VerackPacket(){_classCallCheck(this,VerackPacket);var _this2=_possibleConstructorReturn(this,_Packet2.call(this));return _this2.cmd="verack",_this2.type=exports.types.VERACK,_this2}return VerackPacket.fromReader=function(br){return(new this).fromReader(br)},VerackPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},VerackPacket}(Packet),PingPacket=function(_Packet3){_inherits(PingPacket,_Packet3);function PingPacket(nonce){_classCallCheck(this,PingPacket);var _this3=_possibleConstructorReturn(this,_Packet3.call(this));return _this3.cmd="ping",_this3.type=exports.types.PING,_this3.nonce=nonce||null,_this3}return PingPacket.prototype.getSize=function(){return this.nonce?8:0},PingPacket.prototype.toRaw=function(){var size=this.getSize();return this.toWriter(bio.write(size)).render()},PingPacket.prototype.toWriter=function(bw){return this.nonce&&bw.writeBytes(this.nonce),bw},PingPacket.prototype.fromReader=function(br){return br.left()>=8&&(this.nonce=br.readBytes(8)),this},PingPacket.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},PingPacket.fromReader=function(br){return(new this).fromRaw(br)},PingPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},PingPacket}(Packet),PongPacket=function(_Packet4){_inherits(PongPacket,_Packet4);function PongPacket(nonce){_classCallCheck(this,PongPacket);var _this4=_possibleConstructorReturn(this,_Packet4.call(this));return _this4.cmd="pong",_this4.type=exports.types.PONG,_this4.nonce=nonce||common.ZERO_NONCE,_this4}return PongPacket.prototype.getSize=function(){return 8},PongPacket.prototype.toWriter=function(bw){return bw.writeBytes(this.nonce),bw},PongPacket.prototype.toRaw=function(){return this.toWriter(bio.write(8)).render()},PongPacket.prototype.fromReader=function(br){return this.nonce=br.readBytes(8),this},PongPacket.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},PongPacket.fromReader=function(br){return(new this).fromReader(br)},PongPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},PongPacket}(Packet),GetAddrPacket=function(_Packet5){_inherits(GetAddrPacket,_Packet5);function GetAddrPacket(){_classCallCheck(this,GetAddrPacket);var _this5=_possibleConstructorReturn(this,_Packet5.call(this));return _this5.cmd="getaddr",_this5.type=exports.types.GETADDR,_this5}return GetAddrPacket.fromReader=function(br){return(new this).fromReader(br)},GetAddrPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},GetAddrPacket}(Packet),AddrPacket=function(_Packet6){_inherits(AddrPacket,_Packet6);function AddrPacket(items){_classCallCheck(this,AddrPacket);var _this6=_possibleConstructorReturn(this,_Packet6.call(this));return _this6.cmd="addr",_this6.type=exports.types.ADDR,_this6.items=items||[],_this6}return AddrPacket.prototype.getSize=function(){var size=0;return size+=encoding.sizeVarint(this.items.length),size+=30*this.items.length},AddrPacket.prototype.toWriter=function(bw){bw.writeVarint(this.items.length);var _iterator=this.items,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}_ref.toWriter(bw,!0)}return bw},AddrPacket.prototype.toRaw=function(){var size=this.getSize();return this.toWriter(bio.write(size)).render()},AddrPacket.prototype.fromRaw=function(data){for(var br=bio.read(data),count=br.readVarint(),i=0;i<count;i++)this.items.push(NetAddress.fromReader(br,!0));return this},AddrPacket.fromReader=function(br){return(new this).fromReader(br)},AddrPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},AddrPacket}(Packet),InvPacket=function(_Packet7){_inherits(InvPacket,_Packet7);function InvPacket(items){_classCallCheck(this,InvPacket);var _this7=_possibleConstructorReturn(this,_Packet7.call(this));return _this7.cmd="inv",_this7.type=exports.types.INV,_this7.items=items||[],_this7}return InvPacket.prototype.getSize=function(){var size=0;return size+=encoding.sizeVarint(this.items.length),size+=36*this.items.length},InvPacket.prototype.toWriter=function(bw){assert(this.items.length<=5e4),bw.writeVarint(this.items.length);var _iterator2=this.items,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref2=_i2.value}_ref2.toWriter(bw)}return bw},InvPacket.prototype.toRaw=function(){var size=this.getSize();return this.toWriter(bio.write(size)).render()},InvPacket.prototype.fromReader=function(br){var count=br.readVarint();assert(count<=5e4,"Inv item count too high.");for(var i=0;i<count;i++)this.items.push(InvItem.fromReader(br));return this},InvPacket.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},InvPacket.fromReader=function(br){return(new this).fromRaw(br)},InvPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},InvPacket}(Packet),GetDataPacket=function(_InvPacket){_inherits(GetDataPacket,_InvPacket);function GetDataPacket(items){_classCallCheck(this,GetDataPacket);var _this8=_possibleConstructorReturn(this,_InvPacket.call(this,items));return _this8.cmd="getdata",_this8.type=exports.types.GETDATA,_this8}return GetDataPacket.fromReader=function(br){return(new this).fromReader(br)},GetDataPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},GetDataPacket}(InvPacket),NotFoundPacket=function(_InvPacket2){_inherits(NotFoundPacket,_InvPacket2);function NotFoundPacket(items){_classCallCheck(this,NotFoundPacket);var _this9=_possibleConstructorReturn(this,_InvPacket2.call(this,items));return _this9.cmd="notfound",_this9.type=exports.types.NOTFOUND,_this9}return NotFoundPacket.fromReader=function(br){return(new this).fromReader(br)},NotFoundPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},NotFoundPacket}(InvPacket),GetBlocksPacket=function(_Packet8){_inherits(GetBlocksPacket,_Packet8);function GetBlocksPacket(locator,stop){_classCallCheck(this,GetBlocksPacket);var _this10=_possibleConstructorReturn(this,_Packet8.call(this));return _this10.cmd="getblocks",_this10.type=exports.types.GETBLOCKS,_this10.version=common.PROTOCOL_VERSION,_this10.locator=locator||[],_this10.stop=stop||null,_this10}return GetBlocksPacket.prototype.getSize=function(){var size=0;return size+=4,size+=encoding.sizeVarint(this.locator.length),size+=32*this.locator.length,size+=32},GetBlocksPacket.prototype.toWriter=function(bw){assert(this.locator.length<=5e4,"Too many block hashes."),bw.writeU32(this.version),bw.writeVarint(this.locator.length);var _iterator3=this.locator,_isArray3=Array.isArray(_iterator3),_i3=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref3;if(_isArray3){if(_i3>=_iterator3.length)break;_ref3=_iterator3[_i3++]}else{if((_i3=_iterator3.next()).done)break;_ref3=_i3.value}var hash=_ref3;bw.writeHash(hash)}return bw.writeHash(this.stop||consensus.ZERO_HASH),bw},GetBlocksPacket.prototype.toRaw=function(){var size=this.getSize();return this.toWriter(bio.write(size)).render()},GetBlocksPacket.prototype.fromReader=function(br){this.version=br.readU32();var count=br.readVarint();assert(count<=5e4,"Too many block hashes.");for(var i=0;i<count;i++)this.locator.push(br.readHash("hex"));return this.stop=br.readHash("hex"),this.stop===consensus.NULL_HASH&&(this.stop=null),this},GetBlocksPacket.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},GetBlocksPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},GetBlocksPacket}(Packet),GetHeadersPacket=function(_GetBlocksPacket){_inherits(GetHeadersPacket,_GetBlocksPacket);function GetHeadersPacket(locator,stop){_classCallCheck(this,GetHeadersPacket);var _this11=_possibleConstructorReturn(this,_GetBlocksPacket.call(this,locator,stop));return _this11.cmd="getheaders",_this11.type=exports.types.GETHEADERS,_this11}return GetHeadersPacket.fromReader=function(br){return(new this).fromReader(br)},GetHeadersPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},GetHeadersPacket}(GetBlocksPacket),HeadersPacket=function(_Packet9){_inherits(HeadersPacket,_Packet9);function HeadersPacket(items){_classCallCheck(this,HeadersPacket);var _this12=_possibleConstructorReturn(this,_Packet9.call(this));return _this12.cmd="headers",_this12.type=exports.types.HEADERS,_this12.items=items||[],_this12}return HeadersPacket.prototype.getSize=function(){var size=0;size+=encoding.sizeVarint(this.items.length);var _iterator4=this.items,_isArray4=Array.isArray(_iterator4),_i4=0;for(_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();;){var _ref4;if(_isArray4){if(_i4>=_iterator4.length)break;_ref4=_iterator4[_i4++]}else{if((_i4=_iterator4.next()).done)break;_ref4=_i4.value}size+=_ref4.getSize()}return size},HeadersPacket.prototype.toWriter=function(bw){assert(this.items.length<=2e3,"Too many headers."),bw.writeVarint(this.items.length);var _iterator5=this.items,_isArray5=Array.isArray(_iterator5),_i5=0;for(_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();;){var _ref5;if(_isArray5){if(_i5>=_iterator5.length)break;_ref5=_iterator5[_i5++]}else{if((_i5=_iterator5.next()).done)break;_ref5=_i5.value}_ref5.toWriter(bw)}return bw},HeadersPacket.prototype.toRaw=function(){var size=this.getSize();return this.toWriter(bio.write(size)).render()},HeadersPacket.prototype.fromReader=function(br){var count=br.readVarint();assert(count<=2e3,"Too many headers.");for(var i=0;i<count;i++)this.items.push(Headers.fromReader(br));return this},HeadersPacket.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},HeadersPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},HeadersPacket}(Packet),SendHeadersPacket=function(_Packet10){_inherits(SendHeadersPacket,_Packet10);function SendHeadersPacket(){_classCallCheck(this,SendHeadersPacket);var _this13=_possibleConstructorReturn(this,_Packet10.call(this));return _this13.cmd="sendheaders",_this13.type=exports.types.SENDHEADERS,_this13}return SendHeadersPacket.fromReader=function(br){return(new this).fromReader(br)},SendHeadersPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},SendHeadersPacket}(Packet),BlockPacket=function(_Packet11){_inherits(BlockPacket,_Packet11);function BlockPacket(block){_classCallCheck(this,BlockPacket);var _this14=_possibleConstructorReturn(this,_Packet11.call(this));return _this14.cmd="block",_this14.type=exports.types.BLOCK,_this14.block=block||new MemBlock,_this14}return BlockPacket.prototype.getSize=function(){return this.block.getBaseSize()},BlockPacket.prototype.toWriter=function(bw){return this.block.toNormalWriter(bw)},BlockPacket.prototype.toRaw=function(){return this.block.toNormal()},BlockPacket.prototype.fromReader=function(br){return this.block.fromReader(br),this},BlockPacket.prototype.fromRaw=function(data){return this.block.fromRaw(data),this},BlockPacket.fromReader=function(br){return(new this).fromReader(br)},BlockPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},BlockPacket}(Packet),TXPacket=function(_Packet12){_inherits(TXPacket,_Packet12);function TXPacket(tx){_classCallCheck(this,TXPacket);var _this15=_possibleConstructorReturn(this,_Packet12.call(this));return _this15.cmd="tx",_this15.type=exports.types.TX,_this15.tx=tx||new TX,_this15}return TXPacket.prototype.getSize=function(){return this.tx.getBaseSize()},TXPacket.prototype.toWriter=function(bw){return this.tx.toNormalWriter(bw)},TXPacket.prototype.toRaw=function(){return this.tx.toNormal()},TXPacket.prototype.fromReader=function(br){return this.tx.fromRaw(br),this},TXPacket.prototype.fromRaw=function(data){return this.tx.fromRaw(data),this},TXPacket.fromReader=function(br){return(new this).fromReader(br)},TXPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},TXPacket}(Packet),RejectPacket=function(_Packet13){_inherits(RejectPacket,_Packet13);function RejectPacket(options){_classCallCheck(this,RejectPacket);var _this16=_possibleConstructorReturn(this,_Packet13.call(this));return _this16.cmd="reject",_this16.type=exports.types.REJECT,_this16.message="",_this16.code=RejectPacket.codes.INVALID,_this16.reason="",_this16.hash=null,options&&_this16.fromOptions(options),_this16}return RejectPacket.prototype.fromOptions=function(options){var code=options.code;return options.message&&(this.message=options.message),null!=code&&("string"==typeof code&&(code=RejectPacket.codes[code.toUpperCase()]),code>=RejectPacket.codes.INTERNAL&&(code=RejectPacket.codes.INVALID),this.code=code),options.reason&&(this.reason=options.reason),options.hash&&(this.hash=options.hash),this},RejectPacket.fromOptions=function(options){return(new this).fromOptions(options)},RejectPacket.prototype.rhash=function(){return this.hash?util.revHex(this.hash):null},RejectPacket.prototype.getCode=function(){var code=RejectPacket.codesByVal[this.code];return code?code.toLowerCase():this.code.toString(10)},RejectPacket.prototype.getSize=function(){var size=0;return size+=encoding.sizeVarString(this.message,"ascii"),size+=1,size+=encoding.sizeVarString(this.reason,"ascii"),this.hash&&(size+=32),size},RejectPacket.prototype.toWriter=function(bw){return assert(this.message.length<=12),assert(this.reason.length<=111),bw.writeVarString(this.message,"ascii"),bw.writeU8(this.code),bw.writeVarString(this.reason,"ascii"),this.hash&&bw.writeHash(this.hash),bw},RejectPacket.prototype.toRaw=function(){var size=this.getSize();return this.toWriter(bio.write(size)).render()},RejectPacket.prototype.fromReader=function(br){switch(this.message=br.readVarString("ascii",12),this.code=br.readU8(),this.reason=br.readVarString("ascii",111),this.message){case"block":case"tx":this.hash=br.readHash("hex");break;default:this.hash=null}return this},RejectPacket.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},RejectPacket.fromReader=function(br){return(new this).fromReader(br)},RejectPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data,enc)},RejectPacket.prototype.fromReason=function(code,reason,msg,hash){return"string"==typeof code&&(code=RejectPacket.codes[code.toUpperCase()]),code||(code=RejectPacket.codes.INVALID),code>=RejectPacket.codes.INTERNAL&&(code=RejectPacket.codes.INVALID),this.message="",this.code=code,this.reason=reason,msg&&(assert(hash),this.message=msg,this.hash=hash),this},RejectPacket.fromReason=function(code,reason,msg,hash){return(new this).fromReason(code,reason,msg,hash)},RejectPacket.fromError=function(err,obj){return this.fromReason(err.code,err.reason,obj)},RejectPacket.prototype.inspect=function(){var code=RejectPacket.codesByVal[this.code]||this.code,hash=this.hash?util.revHex(this.hash):null;return"<Reject: msg="+this.message+" code="+code+" reason="+this.reason+" hash="+hash+">"},RejectPacket}(Packet);RejectPacket.codes={MALFORMED:1,INVALID:16,OBSOLETE:17,DUPLICATE:18,NONSTANDARD:64,DUST:65,INSUFFICIENTFEE:66,CHECKPOINT:67,INTERNAL:256,HIGHFEE:257,ALREADYKNOWN:258,CONFLICT:259},RejectPacket.codesByVal={1:"MALFORMED",16:"INVALID",17:"OBSOLETE",18:"DUPLICATE",64:"NONSTANDARD",65:"DUST",66:"INSUFFICIENTFEE",67:"CHECKPOINT",256:"INTERNAL",257:"HIGHFEE",258:"ALREADYKNOWN",259:"CONFLICT"};var MempoolPacket=function(_Packet14){_inherits(MempoolPacket,_Packet14);function MempoolPacket(){_classCallCheck(this,MempoolPacket);var _this17=_possibleConstructorReturn(this,_Packet14.call(this));return _this17.cmd="mempool",_this17.type=exports.types.MEMPOOL,_this17}return MempoolPacket.fromReader=function(br){return(new this).fromReader(br)},MempoolPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},MempoolPacket}(Packet),FilterLoadPacket=function(_Packet15){_inherits(FilterLoadPacket,_Packet15);function FilterLoadPacket(filter){_classCallCheck(this,FilterLoadPacket);var _this18=_possibleConstructorReturn(this,_Packet15.call(this));return _this18.cmd="filterload",_this18.type=exports.types.FILTERLOAD,_this18.filter=filter||new BloomFilter,_this18}return FilterLoadPacket.prototype.getSize=function(){return this.filter.getSize()},FilterLoadPacket.prototype.toWriter=function(bw){return this.filter.toWriter(bw)},FilterLoadPacket.prototype.toRaw=function(){return this.filter.toRaw()},FilterLoadPacket.prototype.fromReader=function(br){return this.filter.fromReader(br),this},FilterLoadPacket.prototype.fromRaw=function(data){return this.filter.fromRaw(data),this},FilterLoadPacket.fromReader=function(br){return(new this).fromReader(br)},FilterLoadPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},FilterLoadPacket.prototype.isWithinConstraints=function(){return this.filter.isWithinConstraints()},FilterLoadPacket}(Packet),FilterAddPacket=function(_Packet16){_inherits(FilterAddPacket,_Packet16);function FilterAddPacket(data){_classCallCheck(this,FilterAddPacket);var _this19=_possibleConstructorReturn(this,_Packet16.call(this));return _this19.cmd="filteradd",_this19.type=exports.types.FILTERADD,_this19.data=data||DUMMY,_this19}return FilterAddPacket.prototype.getSize=function(){return encoding.sizeVarBytes(this.data)},FilterAddPacket.prototype.toWriter=function(bw){return bw.writeVarBytes(this.data),bw},FilterAddPacket.prototype.toRaw=function(){var size=this.getSize();return this.toWriter(bio.write(size)).render()},FilterAddPacket.prototype.fromReader=function(br){return this.data=br.readVarBytes(),this},FilterAddPacket.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},FilterAddPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},FilterAddPacket}(Packet),FilterClearPacket=function(_Packet17){_inherits(FilterClearPacket,_Packet17);function FilterClearPacket(){_classCallCheck(this,FilterClearPacket);var _this20=_possibleConstructorReturn(this,_Packet17.call(this));return _this20.cmd="filterclear",_this20.type=exports.types.FILTERCLEAR,_this20}return FilterClearPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},FilterClearPacket}(Packet),MerkleBlockPacket=function(_Packet18){_inherits(MerkleBlockPacket,_Packet18);function MerkleBlockPacket(block){_classCallCheck(this,MerkleBlockPacket);var _this21=_possibleConstructorReturn(this,_Packet18.call(this));return _this21.cmd="merkleblock",_this21.type=exports.types.MERKLEBLOCK,_this21.block=block||new MerkleBlock,_this21}return MerkleBlockPacket.prototype.getSize=function(){return this.block.getSize()},MerkleBlockPacket.prototype.toWriter=function(bw){return this.block.toWriter(bw)},MerkleBlockPacket.prototype.toRaw=function(){return this.block.toRaw()},MerkleBlockPacket.prototype.fromReader=function(br){return this.block.fromReader(br),this},MerkleBlockPacket.prototype.fromRaw=function(data){return this.block.fromRaw(data),this},MerkleBlockPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},MerkleBlockPacket}(Packet),FeeFilterPacket=function(_Packet19){_inherits(FeeFilterPacket,_Packet19);function FeeFilterPacket(rate){_classCallCheck(this,FeeFilterPacket);var _this22=_possibleConstructorReturn(this,_Packet19.call(this));return _this22.cmd="feefilter",_this22.type=exports.types.FEEFILTER,_this22.rate=rate||0,_this22}return FeeFilterPacket.prototype.getSize=function(){return 8},FeeFilterPacket.prototype.toWriter=function(bw){return bw.writeI64(this.rate),bw},FeeFilterPacket.prototype.toRaw=function(){return this.toWriter(bio.write(8)).render()},FeeFilterPacket.prototype.fromReader=function(br){return this.rate=br.readI64(),this},FeeFilterPacket.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},FeeFilterPacket.fromReader=function(br){return(new this).fromReader(br)},FeeFilterPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},FeeFilterPacket}(Packet),SendCmpctPacket=function(_Packet20){_inherits(SendCmpctPacket,_Packet20);function SendCmpctPacket(mode,version){_classCallCheck(this,SendCmpctPacket);var _this23=_possibleConstructorReturn(this,_Packet20.call(this));return _this23.cmd="sendcmpct",_this23.type=exports.types.SENDCMPCT,_this23.mode=mode||0,_this23.version=version||1,_this23}return SendCmpctPacket.prototype.getSize=function(){return 9},SendCmpctPacket.prototype.toWriter=function(bw){return bw.writeU8(this.mode),bw.writeU64(this.version),bw},SendCmpctPacket.prototype.toRaw=function(){return this.toWriter(bio.write(9)).render()},SendCmpctPacket.prototype.fromReader=function(br){return this.mode=br.readU8(),this.version=br.readU64(),this},SendCmpctPacket.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},SendCmpctPacket.fromReader=function(br){return(new this).fromReader(br)},SendCmpctPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},SendCmpctPacket}(Packet),CmpctBlockPacket=function(_Packet21){_inherits(CmpctBlockPacket,_Packet21);function CmpctBlockPacket(block){_classCallCheck(this,CmpctBlockPacket);var _this24=_possibleConstructorReturn(this,_Packet21.call(this));return _this24.cmd="cmpctblock",_this24.type=exports.types.CMPCTBLOCK,_this24.block=block||new bip152.CompactBlock,_this24}return CmpctBlockPacket.prototype.getSize=function(){return this.block.getSize(!1)},CmpctBlockPacket.prototype.toWriter=function(bw){return this.block.toNormalWriter(bw)},CmpctBlockPacket.prototype.toRaw=function(){return this.block.toNormal()},CmpctBlockPacket.prototype.fromReader=function(br){return this.block.fromReader(br),this},CmpctBlockPacket.prototype.fromRaw=function(data){return this.block.fromRaw(data),this},CmpctBlockPacket.fromReader=function(br){return(new this).fromRaw(br)},CmpctBlockPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},CmpctBlockPacket}(Packet),GetBlockTxnPacket=function(_Packet22){_inherits(GetBlockTxnPacket,_Packet22);function GetBlockTxnPacket(request){_classCallCheck(this,GetBlockTxnPacket);var _this25=_possibleConstructorReturn(this,_Packet22.call(this));return _this25.cmd="getblocktxn",_this25.type=exports.types.GETBLOCKTXN,_this25.request=request||new bip152.TXRequest,_this25}return GetBlockTxnPacket.prototype.getSize=function(){return this.request.getSize()},GetBlockTxnPacket.prototype.toWriter=function(bw){return this.request.toWriter(bw)},GetBlockTxnPacket.prototype.toRaw=function(){return this.request.toRaw()},GetBlockTxnPacket.prototype.fromReader=function(br){return this.request.fromReader(br),this},GetBlockTxnPacket.prototype.fromRaw=function(data){return this.request.fromRaw(data),this},GetBlockTxnPacket.fromReader=function(br){return(new this).fromReader(br)},GetBlockTxnPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},GetBlockTxnPacket}(Packet),BlockTxnPacket=function(_Packet23){_inherits(BlockTxnPacket,_Packet23);function BlockTxnPacket(response){_classCallCheck(this,BlockTxnPacket);var _this26=_possibleConstructorReturn(this,_Packet23.call(this));return _this26.cmd="blocktxn",_this26.type=exports.types.BLOCKTXN,_this26.response=response||new bip152.TXResponse,_this26}return BlockTxnPacket.prototype.getSize=function(){return this.response.getSize(!1)},BlockTxnPacket.prototype.toWriter=function(bw){return this.response.toNormalWriter(bw)},BlockTxnPacket.prototype.toRaw=function(){return this.response.toNormal()},BlockTxnPacket.prototype.fromReader=function(br){return this.response.fromReader(br),this},BlockTxnPacket.prototype.fromRaw=function(data){return this.response.fromRaw(data),this},BlockTxnPacket.fromReader=function(br){return(new this).fromReader(br)},BlockTxnPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},BlockTxnPacket}(Packet),EncinitPacket=function(_Packet24){_inherits(EncinitPacket,_Packet24);function EncinitPacket(publicKey,cipher){_classCallCheck(this,EncinitPacket);var _this27=_possibleConstructorReturn(this,_Packet24.call(this));return _this27.cmd="encinit",_this27.type=exports.types.ENCINIT,_this27.publicKey=publicKey||common.ZERO_KEY,_this27.cipher=cipher||0,_this27}return EncinitPacket.prototype.getSize=function(){return 34},EncinitPacket.prototype.toWriter=function(bw){return bw.writeBytes(this.publicKey),bw.writeU8(this.cipher),bw},EncinitPacket.prototype.toRaw=function(){return this.toWriter(bio.write(34)).render()},EncinitPacket.prototype.fromReader=function(br){return this.publicKey=br.readBytes(33),this.cipher=br.readU8(),this},EncinitPacket.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},EncinitPacket.fromReader=function(br){return(new this).fromReader(br)},EncinitPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},EncinitPacket}(Packet),EncackPacket=function(_Packet25){_inherits(EncackPacket,_Packet25);function EncackPacket(publicKey){_classCallCheck(this,EncackPacket);var _this28=_possibleConstructorReturn(this,_Packet25.call(this));return _this28.cmd="encack",_this28.type=exports.types.ENCACK,_this28.publicKey=publicKey||common.ZERO_KEY,_this28}return EncackPacket.prototype.getSize=function(){return 33},EncackPacket.prototype.toWriter=function(bw){return bw.writeBytes(this.publicKey),bw},EncackPacket.prototype.toRaw=function(){return this.publicKey},EncackPacket.prototype.fromReader=function(br){return this.publicKey=br.readBytes(33),this},EncackPacket.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},EncackPacket.fromReader=function(br){return(new this).fromReader(br)},EncackPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},EncackPacket}(Packet),AuthChallengePacket=function(_Packet26){_inherits(AuthChallengePacket,_Packet26);function AuthChallengePacket(hash){_classCallCheck(this,AuthChallengePacket);var _this29=_possibleConstructorReturn(this,_Packet26.call(this));return _this29.cmd="authchallenge",_this29.type=exports.types.AUTHCHALLENGE,_this29.hash=hash||consensus.ZERO_HASH,_this29}return AuthChallengePacket.prototype.getSize=function(){return 32},AuthChallengePacket.prototype.toWriter=function(bw){return bw.writeBytes(this.hash),bw},AuthChallengePacket.prototype.toRaw=function(){return this.hash},AuthChallengePacket.prototype.fromReader=function(br){return this.hash=br.readHash(),this},AuthChallengePacket.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},AuthChallengePacket.fromReader=function(br){return(new this).fromReader(br)},AuthChallengePacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},AuthChallengePacket}(Packet),AuthReplyPacket=function(_Packet27){_inherits(AuthReplyPacket,_Packet27);function AuthReplyPacket(signature){_classCallCheck(this,AuthReplyPacket);var _this30=_possibleConstructorReturn(this,_Packet27.call(this));return _this30.cmd="authreply",_this30.type=exports.types.AUTHREPLY,_this30.signature=signature||common.ZERO_SIG,_this30}return AuthReplyPacket.prototype.getSize=function(){return 64},AuthReplyPacket.prototype.toWriter=function(bw){return bw.writeBytes(this.signature),bw},AuthReplyPacket.prototype.toRaw=function(){return this.signature},AuthReplyPacket.prototype.fromReader=function(br){return this.signature=br.readBytes(64),this},AuthReplyPacket.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},AuthReplyPacket.fromReader=function(br){return(new this).fromReader(br)},AuthReplyPacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},AuthReplyPacket}(Packet),AuthProposePacket=function(_Packet28){_inherits(AuthProposePacket,_Packet28);function AuthProposePacket(hash){_classCallCheck(this,AuthProposePacket);var _this31=_possibleConstructorReturn(this,_Packet28.call(this));return _this31.cmd="authpropose",_this31.type=exports.types.AUTHPROPOSE,_this31.hash=hash||consensus.ZERO_HASH,_this31}return AuthProposePacket.prototype.getSize=function(){return 32},AuthProposePacket.prototype.toWriter=function(bw){return bw.writeBytes(this.hash),bw},AuthProposePacket.prototype.toRaw=function(){return this.hash},AuthProposePacket.prototype.fromReader=function(br){return this.hash=br.readHash(),this},AuthProposePacket.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},AuthProposePacket.fromReader=function(br){return(new this).fromReader(br)},AuthProposePacket.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},AuthProposePacket}(Packet),UnknownPacket=function(_Packet29){_inherits(UnknownPacket,_Packet29);function UnknownPacket(cmd,data){_classCallCheck(this,UnknownPacket);var _this32=_possibleConstructorReturn(this,_Packet29.call(this));return _this32.cmd=cmd,_this32.type=exports.types.UNKNOWN,_this32.data=data,_this32}return UnknownPacket.prototype.getSize=function(){return this.data.length},UnknownPacket.prototype.toWriter=function(bw){return bw.writeBytes(this.data),bw},UnknownPacket.prototype.toRaw=function(){return this.data},UnknownPacket.prototype.fromRaw=function(cmd,data){return assert(Buffer.isBuffer(data)),this.cmd=cmd,this.data=data,this},UnknownPacket.fromRaw=function(cmd,data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(cmd,data)},UnknownPacket}(Packet);exports.fromRaw=function(cmd,data){switch(cmd){case"version":return VersionPacket.fromRaw(data);case"verack":return VerackPacket.fromRaw(data);case"ping":return PingPacket.fromRaw(data);case"pong":return PongPacket.fromRaw(data);case"getaddr":return GetAddrPacket.fromRaw(data);case"addr":return AddrPacket.fromRaw(data);case"inv":return InvPacket.fromRaw(data);case"getdata":return GetDataPacket.fromRaw(data);case"notfound":return NotFoundPacket.fromRaw(data);case"getblocks":return GetBlocksPacket.fromRaw(data);case"getheaders":return GetHeadersPacket.fromRaw(data);case"headers":return HeadersPacket.fromRaw(data);case"sendheaders":return SendHeadersPacket.fromRaw(data);case"block":return BlockPacket.fromRaw(data);case"tx":return TXPacket.fromRaw(data);case"reject":return RejectPacket.fromRaw(data);case"mempool":return MempoolPacket.fromRaw(data);case"filterload":return FilterLoadPacket.fromRaw(data);case"filteradd":return FilterAddPacket.fromRaw(data);case"filterclear":return FilterClearPacket.fromRaw(data);case"merkleblock":return MerkleBlockPacket.fromRaw(data);case"feefilter":return FeeFilterPacket.fromRaw(data);case"sendcmpct":return SendCmpctPacket.fromRaw(data);case"cmpctblock":return CmpctBlockPacket.fromRaw(data);case"getblocktxn":return GetBlockTxnPacket.fromRaw(data);case"blocktxn":return BlockTxnPacket.fromRaw(data);case"encinit":return EncinitPacket.fromRaw(data);case"encack":return EncackPacket.fromRaw(data);case"authchallenge":return AuthChallengePacket.fromRaw(data);case"authreply":return AuthReplyPacket.fromRaw(data);case"authpropose":return AuthProposePacket.fromRaw(data);default:return UnknownPacket.fromRaw(cmd,data)}},exports.Packet=Packet,exports.VersionPacket=VersionPacket,exports.VerackPacket=VerackPacket,exports.PingPacket=PingPacket,exports.PongPacket=PongPacket,exports.GetAddrPacket=GetAddrPacket,exports.AddrPacket=AddrPacket,exports.InvPacket=InvPacket,exports.GetDataPacket=GetDataPacket,exports.NotFoundPacket=NotFoundPacket,exports.GetBlocksPacket=GetBlocksPacket,exports.GetHeadersPacket=GetHeadersPacket,exports.HeadersPacket=HeadersPacket,exports.SendHeadersPacket=SendHeadersPacket,exports.BlockPacket=BlockPacket,exports.TXPacket=TXPacket,exports.RejectPacket=RejectPacket,exports.MempoolPacket=MempoolPacket,exports.FilterLoadPacket=FilterLoadPacket,exports.FilterAddPacket=FilterAddPacket,exports.FilterClearPacket=FilterClearPacket,exports.MerkleBlockPacket=MerkleBlockPacket,exports.FeeFilterPacket=FeeFilterPacket,exports.SendCmpctPacket=SendCmpctPacket,exports.CmpctBlockPacket=CmpctBlockPacket,exports.GetBlockTxnPacket=GetBlockTxnPacket,exports.BlockTxnPacket=BlockTxnPacket,exports.EncinitPacket=EncinitPacket,exports.EncackPacket=EncackPacket,exports.AuthChallengePacket=AuthChallengePacket,exports.AuthReplyPacket=AuthReplyPacket,exports.AuthProposePacket=AuthProposePacket,exports.UnknownPacket=UnknownPacket}).call(this,require("buffer").Buffer)},{"../primitives/headers":72,"../primitives/invitem":75,"../primitives/memblock":77,"../primitives/merkleblock":78,"../primitives/tx":82,"../protocol/consensus":84,"../utils/util":106,"./bip152":48,"./common":49,"./netaddress":53,assert:146,bfilter:203,buffer:269,bufio:270}],55:[function(require,module,exports){(function(Buffer){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),EventEmitter=require("events"),format=require("util").format,Network=require("../protocol/network"),hash256=require("bcrypto/lib/hash256"),common=require("./common"),packets=require("./packets"),Parser=function(_EventEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Parser,_EventEmitter);function Parser(network){_classCallCheck(this,Parser);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return _this.network=Network.get(network),_this.pending=[],_this.total=0,_this.waiting=24,_this.header=null,_this}return Parser.prototype.error=function(){var msg=format.apply(null,arguments);this.emit("error",new Error(msg))},Parser.prototype.feed=function(data){for(this.total+=data.length,this.pending.push(data);this.total>=this.waiting;){for(var chunk=Buffer.allocUnsafe(this.waiting),off=0;off<chunk.length;){var len=this.pending[0].copy(chunk,off);len===this.pending[0].length?this.pending.shift():this.pending[0]=this.pending[0].slice(len),off+=len}assert.strictEqual(off,chunk.length),this.total-=chunk.length,this.parse(chunk)}},Parser.prototype.parse=function(data){if(assert(data.length<=common.MAX_MESSAGE),this.header){var checksum=hash256.digest(data).readUInt32LE(0,!0);if(checksum!==this.header.checksum)return this.waiting=24,this.header=null,void this.error("Invalid checksum: %s.",checksum.toString(16));var payload=void 0;try{payload=this.parsePayload(this.header.cmd,data)}catch(e){return this.waiting=24,this.header=null,void this.emit("error",e)}this.waiting=24,this.header=null,this.emit("packet",payload)}else this.header=this.parseHeader(data)},Parser.prototype.parseHeader=function(data){var magic=data.readUInt32LE(0,!0);if(magic!==this.network.magic)return this.error("Invalid magic value: %s.",magic.toString(16)),null;for(var i=0;0!==data[i+4]&&i<12;i++);if(12===i)return this.error("Non NULL-terminated command."),null;var cmd=data.toString("ascii",4,4+i),size=data.readUInt32LE(16,!0);if(size>common.MAX_MESSAGE)return this.waiting=24,this.error("Packet length too large: %d.",size),null;this.waiting=size;var checksum=data.readUInt32LE(20,!0);return new Header(cmd,size,checksum)},Parser.prototype.parsePayload=function(cmd,data){return packets.fromRaw(cmd,data)},Parser}(EventEmitter),Header=function Header(cmd,size,checksum){_classCallCheck(this,Header),this.cmd=cmd,this.size=size,this.checksum=checksum};module.exports=Parser}).call(this,require("buffer").Buffer)},{"../protocol/network":87,"./common":49,"./packets":54,assert:146,"bcrypto/lib/hash256":160,buffer:269,events:334,util:428}],56:[function(require,module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),EventEmitter=require("events"),Lock=require("bmutex").Lock,format=require("util").format,tcp=require("btcp"),dns=require("bdns"),Logger=require("blgr"),RollingFilter=require("bfilter").RollingFilter,util=require("../utils/util"),Parser=require("./parser"),Framer=require("./framer"),packets=require("./packets"),consensus=require("../protocol/consensus"),common=require("./common"),InvItem=require("../primitives/invitem"),BIP151=require("./bip151"),BIP150=require("./bip150"),BIP152=require("./bip152"),Block=require("../primitives/block"),TX=require("../primitives/tx"),NetAddress=require("./netaddress"),Network=require("../protocol/network"),services=common.services,invTypes=InvItem.types,packetTypes=packets.types,Peer=function(_EventEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Peer,_EventEmitter);function Peer(options){_classCallCheck(this,Peer);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return _this.options=options,_this.network=_this.options.network,_this.logger=_this.options.logger.context("peer"),_this.locker=new Lock,_this.parser=new Parser(_this.network),_this.framer=new Framer(_this.network),_this.id=-1,_this.socket=null,_this.opened=!1,_this.outbound=!1,_this.loader=!1,_this.address=new NetAddress,_this.local=new NetAddress,_this.name=null,_this.connected=!1,_this.destroyed=!1,_this.ack=!1,_this.handshake=!1,_this.time=0,_this.lastSend=0,_this.lastRecv=0,_this.drainSize=0,_this.drainQueue=[],_this.banScore=0,_this.invQueue=[],_this.onPacket=null,_this.next=null,_this.prev=null,_this.version=-1,_this.services=0,_this.height=-1,_this.agent=null,_this.noRelay=!1,_this.preferHeaders=!1,_this.hashContinue=null,_this.spvFilter=null,_this.feeRate=-1,_this.bip151=null,_this.bip150=null,_this.compactMode=-1,_this.compactWitness=!1,_this.merkleBlock=null,_this.merkleTime=-1,_this.merkleMatches=0,_this.merkleMap=null,_this.syncing=!1,_this.sentAddr=!1,_this.sentGetAddr=!1,_this.challenge=null,_this.lastPong=-1,_this.lastPing=-1,_this.minPing=-1,_this.blockTime=-1,_this.bestHash=null,_this.bestHeight=-1,_this.connectTimeout=null,_this.pingTimer=null,_this.invTimer=null,_this.stallTimer=null,_this.addrFilter=new RollingFilter(5e3,.001),_this.invFilter=new RollingFilter(5e4,1e-6),_this.blockMap=new Map,_this.txMap=new Map,_this.responseMap=new Map,_this.compactBlocks=new Map,_this.init(),_this}return Peer.fromInbound=function(options,socket){var peer=new this(options);return peer.accept(socket),peer},Peer.fromOutbound=function(options,addr){var peer=new this(options);return peer.connect(addr),peer},Peer.fromOptions=function(options){return new this(new PeerOptions(options))},Peer.prototype.init=function(){var _this2=this;this.parser.on("packet",function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(packet){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,_context.next=3,_this2.readPacket(packet);case 3:_context.next=9;break;case 5:_context.prev=5,_context.t0=_context.catch(0),_this2.error(_context.t0),_this2.destroy();case 9:case"end":return _context.stop()}},_callee,_this2,[[0,5]])}));return function(_x){return _ref.apply(this,arguments)}}()),this.parser.on("error",function(err){_this2.destroyed||(_this2.error(err),_this2.sendReject("malformed","error parsing message"),_this2.increaseBan(10))})},Peer.prototype.hostname=function(){return this.address.hostname},Peer.prototype.framePacket=function(cmd,payload,checksum){return this.bip151&&this.bip151.handshake?this.bip151.packet(cmd,payload):this.framer.packet(cmd,payload,checksum)},Peer.prototype.feedParser=function(data){return this.bip151&&this.bip151.handshake?this.bip151.feed(data):this.parser.feed(data)},Peer.prototype.setCipher=function(cipher){var _this3=this;assert(!this.bip151,"BIP151 already set."),assert(this.socket,"Peer must be initialized with a socket."),assert(!this.opened,"Cannot set cipher after open."),this.bip151=new BIP151(cipher),this.bip151.on("error",function(err){_this3.error(err),_this3.destroy()}),this.bip151.on("rekey",function(){_this3.destroyed||(_this3.logger.debug("Rekeying with peer (%s).",_this3.hostname()),_this3.send(_this3.bip151.toRekey()))}),this.bip151.on("packet",function(cmd,body){var payload=null;try{payload=_this3.parser.parsePayload(cmd,body)}catch(e){return void _this3.parser.error(e)}_this3.parser.emit("packet",payload)})},Peer.prototype.setAuth=function(db,key){var bip151=this.bip151,hostname=this.hostname(),outbound=this.outbound;assert(this.bip151,"BIP151 not set."),assert(!this.bip150,"BIP150 already set."),assert(this.socket,"Peer must be initialized with a socket."),assert(!this.opened,"Cannot set auth after open."),this.bip150=new BIP150(bip151,hostname,outbound,db,key),this.bip151.bip150=this.bip150},Peer.prototype._bind=function(socket){var _this4=this;assert(!this.socket),this.socket=socket,this.socket.once("error",function(err){_this4.connected&&(_this4.error(err),_this4.destroy())}),this.socket.once("close",function(){_this4.error("Socket hangup."),_this4.destroy()}),this.socket.on("drain",function(){_this4.handleDrain()}),this.socket.on("data",function(chunk){_this4.lastRecv=Date.now(),_this4.feedParser(chunk)}),this.socket.setNoDelay(!0)},Peer.prototype.accept=function(socket){return assert(!this.socket),this.address=NetAddress.fromSocket(socket,this.network),this.address.services=0,this.time=Date.now(),this.outbound=!1,this.connected=!0,this._bind(socket),socket},Peer.prototype.connect=function(addr){assert(!this.socket);var socket=this.options.createSocket(addr.port,addr.host);return this.address=addr,this.outbound=!0,this.connected=!1,this._bind(socket),socket},Peer.prototype.getName=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var _address,host,port,_ref3,hostname;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(_context2.prev=0,this.name){_context2.next=8;break}return _address=this.address,host=_address.host,port=_address.port,_context2.next=5,dns.lookupService(host,port);case 5:_ref3=_context2.sent,hostname=_ref3.hostname,this.name=hostname;case 8:_context2.next=13;break;case 10:_context2.prev=10,_context2.t0=_context2.catch(0);case 13:return _context2.abrupt("return",this.name);case 14:case"end":return _context2.stop()}},_callee2,this,[[0,10]])}));return function(){return _ref2.apply(this,arguments)}}(),Peer.prototype.tryOpen=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.prev=0,_context3.next=3,this.open();case 3:_context3.next=8;break;case 5:_context3.prev=5,_context3.t0=_context3.catch(0);case 8:case"end":return _context3.stop()}},_callee3,this,[[0,5]])}));return function(){return _ref4.apply(this,arguments)}}(),Peer.prototype.open=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.prev=0,_context4.next=3,this._open();case 3:_context4.next=10;break;case 5:throw _context4.prev=5,_context4.t0=_context4.catch(0),this.error(_context4.t0),this.destroy(),_context4.t0;case 10:case"end":return _context4.stop()}},_callee4,this,[[0,5]])}));return function(){return _ref5.apply(this,arguments)}}(),Peer.prototype._open=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return this.opened=!0,_context5.next=3,this.initConnect();case 3:return _context5.next=5,this.initStall();case 5:return _context5.next=7,this.initBIP151();case 7:return _context5.next=9,this.initBIP150();case 9:return _context5.next=11,this.initVersion();case 11:return _context5.next=13,this.finalize();case 13:assert(!this.destroyed),this.emit("open");case 15:case"end":return _context5.stop()}},_callee5,this)}));return function(){return _ref6.apply(this,arguments)}}(),Peer.prototype.initConnect=function(){var _this5=this;return this.connected?(assert(!this.outbound),Promise.resolve()):new Promise(function(resolve,reject){var cleanup=function(){null!=_this5.connectTimeout&&(clearTimeout(_this5.connectTimeout),_this5.connectTimeout=null),_this5.socket.removeListener("error",onError)},onError=function(err){cleanup(),reject(err)};_this5.socket.once("connect",function(){_this5.time=Date.now(),_this5.connected=!0,_this5.emit("connect"),cleanup(),resolve()}),_this5.socket.once("error",onError),_this5.connectTimeout=setTimeout(function(){_this5.connectTimeout=null,cleanup(),reject(new Error("Connection timed out."))},1e4)})},Peer.prototype.initStall=function(){var _this6=this;return assert(!this.stallTimer),assert(!this.destroyed),this.stallTimer=setInterval(function(){_this6.maybeTimeout()},Peer.STALL_INTERVAL),Promise.resolve()},Peer.prototype.initBIP151=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(){return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(assert(!this.destroyed),this.bip151){_context6.next=3;break}return _context6.abrupt("return");case 3:return assert(!this.bip151.completed),this.logger.info("Attempting BIP151 handshake (%s).",this.hostname()),this.send(this.bip151.toEncinit()),_context6.prev=6,_context6.next=9,this.bip151.wait(3e3);case 9:_context6.next=14;break;case 11:_context6.prev=11,_context6.t0=_context6.catch(6),this.error(_context6.t0);case 14:if(!this.destroyed){_context6.next=16;break}throw new Error("Peer was destroyed during BIP151 handshake.");case 16:assert(this.bip151.completed),this.bip151.handshake&&(this.logger.info("BIP151 handshake complete (%s).",this.hostname()),this.logger.info("Connection is encrypted (%s).",this.hostname()));case 18:case"end":return _context6.stop()}},_callee6,this,[[6,11]])}));return function(){return _ref7.apply(this,arguments)}}(),Peer.prototype.initBIP150=function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(){return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(assert(!this.destroyed),this.bip150){_context7.next=3;break}return _context7.abrupt("return");case 3:if(assert(this.bip151),assert(!this.bip150.completed),this.bip151.handshake){_context7.next=7;break}throw new Error("BIP151 handshake was not completed for BIP150.");case 7:if(this.logger.info("Attempting BIP150 handshake (%s).",this.hostname()),!this.bip150.outbound){_context7.next=12;break}if(this.bip150.peerIdentity){_context7.next=11;break}throw new Error("No known identity for peer.");case 11:this.send(this.bip150.toChallenge());case 12:return _context7.next=14,this.bip150.wait(3e3);case 14:assert(!this.destroyed),assert(this.bip150.completed),this.bip150.auth&&(this.logger.info("BIP150 handshake complete (%s).",this.hostname()),this.logger.info("Peer is authed (%s): %s.",this.hostname(),this.bip150.getAddress()));case 17:case"end":return _context7.stop()}},_callee7,this)}));return function(){return _ref8.apply(this,arguments)}}(),Peer.prototype.initVersion=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(){return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(assert(!this.destroyed),this.sendVersion(),this.ack){_context8.next=6;break}return _context8.next=5,this.wait(packetTypes.VERACK,1e4);case 5:assert(this.ack);case 6:if(-1!==this.version){_context8.next=11;break}return this.logger.debug("Peer sent a verack without a version (%s).",this.hostname()),_context8.next=10,this.wait(packetTypes.VERSION,1e4);case 10:assert(-1!==this.version);case 11:if(!this.destroyed){_context8.next=13;break}throw new Error("Peer was destroyed during handshake.");case 13:this.handshake=!0,this.logger.debug("Version handshake complete (%s).",this.hostname());case 15:case"end":return _context8.stop()}},_callee8,this)}));return function(){return _ref9.apply(this,arguments)}}(),Peer.prototype.finalize=function(){var _ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(){var _this7=this;return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:assert(!this.destroyed),this.pingTimer=setInterval(function(){_this7.sendPing()},Peer.PING_INTERVAL),this.invTimer=setInterval(function(){_this7.flushInv()},Peer.INV_INTERVAL);case 3:case"end":return _context9.stop()}},_callee9,this)}));return function(){return _ref10.apply(this,arguments)}}(),Peer.prototype.announceBlock=function(blocks){if(this.handshake&&!this.destroyed){Array.isArray(blocks)||(blocks=[blocks]);var inv=[],_iterator=blocks,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref11;if(_isArray){if(_i>=_iterator.length)break;_ref11=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref11=_i.value}var block=_ref11;assert(block instanceof Block),this.invFilter.test(block.hash())||(1!==this.compactMode?this.preferHeaders?inv.push(block.toHeaders()):inv.push(block.toInv()):(this.invFilter.add(block.hash()),this.sendCompactBlock(block)))}this.preferHeaders?this.sendHeaders(inv):this.queueInv(inv)}},Peer.prototype.announceTX=function(txs){if(this.handshake&&!this.destroyed&&!this.noRelay){Array.isArray(txs)||(txs=[txs]);var inv=[],_iterator2=txs,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref12;if(_isArray2){if(_i2>=_iterator2.length)break;_ref12=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref12=_i2.value}var tx=_ref12;if(assert(tx instanceof TX),!this.invFilter.test(tx.hash())&&(!this.spvFilter||tx.isWatched(this.spvFilter))){if(-1!==this.feeRate){var hash=tx.hash("hex"),rate=this.options.getRate(hash);if(-1!==rate&&rate<this.feeRate)continue}inv.push(tx.toInv())}}this.queueInv(inv)}},Peer.prototype.queueInv=function(items){if(this.handshake&&!this.destroyed){Array.isArray(items)||(items=[items]);var hasBlock=!1,_iterator3=items,_isArray3=Array.isArray(_iterator3),_i3=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref13;if(_isArray3){if(_i3>=_iterator3.length)break;_ref13=_iterator3[_i3++]}else{if((_i3=_iterator3.next()).done)break;_ref13=_i3.value}var item=_ref13;item.type===invTypes.BLOCK&&(hasBlock=!0),this.invQueue.push(item)}(this.invQueue.length>=500||hasBlock)&&this.flushInv()}},Peer.prototype.flushInv=function(){if(!this.destroyed){var queue=this.invQueue;if(0!==queue.length){this.invQueue=[],this.logger.spam("Serving %d inv items to %s.",queue.length,this.hostname());var items=[],_iterator4=queue,_isArray4=Array.isArray(_iterator4),_i4=0;for(_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();;){var _ref14;if(_isArray4){if(_i4>=_iterator4.length)break;_ref14=_iterator4[_i4++]}else{if((_i4=_iterator4.next()).done)break;_ref14=_i4.value}var item=_ref14;this.invFilter.added(item.hash,"hex")&&items.push(item)}for(var i=0;i<items.length;i+=1e3){var chunk=items.slice(i,i+1e3);this.send(new packets.InvPacket(chunk))}}}},Peer.prototype.sendInv=function(items){if(this.handshake&&!this.destroyed){Array.isArray(items)||(items=[items]);var _iterator5=items,_isArray5=Array.isArray(_iterator5),_i5=0;for(_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();;){var _ref15;if(_isArray5){if(_i5>=_iterator5.length)break;_ref15=_iterator5[_i5++]}else{if((_i5=_iterator5.next()).done)break;_ref15=_i5.value}var item=_ref15;this.invFilter.add(item.hash,"hex")}if(0!==items.length){this.logger.spam("Serving %d inv items to %s.",items.length,this.hostname());for(var i=0;i<items.length;i+=1e3){var chunk=items.slice(i,i+1e3);this.send(new packets.InvPacket(chunk))}}}},Peer.prototype.sendHeaders=function(items){if(this.handshake&&!this.destroyed){Array.isArray(items)||(items=[items]);var _iterator6=items,_isArray6=Array.isArray(_iterator6),_i6=0;for(_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();;){var _ref16;if(_isArray6){if(_i6>=_iterator6.length)break;_ref16=_iterator6[_i6++]}else{if((_i6=_iterator6.next()).done)break;_ref16=_i6.value}var item=_ref16;this.invFilter.add(item.hash())}if(0!==items.length){this.logger.spam("Serving %d headers to %s.",items.length,this.hostname());for(var i=0;i<items.length;i+=2e3){var chunk=items.slice(i,i+2e3);this.send(new packets.HeadersPacket(chunk))}}}},Peer.prototype.sendCompactBlock=function(block){var witness=this.compactWitness,compact=BIP152.CompactBlock.fromBlock(block,witness);this.send(new packets.CmpctBlockPacket(compact,witness))},Peer.prototype.sendVersion=function(){var packet=new packets.VersionPacket;packet.version=this.options.version,packet.services=this.options.services,packet.time=this.network.now(),packet.remote=this.address,packet.local.setNull(),packet.local.services=this.options.services,packet.nonce=this.options.createNonce(this.hostname()),packet.agent=this.options.agent,packet.height=this.options.getHeight(),packet.noRelay=this.options.noRelay,this.send(packet)},Peer.prototype.sendGetAddr=function(){this.sentGetAddr||(this.sentGetAddr=!0,this.send(new packets.GetAddrPacket))},Peer.prototype.sendPing=function(){this.handshake&&(this.version<=common.PONG_VERSION?this.send(new packets.PingPacket):this.challenge?this.logger.debug("Peer has not responded to ping (%s).",this.hostname()):(this.lastPing=Date.now(),this.challenge=common.nonce(),this.send(new packets.PingPacket(this.challenge))))},Peer.prototype.sendFilterLoad=function(filter){this.handshake&&this.options.spv&&this.services&services.BLOOM&&this.send(new packets.FilterLoadPacket(filter))},Peer.prototype.sendFeeRate=function(rate){this.handshake&&this.send(new packets.FeeFilterPacket(rate))},Peer.prototype.destroy=function(){var connected=this.connected;if(!this.destroyed){this.destroyed=!0,this.connected=!1,this.socket.destroy(),this.socket=null,this.bip151&&this.bip151.destroy(),this.bip150&&this.bip150.destroy(),null!=this.pingTimer&&(clearInterval(this.pingTimer),this.pingTimer=null),null!=this.invTimer&&(clearInterval(this.invTimer),this.invTimer=null),null!=this.stallTimer&&(clearInterval(this.stallTimer),this.stallTimer=null),null!=this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=null);var jobs=this.drainQueue;this.drainSize=0,this.drainQueue=[];var _iterator7=jobs,_isArray7=Array.isArray(_iterator7),_i7=0;for(_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();;){var _ref17;if(_isArray7){if(_i7>=_iterator7.length)break;_ref17=_iterator7[_i7++]}else{if((_i7=_iterator7.next()).done)break;_ref17=_i7.value}_ref17.reject(new Error("Peer was destroyed."))}var _iterator8=this.responseMap,_isArray8=Array.isArray(_iterator8),_i8=0;for(_iterator8=_isArray8?_iterator8:_iterator8[Symbol.iterator]();;){var _ref19;if(_isArray8){if(_i8>=_iterator8.length)break;_ref19=_iterator8[_i8++]}else{if((_i8=_iterator8.next()).done)break;_ref19=_i8.value}var _ref18=_ref19,cmd=_ref18[0],entry=_ref18[1];this.responseMap.delete(cmd),entry.reject(new Error("Peer was destroyed."))}this.locker.destroy(),this.emit("close",connected)}},Peer.prototype.write=function(data){if(this.destroyed)throw new Error("Peer is destroyed (write).");this.lastSend=Date.now(),!1===this.socket.write(data)&&this.needsDrain(data.length)},Peer.prototype.send=function(packet){if(this.destroyed)throw new Error("Peer is destroyed (send).");var checksum=null;if(packet.type===packetTypes.TX){var tx=packet.tx;packet.witness?tx.isCoinbase()||(checksum=tx.witnessHash()):checksum=tx.hash()}this.sendRaw(packet.cmd,packet.toRaw(),checksum),this.addTimeout(packet)},Peer.prototype.sendRaw=function(cmd,body,checksum){var payload=this.framePacket(cmd,body,checksum);this.write(payload)},Peer.prototype.drain=function(){var _this8=this;return this.destroyed?Promise.reject(new Error("Peer is destroyed.")):0===this.drainSize?Promise.resolve():new Promise(function(resolve,reject){_this8.drainQueue.push({resolve:resolve,reject:reject})})},Peer.prototype.handleDrain=function(){var jobs=this.drainQueue;if(this.drainSize=0,0!==jobs.length){this.drainQueue=[];var _iterator9=jobs,_isArray9=Array.isArray(_iterator9),_i9=0;for(_iterator9=_isArray9?_iterator9:_iterator9[Symbol.iterator]();;){var _ref20;if(_isArray9){if(_i9>=_iterator9.length)break;_ref20=_iterator9[_i9++]}else{if((_i9=_iterator9.next()).done)break;_ref20=_i9.value}_ref20.resolve()}}},Peer.prototype.needsDrain=function(size){this.drainSize+=size,this.drainSize>=Peer.DRAIN_MAX&&(this.logger.warning("Peer is not reading: %dmb buffered (%s).",this.drainSize/(1<<20),this.hostname()),this.error("Peer stalled (drain)."),this.destroy())},Peer.prototype.addTimeout=function(packet){var timeout=Peer.RESPONSE_TIMEOUT;if(this.outbound)switch(packet.type){case packetTypes.MEMPOOL:this.request(packetTypes.INV,timeout);break;case packetTypes.GETBLOCKS:this.options.isFull()||this.request(packetTypes.INV,timeout);break;case packetTypes.GETHEADERS:this.request(packetTypes.HEADERS,2*timeout);break;case packetTypes.GETDATA:this.request(packetTypes.DATA,2*timeout);break;case packetTypes.GETBLOCKTXN:this.request(packetTypes.BLOCKTXN,timeout)}},Peer.prototype.fulfill=function(packet){switch(packet.type){case packetTypes.BLOCK:case packetTypes.CMPCTBLOCK:case packetTypes.MERKLEBLOCK:case packetTypes.TX:case packetTypes.NOTFOUND:var entry=this.response(packetTypes.DATA,packet);assert(!entry||0===entry.jobs.length)}return this.response(packet.type,packet)},Peer.prototype.maybeTimeout=function(){var now=Date.now(),_iterator10=this.responseMap,_isArray10=Array.isArray(_iterator10),_i10=0;for(_iterator10=_isArray10?_iterator10:_iterator10[Symbol.iterator]();;){var _ref22;if(_isArray10){if(_i10>=_iterator10.length)break;_ref22=_iterator10[_i10++]}else{if((_i10=_iterator10.next()).done)break;_ref22=_i10.value}var _ref21=_ref22,key=_ref21[0];if(now>_ref21[1].timeout){var name=packets.typesByVal[key];return this.error("Peer is stalling (%s).",name.toLowerCase()),void this.destroy()}}if(this.merkleBlock&&(assert(-1!==this.merkleTime),now>this.merkleTime+Peer.BLOCK_TIMEOUT))return this.error("Peer is stalling (merkleblock)."),void this.destroy();if(this.syncing&&this.loader&&!this.options.isFull()&&now>this.blockTime+Peer.BLOCK_TIMEOUT)return this.error("Peer is stalling (block)."),void this.destroy();if(this.options.isFull()||!this.syncing){var _iterator11=this.blockMap.values(),_isArray11=Array.isArray(_iterator11),_i11=0;for(_iterator11=_isArray11?_iterator11:_iterator11[Symbol.iterator]();;){var _ref23;if(_isArray11){if(_i11>=_iterator11.length)break;_ref23=_iterator11[_i11++]}else{if((_i11=_iterator11.next()).done)break;_ref23=_i11.value}if(now>_ref23+Peer.BLOCK_TIMEOUT)return this.error("Peer is stalling (block)."),void this.destroy()}var _iterator12=this.txMap.values(),_isArray12=Array.isArray(_iterator12),_i12=0;for(_iterator12=_isArray12?_iterator12:_iterator12[Symbol.iterator]();;){var _ref24;if(_isArray12){if(_i12>=_iterator12.length)break;_ref24=_iterator12[_i12++]}else{if((_i12=_iterator12.next()).done)break;_ref24=_i12.value}if(now>_ref24+Peer.TX_TIMEOUT)return this.error("Peer is stalling (tx)."),void this.destroy()}var _iterator13=this.compactBlocks.values(),_isArray13=Array.isArray(_iterator13),_i13=0;for(_iterator13=_isArray13?_iterator13:_iterator13[Symbol.iterator]();;){var _ref25;if(_isArray13){if(_i13>=_iterator13.length)break;_ref25=_iterator13[_i13++]}else{if((_i13=_iterator13.next()).done)break;_ref25=_i13.value}if(now>_ref25.now+Peer.RESPONSE_TIMEOUT)return this.error("Peer is stalling (blocktxn)."),void this.destroy()}}if(now>this.time+6e4){if(assert(0!==this.time),0===this.lastRecv||0===this.lastSend)return this.error("Peer is stalling (no message)."),void this.destroy();if(now>this.lastSend+Peer.TIMEOUT_INTERVAL)return this.error("Peer is stalling (send)."),void this.destroy();var mult=this.version<=common.PONG_VERSION?4:1;if(now>this.lastRecv+Peer.TIMEOUT_INTERVAL*mult)return this.error("Peer is stalling (recv)."),void this.destroy();if(this.challenge&&now>this.lastPing+Peer.TIMEOUT_INTERVAL)return this.error("Peer is stalling (ping)."),void this.destroy()}},Peer.prototype.request=function(type,timeout){if(this.destroyed)return null;var entry=this.responseMap.get(type);return entry||(entry=new RequestEntry,this.responseMap.set(type,entry)),entry.setTimeout(timeout),entry},Peer.prototype.response=function(type,payload){var entry=this.responseMap.get(type);return entry?(this.responseMap.delete(type),entry):null},Peer.prototype.wait=function(type,timeout){var _this9=this;return new Promise(function(resolve,reject){if(_this9.destroyed)reject(new Error("Peer is destroyed (request)."));else{var entry=_this9.request(type);entry.setTimeout(timeout),entry.addJob(resolve,reject)}})},Peer.prototype.error=function(err){if(!this.destroyed){if("string"==typeof err){var msg=format.apply(null,arguments);err=new Error(msg)}if("string"==typeof err.code&&"E"===err.code[0]){var _msg=err.code;(err=new Error(_msg)).code=_msg,err.message="Socket Error: "+_msg}err.message+=" ("+this.hostname()+")",this.emit("error",err)}},Peer.prototype.blockType=function(){return this.options.spv?invTypes.FILTERED_BLOCK:this.options.compact&&this.hasCompactSupport()&&this.hasCompact()?invTypes.CMPCT_BLOCK:this.hasWitness()?invTypes.WITNESS_BLOCK:invTypes.BLOCK},Peer.prototype.txType=function(){return this.hasWitness()?invTypes.WITNESS_TX:invTypes.TX},Peer.prototype.getData=function(items){this.send(new packets.GetDataPacket(items))},Peer.prototype.getItems=function(type,hashes){var items=[],_iterator14=hashes,_isArray14=Array.isArray(_iterator14),_i14=0;for(_iterator14=_isArray14?_iterator14:_iterator14[Symbol.iterator]();;){var _ref26;if(_isArray14){if(_i14>=_iterator14.length)break;_ref26=_iterator14[_i14++]}else{if((_i14=_iterator14.next()).done)break;_ref26=_i14.value}var hash=_ref26;items.push(new InvItem(type,hash))}0!==items.length&&this.getData(items)},Peer.prototype.getBlock=function(hashes){this.getItems(this.blockType(),hashes)},Peer.prototype.getTX=function(hashes){this.getItems(this.txType(),hashes)},Peer.prototype.getFullBlock=function(hash){assert(!this.options.spv);var type=invTypes.BLOCK;this.hasWitness()&&(type|=InvItem.WITNESS_FLAG),this.getItems(type,[hash])},Peer.prototype.readPacket=function(){var _ref27=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(packet){var unlock;return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:if(!this.destroyed){_context10.next=2;break}return _context10.abrupt("return");case 2:_context10.t0=packet.type,_context10.next=_context10.t0===packetTypes.ENCINIT?5:_context10.t0===packetTypes.ENCACK?5:_context10.t0===packetTypes.AUTHCHALLENGE?5:_context10.t0===packetTypes.AUTHREPLY?5:_context10.t0===packetTypes.AUTHPROPOSE?5:_context10.t0===packetTypes.PONG?5:13;break;case 5:return _context10.prev=5,this.socket.pause(),_context10.next=9,this.handlePacket(packet);case 9:return _context10.prev=9,this.destroyed||this.socket.resume(),_context10.finish(9);case 12:return _context10.abrupt("break",25);case 13:return _context10.next=15,this.locker.lock();case 15:return unlock=_context10.sent,_context10.prev=16,this.socket.pause(),_context10.next=20,this.handlePacket(packet);case 20:return _context10.prev=20,this.destroyed||this.socket.resume(),unlock(),_context10.finish(20);case 24:return _context10.abrupt("break",25);case 25:case"end":return _context10.stop()}},_callee10,this,[[5,,9,12],[16,,20,24]])}));return function(_x2){return _ref27.apply(this,arguments)}}(),Peer.prototype.handlePacket=function(){var _ref28=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(packet){var entry;return regeneratorRuntime.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:if(!this.destroyed){_context11.next=2;break}throw new Error("Destroyed peer sent a packet.");case 2:this.bip151&&this.bip151.job&&!this.bip151.completed&&packet.type!==packetTypes.ENCINIT&&packet.type!==packetTypes.ENCACK&&this.bip151.reject(new Error("Message before BIP151 handshake.")),this.bip150&&this.bip150.job&&!this.bip150.completed&&packet.type!==packetTypes.AUTHCHALLENGE&&packet.type!==packetTypes.AUTHREPLY&&packet.type!==packetTypes.AUTHPROPOSE&&this.bip150.reject(new Error("Message before BIP150 auth.")),entry=this.fulfill(packet),_context11.t0=packet.type,_context11.next=_context11.t0===packetTypes.VERSION?8:_context11.t0===packetTypes.VERACK?11:_context11.t0===packetTypes.PING?14:_context11.t0===packetTypes.PONG?17:_context11.t0===packetTypes.SENDHEADERS?20:_context11.t0===packetTypes.FILTERLOAD?23:_context11.t0===packetTypes.FILTERADD?26:_context11.t0===packetTypes.FILTERCLEAR?29:_context11.t0===packetTypes.FEEFILTER?32:_context11.t0===packetTypes.SENDCMPCT?35:_context11.t0===packetTypes.ENCINIT?38:_context11.t0===packetTypes.ENCACK?41:_context11.t0===packetTypes.AUTHCHALLENGE?44:_context11.t0===packetTypes.AUTHREPLY?47:_context11.t0===packetTypes.AUTHPROPOSE?50:53;break;case 8:return _context11.next=10,this.handleVersion(packet);case 10:return _context11.abrupt("break",53);case 11:return _context11.next=13,this.handleVerack(packet);case 13:return _context11.abrupt("break",53);case 14:return _context11.next=16,this.handlePing(packet);case 16:return _context11.abrupt("break",53);case 17:return _context11.next=19,this.handlePong(packet);case 19:return _context11.abrupt("break",53);case 20:return _context11.next=22,this.handleSendHeaders(packet);case 22:return _context11.abrupt("break",53);case 23:return _context11.next=25,this.handleFilterLoad(packet);case 25:return _context11.abrupt("break",53);case 26:return _context11.next=28,this.handleFilterAdd(packet);case 28:return _context11.abrupt("break",53);case 29:return _context11.next=31,this.handleFilterClear(packet);case 31:return _context11.abrupt("break",53);case 32:return _context11.next=34,this.handleFeeFilter(packet);case 34:return _context11.abrupt("break",53);case 35:return _context11.next=37,this.handleSendCmpct(packet);case 37:return _context11.abrupt("break",53);case 38:return _context11.next=40,this.handleEncinit(packet);case 40:return _context11.abrupt("break",53);case 41:return _context11.next=43,this.handleEncack(packet);case 43:return _context11.abrupt("break",53);case 44:return _context11.next=46,this.handleAuthChallenge(packet);case 46:return _context11.abrupt("break",53);case 47:return _context11.next=49,this.handleAuthReply(packet);case 49:return _context11.abrupt("break",53);case 50:return _context11.next=52,this.handleAuthPropose(packet);case 52:return _context11.abrupt("break",53);case 53:if(!this.onPacket){_context11.next=56;break}return _context11.next=56,this.onPacket(packet);case 56:this.emit("packet",packet),entry&&entry.resolve(packet);case 58:case"end":return _context11.stop()}},_callee11,this)}));return function(_x3){return _ref28.apply(this,arguments)}}(),Peer.prototype.handleVersion=function(){var _ref29=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(packet){return regeneratorRuntime.wrap(function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:if(-1===this.version){_context12.next=2;break}throw new Error("Peer sent a duplicate version.");case 2:if(this.version=packet.version,this.services=packet.services,this.height=packet.height,this.agent=packet.agent,this.noRelay=packet.noRelay,this.local=packet.remote,this.network.selfConnect){_context12.next=11;break}if(!this.options.hasNonce(packet.nonce)){_context12.next=11;break}throw new Error("We connected to ourself. Oops.");case 11:if(!(this.version<common.MIN_VERSION)){_context12.next=13;break}throw new Error("Peer does not support required protocol version.");case 13:if(!this.outbound){_context12.next=28;break}if(this.services&services.NETWORK){_context12.next=16;break}throw new Error("Peer does not support network services.");case 16:if(!this.options.headers){_context12.next=19;break}if(!(this.version<common.HEADERS_VERSION)){_context12.next=19;break}throw new Error("Peer does not support getheaders.");case 19:if(!this.options.spv){_context12.next=24;break}if(this.services&services.BLOOM){_context12.next=22;break}throw new Error("Peer does not support BIP37.");case 22:if(!(this.version<common.BLOOM_VERSION)){_context12.next=24;break}throw new Error("Peer does not support BIP37.");case 24:if(!this.options.hasWitness()){_context12.next=27;break}if(this.services&services.WITNESS){_context12.next=27;break}throw new Error("Peer does not support segregated witness.");case 27:this.options.compact&&(this.hasCompactSupport()||this.logger.debug("Peer does not support compact blocks (%s).",this.hostname()));case 28:this.send(new packets.VerackPacket);case 29:case"end":return _context12.stop()}},_callee12,this)}));return function(_x4){return _ref29.apply(this,arguments)}}(),Peer.prototype.handleVerack=function(){var _ref30=_asyncToGenerator(regeneratorRuntime.mark(function _callee13(packet){return regeneratorRuntime.wrap(function(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:if(!this.ack){_context13.next=3;break}return this.logger.debug("Peer sent duplicate ack (%s).",this.hostname()),_context13.abrupt("return");case 3:this.ack=!0,this.logger.debug("Received verack (%s).",this.hostname());case 5:case"end":return _context13.stop()}},_callee13,this)}));return function(_x5){return _ref30.apply(this,arguments)}}(),Peer.prototype.handlePing=function(){var _ref31=_asyncToGenerator(regeneratorRuntime.mark(function _callee14(packet){return regeneratorRuntime.wrap(function(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:if(packet.nonce){_context14.next=2;break}return _context14.abrupt("return");case 2:this.send(new packets.PongPacket(packet.nonce));case 3:case"end":return _context14.stop()}},_callee14,this)}));return function(_x6){return _ref31.apply(this,arguments)}}(),Peer.prototype.handlePong=function(){var _ref32=_asyncToGenerator(regeneratorRuntime.mark(function _callee15(packet){var nonce,now;return regeneratorRuntime.wrap(function(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:if(nonce=packet.nonce,now=Date.now(),this.challenge){_context15.next=5;break}return this.logger.debug("Peer sent an unsolicited pong (%s).",this.hostname()),_context15.abrupt("return");case 5:if(nonce.equals(this.challenge)){_context15.next=12;break}if(!nonce.equals(common.ZERO_NONCE)){_context15.next=10;break}return this.logger.debug("Peer sent a zero nonce (%s).",this.hostname()),this.challenge=null,_context15.abrupt("return");case 10:return this.logger.debug("Peer sent the wrong nonce (%s).",this.hostname()),_context15.abrupt("return");case 12:now>=this.lastPing?(this.lastPong=now,-1===this.minPing&&(this.minPing=now-this.lastPing),this.minPing=Math.min(this.minPing,now-this.lastPing)):this.logger.debug("Timing mismatch (what?) (%s).",this.hostname()),this.challenge=null;case 14:case"end":return _context15.stop()}},_callee15,this)}));return function(_x7){return _ref32.apply(this,arguments)}}(),Peer.prototype.handleSendHeaders=function(){var _ref33=_asyncToGenerator(regeneratorRuntime.mark(function _callee16(packet){return regeneratorRuntime.wrap(function(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:if(!this.preferHeaders){_context16.next=3;break}return this.logger.debug("Peer sent a duplicate sendheaders (%s).",this.hostname()),_context16.abrupt("return");case 3:this.preferHeaders=!0;case 4:case"end":return _context16.stop()}},_callee16,this)}));return function(_x8){return _ref33.apply(this,arguments)}}(),Peer.prototype.handleFilterLoad=function(){var _ref34=_asyncToGenerator(regeneratorRuntime.mark(function _callee17(packet){return regeneratorRuntime.wrap(function(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:if(packet.isWithinConstraints()){_context17.next=3;break}return this.increaseBan(100),_context17.abrupt("return");case 3:this.spvFilter=packet.filter,this.noRelay=!1;case 5:case"end":return _context17.stop()}},_callee17,this)}));return function(_x9){return _ref34.apply(this,arguments)}}(),Peer.prototype.handleFilterAdd=function(){var _ref35=_asyncToGenerator(regeneratorRuntime.mark(function _callee18(packet){var data;return regeneratorRuntime.wrap(function(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:if(!((data=packet.data).length>consensus.MAX_SCRIPT_PUSH)){_context18.next=4;break}return this.increaseBan(100),_context18.abrupt("return");case 4:this.spvFilter&&this.spvFilter.add(data),this.noRelay=!1;case 6:case"end":return _context18.stop()}},_callee18,this)}));return function(_x10){return _ref35.apply(this,arguments)}}(),Peer.prototype.handleFilterClear=function(){var _ref36=_asyncToGenerator(regeneratorRuntime.mark(function _callee19(packet){return regeneratorRuntime.wrap(function(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:this.spvFilter&&this.spvFilter.reset(),this.noRelay=!1;case 2:case"end":return _context19.stop()}},_callee19,this)}));return function(_x11){return _ref36.apply(this,arguments)}}(),Peer.prototype.handleFeeFilter=function(){var _ref37=_asyncToGenerator(regeneratorRuntime.mark(function _callee20(packet){var rate;return regeneratorRuntime.wrap(function(_context20){for(;;)switch(_context20.prev=_context20.next){case 0:if(!((rate=packet.rate)<0||rate>consensus.MAX_MONEY)){_context20.next=4;break}return this.increaseBan(100),_context20.abrupt("return");case 4:this.feeRate=rate;case 5:case"end":return _context20.stop()}},_callee20,this)}));return function(_x12){return _ref37.apply(this,arguments)}}(),Peer.prototype.handleSendCmpct=function(){var _ref38=_asyncToGenerator(regeneratorRuntime.mark(function _callee21(packet){return regeneratorRuntime.wrap(function(_context21){for(;;)switch(_context21.prev=_context21.next){case 0:if(-1===this.compactMode){_context21.next=3;break}return this.logger.debug("Peer sent a duplicate sendcmpct (%s).",this.hostname()),_context21.abrupt("return");case 3:if(!(packet.version>2)){_context21.next=6;break}return this.logger.info("Peer request compact blocks version %d (%s).",packet.version,this.hostname()),_context21.abrupt("return");case 6:if(!(packet.mode>1)){_context21.next=9;break}return this.logger.info("Peer request compact blocks mode %d (%s).",packet.mode,this.hostname()),_context21.abrupt("return");case 9:this.logger.info("Peer initialized compact blocks (mode=%d, version=%d) (%s).",packet.mode,packet.version,this.hostname()),this.compactMode=packet.mode,this.compactWitness=2===packet.version;case 12:case"end":return _context21.stop()}},_callee21,this)}));return function(_x13){return _ref38.apply(this,arguments)}}(),Peer.prototype.handleEncinit=function(){var _ref39=_asyncToGenerator(regeneratorRuntime.mark(function _callee22(packet){return regeneratorRuntime.wrap(function(_context22){for(;;)switch(_context22.prev=_context22.next){case 0:if(this.bip151){_context22.next=2;break}return _context22.abrupt("return");case 2:this.bip151.encinit(packet.publicKey,packet.cipher),this.send(this.bip151.toEncack());case 4:case"end":return _context22.stop()}},_callee22,this)}));return function(_x14){return _ref39.apply(this,arguments)}}(),Peer.prototype.handleEncack=function(){var _ref40=_asyncToGenerator(regeneratorRuntime.mark(function _callee23(packet){return regeneratorRuntime.wrap(function(_context23){for(;;)switch(_context23.prev=_context23.next){case 0:if(this.bip151){_context23.next=2;break}return _context23.abrupt("return");case 2:this.bip151.encack(packet.publicKey);case 3:case"end":return _context23.stop()}},_callee23,this)}));return function(_x15){return _ref40.apply(this,arguments)}}(),Peer.prototype.handleAuthChallenge=function(){var _ref41=_asyncToGenerator(regeneratorRuntime.mark(function _callee24(packet){var sig;return regeneratorRuntime.wrap(function(_context24){for(;;)switch(_context24.prev=_context24.next){case 0:if(this.bip150){_context24.next=2;break}return _context24.abrupt("return");case 2:sig=this.bip150.challenge(packet.hash),this.send(new packets.AuthReplyPacket(sig));case 4:case"end":return _context24.stop()}},_callee24,this)}));return function(_x16){return _ref41.apply(this,arguments)}}(),Peer.prototype.handleAuthReply=function(){var _ref42=_asyncToGenerator(regeneratorRuntime.mark(function _callee25(packet){var hash;return regeneratorRuntime.wrap(function(_context25){for(;;)switch(_context25.prev=_context25.next){case 0:if(this.bip150){_context25.next=2;break}return _context25.abrupt("return");case 2:(hash=this.bip150.reply(packet.signature))&&this.send(new packets.AuthProposePacket(hash));case 4:case"end":return _context25.stop()}},_callee25,this)}));return function(_x17){return _ref42.apply(this,arguments)}}(),Peer.prototype.handleAuthPropose=function(){var _ref43=_asyncToGenerator(regeneratorRuntime.mark(function _callee26(packet){var hash;return regeneratorRuntime.wrap(function(_context26){for(;;)switch(_context26.prev=_context26.next){case 0:if(this.bip150){_context26.next=2;break}return _context26.abrupt("return");case 2:hash=this.bip150.propose(packet.hash),this.send(new packets.AuthChallengePacket(hash));case 4:case"end":return _context26.stop()}},_callee26,this)}));return function(_x18){return _ref43.apply(this,arguments)}}(),Peer.prototype.sendGetHeaders=function(locator,stop){var packet=new packets.GetHeadersPacket(locator,stop),hash=null;packet.locator.length>0&&(hash=util.revHex(packet.locator[0]));var end=null;stop&&(end=util.revHex(stop)),this.logger.debug("Requesting headers packet from peer with getheaders (%s).",this.hostname()),this.logger.debug("Sending getheaders (hash=%s, stop=%s).",hash,end),this.send(packet)},Peer.prototype.sendGetBlocks=function(locator,stop){var packet=new packets.GetBlocksPacket(locator,stop),hash=null;packet.locator.length>0&&(hash=util.revHex(packet.locator[0]));var end=null;stop&&(end=util.revHex(stop)),this.logger.debug("Requesting inv packet from peer with getblocks (%s).",this.hostname()),this.logger.debug("Sending getblocks (hash=%s, stop=%s).",hash,end),this.send(packet)},Peer.prototype.sendMempool=function(){this.handshake&&(this.services&services.BLOOM?(this.logger.debug("Requesting inv packet from peer with mempool (%s).",this.hostname()),this.send(new packets.MempoolPacket)):this.logger.debug("Cannot request mempool for non-bloom peer (%s).",this.hostname()))},Peer.prototype.sendReject=function(code,reason,msg,hash){var reject=packets.RejectPacket.fromReason(code,reason,msg,hash);msg?this.logger.debug("Rejecting %s %s (%s): code=%s reason=%s.",msg,util.revHex(hash),this.hostname(),code,reason):this.logger.debug("Rejecting packet from %s: code=%s reason=%s.",this.hostname(),code,reason),this.logger.debug("Sending reject packet to peer (%s).",this.hostname()),this.send(reject)},Peer.prototype.sendCompact=function(mode){if(this.services&common.services.WITNESS&&this.version>=common.COMPACT_WITNESS_VERSION)return this.logger.info("Initializing witness compact blocks (%s).",this.hostname()),void this.send(new packets.SendCmpctPacket(mode,2));this.version>=common.COMPACT_VERSION&&(this.logger.info("Initializing normal compact blocks (%s).",this.hostname()),this.send(new packets.SendCmpctPacket(mode,1)))},Peer.prototype.increaseBan=function(score){return this.banScore+=score,this.banScore>=this.options.banScore&&(this.logger.debug("Ban threshold exceeded (%s).",this.hostname()),this.ban(),!0)},Peer.prototype.ban=function(){this.emit("ban")},Peer.prototype.reject=function(msg,err){return this.sendReject(err.code,err.reason,msg,err.hash),this.increaseBan(err.score)},Peer.prototype.hasServices=function(services){return(this.services&services)===services},Peer.prototype.hasWitness=function(){return 0!=(this.services&services.WITNESS)},Peer.prototype.hasCompactSupport=function(){return!(this.version<common.COMPACT_VERSION)&&(!this.options.hasWitness()||!!(this.services&services.WITNESS)&&this.version>=common.COMPACT_WITNESS_VERSION)},Peer.prototype.hasCompact=function(){return-1!==this.compactMode&&(!this.options.hasWitness()||!!this.compactWitness)},Peer.prototype.inspect=function(){return"<Peer: handshake="+this.handshake+" host="+this.hostname()+" outbound="+this.outbound+" ping="+this.minPing+">"},Peer}(EventEmitter);Peer.DRAIN_MAX=10<<20,Peer.STALL_INTERVAL=5e3,Peer.PING_INTERVAL=3e4,Peer.INV_INTERVAL=5e3,Peer.RESPONSE_TIMEOUT=3e4,Peer.BLOCK_TIMEOUT=12e4,Peer.TX_TIMEOUT=12e4,Peer.TIMEOUT_INTERVAL=12e5;var PeerOptions=function(){function PeerOptions(options){_classCallCheck(this,PeerOptions),this.network=Network.primary,this.logger=Logger.global,this.createSocket=tcp.createSocket,this.version=common.PROTOCOL_VERSION,this.services=common.LOCAL_SERVICES,this.agent=common.USER_AGENT,this.noRelay=!1,this.spv=!1,this.compact=!1,this.headers=!1,this.banScore=common.BAN_SCORE,this.getHeight=PeerOptions.getHeight,this.isFull=PeerOptions.isFull,this.hasWitness=PeerOptions.hasWitness,this.createNonce=PeerOptions.createNonce,this.hasNonce=PeerOptions.hasNonce,this.getRate=PeerOptions.getRate,options&&this.fromOptions(options)}return PeerOptions.prototype.fromOptions=function(options){return assert(options,"Options are required."),null!=options.network&&(this.network=Network.get(options.network)),null!=options.logger&&(assert("object"===_typeof(options.logger)),this.logger=options.logger),null!=options.createSocket&&(assert("function"==typeof options.createSocket),this.createSocket=options.createSocket),null!=options.version&&(assert("number"==typeof options.version),this.version=options.version),null!=options.services&&(assert("number"==typeof options.services),this.services=options.services),null!=options.agent&&(assert("string"==typeof options.agent),this.agent=options.agent),null!=options.noRelay&&(assert("boolean"==typeof options.noRelay),this.noRelay=options.noRelay),null!=options.spv&&(assert("boolean"==typeof options.spv),this.spv=options.spv),null!=options.compact&&(assert("boolean"==typeof options.compact),this.compact=options.compact),null!=options.headers&&(assert("boolean"==typeof options.headers),this.headers=options.headers),null!=options.banScore&&(assert("number"==typeof options.banScore),this.banScore=options.banScore),null!=options.getHeight&&(assert("function"==typeof options.getHeight),this.getHeight=options.getHeight),null!=options.isFull&&(assert("function"==typeof options.isFull),this.isFull=options.isFull),null!=options.hasWitness&&(assert("function"==typeof options.hasWitness),this.hasWitness=options.hasWitness),null!=options.createNonce&&(assert("function"==typeof options.createNonce),this.createNonce=options.createNonce),null!=options.hasNonce&&(assert("function"==typeof options.hasNonce),this.hasNonce=options.hasNonce),null!=options.getRate&&(assert("function"==typeof options.getRate),this.getRate=options.getRate),this},PeerOptions.fromOptions=function(options){return(new this).fromOptions(options)},PeerOptions.getHeight=function(){return 0},PeerOptions.isFull=function(){return!1},PeerOptions.hasWitness=function(){return!0},PeerOptions.createNonce=function(hostname){return common.nonce()},PeerOptions.hasNonce=function(nonce){return!1},PeerOptions.getRate=function(hash){return-1},PeerOptions}(),RequestEntry=function(){function RequestEntry(){_classCallCheck(this,RequestEntry),this.timeout=0,this.jobs=[]}return RequestEntry.prototype.addJob=function(resolve,reject){this.jobs.push({resolve:resolve,reject:reject})},RequestEntry.prototype.setTimeout=function(timeout){this.timeout=Date.now()+timeout},RequestEntry.prototype.reject=function(err){var _iterator15=this.jobs,_isArray15=Array.isArray(_iterator15),_i15=0;for(_iterator15=_isArray15?_iterator15:_iterator15[Symbol.iterator]();;){var _ref44;if(_isArray15){if(_i15>=_iterator15.length)break;_ref44=_iterator15[_i15++]}else{if((_i15=_iterator15.next()).done)break;_ref44=_i15.value}_ref44.reject(err)}this.jobs.length=0},RequestEntry.prototype.resolve=function(result){var _iterator16=this.jobs,_isArray16=Array.isArray(_iterator16),_i16=0;for(_iterator16=_isArray16?_iterator16:_iterator16[Symbol.iterator]();;){var _ref45;if(_isArray16){if(_i16>=_iterator16.length)break;_ref45=_iterator16[_i16++]}else{if((_i16=_iterator16.next()).done)break;_ref45=_i16.value}_ref45.resolve(result)}this.jobs.length=0},RequestEntry}();module.exports=Peer},{"../primitives/block":70,"../primitives/invitem":75,"../primitives/tx":82,"../protocol/consensus":84,"../protocol/network":87,"../utils/util":106,"./bip150":46,"./bip151":47,"./bip152":48,"./common":49,"./framer":50,"./netaddress":53,"./packets":54,"./parser":55,assert:146,bdns:197,bfilter:203,blgr:211,bmutex:214,btcp:266,events:334,util:428}],57:[function(require,module,exports){(function(Buffer){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var assert=require("assert"),EventEmitter=require("events"),Lock=require("bmutex").Lock,IP=require("binet"),dns=require("bdns"),tcp=require("btcp"),UPNP=require("bupnp"),socks=require("bsocks"),_require2=require("bfilter"),BloomFilter=_require2.BloomFilter,RollingFilter=_require2.RollingFilter,secp256k1=require("bcrypto/lib/secp256k1"),util=require("../utils/util"),common=require("./common"),chainCommon=require("../blockchain/common"),Address=require("../primitives/address"),BIP150=require("./bip150"),BIP151=require("./bip151"),BIP152=require("./bip152"),Network=require("../protocol/network"),Peer=require("./peer"),List=require("../utils/list"),HostList=require("./hostlist"),InvItem=require("../primitives/invitem"),packets=require("./packets"),services=common.services,invTypes=InvItem.types,packetTypes=packets.types,scores=HostList.scores,Pool=function(_EventEmitter){_inherits(Pool,_EventEmitter);function Pool(options){_classCallCheck(this,Pool);var _this=_possibleConstructorReturn(this,_EventEmitter.call(this));return _this.opened=!1,_this.options=new PoolOptions(options),_this.network=_this.options.network,_this.logger=_this.options.logger.context("net"),_this.chain=_this.options.chain,_this.mempool=_this.options.mempool,_this.server=_this.options.createServer(),_this.nonces=_this.options.nonces,_this.locker=new Lock(!0),_this.connected=!1,_this.disconnecting=!1,_this.syncing=!1,_this.discovering=!1,_this.spvFilter=null,_this.txFilter=null,_this.blockMap=new Set,_this.txMap=new Set,_this.compactBlocks=new Set,_this.invMap=new Map,_this.pendingFilter=null,_this.pendingRefill=null,_this.checkpoints=!1,_this.headerChain=new List,_this.headerNext=null,_this.headerTip=null,_this.peers=new PeerList,_this.authdb=new BIP150.AuthDB(_this.options),_this.hosts=new HostList(_this.options),_this.id=0,_this.options.spv&&(_this.spvFilter=BloomFilter.fromRate(2e4,.001,BloomFilter.flags.ALL)),_this.options.mempool||(_this.txFilter=new RollingFilter(5e4,1e-6)),_this.init(),_this}return Pool.prototype.init=function(){var _this2=this;this.server.on("error",function(err){_this2.emit("error",err)}),this.server.on("connection",function(socket){_this2.handleSocket(socket),_this2.emit("connection",socket)}),this.server.on("listening",function(){var data=_this2.server.address();_this2.logger.info("Pool server listening on %s (port=%d).",data.address,data.port),_this2.emit("listening",data)}),this.chain.on("block",function(block,entry){_this2.emit("block",block,entry)}),this.chain.on("reset",function(){_this2.checkpoints&&_this2.resetChain(),_this2.forceSync()}),this.chain.on("full",function(){_this2.sync(),_this2.emit("full"),_this2.logger.info("Chain is fully synced (height=%d).",_this2.chain.height)}),this.chain.on("bad orphan",function(err,id){_this2.handleBadOrphan("block",err,id)}),this.mempool&&(this.mempool.on("tx",function(tx){_this2.emit("tx",tx)}),this.mempool.on("bad orphan",function(err,id){_this2.handleBadOrphan("tx",err,id)})),this.options.selfish||this.options.spv||(this.mempool&&this.mempool.on("tx",function(tx){_this2.announceTX(tx)}),this.chain.on("block",function(block){_this2.chain.synced&&_this2.announceBlock(block)}))},Pool.prototype.open=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var key;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:assert(!this.opened,"Pool is already open."),this.opened=!0,this.logger.info("Pool loaded (maxpeers=%d).",this.options.maxOutbound),this.options.bip150&&(key=secp256k1.publicKeyCreate(this.options.identityKey,!0),this.logger.info("Identity public key: %s.",key.toString("hex")),this.logger.info("Identity address: %s.",BIP150.address(key))),this.resetChain();case 5:case"end":return _context.stop()}},_callee,this)}));return function(){return _ref.apply(this,arguments)}}(),Pool.prototype.close=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return assert(this.opened,"Pool is not open."),this.opened=!1,_context2.abrupt("return",this.disconnect());case 3:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref2.apply(this,arguments)}}(),Pool.prototype.resetChain=function(){if(this.options.checkpoints){this.checkpoints=!1,this.headerTip=null,this.headerChain.reset(),this.headerNext=null;var tip=this.chain.tip;tip.height<this.network.lastCheckpoint&&(this.checkpoints=!0,this.headerTip=this.getNextTip(tip.height),this.headerChain.push(new HeaderEntry(tip.hash,tip.height)),this.logger.info("Initialized header chain to height %d (checkpoint=%s).",tip.height,util.revHex(this.headerTip.hash)))}},Pool.prototype.connect=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var unlock;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,this.locker.lock();case 2:return unlock=_context3.sent,_context3.prev=3,_context3.next=6,this._connect();case 6:return _context3.abrupt("return",_context3.sent);case 7:return _context3.prev=7,unlock(),_context3.finish(7);case 10:case"end":return _context3.stop()}},_callee3,this,[[3,,7,10]])}));return function(){return _ref3.apply(this,arguments)}}(),Pool.prototype._connect=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(assert(this.opened,"Pool is not opened."),!this.connected){_context4.next=3;break}return _context4.abrupt("return");case 3:return _context4.next=5,this.hosts.open();case 5:return _context4.next=7,this.authdb.open();case 7:return _context4.next=9,this.discoverGateway();case 9:return _context4.next=11,this.discoverExternal();case 11:return _context4.next=13,this.discoverSeeds();case 13:return this.fillOutbound(),_context4.next=16,this.listen();case 16:this.startTimer(),this.connected=!0;case 18:case"end":return _context4.stop()}},_callee4,this)}));return function(){return _ref4.apply(this,arguments)}}(),Pool.prototype.disconnect=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){var unlock;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,this.locker.lock();case 2:return unlock=_context5.sent,_context5.prev=3,_context5.next=6,this._disconnect();case 6:return _context5.abrupt("return",_context5.sent);case 7:return _context5.prev=7,unlock(),_context5.finish(7);case 10:case"end":return _context5.stop()}},_callee5,this,[[3,,7,10]])}));return function(){return _ref5.apply(this,arguments)}}(),Pool.prototype._disconnect=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(){var _iterator,_isArray,_i,_ref7;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(this.connected){_context6.next=2;break}return _context6.abrupt("return");case 2:this.disconnecting=!0,_iterator=this.invMap.values(),_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();case 4:if(!_isArray){_context6.next=10;break}if(!(_i>=_iterator.length)){_context6.next=7;break}return _context6.abrupt("break",18);case 7:_ref7=_iterator[_i++],_context6.next=14;break;case 10:if(!(_i=_iterator.next()).done){_context6.next=13;break}return _context6.abrupt("break",18);case 13:_ref7=_i.value;case 14:_ref7.resolve();case 16:_context6.next=4;break;case 18:return this.peers.destroy(),this.blockMap.clear(),this.txMap.clear(),null!=this.pendingFilter&&(clearTimeout(this.pendingFilter),this.pendingFilter=null),null!=this.pendingRefill&&(clearTimeout(this.pendingRefill),this.pendingRefill=null),this.checkpoints=!1,this.headerTip=null,this.headerChain.reset(),this.headerNext=null,this.stopTimer(),_context6.next=30,this.authdb.close();case 30:return _context6.next=32,this.hosts.close();case 32:return _context6.next=34,this.unlisten();case 34:this.disconnecting=!1,this.syncing=!1,this.connected=!1;case 37:case"end":return _context6.stop()}},_callee6,this)}));return function(){return _ref6.apply(this,arguments)}}(),Pool.prototype.listen=function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(){return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(assert(this.server),assert(!this.connected,"Already listening."),this.options.listen){_context7.next=4;break}return _context7.abrupt("return");case 4:return this.server.maxConnections=this.options.maxInbound,_context7.next=7,this.server.listen(this.options.port,this.options.host);case 7:case"end":return _context7.stop()}},_callee7,this)}));return function(){return _ref8.apply(this,arguments)}}(),Pool.prototype.unlisten=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(){return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(assert(this.server),assert(this.connected,"Not listening."),this.options.listen){_context8.next=4;break}return _context8.abrupt("return");case 4:return _context8.next=6,this.server.close();case 6:case"end":return _context8.stop()}},_callee8,this)}));return function(){return _ref9.apply(this,arguments)}}(),Pool.prototype.startTimer=function(){var _this3=this;assert(null==this.timer,"Timer already started."),this.timer=setInterval(function(){return _this3.discover()},Pool.DISCOVERY_INTERVAL)},Pool.prototype.stopTimer=function(){assert(null!=this.timer,"Timer already stopped."),clearInterval(this.timer),this.timer=null},Pool.prototype.discover=function(){var _ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(){return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:if(!this.discovering){_context9.next=2;break}return _context9.abrupt("return");case 2:return _context9.prev=2,this.discovering=!0,_context9.next=6,this.discoverGateway();case 6:return _context9.next=8,this.discoverSeeds(!0);case 8:return _context9.prev=8,this.discovering=!1,_context9.finish(8);case 11:case"end":return _context9.stop()}},_callee9,this,[[2,,8,11]])}));return function(){return _ref10.apply(this,arguments)}}(),Pool.prototype.discoverGateway=function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(){var src,dest,wan,host;return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:if(src=this.options.publicPort,dest=this.options.port,this.options.listen){_context10.next=4;break}return _context10.abrupt("return",!1);case 4:if(this.options.upnp){_context10.next=6;break}return _context10.abrupt("return",!1);case 6:return wan=void 0,_context10.prev=7,this.logger.debug("Discovering internet gateway (upnp)."),_context10.next=11,UPNP.discover();case 11:wan=_context10.sent,_context10.next=19;break;case 14:return _context10.prev=14,_context10.t0=_context10.catch(7),this.logger.debug("Could not discover internet gateway (upnp)."),this.logger.debug(_context10.t0),_context10.abrupt("return",!1);case 19:return host=void 0,_context10.prev=20,_context10.next=23,wan.getExternalIP();case 23:host=_context10.sent,_context10.next=31;break;case 26:return _context10.prev=26,_context10.t1=_context10.catch(20),this.logger.debug("Could not find external IP (upnp)."),this.logger.debug(_context10.t1),_context10.abrupt("return",!1);case 31:return this.hosts.addLocal(host,src,scores.UPNP)&&this.logger.info("External IP found (upnp): %s.",host),this.logger.debug("Adding port mapping %d->%d.",src,dest),_context10.prev=33,_context10.next=36,wan.addPortMapping(host,src,dest);case 36:_context10.next=43;break;case 38:return _context10.prev=38,_context10.t2=_context10.catch(33),this.logger.debug("Could not add port mapping (upnp)."),this.logger.debug(_context10.t2),_context10.abrupt("return",!1);case 43:return _context10.abrupt("return",!0);case 44:case"end":return _context10.stop()}},_callee10,this,[[7,14],[20,26],[33,38]])}));return function(){return _ref11.apply(this,arguments)}}(),Pool.prototype.discoverSeeds=function(){var _ref12=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(checkPeers){var max,size,total,peer;return regeneratorRuntime.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:if(0!==this.hosts.dnsSeeds.length){_context11.next=2;break}return _context11.abrupt("return");case 2:max=Math.min(2,this.options.maxOutbound),size=this.hosts.size(),total=0,peer=this.peers.head();case 6:if(!peer){_context11.next=15;break}if(peer.outbound){_context11.next=9;break}return _context11.abrupt("continue",12);case 9:if(!peer.connected){_context11.next=12;break}if(!(++total>max)){_context11.next=12;break}return _context11.abrupt("break",15);case 12:peer=peer.next,_context11.next=6;break;case 15:if(!(0===size||checkPeers&&total<max)){_context11.next=22;break}return this.logger.warning("Could not find enough peers."),this.logger.warning("Hitting DNS seeds..."),_context11.next=20,this.hosts.discoverSeeds();case 20:this.logger.info("Resolved %d hosts from DNS seeds.",this.hosts.size()-size),this.refill();case 22:case"end":return _context11.stop()}},_callee11,this)}));return function(_x){return _ref12.apply(this,arguments)}}(),Pool.prototype.discoverExternal=function(){var _ref13=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(){var port,host4,host6;return regeneratorRuntime.wrap(function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:if(port=this.options.publicPort,this.options.listen){_context12.next=3;break}return _context12.abrupt("return");case 3:if(!this.options.proxy){_context12.next=5;break}return _context12.abrupt("return");case 5:if(!(this.hosts.local.size>0)){_context12.next=7;break}return _context12.abrupt("return");case 7:return host4=null,_context12.prev=8,_context12.next=11,dns.getIPv4(2e3);case 11:host4=_context12.sent,_context12.next=18;break;case 14:_context12.prev=14,_context12.t0=_context12.catch(8),this.logger.debug("Could not find external IPv4 (dns)."),this.logger.debug(_context12.t0);case 18:return host4&&this.hosts.addLocal(host4,port,scores.DNS)&&this.logger.info("External IPv4 found (dns): %s.",host4),host6=null,_context12.prev=20,_context12.next=23,dns.getIPv6(2e3);case 23:host6=_context12.sent,_context12.next=30;break;case 26:_context12.prev=26,_context12.t1=_context12.catch(20),this.logger.debug("Could not find external IPv6 (dns)."),this.logger.debug(_context12.t1);case 30:host6&&this.hosts.addLocal(host6,port,scores.DNS)&&this.logger.info("External IPv6 found (dns): %s.",host6);case 31:case"end":return _context12.stop()}},_callee12,this,[[8,14],[20,26]])}));return function(){return _ref13.apply(this,arguments)}}(),Pool.prototype.handleSocket=function(socket){if(!socket.remoteAddress)return this.logger.debug("Ignoring disconnected peer."),void socket.destroy();var ip=IP.normalize(socket.remoteAddress);if(this.peers.inbound>=this.options.maxInbound)return this.logger.debug("Ignoring peer: too many inbound (%s).",ip),void socket.destroy();if(this.hosts.isBanned(ip))return this.logger.debug("Ignoring banned peer (%s).",ip),void socket.destroy();var host=IP.toHostname(ip,socket.remotePort);assert(!this.peers.map.has(host),"Port collision."),this.addInbound(socket)},Pool.prototype.addLoader=function(){if(this.opened){assert(!this.peers.load);for(var _peer=this.peers.head();_peer;_peer=_peer.next)if(_peer.outbound)return this.logger.info("Repurposing peer for loader (%s).",_peer.hostname()),void this.setLoader(_peer);var addr=this.getHost();if(addr){var peer=this.createOutbound(addr);this.logger.info("Adding loader peer (%s).",peer.hostname()),this.peers.add(peer),this.setLoader(peer)}}},Pool.prototype.setLoader=function(peer){this.opened&&(assert(peer.outbound),assert(!this.peers.load),assert(!peer.loader),peer.loader=!0,this.peers.load=peer,this.sendSync(peer),this.emit("loader",peer))},Pool.prototype.startSync=function(){this.opened&&(assert(this.connected,"Pool is not connected!"),this.syncing=!0,this.resync(!1))},Pool.prototype.forceSync=function(){this.opened&&(assert(this.connected,"Pool is not connected!"),this.resync(!0))},Pool.prototype.sync=function(force){this.resync(!1)},Pool.prototype.stopSync=function(){if(this.syncing){this.syncing=!1;for(var peer=this.peers.head();peer;peer=peer.next)peer.outbound&&peer.syncing&&(peer.syncing=!1,peer.merkleBlock=null,peer.merkleTime=-1,peer.merkleMatches=0,peer.merkleMap=null,peer.blockTime=-1,peer.blockMap.clear(),peer.compactBlocks.clear());this.blockMap.clear(),this.compactBlocks.clear()}},Pool.prototype.resync=function(){var _ref14=_asyncToGenerator(regeneratorRuntime.mark(function _callee13(force){var locator,peer;return regeneratorRuntime.wrap(function(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:if(this.syncing){_context13.next=2;break}return _context13.abrupt("return");case 2:return locator=void 0,_context13.prev=3,_context13.next=6,this.chain.getLocator();case 6:locator=_context13.sent,_context13.next=13;break;case 9:return _context13.prev=9,_context13.t0=_context13.catch(3),this.emit("error",_context13.t0),_context13.abrupt("return");case 13:peer=this.peers.head();case 14:if(!peer){_context13.next=23;break}if(peer.outbound){_context13.next=17;break}return _context13.abrupt("continue",20);case 17:if(force||!peer.syncing){_context13.next=19;break}return _context13.abrupt("continue",20);case 19:this.sendLocator(locator,peer);case 20:peer=peer.next,_context13.next=14;break;case 23:case"end":return _context13.stop()}},_callee13,this,[[3,9]])}));return function(_x2){return _ref14.apply(this,arguments)}}(),Pool.prototype.isSyncable=function(peer){return!!this.syncing&&(!peer.destroyed&&(!!peer.handshake&&(!!(peer.services&services.NETWORK)&&!(!peer.loader&&!this.chain.synced))))},Pool.prototype.sendSync=function(){var _ref15=_asyncToGenerator(regeneratorRuntime.mark(function _callee14(peer){var locator;return regeneratorRuntime.wrap(function(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:if(!peer.syncing){_context14.next=2;break}return _context14.abrupt("return",!1);case 2:if(this.isSyncable(peer)){_context14.next=4;break}return _context14.abrupt("return",!1);case 4:return peer.syncing=!0,peer.blockTime=Date.now(),locator=void 0,_context14.prev=7,_context14.next=10,this.chain.getLocator();case 10:locator=_context14.sent,_context14.next=19;break;case 13:return _context14.prev=13,_context14.t0=_context14.catch(7),peer.syncing=!1,peer.blockTime=-1,this.emit("error",_context14.t0),_context14.abrupt("return",!1);case 19:return _context14.abrupt("return",this.sendLocator(locator,peer));case 20:case"end":return _context14.stop()}},_callee14,this,[[7,13]])}));return function(_x3){return _ref15.apply(this,arguments)}}(),Pool.prototype.sendLocator=function(locator,peer){return!!this.isSyncable(peer)&&(this.network.requestMempool&&peer.loader&&this.chain.synced&&peer.sendMempool(),peer.syncing=!0,peer.blockTime=Date.now(),this.checkpoints?(peer.sendGetHeaders(locator,this.headerTip.hash),!0):(peer.sendGetBlocks(locator),!0))},Pool.prototype.sendMempool=function(){for(var peer=this.peers.head();peer;peer=peer.next)peer.sendMempool()},Pool.prototype.sendGetAddr=function(){for(var peer=this.peers.head();peer;peer=peer.next)peer.sendGetAddr()},Pool.prototype.resolveHeaders=function(peer){for(var items=[],node=this.headerNext;node&&(this.headerNext=node.next,items.push(node.hash),5e4!==items.length);node=node.next);this.getBlock(peer,items)},Pool.prototype.resolveHeight=function(hash,height){for(var total=0,peer=this.peers.head();peer;peer=peer.next)peer.bestHash===hash&&peer.bestHeight!==height&&(peer.bestHeight=height,total+=1);total>0&&this.logger.debug("Resolved height for %d peers.",total)},Pool.prototype.getNextTip=function(height){var _iterator2=this.network.checkpoints,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref16;if(_isArray2){if(_i2>=_iterator2.length)break;_ref16=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref16=_i2.value}var next=_ref16;if(next.height>height)return new HeaderEntry(next.hash,next.height)}throw new Error("Next checkpoint not found.")},Pool.prototype.announceList=function(peer){var blocks=[],txs=[],_iterator3=this.invMap.values(),_isArray3=Array.isArray(_iterator3),_i3=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref17;if(_isArray3){if(_i3>=_iterator3.length)break;_ref17=_iterator3[_i3++]}else{if((_i3=_iterator3.next()).done)break;_ref17=_i3.value}var item=_ref17;switch(item.type){case invTypes.BLOCK:blocks.push(item.msg);break;case invTypes.TX:txs.push(item.msg);break;default:assert(!1,"Bad item type.")}}blocks.length>0&&peer.announceBlock(blocks),txs.length>0&&peer.announceTX(txs)},Pool.prototype.getBroadcasted=function(peer,item){var type=item.isTX()?invTypes.TX:invTypes.BLOCK,entry=this.invMap.get(item.hash);return entry?type!==entry.type?(this.logger.debug("Peer requested item with the wrong type (%s).",peer.hostname()),null):(this.logger.debug("Peer requested %s %s as a %s packet (%s).",item.isTX()?"tx":"block",item.rhash(),peer.hostname()),entry.handleAck(peer),entry.msg):null},Pool.prototype.getItem=function(){var _ref18=_asyncToGenerator(regeneratorRuntime.mark(function _callee15(peer,item){var entry;return regeneratorRuntime.wrap(function(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:if(!(entry=this.getBroadcasted(peer,item))){_context15.next=3;break}return _context15.abrupt("return",entry);case 3:if(!this.options.selfish){_context15.next=5;break}return _context15.abrupt("return",null);case 5:if(!item.isTX()){_context15.next=9;break}if(this.mempool){_context15.next=8;break}return _context15.abrupt("return",null);case 8:return _context15.abrupt("return",this.mempool.getTX(item.hash));case 9:if(!this.chain.options.spv){_context15.next=11;break}return _context15.abrupt("return",null);case 11:if(!this.chain.options.prune){_context15.next=13;break}return _context15.abrupt("return",null);case 13:return _context15.abrupt("return",this.chain.getBlock(item.hash));case 14:case"end":return _context15.stop()}},_callee15,this)}));return function(_x4,_x5){return _ref18.apply(this,arguments)}}(),Pool.prototype.sendBlock=function(){var _ref19=_asyncToGenerator(regeneratorRuntime.mark(function _callee16(peer,item){var broadcasted,_block,block;return regeneratorRuntime.wrap(function(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:if(!(broadcasted=this.getBroadcasted(peer,item))){_context16.next=4;break}return peer.send(new packets.BlockPacket(broadcasted)),_context16.abrupt("return",!0);case 4:if(!(this.options.selfish||this.chain.options.spv||this.chain.options.prune)){_context16.next=6;break}return _context16.abrupt("return",!1);case 6:if(!witness&&this.options.hasWitness()){_context16.next=14;break}return _context16.next=9,this.chain.getRawBlock(item.hash);case 9:if(!(_block=_context16.sent)){_context16.next=13;break}return peer.sendRaw("block",_block),_context16.abrupt("return",!0);case 13:return _context16.abrupt("return",!1);case 14:return _context16.next=16,this.chain.getBlock(item.hash);case 16:if(!(block=_context16.sent)){_context16.next=20;break}return peer.send(new packets.BlockPacket(block)),_context16.abrupt("return",!0);case 20:return _context16.abrupt("return",!1);case 21:case"end":return _context16.stop()}},_callee16,this)}));return function(_x6,_x7){return _ref19.apply(this,arguments)}}(),Pool.prototype.createOutbound=function(addr){var cipher=BIP151.ciphers.CHACHAPOLY,identity=this.options.identityKey,peer=Peer.fromOutbound(this.options,addr);return this.hosts.markAttempt(addr.hostname),this.options.bip151&&peer.setCipher(cipher),this.options.bip150&&peer.setAuth(this.authdb,identity),this.bindPeer(peer),this.logger.debug("Connecting to %s.",peer.hostname()),peer.tryOpen(),peer},Pool.prototype.createInbound=function(socket){var cipher=BIP151.ciphers.CHACHAPOLY,identity=this.options.identityKey,peer=Peer.fromInbound(this.options,socket);return this.options.bip151&&peer.setCipher(cipher),this.options.bip150&&peer.setAuth(this.authdb,identity),this.bindPeer(peer),peer.tryOpen(),peer},Pool.prototype.uid=function(){var MAX=Number.MAX_SAFE_INTEGER;this.id>=MAX-this.peers.size()-1&&(this.id=0);do{this.id+=1}while(this.peers.find(this.id));return this.id},Pool.prototype.bindPeer=function(peer){var _this4=this;peer.id=this.uid(),peer.onPacket=function(packet){return _this4.handlePacket(peer,packet)},peer.on("error",function(err){_this4.logger.debug(err)}),peer.once("connect",function(){_this4.handleConnect(peer)}),peer.once("open",function(){_this4.handleOpen(peer)}),peer.once("close",function(connected){_this4.handleClose(peer,connected)}),peer.once("ban",function(){_this4.handleBan(peer)})},Pool.prototype.handlePacket=function(){var _ref20=_asyncToGenerator(regeneratorRuntime.mark(function _callee17(peer,packet){return regeneratorRuntime.wrap(function(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:_context17.t0=packet.type,_context17.next=_context17.t0===packetTypes.VERSION?3:_context17.t0===packetTypes.VERACK?6:_context17.t0===packetTypes.PING?9:_context17.t0===packetTypes.PONG?12:_context17.t0===packetTypes.GETADDR?15:_context17.t0===packetTypes.ADDR?18:_context17.t0===packetTypes.INV?21:_context17.t0===packetTypes.GETDATA?24:_context17.t0===packetTypes.NOTFOUND?27:_context17.t0===packetTypes.GETBLOCKS?30:_context17.t0===packetTypes.GETHEADERS?33:_context17.t0===packetTypes.HEADERS?36:_context17.t0===packetTypes.SENDHEADERS?39:_context17.t0===packetTypes.BLOCK?42:_context17.t0===packetTypes.TX?45:_context17.t0===packetTypes.REJECT?48:_context17.t0===packetTypes.MEMPOOL?51:_context17.t0===packetTypes.FILTERLOAD?54:_context17.t0===packetTypes.FILTERADD?57:_context17.t0===packetTypes.FILTERCLEAR?60:_context17.t0===packetTypes.MERKLEBLOCK?63:_context17.t0===packetTypes.FEEFILTER?66:_context17.t0===packetTypes.SENDCMPCT?69:_context17.t0===packetTypes.CMPCTBLOCK?72:_context17.t0===packetTypes.GETBLOCKTXN?75:_context17.t0===packetTypes.BLOCKTXN?78:_context17.t0===packetTypes.ENCINIT?81:_context17.t0===packetTypes.ENCACK?84:_context17.t0===packetTypes.AUTHCHALLENGE?87:_context17.t0===packetTypes.AUTHREPLY?90:_context17.t0===packetTypes.AUTHPROPOSE?93:_context17.t0===packetTypes.UNKNOWN?96:99;break;case 3:return _context17.next=5,this.handleVersion(peer,packet);case 5:return _context17.abrupt("break",101);case 6:return _context17.next=8,this.handleVerack(peer,packet);case 8:return _context17.abrupt("break",101);case 9:return _context17.next=11,this.handlePing(peer,packet);case 11:return _context17.abrupt("break",101);case 12:return _context17.next=14,this.handlePong(peer,packet);case 14:return _context17.abrupt("break",101);case 15:return _context17.next=17,this.handleGetAddr(peer,packet);case 17:return _context17.abrupt("break",101);case 18:return _context17.next=20,this.handleAddr(peer,packet);case 20:return _context17.abrupt("break",101);case 21:return _context17.next=23,this.handleInv(peer,packet);case 23:return _context17.abrupt("break",101);case 24:return _context17.next=26,this.handleGetData(peer,packet);case 26:return _context17.abrupt("break",101);case 27:return _context17.next=29,this.handleNotFound(peer,packet);case 29:return _context17.abrupt("break",101);case 30:return _context17.next=32,this.handleGetBlocks(peer,packet);case 32:return _context17.abrupt("break",101);case 33:return _context17.next=35,this.handleGetHeaders(peer,packet);case 35:return _context17.abrupt("break",101);case 36:return _context17.next=38,this.handleHeaders(peer,packet);case 38:return _context17.abrupt("break",101);case 39:return _context17.next=41,this.handleSendHeaders(peer,packet);case 41:return _context17.abrupt("break",101);case 42:return _context17.next=44,this.handleBlock(peer,packet);case 44:return _context17.abrupt("break",101);case 45:return _context17.next=47,this.handleTX(peer,packet);case 47:return _context17.abrupt("break",101);case 48:return _context17.next=50,this.handleReject(peer,packet);case 50:return _context17.abrupt("break",101);case 51:return _context17.next=53,this.handleMempool(peer,packet);case 53:return _context17.abrupt("break",101);case 54:return _context17.next=56,this.handleFilterLoad(peer,packet);case 56:return _context17.abrupt("break",101);case 57:return _context17.next=59,this.handleFilterAdd(peer,packet);case 59:return _context17.abrupt("break",101);case 60:return _context17.next=62,this.handleFilterClear(peer,packet);case 62:return _context17.abrupt("break",101);case 63:return _context17.next=65,this.handleMerkleBlock(peer,packet);case 65:return _context17.abrupt("break",101);case 66:return _context17.next=68,this.handleFeeFilter(peer,packet);case 68:return _context17.abrupt("break",101);case 69:return _context17.next=71,this.handleSendCmpct(peer,packet);case 71:return _context17.abrupt("break",101);case 72:return _context17.next=74,this.handleCmpctBlock(peer,packet);case 74:return _context17.abrupt("break",101);case 75:return _context17.next=77,this.handleGetBlockTxn(peer,packet);case 77:return _context17.abrupt("break",101);case 78:return _context17.next=80,this.handleBlockTxn(peer,packet);case 80:return _context17.abrupt("break",101);case 81:return _context17.next=83,this.handleEncinit(peer,packet);case 83:return _context17.abrupt("break",101);case 84:return _context17.next=86,this.handleEncack(peer,packet);case 86:return _context17.abrupt("break",101);case 87:return _context17.next=89,this.handleAuthChallenge(peer,packet);case 89:return _context17.abrupt("break",101);case 90:return _context17.next=92,this.handleAuthReply(peer,packet);case 92:return _context17.abrupt("break",101);case 93:return _context17.next=95,this.handleAuthPropose(peer,packet);case 95:return _context17.abrupt("break",101);case 96:return _context17.next=98,this.handleUnknown(peer,packet);case 98:return _context17.abrupt("break",101);case 99:return assert(!1,"Bad packet type."),_context17.abrupt("break",101);case 101:this.emit("packet",packet,peer);case 102:case"end":return _context17.stop()}},_callee17,this)}));return function(_x8,_x9){return _ref20.apply(this,arguments)}}(),Pool.prototype.handleConnect=function(){var _ref21=_asyncToGenerator(regeneratorRuntime.mark(function _callee18(peer){return regeneratorRuntime.wrap(function(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:this.logger.info("Connected to %s.",peer.hostname()),peer.outbound&&this.hosts.markSuccess(peer.hostname()),this.emit("peer connect",peer);case 3:case"end":return _context18.stop()}},_callee18,this)}));return function(_x10){return _ref21.apply(this,arguments)}}(),Pool.prototype.handleOpen=function(){var _ref22=_asyncToGenerator(regeneratorRuntime.mark(function _callee19(peer){var addr;return regeneratorRuntime.wrap(function(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:!this.options.selfish&&this.options.listen&&(addr=this.hosts.getLocal(peer.address))&&peer.send(new packets.AddrPacket([addr])),this.options.compact&&peer.sendCompact(this.options.blockMode),this.hosts.isFull()||peer.sendGetAddr(),this.spvFilter&&peer.sendFilterLoad(this.spvFilter),this.announceList(peer),-1!==this.options.feeRate&&peer.sendFeeRate(this.options.feeRate),peer.outbound&&this.sendSync(peer),peer.outbound&&(this.hosts.markAck(peer.hostname(),peer.services),peer.loader||this.peers.load&&!this.peers.load.handshake&&(assert(this.peers.load.loader),this.peers.load.loader=!1,this.peers.load=null),this.peers.load||this.setLoader(peer)),this.emit("peer open",peer);case 9:case"end":return _context19.stop()}},_callee19,this)}));return function(_x11){return _ref22.apply(this,arguments)}}(),Pool.prototype.handleClose=function(){var _ref23=_asyncToGenerator(regeneratorRuntime.mark(function _callee20(peer,connected){var outbound,loader,size;return regeneratorRuntime.wrap(function(_context20){for(;;)switch(_context20.prev=_context20.next){case 0:if(outbound=peer.outbound,loader=peer.loader,size=peer.blockMap.size,this.removePeer(peer),loader&&(this.logger.info("Removed loader peer (%s).",peer.hostname()),this.checkpoints&&this.resetChain()),this.nonces.remove(peer.hostname()),this.emit("peer close",peer,connected),this.opened){_context20.next=9;break}return _context20.abrupt("return");case 9:if(!this.disconnecting){_context20.next=11;break}return _context20.abrupt("return");case 11:if(this.chain.synced&&size>0&&(this.logger.warning("Peer disconnected with requested blocks."),this.logger.warning("Resending sync..."),this.forceSync()),outbound){_context20.next=14;break}return _context20.abrupt("return");case 14:this.refill();case 15:case"end":return _context20.stop()}},_callee20,this)}));return function(_x12,_x13){return _ref23.apply(this,arguments)}}(),Pool.prototype.handleBan=function(){var _ref24=_asyncToGenerator(regeneratorRuntime.mark(function _callee21(peer){return regeneratorRuntime.wrap(function(_context21){for(;;)switch(_context21.prev=_context21.next){case 0:this.ban(peer.address),this.emit("ban",peer);case 2:case"end":return _context21.stop()}},_callee21,this)}));return function(_x14){return _ref24.apply(this,arguments)}}(),Pool.prototype.handleVersion=function(){var _ref25=_asyncToGenerator(regeneratorRuntime.mark(function _callee22(peer,packet){return regeneratorRuntime.wrap(function(_context22){for(;;)switch(_context22.prev=_context22.next){case 0:this.logger.info("Received version (%s): version=%d height=%d services=%s agent=%s",peer.hostname(),packet.version,packet.height,packet.services.toString(2),packet.agent),this.network.time.add(peer.hostname(),packet.time),this.nonces.remove(peer.hostname()),!peer.outbound&&packet.remote.isRoutable()&&this.hosts.markLocal(packet.remote);case 4:case"end":return _context22.stop()}},_callee22,this)}));return function(_x15,_x16){return _ref25.apply(this,arguments)}}(),Pool.prototype.handleVerack=function(){var _ref26=_asyncToGenerator(regeneratorRuntime.mark(function _callee23(peer,packet){return regeneratorRuntime.wrap(function(_context23){for(;;)switch(_context23.prev=_context23.next){case 0:case 1:case"end":return _context23.stop()}},_callee23,this)}));return function(_x17,_x18){return _ref26.apply(this,arguments)}}(),Pool.prototype.handlePing=function(){var _ref27=_asyncToGenerator(regeneratorRuntime.mark(function _callee24(peer,packet){return regeneratorRuntime.wrap(function(_context24){for(;;)switch(_context24.prev=_context24.next){case 0:case 1:case"end":return _context24.stop()}},_callee24,this)}));return function(_x19,_x20){return _ref27.apply(this,arguments)}}(),Pool.prototype.handlePong=function(){var _ref28=_asyncToGenerator(regeneratorRuntime.mark(function _callee25(peer,packet){return regeneratorRuntime.wrap(function(_context25){for(;;)switch(_context25.prev=_context25.next){case 0:case 1:case"end":return _context25.stop()}},_callee25,this)}));return function(_x21,_x22){return _ref28.apply(this,arguments)}}(),Pool.prototype.handleGetAddr=function(){var _ref29=_asyncToGenerator(regeneratorRuntime.mark(function _callee26(peer,packet){var addrs,items,_iterator4,_isArray4,_i4,_ref30,addr;return regeneratorRuntime.wrap(function(_context26){for(;;)switch(_context26.prev=_context26.next){case 0:if(!this.options.selfish){_context26.next=2;break}return _context26.abrupt("return");case 2:if(!peer.sentAddr){_context26.next=5;break}return this.logger.debug("Ignoring repeated getaddr (%s).",peer.hostname()),_context26.abrupt("return");case 5:peer.sentAddr=!0,addrs=this.hosts.toArray(),items=[],_iterator4=addrs,_isArray4=Array.isArray(_iterator4),_i4=0,_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();case 9:if(!_isArray4){_context26.next=15;break}if(!(_i4>=_iterator4.length)){_context26.next=12;break}return _context26.abrupt("break",27);case 12:_ref30=_iterator4[_i4++],_context26.next=19;break;case 15:if(!(_i4=_iterator4.next()).done){_context26.next=18;break}return _context26.abrupt("break",27);case 18:_ref30=_i4.value;case 19:if(addr=_ref30,peer.addrFilter.added(addr.hostname,"ascii")){_context26.next=22;break}return _context26.abrupt("continue",25);case 22:if(items.push(addr),1e3!==items.length){_context26.next=25;break}return _context26.abrupt("break",27);case 25:_context26.next=9;break;case 27:if(0!==items.length){_context26.next=29;break}return _context26.abrupt("return");case 29:this.logger.debug("Sending %d addrs to peer (%s)",items.length,peer.hostname()),peer.send(new packets.AddrPacket(items));case 31:case"end":return _context26.stop()}},_callee26,this)}));return function(_x23,_x24){return _ref29.apply(this,arguments)}}(),Pool.prototype.handleAddr=function(){var _ref31=_asyncToGenerator(regeneratorRuntime.mark(function _callee27(peer,packet){var addrs,now,services,_iterator5,_isArray5,_i5,_ref32,addr;return regeneratorRuntime.wrap(function(_context27){for(;;)switch(_context27.prev=_context27.next){case 0:addrs=packet.items,now=this.network.now(),services=this.options.getRequiredServices(),_iterator5=addrs,_isArray5=Array.isArray(_iterator5),_i5=0,_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();case 4:if(!_isArray5){_context27.next=10;break}if(!(_i5>=_iterator5.length)){_context27.next=7;break}return _context27.abrupt("break",26);case 7:_ref32=_iterator5[_i5++],_context27.next=14;break;case 10:if(!(_i5=_iterator5.next()).done){_context27.next=13;break}return _context27.abrupt("break",26);case 13:_ref32=_i5.value;case 14:if(addr=_ref32,peer.addrFilter.add(addr.hostname,"ascii"),addr.isRoutable()){_context27.next=18;break}return _context27.abrupt("continue",24);case 18:if(addr.hasServices(services)){_context27.next=20;break}return _context27.abrupt("continue",24);case 20:if((addr.time<=1e8||addr.time>now+600)&&(addr.time=now-432e3),0!==addr.port){_context27.next=23;break}return _context27.abrupt("continue",24);case 23:this.hosts.add(addr,peer.address);case 24:_context27.next=4;break;case 26:this.logger.info("Received %d addrs (hosts=%d, peers=%d) (%s).",addrs.length,this.hosts.size(),this.peers.size(),peer.hostname()),this.fillOutbound();case 28:case"end":return _context27.stop()}},_callee27,this)}));return function(_x25,_x26){return _ref31.apply(this,arguments)}}(),Pool.prototype.handleInv=function(){var _ref33=_asyncToGenerator(regeneratorRuntime.mark(function _callee28(peer,packet){var unlock;return regeneratorRuntime.wrap(function(_context28){for(;;)switch(_context28.prev=_context28.next){case 0:return _context28.next=2,this.locker.lock();case 2:return unlock=_context28.sent,_context28.prev=3,_context28.next=6,this._handleInv(peer,packet);case 6:return _context28.abrupt("return",_context28.sent);case 7:return _context28.prev=7,unlock(),_context28.finish(7);case 10:case"end":return _context28.stop()}},_callee28,this,[[3,,7,10]])}));return function(_x27,_x28){return _ref33.apply(this,arguments)}}(),Pool.prototype._handleInv=function(){var _ref34=_asyncToGenerator(regeneratorRuntime.mark(function _callee29(peer,packet){var items,blocks,txs,unknown,_iterator6,_isArray6,_i6,_ref35,item;return regeneratorRuntime.wrap(function(_context29){for(;;)switch(_context29.prev=_context29.next){case 0:if(!((items=packet.items).length>5e4)){_context29.next=4;break}return peer.increaseBan(100),_context29.abrupt("return");case 4:blocks=[],txs=[],unknown=-1,_iterator6=items,_isArray6=Array.isArray(_iterator6),_i6=0,_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();case 8:if(!_isArray6){_context29.next=14;break}if(!(_i6>=_iterator6.length)){_context29.next=11;break}return _context29.abrupt("break",31);case 11:_ref35=_iterator6[_i6++],_context29.next=18;break;case 14:if(!(_i6=_iterator6.next()).done){_context29.next=17;break}return _context29.abrupt("break",31);case 17:_ref35=_i6.value;case 18:item=_ref35,_context29.t0=item.type,_context29.next=_context29.t0===invTypes.BLOCK?22:_context29.t0===invTypes.TX?24:26;break;case 22:return blocks.push(item.hash),_context29.abrupt("break",28);case 24:return txs.push(item.hash),_context29.abrupt("break",28);case 26:return unknown=item.type,_context29.abrupt("continue",29);case 28:peer.invFilter.add(item.hash,"hex");case 29:_context29.next=8;break;case 31:if(this.logger.spam("Received inv packet with %d items: blocks=%d txs=%d (%s).",items.length,blocks.length,txs.length,peer.hostname()),-1!==unknown&&this.logger.warning("Peer sent an unknown inv type: %d (%s).",unknown,peer.hostname()),!(blocks.length>0)){_context29.next=36;break}return _context29.next=36,this.handleBlockInv(peer,blocks);case 36:if(!(txs.length>0)){_context29.next=39;break}return _context29.next=39,this.handleTXInv(peer,txs);case 39:case"end":return _context29.stop()}},_callee29,this)}));return function(_x29,_x30){return _ref34.apply(this,arguments)}}(),Pool.prototype.handleBlockInv=function(){var _ref36=_asyncToGenerator(regeneratorRuntime.mark(function _callee30(peer,hashes){var hash,items,exists,i,_hash,height;return regeneratorRuntime.wrap(function(_context30){for(;;)switch(_context30.prev=_context30.next){case 0:if(assert(hashes.length>0),this.syncing){_context30.next=3;break}return _context30.abrupt("return");case 3:if(peer.loader&&!this.chain.synced||(hash=hashes[hashes.length-1],peer.bestHash=hash),this.chain.synced||peer.loader){_context30.next=6;break}return _context30.abrupt("return");case 6:if(!this.options.hasWitness()||peer.hasWitness()){_context30.next=8;break}return _context30.abrupt("return");case 8:if(!this.checkpoints){_context30.next=10;break}return _context30.abrupt("return");case 10:this.logger.debug("Received %s block hashes from peer (%s).",hashes.length,peer.hostname()),items=[],exists=null,i=0;case 14:if(!(i<hashes.length)){_context30.next=34;break}if(_hash=hashes[i],!this.chain.hasOrphan(_hash)){_context30.next=21;break}return this.logger.debug("Received known orphan hash (%s).",peer.hostname()),_context30.next=20,this.resolveOrphan(peer,_hash);case 20:return _context30.abrupt("continue",31);case 21:return _context30.next=23,this.hasBlock(_hash);case 23:if(_context30.sent){_context30.next=26;break}return items.push(_hash),_context30.abrupt("continue",31);case 26:if(exists=_hash,i!==hashes.length-1){_context30.next=31;break}return this.logger.debug("Received existing hash (%s).",peer.hostname()),_context30.next=31,this.getBlocks(peer,_hash);case 31:i++,_context30.next=14;break;case 34:if(!exists||!this.chain.synced){_context30.next=39;break}return _context30.next=37,this.chain.getHeight(exists);case 37:-1!==(height=_context30.sent)&&(peer.bestHeight=height);case 39:this.getBlock(peer,items);case 40:case"end":return _context30.stop()}},_callee30,this)}));return function(_x31,_x32){return _ref36.apply(this,arguments)}}(),Pool.prototype.handleTXInv=function(){var _ref37=_asyncToGenerator(regeneratorRuntime.mark(function _callee31(peer,hashes){return regeneratorRuntime.wrap(function(_context31){for(;;)switch(_context31.prev=_context31.next){case 0:if(assert(hashes.length>0),!this.syncing||this.chain.synced){_context31.next=3;break}return _context31.abrupt("return");case 3:this.ensureTX(peer,hashes);case 4:case"end":return _context31.stop()}},_callee31,this)}));return function(_x33,_x34){return _ref37.apply(this,arguments)}}(),Pool.prototype.handleGetData=function(){var _ref38=_asyncToGenerator(regeneratorRuntime.mark(function _callee32(peer,packet){var items,notFound,txs,blocks,compact,unknown,_iterator7,_isArray7,_i7,_ref39,item,tx,block,merkle,_iterator8,_isArray8,_i8,_ref40,_tx,_block2;return regeneratorRuntime.wrap(function(_context32){for(;;)switch(_context32.prev=_context32.next){case 0:if(!((items=packet.items).length>5e4)){_context32.next=6;break}return this.logger.warning("Peer sent inv with >50k items (%s).",peer.hostname()),peer.increaseBan(100),peer.destroy(),_context32.abrupt("return");case 6:notFound=[],txs=0,blocks=0,compact=0,unknown=-1,_iterator7=items,_isArray7=Array.isArray(_iterator7),_i7=0,_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();case 12:if(!_isArray7){_context32.next=18;break}if(!(_i7>=_iterator7.length)){_context32.next=15;break}return _context32.abrupt("break",111);case 15:_ref39=_iterator7[_i7++],_context32.next=22;break;case 18:if(!(_i7=_iterator7.next()).done){_context32.next=21;break}return _context32.abrupt("break",111);case 21:_ref39=_i7.value;case 22:if(!(item=_ref39).isTX()){_context32.next=37;break}return _context32.next=26,this.getItem(peer,item);case 26:if(tx=_context32.sent){_context32.next=30;break}return notFound.push(item),_context32.abrupt("continue",109);case 30:if(!tx.isCoinbase()){_context32.next=34;break}return notFound.push(item),this.logger.warning("Failsafe: tried to relay a coinbase."),_context32.abrupt("continue",109);case 34:return peer.send(new packets.TXPacket(tx,item.hasWitness())),txs+=1,_context32.abrupt("continue",109);case 37:_context32.t0=item.type,_context32.next=_context32.t0===invTypes.BLOCK?40:_context32.t0===invTypes.WITNESS_BLOCK?40:_context32.t0===invTypes.FILTERED_BLOCK?48:_context32.t0===invTypes.WITNESS_FILTERED_BLOCK?48:_context32.t0===invTypes.CMPCT_BLOCK?81:103;break;case 40:return _context32.next=42,this.sendBlock(peer,item,item.hasWitness());case 42:if(_context32.sent){_context32.next=46;break}return notFound.push(item),_context32.abrupt("continue",109);case 46:return blocks+=1,_context32.abrupt("break",106);case 48:if(this.options.bip37){_context32.next=52;break}return this.logger.debug("Peer requested a merkleblock without bip37 enabled (%s).",peer.hostname()),peer.destroy(),_context32.abrupt("return");case 52:if(peer.spvFilter){_context32.next=55;break}return notFound.push(item),_context32.abrupt("continue",109);case 55:return _context32.next=57,this.getItem(peer,item);case 57:if(block=_context32.sent){_context32.next=61;break}return notFound.push(item),_context32.abrupt("continue",109);case 61:merkle=block.toMerkle(peer.spvFilter),peer.send(new packets.MerkleBlockPacket(merkle)),_iterator8=merkle.txs,_isArray8=Array.isArray(_iterator8),_i8=0,_iterator8=_isArray8?_iterator8:_iterator8[Symbol.iterator]();case 64:if(!_isArray8){_context32.next=70;break}if(!(_i8>=_iterator8.length)){_context32.next=67;break}return _context32.abrupt("break",79);case 67:_ref40=_iterator8[_i8++],_context32.next=74;break;case 70:if(!(_i8=_iterator8.next()).done){_context32.next=73;break}return _context32.abrupt("break",79);case 73:_ref40=_i8.value;case 74:_tx=_ref40,peer.send(new packets.TXPacket(_tx,item.hasWitness())),txs+=1;case 77:_context32.next=64;break;case 79:return blocks+=1,_context32.abrupt("break",106);case 81:return _context32.next=83,this.chain.getHeight(item.hash);case 83:if(!(_context32.sent<this.chain.tip.height-10)){_context32.next=93;break}return _context32.next=87,this.sendBlock(peer,item,peer.compactWitness);case 87:if(_context32.sent){_context32.next=91;break}return notFound.push(item),_context32.abrupt("continue",109);case 91:return blocks+=1,_context32.abrupt("break",106);case 93:return _context32.next=95,this.getItem(peer,item);case 95:if(_block2=_context32.sent){_context32.next=99;break}return notFound.push(item),_context32.abrupt("continue",109);case 99:return peer.sendCompactBlock(_block2),blocks+=1,compact+=1,_context32.abrupt("break",106);case 103:return unknown=item.type,notFound.push(item),_context32.abrupt("continue",109);case 106:return item.hash===peer.hashContinue&&(peer.sendInv([new InvItem(invTypes.BLOCK,this.chain.tip.hash)]),peer.hashContinue=null),_context32.next=109,peer.drain();case 109:_context32.next=12;break;case 111:notFound.length>0&&peer.send(new packets.NotFoundPacket(notFound)),txs>0&&this.logger.debug("Served %d txs with getdata (notfound=%d) (%s).",txs,notFound.length,peer.hostname()),blocks>0&&this.logger.debug("Served %d blocks with getdata (notfound=%d, cmpct=%d) (%s).",blocks,notFound.length,compact,peer.hostname()),-1!==unknown&&this.logger.warning("Peer sent an unknown getdata type: %s (%d).",unknown,peer.hostname());case 115:case"end":return _context32.stop()}},_callee32,this)}));return function(_x35,_x36){return _ref38.apply(this,arguments)}}(),Pool.prototype.handleNotFound=function(){var _ref41=_asyncToGenerator(regeneratorRuntime.mark(function _callee33(peer,packet){var items,_iterator9,_isArray9,_i9,_ref42,item;return regeneratorRuntime.wrap(function(_context33){for(;;)switch(_context33.prev=_context33.next){case 0:items=packet.items,_iterator9=items,_isArray9=Array.isArray(_iterator9),_i9=0,_iterator9=_isArray9?_iterator9:_iterator9[Symbol.iterator]();case 2:if(!_isArray9){_context33.next=8;break}if(!(_i9>=_iterator9.length)){_context33.next=5;break}return _context33.abrupt("break",19);case 5:_ref42=_iterator9[_i9++],_context33.next=12;break;case 8:if(!(_i9=_iterator9.next()).done){_context33.next=11;break}return _context33.abrupt("break",19);case 11:_ref42=_i9.value;case 12:if(item=_ref42,this.resolveItem(peer,item)){_context33.next=17;break}return this.logger.warning("Peer sent notfound for unrequested item: %s (%s).",item.hash,peer.hostname()),peer.destroy(),_context33.abrupt("return");case 17:_context33.next=2;break;case 19:case"end":return _context33.stop()}},_callee33,this)}));return function(_x37,_x38){return _ref41.apply(this,arguments)}}(),Pool.prototype.handleGetBlocks=function(){var _ref43=_asyncToGenerator(regeneratorRuntime.mark(function _callee34(peer,packet){var hash,blocks;return regeneratorRuntime.wrap(function(_context34){for(;;)switch(_context34.prev=_context34.next){case 0:if(this.chain.synced){_context34.next=2;break}return _context34.abrupt("return");case 2:if(!this.options.selfish){_context34.next=4;break}return _context34.abrupt("return");case 4:if(!this.chain.options.spv){_context34.next=6;break}return _context34.abrupt("return");case 6:if(!this.chain.options.prune){_context34.next=8;break}return _context34.abrupt("return");case 8:return _context34.next=10,this.chain.findLocator(packet.locator);case 10:if(!(hash=_context34.sent)){_context34.next=15;break}return _context34.next=14,this.chain.getNextHash(hash);case 14:hash=_context34.sent;case 15:blocks=[];case 16:if(!hash){_context34.next=28;break}if(blocks.push(new InvItem(invTypes.BLOCK,hash)),hash!==packet.stop){_context34.next=20;break}return _context34.abrupt("break",28);case 20:if(500!==blocks.length){_context34.next=23;break}return peer.hashContinue=hash,_context34.abrupt("break",28);case 23:return _context34.next=25,this.chain.getNextHash(hash);case 25:hash=_context34.sent,_context34.next=16;break;case 28:peer.sendInv(blocks);case 29:case"end":return _context34.stop()}},_callee34,this)}));return function(_x39,_x40){return _ref43.apply(this,arguments)}}(),Pool.prototype.handleGetHeaders=function(){var _ref44=_asyncToGenerator(regeneratorRuntime.mark(function _callee35(peer,packet){var hash,entry,headers;return regeneratorRuntime.wrap(function(_context35){for(;;)switch(_context35.prev=_context35.next){case 0:if(this.chain.synced){_context35.next=2;break}return _context35.abrupt("return");case 2:if(!this.options.selfish){_context35.next=4;break}return _context35.abrupt("return");case 4:if(!this.chain.options.spv){_context35.next=6;break}return _context35.abrupt("return");case 6:if(!this.chain.options.prune){_context35.next=8;break}return _context35.abrupt("return");case 8:if(hash=void 0,!(packet.locator.length>0)){_context35.next=19;break}return _context35.next=12,this.chain.findLocator(packet.locator);case 12:if(!(hash=_context35.sent)){_context35.next=17;break}return _context35.next=16,this.chain.getNextHash(hash);case 16:hash=_context35.sent;case 17:_context35.next=20;break;case 19:hash=packet.stop;case 20:if(entry=void 0,!hash){_context35.next=25;break}return _context35.next=24,this.chain.getEntry(hash);case 24:entry=_context35.sent;case 25:headers=[];case 26:if(!entry){_context35.next=37;break}if(headers.push(entry.toHeaders()),entry.hash!==packet.stop){_context35.next=30;break}return _context35.abrupt("break",37);case 30:if(2e3!==headers.length){_context35.next=32;break}return _context35.abrupt("break",37);case 32:return _context35.next=34,this.chain.getNext(entry);case 34:entry=_context35.sent,_context35.next=26;break;case 37:peer.sendHeaders(headers);case 38:case"end":return _context35.stop()}},_callee35,this)}));return function(_x41,_x42){return _ref44.apply(this,arguments)}}(),Pool.prototype.handleHeaders=function(){var _ref45=_asyncToGenerator(regeneratorRuntime.mark(function _callee36(peer,packet){var unlock;return regeneratorRuntime.wrap(function(_context36){for(;;)switch(_context36.prev=_context36.next){case 0:return _context36.next=2,this.locker.lock();case 2:return unlock=_context36.sent,_context36.prev=3,_context36.next=6,this._handleHeaders(peer,packet);case 6:return _context36.abrupt("return",_context36.sent);case 7:return _context36.prev=7,unlock(),_context36.finish(7);case 10:case"end":return _context36.stop()}},_callee36,this,[[3,,7,10]])}));return function(_x43,_x44){return _ref45.apply(this,arguments)}}(),Pool.prototype._handleHeaders=function(){var _ref46=_asyncToGenerator(regeneratorRuntime.mark(function _callee37(peer,packet){var headers,checkpoint,node,_iterator10,_isArray10,_i10,_ref47,header,last,hash,height;return regeneratorRuntime.wrap(function(_context37){for(;;)switch(_context37.prev=_context37.next){case 0:if(headers=packet.items,this.checkpoints){_context37.next=3;break}return _context37.abrupt("return");case 3:if(this.syncing){_context37.next=5;break}return _context37.abrupt("return");case 5:if(peer.loader){_context37.next=7;break}return _context37.abrupt("return");case 7:if(0!==headers.length){_context37.next=9;break}return _context37.abrupt("return");case 9:if(!(headers.length>2e3)){_context37.next=12;break}return peer.increaseBan(100),_context37.abrupt("return");case 12:assert(this.headerChain.size>0),checkpoint=!1,node=null,_iterator10=headers,_isArray10=Array.isArray(_iterator10),_i10=0,_iterator10=_isArray10?_iterator10:_iterator10[Symbol.iterator]();case 16:if(!_isArray10){_context37.next=22;break}if(!(_i10>=_iterator10.length)){_context37.next=19;break}return _context37.abrupt("break",50);case 19:_ref47=_iterator10[_i10++],_context37.next=26;break;case 22:if(!(_i10=_iterator10.next()).done){_context37.next=25;break}return _context37.abrupt("break",50);case 25:_ref47=_i10.value;case 26:if(header=_ref47,last=this.headerChain.tail,hash=header.hash("hex"),height=last.height+1,header.verify()){_context37.next=35;break}return this.logger.warning("Peer sent an invalid header (%s).",peer.hostname()),peer.increaseBan(100),peer.destroy(),_context37.abrupt("return");case 35:if(header.prevBlock===last.hash){_context37.next=39;break}return this.logger.warning("Peer sent a bad header chain (%s).",peer.hostname()),peer.destroy(),_context37.abrupt("return");case 39:if((node=new HeaderEntry(hash,height)).height!==this.headerTip.height){_context37.next=46;break}if(node.hash===this.headerTip.hash){_context37.next=45;break}return this.logger.warning("Peer sent an invalid checkpoint (%s).",peer.hostname()),peer.destroy(),_context37.abrupt("return");case 45:checkpoint=!0;case 46:this.headerNext||(this.headerNext=node),this.headerChain.push(node);case 48:_context37.next=16;break;case 50:if(this.logger.debug("Received %s headers from peer (%s).",headers.length,peer.hostname()),peer.blockTime=Date.now(),!checkpoint){_context37.next=56;break}return this.headerChain.shift(),this.resolveHeaders(peer),_context37.abrupt("return");case 56:peer.sendGetHeaders([node.hash],this.headerTip.hash);case 57:case"end":return _context37.stop()}},_callee37,this)}));return function(_x45,_x46){return _ref46.apply(this,arguments)}}(),Pool.prototype.handleSendHeaders=function(){var _ref48=_asyncToGenerator(regeneratorRuntime.mark(function _callee38(peer,packet){return regeneratorRuntime.wrap(function(_context38){for(;;)switch(_context38.prev=_context38.next){case 0:case 1:case"end":return _context38.stop()}},_callee38,this)}));return function(_x47,_x48){return _ref48.apply(this,arguments)}}(),Pool.prototype.handleBlock=function(){var _ref49=_asyncToGenerator(regeneratorRuntime.mark(function _callee39(peer,packet){var flags;return regeneratorRuntime.wrap(function(_context39){for(;;)switch(_context39.prev=_context39.next){case 0:if(flags=chainCommon.flags.DEFAULT_FLAGS,!this.options.spv){_context39.next=4;break}return this.logger.warning("Peer sent unsolicited block (%s).",peer.hostname()),_context39.abrupt("return");case 4:return _context39.next=6,this.addBlock(peer,packet.block,flags);case 6:case"end":return _context39.stop()}},_callee39,this)}));return function(_x49,_x50){return _ref49.apply(this,arguments)}}(),Pool.prototype.addBlock=function(){var _ref50=_asyncToGenerator(regeneratorRuntime.mark(function _callee40(peer,block,flags){var hash,unlock;return regeneratorRuntime.wrap(function(_context40){for(;;)switch(_context40.prev=_context40.next){case 0:return hash=block.hash("hex"),_context40.next=3,this.locker.lock(hash);case 3:return unlock=_context40.sent,_context40.prev=4,_context40.next=7,this._addBlock(peer,block,flags);case 7:return _context40.abrupt("return",_context40.sent);case 8:return _context40.prev=8,unlock(),_context40.finish(8);case 11:case"end":return _context40.stop()}},_callee40,this,[[4,,8,11]])}));return function(_x51,_x52,_x53){return _ref50.apply(this,arguments)}}(),Pool.prototype._addBlock=function(){var _ref51=_asyncToGenerator(regeneratorRuntime.mark(function _callee41(peer,block,flags){var hash,entry,height;return regeneratorRuntime.wrap(function(_context41){for(;;)switch(_context41.prev=_context41.next){case 0:if(this.syncing){_context41.next=2;break}return _context41.abrupt("return");case 2:if(hash=block.hash("hex"),this.resolveBlock(peer,hash)){_context41.next=7;break}return this.logger.warning("Received unrequested block: %s (%s).",block.rhash(),peer.hostname()),peer.destroy(),_context41.abrupt("return");case 7:return peer.blockTime=Date.now(),entry=void 0,_context41.prev=9,_context41.next=12,this.chain.add(block,flags,peer.id);case 12:entry=_context41.sent,_context41.next=22;break;case 15:if(_context41.prev=15,_context41.t0=_context41.catch(9),"VerifyError"!==_context41.t0.type){_context41.next=21;break}return peer.reject("block",_context41.t0),this.logger.warning(_context41.t0),_context41.abrupt("return");case 21:throw _context41.t0;case 22:if(entry){_context41.next=32;break}if(!this.checkpoints){_context41.next=26;break}return this.logger.warning("Peer sent orphan block with getheaders (%s).",peer.hostname()),_context41.abrupt("return");case 26:return-1!==(height=block.getCoinbaseHeight())&&(peer.bestHash=hash,peer.bestHeight=height,this.resolveHeight(hash,height)),this.logger.debug("Peer sent an orphan block. Resolving."),_context41.next=31,this.resolveOrphan(peer,hash);case 31:return _context41.abrupt("return");case 32:return this.chain.synced&&(peer.bestHash=entry.hash,peer.bestHeight=entry.height,this.resolveHeight(entry.hash,entry.height)),this.logStatus(block),_context41.next=36,this.resolveChain(peer,hash);case 36:case"end":return _context41.stop()}},_callee41,this,[[9,15]])}));return function(_x54,_x55,_x56){return _ref51.apply(this,arguments)}}(),Pool.prototype.resolveChain=function(){var _ref52=_asyncToGenerator(regeneratorRuntime.mark(function _callee42(peer,hash){var node;return regeneratorRuntime.wrap(function(_context42){for(;;)switch(_context42.prev=_context42.next){case 0:if(this.checkpoints){_context42.next=2;break}return _context42.abrupt("return");case 2:if(peer.loader){_context42.next=4;break}return _context42.abrupt("return");case 4:if(!peer.destroyed){_context42.next=6;break}throw new Error("Peer was destroyed (header chain resolution).");case 6:if(node=this.headerChain.head,assert(node),hash===node.hash){_context42.next=12;break}return this.logger.warning("Header hash mismatch %s != %s (%s).",util.revHex(hash),util.revHex(node.hash),peer.hostname()),peer.destroy(),_context42.abrupt("return");case 12:if(!(node.height<this.network.lastCheckpoint)){_context42.next=21;break}if(node.height!==this.headerTip.height){_context42.next=18;break}return this.logger.info("Received checkpoint %s (%d).",util.revHex(node.hash),node.height),this.headerTip=this.getNextTip(node.height),peer.sendGetHeaders([hash],this.headerTip.hash),_context42.abrupt("return");case 18:return this.headerChain.shift(),this.resolveHeaders(peer),_context42.abrupt("return");case 21:return this.logger.info("Switching to getblocks (%s).",peer.hostname()),_context42.next=24,this.switchSync(peer,hash);case 24:case"end":return _context42.stop()}},_callee42,this)}));return function(_x57,_x58){return _ref52.apply(this,arguments)}}(),Pool.prototype.switchSync=function(){var _ref53=_asyncToGenerator(regeneratorRuntime.mark(function _callee43(peer,hash){return regeneratorRuntime.wrap(function(_context43){for(;;)switch(_context43.prev=_context43.next){case 0:return assert(this.checkpoints),this.checkpoints=!1,this.headerTip=null,this.headerChain.reset(),this.headerNext=null,_context43.next=7,this.getBlocks(peer,hash);case 7:case"end":return _context43.stop()}},_callee43,this)}));return function(_x59,_x60){return _ref53.apply(this,arguments)}}(),Pool.prototype.handleBadOrphan=function(msg,err,id){var peer=this.peers.find(id);peer?(this.logger.debug("Punishing peer for sending a bad orphan (%s).",peer.hostname()),peer.reject(msg,err)):this.logger.warning("Could not find offending peer for orphan: %s (%d).",util.revHex(err.hash),id)},Pool.prototype.logStatus=function(block){this.chain.height%20==0&&this.logger.debug("Status: time=%s height=%d progress=%s orphans=%d active=%d target=%s peers=%d",util.date(block.time),this.chain.height,(100*this.chain.getProgress()).toFixed(2)+"%",this.chain.orphanMap.size,this.blockMap.size,block.bits,this.peers.size()),this.chain.height%2e3==0&&this.logger.info("Received 2000 more blocks (height=%d, hash=%s).",this.chain.height,block.rhash())},Pool.prototype.handleTX=function(){var _ref54=_asyncToGenerator(regeneratorRuntime.mark(function _callee44(peer,packet){var hash,unlock;return regeneratorRuntime.wrap(function(_context44){for(;;)switch(_context44.prev=_context44.next){case 0:return hash=packet.tx.hash("hex"),_context44.next=3,this.locker.lock(hash);case 3:return unlock=_context44.sent,_context44.prev=4,_context44.next=7,this._handleTX(peer,packet);case 7:return _context44.abrupt("return",_context44.sent);case 8:return _context44.prev=8,unlock(),_context44.finish(8);case 11:case"end":return _context44.stop()}},_callee44,this,[[4,,8,11]])}));return function(_x61,_x62){return _ref54.apply(this,arguments)}}(),Pool.prototype._handleTX=function(){var _ref55=_asyncToGenerator(regeneratorRuntime.mark(function _callee45(peer,packet){var tx,hash,flags,block,missing;return regeneratorRuntime.wrap(function(_context45){for(;;)switch(_context45.prev=_context45.next){case 0:if(tx=packet.tx,hash=tx.hash("hex"),flags=chainCommon.flags.VERIFY_NONE,!(block=peer.merkleBlock)){_context45.next=22;break}if(assert(peer.merkleMatches>0),assert(peer.merkleMap),!block.hasTX(hash)){_context45.next=22;break}if(!peer.merkleMap.has(hash)){_context45.next=12;break}return this.logger.warning("Peer sent duplicate merkle tx: %s (%s).",tx.txid(),peer.hostname()),peer.increaseBan(100),_context45.abrupt("return");case 12:if(peer.merkleMap.add(hash),block.txs.push(tx),0!=--peer.merkleMatches){_context45.next=21;break}return peer.merkleBlock=null,peer.merkleTime=-1,peer.merkleMatches=0,peer.merkleMap=null,_context45.next=21,this._addBlock(peer,block,flags);case 21:return _context45.abrupt("return");case 22:if(this.resolveTX(peer,hash)){_context45.next=26;break}return this.logger.warning("Peer sent unrequested tx: %s (%s).",tx.txid(),peer.hostname()),peer.destroy(),_context45.abrupt("return");case 26:if(this.mempool){_context45.next=29;break}return this.emit("tx",tx),_context45.abrupt("return");case 29:return missing=void 0,_context45.prev=30,_context45.next=33,this.mempool.addTX(tx,peer.id);case 33:missing=_context45.sent,_context45.next=43;break;case 36:if(_context45.prev=36,_context45.t0=_context45.catch(30),"VerifyError"!==_context45.t0.type){_context45.next=42;break}return peer.reject("tx",_context45.t0),this.logger.info(_context45.t0),_context45.abrupt("return");case 42:throw _context45.t0;case 43:missing&&missing.length>0&&(this.logger.debug("Requesting %d missing transactions (%s).",missing.length,peer.hostname()),this.ensureTX(peer,missing));case 44:case"end":return _context45.stop()}},_callee45,this,[[30,36]])}));return function(_x63,_x64){return _ref55.apply(this,arguments)}}(),Pool.prototype.handleReject=function(){var _ref56=_asyncToGenerator(regeneratorRuntime.mark(function _callee46(peer,packet){var entry;return regeneratorRuntime.wrap(function(_context46){for(;;)switch(_context46.prev=_context46.next){case 0:if(this.logger.warning("Received reject (%s): msg=%s code=%s reason=%s hash=%s.",peer.hostname(),packet.message,packet.getCode(),packet.reason,packet.rhash()),packet.hash){_context46.next=3;break}return _context46.abrupt("return");case 3:if(entry=this.invMap.get(packet.hash)){_context46.next=6;break}return _context46.abrupt("return");case 6:entry.handleReject(peer);case 7:case"end":return _context46.stop()}},_callee46,this)}));return function(_x65,_x66){return _ref56.apply(this,arguments)}}(),Pool.prototype.handleMempool=function(){var _ref57=_asyncToGenerator(regeneratorRuntime.mark(function _callee47(peer,packet){var items,_iterator11,_isArray11,_i11,_ref58,hash;return regeneratorRuntime.wrap(function(_context47){for(;;)switch(_context47.prev=_context47.next){case 0:if(this.mempool){_context47.next=2;break}return _context47.abrupt("return");case 2:if(this.chain.synced){_context47.next=4;break}return _context47.abrupt("return");case 4:if(!this.options.selfish){_context47.next=6;break}return _context47.abrupt("return");case 6:if(this.options.bip37){_context47.next=10;break}return this.logger.debug("Peer requested mempool without bip37 enabled (%s).",peer.hostname()),peer.destroy(),_context47.abrupt("return");case 10:items=[],_iterator11=this.mempool.map.keys(),_isArray11=Array.isArray(_iterator11),_i11=0,_iterator11=_isArray11?_iterator11:_iterator11[Symbol.iterator]();case 12:if(!_isArray11){_context47.next=18;break}if(!(_i11>=_iterator11.length)){_context47.next=15;break}return _context47.abrupt("break",26);case 15:_ref58=_iterator11[_i11++],_context47.next=22;break;case 18:if(!(_i11=_iterator11.next()).done){_context47.next=21;break}return _context47.abrupt("break",26);case 21:_ref58=_i11.value;case 22:hash=_ref58,items.push(new InvItem(invTypes.TX,hash));case 24:_context47.next=12;break;case 26:this.logger.debug("Sending mempool snapshot (%s).",peer.hostname()),peer.queueInv(items);case 28:case"end":return _context47.stop()}},_callee47,this)}));return function(_x67,_x68){return _ref57.apply(this,arguments)}}(),Pool.prototype.handleFilterLoad=function(){var _ref59=_asyncToGenerator(regeneratorRuntime.mark(function _callee48(peer,packet){return regeneratorRuntime.wrap(function(_context48){for(;;)switch(_context48.prev=_context48.next){case 0:case 1:case"end":return _context48.stop()}},_callee48,this)}));return function(_x69,_x70){return _ref59.apply(this,arguments)}}(),Pool.prototype.handleFilterAdd=function(){var _ref60=_asyncToGenerator(regeneratorRuntime.mark(function _callee49(peer,packet){return regeneratorRuntime.wrap(function(_context49){for(;;)switch(_context49.prev=_context49.next){case 0:case 1:case"end":return _context49.stop()}},_callee49,this)}));return function(_x71,_x72){return _ref60.apply(this,arguments)}}(),Pool.prototype.handleFilterClear=function(){var _ref61=_asyncToGenerator(regeneratorRuntime.mark(function _callee50(peer,packet){return regeneratorRuntime.wrap(function(_context50){for(;;)switch(_context50.prev=_context50.next){case 0:case 1:case"end":return _context50.stop()}},_callee50,this)}));return function(_x73,_x74){return _ref61.apply(this,arguments)}}(),Pool.prototype.handleMerkleBlock=function(){var _ref62=_asyncToGenerator(regeneratorRuntime.mark(function _callee51(peer,packet){var hash,unlock;return regeneratorRuntime.wrap(function(_context51){for(;;)switch(_context51.prev=_context51.next){case 0:return hash=packet.block.hash("hex"),_context51.next=3,this.locker.lock(hash);case 3:return unlock=_context51.sent,_context51.prev=4,_context51.next=7,this._handleMerkleBlock(peer,packet);case 7:return _context51.abrupt("return",_context51.sent);case 8:return _context51.prev=8,unlock(),_context51.finish(8);case 11:case"end":return _context51.stop()}},_callee51,this,[[4,,8,11]])}));return function(_x75,_x76){return _ref62.apply(this,arguments)}}(),Pool.prototype._handleMerkleBlock=function(){var _ref63=_asyncToGenerator(regeneratorRuntime.mark(function _callee52(peer,packet){var block,hash,tree,flags;return regeneratorRuntime.wrap(function(_context52){for(;;)switch(_context52.prev=_context52.next){case 0:if(this.syncing){_context52.next=2;break}return _context52.abrupt("return");case 2:if(this.options.spv){_context52.next=6;break}return this.logger.warning("Peer sent unsolicited merkleblock (%s).",peer.hostname()),peer.increaseBan(100),_context52.abrupt("return");case 6:if(block=packet.block,hash=block.hash("hex"),peer.blockMap.has(hash)){_context52.next=12;break}return this.logger.warning("Peer sent an unrequested merkleblock (%s).",peer.hostname()),peer.destroy(),_context52.abrupt("return");case 12:if(!peer.merkleBlock){_context52.next=16;break}return this.logger.warning("Peer sent a merkleblock prematurely (%s).",peer.hostname()),peer.increaseBan(100),_context52.abrupt("return");case 16:if(block.verify()){_context52.next=20;break}return this.logger.warning("Peer sent an invalid merkleblock (%s).",peer.hostname()),peer.increaseBan(100),_context52.abrupt("return");case 20:if(0!==(tree=block.getTree()).matches.length){_context52.next=26;break}return flags=chainCommon.flags.VERIFY_NONE,_context52.next=25,this._addBlock(peer,block,flags);case 25:return _context52.abrupt("return");case 26:peer.merkleBlock=block,peer.merkleTime=Date.now(),peer.merkleMatches=tree.matches.length,peer.merkleMap=new Set;case 30:case"end":return _context52.stop()}},_callee52,this)}));return function(_x77,_x78){return _ref63.apply(this,arguments)}}(),Pool.prototype.handleFeeFilter=function(){var _ref64=_asyncToGenerator(regeneratorRuntime.mark(function _callee53(peer,packet){return regeneratorRuntime.wrap(function(_context53){for(;;)switch(_context53.prev=_context53.next){case 0:case 1:case"end":return _context53.stop()}},_callee53,this)}));return function(_x79,_x80){return _ref64.apply(this,arguments)}}(),Pool.prototype.handleSendCmpct=function(){var _ref65=_asyncToGenerator(regeneratorRuntime.mark(function _callee54(peer,packet){return regeneratorRuntime.wrap(function(_context54){for(;;)switch(_context54.prev=_context54.next){case 0:case 1:case"end":return _context54.stop()}},_callee54,this)}));return function(_x81,_x82){return _ref65.apply(this,arguments)}}(),Pool.prototype.handleCmpctBlock=function(){var _ref66=_asyncToGenerator(regeneratorRuntime.mark(function _callee55(peer,packet){var block,hash,witness,result,flags;return regeneratorRuntime.wrap(function(_context55){for(;;)switch(_context55.prev=_context55.next){case 0:if(block=packet.block,hash=block.hash("hex"),witness=peer.compactWitness,this.syncing){_context55.next=5;break}return _context55.abrupt("return");case 5:if(this.options.compact){_context55.next=9;break}return this.logger.info("Peer sent unsolicited cmpctblock (%s).",peer.hostname()),this.destroy(),_context55.abrupt("return");case 9:if(peer.hasCompactSupport()&&peer.hasCompact()){_context55.next=13;break}return this.logger.info("Peer sent unsolicited cmpctblock (%s).",peer.hostname()),this.destroy(),_context55.abrupt("return");case 13:if(!peer.compactBlocks.has(hash)){_context55.next=16;break}return this.logger.debug("Peer sent us a duplicate compact block (%s).",peer.hostname()),_context55.abrupt("return");case 16:if(!this.compactBlocks.has(hash)){_context55.next=19;break}return this.logger.debug("Already waiting for compact block %s (%s).",hash,peer.hostname()),_context55.abrupt("return");case 19:if(peer.blockMap.has(hash)){_context55.next=27;break}if(1===this.options.blockMode){_context55.next=24;break}return this.logger.warning("Peer sent us an unrequested compact block (%s).",peer.hostname()),peer.destroy(),_context55.abrupt("return");case 24:peer.blockMap.set(hash,Date.now()),assert(!this.blockMap.has(hash)),this.blockMap.add(hash);case 27:if(this.mempool){_context55.next=30;break}return this.logger.warning("Requesting compact blocks without a mempool!"),_context55.abrupt("return");case 30:if(block.verify()){_context55.next=34;break}return this.logger.debug("Peer sent an invalid compact block (%s).",peer.hostname()),peer.increaseBan(100),_context55.abrupt("return");case 34:result=void 0,_context55.prev=35,result=block.init(),_context55.next=44;break;case 39:return _context55.prev=39,_context55.t0=_context55.catch(35),this.logger.debug("Peer sent an invalid compact block (%s).",peer.hostname()),peer.increaseBan(100),_context55.abrupt("return");case 44:if(result){_context55.next=49;break}return this.logger.warning("Siphash collision for %s. Requesting full block (%s).",block.rhash(),peer.hostname()),peer.getFullBlock(hash),peer.increaseBan(10),_context55.abrupt("return");case 49:if(!block.fillMempool(witness,this.mempool)){_context55.next=56;break}return this.logger.debug("Received full compact block %s (%s).",block.rhash(),peer.hostname()),flags=chainCommon.flags.VERIFY_BODY,_context55.next=55,this.addBlock(peer,block.toBlock(),flags);case 55:return _context55.abrupt("return");case 56:if(1!==this.options.blockMode){_context55.next=61;break}if(!(peer.compactBlocks.size>=15)){_context55.next=61;break}return this.logger.warning("Compact block DoS attempt (%s).",peer.hostname()),peer.destroy(),_context55.abrupt("return");case 61:block.now=Date.now(),assert(!peer.compactBlocks.has(hash)),peer.compactBlocks.set(hash,block),this.compactBlocks.add(hash),this.logger.debug("Received non-full compact block %s tx=%d/%d (%s).",block.rhash(),block.count,block.totalTX,peer.hostname()),peer.send(new packets.GetBlockTxnPacket(block.toRequest()));case 67:case"end":return _context55.stop()}},_callee55,this,[[35,39]])}));return function(_x83,_x84){return _ref66.apply(this,arguments)}}(),Pool.prototype.handleGetBlockTxn=function(){var _ref67=_asyncToGenerator(regeneratorRuntime.mark(function _callee56(peer,packet){var req,item,block,res;return regeneratorRuntime.wrap(function(_context56){for(;;)switch(_context56.prev=_context56.next){case 0:if(req=packet.request,!this.chain.options.spv){_context56.next=3;break}return _context56.abrupt("return");case 3:if(!this.chain.options.prune){_context56.next=5;break}return _context56.abrupt("return");case 5:if(!this.options.selfish){_context56.next=7;break}return _context56.abrupt("return");case 7:return item=new InvItem(invTypes.BLOCK,req.hash),_context56.next=10,this.getItem(peer,item);case 10:if(block=_context56.sent){_context56.next=15;break}return this.logger.debug("Peer sent getblocktxn for non-existent block (%s).",peer.hostname()),peer.increaseBan(100),_context56.abrupt("return");case 15:return _context56.next=17,this.chain.getHeight(req.hash);case 17:if(!(_context56.sent<this.chain.tip.height-15)){_context56.next=21;break}return this.logger.debug("Peer sent a getblocktxn for a block > 15 deep (%s)",peer.hostname()),_context56.abrupt("return");case 21:this.logger.debug("Sending blocktxn for %s to peer (%s).",block.rhash(),peer.hostname()),res=BIP152.TXResponse.fromBlock(block,req),peer.send(new packets.BlockTxnPacket(res,peer.compactWitness));case 24:case"end":return _context56.stop()}},_callee56,this)}));return function(_x85,_x86){return _ref67.apply(this,arguments)}}(),Pool.prototype.handleBlockTxn=function(){var _ref68=_asyncToGenerator(regeneratorRuntime.mark(function _callee57(peer,packet){var res,block,flags;return regeneratorRuntime.wrap(function(_context57){for(;;)switch(_context57.prev=_context57.next){case 0:if(res=packet.response,block=peer.compactBlocks.get(res.hash),flags=chainCommon.flags.VERIFY_BODY,block){_context57.next=6;break}return this.logger.debug("Peer sent unsolicited blocktxn (%s).",peer.hostname()),_context57.abrupt("return");case 6:if(peer.compactBlocks.delete(res.hash),assert(this.compactBlocks.has(res.hash)),this.compactBlocks.delete(res.hash),block.fillMissing(res)){_context57.next=14;break}return this.logger.warning("Peer sent non-full blocktxn for %s. Requesting full block (%s).",block.rhash(),peer.hostname()),peer.getFullBlock(res.hash),peer.increaseBan(10),_context57.abrupt("return");case 14:return this.logger.debug("Filled compact block %s (%s).",block.rhash(),peer.hostname()),_context57.next=17,this.addBlock(peer,block.toBlock(),flags);case 17:case"end":return _context57.stop()}},_callee57,this)}));return function(_x87,_x88){return _ref68.apply(this,arguments)}}(),Pool.prototype.handleEncinit=function(){var _ref69=_asyncToGenerator(regeneratorRuntime.mark(function _callee58(peer,packet){return regeneratorRuntime.wrap(function(_context58){for(;;)switch(_context58.prev=_context58.next){case 0:case 1:case"end":return _context58.stop()}},_callee58,this)}));return function(_x89,_x90){return _ref69.apply(this,arguments)}}(),Pool.prototype.handleEncack=function(){var _ref70=_asyncToGenerator(regeneratorRuntime.mark(function _callee59(peer,packet){return regeneratorRuntime.wrap(function(_context59){for(;;)switch(_context59.prev=_context59.next){case 0:case 1:case"end":return _context59.stop()}},_callee59,this)}));return function(_x91,_x92){return _ref70.apply(this,arguments)}}(),Pool.prototype.handleAuthChallenge=function(){var _ref71=_asyncToGenerator(regeneratorRuntime.mark(function _callee60(peer,packet){return regeneratorRuntime.wrap(function(_context60){for(;;)switch(_context60.prev=_context60.next){case 0:case 1:case"end":return _context60.stop()}},_callee60,this)}));return function(_x93,_x94){return _ref71.apply(this,arguments)}}(),Pool.prototype.handleAuthReply=function(){var _ref72=_asyncToGenerator(regeneratorRuntime.mark(function _callee61(peer,packet){return regeneratorRuntime.wrap(function(_context61){for(;;)switch(_context61.prev=_context61.next){case 0:case 1:case"end":return _context61.stop()}},_callee61,this)}));return function(_x95,_x96){return _ref72.apply(this,arguments)}}(),Pool.prototype.handleAuthPropose=function(){var _ref73=_asyncToGenerator(regeneratorRuntime.mark(function _callee62(peer,packet){return regeneratorRuntime.wrap(function(_context62){for(;;)switch(_context62.prev=_context62.next){case 0:case 1:case"end":return _context62.stop()}},_callee62,this)}));return function(_x97,_x98){return _ref73.apply(this,arguments)}}(),Pool.prototype.handleUnknown=function(){var _ref74=_asyncToGenerator(regeneratorRuntime.mark(function _callee63(peer,packet){return regeneratorRuntime.wrap(function(_context63){for(;;)switch(_context63.prev=_context63.next){case 0:this.logger.warning("Unknown packet: %s (%s).",packet.cmd,peer.hostname());case 1:case"end":return _context63.stop()}},_callee63,this)}));return function(_x99,_x100){return _ref74.apply(this,arguments)}}(),Pool.prototype.addInbound=function(socket){if(this.opened){var peer=this.createInbound(socket);this.logger.info("Added inbound peer (%s).",peer.hostname()),this.peers.add(peer)}else socket.destroy()},Pool.prototype.getHost=function(){var _iterator12=this.hosts.nodes,_isArray12=Array.isArray(_iterator12),_i12=0;for(_iterator12=_isArray12?_iterator12:_iterator12[Symbol.iterator]();;){var _ref75;if(_isArray12){if(_i12>=_iterator12.length)break;_ref75=_iterator12[_i12++]}else{if((_i12=_iterator12.next()).done)break;_ref75=_i12.value}var addr=_ref75;if(!this.peers.has(addr.hostname))return addr}for(var services=this.options.getRequiredServices(),now=this.network.now(),i=0;i<100;i++){var entry=this.hosts.getHost();if(!entry)break;var _addr=entry.addr;if(!this.peers.has(_addr.hostname)&&(_addr.isValid()&&_addr.hasServices(services)&&(this.options.onion||!_addr.isOnion())&&!(i<30&&now-entry.lastAttempt<600||i<50&&_addr.port!==this.network.port||i<95&&this.hosts.isBanned(_addr.host))))return entry.addr}return null},Pool.prototype.addOutbound=function(){if(this.opened&&!(this.peers.outbound>=this.options.maxOutbound)&&this.peers.load){var addr=this.getHost();if(addr){var peer=this.createOutbound(addr);this.peers.add(peer),this.emit("peer",peer)}}},Pool.prototype.fillOutbound=function(){var need=this.options.maxOutbound-this.peers.outbound;if(this.peers.load||this.addLoader(),!(need<=0)){this.logger.debug("Refilling peers (%d/%d).",this.peers.outbound,this.options.maxOutbound);for(var i=0;i<need;i++)this.addOutbound()}},Pool.prototype.refill=function(){var _this5=this;null==this.pendingRefill&&(this.pendingRefill=setTimeout(function(){_this5.pendingRefill=null,_this5.fillOutbound()},3e3))},Pool.prototype.removePeer=function(peer){this.peers.remove(peer);var _iterator13=peer.blockMap.keys(),_isArray13=Array.isArray(_iterator13),_i13=0;for(_iterator13=_isArray13?_iterator13:_iterator13[Symbol.iterator]();;){var _ref76;if(_isArray13){if(_i13>=_iterator13.length)break;_ref76=_iterator13[_i13++]}else{if((_i13=_iterator13.next()).done)break;_ref76=_i13.value}var hash=_ref76;this.resolveBlock(peer,hash)}var _iterator14=peer.txMap.keys(),_isArray14=Array.isArray(_iterator14),_i14=0;for(_iterator14=_isArray14?_iterator14:_iterator14[Symbol.iterator]();;){var _ref77;if(_isArray14){if(_i14>=_iterator14.length)break;_ref77=_iterator14[_i14++]}else{if((_i14=_iterator14.next()).done)break;_ref77=_i14.value}var _hash2=_ref77;this.resolveTX(peer,_hash2)}var _iterator15=peer.compactBlocks.keys(),_isArray15=Array.isArray(_iterator15),_i15=0;for(_iterator15=_isArray15?_iterator15:_iterator15[Symbol.iterator]();;){var _ref78;if(_isArray15){if(_i15>=_iterator15.length)break;_ref78=_iterator15[_i15++]}else{if((_i15=_iterator15.next()).done)break;_ref78=_i15.value}var _hash3=_ref78;assert(this.compactBlocks.has(_hash3)),this.compactBlocks.delete(_hash3)}peer.compactBlocks.clear()},Pool.prototype.ban=function(addr){var peer=this.peers.get(addr.hostname);this.logger.debug("Banning peer (%s).",addr.hostname),this.hosts.ban(addr.host),this.hosts.remove(addr.hostname),peer&&peer.destroy()},Pool.prototype.unban=function(addr){this.hosts.unban(addr.host)},Pool.prototype.setFilter=function(filter){this.options.spv&&(this.spvFilter=filter,this.queueFilterLoad())},Pool.prototype.watch=function(data,enc){this.options.spv&&(this.spvFilter.add(data,enc),this.queueFilterLoad())},Pool.prototype.unwatch=function(){this.options.spv&&(this.spvFilter.reset(),this.queueFilterLoad())},Pool.prototype.queueFilterLoad=function(){var _this6=this;this.options.spv&&null==this.pendingFilter&&(this.pendingFilter=setTimeout(function(){_this6.pendingFilter=null,_this6.sendFilterLoad()},100))},Pool.prototype.sendFilterLoad=function(){if(this.options.spv){assert(this.spvFilter);for(var peer=this.peers.head();peer;peer=peer.next)peer.sendFilterLoad(this.spvFilter)}},Pool.prototype.watchAddress=function(address){var hash=Address.getHash(address);this.watch(hash)},Pool.prototype.watchOutpoint=function(outpoint){this.watch(outpoint.toRaw())},Pool.prototype.resolveOrphan=function(){var _ref79=_asyncToGenerator(regeneratorRuntime.mark(function _callee64(peer,orphan){var locator,root;return regeneratorRuntime.wrap(function(_context64){for(;;)switch(_context64.prev=_context64.next){case 0:return _context64.next=2,this.chain.getLocator();case 2:locator=_context64.sent,root=this.chain.getOrphanRoot(orphan),assert(root),peer.sendGetBlocks(locator,root);case 6:case"end":return _context64.stop()}},_callee64,this)}));return function(_x101,_x102){return _ref79.apply(this,arguments)}}(),Pool.prototype.getHeaders=function(){var _ref80=_asyncToGenerator(regeneratorRuntime.mark(function _callee65(peer,tip,stop){var locator;return regeneratorRuntime.wrap(function(_context65){for(;;)switch(_context65.prev=_context65.next){case 0:return _context65.next=2,this.chain.getLocator(tip);case 2:locator=_context65.sent,peer.sendGetHeaders(locator,stop);case 4:case"end":return _context65.stop()}},_callee65,this)}));return function(_x103,_x104,_x105){return _ref80.apply(this,arguments)}}(),Pool.prototype.getBlocks=function(){var _ref81=_asyncToGenerator(regeneratorRuntime.mark(function _callee66(peer,tip,stop){var locator;return regeneratorRuntime.wrap(function(_context66){for(;;)switch(_context66.prev=_context66.next){case 0:return _context66.next=2,this.chain.getLocator(tip);case 2:locator=_context66.sent,peer.sendGetBlocks(locator,stop);case 4:case"end":return _context66.stop()}},_callee66,this)}));return function(_x106,_x107,_x108){return _ref81.apply(this,arguments)}}(),Pool.prototype.getBlock=function(peer,hashes){if(this.opened){if(!peer.handshake)throw new Error("Peer handshake not complete (getdata).");if(peer.destroyed)throw new Error("Peer is destroyed (getdata).");var now=Date.now(),items=[],_iterator16=hashes,_isArray16=Array.isArray(_iterator16),_i16=0;for(_iterator16=_isArray16?_iterator16:_iterator16[Symbol.iterator]();;){var _ref82;if(_isArray16){if(_i16>=_iterator16.length)break;_ref82=_iterator16[_i16++]}else{if((_i16=_iterator16.next()).done)break;_ref82=_i16.value}var hash=_ref82;this.blockMap.has(hash)||(this.blockMap.add(hash),peer.blockMap.set(hash,now),this.chain.synced&&(now+=100),items.push(hash))}0!==items.length&&(this.logger.debug("Requesting %d/%d blocks from peer with getdata (%s).",items.length,this.blockMap.size,peer.hostname()),peer.getBlock(items))}},Pool.prototype.getTX=function(peer,hashes){if(this.opened){if(!peer.handshake)throw new Error("Peer handshake not complete (getdata).");if(peer.destroyed)throw new Error("Peer is destroyed (getdata).");var now=Date.now(),items=[],_iterator17=hashes,_isArray17=Array.isArray(_iterator17),_i17=0;for(_iterator17=_isArray17?_iterator17:_iterator17[Symbol.iterator]();;){var _ref83;if(_isArray17){if(_i17>=_iterator17.length)break;_ref83=_iterator17[_i17++]}else{if((_i17=_iterator17.next()).done)break;_ref83=_i17.value}var hash=_ref83;this.txMap.has(hash)||(this.txMap.add(hash),peer.txMap.set(hash,now),now+=50,items.push(hash))}0!==items.length&&(this.logger.debug("Requesting %d/%d txs from peer with getdata (%s).",items.length,this.txMap.size,peer.hostname()),peer.getTX(items))}},Pool.prototype.hasBlock=function(){var _ref84=_asyncToGenerator(regeneratorRuntime.mark(function _callee67(hash){return regeneratorRuntime.wrap(function(_context67){for(;;)switch(_context67.prev=_context67.next){case 0:if(!this.locker.has(hash)){_context67.next=2;break}return _context67.abrupt("return",!0);case 2:return _context67.next=4,this.chain.has(hash);case 4:if(!_context67.sent){_context67.next=6;break}return _context67.abrupt("return",!0);case 6:return _context67.abrupt("return",!1);case 7:case"end":return _context67.stop()}},_callee67,this)}));return function(_x109){return _ref84.apply(this,arguments)}}(),Pool.prototype.hasTX=function(hash){if(this.locker.has(hash))return!0;if(this.mempool){if(this.mempool.has(hash))return!0;if(this.mempool.hasReject(hash))return this.logger.spam("Saw known reject of %s.",util.revHex(hash)),!0}else if(!this.txFilter.added(hash,"hex"))return!0;return!1},Pool.prototype.ensureTX=function(peer,hashes){var items=[],_iterator18=hashes,_isArray18=Array.isArray(_iterator18),_i18=0;for(_iterator18=_isArray18?_iterator18:_iterator18[Symbol.iterator]();;){var _ref85;if(_isArray18){if(_i18>=_iterator18.length)break;_ref85=_iterator18[_i18++]}else{if((_i18=_iterator18.next()).done)break;_ref85=_i18.value}var hash=_ref85;this.hasTX(hash)||items.push(hash)}this.getTX(peer,items)},Pool.prototype.resolveTX=function(peer,hash){return!!peer.txMap.has(hash)&&(peer.txMap.delete(hash),assert(this.txMap.has(hash)),this.txMap.delete(hash),!0)},Pool.prototype.resolveBlock=function(peer,hash){return!!peer.blockMap.has(hash)&&(peer.blockMap.delete(hash),assert(this.blockMap.has(hash)),this.blockMap.delete(hash),!0)},Pool.prototype.resolveItem=function(peer,item){return item.isBlock()?this.resolveBlock(peer,item.hash):!!item.isTX()&&this.resolveTX(peer,item.hash)},Pool.prototype.broadcast=function(msg){var hash=msg.hash("hex"),item=this.invMap.get(hash);return item?(item.refresh(),item.announce()):((item=new BroadcastItem(this,msg)).start(),item.announce()),new Promise(function(resolve,reject){item.addJob(resolve,reject)})},Pool.prototype.announceBlock=function(msg){for(var peer=this.peers.head();peer;peer=peer.next)peer.announceBlock(msg)},Pool.prototype.announceTX=function(msg){for(var peer=this.peers.head();peer;peer=peer.next)peer.announceTX(msg)},Pool}(EventEmitter);Pool.DISCOVERY_INTERVAL=12e4;var PoolOptions=function(){function PoolOptions(options){_classCallCheck(this,PoolOptions),this.network=Network.primary,this.logger=null,this.chain=null,this.mempool=null,this.nonces=new NonceList,this.prefix=null,this.checkpoints=!0,this.spv=!1,this.bip37=!1,this.listen=!1,this.compact=!0,this.noRelay=!1,this.host="0.0.0.0",this.port=this.network.port,this.publicHost="0.0.0.0",this.publicPort=this.network.port,this.maxOutbound=8,this.maxInbound=8,this.createSocket=this._createSocket.bind(this),this.createServer=tcp.createServer,this.resolve=this._resolve.bind(this),this.proxy=null,this.onion=!1,this.upnp=!1,this.selfish=!1,this.version=common.PROTOCOL_VERSION,this.agent=common.USER_AGENT,this.bip151=!1,this.bip150=!1,this.authPeers=[],this.knownPeers={},this.identityKey=secp256k1.generatePrivateKey(),this.banScore=common.BAN_SCORE,this.banTime=common.BAN_TIME,this.feeRate=-1,this.seeds=this.network.seeds,this.nodes=[],this.invTimeout=6e4,this.blockMode=0,this.services=common.LOCAL_SERVICES,this.requiredServices=common.REQUIRED_SERVICES,this.memory=!0,this.fromOptions(options)}return PoolOptions.prototype.fromOptions=function(options){if(assert(options,"Pool requires options."),assert(options.chain&&"object"===_typeof(options.chain),"Pool options require a blockchain."),this.chain=options.chain,this.network=options.chain.network,this.logger=options.chain.logger,this.port=this.network.port,this.seeds=this.network.seeds,this.port=this.network.port,this.publicPort=this.network.port,null!=options.logger&&(assert("object"===_typeof(options.logger)),this.logger=options.logger),null!=options.mempool&&(assert("object"===_typeof(options.mempool)),this.mempool=options.mempool),null!=options.prefix&&(assert("string"==typeof options.prefix),this.prefix=options.prefix),null!=options.checkpoints?(assert("boolean"==typeof options.checkpoints),assert(options.checkpoints===this.chain.options.checkpoints),this.checkpoints=options.checkpoints):this.checkpoints=this.chain.options.checkpoints,null!=options.spv?(assert("boolean"==typeof options.spv),assert(options.spv===this.chain.options.spv),this.spv=options.spv):this.spv=this.chain.options.spv,null!=options.bip37&&(assert("boolean"==typeof options.bip37),this.bip37=options.bip37),null!=options.listen&&(assert("boolean"==typeof options.listen),this.listen=options.listen),null!=options.compact&&(assert("boolean"==typeof options.compact),this.compact=options.compact),null!=options.noRelay&&(assert("boolean"==typeof options.noRelay),this.noRelay=options.noRelay),null!=options.host){assert("string"==typeof options.host);var raw=IP.toBuffer(options.host);this.host=IP.toString(raw),IP.isRoutable(raw)&&(this.publicHost=this.host)}return null!=options.port&&(assert((65535&options.port)===options.port),this.port=options.port,this.publicPort=options.port),null!=options.publicHost&&(assert("string"==typeof options.publicHost),this.publicHost=IP.normalize(options.publicHost)),null!=options.publicPort&&(assert((255&options.publicPort)===options.publicPort),this.publicPort=options.publicPort),null!=options.maxOutbound&&(assert("number"==typeof options.maxOutbound),assert(options.maxOutbound>0),this.maxOutbound=options.maxOutbound),null!=options.maxInbound&&(assert("number"==typeof options.maxInbound),this.maxInbound=options.maxInbound),options.createSocket&&(assert("function"==typeof options.createSocket),this.createSocket=options.createSocket),options.createServer&&(assert("function"==typeof options.createServer),this.createServer=options.createServer),options.resolve&&(assert("function"==typeof options.resolve),this.resolve=options.resolve),options.proxy&&(assert("string"==typeof options.proxy),this.proxy=options.proxy),null!=options.onion&&(assert("boolean"==typeof options.onion),this.onion=options.onion),null!=options.upnp&&(assert("boolean"==typeof options.upnp),this.upnp=options.upnp),options.selfish&&(assert("boolean"==typeof options.selfish),this.selfish=options.selfish),options.version&&(assert("number"==typeof options.version),this.version=options.version),options.agent&&(assert("string"==typeof options.agent),assert(options.agent.length<=255),this.agent=options.agent),null!=options.bip151&&(assert("boolean"==typeof options.bip151),this.bip151=options.bip151),null!=options.bip150&&(assert("boolean"==typeof options.bip150),assert(!options.bip150||this.bip151,"Cannot enable bip150 without bip151."),options.knownPeers&&(assert("object"===_typeof(options.knownPeers)),assert(!Array.isArray(options.knownPeers)),this.knownPeers=options.knownPeers),options.authPeers&&(assert(Array.isArray(options.authPeers)),this.authPeers=options.authPeers),options.identityKey&&(assert(Buffer.isBuffer(options.identityKey),"Identity key must be a buffer."),assert(secp256k1.privateKeyVerify(options.identityKey),"Invalid identity key."),this.identityKey=options.identityKey)),null!=options.banScore&&(assert("number"==typeof this.options.banScore),this.banScore=this.options.banScore),null!=options.banTime&&(assert("number"==typeof this.options.banTime),this.banTime=this.options.banTime),null!=options.feeRate&&(assert("number"==typeof this.options.feeRate),this.feeRate=this.options.feeRate),options.seeds&&(assert(Array.isArray(options.seeds)),this.seeds=options.seeds),options.nodes&&(assert(Array.isArray(options.nodes)),this.nodes=options.nodes),null!=options.only&&(assert(Array.isArray(options.only)),options.only.length>0&&(this.nodes=options.only,this.maxOutbound=options.only.length)),null!=options.invTimeout&&(assert("number"==typeof options.invTimeout),this.invTimeout=options.invTimeout),null!=options.blockMode&&(assert("number"==typeof options.blockMode),this.blockMode=options.blockMode),null!=options.memory&&(assert("boolean"==typeof options.memory),this.memory=options.memory),this.spv&&(this.requiredServices|=common.services.BLOOM,this.services&=~common.services.NETWORK,this.noRelay=!0,this.checkpoints=!0,this.compact=!1,this.bip37=!1,this.listen=!1),this.selfish&&(this.services&=~common.services.NETWORK,this.bip37=!1),this.bip37&&(this.services|=common.services.BLOOM),this.proxy&&(this.listen=!1),null!=options.services&&(assert(options.services>>>0===options.services),this.services=options.services),null!=options.requiredServices&&(assert(options.requiredServices>>>0===options.requiredServices),this.requiredServices=options.requiredServices),this},PoolOptions.fromOptions=function(options){return(new PoolOptions).fromOptions(options)},PoolOptions.prototype.getHeight=function(){return this.chain.height},PoolOptions.prototype.isFull=function(){return this.chain.synced},PoolOptions.prototype.getRequiredServices=function(){return this.requiredServices},PoolOptions.prototype.createNonce=function(hostname){return this.nonces.alloc(hostname)},PoolOptions.prototype.hasNonce=function(nonce){return this.nonces.has(nonce)},PoolOptions.prototype.getRate=function(hash){if(!this.mempool)return-1;var entry=this.mempool.getEntry(hash);return entry?entry.getRate():-1},PoolOptions.prototype._createSocket=function(port,host){return this.proxy?socks.connect(this.proxy,port,host):tcp.createSocket(port,host)},PoolOptions.prototype._resolve=function(name){return this.onion?socks.resolve(this.proxy,name):dns.lookup(name)},PoolOptions}(),PeerList=function(){function PeerList(){_classCallCheck(this,PeerList),this.map=new Map,this.ids=new Map,this.list=new List,this.load=null,this.inbound=0,this.outbound=0}return PeerList.prototype.head=function(){return this.list.head},PeerList.prototype.tail=function(){return this.list.tail},PeerList.prototype.size=function(){return this.list.size},PeerList.prototype.add=function(peer){assert(this.list.push(peer)),assert(!this.map.has(peer.hostname())),this.map.set(peer.hostname(),peer),assert(!this.ids.has(peer.id)),this.ids.set(peer.id,peer),peer.outbound?this.outbound+=1:this.inbound+=1},PeerList.prototype.remove=function(peer){assert(this.list.remove(peer)),assert(this.ids.has(peer.id)),this.ids.delete(peer.id),assert(this.map.has(peer.hostname())),this.map.delete(peer.hostname()),peer===this.load&&(assert(peer.loader),peer.loader=!1,this.load=null),peer.outbound?this.outbound-=1:this.inbound-=1},PeerList.prototype.get=function(hostname){return this.map.get(hostname)},PeerList.prototype.has=function(hostname){return this.map.has(hostname)},PeerList.prototype.find=function(id){return this.ids.get(id)},PeerList.prototype.destroy=function(){for(var next=void 0,peer=this.list.head;peer;peer=next)next=peer.next,peer.destroy()},PeerList}(),BroadcastItem=function(_EventEmitter2){_inherits(BroadcastItem,_EventEmitter2);function BroadcastItem(pool,msg){_classCallCheck(this,BroadcastItem);var _this7=_possibleConstructorReturn(this,_EventEmitter2.call(this));assert(!msg.mutable,"Cannot broadcast mutable item.");var item=msg.toInv();return _this7.pool=pool,_this7.hash=item.hash,_this7.type=item.type,_this7.msg=msg,_this7.jobs=[],_this7}return BroadcastItem.prototype.addJob=function(resolve,reject){this.jobs.push({resolve:resolve,reject:reject})},BroadcastItem.prototype.start=function(){return assert(!this.timeout,"Already started."),assert(!this.pool.invMap.has(this.hash),"Already started."),this.pool.invMap.set(this.hash,this),this.refresh(),this},BroadcastItem.prototype.refresh=function(){var _this8=this;null!=this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.timeout=setTimeout(function(){_this8.emit("timeout"),_this8.reject(new Error("Timed out."))},this.pool.options.invTimeout)},BroadcastItem.prototype.announce=function(){switch(this.type){case invTypes.TX:this.pool.announceTX(this.msg);break;case invTypes.BLOCK:this.pool.announceBlock(this.msg);break;default:assert(!1,"Bad type.")}},BroadcastItem.prototype.cleanup=function(){assert(null!=this.timeout,"Already finished."),assert(this.pool.invMap.has(this.hash),"Already finished."),clearTimeout(this.timeout),this.timeout=null,this.pool.invMap.delete(this.hash)},BroadcastItem.prototype.reject=function(err){this.cleanup();var _iterator19=this.jobs,_isArray19=Array.isArray(_iterator19),_i19=0;for(_iterator19=_isArray19?_iterator19:_iterator19[Symbol.iterator]();;){var _ref86;if(_isArray19){if(_i19>=_iterator19.length)break;_ref86=_iterator19[_i19++]}else{if((_i19=_iterator19.next()).done)break;_ref86=_i19.value}_ref86.reject(err)}this.jobs.length=0},BroadcastItem.prototype.resolve=function(){this.cleanup();var _iterator20=this.jobs,_isArray20=Array.isArray(_iterator20),_i20=0;for(_iterator20=_isArray20?_iterator20:_iterator20[Symbol.iterator]();;){var _ref87;if(_isArray20){if(_i20>=_iterator20.length)break;_ref87=_iterator20[_i20++]}else{if((_i20=_iterator20.next()).done)break;_ref87=_i20.value}_ref87.resolve(!1)}this.jobs.length=0},BroadcastItem.prototype.handleAck=function(peer){var _this9=this;setTimeout(function(){_this9.emit("ack",peer);var _iterator21=_this9.jobs,_isArray21=Array.isArray(_iterator21),_i21=0;for(_iterator21=_isArray21?_iterator21:_iterator21[Symbol.iterator]();;){var _ref88;if(_isArray21){if(_i21>=_iterator21.length)break;_ref88=_iterator21[_i21++]}else{if((_i21=_iterator21.next()).done)break;_ref88=_i21.value}_ref88.resolve(!0)}_this9.jobs.length=0},1e3)},BroadcastItem.prototype.handleReject=function(peer){this.emit("reject",peer);var _iterator22=this.jobs,_isArray22=Array.isArray(_iterator22),_i22=0;for(_iterator22=_isArray22?_iterator22:_iterator22[Symbol.iterator]();;){var _ref89;if(_isArray22){if(_i22>=_iterator22.length)break;_ref89=_iterator22[_i22++]}else{if((_i22=_iterator22.next()).done)break;_ref89=_i22.value}_ref89.resolve(!1)}this.jobs.length=0},BroadcastItem.prototype.inspect=function(){return"<BroadcastItem: type="+(this.type===invTypes.TX?"tx":"block")+" hash="+util.revHex(this.hash)+">"},BroadcastItem}(EventEmitter),NonceList=function(){function NonceList(){_classCallCheck(this,NonceList),this.map=new Map,this.hosts=new Map}return NonceList.prototype.alloc=function(hostname){for(;;){var nonce=common.nonce(),key=nonce.toString("hex");if(!this.map.has(key))return this.map.set(key,hostname),assert(!this.hosts.has(hostname)),this.hosts.set(hostname,key),nonce}},NonceList.prototype.has=function(nonce){var key=nonce.toString("hex");return this.map.has(key)},NonceList.prototype.remove=function(hostname){var key=this.hosts.get(hostname);return!!key&&(this.hosts.delete(hostname),assert(this.map.has(key)),this.map.delete(key),!0)},NonceList}(),HeaderEntry=function HeaderEntry(hash,height){_classCallCheck(this,HeaderEntry),this.hash=hash,this.height=height,this.prev=null,this.next=null};module.exports=Pool}).call(this,{isBuffer:require("../../node_modules/is-buffer/index.js")})},{"../../node_modules/is-buffer/index.js":353,"../blockchain/common":5,"../primitives/address":69,"../primitives/invitem":75,"../protocol/network":87,"../utils/list":104,"../utils/util":106,"./bip150":46,"./bip151":47,"./bip152":48,"./common":49,"./hostlist":51,"./packets":54,"./peer":56,assert:146,"bcrypto/lib/secp256k1":184,bdns:197,bfilter:203,binet:208,bmutex:214,bsocks:261,btcp:266,bupnp:278,events:334}],58:[function(require,module,exports){"use strict";var main=require("./main"),testnet=require("./testnet");exports.get=function(type){switch(type){case"main":return main;case"testnet":return testnet;default:return[]}}},{"./main":59,"./testnet":60}],59:[function(require,module,exports){"use strict";module.exports=["1.32.200.120:8333","2.33.22.161:8333","5.9.19.109:8333","5.9.28.10:8333","5.9.144.83:8333","5.9.220.132:8333","5.44.97.110:8333","5.56.40.1:8333","5.56.50.113:8333","5.56.247.69:8333","5.61.33.220:8333","5.61.40.56:8333","5.79.79.150:8333","5.103.137.146:8333","5.135.157.17:8333","5.189.144.250:8333","5.189.153.133:8333","5.189.164.147:8333","5.189.172.200:8333","5.189.191.123:8335","5.230.145.130:8333","5.249.58.76:8333","8.38.88.126:8333","12.23.127.175:8333","13.54.95.147:8333","13.54.224.84:8333","13.55.131.240:8333","13.55.200.177:8333","13.56.168.64:8333","13.68.218.246:8333","13.73.0.61:8333","13.78.112.11:8333","13.82.92.201:8333","13.92.82.235:8333","13.94.41.82:8333","13.114.127.189:8333","13.114.238.184:8333","13.114.245.160:8333","13.124.110.101:8333","13.125.23.164:8333","13.125.59.135:8333","13.126.10.3:8333","13.126.31.141:8333","13.126.32.103:8333","13.126.40.50:8333","13.126.93.130:8333","13.126.139.182:8333","13.126.155.63:8333","13.126.209.117:8333","13.126.226.221:8333","13.126.236.41:8333","13.126.239.87:8333","13.126.239.219:8333","13.210.30.22:8333","13.210.176.124:8333","13.228.109.153:8333","13.229.57.25:8333","13.229.57.213:8333","13.229.59.240:8333","13.229.62.191:8333","13.229.63.50:8333","13.229.113.143:8333","13.229.122.196:8333","14.3.38.179:8333","14.34.174.181:8333","14.63.7.60:8333","14.161.3.136:8333","18.102.222.125:8335","18.102.222.126:8335","18.102.222.235:8335","18.196.0.242:8333","23.91.239.76:8333","23.97.76.96:8333","23.99.204.71:8333","23.126.126.123:8333","23.242.137.237:8333","24.4.223.7:8333","24.6.35.84:8333","24.6.187.79:8333","24.16.75.128:8333","24.28.31.45:8333","24.44.4.93:8333","24.48.13.87:8333","24.65.56.137:8333","24.71.34.198:8333","24.71.40.46:8333","24.76.122.108:8090","24.91.84.241:8333","24.113.193.24:8333","24.120.175.243:8333","24.176.13.10:8333","24.190.50.113:8333","24.190.115.124:8333","24.190.122.213:8333","24.192.54.128:8333","24.196.177.159:8333","24.205.143.178:8333","24.209.116.134:8333","24.212.140.163:28333","24.225.122.236:8333","24.253.149.143:8333","27.32.73.128:8333","27.252.194.136:8333","31.178.177.195:8343","31.208.183.35:8333","31.209.59.179:21824","34.200.224.182:8333","34.207.91.14:8333","34.211.105.73:8333","34.214.80.51:8333","34.215.127.223:8333","34.216.50.2:8333","34.225.107.142:8333","34.227.47.255:8333","34.228.244.49:8333","34.229.205.221:8333","34.248.37.32:8333","34.248.160.67:8333","34.250.57.214:8333","34.250.228.148:8333","34.251.49.99:8333","34.251.249.159:8333","34.253.41.152:8333","34.253.137.125:8333","35.154.101.254:8333","35.154.149.128:8333","35.154.153.188:8333","35.154.250.114:8333","35.156.118.148:8333","35.156.132.185:8333","35.156.225.190:8333","35.157.227.145:8333","35.157.244.225:8333","35.158.82.156:8333","35.158.190.238:8333","35.158.192.60:8333","35.158.208.170:8333","35.158.226.142:8333","35.158.240.174:8333","35.158.246.27:8333","35.162.132.96:8333","35.166.244.10:8333","35.177.147.255:8333","35.182.102.44:8333","35.192.12.181:8333","35.197.25.235:8333","35.197.69.121:8333","35.198.72.0:8333","35.198.150.233:8333","35.198.170.139:8333","35.201.143.56:8333","35.225.114.138:8333","35.226.195.176:8333","37.46.246.28:8333","37.59.40.198:8333","37.61.238.54:8333","37.61.238.132:8333","37.110.59.230:8333","37.120.164.16:18333","37.143.243.63:8333","37.187.105.65:8333","37.187.141.73:8333","37.221.198.57:28333","37.247.22.53:8533","39.106.250.150:8363","39.108.13.102:8333","39.108.14.166:8333","39.108.71.254:8333","39.108.100.122:8333","39.108.107.120:8333","39.108.195.54:8333","39.108.195.109:8333","39.108.246.163:8333","39.108.246.170:8333","39.108.246.172:8333","39.108.246.176:8333","39.108.246.184:8333","39.108.246.189:8333","39.108.246.198:8333","39.108.246.218:8333","39.108.246.220:8333","39.108.246.223:8333","39.108.246.226:8333","39.108.246.238:8333","40.126.253.180:8333","41.50.96.101:8333","42.119.42.92:8333","42.119.43.46:8333","45.20.152.137:8333","45.32.6.173:8333","45.32.46.198:8333","45.32.65.35:8333","45.32.233.225:8333","45.33.14.27:8333","45.33.20.49:8333","45.33.48.42:8333","45.33.122.254:8333","45.48.165.76:8333","45.58.55.186:8333","45.63.51.10:8333","45.77.219.50:8333","45.78.128.5:8334","45.79.67.230:8333","45.79.78.233:8333","45.79.89.253:8333","45.79.99.220:8333","45.79.162.143:8333","45.79.206.173:8333","45.118.133.242:8333","45.123.103.115:8333","46.4.85.241:9090","46.9.124.146:8333","46.28.204.61:17302","46.59.45.0:8333","46.61.17.81:8333","46.101.240.184:8333","46.101.254.215:8333","46.103.248.45:8333","46.105.98.179:8333","46.109.101.198:8333","46.162.1.93:8333","46.165.221.209:9333","46.216.40.174:8333","46.216.48.123:8333","46.233.43.155:8333","46.246.38.111:8333","47.52.4.116:8333","47.52.9.80:8333","47.52.9.93:8333","47.52.9.105:8333","47.52.9.185:8333","47.52.9.198:8333","47.52.9.219:8333","47.52.9.242:8333","47.52.9.249:8333","47.52.10.0:8333","47.52.10.12:8333","47.52.10.20:8333","47.52.10.26:8333","47.52.10.27:8333","47.52.10.47:8333","47.52.10.50:8333","47.52.10.54:8333","47.52.10.59:8333","47.52.10.61:8333","47.52.10.67:8333","47.52.10.70:8333","47.52.10.92:8333","47.52.10.94:8333","47.52.10.97:8333","47.52.10.105:8333","47.52.10.239:8333","47.52.10.244:8333","47.52.37.42:8333","47.52.38.97:8333","47.52.103.117:8333","47.52.106.253:8333","47.74.22.103:8333","47.88.32.76:8333","47.88.32.206:8333","47.88.32.235:8333","47.88.33.0:8333","47.88.33.51:8333","47.88.33.60:8333","47.88.33.169:8333","47.88.33.205:8333","47.88.33.215:8333","47.88.33.248:8333","47.88.34.21:8333","47.88.34.26:8333","47.88.34.121:8333","47.88.34.131:8333","47.88.34.142:8333","47.88.34.175:8333","47.88.34.190:8333","47.88.34.248:8333","47.88.35.54:8333","47.88.57.99:8333","47.88.62.100:8333","47.88.76.134:8333","47.88.76.190:8333","47.88.76.211:8333","47.88.77.13:8333","47.88.77.42:8333","47.88.77.178:8333","47.88.77.244:8333","47.88.78.14:8333","47.88.78.116:8333","47.88.78.120:8333","47.88.78.187:8333","47.88.78.228:8333","47.88.78.241:8333","47.88.79.42:8333","47.88.79.48:8333","47.88.79.64:8333","47.88.79.88:8333","47.88.79.94:8333","47.88.188.5:8333","47.88.188.6:8333","47.88.188.15:8333","47.88.188.64:8333","47.88.188.97:8333","47.88.188.137:8333","47.88.188.143:8333","47.88.188.173:8333","47.88.188.187:8333","47.88.188.201:8333","47.88.188.231:8333","47.88.188.246:8333","47.88.189.2:8333","47.88.189.55:8333","47.88.189.65:8333","47.88.189.134:8333","47.88.189.180:8333","47.88.189.201:8333","47.88.190.10:8333","47.88.190.90:8333","47.88.190.113:8333","47.88.190.225:8333","47.88.191.31:8333","47.88.191.106:8333","47.88.191.142:8333","47.88.191.176:8333","47.88.191.209:8333","47.88.192.122:8333","47.88.192.179:8333","47.88.192.201:8333","47.88.192.223:8333","47.88.192.237:8333","47.88.193.22:8333","47.88.193.93:8333","47.88.195.130:8333","47.89.46.209:8333","47.89.177.134:8333","47.89.177.186:8333","47.89.180.162:8333","47.90.102.70:8333","47.90.204.241:8333","47.90.208.254:8333","47.90.241.184:8333","47.91.95.148:8333","47.91.198.174:8333","47.91.232.4:8333","47.93.90.194:8333","47.93.114.32:8333","47.93.114.229:8333","47.93.115.130:8333","47.93.116.138:8333","47.93.116.204:8333","47.93.120.133:8333","47.93.122.227:8333","47.93.123.193:8333","47.93.123.228:8333","47.93.124.115:8333","47.93.125.24:8333","47.93.125.109:8333","47.93.125.140:8333","47.93.137.197:8333","47.93.138.128:8333","47.93.138.140:8333","47.93.138.144:8333","47.93.138.163:8333","47.93.138.194:8333","47.93.138.195:8333","47.93.138.197:8333","47.93.138.213:8333","47.93.139.67:8335","47.93.139.85:8333","47.93.173.83:8333","47.94.36.120:8333","47.94.36.250:8333","47.94.37.57:8333","47.94.37.87:8333","47.94.37.100:8333","47.94.37.105:8333","47.94.37.111:8333","47.94.37.134:8333","47.94.37.137:8333","47.94.37.139:8333","47.94.37.147:8333","47.94.37.150:8333","47.94.37.151:8333","47.94.37.152:8333","47.94.37.254:8335","47.94.38.5:8333","47.94.38.88:8333","47.94.39.87:8333","47.94.40.104:8333","47.94.40.178:8333","47.94.41.42:8333","47.94.41.58:8333","47.94.43.22:8333","47.94.43.138:8333","47.94.43.193:8333","47.94.43.217:8333","47.94.44.224:8333","47.94.45.184:8333","47.94.46.31:8333","47.94.46.219:8333","47.94.46.224:8333","47.94.47.95:8333","47.94.47.121:8333","47.94.47.152:8333","47.94.47.169:8333","47.94.47.202:8333","47.94.47.216:8333","47.94.56.232:8333","47.94.57.27:8333","47.94.57.68:8333","47.94.57.92:8333","47.94.57.95:8333","47.94.57.96:8333","47.94.57.114:8333","47.94.57.121:8333","47.94.57.128:8333","47.94.57.139:8333","47.94.57.140:8333","47.94.57.145:8333","47.94.57.146:8333","47.94.57.149:8333","47.94.57.151:8333","47.94.57.152:8333","47.94.57.155:8333","47.94.57.156:8333","47.94.57.161:8333","47.94.58.146:8335","47.94.58.194:8335","47.94.133.252:8333","47.95.32.11:8333","47.95.32.37:8333","47.95.32.49:8333","47.95.32.81:8333","47.95.32.102:8333","47.95.32.115:8333","47.95.32.150:8333","47.95.32.160:8333","47.95.32.168:8333","47.95.32.170:8333","47.95.32.206:8333","47.95.32.214:8333","47.95.32.222:8333","47.95.33.36:8333","47.95.33.244:8333","47.95.34.204:8333","47.95.34.221:8333","47.95.34.239:8333","47.95.36.36:8333","47.95.36.43:8333","47.95.36.88:8333","47.95.36.112:8333","47.95.36.119:8333","47.95.36.127:8333","47.95.36.131:8333","47.95.36.142:8333","47.144.68.129:8333","47.144.89.95:8333","47.147.194.182:8333","47.199.64.78:8333","47.199.245.147:8333","47.205.104.84:8333","47.221.170.251:8333","49.151.149.90:8333","50.35.71.222:9333","50.79.174.253:8333","50.89.235.231:8333","50.116.24.44:8333","50.201.144.170:8333","50.251.84.82:8333","51.15.64.38:8333","51.15.78.11:8333","51.15.172.85:8333","51.15.177.162:5901","51.174.91.57:8333","51.254.62.169:8333","52.7.233.13:8333","52.16.106.11:8333","52.16.114.127:8333","52.19.182.1:8333","52.28.202.131:8333","52.29.36.71:8333","52.29.133.16:8333","52.39.202.159:8333","52.50.85.157:8333","52.51.232.234:8333","52.53.148.163:8333","52.53.198.141:8333","52.53.246.65:8333","52.53.248.42:8333","52.55.179.5:8333","52.57.14.67:8333","52.58.163.201:8333","52.58.190.144:8333","52.59.70.178:8333","52.62.183.49:8333","52.63.133.105:8333","52.63.175.61:8333","52.65.58.199:8333","52.65.84.70:8333","52.66.10.204:8333","52.66.180.152:8333","52.77.194.245:8333","52.77.210.42:8333","52.77.211.219:8333","52.77.223.113:8333","52.90.132.42:8333","52.91.3.54:8333","52.166.106.215:8333","52.169.230.50:8333","52.174.244.76:8333","52.178.92.117:8333","52.210.38.227:8333","52.210.252.123:8333","52.212.92.0:8333","52.221.186.28:8333","52.221.227.157:8333","52.231.201.61:10333","52.243.44.176:8333","54.36.175.75:8333","54.64.217.175:8333","54.66.220.179:8333","54.66.222.15:8333","54.76.4.146:8333","54.76.39.118:8333","54.77.6.125:8333","54.77.9.180:8333","54.77.96.42:8333","54.79.88.22:8333","54.79.95.49:8333","54.86.30.74:8333","54.89.8.237:8333","54.89.162.54:8333","54.90.148.132:8333","54.93.211.66:8333","54.149.206.22:18916","54.153.6.133:8333","54.153.9.217:8333","54.153.122.31:8333","54.153.163.163:8333","54.153.224.151:8333","54.154.139.212:8333","54.158.13.123:8333","54.158.87.15:8333","54.169.3.155:8333","54.169.194.253:8333","54.169.231.55:8333","54.173.149.22:8333","54.174.227.235:8333","54.175.243.122:8333","54.179.133.79:8333","54.179.157.33:8333","54.183.36.6:8333","54.183.131.136:8333","54.183.187.249:8333","54.183.214.240:8333","54.183.216.238:8333","54.183.235.131:8333","54.183.239.226:8333","54.193.103.231:8333","54.206.27.18:8333","54.206.46.40:8333","54.206.77.61:8333","54.215.248.143:8333","54.219.172.105:8333","54.223.214.238:8333","54.224.137.110:8333","54.236.212.139:8333","54.241.149.2:8333","54.254.134.94:8333","54.255.187.149:8333","54.255.201.130:8333","54.255.213.254:8333","58.182.194.247:8333","58.229.208.215:8333","59.110.115.52:8333","59.110.115.53:8335","59.110.115.60:8333","59.167.111.234:8333","60.205.93.34:8333","60.205.94.41:8333","60.205.149.7:8333","60.205.149.204:8333","61.100.182.189:18333","62.21.50.40:8333","62.75.165.127:8333","62.75.244.78:8333","62.112.8.21:8333","62.112.11.188:8345","62.178.94.204:8222","62.204.141.34:8333","62.210.93.229:28333","62.210.110.181:18333","64.91.233.206:8333","64.191.9.129:8333","65.29.222.181:8333","65.60.253.73:8333","66.68.47.40:8333","66.103.14.157:8333","66.108.15.5:8433","66.175.221.61:8333","66.187.65.6:8333","66.219.199.7:8333","66.228.55.148:8333","66.231.154.186:8333","67.5.200.210:8333","67.81.194.219:8333","67.164.198.247:8333","67.168.109.183:8333","67.176.105.148:8333","67.184.25.24:8333","67.187.91.121:8333","67.205.162.248:8333","67.205.179.161:8333","67.221.142.252:8333","68.4.228.138:8333","68.44.143.216:8333","68.51.86.223:8333","68.100.19.88:8333","68.119.82.185:8333","69.123.14.127:8333","69.164.206.206:8333","69.172.174.21:8333","69.181.20.152:8333","69.244.188.37:8333","69.253.79.150:8333","70.119.125.160:8333","70.181.115.20:8333","71.19.252.114:15849","71.72.225.36:8333","71.93.204.226:8333","71.127.43.68:8333","71.224.11.214:8333","71.229.190.223:8333","71.252.137.246:8333","72.5.167.41:8333","72.14.176.235:8333","72.14.179.185:8333","72.48.20.143:8333","72.69.164.158:8333","72.87.115.55:8333","72.95.24.200:8333","72.202.190.68:8333","72.219.192.59:8333","72.224.101.65:8334","72.234.251.203:8333","73.45.176.81:8333","73.62.146.11:8333","73.136.12.230:8333","73.140.155.140:8333","73.221.251.192:8333","73.222.8.114:8333","73.222.178.103:8333","73.225.143.212:8333","73.232.94.22:9333","73.252.200.173:8333","74.70.199.7:8333","74.97.54.169:8333","74.142.183.94:8333","74.215.205.37:8333","75.82.4.183:8333","75.118.7.71:8333","75.135.38.126:8333","75.143.109.42:8334","75.171.250.65:8333","75.177.137.134:8333","76.14.40.224:8333","76.16.12.81:8333","76.30.146.32:8333","76.114.109.222:8333","76.167.224.22:8333","76.170.136.45:8333","76.183.102.192:8333","77.70.7.238:8333","77.78.23.237:8333","77.98.108.194:8333","77.139.66.3:8333","77.234.104.137:8333","77.249.213.25:5914","78.0.16.150:8333","78.34.13.243:8333","78.46.43.21:38333","78.46.65.202:8333","78.46.109.124:8334","78.84.154.51:8333","78.187.90.122:8333","78.194.158.141:8333","79.67.124.119:8333","79.109.117.54:8333","79.137.69.175:8333","79.250.124.63:8333","79.250.125.29:8333","79.250.126.155:8333","80.3.158.239:9333","80.28.64.230:8333","80.99.18.153:8333","80.102.234.11:8333","80.149.23.19:8333","80.216.18.114:8333","80.220.203.163:8333","80.229.7.227:8333","80.235.31.111:28480","81.2.95.135:8335","81.98.216.212:8333","81.110.18.223:8333","81.163.207.12:8333","81.182.251.118:8333","81.184.206.203:8333","81.187.82.54:8333","81.191.243.35:8333","82.23.192.158:8333","82.25.55.71:8333","82.25.72.228:8333","82.36.141.160:8333","82.37.239.223:8333","82.47.144.200:8333","82.71.36.29:8333","82.131.87.109:8333","82.161.133.112:8333","82.196.13.79:8333","82.202.199.122:8333","82.217.133.145:8333","82.218.224.123:8333","82.221.128.207:8333","82.235.147.9:8333","82.251.138.80:8333","83.0.215.194:8333","83.57.35.223:8333","83.69.203.44:8333","83.78.184.14:8333","83.104.59.170:8333","83.162.186.61:8333","83.162.244.99:8333","83.162.245.167:8333","83.163.223.145:8333","83.169.20.34:8333","83.172.69.154:8333","83.243.66.120:8333","84.10.160.94:8333","84.50.243.165:28480","84.56.3.118:8333","84.56.14.89:8333","84.75.255.76:8333","84.80.175.252:8333","84.111.181.131:8333","84.139.140.92:8333","84.200.76.32:8333","84.209.146.99:8333","85.1.81.170:8333","85.24.145.18:8333","85.24.202.199:8333","85.64.32.89:8333","85.144.197.163:8333","85.166.191.71:8333","85.195.214.189:8333","85.214.147.99:8340","85.224.107.207:8333","85.224.205.151:8333","85.253.101.74:8333","86.3.155.147:8333","86.84.23.148:8333","86.88.18.88:8333","86.138.51.87:8333","86.140.153.237:8333","86.163.245.138:8333","86.180.56.119:8333","86.191.75.88:8333","86.194.144.120:8333","86.194.148.151:8333","86.194.150.42:8333","86.247.49.84:8333","86.253.42.208:8333","87.6.245.153:8333","87.14.49.60:8333","87.100.179.73:8333","87.120.8.200:8333","87.167.109.197:8333","87.182.191.170:8333","87.236.197.40:8433","87.236.198.6:8433","88.7.113.226:8333","88.21.82.114:8333","88.96.33.124:8333","88.99.16.70:8333","88.99.199.87:8333","88.99.228.52:8333","88.132.98.224:8333","88.139.125.8:8333","88.159.92.155:8533","88.167.97.19:8333","88.186.61.209:8333","88.198.33.214:8333","88.198.39.205:28333","88.198.214.66:8333","88.207.139.203:8333","89.0.48.21:8333","89.29.128.5:8333","89.102.163.90:8333","89.153.67.32:8333","89.163.148.103:8333","89.163.250.205:8333","89.174.173.58:8333","89.179.247.236:8333","89.201.37.229:8333","90.68.33.70:8333","90.94.198.13:8333","90.173.135.190:8333","91.64.127.193:8333","91.64.151.202:8333","91.121.183.128:8333","91.145.42.83:8333","91.145.49.56:8333","91.145.96.142:8333","91.153.129.134:8333","91.155.2.83:8773","91.193.228.106:8333","91.195.249.2:8333","91.197.44.144:8333","91.198.177.222:8333","91.204.149.5:8334","91.211.214.226:8333","91.242.68.249:8333","92.27.47.223:8333","92.106.37.45:8333","92.203.230.27:8333","92.208.199.118:8333","92.246.20.200:8333","92.255.196.243:8333","93.104.208.119:8333","93.104.209.82:8333","93.137.96.162:8333","93.180.51.51:8333","93.197.129.60:8333","93.197.132.21:8333","93.197.132.162:8333","93.225.185.129:8335","93.230.53.180:8333","93.254.66.240:8333","94.54.65.63:8333","94.130.9.100:8334","94.130.97.128:8333","94.130.129.233:8340","94.130.207.19:8333","94.130.230.214:8333","94.135.137.108:8333","94.142.240.7:8333","94.158.202.150:8333","94.192.168.53:8334","94.208.163.116:8333","94.214.95.37:8333","95.24.206.156:8333","95.76.228.22:8333","95.80.44.100:8333","95.144.159.244:8333","95.145.31.230:8333","95.183.54.60:8333","95.211.136.86:8333","95.213.143.139:8334","95.213.210.141:8333","95.236.45.251:8333","96.27.24.35:8333","96.33.206.12:8333","96.55.160.83:8333","96.61.92.242:8333","96.126.117.5:8333","96.126.126.236:8333","96.234.39.185:8333","96.255.149.25:8333","96.255.151.234:8333","98.26.108.142:8333","98.111.167.53:8333","98.116.57.210:8333","98.151.16.60:8333","98.161.206.98:8333","98.197.157.163:8333","98.206.255.202:8333","98.211.48.233:8333","98.212.40.112:8333","98.214.101.160:8333","98.223.11.58:8333","99.249.11.155:8333","99.252.185.182:8333","100.0.240.131:8333","100.8.165.86:8333","100.40.10.147:8333","101.37.12.97:8333","101.37.12.132:8333","101.37.12.209:8333","101.37.14.168:8333","101.37.116.47:8333","101.37.116.129:8333","101.37.116.137:8333","101.37.116.181:8333","101.37.116.226:8333","101.37.117.108:8333","101.37.117.155:8333","101.37.117.159:8333","101.37.117.161:8333","101.37.117.172:8333","101.37.160.142:8333","101.37.160.222:8333","101.37.161.119:8333","101.37.161.153:8333","101.37.161.215:8333","101.37.161.249:8333","101.37.162.71:8333","101.37.162.87:8333","101.37.162.92:8333","101.37.162.144:8333","101.37.163.41:8333","101.37.163.77:8333","101.37.163.84:8333","101.37.163.109:8333","101.37.163.120:8333","101.37.163.132:8333","101.37.253.219:8333","101.37.253.223:8333","101.37.253.232:8333","101.80.124.4:8333","101.92.41.72:8334","101.92.44.86:8334","101.92.46.219:8334","101.100.174.138:8333","101.132.17.39:8333","101.132.25.69:8333","101.132.25.94:8333","101.132.25.119:8333","101.132.25.169:8333","101.132.25.173:8333","101.132.26.0:8333","101.132.26.16:8333","101.132.26.17:8333","101.132.26.28:8333","101.132.26.47:8333","101.132.26.53:8333","101.132.26.64:8333","101.132.26.66:8333","101.132.26.76:8333","101.132.26.84:8333","101.132.27.139:8333","101.201.40.27:8333","101.201.69.70:8333","101.201.232.112:8333","103.70.192.128:8333","103.195.4.59:8333","103.214.146.9:8333","103.230.185.4:8333","103.230.187.2:8333","104.13.245.190:8333","104.128.228.78:8333","104.154.189.24:8333","104.168.144.27:8333","104.168.167.34:8333","104.172.190.165:8333","104.221.10.201:8334","104.223.12.139:8333","104.236.254.25:8333","104.238.131.116:8333","104.238.134.28:8333","104.239.146.76:8333","104.243.24.236:44231","106.14.7.128:8333","106.14.24.114:8333","106.14.25.158:8333","106.14.96.163:8333","106.14.97.79:8333","106.14.98.21:8333","106.14.104.6:8333","106.14.104.34:8333","106.14.104.36:8333","106.14.104.39:8333","106.14.104.49:8333","106.14.104.84:8333","106.14.104.167:8333","106.14.104.171:8333","106.14.104.229:8333","106.14.104.234:8333","106.14.104.241:8333","106.14.104.249:8333","106.14.105.7:8333","106.14.105.9:8333","106.14.105.11:8333","106.14.105.13:8333","106.14.105.18:8333","106.14.105.23:8333","106.14.105.24:8333","106.14.105.34:8333","106.14.105.45:8333","106.14.105.46:8333","106.14.105.47:8333","106.14.105.48:8333","106.14.105.50:8333","106.14.105.53:8333","106.14.105.55:8333","106.14.105.56:8333","106.14.105.57:8333","106.14.105.59:8333","106.14.105.61:8333","106.14.105.64:8333","106.14.105.65:8333","106.14.105.74:8333","106.14.105.75:8333","106.14.105.103:8333","106.14.105.128:8333","106.14.105.160:8333","106.14.105.167:8333","106.14.105.197:8333","106.15.36.95:8333","106.15.38.181:8333","106.15.52.8:8333","106.15.52.83:8333","106.15.52.142:8333","106.15.52.153:8333","106.15.52.170:8333","106.15.52.191:8333","106.15.52.216:8333","106.15.52.231:8333","106.15.52.235:8333","106.15.53.2:8333","106.15.53.5:8333","106.15.56.13:8333","106.15.56.24:8333","106.15.56.27:8333","106.15.56.29:8333","106.15.56.81:8333","106.15.56.183:8333","106.15.56.191:8333","106.15.56.235:8333","106.15.57.10:8333","106.15.57.18:8333","106.15.57.33:8333","106.15.57.46:8333","106.15.57.63:8333","106.15.57.110:8333","106.15.74.19:8333","106.15.74.53:8333","106.15.74.72:8333","106.15.75.201:8333","106.15.102.229:8333","106.83.113.3:8333","106.83.117.221:8333","107.6.181.169:8333","107.23.167.150:8333","107.23.184.33:8333","107.167.80.114:8333","107.170.231.153:8333","107.172.9.139:8333","107.172.253.120:8333","107.189.36.4:8333","107.194.45.197:8333","108.29.191.194:8333","108.59.2.208:8333","108.61.207.116:8333","108.75.213.57:8333","108.200.255.200:8338","109.106.62.92:8333","109.131.76.216:8334","109.146.173.4:8333","109.233.58.46:8333","109.236.88.245:8333","110.10.81.207:8333","110.10.81.223:8333","110.10.189.113:18333","110.90.24.215:8333","111.69.165.173:8333","111.220.93.213:8333","112.74.57.179:8333","113.235.104.154:8333","114.90.107.119:8334","116.62.12.6:8333","116.62.12.249:8333","116.62.13.142:8333","116.62.13.150:8333","116.62.13.177:8333","116.62.13.179:8333","116.62.13.182:8333","116.62.13.183:8333","116.62.13.186:8333","116.62.13.198:8333","116.62.13.206:8333","116.62.13.207:8333","116.62.13.209:8333","116.62.13.210:8333","116.62.13.219:8333","116.62.13.222:8333","116.62.13.224:8333","116.62.14.155:8333","116.206.80.33:8333","117.2.133.246:8333","118.31.164.83:8333","118.31.164.108:8333","118.31.164.124:8333","118.31.164.147:8333","118.31.164.193:8333","118.31.165.250:8333","118.31.166.20:8333","118.31.166.46:8333","118.31.166.50:8333","118.31.166.52:8333","118.31.166.58:8333","118.31.166.63:8333","118.31.166.65:8333","118.31.166.66:8333","118.31.166.68:8333","118.31.166.71:8333","118.31.166.73:8333","118.31.166.78:8333","118.31.166.80:8333","118.31.166.82:8333","118.31.166.85:8333","118.31.166.86:8333","118.31.166.88:8333","118.31.166.92:8333","118.31.166.93:8333","118.31.166.94:8333","118.31.166.101:8333","118.31.166.106:8333","118.31.166.108:8333","118.31.166.109:8333","118.31.166.110:8333","118.31.166.113:8333","118.31.166.115:8333","118.31.166.116:8333","118.31.169.98:8333","118.31.169.170:8333","118.31.169.199:8333","118.31.169.221:8333","118.190.85.232:8333","118.237.30.204:8333","118.244.204.225:8333","119.9.116.50:8333","119.15.100.120:8334","119.23.128.1:8333","119.23.133.21:8333","119.23.136.17:8333","119.23.136.69:8333","119.23.136.102:8333","119.23.136.213:8333","119.23.136.252:8333","119.23.137.12:8333","119.23.137.31:8333","119.23.137.54:8333","119.23.137.81:8333","119.23.137.104:8333","119.23.137.129:8333","119.23.137.138:8333","119.23.137.147:8333","119.23.160.19:8333","119.23.160.124:8333","119.23.160.146:8333","119.23.160.235:8333","119.23.160.244:8333","119.23.161.10:8333","119.23.161.14:8333","119.23.161.15:8333","119.23.161.21:8333","119.23.172.14:8333","119.23.172.167:8333","119.23.173.8:8333","119.23.173.88:8333","119.23.173.108:8333","119.23.173.111:8333","119.23.173.114:8333","119.23.173.131:8333","119.23.173.138:8333","119.23.173.158:8333","119.23.173.161:8333","119.23.173.164:8333","119.23.173.172:8333","119.23.173.184:8333","119.23.173.186:8333","119.23.173.187:8333","119.23.173.190:8333","119.23.173.192:8333","119.23.173.193:8333","119.23.173.194:8333","119.23.173.197:8333","119.23.173.200:8333","119.23.173.202:8333","119.23.173.205:8333","119.23.173.212:8333","119.23.212.165:8333","119.23.245.117:8333","119.28.65.87:8333","119.28.75.211:8333","119.28.155.57:8333","119.98.222.207:8333","119.98.223.25:8333","120.55.164.60:7112","120.60.128.128:8333","120.76.31.99:8333","120.76.157.222:8333","120.76.200.95:8333","120.76.201.161:8333","120.76.202.15:8333","120.76.202.120:8333","120.76.203.53:8333","120.76.203.73:8333","120.76.203.124:8333","120.76.203.125:8333","120.76.203.139:8333","120.76.213.239:8333","120.77.64.171:8333","120.77.69.107:8333","120.77.69.197:8333","120.77.69.198:8333","120.77.69.222:8333","120.77.236.29:8333","120.77.236.32:8333","120.77.236.148:8333","120.77.236.166:8333","120.77.236.204:8333","120.77.236.238:8333","120.77.236.248:8333","120.77.237.0:8333","120.77.237.5:8333","120.77.237.13:8333","120.77.237.146:8333","120.78.58.206:8444","120.78.252.8:8333","120.79.67.129:8333","120.92.254.58:8333","121.52.238.87:8333","121.133.96.241:8333","121.220.224.235:8333","122.135.83.236:8333","122.148.84.30:8123","122.228.96.58:8333","123.9.146.175:8333","124.150.82.113:8333","126.60.205.229:8333","126.85.52.13:8333","128.199.138.39:8333","128.199.144.232:8333","128.199.177.129:8333","130.180.123.98:8333","131.215.144.154:8333","134.249.149.41:8333","135.19.245.93:8333","136.32.188.242:8333","136.32.205.57:8333","136.144.169.185:8133","136.243.14.241:8333","136.243.16.130:8333","136.243.58.134:8333","136.243.146.69:8343","136.243.173.89:8333","137.74.30.99:8333","137.99.213.225:8333","137.226.109.169:8333","138.68.80.120:8333","138.68.169.213:8333","138.68.227.203:8443","138.68.235.224:8333","138.197.193.154:8333","138.197.204.148:8333","138.201.138.148:38333","139.59.88.5:8333","139.59.108.91:8333","139.59.159.95:8335","139.162.21.37:8333","139.162.21.80:8333","139.162.118.68:8333","139.162.172.224:8333","139.162.179.32:8333","139.162.180.24:8333","139.162.185.143:8333","139.162.194.49:8333","139.162.207.65:8333","139.162.217.202:8333","139.162.219.180:8333","139.162.239.208:8333","139.196.106.118:8333","141.168.168.26:8333","141.226.121.173:8333","142.44.139.218:8333","144.76.39.233:8335","144.76.51.35:8335","144.76.154.138:8333","144.76.170.163:8333","144.76.220.17:9090","144.217.39.73:8333","144.217.67.68:8333","144.217.73.86:8333","146.145.36.86:8333","146.148.73.119:8333","148.66.58.186:8333","148.103.7.119:8333","148.251.182.82:8233","149.56.79.70:8333","149.56.89.153:8333","149.56.198.232:8333","149.202.208.160:14797","149.202.211.17:8333","149.210.238.31:8333","150.95.32.151:8333","151.250.121.18:8333","157.97.105.5:8333","158.69.77.131:8333","158.69.251.42:8333","158.129.212.236:8335","159.100.243.53:8333","159.148.92.240:8333","161.97.248.163:8333","162.213.30.44:8333","162.220.47.150:8333","162.242.168.36:8333","162.242.168.55:8333","162.242.168.57:8333","162.242.168.59:8333","162.243.243.54:8333","162.249.229.153:8333","163.172.147.254:8333","163.172.165.116:8333","163.172.174.164:8333","163.172.176.53:8333","163.172.186.49:8333","164.132.121.44:8333","165.227.12.201:8333","165.227.25.140:8333","165.227.122.62:8333","165.227.151.132:8333","167.114.156.34:8333","167.160.36.104:8333","170.254.236.135:8333","171.98.116.83:8333","171.217.56.192:8333","172.96.161.245:8333","172.97.208.51:8333","172.104.8.5:8333","172.104.8.7:8333","172.104.45.73:8333","172.104.46.23:8333","172.104.59.22:8333","172.104.123.149:8333","172.104.138.110:8333","172.104.140.18:8333","172.104.147.29:8333","172.104.151.66:8333","172.104.157.91:8333","172.104.157.173:8333","172.104.159.152:8333","172.104.161.156:8333","172.222.78.135:18232","173.23.228.234:8333","173.32.252.212:8333","173.208.148.138:38333","173.212.194.93:8344","173.212.202.33:18337","173.224.240.38:8333","173.224.240.45:8333","173.230.134.205:8333","173.246.229.42:8333","173.255.113.119:8333","173.255.248.232:8333","174.7.119.132:8333","174.115.222.42:8333","175.126.38.44:8334","175.138.37.209:8333","175.209.218.79:8333","176.9.8.230:8333","176.9.22.240:8333","176.9.36.134:8333","176.9.51.120:8333","176.9.154.110:8333","176.24.232.143:8333","176.25.187.3:8334","176.26.232.77:8333","176.31.6.147:8333","176.31.207.133:8337","176.58.114.235:8333","176.197.251.220:8333","178.21.0.241:8333","178.21.118.33:8333","178.33.231.2:8333","178.63.60.7:9090","178.78.195.134:8333","178.79.168.252:8333","178.119.65.62:8333","178.119.66.169:8333","178.140.165.34:8333","178.169.249.185:8333","178.218.115.169:8333","178.238.226.209:8333","180.172.236.219:8333","180.218.4.246:8343","181.118.82.84:8333","182.139.86.163:8333","182.149.158.127:8333","183.136.236.23:8333","184.70.33.194:8333","184.73.128.254:8333","185.21.217.6:8333","185.26.197.5:8333","185.50.191.68:8333","185.53.154.229:8333","185.56.20.126:8333","185.69.52.180:8333","185.100.249.3:8333","185.145.128.91:8333","185.154.156.58:8333","185.170.115.102:8333","185.202.163.68:8333","187.192.251.245:8333","188.32.103.165:8333","188.40.93.205:8333","188.68.38.210:8333","188.68.40.28:8333","188.113.84.116:8333","188.165.200.80:8334","188.192.151.177:8333","188.193.139.246:8333","188.195.106.199:8333","188.201.104.124:8333","188.241.58.245:8333","188.255.31.28:8333","192.81.249.110:8333","192.99.12.47:8333","192.169.7.87:8333","192.169.7.100:8333","192.169.7.220:8333","192.203.228.91:8333","193.29.187.50:8333","193.70.18.162:8333","193.70.125.5:8333","193.107.192.119:8333","193.111.255.30:8341","193.124.176.37:8333","193.150.52.5:8333","193.159.29.55:8333","193.198.102.35:8333","193.234.225.156:8333","194.14.246.87:8333","194.14.246.88:8333","194.14.246.205:8444","194.88.107.65:8333","194.88.107.102:8333","194.149.90.19:8333","195.140.215.8:8333","195.154.227.88:8333","196.54.41.9:52442","196.54.41.21:52442","198.27.68.86:8333","198.27.83.210:13020","198.48.149.113:8333","198.50.153.39:8333","198.84.173.90:8333","198.245.61.166:8333","198.245.62.208:8333","198.245.63.55:8333","199.21.149.49:2087","199.36.122.226:8333","199.38.85.189:8333","199.60.123.5:8333","201.68.49.200:8333","202.153.220.38:8333","203.60.2.68:8333","203.122.240.250:8433","204.111.38.116:8333","207.154.222.46:8333","207.172.126.186:8433","208.85.241.10:8333","208.110.93.76:8333","209.6.139.49:8333","209.160.27.54:8333","209.197.171.17:8333","211.22.29.34:19263","211.238.13.10:8333","212.32.230.219:8333","212.47.235.251:8333","212.47.236.91:8333","212.56.120.203:8333","212.105.160.47:8333","212.117.214.102:8333","212.171.187.228:8333","212.182.183.29:8333","213.59.149.244:8333","213.66.28.170:8353","213.113.193.33:8333","213.119.97.41:8333","213.119.108.179:8333","213.136.73.207:8333","213.136.86.213:8333","213.149.159.15:8333","213.196.255.55:8333","213.202.135.161:8333","213.239.213.43:8333","213.239.216.162:9090","213.240.182.119:8333","216.146.251.14:18333","216.189.154.58:8333","216.218.235.93:8333","216.249.92.191:8333","217.10.105.93:8333","217.41.60.242:8333","217.76.93.14:8333","217.78.5.83:8333","217.103.145.225:8333","217.182.199.21:8333","218.145.93.122:8333","220.233.35.182:8333"]},{}],60:[function(require,module,exports){"use strict";module.exports=["5.9.150.112:9696","5.10.74.114:18333","13.230.140.121:18333","35.184.152.173:18333","35.193.133.244:18333","39.106.248.45:18333","46.101.240.71:18333","47.52.31.232:18333","47.91.198.174:18333","51.254.219.214:18333","52.50.85.157:18333","54.249.51.109:18333","67.205.179.161:18333","87.236.198.7:18433","93.124.4.89:38333","104.198.194.166:18333","104.238.198.165:18333","120.79.53.34:18333","128.199.144.232:18333","130.211.162.124:18333","144.217.73.86:18333","150.95.34.97:18333","158.69.119.35:18333","176.9.89.217:9696","176.9.154.110:18333","185.12.7.119:18333","188.40.93.205:18333","207.154.196.149:18333","207.154.210.222:10201","218.244.146.111:18333"]},{}],61:[function(require,module,exports){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}var assert=require("assert"),Chain=require("../blockchain/chain"),Fees=require("../mempool/fees"),Mempool=require("../mempool/mempool"),Pool=require("../net/pool"),Miner=require("../mining/miner"),Node=require("./node"),HTTP=require("./http"),RPC=require("./rpc"),FullNode=function(_Node){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(FullNode,_Node);function FullNode(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,FullNode);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Node.call(this,"bcoin","bcoin.conf","debug.log",options));return _this.opened=!1,_this.spv=!1,_this.chain=new Chain({network:_this.network,logger:_this.logger,workers:_this.workers,memory:_this.config.bool("memory"),prefix:_this.config.prefix,maxFiles:_this.config.uint("max-files"),cacheSize:_this.config.mb("cache-size"),forceFlags:_this.config.bool("force-flags"),bip91:_this.config.bool("bip91"),bip148:_this.config.bool("bip148"),prune:_this.config.bool("prune"),checkpoints:_this.config.bool("checkpoints"),coinCache:_this.config.mb("coin-cache"),entryCache:_this.config.uint("entry-cache"),indexTX:_this.config.bool("index-tx"),indexAddress:_this.config.bool("index-address")}),_this.fees=new Fees(_this.logger),_this.fees.init(),_this.mempool=new Mempool({network:_this.network,logger:_this.logger,workers:_this.workers,chain:_this.chain,fees:_this.fees,memory:_this.config.bool("memory"),prefix:_this.config.prefix,persistent:_this.config.bool("persistent-mempool"),maxSize:_this.config.mb("mempool-size"),limitFree:_this.config.bool("limit-free"),limitFreeRelay:_this.config.uint("limit-free-relay"),requireStandard:_this.config.bool("require-standard"),rejectAbsurdFees:_this.config.bool("reject-absurd-fees"),replaceByFee:_this.config.bool("replace-by-fee"),indexAddress:_this.config.bool("index-address")}),_this.pool=new Pool({network:_this.network,logger:_this.logger,chain:_this.chain,mempool:_this.mempool,prefix:_this.config.prefix,selfish:_this.config.bool("selfish"),compact:_this.config.bool("compact"),bip37:_this.config.bool("bip37"),bip151:_this.config.bool("bip151"),bip150:_this.config.bool("bip150"),identityKey:_this.config.buf("identity-key"),maxOutbound:_this.config.uint("max-outbound"),maxInbound:_this.config.uint("max-inbound"),createSocket:_this.config.func("create-socket"),proxy:_this.config.str("proxy"),onion:_this.config.bool("onion"),upnp:_this.config.bool("upnp"),seeds:_this.config.array("seeds"),nodes:_this.config.array("nodes"),only:_this.config.array("only"),publicHost:_this.config.str("public-host"),publicPort:_this.config.uint("public-port"),host:_this.config.str("host"),port:_this.config.uint("port"),listen:_this.config.bool("listen"),memory:_this.config.bool("memory")}),_this.miner=new Miner({network:_this.network,logger:_this.logger,workers:_this.workers,chain:_this.chain,mempool:_this.mempool,address:_this.config.array("coinbase-address"),coinbaseFlags:_this.config.str("coinbase-flags"),preverify:_this.config.bool("preverify"),maxWeight:_this.config.uint("max-weight"),reservedWeight:_this.config.uint("reserved-weight"),reservedSigops:_this.config.uint("reserved-sigops")}),_this.rpc=new RPC(_this),_this.http=new HTTP({network:_this.network,logger:_this.logger,node:_this,prefix:_this.config.prefix,ssl:_this.config.bool("ssl"),keyFile:_this.config.path("ssl-key"),certFile:_this.config.path("ssl-cert"),host:_this.config.str("http-host"),port:_this.config.uint("http-port"),apiKey:_this.config.str("api-key"),noAuth:_this.config.bool("no-auth")}),_this.init(),_this}return FullNode.prototype.init=function(){var _this2=this;this.chain.on("error",function(err){return _this2.error(err)}),this.mempool.on("error",function(err){return _this2.error(err)}),this.pool.on("error",function(err){return _this2.error(err)}),this.miner.on("error",function(err){return _this2.error(err)}),this.http&&this.http.on("error",function(err){return _this2.error(err)}),this.mempool.on("tx",function(tx){_this2.miner.cpu.notifyEntry(),_this2.emit("tx",tx)}),this.chain.on("connect",function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(entry,block){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,_context.next=3,_this2.mempool._addBlock(entry,block.txs);case 3:_context.next=8;break;case 5:_context.prev=5,_context.t0=_context.catch(0),_this2.error(_context.t0);case 8:_this2.emit("block",block),_this2.emit("connect",entry,block);case 10:case"end":return _context.stop()}},_callee,_this2,[[0,5]])}));return function(_x,_x2){return _ref.apply(this,arguments)}}()),this.chain.on("disconnect",function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(entry,block){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.prev=0,_context2.next=3,_this2.mempool._removeBlock(entry,block.txs);case 3:_context2.next=8;break;case 5:_context2.prev=5,_context2.t0=_context2.catch(0),_this2.error(_context2.t0);case 8:_this2.emit("disconnect",entry,block);case 9:case"end":return _context2.stop()}},_callee2,_this2,[[0,5]])}));return function(_x3,_x4){return _ref2.apply(this,arguments)}}()),this.chain.on("reorganize",function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(tip,competitor){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.prev=0,_context3.next=3,_this2.mempool._handleReorg();case 3:_context3.next=8;break;case 5:_context3.prev=5,_context3.t0=_context3.catch(0),_this2.error(_context3.t0);case 8:_this2.emit("reorganize",tip,competitor);case 9:case"end":return _context3.stop()}},_callee3,_this2,[[0,5]])}));return function(_x5,_x6){return _ref3.apply(this,arguments)}}()),this.chain.on("reset",function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(tip){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.prev=0,_context4.next=3,_this2.mempool._reset();case 3:_context4.next=8;break;case 5:_context4.prev=5,_context4.t0=_context4.catch(0),_this2.error(_context4.t0);case 8:_this2.emit("reset",tip);case 9:case"end":return _context4.stop()}},_callee4,_this2,[[0,5]])}));return function(_x7){return _ref4.apply(this,arguments)}}()),this.loadPlugins()},FullNode.prototype.open=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return assert(!this.opened,"FullNode is already open."),this.opened=!0,_context5.next=4,this.handlePreopen();case 4:return _context5.next=6,this.chain.open();case 6:return _context5.next=8,this.mempool.open();case 8:return _context5.next=10,this.miner.open();case 10:return _context5.next=12,this.pool.open();case 12:return _context5.next=14,this.openPlugins();case 14:return _context5.next=16,this.http.open();case 16:return _context5.next=18,this.handleOpen();case 18:this.logger.info("Node is loaded.");case 19:case"end":return _context5.stop()}},_callee5,this)}));return function(){return _ref5.apply(this,arguments)}}(),FullNode.prototype.close=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(){return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return assert(this.opened,"FullNode is not open."),this.opened=!1,_context6.next=4,this.handlePreclose();case 4:return _context6.next=6,this.http.close();case 6:return _context6.next=8,this.closePlugins();case 8:return _context6.next=10,this.pool.close();case 10:return _context6.next=12,this.miner.close();case 12:return _context6.next=14,this.mempool.close();case 14:return _context6.next=16,this.chain.close();case 16:return _context6.next=18,this.handleClose();case 18:this.logger.info("Node is closed.");case 19:case"end":return _context6.stop()}},_callee6,this)}));return function(){return _ref6.apply(this,arguments)}}(),FullNode.prototype.scan=function(start,filter,iter){return this.chain.scan(start,filter,iter)},FullNode.prototype.broadcast=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(item){return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.prev=0,_context7.next=3,this.pool.broadcast(item);case 3:_context7.next=8;break;case 5:_context7.prev=5,_context7.t0=_context7.catch(0),this.emit("error",_context7.t0);case 8:case"end":return _context7.stop()}},_callee7,this,[[0,5]])}));return function(_x8){return _ref7.apply(this,arguments)}}(),FullNode.prototype.sendTX=function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(tx){var missing;return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return missing=void 0,_context8.prev=1,_context8.next=4,this.mempool.addTX(tx);case 4:missing=_context8.sent,_context8.next=16;break;case 7:if(_context8.prev=7,_context8.t0=_context8.catch(1),"VerifyError"!==_context8.t0.type||0!==_context8.t0.score){_context8.next=15;break}return this.error(_context8.t0),this.logger.warning("Verification failed for tx: %s.",tx.txid()),this.logger.warning("Attempting to broadcast anyway..."),this.broadcast(tx),_context8.abrupt("return");case 15:throw _context8.t0;case 16:if(!missing){_context8.next=21;break}return this.logger.warning("TX was orphaned in mempool: %s.",tx.txid()),this.logger.warning("Attempting to broadcast anyway..."),this.broadcast(tx),_context8.abrupt("return");case 21:this.pool.options.selfish&&this.pool.broadcast(tx);case 22:case"end":return _context8.stop()}},_callee8,this,[[1,7]])}));return function(_x9){return _ref8.apply(this,arguments)}}(),FullNode.prototype.relay=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(tx){return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return _context9.prev=0,_context9.next=3,this.sendTX(tx);case 3:_context9.next=8;break;case 5:_context9.prev=5,_context9.t0=_context9.catch(0),this.error(_context9.t0);case 8:case"end":return _context9.stop()}},_callee9,this,[[0,5]])}));return function(_x10){return _ref9.apply(this,arguments)}}(),FullNode.prototype.connect=function(){return this.pool.connect()},FullNode.prototype.disconnect=function(){return this.pool.disconnect()},FullNode.prototype.startSync=function(){return this.pool.startSync()},FullNode.prototype.stopSync=function(){return this.pool.stopSync()},FullNode.prototype.getBlock=function(hash){return this.chain.getBlock(hash)},FullNode.prototype.getCoin=function(){var _ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(hash,index){var coin;return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:if(!(coin=this.mempool.getCoin(hash,index))){_context10.next=3;break}return _context10.abrupt("return",coin);case 3:if(!this.mempool.isSpent(hash,index)){_context10.next=5;break}return _context10.abrupt("return",null);case 5:return _context10.abrupt("return",this.chain.getCoin(hash,index));case 6:case"end":return _context10.stop()}},_callee10,this)}));return function(_x11,_x12){return _ref10.apply(this,arguments)}}(),FullNode.prototype.getCoinsByAddress=function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(addrs){var mempool,chain,out,_iterator,_isArray,_i,_ref12,coin,_iterator2,_isArray2,_i2,_ref13,_coin;return regeneratorRuntime.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:return mempool=this.mempool.getCoinsByAddress(addrs),_context11.next=3,this.chain.getCoinsByAddress(addrs);case 3:chain=_context11.sent,out=[],_iterator=chain,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();case 6:if(!_isArray){_context11.next=12;break}if(!(_i>=_iterator.length)){_context11.next=9;break}return _context11.abrupt("break",23);case 9:_ref12=_iterator[_i++],_context11.next=16;break;case 12:if(!(_i=_iterator.next()).done){_context11.next=15;break}return _context11.abrupt("break",23);case 15:_ref12=_i.value;case 16:if(coin=_ref12,!this.mempool.isSpent(coin.hash,coin.index)){_context11.next=20;break}return _context11.abrupt("continue",21);case 20:out.push(coin);case 21:_context11.next=6;break;case 23:_iterator2=mempool,_isArray2=Array.isArray(_iterator2),_i2=0,_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();case 24:if(!_isArray2){_context11.next=30;break}if(!(_i2>=_iterator2.length)){_context11.next=27;break}return _context11.abrupt("break",38);case 27:_ref13=_iterator2[_i2++],_context11.next=34;break;case 30:if(!(_i2=_iterator2.next()).done){_context11.next=33;break}return _context11.abrupt("break",38);case 33:_ref13=_i2.value;case 34:_coin=_ref13,out.push(_coin);case 36:_context11.next=24;break;case 38:return _context11.abrupt("return",out);case 39:case"end":return _context11.stop()}},_callee11,this)}));return function(_x13){return _ref11.apply(this,arguments)}}(),FullNode.prototype.getMetaByAddress=function(){var _ref14=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(addrs){var mempool,chain;return regeneratorRuntime.wrap(function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:return mempool=this.mempool.getMetaByAddress(addrs),_context12.next=3,this.chain.getMetaByAddress(addrs);case 3:return chain=_context12.sent,_context12.abrupt("return",chain.concat(mempool));case 5:case"end":return _context12.stop()}},_callee12,this)}));return function(_x14){return _ref14.apply(this,arguments)}}(),FullNode.prototype.getMeta=function(){var _ref15=_asyncToGenerator(regeneratorRuntime.mark(function _callee13(hash){var meta;return regeneratorRuntime.wrap(function(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:if(!(meta=this.mempool.getMeta(hash))){_context13.next=3;break}return _context13.abrupt("return",meta);case 3:return _context13.abrupt("return",this.chain.getMeta(hash));case 4:case"end":return _context13.stop()}},_callee13,this)}));return function(_x15){return _ref15.apply(this,arguments)}}(),FullNode.prototype.getMetaView=function(){var _ref16=_asyncToGenerator(regeneratorRuntime.mark(function _callee14(meta){return regeneratorRuntime.wrap(function(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:if(-1!==meta.height){_context14.next=2;break}return _context14.abrupt("return",this.mempool.getSpentView(meta.tx));case 2:return _context14.abrupt("return",this.chain.getSpentView(meta.tx));case 3:case"end":return _context14.stop()}},_callee14,this)}));return function(_x16){return _ref16.apply(this,arguments)}}(),FullNode.prototype.getTXByAddress=function(){var _ref17=_asyncToGenerator(regeneratorRuntime.mark(function _callee15(addrs){var mtxs,out,_iterator3,_isArray3,_i3,_ref18,mtx;return regeneratorRuntime.wrap(function(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:return _context15.next=2,this.getMetaByAddress(addrs);case 2:mtxs=_context15.sent,out=[],_iterator3=mtxs,_isArray3=Array.isArray(_iterator3),_i3=0,_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();case 5:if(!_isArray3){_context15.next=11;break}if(!(_i3>=_iterator3.length)){_context15.next=8;break}return _context15.abrupt("break",19);case 8:_ref18=_iterator3[_i3++],_context15.next=15;break;case 11:if(!(_i3=_iterator3.next()).done){_context15.next=14;break}return _context15.abrupt("break",19);case 14:_ref18=_i3.value;case 15:mtx=_ref18,out.push(mtx.tx);case 17:_context15.next=5;break;case 19:return _context15.abrupt("return",out);case 20:case"end":return _context15.stop()}},_callee15,this)}));return function(_x17){return _ref17.apply(this,arguments)}}(),FullNode.prototype.getTX=function(){var _ref19=_asyncToGenerator(regeneratorRuntime.mark(function _callee16(hash){var mtx;return regeneratorRuntime.wrap(function(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:return _context16.next=2,this.getMeta(hash);case 2:if(mtx=_context16.sent){_context16.next=5;break}return _context16.abrupt("return",null);case 5:return _context16.abrupt("return",mtx.tx);case 6:case"end":return _context16.stop()}},_callee16,this)}));return function(_x18){return _ref19.apply(this,arguments)}}(),FullNode.prototype.hasTX=function(){var _ref20=_asyncToGenerator(regeneratorRuntime.mark(function _callee17(hash){return regeneratorRuntime.wrap(function(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:if(!this.mempool.hasEntry(hash)){_context17.next=2;break}return _context17.abrupt("return",!0);case 2:return _context17.abrupt("return",this.chain.hasTX(hash));case 3:case"end":return _context17.stop()}},_callee17,this)}));return function(_x19){return _ref20.apply(this,arguments)}}(),FullNode}(Node);module.exports=FullNode},{"../blockchain/chain":2,"../mempool/fees":35,"../mempool/mempool":38,"../mining/miner":44,"../net/pool":57,"./http":62,"./node":64,"./rpc":65,assert:146}],62:[function(require,module,exports){(function(Buffer){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),path=require("path"),Server=require("bweb").Server,Validator=require("bval"),base58=require("bstring").base58,BloomFilter=require("bfilter").BloomFilter,sha256=require("bcrypto/lib/sha256"),random=require("bcrypto/lib/random"),ccmp=require("bcrypto/lib/ccmp"),util=require("../utils/util"),TX=require("../primitives/tx"),Outpoint=require("../primitives/outpoint"),Network=require("../protocol/network"),pkg=require("../pkg"),HTTP=function(_Server){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(HTTP,_Server);function HTTP(options){_classCallCheck(this,HTTP);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Server.call(this,new HTTPOptions(options)));return _this.network=_this.options.network,_this.logger=_this.options.logger.context("http"),_this.node=_this.options.node,_this.chain=_this.node.chain,_this.mempool=_this.node.mempool,_this.pool=_this.node.pool,_this.fees=_this.node.fees,_this.miner=_this.node.miner,_this.rpc=_this.node.rpc,_this.init(),_this}return HTTP.prototype.init=function(){var _this2=this;this.on("request",function(req,res){"POST"===req.method&&"/"===req.pathname||_this2.logger.debug("Request for method=%s path=%s (%s).",req.method,req.pathname,req.socket.remoteAddress)}),this.on("listening",function(address){_this2.logger.info("Node HTTP server listening on %s (port=%d).",address.address,address.port)}),this.initRouter(),this.initSockets()},HTTP.prototype.initRouter=function(){var _this3=this;this.use(this.cors()),this.options.noAuth||this.use(this.basicAuth({hash:sha256.digest,password:this.options.apiKey,realm:"node"})),this.use(this.bodyParser({type:"json"})),this.use(this.jsonRPC()),this.use(this.router()),this.error(function(err,req,res){var code=err.statusCode||500;res.json(code,{error:{type:err.type,code:err.code,message:err.message}})}),this.get("/",function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(req,res){var totalTX,size,addr;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:totalTX=_this3.mempool?_this3.mempool.map.size:0,size=_this3.mempool?_this3.mempool.getSize():0,(addr=_this3.pool.hosts.getLocal())||(addr=_this3.pool.hosts.address),res.json(200,{version:pkg.version,network:_this3.network.type,chain:{height:_this3.chain.height,tip:_this3.chain.tip.rhash(),progress:_this3.chain.getProgress()},pool:{host:addr.host,port:addr.port,agent:_this3.pool.options.agent,services:_this3.pool.options.services.toString(2),outbound:_this3.pool.peers.outbound,inbound:_this3.pool.peers.inbound},mempool:{tx:totalTX,size:size},time:{uptime:_this3.node.uptime(),system:util.now(),adjusted:_this3.network.now(),offset:_this3.network.time.offset},memory:_this3.logger.memoryUsage()});case 5:case"end":return _context.stop()}},_callee,_this3)}));return function(_x,_x2){return _ref.apply(this,arguments)}}()),this.get("/coin/address/:address",function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(req,res){var valid,address,coins,result,_iterator,_isArray,_i,_ref3,coin;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return valid=Validator.fromRequest(req),enforce(address=valid.str("address"),"Address is required."),enforce(!_this3.chain.options.spv,"Cannot get coins in SPV mode."),_context2.next=6,_this3.node.getCoinsByAddress(address);case 6:coins=_context2.sent,result=[],_iterator=coins,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();case 9:if(!_isArray){_context2.next=15;break}if(!(_i>=_iterator.length)){_context2.next=12;break}return _context2.abrupt("break",23);case 12:_ref3=_iterator[_i++],_context2.next=19;break;case 15:if(!(_i=_iterator.next()).done){_context2.next=18;break}return _context2.abrupt("break",23);case 18:_ref3=_i.value;case 19:coin=_ref3,result.push(coin.getJSON(_this3.network));case 21:_context2.next=9;break;case 23:res.json(200,result);case 24:case"end":return _context2.stop()}},_callee2,_this3)}));return function(_x3,_x4){return _ref2.apply(this,arguments)}}()),this.get("/coin/:hash/:index",function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(req,res){var valid,hash,index,coin;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return valid=Validator.fromRequest(req),hash=valid.rhash("hash"),index=valid.u32("index"),enforce(hash,"Hash is required."),enforce(null!=index,"Index is required."),enforce(!_this3.chain.options.spv,"Cannot get coins in SPV mode."),_context3.next=8,_this3.node.getCoin(hash,index);case 8:if(coin=_context3.sent){_context3.next=12;break}return res.json(404),_context3.abrupt("return");case 12:res.json(200,coin.getJSON(_this3.network));case 13:case"end":return _context3.stop()}},_callee3,_this3)}));return function(_x5,_x6){return _ref4.apply(this,arguments)}}()),this.post("/coin/address",function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(req,res){var valid,address,coins,result,_iterator2,_isArray2,_i2,_ref6,coin;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return valid=Validator.fromRequest(req),enforce(address=valid.array("addresses"),"Address is required."),enforce(!_this3.chain.options.spv,"Cannot get coins in SPV mode."),_context4.next=6,_this3.node.getCoinsByAddress(address);case 6:coins=_context4.sent,result=[],_iterator2=coins,_isArray2=Array.isArray(_iterator2),_i2=0,_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();case 9:if(!_isArray2){_context4.next=15;break}if(!(_i2>=_iterator2.length)){_context4.next=12;break}return _context4.abrupt("break",23);case 12:_ref6=_iterator2[_i2++],_context4.next=19;break;case 15:if(!(_i2=_iterator2.next()).done){_context4.next=18;break}return _context4.abrupt("break",23);case 18:_ref6=_i2.value;case 19:coin=_ref6,result.push(coin.getJSON(_this3.network));case 21:_context4.next=9;break;case 23:res.json(200,result);case 24:case"end":return _context4.stop()}},_callee4,_this3)}));return function(_x7,_x8){return _ref5.apply(this,arguments)}}()),this.get("/tx/:hash",function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(req,res){var valid,hash,meta,view;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return valid=Validator.fromRequest(req),enforce(hash=valid.rhash("hash"),"Hash is required."),enforce(!_this3.chain.options.spv,"Cannot get TX in SPV mode."),_context5.next=6,_this3.node.getMeta(hash);case 6:if(meta=_context5.sent){_context5.next=10;break}return res.json(404),_context5.abrupt("return");case 10:return _context5.next=12,_this3.node.getMetaView(meta);case 12:view=_context5.sent,res.json(200,meta.getJSON(_this3.network,view,_this3.chain.height));case 14:case"end":return _context5.stop()}},_callee5,_this3)}));return function(_x9,_x10){return _ref7.apply(this,arguments)}}()),this.get("/tx/address/:address",function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(req,res){var valid,address,metas,result,_iterator3,_isArray3,_i3,_ref9,meta,view;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return valid=Validator.fromRequest(req),enforce(address=valid.str("address"),"Address is required."),enforce(!_this3.chain.options.spv,"Cannot get TX in SPV mode."),_context6.next=6,_this3.node.getMetaByAddress(address);case 6:metas=_context6.sent,result=[],_iterator3=metas,_isArray3=Array.isArray(_iterator3),_i3=0,_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();case 9:if(!_isArray3){_context6.next=15;break}if(!(_i3>=_iterator3.length)){_context6.next=12;break}return _context6.abrupt("break",26);case 12:_ref9=_iterator3[_i3++],_context6.next=19;break;case 15:if(!(_i3=_iterator3.next()).done){_context6.next=18;break}return _context6.abrupt("break",26);case 18:_ref9=_i3.value;case 19:return meta=_ref9,_context6.next=22,_this3.node.getMetaView(meta);case 22:view=_context6.sent,result.push(meta.getJSON(_this3.network,view,_this3.chain.height));case 24:_context6.next=9;break;case 26:res.json(200,result);case 27:case"end":return _context6.stop()}},_callee6,_this3)}));return function(_x11,_x12){return _ref8.apply(this,arguments)}}()),this.post("/tx/address",function(){var _ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(req,res){var valid,address,metas,result,_iterator4,_isArray4,_i4,_ref11,meta,view;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return valid=Validator.fromRequest(req),enforce(address=valid.array("addresses"),"Address is required."),enforce(!_this3.chain.options.spv,"Cannot get TX in SPV mode."),_context7.next=6,_this3.node.getMetaByAddress(address);case 6:metas=_context7.sent,result=[],_iterator4=metas,_isArray4=Array.isArray(_iterator4),_i4=0,_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();case 9:if(!_isArray4){_context7.next=15;break}if(!(_i4>=_iterator4.length)){_context7.next=12;break}return _context7.abrupt("break",26);case 12:_ref11=_iterator4[_i4++],_context7.next=19;break;case 15:if(!(_i4=_iterator4.next()).done){_context7.next=18;break}return _context7.abrupt("break",26);case 18:_ref11=_i4.value;case 19:return meta=_ref11,_context7.next=22,_this3.node.getMetaView(meta);case 22:view=_context7.sent,result.push(meta.getJSON(_this3.network,view,_this3.chain.height));case 24:_context7.next=9;break;case 26:res.json(200,result);case 27:case"end":return _context7.stop()}},_callee7,_this3)}));return function(_x13,_x14){return _ref10.apply(this,arguments)}}()),this.get("/block/:block",function(){var _ref12=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(req,res){var valid,hash,block,view,height,depth;return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return valid=Validator.fromRequest(req),enforce(null!=(hash=valid.uintrhash("block")),"Hash or height required."),enforce(!_this3.chain.options.spv,"Cannot get block in SPV mode."),_context8.next=6,_this3.chain.getBlock(hash);case 6:if(block=_context8.sent){_context8.next=10;break}return res.json(404),_context8.abrupt("return");case 10:return _context8.next=12,_this3.chain.getBlockView(block);case 12:if(view=_context8.sent){_context8.next=16;break}return res.json(404),_context8.abrupt("return");case 16:return _context8.next=18,_this3.chain.getHeight(hash);case 18:height=_context8.sent,depth=_this3.chain.height-height+1,res.json(200,block.getJSON(_this3.network,view,height,depth));case 21:case"end":return _context8.stop()}},_callee8,_this3)}));return function(_x15,_x16){return _ref12.apply(this,arguments)}}()),this.get("/mempool",function(){var _ref13=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(req,res){var hashes,result,_iterator5,_isArray5,_i5,_ref14,hash;return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:enforce(_this3.mempool,"No mempool available."),hashes=_this3.mempool.getSnapshot(),result=[],_iterator5=hashes,_isArray5=Array.isArray(_iterator5),_i5=0,_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();case 4:if(!_isArray5){_context9.next=10;break}if(!(_i5>=_iterator5.length)){_context9.next=7;break}return _context9.abrupt("break",18);case 7:_ref14=_iterator5[_i5++],_context9.next=14;break;case 10:if(!(_i5=_iterator5.next()).done){_context9.next=13;break}return _context9.abrupt("break",18);case 13:_ref14=_i5.value;case 14:hash=_ref14,result.push(util.revHex(hash));case 16:_context9.next=4;break;case 18:res.json(200,result);case 19:case"end":return _context9.stop()}},_callee9,_this3)}));return function(_x17,_x18){return _ref13.apply(this,arguments)}}()),this.post("/broadcast",function(){var _ref15=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(req,res){var valid,raw,tx;return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return valid=Validator.fromRequest(req),enforce(raw=valid.buf("tx"),"TX is required."),tx=TX.fromRaw(raw),_context10.next=6,_this3.node.sendTX(tx);case 6:res.json(200,{success:!0});case 7:case"end":return _context10.stop()}},_callee10,_this3)}));return function(_x19,_x20){return _ref15.apply(this,arguments)}}()),this.get("/fee",function(){var _ref16=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(req,res){var valid,blocks,fee;return regeneratorRuntime.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:if(valid=Validator.fromRequest(req),blocks=valid.u32("blocks"),_this3.fees){_context11.next=5;break}return res.json(200,{rate:_this3.network.feeRate}),_context11.abrupt("return");case 5:fee=_this3.fees.estimateFee(blocks),res.json(200,{rate:fee});case 7:case"end":return _context11.stop()}},_callee11,_this3)}));return function(_x21,_x22){return _ref16.apply(this,arguments)}}()),this.post("/reset",function(){var _ref17=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(req,res){var valid,height;return regeneratorRuntime.wrap(function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:return valid=Validator.fromRequest(req),enforce(null!=(height=valid.u32("height")),"Height is required."),_context12.next=5,_this3.chain.reset(height);case 5:res.json(200,{success:!0});case 6:case"end":return _context12.stop()}},_callee12,_this3)}));return function(_x23,_x24){return _ref17.apply(this,arguments)}}())},HTTP.prototype.handleSocket=function(socket){var _this4=this;socket.hook("auth",function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];if(socket.channel("auth"))throw new Error("Already authed.");if(!_this4.options.noAuth){var key=new Validator(args).str(0,"");if(key.length>255)throw new Error("Invalid API key.");var data=Buffer.from(key,"ascii"),hash=sha256.digest(data);if(!ccmp(hash,_this4.options.apiHash))throw new Error("Invalid API key.")}return socket.join("auth"),_this4.logger.info("Successful auth from %s.",socket.host),_this4.handleAuth(socket),null}),socket.fire("version",{version:pkg.version,network:this.network.type})},HTTP.prototype.handleAuth=function(socket){var _this5=this;socket.hook("watch chain",function(){return socket.join("chain"),null}),socket.hook("unwatch chain",function(){return socket.leave("chain"),null}),socket.hook("watch mempool",function(){return socket.join("mempool"),null}),socket.hook("unwatch mempool",function(){return socket.leave("mempool"),null}),socket.hook("set filter",function(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];var data=new Validator(args).buf(0);if(!data)throw new Error("Invalid parameter.");return socket.filter=BloomFilter.fromRaw(data),null}),socket.hook("get tip",function(){return _this5.chain.tip.toRaw()}),socket.hook("get entry",_asyncToGenerator(regeneratorRuntime.mark(function _callee13(){for(var _len3=arguments.length,args=Array(_len3),_key3=0;_key3<_len3;_key3++)args[_key3]=arguments[_key3];var valid,block,entry;return regeneratorRuntime.wrap(function(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:if(valid=new Validator(args),null!=(block=valid.uintrhash(0))){_context13.next=4;break}throw new Error("Invalid parameter.");case 4:return _context13.next=6,_this5.chain.getEntry(block);case 6:if(entry=_context13.sent){_context13.next=9;break}return _context13.abrupt("return",null);case 9:return _context13.next=11,_this5.chain.isMainChain(entry);case 11:if(_context13.sent){_context13.next=13;break}return _context13.abrupt("return",null);case 13:return _context13.abrupt("return",entry.toRaw());case 14:case"end":return _context13.stop()}},_callee13,_this5)}))),socket.hook("get hashes",_asyncToGenerator(regeneratorRuntime.mark(function _callee14(){for(var _len4=arguments.length,args=Array(_len4),_key4=0;_key4<_len4;_key4++)args[_key4]=arguments[_key4];var valid,start,end;return regeneratorRuntime.wrap(function(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:return valid=new Validator(args),start=valid.i32(0,-1),end=valid.i32(1,-1),_context14.abrupt("return",_this5.chain.getHashes(start,end));case 4:case"end":return _context14.stop()}},_callee14,_this5)}))),socket.hook("add filter",function(){for(var _len5=arguments.length,args=Array(_len5),_key5=0;_key5<_len5;_key5++)args[_key5]=arguments[_key5];var chunks=new Validator(args).array(0);if(!chunks)throw new Error("Invalid parameter.");if(!socket.filter)throw new Error("No filter set.");for(var items=new Validator(chunks),i=0;i<chunks.length;i++){var data=items.buf(i);if(!data)throw new Error("Bad data chunk.");socket.filter.add(data),_this5.node.spv&&_this5.pool.watch(data)}return null}),socket.hook("reset filter",function(){return socket.filter=null,null}),socket.hook("estimate fee",function(){for(var _len6=arguments.length,args=Array(_len6),_key6=0;_key6<_len6;_key6++)args[_key6]=arguments[_key6];var blocks=new Validator(args).u32(0);return _this5.fees?_this5.fees.estimateFee(blocks):_this5.network.feeRate}),socket.hook("send",function(){for(var _len7=arguments.length,args=Array(_len7),_key7=0;_key7<_len7;_key7++)args[_key7]=arguments[_key7];var data=new Validator(args).buf(0);if(!data)throw new Error("Invalid parameter.");var tx=TX.fromRaw(data);return _this5.node.relay(tx),null}),socket.hook("rescan",function(){for(var _len8=arguments.length,args=Array(_len8),_key8=0;_key8<_len8;_key8++)args[_key8]=arguments[_key8];var start=new Validator(args).uintrhash(0);if(null==start)throw new Error("Invalid parameter.");return _this5.scan(socket,start)})},HTTP.prototype.initSockets=function(){var _this6=this,pool=this.mempool||this.pool;this.chain.on("connect",function(entry,block,view){var sockets=_this6.channel("chain");if(sockets){var raw=entry.toRaw();_this6.to("chain","chain connect",raw);var _iterator6=sockets,_isArray6=Array.isArray(_iterator6),_i6=0;for(_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();;){var _ref20;if(_isArray6){if(_i6>=_iterator6.length)break;_ref20=_iterator6[_i6++]}else{if((_i6=_iterator6.next()).done)break;_ref20=_i6.value}var socket=_ref20,txs=_this6.filterBlock(socket,block);socket.fire("block connect",raw,txs)}}}),this.chain.on("disconnect",function(entry,block,view){if(_this6.channel("chain")){var raw=entry.toRaw();_this6.to("chain","chain disconnect",raw),_this6.to("chain","block disconnect",raw)}}),this.chain.on("reset",function(tip){_this6.channel("chain")&&_this6.to("chain","chain reset",tip.toRaw())}),pool.on("tx",function(tx){var sockets=_this6.channel("mempool");if(sockets){var raw=tx.toRaw(),_iterator7=sockets,_isArray7=Array.isArray(_iterator7),_i7=0;for(_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();;){var _ref21;if(_isArray7){if(_i7>=_iterator7.length)break;_ref21=_iterator7[_i7++]}else{if((_i7=_iterator7.next()).done)break;_ref21=_i7.value}var socket=_ref21;_this6.filterTX(socket,tx)&&socket.fire("tx",raw)}}})},HTTP.prototype.filterBlock=function(socket,block){if(!socket.filter)return[];var txs=[],_iterator8=block.txs,_isArray8=Array.isArray(_iterator8),_i8=0;for(_iterator8=_isArray8?_iterator8:_iterator8[Symbol.iterator]();;){var _ref22;if(_isArray8){if(_i8>=_iterator8.length)break;_ref22=_iterator8[_i8++]}else{if((_i8=_iterator8.next()).done)break;_ref22=_i8.value}var tx=_ref22;this.filterTX(socket,tx)&&txs.push(tx.toRaw())}return txs},HTTP.prototype.filterTX=function(socket,tx){if(!socket.filter)return!1;for(var found=!1,i=0;i<tx.outputs.length;i++){var hash=tx.outputs[i].getHash();if(hash&&socket.filter.test(hash)){var prevout=Outpoint.fromTX(tx,i);socket.filter.add(prevout.toRaw()),found=!0}}if(found)return!0;if(!tx.isCoinbase()){var _iterator9=tx.inputs,_isArray9=Array.isArray(_iterator9),_i9=0;for(_iterator9=_isArray9?_iterator9:_iterator9[Symbol.iterator]();;){var _ref24;if(_isArray9){if(_i9>=_iterator9.length)break;_ref24=_iterator9[_i9++]}else{if((_i9=_iterator9.next()).done)break;_ref24=_i9.value}var _prevout=_ref24.prevout;if(socket.filter.test(_prevout.toRaw()))return!0}}return!1},HTTP.prototype.scan=function(){var _ref25=_asyncToGenerator(regeneratorRuntime.mark(function _callee15(socket,start){return regeneratorRuntime.wrap(function(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:return _context15.next=2,this.node.scan(start,socket.filter,function(entry,txs){var block=entry.toRaw(),raw=[],_iterator10=txs,_isArray10=Array.isArray(_iterator10),_i10=0;for(_iterator10=_isArray10?_iterator10:_iterator10[Symbol.iterator]();;){var _ref26;if(_isArray10){if(_i10>=_iterator10.length)break;_ref26=_iterator10[_i10++]}else{if((_i10=_iterator10.next()).done)break;_ref26=_i10.value}var tx=_ref26;raw.push(tx.toRaw())}return socket.call("block rescan",block,raw)});case 2:return _context15.abrupt("return",null);case 3:case"end":return _context15.stop()}},_callee15,this)}));return function(_x25,_x26){return _ref25.apply(this,arguments)}}(),HTTP}(Server),HTTPOptions=function(){function HTTPOptions(options){_classCallCheck(this,HTTPOptions),this.network=Network.primary,this.logger=null,this.node=null,this.apiKey=base58.encode(random.randomBytes(20)),this.apiHash=sha256.digest(Buffer.from(this.apiKey,"ascii")),this.noAuth=!1,this.prefix=null,this.host="127.0.0.1",this.port=8080,this.ssl=!1,this.keyFile=null,this.certFile=null,this.fromOptions(options)}return HTTPOptions.prototype.fromOptions=function(options){return assert(options),assert(options.node&&"object"===_typeof(options.node),"HTTP Server requires a Node."),this.node=options.node,this.network=options.node.network,this.logger=options.node.logger,this.port=this.network.rpcPort,null!=options.logger&&(assert("object"===_typeof(options.logger)),this.logger=options.logger),null!=options.apiKey&&(assert("string"==typeof options.apiKey,"API key must be a string."),assert(options.apiKey.length<=255,"API key must be under 256 bytes."),this.apiKey=options.apiKey,this.apiHash=sha256.digest(Buffer.from(this.apiKey,"ascii"))),null!=options.noAuth&&(assert("boolean"==typeof options.noAuth),this.noAuth=options.noAuth),null!=options.prefix&&(assert("string"==typeof options.prefix),this.prefix=options.prefix,this.keyFile=path.join(this.prefix,"key.pem"),this.certFile=path.join(this.prefix,"cert.pem")),null!=options.host&&(assert("string"==typeof options.host),this.host=options.host),null!=options.port&&(assert((65535&options.port)===options.port,"Port must be a number."),this.port=options.port),null!=options.ssl&&(assert("boolean"==typeof options.ssl),this.ssl=options.ssl),null!=options.keyFile&&(assert("string"==typeof options.keyFile),this.keyFile=options.keyFile),null!=options.certFile&&(assert("string"==typeof options.certFile),this.certFile=options.certFile),options.apiKey||"127.0.0.1"!==this.host&&"::1"!==this.host||(this.noAuth=!0),this},HTTPOptions.fromOptions=function(options){return(new HTTPOptions).fromOptions(options)},HTTPOptions}();function enforce(value,msg){if(!value){var err=new Error(msg);throw err.statusCode=400,err}}module.exports=HTTP}).call(this,require("buffer").Buffer)},{"../pkg":67,"../primitives/outpoint":80,"../primitives/tx":82,"../protocol/network":87,"../utils/util":106,assert:146,"bcrypto/lib/ccmp":156,"bcrypto/lib/random":180,"bcrypto/lib/sha256":186,bfilter:203,bstring:265,buffer:269,bval:280,bweb:282,path:367}],63:[function(require,module,exports){"use strict";exports.FullNode=require("./fullnode"),exports.HTTP=require("./http"),exports.Node=require("./node"),exports.RPC=require("./rpc"),exports.SPVNode=require("./spvnode")},{"./fullnode":61,"./http":62,"./node":64,"./rpc":65,"./spvnode":66}],64:[function(require,module,exports){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}var assert=require("assert"),EventEmitter=require("events"),fs=require("bfile"),Logger=require("blgr"),Config=require("bcfg"),Network=require("../protocol/network"),WorkerPool=require("../workers/workerpool"),Node=function(_EventEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Node,_EventEmitter);function Node(module,config,file,options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Node);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return _this.config=new Config(module,{suffix:"network",fallback:"main",alias:{n:"network"}}),_this.config.inject(options),_this.config.load(options),options.config&&_this.config.open(config),_this.network=Network.get(_this.config.getSuffix()),_this.memory=_this.config.bool("memory",!0),_this.startTime=-1,_this.bound=[],_this.plugins=Object.create(null),_this.stack=[],_this.logger=null,_this.workers=null,_this.spv=!1,_this.chain=null,_this.fees=null,_this.mempool=null,_this.pool=null,_this.miner=null,_this.http=null,_this._init(file),_this}return Node.prototype._init=function(file){var _this2=this,config=this.config,logger=new Logger;config.has("logger")&&(logger=config.obj("logger")),logger.set({filename:!this.memory&&config.bool("log-file")?config.location(file):null,level:config.str("log-level"),console:config.bool("log-console"),shrink:config.bool("log-shrink")}),this.logger=logger.context("node"),this.workers=new WorkerPool({enabled:config.bool("workers"),size:config.uint("workers-size"),timeout:config.uint("workers-timeout"),file:config.str("worker-file")}),this.on("error",function(){}),this.workers.on("spawn",function(child){_this2.logger.info("Spawning worker process: %d.",child.id)}),this.workers.on("exit",function(code,child){_this2.logger.warning("Worker %d exited: %s.",child.id,code)}),this.workers.on("log",function(text,child){_this2.logger.debug("Worker %d says:",child.id),_this2.logger.debug(text)}),this.workers.on("error",function(err,child){child?_this2.logger.error("Worker %d error: %s",child.id,err.message):_this2.emit("error",err)})},Node.prototype.ensure=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!fs.unsupported){_context.next=2;break}return _context.abrupt("return",void 0);case 2:if(!this.memory){_context.next=4;break}return _context.abrupt("return",void 0);case 4:return _context.abrupt("return",fs.mkdirp(this.config.prefix));case 5:case"end":return _context.stop()}},_callee,this)}));return function(){return _ref.apply(this,arguments)}}(),Node.prototype.location=function(name){return this.config.location(name)},Node.prototype.handlePreopen=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var _this3=this;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,this.logger.open();case 2:return _context2.next=4,this.workers.open();case 4:this._bind(this.network.time,"offset",function(offset){_this3.logger.info("Time offset: %d (%d minutes).",offset,offset/60|0)}),this._bind(this.network.time,"sample",function(sample,total){_this3.logger.debug("Added time data: samples=%d, offset=%d (%d minutes).",total,sample,sample/60|0)}),this._bind(this.network.time,"mismatch",function(){_this3.logger.warning("Adjusted time mismatch!"),_this3.logger.warning("Please make sure your system clock is correct!")});case 7:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref2.apply(this,arguments)}}(),Node.prototype.handleOpen=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:this.startTime=Date.now(),this.workers.enabled||(this.logger.warning("Warning: worker pool is disabled."),this.logger.warning("Verification will be slow."));case 2:case"end":return _context3.stop()}},_callee3,this)}));return function(){return _ref3.apply(this,arguments)}}(),Node.prototype.handlePreclose=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:case 1:case"end":return _context4.stop()}},_callee4,this)}));return function(){return _ref4.apply(this,arguments)}}(),Node.prototype.handleClose=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){var _iterator,_isArray,_i,_ref7,_ref6,obj,event,listener;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:_iterator=this.bound,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();case 1:if(!_isArray){_context5.next=7;break}if(!(_i>=_iterator.length)){_context5.next=4;break}return _context5.abrupt("break",18);case 4:_ref7=_iterator[_i++],_context5.next=11;break;case 7:if(!(_i=_iterator.next()).done){_context5.next=10;break}return _context5.abrupt("break",18);case 10:_ref7=_i.value;case 11:obj=(_ref6=_ref7)[0],event=_ref6[1],listener=_ref6[2],obj.removeListener(event,listener);case 16:_context5.next=1;break;case 18:return this.bound.length=0,this.startTime=-1,_context5.next=22,this.workers.close();case 22:return _context5.next=24,this.logger.close();case 24:case"end":return _context5.stop()}},_callee5,this)}));return function(){return _ref5.apply(this,arguments)}}(),Node.prototype._bind=function(obj,event,listener){this.bound.push([obj,event,listener]),obj.on(event,listener)},Node.prototype.error=function(err){this.logger.error(err),this.emit("error",err)},Node.prototype.uptime=function(){return-1===this.startTime?0:Math.floor((Date.now()-this.startTime)/1e3)},Node.prototype.use=function(plugin){var _this4=this;assert(plugin,"Plugin must be an object."),assert("function"==typeof plugin.init,"`init` must be a function."),assert(!this.loaded,"Cannot add plugin after node is loaded.");var instance=plugin.init(this);if(assert(!instance.open||"function"==typeof instance.open,"`open` must be a function."),assert(!instance.close||"function"==typeof instance.close,"`close` must be a function."),plugin.id){switch(assert("string"==typeof plugin.id,"`id` must be a string."),plugin.id){case"chain":case"fees":case"mempool":case"miner":case"pool":case"rpc":case"http":assert(!1,plugin.id+" is already added.")}assert(!this.plugins[plugin.id],plugin.id+" is already added."),this.plugins[plugin.id]=instance}return this.stack.push(instance),"function"==typeof instance.on&&instance.on("error",function(err){return _this4.error(err)}),instance},Node.prototype.has=function(name){return null!=this.plugins[name]},Node.prototype.get=function(name){switch(assert("string"==typeof name,"Plugin name must be a string."),name){case"chain":return assert(this.chain,"chain is not loaded."),this.chain;case"fees":return assert(this.fees,"fees is not loaded."),this.fees;case"mempool":return assert(this.mempool,"mempool is not loaded."),this.mempool;case"miner":return assert(this.miner,"miner is not loaded."),this.miner;case"pool":return assert(this.pool,"pool is not loaded."),this.pool;case"rpc":return assert(this.rpc,"rpc is not loaded."),this.rpc;case"http":return assert(this.http,"http is not loaded."),this.http}return this.plugins[name]||null},Node.prototype.require=function(name){var plugin=this.get(name);return assert(plugin,name+" is not loaded."),plugin},Node.prototype.loadPlugins=function(){var plugins=this.config.array("plugins",[]),loader=this.config.func("loader"),_iterator2=plugins,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref8;if(_isArray2){if(_i2>=_iterator2.length)break;_ref8=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref8=_i2.value}var plugin=_ref8;"string"==typeof plugin&&(assert(loader,"Must pass a loader function."),plugin=loader(plugin)),this.use(plugin)}},Node.prototype.openPlugins=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(){var _iterator3,_isArray3,_i3,_ref10,plugin;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:_iterator3=this.stack,_isArray3=Array.isArray(_iterator3),_i3=0,_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();case 1:if(!_isArray3){_context6.next=7;break}if(!(_i3>=_iterator3.length)){_context6.next=4;break}return _context6.abrupt("break",17);case 4:_ref10=_iterator3[_i3++],_context6.next=11;break;case 7:if(!(_i3=_iterator3.next()).done){_context6.next=10;break}return _context6.abrupt("break",17);case 10:_ref10=_i3.value;case 11:if(!(plugin=_ref10).open){_context6.next=15;break}return _context6.next=15,plugin.open();case 15:_context6.next=1;break;case 17:case"end":return _context6.stop()}},_callee6,this)}));return function(){return _ref9.apply(this,arguments)}}(),Node.prototype.closePlugins=function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(){var _iterator4,_isArray4,_i4,_ref12,plugin;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:_iterator4=this.stack,_isArray4=Array.isArray(_iterator4),_i4=0,_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();case 1:if(!_isArray4){_context7.next=7;break}if(!(_i4>=_iterator4.length)){_context7.next=4;break}return _context7.abrupt("break",17);case 4:_ref12=_iterator4[_i4++],_context7.next=11;break;case 7:if(!(_i4=_iterator4.next()).done){_context7.next=10;break}return _context7.abrupt("break",17);case 10:_ref12=_i4.value;case 11:if(!(plugin=_ref12).close){_context7.next=15;break}return _context7.next=15,plugin.close();case 15:_context7.next=1;break;case 17:case"end":return _context7.stop()}},_callee7,this)}));return function(){return _ref11.apply(this,arguments)}}(),Node}(EventEmitter);module.exports=Node},{"../protocol/network":87,"../workers/workerpool":131,assert:146,bcfg:148,bfile:201,blgr:211,events:334}],65:[function(require,module,exports){(function(Buffer){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}var assert=require("assert"),bweb=require("bweb"),Lock=require("bmutex").Lock,IP=require("binet"),Validator=require("bval"),hash160=require("bcrypto/lib/hash160"),hash256=require("bcrypto/lib/hash256"),ccmp=require("bcrypto/lib/ccmp"),secp256k1=require("bcrypto/lib/secp256k1"),util=require("../utils/util"),common=require("../blockchain/common"),Amount=require("../btc/amount"),NetAddress=require("../net/netaddress"),Script=require("../script/script"),Address=require("../primitives/address"),Block=require("../primitives/block"),Headers=require("../primitives/headers"),Input=require("../primitives/input"),KeyRing=require("../primitives/keyring"),MerkleBlock=require("../primitives/merkleblock"),MTX=require("../primitives/mtx"),Network=require("../protocol/network"),Outpoint=require("../primitives/outpoint"),Output=require("../primitives/output"),TX=require("../primitives/tx"),consensus=require("../protocol/consensus"),pkg=require("../pkg"),RPCBase=bweb.RPC,RPCError=bweb.RPCError,errs={INVALID_REQUEST:bweb.errors.INVALID_REQUEST,METHOD_NOT_FOUND:bweb.errors.METHOD_NOT_FOUND,INVALID_PARAMS:bweb.errors.INVALID_PARAMS,INTERNAL_ERROR:bweb.errors.INTERNAL_ERROR,PARSE_ERROR:bweb.errors.PARSE_ERROR,MISC_ERROR:-1,FORBIDDEN_BY_SAFE_MODE:-2,TYPE_ERROR:-3,INVALID_ADDRESS_OR_KEY:-5,OUT_OF_MEMORY:-7,INVALID_PARAMETER:-8,DATABASE_ERROR:-20,DESERIALIZATION_ERROR:-22,VERIFY_ERROR:-25,VERIFY_REJECTED:-26,VERIFY_ALREADY_IN_CHAIN:-27,IN_WARMUP:-28,CLIENT_NOT_CONNECTED:-9,CLIENT_IN_INITIAL_DOWNLOAD:-10,CLIENT_NODE_ALREADY_ADDED:-23,CLIENT_NODE_NOT_ADDED:-24,CLIENT_NODE_NOT_CONNECTED:-29,CLIENT_INVALID_IP_OR_SUBNET:-30,CLIENT_P2P_DISABLED:-31},RPC=function(_RPCBase){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(RPC,_RPCBase);function RPC(node){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,RPC);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_RPCBase.call(this));return assert(node,"RPC requires a Node."),_this.node=node,_this.network=node.network,_this.workers=node.workers,_this.chain=node.chain,_this.mempool=node.mempool,_this.pool=node.pool,_this.fees=node.fees,_this.miner=node.miner,_this.logger=node.logger.context("rpc"),_this.locker=new Lock,_this.mining=!1,_this.procLimit=0,_this.attempt=null,_this.lastActivity=0,_this.boundChain=!1,_this.nonce1=0,_this.nonce2=0,_this.merkleMap=new Map,_this.pollers=[],_this.init(),_this}return RPC.prototype.getCode=function(err){switch(err.type){case"RPCError":return err.code;case"ValidationError":return errs.TYPE_ERROR;case"EncodingError":return errs.DESERIALIZATION_ERROR;default:return errs.INTERNAL_ERROR}},RPC.prototype.handleCall=function(cmd,query){"getwork"!==cmd.method&&"getblocktemplate"!==cmd.method&&"getbestblockhash"!==cmd.method&&(this.logger.debug("Handling RPC call: %s.",cmd.method),"submitblock"!==cmd.method&&"getmemorypool"!==cmd.method&&this.logger.debug(cmd.params)),"getwork"===cmd.method&&query.longpoll&&(cmd.method="getworklp")},RPC.prototype.handleError=function(err){this.logger.error("RPC internal error."),this.logger.error(err)},RPC.prototype.init=function(){this.add("stop",this.stop),this.add("help",this.help),this.add("getblockchaininfo",this.getBlockchainInfo),this.add("getbestblockhash",this.getBestBlockHash),this.add("getblockcount",this.getBlockCount),this.add("getblock",this.getBlock),this.add("getblockbyheight",this.getBlockByHeight),this.add("getblockhash",this.getBlockHash),this.add("getblockheader",this.getBlockHeader),this.add("getchaintips",this.getChainTips),this.add("getdifficulty",this.getDifficulty),this.add("getmempoolancestors",this.getMempoolAncestors),this.add("getmempooldescendants",this.getMempoolDescendants),this.add("getmempoolentry",this.getMempoolEntry),this.add("getmempoolinfo",this.getMempoolInfo),this.add("getrawmempool",this.getRawMempool),this.add("gettxout",this.getTXOut),this.add("gettxoutsetinfo",this.getTXOutSetInfo),this.add("pruneblockchain",this.pruneBlockchain),this.add("verifychain",this.verifyChain),this.add("invalidateblock",this.invalidateBlock),this.add("reconsiderblock",this.reconsiderBlock),this.add("getnetworkhashps",this.getNetworkHashPS),this.add("getmininginfo",this.getMiningInfo),this.add("prioritisetransaction",this.prioritiseTransaction),this.add("getwork",this.getWork),this.add("getworklp",this.getWorkLongpoll),this.add("getblocktemplate",this.getBlockTemplate),this.add("submitblock",this.submitBlock),this.add("verifyblock",this.verifyBlock),this.add("setgenerate",this.setGenerate),this.add("getgenerate",this.getGenerate),this.add("generate",this.generate),this.add("generatetoaddress",this.generateToAddress),this.add("estimatefee",this.estimateFee),this.add("estimatepriority",this.estimatePriority),this.add("estimatesmartfee",this.estimateSmartFee),this.add("estimatesmartpriority",this.estimateSmartPriority),this.add("getinfo",this.getInfo),this.add("validateaddress",this.validateAddress),this.add("createmultisig",this.createMultisig),this.add("createwitnessaddress",this.createWitnessAddress),this.add("verifymessage",this.verifyMessage),this.add("signmessagewithprivkey",this.signMessageWithPrivkey),this.add("setmocktime",this.setMockTime),this.add("getconnectioncount",this.getConnectionCount),this.add("ping",this.ping),this.add("getpeerinfo",this.getPeerInfo),this.add("addnode",this.addNode),this.add("disconnectnode",this.disconnectNode),this.add("getaddednodeinfo",this.getAddedNodeInfo),this.add("getnettotals",this.getNetTotals),this.add("getnetworkinfo",this.getNetworkInfo),this.add("setban",this.setBan),this.add("listbanned",this.listBanned),this.add("clearbanned",this.clearBanned),this.add("getrawtransaction",this.getRawTransaction),this.add("createrawtransaction",this.createRawTransaction),this.add("decoderawtransaction",this.decodeRawTransaction),this.add("decodescript",this.decodeScript),this.add("sendrawtransaction",this.sendRawTransaction),this.add("signrawtransaction",this.signRawTransaction),this.add("gettxoutproof",this.getTXOutProof),this.add("verifytxoutproof",this.verifyTXOutProof),this.add("getmemoryinfo",this.getMemoryInfo),this.add("setloglevel",this.setLogLevel)},RPC.prototype.getInfo=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(args,help){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!help&&0===args.length){_context.next=2;break}throw new RPCError(errs.MISC_ERROR,"getinfo");case 2:return _context.abrupt("return",{version:pkg.version,protocolversion:this.pool.options.version,walletversion:0,balance:0,blocks:this.chain.height,timeoffset:this.network.time.offset,connections:this.pool.peers.size(),proxy:"",difficulty:toDifficulty(this.chain.tip.bits),testnet:this.network!==Network.main,keypoololdest:0,keypoolsize:0,unlocked_until:0,paytxfee:Amount.btc(this.network.feeRate,!0),relayfee:Amount.btc(this.network.minRelay,!0),errors:""});case 3:case"end":return _context.stop()}},_callee,this)}));return function(_x,_x2){return _ref.apply(this,arguments)}}(),RPC.prototype.help=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(args,_help){var json;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(0!==args.length){_context2.next=2;break}return _context2.abrupt("return","Select a command.");case 2:return json={method:args[0],params:[]},_context2.next=5,this.execute(json,!0);case 5:return _context2.abrupt("return",_context2.sent);case 6:case"end":return _context2.stop()}},_callee2,this)}));return function(_x3,_x4){return _ref2.apply(this,arguments)}}(),RPC.prototype.stop=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(args,help){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(!help&&0===args.length){_context3.next=2;break}throw new RPCError(errs.MISC_ERROR,"stop");case 2:return this.node.close().catch(function(err){setImmediate(function(){throw err})}),_context3.abrupt("return","Stopping.");case 4:case"end":return _context3.stop()}},_callee3,this)}));return function(_x5,_x6){return _ref3.apply(this,arguments)}}(),RPC.prototype.getNetworkInfo=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(args,help){var hosts,locals,_iterator,_isArray,_i,_ref5,local;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(!help&&0===args.length){_context4.next=2;break}throw new RPCError(errs.MISC_ERROR,"getnetworkinfo");case 2:hosts=this.pool.hosts,locals=[],_iterator=hosts.local.values(),_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();case 5:if(!_isArray){_context4.next=11;break}if(!(_i>=_iterator.length)){_context4.next=8;break}return _context4.abrupt("break",19);case 8:_ref5=_iterator[_i++],_context4.next=15;break;case 11:if(!(_i=_iterator.next()).done){_context4.next=14;break}return _context4.abrupt("break",19);case 14:_ref5=_i.value;case 15:local=_ref5,locals.push({address:local.addr.host,port:local.addr.port,score:local.score});case 17:_context4.next=5;break;case 19:return _context4.abrupt("return",{version:pkg.version,subversion:this.pool.options.agent,protocolversion:this.pool.options.version,localservices:hex32(this.pool.options.services),localrelay:!this.pool.options.noRelay,timeoffset:this.network.time.offset,networkactive:this.pool.connected,connections:this.pool.peers.size(),networks:[],relayfee:Amount.btc(this.network.minRelay,!0),incrementalfee:0,localaddresses:locals,warnings:""});case 20:case"end":return _context4.stop()}},_callee4,this)}));return function(_x7,_x8){return _ref4.apply(this,arguments)}}(),RPC.prototype.addNode=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(args,help){var valid,node,cmd,addr,peer;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(!help&&2===args.length){_context5.next=2;break}throw new RPCError(errs.MISC_ERROR,'addnode "node" "add|remove|onetry"');case 2:valid=new Validator(args),node=valid.str(0,""),cmd=valid.str(1,""),_context5.t0=cmd,_context5.next="add"===_context5.t0?8:"onetry"===_context5.t0?10:"remove"===_context5.t0?13:15;break;case 8:this.pool.hosts.addNode(node);case 10:return addr=parseNetAddress(node,this.network),this.pool.peers.get(addr.hostname)||(peer=this.pool.createOutbound(addr),this.pool.peers.add(peer)),_context5.abrupt("break",15);case 13:return this.pool.hosts.removeNode(node),_context5.abrupt("break",15);case 15:return _context5.abrupt("return",null);case 16:case"end":return _context5.stop()}},_callee5,this)}));return function(_x9,_x10){return _ref6.apply(this,arguments)}}(),RPC.prototype.disconnectNode=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(args,help){var valid,str,addr,peer;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(!help&&1===args.length){_context6.next=2;break}throw new RPCError(errs.MISC_ERROR,'disconnectnode "node"');case 2:return valid=new Validator(args),str=valid.str(0,""),addr=parseIP(str,this.network),(peer=this.pool.peers.get(addr.hostname))&&peer.destroy(),_context6.abrupt("return",null);case 8:case"end":return _context6.stop()}},_callee6,this)}));return function(_x11,_x12){return _ref7.apply(this,arguments)}}(),RPC.prototype.getAddedNodeInfo=function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(args,help){var hosts,valid,addr,target,result,_iterator2,_isArray2,_i2,_ref9,node,peer;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(!(help||args.length>1)){_context7.next=2;break}throw new RPCError(errs.MISC_ERROR,'getaddednodeinfo ( "node" )');case 2:hosts=this.pool.hosts,valid=new Validator(args),addr=valid.str(0,""),target=void 0,1===args.length&&(target=parseIP(addr,this.network)),result=[],_iterator2=hosts.nodes,_isArray2=Array.isArray(_iterator2),_i2=0,_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();case 9:if(!_isArray2){_context7.next=15;break}if(!(_i2>=_iterator2.length)){_context7.next=12;break}return _context7.abrupt("break",32);case 12:_ref9=_iterator2[_i2++],_context7.next=19;break;case 15:if(!(_i2=_iterator2.next()).done){_context7.next=18;break}return _context7.abrupt("break",32);case 18:_ref9=_i2.value;case 19:if(node=_ref9,!target){_context7.next=25;break}if(node.host===target.host){_context7.next=23;break}return _context7.abrupt("continue",30);case 23:if(node.port===target.port){_context7.next=25;break}return _context7.abrupt("continue",30);case 25:if((peer=this.pool.peers.get(node.hostname))&&peer.connected){_context7.next=29;break}return result.push({addednode:node.hostname,connected:!1,addresses:[]}),_context7.abrupt("continue",30);case 29:result.push({addednode:node.hostname,connected:peer.connected,addresses:[{address:peer.hostname(),connected:peer.outbound?"outbound":"inbound"}]});case 30:_context7.next=9;break;case 32:if(!target||0!==result.length){_context7.next=34;break}throw new RPCError(errs.CLIENT_NODE_NOT_ADDED,"Node has not been added.");case 34:return _context7.abrupt("return",result);case 35:case"end":return _context7.stop()}},_callee7,this)}));return function(_x13,_x14){return _ref8.apply(this,arguments)}}(),RPC.prototype.getConnectionCount=function(){var _ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(args,help){return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(!help&&0===args.length){_context8.next=2;break}throw new RPCError(errs.MISC_ERROR,"getconnectioncount");case 2:return _context8.abrupt("return",this.pool.peers.size());case 3:case"end":return _context8.stop()}},_callee8,this)}));return function(_x15,_x16){return _ref10.apply(this,arguments)}}(),RPC.prototype.getNetTotals=function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(args,help){var sent,recv,peer;return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:if(sent=0,recv=0,!(help||args.length>0)){_context9.next=4;break}throw new RPCError(errs.MISC_ERROR,"getnettotals");case 4:for(peer=this.pool.peers.head();peer;peer=peer.next)sent+=peer.socket.bytesWritten,recv+=peer.socket.bytesRead;return _context9.abrupt("return",{totalbytesrecv:recv,totalbytessent:sent,timemillis:Date.now()});case 6:case"end":return _context9.stop()}},_callee9,this)}));return function(_x17,_x18){return _ref11.apply(this,arguments)}}(),RPC.prototype.getPeerInfo=function(){var _ref12=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(args,help){var peers,peer,offset,hashes,hash,str;return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:if(!help&&0===args.length){_context10.next=2;break}throw new RPCError(errs.MISC_ERROR,"getpeerinfo");case 2:for(peers=[],peer=this.pool.peers.head();peer;peer=peer.next){offset=this.network.time.known.get(peer.hostname())||0,hashes=[];for(hash in peer.blockMap.keys())str=util.revHex(hash),hashes.push(str);peer.getName(),peers.push({id:peer.id,addr:peer.hostname(),addrlocal:peer.local.isNull()?void 0:peer.local.hostname,name:peer.name||void 0,services:hex32(peer.services),relaytxes:!peer.noRelay,lastsend:peer.lastSend/1e3|0,lastrecv:peer.lastRecv/1e3|0,bytessent:peer.socket.bytesWritten,bytesrecv:peer.socket.bytesRead,conntime:0!==peer.time?(Date.now()-peer.time)/1e3|0:0,timeoffset:offset,pingtime:-1!==peer.lastPong?(peer.lastPong-peer.lastPing)/1e3:-1,minping:-1!==peer.minPing?peer.minPing/1e3:-1,version:peer.version,subver:peer.agent,inbound:!peer.outbound,startingheight:peer.height,besthash:peer.bestHash?util.revHex(peer.bestHash):null,bestheight:peer.bestHeight,banscore:peer.banScore,inflight:hashes,whitelisted:!1})}return _context10.abrupt("return",peers);case 5:case"end":return _context10.stop()}},_callee10,this)}));return function(_x19,_x20){return _ref12.apply(this,arguments)}}(),RPC.prototype.ping=function(){var _ref13=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(args,help){var peer;return regeneratorRuntime.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:if(!help&&0===args.length){_context11.next=2;break}throw new RPCError(errs.MISC_ERROR,"ping");case 2:for(peer=this.pool.peers.head();peer;peer=peer.next)peer.sendPing();return _context11.abrupt("return",null);case 4:case"end":return _context11.stop()}},_callee11,this)}));return function(_x21,_x22){return _ref13.apply(this,arguments)}}(),RPC.prototype.setBan=function(){var _ref14=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(args,help){var valid,str,action,addr;return regeneratorRuntime.wrap(function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:if(valid=new Validator(args),str=valid.str(0,""),action=valid.str(1,""),!(help||args.length<2||"add"!==action&&"remove"!==action)){_context12.next=5;break}throw new RPCError(errs.MISC_ERROR,'setban "ip(/netmask)" "add|remove" (bantime) (absolute)');case 5:addr=parseNetAddress(str,this.network),_context12.t0=action,_context12.next="add"===_context12.t0?9:"remove"===_context12.t0?11:13;break;case 9:return this.pool.ban(addr),_context12.abrupt("break",13);case 11:return this.pool.unban(addr),_context12.abrupt("break",13);case 13:return _context12.abrupt("return",null);case 14:case"end":return _context12.stop()}},_callee12,this)}));return function(_x23,_x24){return _ref14.apply(this,arguments)}}(),RPC.prototype.listBanned=function(){var _ref15=_asyncToGenerator(regeneratorRuntime.mark(function _callee13(args,help){var banned,_iterator3,_isArray3,_i3,_ref17,_ref16,host,time;return regeneratorRuntime.wrap(function(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:if(!help&&0===args.length){_context13.next=2;break}throw new RPCError(errs.MISC_ERROR,"listbanned");case 2:banned=[],_iterator3=this.pool.hosts.banned,_isArray3=Array.isArray(_iterator3),_i3=0,_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();case 4:if(!_isArray3){_context13.next=10;break}if(!(_i3>=_iterator3.length)){_context13.next=7;break}return _context13.abrupt("break",20);case 7:_ref17=_iterator3[_i3++],_context13.next=14;break;case 10:if(!(_i3=_iterator3.next()).done){_context13.next=13;break}return _context13.abrupt("break",20);case 13:_ref17=_i3.value;case 14:host=(_ref16=_ref17)[0],time=_ref16[1],banned.push({address:host,banned_until:time+this.pool.options.banTime,ban_created:time,ban_reason:""});case 18:_context13.next=4;break;case 20:return _context13.abrupt("return",banned);case 21:case"end":return _context13.stop()}},_callee13,this)}));return function(_x25,_x26){return _ref15.apply(this,arguments)}}(),RPC.prototype.clearBanned=function(){var _ref18=_asyncToGenerator(regeneratorRuntime.mark(function _callee14(args,help){return regeneratorRuntime.wrap(function(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:if(!help&&0===args.length){_context14.next=2;break}throw new RPCError(errs.MISC_ERROR,"clearbanned");case 2:return this.pool.hosts.clearBanned(),_context14.abrupt("return",null);case 4:case"end":return _context14.stop()}},_callee14,this)}));return function(_x27,_x28){return _ref18.apply(this,arguments)}}(),RPC.prototype.getBlockchainInfo=function(){var _ref19=_asyncToGenerator(regeneratorRuntime.mark(function _callee15(args,help){return regeneratorRuntime.wrap(function(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:if(!help&&0===args.length){_context15.next=2;break}throw new RPCError(errs.MISC_ERROR,"getblockchaininfo");case 2:return _context15.t0="testnet"!==this.network.type?this.network.type:"test",_context15.t1=this.chain.height,_context15.t2=this.chain.height,_context15.t3=this.chain.tip.rhash(),_context15.t4=toDifficulty(this.chain.tip.bits),_context15.next=9,this.chain.getMedianTime(this.chain.tip);case 9:return _context15.t5=_context15.sent,_context15.t6=this.chain.getProgress(),_context15.t7=this.chain.tip.chainwork.toString("hex",64),_context15.t8=this.chain.options.prune,_context15.t9=this.getSoftforks(),_context15.next=16,this.getBIP9Softforks();case 16:return _context15.t10=_context15.sent,_context15.t11=this.chain.options.prune?Math.max(0,this.chain.height-this.network.block.keepBlocks):null,_context15.abrupt("return",{chain:_context15.t0,blocks:_context15.t1,headers:_context15.t2,bestblockhash:_context15.t3,difficulty:_context15.t4,mediantime:_context15.t5,verificationprogress:_context15.t6,chainwork:_context15.t7,pruned:_context15.t8,softforks:_context15.t9,bip9_softforks:_context15.t10,pruneheight:_context15.t11});case 19:case"end":return _context15.stop()}},_callee15,this)}));return function(_x29,_x30){return _ref19.apply(this,arguments)}}(),RPC.prototype.getBestBlockHash=function(){var _ref20=_asyncToGenerator(regeneratorRuntime.mark(function _callee16(args,help){return regeneratorRuntime.wrap(function(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:if(!help&&0===args.length){_context16.next=2;break}throw new RPCError(errs.MISC_ERROR,"getbestblockhash");case 2:return _context16.abrupt("return",this.chain.tip.rhash());case 3:case"end":return _context16.stop()}},_callee16,this)}));return function(_x31,_x32){return _ref20.apply(this,arguments)}}(),RPC.prototype.getBlockCount=function(){var _ref21=_asyncToGenerator(regeneratorRuntime.mark(function _callee17(args,help){return regeneratorRuntime.wrap(function(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:if(!help&&0===args.length){_context17.next=2;break}throw new RPCError(errs.MISC_ERROR,"getblockcount");case 2:return _context17.abrupt("return",this.chain.tip.height);case 3:case"end":return _context17.stop()}},_callee17,this)}));return function(_x33,_x34){return _ref21.apply(this,arguments)}}(),RPC.prototype.getBlock=function(){var _ref22=_asyncToGenerator(regeneratorRuntime.mark(function _callee18(args,help){var valid,hash,verbose,details,entry,block;return regeneratorRuntime.wrap(function(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:if(!(help||args.length<1||args.length>3)){_context18.next=2;break}throw new RPCError(errs.MISC_ERROR,'getblock "hash" ( verbose )');case 2:if(valid=new Validator(args),hash=valid.rhash(0),verbose=valid.bool(1,!0),details=valid.bool(2,!1),hash){_context18.next=8;break}throw new RPCError(errs.TYPE_ERROR,"Invalid block hash.");case 8:return _context18.next=10,this.chain.getEntry(hash);case 10:if(entry=_context18.sent){_context18.next=13;break}throw new RPCError(errs.MISC_ERROR,"Block not found");case 13:return _context18.next=15,this.chain.getBlock(entry.hash);case 15:if(block=_context18.sent){_context18.next=22;break}if(!this.chain.options.spv){_context18.next=19;break}throw new RPCError(errs.MISC_ERROR,"Block not available (spv mode)");case 19:if(!this.chain.options.prune){_context18.next=21;break}throw new RPCError(errs.MISC_ERROR,"Block not available (pruned data)");case 21:throw new RPCError(errs.MISC_ERROR,"Can't read block from disk");case 22:if(verbose){_context18.next=24;break}return _context18.abrupt("return",block.toRaw().toString("hex"));case 24:return _context18.next=26,this.blockToJSON(entry,block,details);case 26:return _context18.abrupt("return",_context18.sent);case 27:case"end":return _context18.stop()}},_callee18,this)}));return function(_x35,_x36){return _ref22.apply(this,arguments)}}(),RPC.prototype.getBlockByHeight=function(){var _ref23=_asyncToGenerator(regeneratorRuntime.mark(function _callee19(args,help){var valid,height,verbose,details,entry,block;return regeneratorRuntime.wrap(function(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:if(!(help||args.length<1||args.length>3)){_context19.next=2;break}throw new RPCError(errs.MISC_ERROR,'getblockbyheight "height" ( verbose )');case 2:if(valid=new Validator(args),height=valid.u32(0,-1),verbose=valid.bool(1,!0),details=valid.bool(2,!1),-1!==height){_context19.next=8;break}throw new RPCError(errs.TYPE_ERROR,"Invalid block height.");case 8:return _context19.next=10,this.chain.getEntry(height);case 10:if(entry=_context19.sent){_context19.next=13;break}throw new RPCError(errs.MISC_ERROR,"Block not found");case 13:return _context19.next=15,this.chain.getBlock(entry.hash);case 15:if(block=_context19.sent){_context19.next=22;break}if(!this.chain.options.spv){_context19.next=19;break}throw new RPCError(errs.MISC_ERROR,"Block not available (spv mode)");case 19:if(!this.chain.options.prune){_context19.next=21;break}throw new RPCError(errs.MISC_ERROR,"Block not available (pruned data)");case 21:throw new RPCError(errs.DATABASE_ERROR,"Can't read block from disk");case 22:if(verbose){_context19.next=24;break}return _context19.abrupt("return",block.toRaw().toString("hex"));case 24:return _context19.next=26,this.blockToJSON(entry,block,details);case 26:return _context19.abrupt("return",_context19.sent);case 27:case"end":return _context19.stop()}},_callee19,this)}));return function(_x37,_x38){return _ref23.apply(this,arguments)}}(),RPC.prototype.getBlockHash=function(){var _ref24=_asyncToGenerator(regeneratorRuntime.mark(function _callee20(args,help){var valid,height,hash;return regeneratorRuntime.wrap(function(_context20){for(;;)switch(_context20.prev=_context20.next){case 0:if(!help&&1===args.length){_context20.next=2;break}throw new RPCError(errs.MISC_ERROR,"getblockhash index");case 2:if(valid=new Validator(args),!(null==(height=valid.u32(0))||height>this.chain.height)){_context20.next=6;break}throw new RPCError(errs.INVALID_PARAMETER,"Block height out of range.");case 6:return _context20.next=8,this.chain.getHash(height);case 8:if(hash=_context20.sent){_context20.next=11;break}throw new RPCError(errs.MISC_ERROR,"Not found.");case 11:return _context20.abrupt("return",util.revHex(hash));case 12:case"end":return _context20.stop()}},_callee20,this)}));return function(_x39,_x40){return _ref24.apply(this,arguments)}}(),RPC.prototype.getBlockHeader=function(){var _ref25=_asyncToGenerator(regeneratorRuntime.mark(function _callee21(args,help){var valid,hash,verbose,entry;return regeneratorRuntime.wrap(function(_context21){for(;;)switch(_context21.prev=_context21.next){case 0:if(!(help||args.length<1||args.length>2)){_context21.next=2;break}throw new RPCError(errs.MISC_ERROR,'getblockheader "hash" ( verbose )');case 2:if(valid=new Validator(args),hash=valid.rhash(0),verbose=valid.bool(1,!0),hash){_context21.next=7;break}throw new RPCError(errs.MISC_ERROR,"Invalid block hash.");case 7:return _context21.next=9,this.chain.getEntry(hash);case 9:if(entry=_context21.sent){_context21.next=12;break}throw new RPCError(errs.MISC_ERROR,"Block not found");case 12:if(verbose){_context21.next=14;break}return _context21.abrupt("return",entry.toRaw().toString("hex",0,80));case 14:return _context21.next=16,this.headerToJSON(entry);case 16:return _context21.abrupt("return",_context21.sent);case 17:case"end":return _context21.stop()}},_callee21,this)}));return function(_x41,_x42){return _ref25.apply(this,arguments)}}(),RPC.prototype.getChainTips=function(){var _ref26=_asyncToGenerator(regeneratorRuntime.mark(function _callee22(args,help){var tips,result,_iterator4,_isArray4,_i4,_ref27,hash,entry,fork,main;return regeneratorRuntime.wrap(function(_context22){for(;;)switch(_context22.prev=_context22.next){case 0:if(!help&&0===args.length){_context22.next=2;break}throw new RPCError(errs.MISC_ERROR,"getchaintips");case 2:return _context22.next=4,this.chain.getTips();case 4:tips=_context22.sent,result=[],_iterator4=tips,_isArray4=Array.isArray(_iterator4),_i4=0,_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();case 7:if(!_isArray4){_context22.next=13;break}if(!(_i4>=_iterator4.length)){_context22.next=10;break}return _context22.abrupt("break",31);case 10:_ref27=_iterator4[_i4++],_context22.next=17;break;case 13:if(!(_i4=_iterator4.next()).done){_context22.next=16;break}return _context22.abrupt("break",31);case 16:_ref27=_i4.value;case 17:return hash=_ref27,_context22.next=20,this.chain.getEntry(hash);case 20:return entry=_context22.sent,assert(entry),_context22.next=24,this.findFork(entry);case 24:return fork=_context22.sent,_context22.next=27,this.chain.isMainChain(entry);case 27:main=_context22.sent,result.push({height:entry.height,hash:entry.rhash(),branchlen:entry.height-fork.height,status:main?"active":"valid-headers"});case 29:_context22.next=7;break;case 31:return _context22.abrupt("return",result);case 32:case"end":return _context22.stop()}},_callee22,this)}));return function(_x43,_x44){return _ref26.apply(this,arguments)}}(),RPC.prototype.getDifficulty=function(){var _ref28=_asyncToGenerator(regeneratorRuntime.mark(function _callee23(args,help){return regeneratorRuntime.wrap(function(_context23){for(;;)switch(_context23.prev=_context23.next){case 0:if(!help&&0===args.length){_context23.next=2;break}throw new RPCError(errs.MISC_ERROR,"getdifficulty");case 2:return _context23.abrupt("return",toDifficulty(this.chain.tip.bits));case 3:case"end":return _context23.stop()}},_callee23,this)}));return function(_x45,_x46){return _ref28.apply(this,arguments)}}(),RPC.prototype.getMempoolInfo=function(){var _ref29=_asyncToGenerator(regeneratorRuntime.mark(function _callee24(args,help){return regeneratorRuntime.wrap(function(_context24){for(;;)switch(_context24.prev=_context24.next){case 0:if(!help&&0===args.length){_context24.next=2;break}throw new RPCError(errs.MISC_ERROR,"getmempoolinfo");case 2:if(this.mempool){_context24.next=4;break}throw new RPCError(errs.MISC_ERROR,"No mempool available.");case 4:return _context24.abrupt("return",{size:this.mempool.map.size,bytes:this.mempool.getSize(),usage:this.mempool.getSize(),maxmempool:this.mempool.options.maxSize,mempoolminfee:Amount.btc(this.mempool.options.minRelay,!0)});case 5:case"end":return _context24.stop()}},_callee24,this)}));return function(_x47,_x48){return _ref29.apply(this,arguments)}}(),RPC.prototype.getMempoolAncestors=function(){var _ref30=_asyncToGenerator(regeneratorRuntime.mark(function _callee25(args,help){var valid,hash,verbose,entry,entries,out,_iterator5,_isArray5,_i5,_ref31,_entry,_iterator6,_isArray6,_i6,_ref32,_entry2;return regeneratorRuntime.wrap(function(_context25){for(;;)switch(_context25.prev=_context25.next){case 0:if(!(help||args.length<1||args.length>2)){_context25.next=2;break}throw new RPCError(errs.MISC_ERROR,"getmempoolancestors txid (verbose)");case 2:if(valid=new Validator(args),hash=valid.rhash(0),verbose=valid.bool(1,!1),this.mempool){_context25.next=7;break}throw new RPCError(errs.MISC_ERROR,"No mempool available.");case 7:if(hash){_context25.next=9;break}throw new RPCError(errs.TYPE_ERROR,"Invalid TXID.");case 9:if(entry=this.mempool.getEntry(hash)){_context25.next=12;break}throw new RPCError(errs.MISC_ERROR,"Transaction not in mempool.");case 12:if(entries=this.mempool.getAncestors(entry),out=[],!verbose){_context25.next=32;break}_iterator5=entries,_isArray5=Array.isArray(_iterator5),_i5=0,_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();case 16:if(!_isArray5){_context25.next=22;break}if(!(_i5>=_iterator5.length)){_context25.next=19;break}return _context25.abrupt("break",30);case 19:_ref31=_iterator5[_i5++],_context25.next=26;break;case 22:if(!(_i5=_iterator5.next()).done){_context25.next=25;break}return _context25.abrupt("break",30);case 25:_ref31=_i5.value;case 26:_entry=_ref31,out.push(this.entryToJSON(_entry));case 28:_context25.next=16;break;case 30:_context25.next=47;break;case 32:_iterator6=entries,_isArray6=Array.isArray(_iterator6),_i6=0,_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();case 33:if(!_isArray6){_context25.next=39;break}if(!(_i6>=_iterator6.length)){_context25.next=36;break}return _context25.abrupt("break",47);case 36:_ref32=_iterator6[_i6++],_context25.next=43;break;case 39:if(!(_i6=_iterator6.next()).done){_context25.next=42;break}return _context25.abrupt("break",47);case 42:_ref32=_i6.value;case 43:_entry2=_ref32,out.push(_entry2.txid());case 45:_context25.next=33;break;case 47:return _context25.abrupt("return",out);case 48:case"end":return _context25.stop()}},_callee25,this)}));return function(_x49,_x50){return _ref30.apply(this,arguments)}}(),RPC.prototype.getMempoolDescendants=function(){var _ref33=_asyncToGenerator(regeneratorRuntime.mark(function _callee26(args,help){var valid,hash,verbose,entry,entries,out,_iterator7,_isArray7,_i7,_ref34,_entry3,_iterator8,_isArray8,_i8,_ref35,_entry4;return regeneratorRuntime.wrap(function(_context26){for(;;)switch(_context26.prev=_context26.next){case 0:if(!(help||args.length<1||args.length>2)){_context26.next=2;break}throw new RPCError(errs.MISC_ERROR,"getmempooldescendants txid (verbose)");case 2:if(valid=new Validator(args),hash=valid.rhash(0),verbose=valid.bool(1,!1),this.mempool){_context26.next=7;break}throw new RPCError(errs.MISC_ERROR,"No mempool available.");case 7:if(hash){_context26.next=9;break}throw new RPCError(errs.TYPE_ERROR,"Invalid TXID.");case 9:if(entry=this.mempool.getEntry(hash)){_context26.next=12;break}throw new RPCError(errs.MISC_ERROR,"Transaction not in mempool.");case 12:if(entries=this.mempool.getDescendants(entry),out=[],!verbose){_context26.next=32;break}_iterator7=entries,_isArray7=Array.isArray(_iterator7),_i7=0,_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();case 16:if(!_isArray7){_context26.next=22;break}if(!(_i7>=_iterator7.length)){_context26.next=19;break}return _context26.abrupt("break",30);case 19:_ref34=_iterator7[_i7++],_context26.next=26;break;case 22:if(!(_i7=_iterator7.next()).done){_context26.next=25;break}return _context26.abrupt("break",30);case 25:_ref34=_i7.value;case 26:_entry3=_ref34,out.push(this.entryToJSON(_entry3));case 28:_context26.next=16;break;case 30:_context26.next=47;break;case 32:_iterator8=entries,_isArray8=Array.isArray(_iterator8),_i8=0,_iterator8=_isArray8?_iterator8:_iterator8[Symbol.iterator]();case 33:if(!_isArray8){_context26.next=39;break}if(!(_i8>=_iterator8.length)){_context26.next=36;break}return _context26.abrupt("break",47);case 36:_ref35=_iterator8[_i8++],_context26.next=43;break;case 39:if(!(_i8=_iterator8.next()).done){_context26.next=42;break}return _context26.abrupt("break",47);case 42:_ref35=_i8.value;case 43:_entry4=_ref35,out.push(_entry4.txid());case 45:_context26.next=33;break;case 47:return _context26.abrupt("return",out);case 48:case"end":return _context26.stop()}},_callee26,this)}));return function(_x51,_x52){return _ref33.apply(this,arguments)}}(),RPC.prototype.getMempoolEntry=function(){var _ref36=_asyncToGenerator(regeneratorRuntime.mark(function _callee27(args,help){var valid,hash,entry;return regeneratorRuntime.wrap(function(_context27){for(;;)switch(_context27.prev=_context27.next){case 0:if(!help&&1===args.length){_context27.next=2;break}throw new RPCError(errs.MISC_ERROR,"getmempoolentry txid");case 2:if(valid=new Validator(args),hash=valid.rhash(0),this.mempool){_context27.next=6;break}throw new RPCError(errs.MISC_ERROR,"No mempool available.");case 6:if(hash){_context27.next=8;break}throw new RPCError(errs.TYPE_ERROR,"Invalid TXID.");case 8:if(entry=this.mempool.getEntry(hash)){_context27.next=11;break}throw new RPCError(errs.MISC_ERROR,"Transaction not in mempool.");case 11:return _context27.abrupt("return",this.entryToJSON(entry));case 12:case"end":return _context27.stop()}},_callee27,this)}));return function(_x53,_x54){return _ref36.apply(this,arguments)}}(),RPC.prototype.getRawMempool=function(){var _ref37=_asyncToGenerator(regeneratorRuntime.mark(function _callee28(args,help){var valid,verbose,out,_iterator9,_isArray9,_i9,_ref38,entry,hashes;return regeneratorRuntime.wrap(function(_context28){for(;;)switch(_context28.prev=_context28.next){case 0:if(!(help||args.length>1)){_context28.next=2;break}throw new RPCError(errs.MISC_ERROR,"getrawmempool ( verbose )");case 2:if(valid=new Validator(args),verbose=valid.bool(0,!1),this.mempool){_context28.next=6;break}throw new RPCError(errs.MISC_ERROR,"No mempool available.");case 6:if(!verbose){_context28.next=24;break}out={},_iterator9=this.mempool.map.values(),_isArray9=Array.isArray(_iterator9),_i9=0,_iterator9=_isArray9?_iterator9:_iterator9[Symbol.iterator]();case 9:if(!_isArray9){_context28.next=15;break}if(!(_i9>=_iterator9.length)){_context28.next=12;break}return _context28.abrupt("break",23);case 12:_ref38=_iterator9[_i9++],_context28.next=19;break;case 15:if(!(_i9=_iterator9.next()).done){_context28.next=18;break}return _context28.abrupt("break",23);case 18:_ref38=_i9.value;case 19:out[(entry=_ref38).txid()]=this.entryToJSON(entry);case 21:_context28.next=9;break;case 23:return _context28.abrupt("return",out);case 24:return hashes=this.mempool.getSnapshot(),_context28.abrupt("return",hashes.map(util.revHex));case 26:case"end":return _context28.stop()}},_callee28,this)}));return function(_x55,_x56){return _ref37.apply(this,arguments)}}(),RPC.prototype.getTXOut=function(){var _ref39=_asyncToGenerator(regeneratorRuntime.mark(function _callee29(args,help){var valid,hash,index,mempool,coin;return regeneratorRuntime.wrap(function(_context29){for(;;)switch(_context29.prev=_context29.next){case 0:if(!(help||args.length<2||args.length>3)){_context29.next=2;break}throw new RPCError(errs.MISC_ERROR,'gettxout "txid" n ( includemempool )');case 2:if(valid=new Validator(args),hash=valid.rhash(0),index=valid.u32(1),mempool=valid.bool(2,!0),!this.chain.options.spv){_context29.next=8;break}throw new RPCError(errs.MISC_ERROR,"Cannot get coins in SPV mode.");case 8:if(!this.chain.options.prune){_context29.next=10;break}throw new RPCError(errs.MISC_ERROR,"Cannot get coins when pruned.");case 10:if(hash&&null!=index){_context29.next=12;break}throw new RPCError(errs.TYPE_ERROR,"Invalid outpoint.");case 12:if(coin=void 0,!mempool){_context29.next=17;break}if(this.mempool){_context29.next=16;break}throw new RPCError(errs.MISC_ERROR,"No mempool available.");case 16:coin=this.mempool.getCoin(hash,index);case 17:if(coin){_context29.next=21;break}return _context29.next=20,this.chain.getCoin(hash,index);case 20:coin=_context29.sent;case 21:if(coin){_context29.next=23;break}return _context29.abrupt("return",null);case 23:return _context29.abrupt("return",{bestblock:this.chain.tip.rhash(),confirmations:coin.getDepth(this.chain.height),value:Amount.btc(coin.value,!0),scriptPubKey:this.scriptToJSON(coin.script,!0),version:coin.version,coinbase:coin.coinbase});case 24:case"end":return _context29.stop()}},_callee29,this)}));return function(_x57,_x58){return _ref39.apply(this,arguments)}}(),RPC.prototype.getTXOutProof=function(){var _ref40=_asyncToGenerator(regeneratorRuntime.mark(function _callee30(args,help){var valid,txids,hash,items,set,hashes,last,i,_hash,block,tx,coin,_iterator10,_isArray10,_i10,_ref41,_hash2;return regeneratorRuntime.wrap(function(_context30){for(;;)switch(_context30.prev=_context30.next){case 0:if(!(help||1!==args.length&&2!==args.length)){_context30.next=2;break}throw new RPCError(errs.MISC_ERROR,'gettxoutproof ["txid",...] ( blockhash )');case 2:if(valid=new Validator(args),txids=valid.array(0),hash=valid.rhash(1),!this.chain.options.spv){_context30.next=7;break}throw new RPCError(errs.MISC_ERROR,"Cannot get coins in SPV mode.");case 7:if(!this.chain.options.prune){_context30.next=9;break}throw new RPCError(errs.MISC_ERROR,"Cannot get coins when pruned.");case 9:if(txids&&0!==txids.length){_context30.next=11;break}throw new RPCError(errs.INVALID_PARAMETER,"Invalid TXIDs.");case 11:items=new Validator(txids),set=new Set,hashes=[],last=null,i=0;case 16:if(!(i<txids.length)){_context30.next=28;break}if(_hash=items.rhash(i)){_context30.next=20;break}throw new RPCError(errs.TYPE_ERROR,"Invalid TXID.");case 20:if(!set.has(_hash)){_context30.next=22;break}throw new RPCError(errs.INVALID_PARAMETER,"Duplicate txid.");case 22:set.add(_hash),hashes.push(_hash),last=_hash;case 25:i++,_context30.next=16;break;case 28:if(block=null,!hash){_context30.next=35;break}return _context30.next=32,this.chain.getBlock(hash);case 32:block=_context30.sent,_context30.next=52;break;case 35:if(!this.chain.options.indexTX){_context30.next=45;break}return _context30.next=38,this.chain.getMeta(last);case 38:if(!(tx=_context30.sent)){_context30.next=43;break}return _context30.next=42,this.chain.getBlock(tx.block);case 42:block=_context30.sent;case 43:_context30.next=52;break;case 45:return _context30.next=47,this.chain.getCoin(last,0);case 47:if(!(coin=_context30.sent)){_context30.next=52;break}return _context30.next=51,this.chain.getBlock(coin.height);case 51:block=_context30.sent;case 52:if(block){_context30.next=54;break}throw new RPCError(errs.MISC_ERROR,"Block not found.");case 54:_iterator10=hashes,_isArray10=Array.isArray(_iterator10),_i10=0,_iterator10=_isArray10?_iterator10:_iterator10[Symbol.iterator]();case 55:if(!_isArray10){_context30.next=61;break}if(!(_i10>=_iterator10.length)){_context30.next=58;break}return _context30.abrupt("break",70);case 58:_ref41=_iterator10[_i10++],_context30.next=65;break;case 61:if(!(_i10=_iterator10.next()).done){_context30.next=64;break}return _context30.abrupt("break",70);case 64:_ref41=_i10.value;case 65:if(_hash2=_ref41,block.hasTX(_hash2)){_context30.next=68;break}throw new RPCError(errs.VERIFY_ERROR,"Block does not contain all txids.");case 68:_context30.next=55;break;case 70:return block=MerkleBlock.fromHashes(block,hashes),_context30.abrupt("return",block.toRaw().toString("hex"));case 72:case"end":return _context30.stop()}},_callee30,this)}));return function(_x59,_x60){return _ref40.apply(this,arguments)}}(),RPC.prototype.verifyTXOutProof=function(){var _ref42=_asyncToGenerator(regeneratorRuntime.mark(function _callee31(args,help){var valid,data,block,tree,out,_iterator11,_isArray11,_i11,_ref43,hash;return regeneratorRuntime.wrap(function(_context31){for(;;)switch(_context31.prev=_context31.next){case 0:if(!help&&1===args.length){_context31.next=2;break}throw new RPCError(errs.MISC_ERROR,'verifytxoutproof "proof"');case 2:if(valid=new Validator(args),data=valid.buf(0)){_context31.next=6;break}throw new RPCError(errs.TYPE_ERROR,"Invalid hex string.");case 6:if((block=MerkleBlock.fromRaw(data)).verify()){_context31.next=9;break}return _context31.abrupt("return",[]);case 9:return _context31.next=11,this.chain.getEntry(block.hash("hex"));case 11:if(_context31.sent){_context31.next=14;break}throw new RPCError(errs.MISC_ERROR,"Block not found in chain.");case 14:tree=block.getTree(),out=[],_iterator11=tree.matches,_isArray11=Array.isArray(_iterator11),_i11=0,_iterator11=_isArray11?_iterator11:_iterator11[Symbol.iterator]();case 17:if(!_isArray11){_context31.next=23;break}if(!(_i11>=_iterator11.length)){_context31.next=20;break}return _context31.abrupt("break",31);case 20:_ref43=_iterator11[_i11++],_context31.next=27;break;case 23:if(!(_i11=_iterator11.next()).done){_context31.next=26;break}return _context31.abrupt("break",31);case 26:_ref43=_i11.value;case 27:hash=_ref43,out.push(util.revHex(hash.toString("hex")));case 29:_context31.next=17;break;case 31:return _context31.abrupt("return",out);case 32:case"end":return _context31.stop()}},_callee31,this)}));return function(_x61,_x62){return _ref42.apply(this,arguments)}}(),RPC.prototype.getTXOutSetInfo=function(){var _ref44=_asyncToGenerator(regeneratorRuntime.mark(function _callee32(args,help){return regeneratorRuntime.wrap(function(_context32){for(;;)switch(_context32.prev=_context32.next){case 0:if(!help&&0===args.length){_context32.next=2;break}throw new RPCError(errs.MISC_ERROR,"gettxoutsetinfo");case 2:if(!this.chain.options.spv){_context32.next=4;break}throw new RPCError(errs.MISC_ERROR,"Chainstate not available (SPV mode).");case 4:return _context32.abrupt("return",{height:this.chain.height,bestblock:this.chain.tip.rhash(),transactions:this.chain.db.state.tx,txouts:this.chain.db.state.coin,bytes_serialized:0,hash_serialized:0,total_amount:Amount.btc(this.chain.db.state.value,!0)});case 5:case"end":return _context32.stop()}},_callee32,this)}));return function(_x63,_x64){return _ref44.apply(this,arguments)}}(),RPC.prototype.pruneBlockchain=function(){var _ref45=_asyncToGenerator(regeneratorRuntime.mark(function _callee33(args,help){return regeneratorRuntime.wrap(function(_context33){for(;;)switch(_context33.prev=_context33.next){case 0:if(!help&&0===args.length){_context33.next=2;break}throw new RPCError(errs.MISC_ERROR,"pruneblockchain");case 2:if(!this.chain.options.spv){_context33.next=4;break}throw new RPCError(errs.MISC_ERROR,"Cannot prune chain in SPV mode.");case 4:if(!this.chain.options.prune){_context33.next=6;break}throw new RPCError(errs.MISC_ERROR,"Chain is already pruned.");case 6:if(!(this.chain.height<this.network.block.pruneAfterHeight)){_context33.next=8;break}throw new RPCError(errs.MISC_ERROR,"Chain is too short for pruning.");case 8:return _context33.prev=8,_context33.next=11,this.chain.prune();case 11:_context33.next=16;break;case 13:throw _context33.prev=13,_context33.t0=_context33.catch(8),new RPCError(errs.DATABASE_ERROR,_context33.t0.message);case 16:case"end":return _context33.stop()}},_callee33,this,[[8,13]])}));return function(_x65,_x66){return _ref45.apply(this,arguments)}}(),RPC.prototype.verifyChain=function(){var _ref46=_asyncToGenerator(regeneratorRuntime.mark(function _callee34(args,help){var valid,level,blocks;return regeneratorRuntime.wrap(function(_context34){for(;;)switch(_context34.prev=_context34.next){case 0:if(!(help||args.length>2)){_context34.next=2;break}throw new RPCError(errs.MISC_ERROR,"verifychain ( checklevel numblocks )");case 2:if(valid=new Validator(args),level=valid.u32(0),blocks=valid.u32(1),null!=level&&null!=blocks){_context34.next=7;break}throw new RPCError(errs.TYPE_ERROR,"Missing parameters.");case 7:if(!this.chain.options.spv){_context34.next=9;break}throw new RPCError(errs.MISC_ERROR,"Cannot verify chain in SPV mode.");case 9:if(!this.chain.options.prune){_context34.next=11;break}throw new RPCError(errs.MISC_ERROR,"Cannot verify chain when pruned.");case 11:return _context34.abrupt("return",null);case 12:case"end":return _context34.stop()}},_callee34,this)}));return function(_x67,_x68){return _ref46.apply(this,arguments)}}(),RPC.prototype.submitWork=function(){var _ref47=_asyncToGenerator(regeneratorRuntime.mark(function _callee35(data){var unlock;return regeneratorRuntime.wrap(function(_context35){for(;;)switch(_context35.prev=_context35.next){case 0:return _context35.next=2,this.locker.lock();case 2:return unlock=_context35.sent,_context35.prev=3,_context35.next=6,this._submitWork(data);case 6:return _context35.abrupt("return",_context35.sent);case 7:return _context35.prev=7,unlock(),_context35.finish(7);case 10:case"end":return _context35.stop()}},_callee35,this,[[3,,7,10]])}));return function(_x69){return _ref47.apply(this,arguments)}}(),RPC.prototype._submitWork=function(){var _ref48=_asyncToGenerator(regeneratorRuntime.mark(function _callee36(data){var attempt,raw,header,nonces,n1,n2,nonce,time,proof,block,entry;return regeneratorRuntime.wrap(function(_context36){for(;;)switch(_context36.prev=_context36.next){case 0:if(attempt=this.attempt){_context36.next=3;break}return _context36.abrupt("return",!1);case 3:if(128===data.length){_context36.next=5;break}throw new RPCError(errs.INVALID_PARAMETER,"Invalid work size.");case 5:if(swap32(raw=data.slice(0,80)),(header=Headers.fromHead(raw)).prevBlock===attempt.prevBlock&&header.bits===attempt.bits){_context36.next=10;break}return _context36.abrupt("return",!1);case 10:if(header.verify()){_context36.next=12;break}return _context36.abrupt("return",!1);case 12:if(nonces=this.merkleMap.get(header.merkleRoot)){_context36.next=15;break}return _context36.abrupt("return",!1);case 15:if(n1=nonces[0],n2=nonces[1],nonce=header.nonce,time=header.time,(proof=attempt.getProof(n1,n2,time,nonce)).verify(attempt.target)){_context36.next=21;break}return _context36.abrupt("return",!1);case 21:return block=attempt.commit(proof),entry=void 0,_context36.prev=23,_context36.next=26,this.chain.add(block);case 26:entry=_context36.sent,_context36.next=35;break;case 29:if(_context36.prev=29,_context36.t0=_context36.catch(23),"VerifyError"!==_context36.t0.type){_context36.next=34;break}return this.logger.warning("RPC block rejected: %s (%s).",block.rhash(),_context36.t0.reason),_context36.abrupt("return",!1);case 34:throw _context36.t0;case 35:if(entry){_context36.next=38;break}return this.logger.warning("RPC block rejected: %s (bad-prevblk).",block.rhash()),_context36.abrupt("return",!1);case 38:return _context36.abrupt("return",!0);case 39:case"end":return _context36.stop()}},_callee36,this,[[23,29]])}));return function(_x70){return _ref48.apply(this,arguments)}}(),RPC.prototype.createWork=function(){var _ref49=_asyncToGenerator(regeneratorRuntime.mark(function _callee37(data){var unlock;return regeneratorRuntime.wrap(function(_context37){for(;;)switch(_context37.prev=_context37.next){case 0:return _context37.next=2,this.locker.lock();case 2:return unlock=_context37.sent,_context37.prev=3,_context37.next=6,this._createWork(data);case 6:return _context37.abrupt("return",_context37.sent);case 7:return _context37.prev=7,unlock(),_context37.finish(7);case 10:case"end":return _context37.stop()}},_callee37,this,[[3,,7,10]])}));return function(_x71){return _ref49.apply(this,arguments)}}(),RPC.prototype._createWork=function(){var _ref50=_asyncToGenerator(regeneratorRuntime.mark(function _callee38(){var attempt,n1,n2,time,data,root;return regeneratorRuntime.wrap(function(_context38){for(;;)switch(_context38.prev=_context38.next){case 0:return _context38.next=2,this.updateWork();case 2:return attempt=_context38.sent,n1=this.nonce1,n2=this.nonce2,time=attempt.time,(data=Buffer.allocUnsafe(128)).fill(0),root=attempt.getRoot(n1,n2),attempt.getHeader(root,time,0).copy(data,0),data[80]=128,data.writeUInt32BE(640,data.length-4,!0),swap32(data),_context38.abrupt("return",{data:data.toString("hex"),target:attempt.target.toString("hex"),height:attempt.height});case 15:case"end":return _context38.stop()}},_callee38,this)}));return function(){return _ref50.apply(this,arguments)}}(),RPC.prototype.getWorkLongpoll=function(){var _ref51=_asyncToGenerator(regeneratorRuntime.mark(function _callee39(args,help){return regeneratorRuntime.wrap(function(_context39){for(;;)switch(_context39.prev=_context39.next){case 0:return _context39.next=2,this.longpoll();case 2:return _context39.next=4,this.createWork();case 4:return _context39.abrupt("return",_context39.sent);case 5:case"end":return _context39.stop()}},_callee39,this)}));return function(_x72,_x73){return _ref51.apply(this,arguments)}}(),RPC.prototype.getWork=function(){var _ref52=_asyncToGenerator(regeneratorRuntime.mark(function _callee40(args,help){var valid,data;return regeneratorRuntime.wrap(function(_context40){for(;;)switch(_context40.prev=_context40.next){case 0:if(!(args.length>1)){_context40.next=2;break}throw new RPCError(errs.MISC_ERROR,'getwork ( "data" )');case 2:if(1!==args.length){_context40.next=10;break}if(valid=new Validator(args),data=valid.buf(0)){_context40.next=7;break}throw new RPCError(errs.TYPE_ERROR,"Invalid work data.");case 7:return _context40.next=9,this.submitWork(data);case 9:return _context40.abrupt("return",_context40.sent);case 10:return _context40.next=12,this.createWork();case 12:return _context40.abrupt("return",_context40.sent);case 13:case"end":return _context40.stop()}},_callee40,this)}));return function(_x74,_x75){return _ref52.apply(this,arguments)}}(),RPC.prototype.submitBlock=function(){var _ref53=_asyncToGenerator(regeneratorRuntime.mark(function _callee41(args,help){var valid,data,block;return regeneratorRuntime.wrap(function(_context41){for(;;)switch(_context41.prev=_context41.next){case 0:if(!(help||args.length<1||args.length>2)){_context41.next=2;break}throw new RPCError(errs.MISC_ERROR,'submitblock "hexdata" ( "jsonparametersobject" )');case 2:return valid=new Validator(args),data=valid.buf(0),block=Block.fromRaw(data),_context41.next=7,this.addBlock(block);case 7:return _context41.abrupt("return",_context41.sent);case 8:case"end":return _context41.stop()}},_callee41,this)}));return function(_x76,_x77){return _ref53.apply(this,arguments)}}(),RPC.prototype.getBlockTemplate=function(){var _ref54=_asyncToGenerator(regeneratorRuntime.mark(function _callee42(args,help){var validator,options,valid,mode,data,block,maxVersion,rules,capabilities,coinbase,txnCap,valueCap,_iterator12,_isArray12,_i12,_ref55,capability,lpid;return regeneratorRuntime.wrap(function(_context42){for(;;)switch(_context42.prev=_context42.next){case 0:if(!(help||args.length>1)){_context42.next=2;break}throw new RPCError(errs.MISC_ERROR,'getblocktemplate ( "jsonrequestobject" )');case 2:if(validator=new Validator(args),options=validator.obj(0,{}),valid=new Validator(options),"template"===(mode=valid.str("mode","template"))||"proposal"===mode){_context42.next=8;break}throw new RPCError(errs.INVALID_PARAMETER,"Invalid mode.");case 8:if("proposal"!==mode){_context42.next=26;break}if(data=valid.buf("data")){_context42.next=12;break}throw new RPCError(errs.TYPE_ERROR,"Missing data parameter.");case 12:if((block=Block.fromRaw(data)).prevBlock===this.chain.tip.hash){_context42.next=15;break}return _context42.abrupt("return","inconclusive-not-best-prevblk");case 15:return _context42.prev=15,_context42.next=18,this.chain.verifyBlock(block);case 18:_context42.next=25;break;case 20:if(_context42.prev=20,_context42.t0=_context42.catch(15),"VerifyError"!==_context42.t0.type){_context42.next=24;break}return _context42.abrupt("return",_context42.t0.reason);case 24:throw _context42.t0;case 25:return _context42.abrupt("return",null);case 26:if(maxVersion=valid.u32("maxversion",-1),(rules=valid.array("rules"))&&(maxVersion=-1),capabilities=valid.array("capabilities"),coinbase=!1,!capabilities){_context42.next=62;break}txnCap=!1,valueCap=!1,_iterator12=capabilities,_isArray12=Array.isArray(_iterator12),_i12=0,_iterator12=_isArray12?_iterator12:_iterator12[Symbol.iterator]();case 35:if(!_isArray12){_context42.next=41;break}if(!(_i12>=_iterator12.length)){_context42.next=38;break}return _context42.abrupt("break",57);case 38:_ref55=_iterator12[_i12++],_context42.next=45;break;case 41:if(!(_i12=_iterator12.next()).done){_context42.next=44;break}return _context42.abrupt("break",57);case 44:_ref55=_i12.value;case 45:if("string"==typeof(capability=_ref55)){_context42.next=48;break}throw new RPCError(errs.TYPE_ERROR,"Invalid capability.");case 48:_context42.t1=capability,_context42.next="coinbasetxn"===_context42.t1?51:"coinbasevalue"===_context42.t1?53:55;break;case 51:return txnCap=!0,_context42.abrupt("break",55);case 53:return valueCap=!0,_context42.abrupt("break",55);case 55:_context42.next=35;break;case 57:if(valueCap=!0,!txnCap||valueCap){_context42.next=62;break}if(0!==this.miner.addresses.length){_context42.next=61;break}throw new RPCError(errs.MISC_ERROR,"No addresses available for coinbase.");case 61:coinbase=!0;case 62:if(this.network.selfConnect){_context42.next=67;break}if(0!==this.pool.peers.size()){_context42.next=65;break}throw new RPCError(errs.CLIENT_NOT_CONNECTED,"Bitcoin is not connected!");case 65:if(this.chain.synced){_context42.next=67;break}throw new RPCError(errs.CLIENT_IN_INITIAL_DOWNLOAD,"Bitcoin is downloading blocks...");case 67:if(!(lpid=valid.str("longpollid"))){_context42.next=71;break}return _context42.next=71,this.handleLongpoll(lpid);case 71:return rules||(rules=[]),_context42.next=74,this.createTemplate(maxVersion,coinbase,rules);case 74:return _context42.abrupt("return",_context42.sent);case 75:case"end":return _context42.stop()}},_callee42,this,[[15,20]])}));return function(_x78,_x79){return _ref54.apply(this,arguments)}}(),RPC.prototype.createTemplate=function(){var _ref56=_asyncToGenerator(regeneratorRuntime.mark(function _callee43(maxVersion,coinbase,rules){var unlock;return regeneratorRuntime.wrap(function(_context43){for(;;)switch(_context43.prev=_context43.next){case 0:return _context43.next=2,this.locker.lock();case 2:return unlock=_context43.sent,_context43.prev=3,_context43.next=6,this._createTemplate(maxVersion,coinbase,rules);case 6:return _context43.abrupt("return",_context43.sent);case 7:return _context43.prev=7,unlock(),_context43.finish(7);case 10:case"end":return _context43.stop()}},_callee43,this,[[3,,7,10]])}));return function(_x80,_x81,_x82){return _ref56.apply(this,arguments)}}(),RPC.prototype._createTemplate=function(){var _ref57=_asyncToGenerator(regeneratorRuntime.mark(function _callee44(maxVersion,coinbase,rules){var attempt,scale,mutable,index,i,entry,txs,_i13,_entry5,tx,deps,j,input,dep,version,vbavailable,vbrules,_iterator13,_isArray13,_i14,_ref58,deploy,state,name,json,_tx,_input,output;return regeneratorRuntime.wrap(function(_context44){for(;;)switch(_context44.prev=_context44.next){case 0:return _context44.next=2,this.getTemplate();case 2:for(attempt=_context44.sent,scale=attempt.witness?1:consensus.WITNESS_SCALE_FACTOR,mutable=["time","transactions","prevblock"],maxVersion>=2&&mutable.push("version/force"),coinbase&&(mutable.push("coinbase"),mutable.push("coinbase/append"),mutable.push("generation")),index=new Map,i=0;i<attempt.items.length;i++)entry=attempt.items[i],index.set(entry.hash,i+1);txs=[],_i13=0;case 11:if(!(_i13<attempt.items.length)){_context44.next=29;break}_entry5=attempt.items[_i13],tx=_entry5.tx,deps=[],j=0;case 16:if(!(j<tx.inputs.length)){_context44.next=25;break}if(input=tx.inputs[j],null!=(dep=index.get(input.prevout.hash))){_context44.next=21;break}return _context44.abrupt("continue",22);case 21:-1===deps.indexOf(dep)&&(assert(dep<_i13+1),deps.push(dep));case 22:j++,_context44.next=16;break;case 25:txs.push({data:tx.toRaw().toString("hex"),txid:tx.txid(),hash:tx.wtxid(),depends:deps,fee:_entry5.fee,sigops:_entry5.sigops/scale|0,weight:tx.getWeight()});case 26:_i13++,_context44.next=11;break;case 29:this.chain.options.bip91&&(rules.push("segwit"),rules.push("segsignal")),this.chain.options.bip148&&rules.push("segwit"),version=attempt.version,vbavailable={},vbrules=[],_iterator13=this.network.deploys,_isArray13=Array.isArray(_iterator13),_i14=0,_iterator13=_isArray13?_iterator13:_iterator13[Symbol.iterator]();case 35:if(!_isArray13){_context44.next=41;break}if(!(_i14>=_iterator13.length)){_context44.next=38;break}return _context44.abrupt("break",68);case 38:_ref58=_iterator13[_i14++],_context44.next=45;break;case 41:if(!(_i14=_iterator13.next()).done){_context44.next=44;break}return _context44.abrupt("break",68);case 44:_ref58=_i14.value;case 45:return deploy=_ref58,_context44.next=48,this.chain.getState(this.chain.tip,deploy);case 48:state=_context44.sent,name=deploy.name,_context44.t0=state,_context44.next=_context44.t0===common.thresholdStates.DEFINED?53:_context44.t0===common.thresholdStates.FAILED?53:_context44.t0===common.thresholdStates.LOCKED_IN?54:_context44.t0===common.thresholdStates.STARTED?55:_context44.t0===common.thresholdStates.ACTIVE?58:64;break;case 53:return _context44.abrupt("break",66);case 54:version|=1<<deploy.bit;case 55:return deploy.force||(-1===rules.indexOf(name)&&(version&=~(1<<deploy.bit)),deploy.required&&(name="!"+name)),vbavailable[name]=deploy.bit,_context44.abrupt("break",66);case 58:if(deploy.force||!deploy.required){_context44.next=62;break}if(-1!==rules.indexOf(name)){_context44.next=61;break}throw new RPCError(errs.INVALID_PARAMETER,"Client must support "+name+".");case 61:name="!"+name;case 62:return vbrules.push(name),_context44.abrupt("break",66);case 64:return assert(!1,"Bad state."),_context44.abrupt("break",66);case 66:_context44.next=35;break;case 68:return json={capabilities:["proposal"],mutable:mutable,version:version>>>=0,rules:vbrules,vbavailable:vbavailable,vbrequired:0,height:attempt.height,previousblockhash:util.revHex(attempt.prevBlock),target:util.revHex(attempt.target.toString("hex")),bits:hex32(attempt.bits),noncerange:"00000000ffffffff",curtime:attempt.time,mintime:attempt.mtp+1,maxtime:attempt.time+7200,expires:attempt.time+7200,sigoplimit:consensus.MAX_BLOCK_SIGOPS_COST/scale|0,sizelimit:consensus.MAX_BLOCK_SIZE,weightlimit:void 0,longpollid:this.chain.tip.rhash()+hex32(this.totalTX()),submitold:!1,coinbaseaux:{flags:attempt.coinbaseFlags.toString("hex")},coinbasevalue:void 0,coinbasetxn:void 0,default_witness_commitment:void 0,transactions:txs},attempt.witness&&(json.sizelimit=consensus.MAX_RAW_BLOCK_SIZE,json.weightlimit=consensus.MAX_BLOCK_WEIGHT),coinbase?(_tx=attempt.toCoinbase(),(_input=_tx.inputs[0]).script.pop(),_input.script.compile(),attempt.witness&&(output=_tx.outputs.pop(),assert(output.script.isCommitment()),_input.witness.clear()),_tx.refresh(),json.coinbasetxn={data:_tx.toRaw().toString("hex"),txid:_tx.txid(),hash:_tx.wtxid(),depends:[],fee:0,sigops:_tx.getSigopsCost()/scale|0,weight:_tx.getWeight()}):json.coinbasevalue=attempt.getReward(),-1!==rules.indexOf("segwit")&&(json.default_witness_commitment=attempt.getWitnessScript().toJSON()),_context44.abrupt("return",json);case 74:case"end":return _context44.stop()}},_callee44,this)}));return function(_x83,_x84,_x85){return _ref57.apply(this,arguments)}}(),RPC.prototype.getMiningInfo=function(){var _ref59=_asyncToGenerator(regeneratorRuntime.mark(function _callee45(args,help){var attempt,size,weight,txs,diff,_iterator14,_isArray14,_i15,_ref60;return regeneratorRuntime.wrap(function(_context45){for(;;)switch(_context45.prev=_context45.next){case 0:if(!help&&0===args.length){_context45.next=2;break}throw new RPCError(errs.MISC_ERROR,"getmininginfo");case 2:if(attempt=this.attempt,size=0,weight=0,txs=0,diff=0,!attempt){_context45.next=27;break}weight=attempt.weight,txs=attempt.items.length+1,diff=attempt.getDifficulty(),size=1e3,_iterator14=attempt.items,_isArray14=Array.isArray(_iterator14),_i15=0,_iterator14=_isArray14?_iterator14:_iterator14[Symbol.iterator]();case 13:if(!_isArray14){_context45.next=19;break}if(!(_i15>=_iterator14.length)){_context45.next=16;break}return _context45.abrupt("break",27);case 16:_ref60=_iterator14[_i15++],_context45.next=23;break;case 19:if(!(_i15=_iterator14.next()).done){_context45.next=22;break}return _context45.abrupt("break",27);case 22:_ref60=_i15.value;case 23:size+=_ref60.tx.getBaseSize();case 25:_context45.next=13;break;case 27:return _context45.t0=this.chain.height,_context45.t1=size,_context45.t2=weight,_context45.t3=txs,_context45.t4=diff,_context45.t5=this.procLimit,_context45.next=35,this.getHashRate(120);case 35:return _context45.t6=_context45.sent,_context45.t7=this.totalTX(),_context45.t8=this.network!==Network.main,_context45.t9="testnet"!==this.network.type?this.network.type:"test",_context45.t10=this.mining,_context45.abrupt("return",{blocks:_context45.t0,currentblocksize:_context45.t1,currentblockweight:_context45.t2,currentblocktx:_context45.t3,difficulty:_context45.t4,errors:"",genproclimit:_context45.t5,networkhashps:_context45.t6,pooledtx:_context45.t7,testnet:_context45.t8,chain:_context45.t9,generate:_context45.t10});case 41:case"end":return _context45.stop()}},_callee45,this)}));return function(_x86,_x87){return _ref59.apply(this,arguments)}}(),RPC.prototype.getNetworkHashPS=function(){var _ref61=_asyncToGenerator(regeneratorRuntime.mark(function _callee46(args,help){var valid,lookup,height;return regeneratorRuntime.wrap(function(_context46){for(;;)switch(_context46.prev=_context46.next){case 0:if(!(help||args.length>2)){_context46.next=2;break}throw new RPCError(errs.MISC_ERROR,"getnetworkhashps ( blocks height )");case 2:return valid=new Validator(args),lookup=valid.u32(0,120),height=valid.u32(1),_context46.next=7,this.getHashRate(lookup,height);case 7:return _context46.abrupt("return",_context46.sent);case 8:case"end":return _context46.stop()}},_callee46,this)}));return function(_x88,_x89){return _ref61.apply(this,arguments)}}(),RPC.prototype.prioritiseTransaction=function(){var _ref62=_asyncToGenerator(regeneratorRuntime.mark(function _callee47(args,help){var valid,hash,pri,fee,entry;return regeneratorRuntime.wrap(function(_context47){for(;;)switch(_context47.prev=_context47.next){case 0:if(!help&&3===args.length){_context47.next=2;break}throw new RPCError(errs.MISC_ERROR,"prioritisetransaction <txid> <priority delta> <fee delta>");case 2:if(valid=new Validator(args),hash=valid.rhash(0),pri=valid.i64(1),fee=valid.i64(2),this.mempool){_context47.next=8;break}throw new RPCError(errs.MISC_ERROR,"No mempool available.");case 8:if(hash){_context47.next=10;break}throw new RPCError(errs.TYPE_ERROR,"Invalid TXID");case 10:if(null!=pri&&null!=fee){_context47.next=12;break}throw new RPCError(errs.TYPE_ERROR,"Invalid fee or priority.");case 12:if(entry=this.mempool.getEntry(hash)){_context47.next=15;break}throw new RPCError(errs.MISC_ERROR,"Transaction not in mempool.");case 15:return this.mempool.prioritise(entry,pri,fee),_context47.abrupt("return",!0);case 17:case"end":return _context47.stop()}},_callee47,this)}));return function(_x90,_x91){return _ref62.apply(this,arguments)}}(),RPC.prototype.verifyBlock=function(){var _ref63=_asyncToGenerator(regeneratorRuntime.mark(function _callee48(args,help){var valid,data,block;return regeneratorRuntime.wrap(function(_context48){for(;;)switch(_context48.prev=_context48.next){case 0:if(!help&&1===args.length){_context48.next=2;break}throw new RPCError(errs.MISC_ERROR,'verifyblock "block-hex"');case 2:if(valid=new Validator(args),data=valid.buf(0)){_context48.next=6;break}throw new RPCError(errs.TYPE_ERROR,"Invalid block hex.");case 6:if(!this.chain.options.spv){_context48.next=8;break}throw new RPCError(errs.MISC_ERROR,"Cannot verify block in SPV mode.");case 8:return block=Block.fromRaw(data),_context48.prev=9,_context48.next=12,this.chain.verifyBlock(block);case 12:_context48.next=19;break;case 14:if(_context48.prev=14,_context48.t0=_context48.catch(9),"VerifyError"!==_context48.t0.type){_context48.next=18;break}return _context48.abrupt("return",_context48.t0.reason);case 18:throw _context48.t0;case 19:return _context48.abrupt("return",null);case 20:case"end":return _context48.stop()}},_callee48,this,[[9,14]])}));return function(_x92,_x93){return _ref63.apply(this,arguments)}}(),RPC.prototype.getGenerate=function(){var _ref64=_asyncToGenerator(regeneratorRuntime.mark(function _callee49(args,help){return regeneratorRuntime.wrap(function(_context49){for(;;)switch(_context49.prev=_context49.next){case 0:if(!help&&0===args.length){_context49.next=2;break}throw new RPCError(errs.MISC_ERROR,"getgenerate");case 2:return _context49.abrupt("return",this.mining);case 3:case"end":return _context49.stop()}},_callee49,this)}));return function(_x94,_x95){return _ref64.apply(this,arguments)}}(),RPC.prototype.setGenerate=function(){var _ref65=_asyncToGenerator(regeneratorRuntime.mark(function _callee50(args,help){var valid,mine,limit;return regeneratorRuntime.wrap(function(_context50){for(;;)switch(_context50.prev=_context50.next){case 0:if(!(help||args.length<1||args.length>2)){_context50.next=2;break}throw new RPCError(errs.MISC_ERROR,"setgenerate mine ( proclimit )");case 2:if(valid=new Validator(args),mine=valid.bool(0,!1),limit=valid.u32(1,0),!mine||0!==this.miner.addresses.length){_context50.next=7;break}throw new RPCError(errs.MISC_ERROR,"No addresses available for coinbase.");case 7:if(this.mining=mine,this.procLimit=limit,!mine){_context50.next=12;break}return this.miner.cpu.start(),_context50.abrupt("return",!0);case 12:return _context50.next=14,this.miner.cpu.stop();case 14:return _context50.abrupt("return",!1);case 15:case"end":return _context50.stop()}},_callee50,this)}));return function(_x96,_x97){return _ref65.apply(this,arguments)}}(),RPC.prototype.generate=function(){var _ref66=_asyncToGenerator(regeneratorRuntime.mark(function _callee51(args,help){var valid,blocks,tries;return regeneratorRuntime.wrap(function(_context51){for(;;)switch(_context51.prev=_context51.next){case 0:if(!(help||args.length<1||args.length>2)){_context51.next=2;break}throw new RPCError(errs.MISC_ERROR,"generate numblocks ( maxtries )");case 2:if(valid=new Validator(args),blocks=valid.u32(0,1),tries=valid.u32(1),0!==this.miner.addresses.length){_context51.next=7;break}throw new RPCError(errs.MISC_ERROR,"No addresses available for coinbase.");case 7:return _context51.next=9,this.mineBlocks(blocks,null,tries);case 9:return _context51.abrupt("return",_context51.sent);case 10:case"end":return _context51.stop()}},_callee51,this)}));return function(_x98,_x99){return _ref66.apply(this,arguments)}}(),RPC.prototype.generateToAddress=function(){var _ref67=_asyncToGenerator(regeneratorRuntime.mark(function _callee52(args,help){var valid,blocks,str,tries,addr;return regeneratorRuntime.wrap(function(_context52){for(;;)switch(_context52.prev=_context52.next){case 0:if(!(help||args.length<2||args.length>3)){_context52.next=2;break}throw new RPCError(errs.MISC_ERROR,"generatetoaddress numblocks address ( maxtries )");case 2:return valid=new Validator(args),blocks=valid.u32(0,1),str=valid.str(1,""),tries=valid.u32(2),addr=parseAddress(str,this.network),_context52.next=9,this.mineBlocks(blocks,addr,tries);case 9:return _context52.abrupt("return",_context52.sent);case 10:case"end":return _context52.stop()}},_callee52,this)}));return function(_x100,_x101){return _ref67.apply(this,arguments)}}(),RPC.prototype.createRawTransaction=function(){var _ref68=_asyncToGenerator(regeneratorRuntime.mark(function _callee53(args,help){var valid,inputs,sendTo,locktime,tx,_iterator15,_isArray15,_i16,_ref69,_valid,hash,index,sequence,input,sends,uniq,_iterator16,_isArray16,_i17,_ref70,key,_value,_output,addr,b58,value,output;return regeneratorRuntime.wrap(function(_context53){for(;;)switch(_context53.prev=_context53.next){case 0:if(!(help||args.length<2||args.length>3)){_context53.next=2;break}throw new RPCError(errs.MISC_ERROR,'createrawtransaction [{"txid":"id","vout":n},...] {"address":amount,"data":"hex",...} ( locktime )');case 2:if(valid=new Validator(args),inputs=valid.array(0),sendTo=valid.obj(1),locktime=valid.u32(2),inputs&&sendTo){_context53.next=8;break}throw new RPCError(errs.TYPE_ERROR,"Invalid parameters (inputs and sendTo).");case 8:tx=new MTX,null!=locktime&&(tx.locktime=locktime),_iterator15=inputs,_isArray15=Array.isArray(_iterator15),_i16=0,_iterator15=_isArray15?_iterator15:_iterator15[Symbol.iterator]();case 11:if(!_isArray15){_context53.next=17;break}if(!(_i16>=_iterator15.length)){_context53.next=14;break}return _context53.abrupt("break",36);case 14:_ref69=_iterator15[_i16++],_context53.next=21;break;case 17:if(!(_i16=_iterator15.next()).done){_context53.next=20;break}return _context53.abrupt("break",36);case 20:_ref69=_i16.value;case 21:if(_valid=new Validator(_ref69),hash=_valid.rhash("txid"),index=_valid.u32("vout"),sequence=_valid.u32("sequence",4294967295),tx.locktime&&sequence--,hash&&null!=index){_context53.next=29;break}throw new RPCError(errs.TYPE_ERROR,"Invalid outpoint.");case 29:(input=new Input).prevout.hash=hash,input.prevout.index=index,input.sequence=sequence,tx.inputs.push(input);case 34:_context53.next=11;break;case 36:sends=new Validator(sendTo),uniq=new Set,_iterator16=Object.keys(sendTo),_isArray16=Array.isArray(_iterator16),_i17=0,_iterator16=_isArray16?_iterator16:_iterator16[Symbol.iterator]();case 39:if(!_isArray16){_context53.next=45;break}if(!(_i17>=_iterator16.length)){_context53.next=42;break}return _context53.abrupt("break",73);case 42:_ref70=_iterator16[_i17++],_context53.next=49;break;case 45:if(!(_i17=_iterator16.next()).done){_context53.next=48;break}return _context53.abrupt("break",73);case 48:_ref70=_i17.value;case 49:if("data"!==(key=_ref70)){_context53.next=59;break}if(_value=sends.buf(key)){_context53.next=54;break}throw new RPCError(errs.TYPE_ERROR,"Invalid nulldata..");case 54:return(_output=new Output).value=0,_output.script.fromNulldata(_value),tx.outputs.push(_output),_context53.abrupt("continue",71);case 59:if(addr=parseAddress(key,this.network),b58=addr.toString(this.network),!uniq.has(b58)){_context53.next=63;break}throw new RPCError(errs.INVALID_PARAMETER,"Duplicate address");case 63:if(uniq.add(b58),null!=(value=sends.ufixed(key,8))){_context53.next=67;break}throw new RPCError(errs.TYPE_ERROR,"Invalid output value.");case 67:(output=new Output).value=value,output.script.fromAddress(addr),tx.outputs.push(output);case 71:_context53.next=39;break;case 73:return _context53.abrupt("return",tx.toRaw().toString("hex"));case 74:case"end":return _context53.stop()}},_callee53,this)}));return function(_x102,_x103){return _ref68.apply(this,arguments)}}(),RPC.prototype.decodeRawTransaction=function(){var _ref71=_asyncToGenerator(regeneratorRuntime.mark(function _callee54(args,help){var valid,data,tx;return regeneratorRuntime.wrap(function(_context54){for(;;)switch(_context54.prev=_context54.next){case 0:if(!help&&1===args.length){_context54.next=2;break}throw new RPCError(errs.MISC_ERROR,'decoderawtransaction "hexstring"');case 2:if(valid=new Validator(args),data=valid.buf(0)){_context54.next=6;break}throw new RPCError(errs.TYPE_ERROR,"Invalid hex string.");case 6:return tx=TX.fromRaw(data),_context54.abrupt("return",this.txToJSON(tx));case 8:case"end":return _context54.stop()}},_callee54,this)}));return function(_x104,_x105){return _ref71.apply(this,arguments)}}(),RPC.prototype.decodeScript=function(){var _ref72=_asyncToGenerator(regeneratorRuntime.mark(function _callee55(args,help){var valid,data,script,addr,json;return regeneratorRuntime.wrap(function(_context55){for(;;)switch(_context55.prev=_context55.next){case 0:if(!help&&1===args.length){_context55.next=2;break}throw new RPCError(errs.MISC_ERROR,'decodescript "hex"');case 2:return valid=new Validator(args),data=valid.buf(0),script=new Script,data&&(script=Script.fromRaw(data)),addr=Address.fromScripthash(script.hash160()),(json=this.scriptToJSON(script)).p2sh=addr.toString(this.network),_context55.abrupt("return",json);case 10:case"end":return _context55.stop()}},_callee55,this)}));return function(_x106,_x107){return _ref72.apply(this,arguments)}}(),RPC.prototype.getRawTransaction=function(){var _ref73=_asyncToGenerator(regeneratorRuntime.mark(function _callee56(args,help){var valid,hash,verbose,meta,tx,entry,json;return regeneratorRuntime.wrap(function(_context56){for(;;)switch(_context56.prev=_context56.next){case 0:if(!(help||args.length<1||args.length>2)){_context56.next=2;break}throw new RPCError(errs.MISC_ERROR,'getrawtransaction "txid" ( verbose )');case 2:if(valid=new Validator(args),hash=valid.rhash(0),verbose=valid.bool(1,!1),hash){_context56.next=7;break}throw new RPCError(errs.TYPE_ERROR,"Invalid TXID.");case 7:return _context56.next=9,this.node.getMeta(hash);case 9:if(meta=_context56.sent){_context56.next=12;break}throw new RPCError(errs.MISC_ERROR,"Transaction not found.");case 12:if(tx=meta.tx,verbose){_context56.next=15;break}return _context56.abrupt("return",tx.toRaw().toString("hex"));case 15:if(entry=void 0,!meta.block){_context56.next=20;break}return _context56.next=19,this.chain.getEntry(meta.block);case 19:entry=_context56.sent;case 20:return(json=this.txToJSON(tx,entry)).time=meta.mtime,json.hex=tx.toRaw().toString("hex"),_context56.abrupt("return",json);case 24:case"end":return _context56.stop()}},_callee56,this)}));return function(_x108,_x109){return _ref73.apply(this,arguments)}}(),RPC.prototype.sendRawTransaction=function(){var _ref74=_asyncToGenerator(regeneratorRuntime.mark(function _callee57(args,help){var valid,data,tx;return regeneratorRuntime.wrap(function(_context57){for(;;)switch(_context57.prev=_context57.next){case 0:if(!(help||args.length<1||args.length>2)){_context57.next=2;break}throw new RPCError(errs.MISC_ERROR,'sendrawtransaction "hexstring" ( allowhighfees )');case 2:if(valid=new Validator(args),data=valid.buf(0)){_context57.next=6;break}throw new RPCError(errs.TYPE_ERROR,"Invalid hex string.");case 6:return tx=TX.fromRaw(data),this.node.relay(tx),_context57.abrupt("return",tx.txid());case 9:case"end":return _context57.stop()}},_callee57,this)}));return function(_x110,_x111){return _ref74.apply(this,arguments)}}(),RPC.prototype.signRawTransaction=function(){var _ref75=_asyncToGenerator(regeneratorRuntime.mark(function _callee58(args,help){var valid,data,prevout,secrets,sighash,tx,map,keys,_valid2,i,secret,key,_iterator17,_isArray17,_i18,_ref76,_valid3,hash,index,scriptRaw,value,redeemRaw,outpoint,script,coin,redeem,_iterator18,_isArray18,_i19,_ref77,op,_key,type,parts;return regeneratorRuntime.wrap(function(_context58){for(;;)switch(_context58.prev=_context58.next){case 0:if(!(help||args.length<1||args.length>4)){_context58.next=2;break}throw new RPCError(errs.MISC_ERROR,'signrawtransaction "hexstring" ( [{"txid":"id","vout":n,"scriptPubKey":"hex",redeemScript":"hex"},...] ["privatekey1",...] sighashtype )');case 2:if(valid=new Validator(args),data=valid.buf(0),prevout=valid.array(1),secrets=valid.array(2),sighash=valid.str(3),data){_context58.next=9;break}throw new RPCError(errs.TYPE_ERROR,"Invalid hex string.");case 9:if(this.mempool){_context58.next=11;break}throw new RPCError(errs.MISC_ERROR,"No mempool available.");case 11:return tx=MTX.fromRaw(data),_context58.next=14,this.mempool.getSpentView(tx);case 14:if(tx.view=_context58.sent,map=new Map,keys=[],secrets)for(_valid2=new Validator(secrets),i=0;i<secrets.length;i++)secret=_valid2.str(i,""),key=parseSecret(secret,this.network),map.set(key.getPublicKey("hex"),key),keys.push(key);if(!prevout){_context58.next=74;break}_iterator17=prevout,_isArray17=Array.isArray(_iterator17),_i18=0,_iterator17=_isArray17?_iterator17:_iterator17[Symbol.iterator]();case 20:if(!_isArray17){_context58.next=26;break}if(!(_i18>=_iterator17.length)){_context58.next=23;break}return _context58.abrupt("break",74);case 23:_ref76=_iterator17[_i18++],_context58.next=30;break;case 26:if(!(_i18=_iterator17.next()).done){_context58.next=29;break}return _context58.abrupt("break",74);case 29:_ref76=_i18.value;case 30:if(_valid3=new Validator(_ref76),hash=_valid3.rhash("txid"),index=_valid3.u32("vout"),scriptRaw=_valid3.buf("scriptPubKey"),value=_valid3.ufixed("amount",8),redeemRaw=_valid3.buf("redeemScript"),hash&&null!=index&&scriptRaw&&null!=value){_context58.next=39;break}throw new RPCError(errs.INVALID_PARAMETER,"Invalid UTXO.");case 39:if(outpoint=new Outpoint(hash,index),script=Script.fromRaw(scriptRaw),coin=Output.fromScript(script,value),tx.view.addOutput(outpoint,coin),0!==keys.length&&redeemRaw){_context58.next=45;break}return _context58.abrupt("continue",72);case 45:if(script.isScripthash()||script.isWitnessScripthash()){_context58.next=47;break}return _context58.abrupt("continue",72);case 47:if(redeemRaw){_context58.next=49;break}throw new RPCError(errs.INVALID_PARAMETER,"P2SH requires redeem script.");case 49:redeem=Script.fromRaw(redeemRaw),_iterator18=redeem.code,_isArray18=Array.isArray(_iterator18),_i19=0,_iterator18=_isArray18?_iterator18:_iterator18[Symbol.iterator]();case 51:if(!_isArray18){_context58.next=57;break}if(!(_i19>=_iterator18.length)){_context58.next=54;break}return _context58.abrupt("break",72);case 54:_ref77=_iterator18[_i19++],_context58.next=61;break;case 57:if(!(_i19=_iterator18.next()).done){_context58.next=60;break}return _context58.abrupt("break",72);case 60:_ref77=_i19.value;case 61:if((op=_ref77).data){_context58.next=64;break}return _context58.abrupt("continue",70);case 64:if(!(_key=map.get(op.data.toString("hex")))){_context58.next=70;break}return _key.script=redeem,_key.witness=script.isWitnessScripthash(),_key.refresh(),_context58.abrupt("break",72);case 70:_context58.next=51;break;case 72:_context58.next=20;break;case 74:if(type=Script.hashType.ALL,!sighash){_context58.next=86;break}if(!((parts=sighash.split("|")).length<1||parts.length>2)){_context58.next=79;break}throw new RPCError(errs.INVALID_PARAMETER,"Invalid sighash type.");case 79:if(null!=(type=Script.hashType[parts[0]])){_context58.next=82;break}throw new RPCError(errs.INVALID_PARAMETER,"Invalid sighash type.");case 82:if(2!==parts.length){_context58.next=86;break}if("ANYONECANPAY"===parts[1]){_context58.next=85;break}throw new RPCError(errs.INVALID_PARAMETER,"Invalid sighash type.");case 85:type|=Script.hashType.ANYONECANPAY;case 86:return _context58.next=88,tx.signAsync(keys,type,this.workers);case 88:return _context58.abrupt("return",{hex:tx.toRaw().toString("hex"),complete:tx.isSigned()});case 89:case"end":return _context58.stop()}},_callee58,this)}));return function(_x112,_x113){return _ref75.apply(this,arguments)}}(),RPC.prototype.createMultisig=function(){var _ref78=_asyncToGenerator(regeneratorRuntime.mark(function _callee59(args,help){var valid,keys,m,n,items,i,key,script,addr;return regeneratorRuntime.wrap(function(_context59){for(;;)switch(_context59.prev=_context59.next){case 0:if(!(help||args.length<2||args.length>2)){_context59.next=2;break}throw new RPCError(errs.MISC_ERROR,'createmultisig nrequired ["key",...]');case 2:if(valid=new Validator(args),keys=valid.array(1,[]),m=valid.u32(0,0),n=keys.length,!(m<1||n<m||n>16)){_context59.next=8;break}throw new RPCError(errs.INVALID_PARAMETER,"Invalid m and n values.");case 8:items=new Validator(keys),i=0;case 10:if(!(i<keys.length)){_context59.next=20;break}if(key=items.buf(i)){_context59.next=14;break}throw new RPCError(errs.TYPE_ERROR,"Invalid key.");case 14:if(secp256k1.publicKeyVerify(key)){_context59.next=16;break}throw new RPCError(errs.INVALID_ADDRESS_OR_KEY,"Invalid key.");case 16:keys[i]=key;case 17:i++,_context59.next=10;break;case 20:if(!((script=Script.fromMultisig(m,n,keys)).getSize()>consensus.MAX_SCRIPT_PUSH)){_context59.next=23;break}throw new RPCError(errs.VERIFY_ERROR,"Redeem script exceeds size limit.");case 23:return addr=script.getAddress(),_context59.abrupt("return",{address:addr.toString(this.network),redeemScript:script.toJSON()});case 25:case"end":return _context59.stop()}},_callee59,this)}));return function(_x114,_x115){return _ref78.apply(this,arguments)}}(),RPC.prototype.createWitnessAddress=function(){var _ref79=_asyncToGenerator(regeneratorRuntime.mark(function _callee60(args,help){var valid,raw,script,program,addr;return regeneratorRuntime.wrap(function(_context60){for(;;)switch(_context60.prev=_context60.next){case 0:if(!help&&1===args.length){_context60.next=2;break}throw new RPCError(errs.MISC_ERROR,'createwitnessaddress "script"');case 2:if(valid=new Validator(args),raw=valid.buf(0)){_context60.next=6;break}throw new RPCError(errs.TYPE_ERROR,"Invalid script hex.");case 6:return script=Script.fromRaw(raw),program=script.forWitness(),addr=program.getAddress(),_context60.abrupt("return",{address:addr.toString(this.network),witnessScript:program.toJSON()});case 10:case"end":return _context60.stop()}},_callee60,this)}));return function(_x116,_x117){return _ref79.apply(this,arguments)}}(),RPC.prototype.validateAddress=function(){var _ref80=_asyncToGenerator(regeneratorRuntime.mark(function _callee61(args,help){var valid,str,addr,script;return regeneratorRuntime.wrap(function(_context61){for(;;)switch(_context61.prev=_context61.next){case 0:if(!help&&1===args.length){_context61.next=2;break}throw new RPCError(errs.MISC_ERROR,'validateaddress "bitcoinaddress"');case 2:valid=new Validator(args),str=valid.str(0,""),addr=void 0,_context61.prev=5,addr=Address.fromString(str,this.network),_context61.next=12;break;case 9:return _context61.prev=9,_context61.t0=_context61.catch(5),_context61.abrupt("return",{isvalid:!1});case 12:return script=Script.fromAddress(addr),_context61.abrupt("return",{isvalid:!0,address:addr.toString(this.network),scriptPubKey:script.toJSON(),ismine:!1,iswatchonly:!1});case 14:case"end":return _context61.stop()}},_callee61,this,[[5,9]])}));return function(_x118,_x119){return _ref80.apply(this,arguments)}}(),RPC.prototype.verifyMessage=function(){var _ref81=_asyncToGenerator(regeneratorRuntime.mark(function _callee62(args,help){var valid,b58,sig,str,addr,msg,hash,key;return regeneratorRuntime.wrap(function(_context62){for(;;)switch(_context62.prev=_context62.next){case 0:if(!help&&3===args.length){_context62.next=2;break}throw new RPCError(errs.MISC_ERROR,'verifymessage "bitcoinaddress" "signature" "message"');case 2:if(valid=new Validator(args),b58=valid.str(0,""),sig=valid.buf(1,null,"base64"),str=valid.str(2),sig&&str){_context62.next=8;break}throw new RPCError(errs.TYPE_ERROR,"Invalid parameters.");case 8:if(addr=parseAddress(b58,this.network),msg=Buffer.from("Bitcoin Signed Message:\n"+str,"utf8"),hash=hash256.digest(msg),key=secp256k1.recover(hash,sig,0,!0)){_context62.next=14;break}return _context62.abrupt("return",!1);case 14:return _context62.abrupt("return",ccmp(hash160.digest(key),addr.hash));case 15:case"end":return _context62.stop()}},_callee62,this)}));return function(_x120,_x121){return _ref81.apply(this,arguments)}}(),RPC.prototype.signMessageWithPrivkey=function(){var _ref82=_asyncToGenerator(regeneratorRuntime.mark(function _callee63(args,help){var valid,wif,str,key,msg,hash,sig;return regeneratorRuntime.wrap(function(_context63){for(;;)switch(_context63.prev=_context63.next){case 0:if(!help&&2===args.length){_context63.next=2;break}throw new RPCError(errs.MISC_ERROR,'signmessagewithprivkey "privkey" "message"');case 2:return valid=new Validator(args),wif=valid.str(0,""),str=valid.str(1,""),key=parseSecret(wif,this.network),msg=Buffer.from("Bitcoin Signed Message:\n"+str,"utf8"),hash=hash256.digest(msg),sig=key.sign(hash),_context63.abrupt("return",sig.toString("base64"));case 10:case"end":return _context63.stop()}},_callee63,this)}));return function(_x122,_x123){return _ref82.apply(this,arguments)}}(),RPC.prototype.estimateFee=function(){var _ref83=_asyncToGenerator(regeneratorRuntime.mark(function _callee64(args,help){var valid,blocks,fee;return regeneratorRuntime.wrap(function(_context64){for(;;)switch(_context64.prev=_context64.next){case 0:if(!help&&1===args.length){_context64.next=2;break}throw new RPCError(errs.MISC_ERROR,"estimatefee nblocks");case 2:if(valid=new Validator(args),blocks=valid.u32(0,1),this.fees){_context64.next=6;break}throw new RPCError(errs.MISC_ERROR,"Fee estimation not available.");case 6:if(0!==(fee=this.fees.estimateFee(blocks,!1))){_context64.next=9;break}return _context64.abrupt("return",-1);case 9:return _context64.abrupt("return",Amount.btc(fee,!0));case 10:case"end":return _context64.stop()}},_callee64,this)}));return function(_x124,_x125){return _ref83.apply(this,arguments)}}(),RPC.prototype.estimatePriority=function(){var _ref84=_asyncToGenerator(regeneratorRuntime.mark(function _callee65(args,help){var valid,blocks;return regeneratorRuntime.wrap(function(_context65){for(;;)switch(_context65.prev=_context65.next){case 0:if(!help&&1===args.length){_context65.next=2;break}throw new RPCError(errs.MISC_ERROR,"estimatepriority nblocks");case 2:if(valid=new Validator(args),blocks=valid.u32(0,1),this.fees){_context65.next=6;break}throw new RPCError(errs.MISC_ERROR,"Priority estimation not available.");case 6:return _context65.abrupt("return",this.fees.estimatePriority(blocks,!1));case 7:case"end":return _context65.stop()}},_callee65,this)}));return function(_x126,_x127){return _ref84.apply(this,arguments)}}(),RPC.prototype.estimateSmartFee=function(){var _ref85=_asyncToGenerator(regeneratorRuntime.mark(function _callee66(args,help){var valid,blocks,fee;return regeneratorRuntime.wrap(function(_context66){for(;;)switch(_context66.prev=_context66.next){case 0:if(!help&&1===args.length){_context66.next=2;break}throw new RPCError(errs.MISC_ERROR,"estimatesmartfee nblocks");case 2:if(valid=new Validator(args),blocks=valid.u32(0,1),this.fees){_context66.next=6;break}throw new RPCError(errs.MISC_ERROR,"Fee estimation not available.");case 6:return fee=0===(fee=this.fees.estimateFee(blocks,!0))?-1:Amount.btc(fee,!0),_context66.abrupt("return",{fee:fee,blocks:blocks});case 9:case"end":return _context66.stop()}},_callee66,this)}));return function(_x128,_x129){return _ref85.apply(this,arguments)}}(),RPC.prototype.estimateSmartPriority=function(){var _ref86=_asyncToGenerator(regeneratorRuntime.mark(function _callee67(args,help){var valid,blocks,pri;return regeneratorRuntime.wrap(function(_context67){for(;;)switch(_context67.prev=_context67.next){case 0:if(!help&&1===args.length){_context67.next=2;break}throw new RPCError(errs.MISC_ERROR,"estimatesmartpriority nblocks");case 2:if(valid=new Validator(args),blocks=valid.u32(0,1),this.fees){_context67.next=6;break}throw new RPCError(errs.MISC_ERROR,"Priority estimation not available.");case 6:return pri=this.fees.estimatePriority(blocks,!0),_context67.abrupt("return",{priority:pri,blocks:blocks});case 8:case"end":return _context67.stop()}},_callee67,this)}));return function(_x130,_x131){return _ref86.apply(this,arguments)}}(),RPC.prototype.invalidateBlock=function(){var _ref87=_asyncToGenerator(regeneratorRuntime.mark(function _callee68(args,help){var valid,hash;return regeneratorRuntime.wrap(function(_context68){for(;;)switch(_context68.prev=_context68.next){case 0:if(!help&&1===args.length){_context68.next=2;break}throw new RPCError(errs.MISC_ERROR,'invalidateblock "hash"');case 2:if(valid=new Validator(args),hash=valid.rhash(0)){_context68.next=6;break}throw new RPCError(errs.TYPE_ERROR,"Invalid block hash.");case 6:return _context68.next=8,this.chain.invalidate(hash);case 8:return _context68.abrupt("return",null);case 9:case"end":return _context68.stop()}},_callee68,this)}));return function(_x132,_x133){return _ref87.apply(this,arguments)}}(),RPC.prototype.reconsiderBlock=function(){var _ref88=_asyncToGenerator(regeneratorRuntime.mark(function _callee69(args,help){var valid,hash;return regeneratorRuntime.wrap(function(_context69){for(;;)switch(_context69.prev=_context69.next){case 0:if(!help&&1===args.length){_context69.next=2;break}throw new RPCError(errs.MISC_ERROR,'reconsiderblock "hash"');case 2:if(valid=new Validator(args),hash=valid.rhash(0)){_context69.next=6;break}throw new RPCError(errs.TYPE_ERROR,"Invalid block hash.");case 6:return this.chain.removeInvalid(hash),_context69.abrupt("return",null);case 8:case"end":return _context69.stop()}},_callee69,this)}));return function(_x134,_x135){return _ref88.apply(this,arguments)}}(),RPC.prototype.setMockTime=function(){var _ref89=_asyncToGenerator(regeneratorRuntime.mark(function _callee70(args,help){var valid,time,delta;return regeneratorRuntime.wrap(function(_context70){for(;;)switch(_context70.prev=_context70.next){case 0:if(!help&&1===args.length){_context70.next=2;break}throw new RPCError(errs.MISC_ERROR,"setmocktime timestamp");case 2:if(valid=new Validator(args),null!=(time=valid.u32(0))){_context70.next=6;break}throw new RPCError(errs.TYPE_ERROR,"Invalid timestamp.");case 6:return this.network.time.offset=0,delta=this.network.now()-time,this.network.time.offset=-delta,_context70.abrupt("return",null);case 10:case"end":return _context70.stop()}},_callee70,this)}));return function(_x136,_x137){return _ref89.apply(this,arguments)}}(),RPC.prototype.getMemoryInfo=function(){var _ref90=_asyncToGenerator(regeneratorRuntime.mark(function _callee71(args,help){return regeneratorRuntime.wrap(function(_context71){for(;;)switch(_context71.prev=_context71.next){case 0:if(!help&&0===args.length){_context71.next=2;break}throw new RPCError(errs.MISC_ERROR,"getmemoryinfo");case 2:return _context71.abrupt("return",this.logger.memoryUsage());case 3:case"end":return _context71.stop()}},_callee71,this)}));return function(_x138,_x139){return _ref90.apply(this,arguments)}}(),RPC.prototype.setLogLevel=function(){var _ref91=_asyncToGenerator(regeneratorRuntime.mark(function _callee72(args,help){var valid,level;return regeneratorRuntime.wrap(function(_context72){for(;;)switch(_context72.prev=_context72.next){case 0:if(!help&&1===args.length){_context72.next=2;break}throw new RPCError(errs.MISC_ERROR,'setloglevel "level"');case 2:return valid=new Validator(args),level=valid.str(0,""),this.logger.setLevel(level),_context72.abrupt("return",null);case 6:case"end":return _context72.stop()}},_callee72,this)}));return function(_x140,_x141){return _ref91.apply(this,arguments)}}(),RPC.prototype.handleLongpoll=function(){var _ref92=_asyncToGenerator(regeneratorRuntime.mark(function _callee73(lpid){var watched,lastTX,hash;return regeneratorRuntime.wrap(function(_context73){for(;;)switch(_context73.prev=_context73.next){case 0:if(72===lpid.length){_context73.next=2;break}throw new RPCError(errs.INVALID_PARAMETER,"Invalid longpoll ID.");case 2:if(watched=lpid.slice(0,64),(lastTX=parseInt(lpid.slice(64,72),16))>>>0===lastTX){_context73.next=6;break}throw new RPCError(errs.INVALID_PARAMETER,"Invalid longpoll ID.");case 6:if(hash=util.revHex(watched),this.chain.tip.hash===hash){_context73.next=9;break}return _context73.abrupt("return");case 9:return _context73.next=11,this.longpoll();case 11:case"end":return _context73.stop()}},_callee73,this)}));return function(_x142){return _ref92.apply(this,arguments)}}(),RPC.prototype.longpoll=function(){var _this2=this;return new Promise(function(resolve,reject){_this2.pollers.push({resolve:resolve,reject:reject})})},RPC.prototype.refreshBlock=function(){var pollers=this.pollers;this.attempt=null,this.lastActivity=0,this.merkleMap.clear(),this.nonce1=0,this.nonce2=0,this.pollers=[];var _iterator19=pollers,_isArray19=Array.isArray(_iterator19),_i20=0;for(_iterator19=_isArray19?_iterator19:_iterator19[Symbol.iterator]();;){var _ref93;if(_isArray19){if(_i20>=_iterator19.length)break;_ref93=_iterator19[_i20++]}else{if((_i20=_iterator19.next()).done)break;_ref93=_i20.value}_ref93.resolve()}},RPC.prototype.bindChain=function(){var _this3=this;this.boundChain||(this.boundChain=!0,this.node.on("connect",function(){_this3.attempt&&_this3.refreshBlock()}),this.mempool&&this.node.on("tx",function(){_this3.attempt&&util.now()-_this3.lastActivity>10&&_this3.refreshBlock()}))},RPC.prototype.getTemplate=function(){var _ref94=_asyncToGenerator(regeneratorRuntime.mark(function _callee74(){var attempt;return regeneratorRuntime.wrap(function(_context74){for(;;)switch(_context74.prev=_context74.next){case 0:if(this.bindChain(),!(attempt=this.attempt)){_context74.next=6;break}this.miner.updateTime(attempt),_context74.next=11;break;case 6:return _context74.next=8,this.miner.createBlock();case 8:attempt=_context74.sent,this.attempt=attempt,this.lastActivity=util.now();case 11:return _context74.abrupt("return",attempt);case 12:case"end":return _context74.stop()}},_callee74,this)}));return function(){return _ref94.apply(this,arguments)}}(),RPC.prototype.updateWork=function(){var _ref95=_asyncToGenerator(regeneratorRuntime.mark(function _callee75(){var attempt,_n,_n2,_root,_hash3,n1,n2,root,hash;return regeneratorRuntime.wrap(function(_context75){for(;;)switch(_context75.prev=_context75.next){case 0:if(this.bindChain(),!(attempt=this.attempt)){_context75.next=13;break}if(!attempt.address.isNull()){_context75.next=5;break}throw new RPCError(errs.MISC_ERROR,"No addresses available for coinbase.");case 5:return this.miner.updateTime(attempt),4294967296==++this.nonce2&&(this.nonce2=0,this.nonce1++),_n=this.nonce1,_n2=this.nonce2,_root=attempt.getRoot(_n,_n2),_hash3=_root.toString("hex"),this.merkleMap.set(_hash3,[_n,_n2]),_context75.abrupt("return",attempt);case 13:if(0!==this.miner.addresses.length){_context75.next=15;break}throw new RPCError(errs.MISC_ERROR,"No addresses available for coinbase.");case 15:return _context75.next=17,this.miner.createBlock();case 17:return attempt=_context75.sent,n1=this.nonce1,n2=this.nonce2,root=attempt.getRoot(n1,n2),hash=root.toString("hex"),this.attempt=attempt,this.lastActivity=util.now(),this.merkleMap.set(hash,[n1,n2]),_context75.abrupt("return",attempt);case 26:case"end":return _context75.stop()}},_callee75,this)}));return function(){return _ref95.apply(this,arguments)}}(),RPC.prototype.addBlock=function(){var _ref96=_asyncToGenerator(regeneratorRuntime.mark(function _callee76(block){var unlock1,unlock2;return regeneratorRuntime.wrap(function(_context76){for(;;)switch(_context76.prev=_context76.next){case 0:return _context76.next=2,this.locker.lock();case 2:return unlock1=_context76.sent,_context76.next=5,this.chain.locker.lock();case 5:return unlock2=_context76.sent,_context76.prev=6,_context76.next=9,this._addBlock(block);case 9:return _context76.abrupt("return",_context76.sent);case 10:return _context76.prev=10,unlock2(),unlock1(),_context76.finish(10);case 14:case"end":return _context76.stop()}},_callee76,this,[[6,,10,14]])}));return function(_x143){return _ref96.apply(this,arguments)}}(),RPC.prototype._addBlock=function(){var _ref97=_asyncToGenerator(regeneratorRuntime.mark(function _callee77(block){var prev,tx,input,entry;return regeneratorRuntime.wrap(function(_context77){for(;;)switch(_context77.prev=_context77.next){case 0:return this.logger.info("Handling submitted block: %s.",block.rhash()),_context77.next=3,this.chain.getEntry(block.prevBlock);case 3:if(!(prev=_context77.sent)){_context77.next=9;break}return _context77.next=7,this.chain.getDeployments(block.time,prev);case 7:_context77.sent.hasWitness()&&block.getCommitmentHash()&&(tx=block.txs[0],input=tx.inputs[0],tx.hasWitness()||(this.logger.warning("Submitted block had no witness nonce."),this.logger.debug(tx),input.witness.push(consensus.ZERO_HASH),input.witness.compile(),tx.refresh(),block.refresh()));case 9:return entry=void 0,_context77.prev=10,_context77.next=13,this.chain._add(block);case 13:entry=_context77.sent,_context77.next=22;break;case 16:if(_context77.prev=16,_context77.t0=_context77.catch(10),"VerifyError"!==_context77.t0.type){_context77.next=21;break}return this.logger.warning("RPC block rejected: %s (%s).",block.rhash(),_context77.t0.reason),_context77.abrupt("return","rejected: "+_context77.t0.reason);case 21:throw _context77.t0;case 22:if(entry){_context77.next=25;break}return this.logger.warning("RPC block rejected: %s (bad-prevblk).",block.rhash()),_context77.abrupt("return","rejected: bad-prevblk");case 25:return _context77.abrupt("return",null);case 26:case"end":return _context77.stop()}},_callee77,this,[[10,16]])}));return function(_x144){return _ref97.apply(this,arguments)}}(),RPC.prototype.totalTX=function(){return this.mempool?this.mempool.map.size:0},RPC.prototype.getSoftforks=function(){return[toDeployment("bip34",2,this.chain.state.hasBIP34()),toDeployment("bip66",3,this.chain.state.hasBIP66()),toDeployment("bip65",4,this.chain.state.hasCLTV())]},RPC.prototype.getBIP9Softforks=function(){var _ref98=_asyncToGenerator(regeneratorRuntime.mark(function _callee78(){var tip,forks,_iterator20,_isArray20,_i21,_ref99,deployment,state,status;return regeneratorRuntime.wrap(function(_context78){for(;;)switch(_context78.prev=_context78.next){case 0:tip=this.chain.tip,forks={},_iterator20=this.network.deploys,_isArray20=Array.isArray(_iterator20),_i21=0,_iterator20=_isArray20?_iterator20:_iterator20[Symbol.iterator]();case 3:if(!_isArray20){_context78.next=9;break}if(!(_i21>=_iterator20.length)){_context78.next=6;break}return _context78.abrupt("break",36);case 6:_ref99=_iterator20[_i21++],_context78.next=13;break;case 9:if(!(_i21=_iterator20.next()).done){_context78.next=12;break}return _context78.abrupt("break",36);case 12:_ref99=_i21.value;case 13:return deployment=_ref99,_context78.next=16,this.chain.getState(tip,deployment);case 16:state=_context78.sent,status=void 0,_context78.t0=state,_context78.next=_context78.t0===common.thresholdStates.DEFINED?21:_context78.t0===common.thresholdStates.STARTED?23:_context78.t0===common.thresholdStates.LOCKED_IN?25:_context78.t0===common.thresholdStates.ACTIVE?27:_context78.t0===common.thresholdStates.FAILED?29:31;break;case 21:return status="defined",_context78.abrupt("break",33);case 23:return status="started",_context78.abrupt("break",33);case 25:return status="locked_in",_context78.abrupt("break",33);case 27:return status="active",_context78.abrupt("break",33);case 29:return status="failed",_context78.abrupt("break",33);case 31:return assert(!1,"Bad state."),_context78.abrupt("break",33);case 33:forks[deployment.name]={status:status,bit:deployment.bit,startTime:deployment.startTime,timeout:deployment.timeout};case 34:_context78.next=3;break;case 36:return _context78.abrupt("return",forks);case 37:case"end":return _context78.stop()}},_callee78,this)}));return function(){return _ref98.apply(this,arguments)}}(),RPC.prototype.getHashRate=function(){var _ref100=_asyncToGenerator(regeneratorRuntime.mark(function _callee79(lookup,height){var tip,min,max,entry,i,diff,work;return regeneratorRuntime.wrap(function(_context79){for(;;)switch(_context79.prev=_context79.next){case 0:if(tip=this.chain.tip,null==height){_context79.next=5;break}return _context79.next=4,this.chain.getEntry(height);case 4:tip=_context79.sent;case 5:if(tip){_context79.next=7;break}return _context79.abrupt("return",0);case 7:assert("number"==typeof lookup),assert(lookup>=0),0===lookup&&(lookup=tip.height%this.network.pow.retargetInterval+1),lookup>tip.height&&(lookup=tip.height),min=tip.time,max=min,entry=tip,i=0;case 15:if(!(i<lookup)){_context79.next=26;break}return _context79.next=18,this.chain.getPrevious(entry);case 18:if(entry=_context79.sent){_context79.next=21;break}throw new RPCError(errs.DATABASE_ERROR,"Not found.");case 21:min=Math.min(entry.time,min),max=Math.max(entry.time,max);case 23:i++,_context79.next=15;break;case 26:if(0!==(diff=max-min)){_context79.next=29;break}return _context79.abrupt("return",0);case 29:return work=tip.chainwork.sub(entry.chainwork),_context79.abrupt("return",Number(work.toString())/diff);case 31:case"end":return _context79.stop()}},_callee79,this)}));return function(_x145,_x146){return _ref100.apply(this,arguments)}}(),RPC.prototype.mineBlocks=function(){var _ref101=_asyncToGenerator(regeneratorRuntime.mark(function _callee80(blocks,addr,tries){var unlock;return regeneratorRuntime.wrap(function(_context80){for(;;)switch(_context80.prev=_context80.next){case 0:return _context80.next=2,this.locker.lock();case 2:return unlock=_context80.sent,_context80.prev=3,_context80.next=6,this._mineBlocks(blocks,addr,tries);case 6:return _context80.abrupt("return",_context80.sent);case 7:return _context80.prev=7,unlock(),_context80.finish(7);case 10:case"end":return _context80.stop()}},_callee80,this,[[3,,7,10]])}));return function(_x147,_x148,_x149){return _ref101.apply(this,arguments)}}(),RPC.prototype._mineBlocks=function(){var _ref102=_asyncToGenerator(regeneratorRuntime.mark(function _callee81(blocks,addr,tries){var hashes,i,block,entry;return regeneratorRuntime.wrap(function(_context81){for(;;)switch(_context81.prev=_context81.next){case 0:hashes=[],i=0;case 2:if(!(i<blocks)){_context81.next=14;break}return _context81.next=5,this.miner.mineBlock(null,addr);case 5:return block=_context81.sent,_context81.next=8,this.chain.add(block);case 8:entry=_context81.sent,assert(entry),hashes.push(entry.rhash());case 11:i++,_context81.next=2;break;case 14:return _context81.abrupt("return",hashes);case 15:case"end":return _context81.stop()}},_callee81,this)}));return function(_x150,_x151,_x152){return _ref102.apply(this,arguments)}}(),RPC.prototype.findFork=function(){var _ref103=_asyncToGenerator(regeneratorRuntime.mark(function _callee82(entry){return regeneratorRuntime.wrap(function(_context82){for(;;)switch(_context82.prev=_context82.next){case 0:if(!entry){_context82.next=10;break}return _context82.next=3,this.chain.isMainChain(entry);case 3:if(!_context82.sent){_context82.next=5;break}return _context82.abrupt("return",entry);case 5:return _context82.next=7,this.chain.getPrevious(entry);case 7:entry=_context82.sent,_context82.next=0;break;case 10:throw new Error("Fork not found.");case 11:case"end":return _context82.stop()}},_callee82,this)}));return function(_x153){return _ref103.apply(this,arguments)}}(),RPC.prototype.txToJSON=function(tx,entry){var height=-1,time=0,hash=null,conf=0;entry&&(height=entry.height,time=entry.time,hash=entry.rhash(),conf=this.chain.height-height+1);var vin=[],_iterator21=tx.inputs,_isArray21=Array.isArray(_iterator21),_i22=0;for(_iterator21=_isArray21?_iterator21:_iterator21[Symbol.iterator]();;){var _ref104;if(_isArray21){if(_i22>=_iterator21.length)break;_ref104=_iterator21[_i22++]}else{if((_i22=_iterator21.next()).done)break;_ref104=_i22.value}var input=_ref104,json={coinbase:void 0,txid:void 0,scriptSig:void 0,txinwitness:void 0,sequence:input.sequence};tx.isCoinbase()?json.coinbase=input.script.toJSON():(json.txid=input.prevout.txid(),json.vout=input.prevout.index,json.scriptSig={asm:input.script.toASM(),hex:input.script.toJSON()}),input.witness.items.length>0&&(json.txinwitness=input.witness.items.map(function(item){return item.toString("hex")})),vin.push(json)}for(var vout=[],i=0;i<tx.outputs.length;i++){var output=tx.outputs[i];vout.push({value:Amount.btc(output.value,!0),n:i,scriptPubKey:this.scriptToJSON(output.script,!0)})}return{txid:tx.txid(),hash:tx.wtxid(),size:tx.getSize(),vsize:tx.getVirtualSize(),version:tx.version,locktime:tx.locktime,vin:vin,vout:vout,blockhash:hash,confirmations:conf,time:time,blocktime:time,hex:void 0}},RPC.prototype.scriptToJSON=function(script,hex){var type=script.getType(),json={asm:script.toASM(),hex:void 0,type:Script.typesByVal[type],reqSigs:1,addresses:[],p2sh:void 0};hex&&(json.hex=script.toJSON());var m=script.getMultisig()[0];-1!==m&&(json.reqSigs=m);var addr=script.getAddress();if(addr){var str=addr.toString(this.network);json.addresses.push(str)}return json},RPC.prototype.headerToJSON=function(){var _ref105=_asyncToGenerator(regeneratorRuntime.mark(function _callee83(entry){var mtp,next;return regeneratorRuntime.wrap(function(_context83){for(;;)switch(_context83.prev=_context83.next){case 0:return _context83.next=2,this.chain.getMedianTime(entry);case 2:return mtp=_context83.sent,_context83.next=5,this.chain.getNextHash(entry.hash);case 5:return next=_context83.sent,_context83.abrupt("return",{hash:entry.rhash(),confirmations:this.chain.height-entry.height+1,height:entry.height,version:entry.version,versionHex:hex32(entry.version),merkleroot:util.revHex(entry.merkleRoot),time:entry.time,mediantime:mtp,bits:entry.bits,difficulty:toDifficulty(entry.bits),chainwork:entry.chainwork.toString("hex",64),previousblockhash:entry.prevBlock!==consensus.NULL_HASH?util.revHex(entry.prevBlock):null,nextblockhash:next?util.revHex(next):null});case 7:case"end":return _context83.stop()}},_callee83,this)}));return function(_x154){return _ref105.apply(this,arguments)}}(),RPC.prototype.blockToJSON=function(){var _ref106=_asyncToGenerator(regeneratorRuntime.mark(function _callee84(entry,block,details){var mtp,next,txs,_iterator22,_isArray22,_i23,_ref107,tx,json;return regeneratorRuntime.wrap(function(_context84){for(;;)switch(_context84.prev=_context84.next){case 0:return _context84.next=2,this.chain.getMedianTime(entry);case 2:return mtp=_context84.sent,_context84.next=5,this.chain.getNextHash(entry.hash);case 5:next=_context84.sent,txs=[],_iterator22=block.txs,_isArray22=Array.isArray(_iterator22),_i23=0,_iterator22=_isArray22?_iterator22:_iterator22[Symbol.iterator]();case 8:if(!_isArray22){_context84.next=14;break}if(!(_i23>=_iterator22.length)){_context84.next=11;break}return _context84.abrupt("break",26);case 11:_ref107=_iterator22[_i23++],_context84.next=18;break;case 14:if(!(_i23=_iterator22.next()).done){_context84.next=17;break}return _context84.abrupt("break",26);case 17:_ref107=_i23.value;case 18:if(tx=_ref107,!details){_context84.next=23;break}return json=this.txToJSON(tx,entry),txs.push(json),_context84.abrupt("continue",24);case 23:txs.push(tx.txid());case 24:_context84.next=8;break;case 26:return _context84.abrupt("return",{hash:entry.rhash(),confirmations:this.chain.height-entry.height+1,strippedsize:block.getBaseSize(),size:block.getSize(),weight:block.getWeight(),height:entry.height,version:entry.version,versionHex:hex32(entry.version),merkleroot:util.revHex(entry.merkleRoot),coinbase:block.txs[0].inputs[0].script.toJSON(),tx:txs,time:entry.time,mediantime:mtp,bits:entry.bits,difficulty:toDifficulty(entry.bits),chainwork:entry.chainwork.toString("hex",64),previousblockhash:entry.prevBlock!==consensus.NULL_HASH?util.revHex(entry.prevBlock):null,nextblockhash:next?util.revHex(next):null});case 27:case"end":return _context84.stop()}},_callee84,this)}));return function(_x155,_x156,_x157){return _ref106.apply(this,arguments)}}(),RPC.prototype.entryToJSON=function(entry){return{size:entry.size,fee:Amount.btc(entry.deltaFee,!0),modifiedfee:0,time:entry.time,height:entry.height,startingpriority:entry.priority,currentpriority:entry.getPriority(this.chain.height),descendantcount:this.mempool.countDescendants(entry),descendantsize:entry.descSize,descendantfees:entry.descFee,ancestorcount:this.mempool.countAncestors(entry),ancestorsize:0,ancestorfees:0,depends:this.mempool.getDepends(entry.tx).map(util.revHex)}},RPC}(RPCBase);function swap32(data){for(var i=0;i<data.length;i+=4){var field=data.readUInt32LE(i,!0);data.writeUInt32BE(field,i,!0)}return data}function toDeployment(id,version,status){return{id:id,version:version,reject:{status:status}}}function parseAddress(raw,network){try{return Address.fromString(raw,network)}catch(e){throw new RPCError(errs.INVALID_ADDRESS_OR_KEY,"Invalid address.")}}function parseSecret(raw,network){try{return KeyRing.fromSecret(raw,network)}catch(e){throw new RPCError(errs.INVALID_ADDRESS_OR_KEY,"Invalid key.")}}function parseIP(addr,network){try{return IP.fromHostname(addr,network.port)}catch(e){throw new RPCError(errs.CLIENT_INVALID_IP_OR_SUBNET,"Invalid IP address or subnet.")}}function parseNetAddress(addr,network){try{return NetAddress.fromHostname(addr,network)}catch(e){throw new RPCError(errs.CLIENT_INVALID_IP_OR_SUBNET,"Invalid IP address or subnet.")}}function toDifficulty(bits){for(var shift=bits>>>24&255,diff=65535/(16777215&bits);shift<29;)diff*=256,shift++;for(;shift>29;)diff/=256,shift--;return diff}function hex32(num){for(assert(num>=0),num=num.toString(16),assert(num.length<=8);num.length<8;)num="0"+num;return num}module.exports=RPC}).call(this,require("buffer").Buffer)},{"../blockchain/common":5,"../btc/amount":8,"../net/netaddress":53,"../pkg":67,"../primitives/address":69,"../primitives/block":70,"../primitives/headers":72,"../primitives/input":74,"../primitives/keyring":76,"../primitives/merkleblock":78,"../primitives/mtx":79,"../primitives/outpoint":80,"../primitives/output":81,"../primitives/tx":82,"../protocol/consensus":84,"../protocol/network":87,"../script/script":95,"../utils/util":106,assert:146,"bcrypto/lib/ccmp":156,"bcrypto/lib/hash160":159,"bcrypto/lib/hash256":160,"bcrypto/lib/secp256k1":184,binet:208,bmutex:214,buffer:269,bval:280,bweb:282}],66:[function(require,module,exports){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),Lock=require("bmutex").Lock,Chain=require("../blockchain/chain"),Pool=require("../net/pool"),Node=require("./node"),HTTP=require("./http"),RPC=require("./rpc"),SPVNode=function(_Node){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(SPVNode,_Node);function SPVNode(options){_classCallCheck(this,SPVNode);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Node.call(this,"bcoin","bcoin.conf","debug.log",options));return _this.opened=!1,_this.spv=!0,_this.chain=new Chain({network:_this.network,logger:_this.logger,prefix:_this.config.prefix,memory:_this.config.bool("memory"),maxFiles:_this.config.uint("max-files"),cacheSize:_this.config.mb("cache-size"),entryCache:_this.config.uint("entry-cache"),forceFlags:_this.config.bool("force-flags"),checkpoints:_this.config.bool("checkpoints"),bip91:_this.config.bool("bip91"),bip148:_this.config.bool("bip148"),spv:!0}),_this.pool=new Pool({network:_this.network,logger:_this.logger,chain:_this.chain,prefix:_this.config.prefix,proxy:_this.config.str("proxy"),onion:_this.config.bool("onion"),upnp:_this.config.bool("upnp"),seeds:_this.config.array("seeds"),nodes:_this.config.array("nodes"),only:_this.config.array("only"),bip151:_this.config.bool("bip151"),bip150:_this.config.bool("bip150"),identityKey:_this.config.buf("identity-key"),maxOutbound:_this.config.uint("max-outbound"),createSocket:_this.config.func("create-socket"),memory:_this.config.bool("memory"),selfish:!0,listen:!1}),_this.rpc=new RPC(_this),_this.http=new HTTP({network:_this.network,logger:_this.logger,node:_this,prefix:_this.config.prefix,ssl:_this.config.bool("ssl"),keyFile:_this.config.path("ssl-key"),certFile:_this.config.path("ssl-cert"),host:_this.config.str("http-host"),port:_this.config.uint("http-port"),apiKey:_this.config.str("api-key"),noAuth:_this.config.bool("no-auth")}),_this.rescanJob=null,_this.scanLock=new Lock,_this.watchLock=new Lock,_this.init(),_this}return SPVNode.prototype.init=function(){var _this2=this;this.chain.on("error",function(err){return _this2.error(err)}),this.pool.on("error",function(err){return _this2.error(err)}),this.http&&this.http.on("error",function(err){return _this2.error(err)}),this.pool.on("tx",function(tx){_this2.rescanJob||_this2.emit("tx",tx)}),this.chain.on("block",function(block){_this2.emit("block",block)}),this.chain.on("connect",function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(entry,block){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!_this2.rescanJob){_context.next=10;break}return _context.prev=1,_context.next=4,_this2.watchBlock(entry,block);case 4:_context.next=9;break;case 6:_context.prev=6,_context.t0=_context.catch(1),_this2.error(_context.t0);case 9:return _context.abrupt("return");case 10:_this2.emit("connect",entry,block);case 11:case"end":return _context.stop()}},_callee,_this2,[[1,6]])}));return function(_x,_x2){return _ref.apply(this,arguments)}}()),this.chain.on("disconnect",function(entry,block){_this2.emit("disconnect",entry,block)}),this.chain.on("reorganize",function(tip,competitor){_this2.emit("reorganize",tip,competitor)}),this.chain.on("reset",function(tip){_this2.emit("reset",tip)}),this.loadPlugins()},SPVNode.prototype.open=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return assert(!this.opened,"SPVNode is already open."),this.opened=!0,_context2.next=4,this.handlePreopen();case 4:return _context2.next=6,this.chain.open();case 6:return _context2.next=8,this.pool.open();case 8:return _context2.next=10,this.openPlugins();case 10:return _context2.next=12,this.http.open();case 12:return _context2.next=14,this.handleOpen();case 14:this.logger.info("Node is loaded.");case 15:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref2.apply(this,arguments)}}(),SPVNode.prototype.close=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return assert(this.opened,"SPVNode is not open."),this.opened=!1,_context3.next=4,this.handlePreclose();case 4:return _context3.next=6,this.http.close();case 6:return _context3.next=8,this.closePlugins();case 8:return _context3.next=10,this.pool.close();case 10:return _context3.next=12,this.chain.close();case 12:return _context3.next=14,this.handleClose();case 14:case"end":return _context3.stop()}},_callee3,this)}));return function(){return _ref3.apply(this,arguments)}}(),SPVNode.prototype.scan=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(start,filter,iter){var unlock;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,this.scanLock.lock();case 2:return unlock=_context4.sent,this.chain.height,_context4.prev=4,_context4.next=7,this.chain.replay(start);case 7:this.chain.height;case 8:return _context4.prev=8,unlock(),_context4.finish(8);case 11:case"end":return _context4.stop()}},_callee4,this,[[4,,8,11]])}));return function(_x3,_x4,_x5){return _ref4.apply(this,arguments)}}(),SPVNode.prototype.watchUntil=function(height,iter){var _this3=this;return new Promise(function(resolve,reject){_this3.rescanJob=new RescanJob(resolve,reject,height,iter)})},SPVNode.prototype.watchBlock=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(entry,block){var unlock;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,this.watchLock.lock();case 2:if(unlock=_context5.sent,_context5.prev=3,!(entry.height<this.rescanJob.height)){_context5.next=8;break}return _context5.next=7,this.rescanJob.iter(entry,block.txs);case 7:return _context5.abrupt("return");case 8:this.rescanJob.resolve(),this.rescanJob=null,_context5.next=16;break;case 12:_context5.prev=12,_context5.t0=_context5.catch(3),this.rescanJob.reject(_context5.t0),this.rescanJob=null;case 16:return _context5.prev=16,unlock(),_context5.finish(16);case 19:case"end":return _context5.stop()}},_callee5,this,[[3,12,16,19]])}));return function(_x6,_x7){return _ref5.apply(this,arguments)}}(),SPVNode.prototype.broadcast=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(item){return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.prev=0,_context6.next=3,this.pool.broadcast(item);case 3:_context6.next=8;break;case 5:_context6.prev=5,_context6.t0=_context6.catch(0),this.emit("error",_context6.t0);case 8:case"end":return _context6.stop()}},_callee6,this,[[0,5]])}));return function(_x8){return _ref6.apply(this,arguments)}}(),SPVNode.prototype.sendTX=function(tx){return this.broadcast(tx)},SPVNode.prototype.relay=function(tx){return this.broadcast(tx)},SPVNode.prototype.connect=function(){return this.pool.connect()},SPVNode.prototype.disconnect=function(){return this.pool.disconnect()},SPVNode.prototype.startSync=function(){return this.pool.startSync()},SPVNode.prototype.stopSync=function(){return this.pool.stopSync()},SPVNode}(Node),RescanJob=function RescanJob(resolve,reject,height,iter){_classCallCheck(this,RescanJob),this.resolve=resolve,this.reject=reject,this.height=height,this.iter=iter};module.exports=SPVNode},{"../blockchain/chain":2,"../net/pool":57,"./http":62,"./node":64,"./rpc":65,assert:146,bmutex:214}],67:[function(require,module,exports){"use strict";exports.version="v1.0.0-pre",exports.url="https://github.com/bcash-org/bcash"},{}],68:[function(require,module,exports){"use strict";var assert=require("assert"),hash256=require("bcrypto/lib/hash256"),bio=require("bufio"),util=require("../utils/util"),InvItem=require("./invitem"),consensus=require("../protocol/consensus"),AbstractBlock=function(){function AbstractBlock(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AbstractBlock),this.version=1,this.prevBlock=consensus.NULL_HASH,this.merkleRoot=consensus.NULL_HASH,this.time=0,this.bits=0,this.nonce=0,this.mutable=!1,this._hash=null,this._hhash=null}return AbstractBlock.prototype.parseOptions=function(options){return assert(options,"Block data is required."),assert(options.version>>>0===options.version),assert("string"==typeof options.prevBlock),assert("string"==typeof options.merkleRoot),assert(options.time>>>0===options.time),assert(options.bits>>>0===options.bits),assert(options.nonce>>>0===options.nonce),this.version=options.version,this.prevBlock=options.prevBlock,this.merkleRoot=options.merkleRoot,this.time=options.time,this.bits=options.bits,this.nonce=options.nonce,null!=options.mutable&&(assert("boolean"==typeof options.mutable),this.mutable=options.mutable),this},AbstractBlock.prototype.parseJSON=function(json){return assert(json,"Block data is required."),assert(json.version>>>0===json.version),assert("string"==typeof json.prevBlock),assert("string"==typeof json.merkleRoot),assert(json.time>>>0===json.time),assert(json.bits>>>0===json.bits),assert(json.nonce>>>0===json.nonce),this.version=json.version,this.prevBlock=util.revHex(json.prevBlock),this.merkleRoot=util.revHex(json.merkleRoot),this.time=json.time,this.bits=json.bits,this.nonce=json.nonce,this},AbstractBlock.prototype.isMemory=function(){return!1},AbstractBlock.prototype._refresh=function(){this._hash=null,this._hhash=null},AbstractBlock.prototype.refresh=function(){return this._refresh()},AbstractBlock.prototype.hash=function(enc){var h=this._hash;if(h||(h=hash256.digest(this.toHead()),this.mutable||(this._hash=h)),"hex"===enc){var hex=this._hhash;hex||(hex=h.toString("hex"),this.mutable||(this._hhash=hex)),h=hex}return h},AbstractBlock.prototype.toHead=function(){return this.writeHead(bio.write(80)).render()},AbstractBlock.prototype.fromHead=function(data){return this.readHead(bio.read(data))},AbstractBlock.prototype.writeHead=function(bw){return bw.writeU32(this.version),bw.writeHash(this.prevBlock),bw.writeHash(this.merkleRoot),bw.writeU32(this.time),bw.writeU32(this.bits),bw.writeU32(this.nonce),bw},AbstractBlock.prototype.readHead=function(br){return this.version=br.readU32(),this.prevBlock=br.readHash("hex"),this.merkleRoot=br.readHash("hex"),this.time=br.readU32(),this.bits=br.readU32(),this.nonce=br.readU32(),this},AbstractBlock.prototype.verify=function(){return!!this.verifyPOW()&&!!this.verifyBody()},AbstractBlock.prototype.verifyPOW=function(){return consensus.verifyPOW(this.hash(),this.bits)},AbstractBlock.prototype.verifyBody=function(){throw new Error("Abstract method.")},AbstractBlock.prototype.rhash=function(){return util.revHex(this.hash("hex"))},AbstractBlock.prototype.toInv=function(){return new InvItem(InvItem.types.BLOCK,this.hash("hex"))},AbstractBlock}();module.exports=AbstractBlock},{"../protocol/consensus":84,"../utils/util":106,"./invitem":75,assert:146,"bcrypto/lib/hash256":160,bufio:270}],69:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),bio=require("bufio"),_require=require("bstring"),base58=_require.base58,bech32=_require.bech32,hash160=(require("bcrypto/lib/sha256"),require("bcrypto/lib/hash160")),hash256=require("bcrypto/lib/hash256"),Network=require("../protocol/network"),consensus=require("../protocol/consensus"),ZERO_HASH160=Buffer.alloc(20,0),Address=function(){function Address(options,network){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Address),this.type=Address.types.PUBKEYHASH,this.version=-1,this.hash=ZERO_HASH160,options&&this.fromOptions(options,network)}return Address.prototype.fromOptions=function(options,network){if("string"==typeof options)return this.fromString(options,network);assert(options);var hash=options.hash,type=options.type,version=options.version;return this.fromHash(hash,type,version)},Address.fromOptions=function(options,network){return(new this).fromOptions(options,network)},Address.prototype.getHash=function(enc){return"hex"===enc?this.hash.toString(enc):this.hash},Address.prototype.isNull=function(){if(20===this.hash.length)return this.hash.equals(ZERO_HASH160);if(32===this.hash.length)return this.hash.equals(consensus.ZERO_HASH);for(var i=0;i<this.hash.length;i++)if(0!==this.hash[i])return!1;return!0},Address.prototype.equals=function(addr){return assert(addr instanceof Address),this.type===addr.type&&this.version===addr.version&&this.hash.equals(addr.hash)},Address.prototype.getType=function(){return Address.typesByVal[this.type].toLowerCase()},Address.prototype.getPrefix=function(network){var prefixes=(network=Network.get(network)).addressPrefix;switch(this.type){case Address.types.PUBKEYHASH:return prefixes.pubkeyhash;case Address.types.SCRIPTHASH:return prefixes.scripthash}return-1},Address.prototype.getSize=function(){var size=5+this.hash.length;return-1!==this.version&&(size+=2),size},Address.prototype.toRaw=function(network){var size=this.getSize(),bw=bio.write(size),prefix=this.getPrefix(network);return assert(-1!==prefix,"Not a valid address prefix."),bw.writeU8(prefix),-1!==this.version&&(bw.writeU8(this.version),bw.writeU8(0)),bw.writeBytes(this.hash),bw.writeChecksum(hash256.digest),bw.render()},Address.prototype.toBase58=function(network){return base58.encode(this.toRaw(network))},Address.prototype.toBech32=function(network){var version=this.version,hash=this.hash;assert(-1!==version,"Cannot convert non-program address to bech32.");var hrp=(network=Network.get(network)).addressPrefix.bech32;return bech32.encode(hrp,version,hash)},Address.prototype.fromString=function(addr,network){if(assert("string"==typeof addr),assert(addr.length>0),assert(addr.length<=100),function(str){for(var lower=!1,upper=!1,i=0;i<str.length;i++){var ch=str.charCodeAt(i);if(!(ch>=48&&ch<=57)&&(32&ch?(assert(ch>=97&&ch<=122),lower=!0):(assert(ch>=65&&ch<=90),upper=!0),lower&&upper))return!0}return!1}(addr))return this.fromBase58(addr,network);try{return this.fromBech32(addr,network)}catch(e){return this.fromBase58(addr,network)}},Address.fromString=function(addr,network){return(new this).fromString(addr,network)},Address.prototype.toString=function(network){return-1!==this.version?this.toBech32(network):this.toBase58(network)},Address.prototype.inspect=function(){return"<Address: type="+this.getType()+" version="+this.version+" str="+this.toString()+">"},Address.prototype.fromRaw=function(data,network){var br=bio.read(data,!0),prefix=br.readU8();network=Network.fromAddress(prefix,network);var type=Address.getType(prefix,network),version=-1;if(type===Address.types.WITNESS){if(data.length>38)throw new Error("Address is too long.");if(version=br.readU8(),0!==br.readU8())throw new Error("Address version padding is non-zero.")}else if(25!==data.length)throw new Error("Address is too long.");var hash=br.readBytes(br.left()-4);return br.verifyChecksum(hash256.digest),this.fromHash(hash,type,version)},Address.fromRaw=function(data,network){return(new this).fromRaw(data,network)},Address.prototype.fromBase58=function(data,network){if(assert("string"==typeof data),data.length>55)throw new Error("Address is too long.");return this.fromRaw(base58.decode(data),network)},Address.fromBase58=function(data,network){return(new this).fromBase58(data,network)},Address.prototype.fromBech32=function(data,network){var type=Address.types.WITNESS;assert("string"==typeof data);var addr=bech32.decode(data);return Network.fromBech32(addr.hrp,network),this.fromHash(addr.hash,type,addr.version)},Address.fromBech32=function(data,network){return(new this).fromBech32(data,network)},Address.prototype.fromScript=function(script){var pk=script.getPubkey();if(pk)return this.hash=hash160.digest(pk),this.type=Address.types.PUBKEYHASH,this.version=-1,this;var pkh=script.getPubkeyhash();if(pkh)return this.hash=pkh,this.type=Address.types.PUBKEYHASH,this.version=-1,this;var sh=script.getScripthash();if(sh)return this.hash=sh,this.type=Address.types.SCRIPTHASH,this.version=-1,this;var program=script.getProgram();return program&&!program.isMalformed()?(this.hash=program.data,this.type=Address.types.WITNESS,this.version=program.version,this):script.isMultisig()?(this.hash=script.hash160(),this.type=Address.types.SCRIPTHASH,this.version=-1,this):null},Address.prototype.fromInputScript=function(script){var pk=script.getPubkeyhashInput()[1];if(pk)return this.hash=hash160.digest(pk),this.type=Address.types.PUBKEYHASH,this.version=-1,this;var redeem=script.getScripthashInput();return redeem?(this.hash=hash160.digest(redeem),this.type=Address.types.SCRIPTHASH,this.version=-1,this):null},Address.fromWitness=function(witness){return(new this).fromWitness(witness)},Address.fromInputScript=function(script){return(new this).fromInputScript(script)},Address.fromScript=function(script){return(new this).fromScript(script)},Address.prototype.fromHash=function(hash,type,version){return"string"==typeof hash&&(hash=Buffer.from(hash,"hex")),"string"==typeof type&&(type=Address.types[type.toUpperCase()],assert(null!=type,"Not a valid address type.")),null==type&&(type=Address.types.PUBKEYHASH),null==version&&(version=-1),assert(Buffer.isBuffer(hash)),assert(type>>>0===type),assert((0|version)===version),assert(type>=Address.types.PUBKEYHASH,"Not a valid address type."),-1===version?(assert(type!==Address.types.WITNESS,"Wrong version (witness)"),assert(20===hash.length,"Hash is the wrong size.")):(assert(type===Address.types.WITNESS,"Wrong version (non-witness)."),assert(version>=0&&version<=16,"Bad program version."),0===version&&type===Address.types.WITNESS&&assert(20===hash.length||32===hash.length,"Witness program hash is the wrong size."),assert(hash.length>=2&&hash.length<=40,"Hash is the wrong size.")),this.hash=hash,this.type=type,this.version=version,this},Address.fromHash=function(hash,type,version){return(new this).fromHash(hash,type,version)},Address.prototype.fromPubkeyhash=function(hash){var type=Address.types.PUBKEYHASH;return assert(20===hash.length,"P2PKH must be 20 bytes."),this.fromHash(hash,type,-1)},Address.fromPubkeyhash=function(hash){return(new this).fromPubkeyhash(hash)},Address.prototype.fromScripthash=function(hash){var type=Address.types.SCRIPTHASH;return assert(hash&&20===hash.length,"P2SH must be 20 bytes."),this.fromHash(hash,type,-1)},Address.fromScripthash=function(hash){return(new this).fromScripthash(hash)},Address.prototype.fromProgram=function(version,hash){var type=Address.types.WITNESS;return assert(version>=0,"Bad version for witness program."),"string"==typeof hash&&(hash=Buffer.from(hash,"hex")),this.fromHash(hash,type,version)},Address.fromProgram=function(version,hash){return(new this).fromProgram(version,hash)},Address.prototype.isPubkeyhash=function(){return this.type===Address.types.PUBKEYHASH},Address.prototype.isScripthash=function(){return this.type===Address.types.SCRIPTHASH},Address.prototype.isProgram=function(){return-1!==this.version},Address.prototype.isUnknown=function(){return-1!==this.version&&(this.version>0||20!==this.hash.length&&32!==this.hash.length)},Address.getHash=function(data,enc,network){if(!data)throw new Error("Object is not an address.");var hash=void 0;if("string"==typeof data){if(40===data.length||64===data.length)return"hex"===enc?data:Buffer.from(data,"hex");hash=Address.fromString(data,network).hash}else if(Buffer.isBuffer(data)){if(20!==data.length&&32!==data.length)throw new Error("Object is not an address.");hash=data}else{if(!(data instanceof Address))throw new Error("Object is not an address.");hash=data.hash}return"hex"===enc?hash.toString("hex"):hash},Address.getType=function(prefix,network){var prefixes=network.addressPrefix;switch(prefix){case prefixes.pubkeyhash:return Address.types.PUBKEYHASH;case prefixes.scripthash:return Address.types.SCRIPTHASH;default:throw new Error("Unknown address prefix.")}},Address}();Address.types={PUBKEYHASH:0,SCRIPTHASH:1},Address.typesByVal=["PUBKEYHASH","SCRIPTHASH"];module.exports=Address}).call(this,require("buffer").Buffer)},{"../protocol/consensus":84,"../protocol/network":87,assert:146,"bcrypto/lib/hash160":159,"bcrypto/lib/hash256":160,"bcrypto/lib/sha256":186,bstring:265,buffer:269,bufio:270}],70:[function(require,module,exports){(function(Buffer){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),bio=require("bufio"),util=require("../utils/util"),hash256=require("bcrypto/lib/hash256"),merkle=require("bcrypto/lib/merkle"),consensus=require("../protocol/consensus"),AbstractBlock=require("./abstractblock"),TX=require("./tx"),MerkleBlock=require("./merkleblock"),Headers=require("./headers"),Network=require("../protocol/network"),encoding=bio.encoding,Block=function(_AbstractBlock){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Block,_AbstractBlock);function Block(options){_classCallCheck(this,Block);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_AbstractBlock.call(this));return _this.txs=[],_this._raw=null,_this._size=-1,options&&_this.fromOptions(options),_this}return Block.prototype.fromOptions=function(options){if(this.parseOptions(options),options.txs){assert(Array.isArray(options.txs));var _iterator=options.txs,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var tx=_ref;assert(tx instanceof TX),this.txs.push(tx)}}},Block.fromOptions=function(options){return(new this).fromOptions(options)},Block.prototype.refresh=function(all){if(this._refresh(),this._raw=null,this._size=-1,all){var _iterator2=this.txs,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref2=_i2.value}_ref2.refresh()}}},Block.prototype.toRaw=function(){return this.frame().data},Block.prototype.toNormal=function(){return this.frameNormal().data},Block.prototype.toWriter=function(bw){if(this.mutable)return this.writeNormal(bw);var raw=this.frame();return bw.writeBytes(raw.data),bw},Block.prototype.toNormalWriter=function(bw){return this.hasWitness()?(this.writeNormal(bw),bw):this.toWriter(bw)},Block.prototype.frame=function(){if(this.mutable)return assert(!this._raw),this.frameNormal();if(this._raw){assert(this._size>=0);var _raw=new RawBlock(this._size);return _raw.data=this._raw,_raw}var raw=this.frameNormal();return this._raw=raw.data,this._size=raw.size,raw},Block.prototype.getSizes=function(){return this.mutable?this.getNormalSizes():this.frame()},Block.prototype.getVirtualSize=function(){var scale=consensus.WITNESS_SCALE_FACTOR;return(this.getWeight()+scale-1)/scale|0},Block.prototype.getWeight=function(){var raw=this.getSizes();return(raw.size-raw.witness)*(consensus.WITNESS_SCALE_FACTOR-1)+raw.size},Block.prototype.getSize=function(){return this.getSizes().size},Block.prototype.getBaseSize=function(){return this.getSizes().size},Block.prototype.hasWitness=function(){if(-1!==this._witness)return 0!==this._witness;var _iterator3=this.txs,_isArray3=Array.isArray(_iterator3),_i3=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref3;if(_isArray3){if(_i3>=_iterator3.length)break;_ref3=_iterator3[_i3++]}else{if((_i3=_iterator3.next()).done)break;_ref3=_i3.value}if(_ref3.hasWitness())return!0}return!1},Block.prototype.hasTX=function(hash){return-1!==this.indexOf(hash)},Block.prototype.indexOf=function(hash){for(var i=0;i<this.txs.length;i++){if(this.txs[i].hash("hex")===hash)return i}return-1},Block.prototype.createMerkleRoot=function(enc){var leaves=[],_iterator4=this.txs,_isArray4=Array.isArray(_iterator4),_i4=0;for(_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();;){var _ref4;if(_isArray4){if(_i4>=_iterator4.length)break;_ref4=_iterator4[_i4++]}else{if((_i4=_iterator4.next()).done)break;_ref4=_i4.value}var tx=_ref4;leaves.push(tx.hash())}var _merkle$createRoot=merkle.createRoot(hash256,leaves),root=_merkle$createRoot[0];return _merkle$createRoot[1]?null:"hex"===enc?root.toString("hex"):root},Block.prototype.createNonce=function(){return Buffer.from(consensus.ZERO_HASH)},Block.prototype.createCommitmentHash=function(enc){var nonce=this.getNonce(),leaves=[];assert(nonce,"No witness nonce present."),leaves.push(consensus.ZERO_HASH);for(var i=1;i<this.txs.length;i++){var tx=this.txs[i];leaves.push(tx.hash())}var root=merkle.createRoot(hash256,leaves)[0],hash=hash256.root(root,nonce);return"hex"===enc?hash.toString("hex"):hash},Block.prototype.getMerkleRoot=function(enc){return"hex"===enc?this.merkleRoot:Buffer.from(this.merkleRoot,"hex")},Block.prototype.getNonce=function(){if(0===this.txs.length)return null;var coinbase=this.txs[0];if(1!==coinbase.inputs.length)return null;var input=coinbase.inputs[0];return 1!==input.witness.items.length?null:32!==input.witness.items[0].length?null:input.witness.items[0]},Block.prototype.getCommitmentHash=function(enc){if(0===this.txs.length)return null;for(var coinbase=this.txs[0],hash=null,i=coinbase.outputs.length-1;i>=0;i--){var output=coinbase.outputs[i];if(output.script.isCommitment()){hash=output.script.getCommitment();break}}return hash?"hex"===enc?hash.toString("hex"):hash:null},Block.prototype.verifyBody=function(){return this.checkBody()[0]},Block.prototype.checkBody=function(){var root=this.createMerkleRoot("hex");if(!root)return[!1,"bad-txns-duplicate",100];if(this.merkleRoot!==root)return[!1,"bad-txnmrklroot",100];if(0===this.txs.length||this.txs.length>consensus.ONE_MEGABYTE||this.getBaseSize()>consensus.MAX_BLOCK_SIZE)return[!1,"bad-blk-length",100];if(0===this.txs.length||!this.txs[0].isCoinbase())return[!1,"bad-cb-missing",100];consensus.WITNESS_SCALE_FACTOR;for(var sigops=0,i=0;i<this.txs.length;i++){var tx=this.txs[i];if(i>0&&tx.isCoinbase())return[!1,"bad-cb-multiple",100];var _tx$checkSanity=tx.checkSanity(),valid=_tx$checkSanity[0],reason=_tx$checkSanity[1],score=_tx$checkSanity[2];if(!valid)return[valid,reason,score];if((sigops+=tx.getLegacySigops())>consensus.MAX_BLOCK_SIGOPS)return[!1,"bad-blk-sigops",100]}return[!0,"valid",0]},Block.prototype.getCoinbaseHeight=function(){if(this.version<2)return-1;if(0===this.txs.length)return-1;var coinbase=this.txs[0];return 0===coinbase.inputs.length?-1:coinbase.inputs[0].script.getCoinbaseHeight()},Block.prototype.getClaimed=function(){return assert(this.txs.length>0),assert(this.txs[0].isCoinbase()),this.txs[0].getOutputValue()},Block.prototype.getPrevout=function(){for(var prevout=Object.create(null),i=1;i<this.txs.length;i++){var _iterator5=this.txs[i].inputs,_isArray5=Array.isArray(_iterator5),_i5=0;for(_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();;){var _ref5;if(_isArray5){if(_i5>=_iterator5.length)break;_ref5=_iterator5[_i5++]}else{if((_i5=_iterator5.next()).done)break;_ref5=_i5.value}prevout[_ref5.prevout.hash]=!0}}return Object.keys(prevout)},Block.prototype.inspect=function(){return this.format()},Block.prototype.format=function(view,height){var commitmentHash=this.getCommitmentHash("hex");return{hash:this.rhash(),height:null!=height?height:-1,size:this.getSize(),virtualSize:this.getVirtualSize(),date:util.date(this.time),version:this.version.toString(16),prevBlock:util.revHex(this.prevBlock),merkleRoot:util.revHex(this.merkleRoot),commitmentHash:commitmentHash?util.revHex(commitmentHash):null,time:this.time,bits:this.bits,nonce:this.nonce,txs:this.txs.map(function(tx,i){return tx.format(view,null,i)})}},Block.prototype.toJSON=function(){return this.getJSON()},Block.prototype.getJSON=function(network,view,height,depth){return network=Network.get(network),{hash:this.rhash(),height:height,depth:depth,version:this.version,prevBlock:util.revHex(this.prevBlock),merkleRoot:util.revHex(this.merkleRoot),time:this.time,bits:this.bits,nonce:this.nonce,txs:this.txs.map(function(tx,i){return tx.getJSON(network,view,null,i)})}},Block.prototype.fromJSON=function(json){assert(json,"Block data is required."),assert(Array.isArray(json.txs)),this.parseJSON(json);var _iterator6=json.txs,_isArray6=Array.isArray(_iterator6),_i6=0;for(_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();;){var _ref6;if(_isArray6){if(_i6>=_iterator6.length)break;_ref6=_iterator6[_i6++]}else{if((_i6=_iterator6.next()).done)break;_ref6=_i6.value}var tx=_ref6;this.txs.push(TX.fromJSON(tx))}return this},Block.fromJSON=function(json){return(new this).fromJSON(json)},Block.prototype.fromReader=function(br){br.start(),this.readHead(br);for(var count=br.readVarint(),i=0;i<count;i++){var tx=TX.fromReader(br);this.txs.push(tx)}return this.mutable||(this._raw=br.endData(),this._size=this._raw.length),this},Block.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},Block.fromReader=function(data){return(new this).fromReader(data)},Block.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},Block.prototype.toMerkle=function(filter){return MerkleBlock.fromBlock(this,filter)},Block.prototype.writeNormal=function(bw){this.writeHead(bw),bw.writeVarint(this.txs.length);var _iterator7=this.txs,_isArray7=Array.isArray(_iterator7),_i7=0;for(_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();;){var _ref7;if(_isArray7){if(_i7>=_iterator7.length)break;_ref7=_iterator7[_i7++]}else{if((_i7=_iterator7.next()).done)break;_ref7=_i7.value}_ref7.toNormalWriter(bw)}return bw},Block.prototype.writeWitness=function(bw){this.writeHead(bw),bw.writeVarint(this.txs.length);var _iterator8=this.txs,_isArray8=Array.isArray(_iterator8),_i8=0;for(_iterator8=_isArray8?_iterator8:_iterator8[Symbol.iterator]();;){var _ref8;if(_isArray8){if(_i8>=_iterator8.length)break;_ref8=_iterator8[_i8++]}else{if((_i8=_iterator8.next()).done)break;_ref8=_i8.value}_ref8.toWriter(bw)}return bw},Block.prototype.frameNormal=function(){var raw=this.getNormalSizes(),bw=bio.write(raw.size);return this.writeNormal(bw),raw.data=bw.render(),raw},Block.prototype.toHeaders=function(){return Headers.fromBlock(this)},Block.prototype.getNormalSizes=function(){var size=0;size+=80,size+=encoding.sizeVarint(this.txs.length);var _iterator9=this.txs,_isArray9=Array.isArray(_iterator9),_i9=0;for(_iterator9=_isArray9?_iterator9:_iterator9[Symbol.iterator]();;){var _ref9;if(_isArray9){if(_i9>=_iterator9.length)break;_ref9=_iterator9[_i9++]}else{if((_i9=_iterator9.next()).done)break;_ref9=_i9.value}size+=_ref9.getBaseSize()}return new RawBlock(size,0)},Block.isBlock=function(obj){return obj instanceof Block},Block}(AbstractBlock),RawBlock=function RawBlock(size){_classCallCheck(this,RawBlock),this.data=null,this.size=size};module.exports=Block}).call(this,require("buffer").Buffer)},{"../protocol/consensus":84,"../protocol/network":87,"../utils/util":106,"./abstractblock":68,"./headers":72,"./merkleblock":78,"./tx":82,assert:146,"bcrypto/lib/hash256":160,"bcrypto/lib/merkle":177,buffer:269,bufio:270}],71:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),bio=require("bufio"),util=require("../utils/util"),Amount=require("../btc/amount"),Output=require("./output"),Network=require("../protocol/network"),consensus=require("../protocol/consensus"),Coin=function(_Output){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Coin,_Output);function Coin(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Coin);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Output.call(this));return _this.version=1,_this.height=-1,_this.coinbase=!1,_this.hash=consensus.NULL_HASH,_this.index=0,options&&_this.fromOptions(options),_this}return Coin.prototype.fromOptions=function(options){return assert(options,"Coin data is required."),null!=options.version&&(assert(options.version>>>0===options.version,"Version must be a uint32."),this.version=options.version),null!=options.height&&(-1!==options.height?(assert(options.height>>>0===options.height,"Height must be a uint32."),this.height=options.height):this.height=-1),null!=options.value&&(assert(Number.isSafeInteger(options.value)&&options.value>=0,"Value must be a uint64."),this.value=options.value),options.script&&this.script.fromOptions(options.script),null!=options.coinbase&&(assert("boolean"==typeof options.coinbase,"Coinbase must be a boolean."),this.coinbase=options.coinbase),null!=options.hash&&(assert("string"==typeof options.hash,"Hash must be a string."),this.hash=options.hash),null!=options.index&&(assert(options.index>>>0===options.index,"Index must be a uint32."),this.index=options.index),this},Coin.fromOptions=function(options){return(new this).fromOptions(options)},Coin.prototype.clone=function(){assert(!1,"Coins are not cloneable.")},Coin.prototype.getDepth=function(height){return assert("number"==typeof height,"Must pass a height."),-1===this.height?0:-1===height?0:height<this.height?0:height-this.height+1},Coin.prototype.toKey=function(){return this.hash+this.index},Coin.prototype.fromKey=function(key){return assert(key.length>64),this.hash=key.slice(0,64),this.index=parseInt(key.slice(64),10),this},Coin.fromKey=function(key){return(new this).fromKey(key)},Coin.prototype.rhash=function(){return util.revHex(this.hash)},Coin.prototype.txid=function(){return this.rhash()},Coin.prototype.inspect=function(){return{type:this.getType(),version:this.version,height:this.height,value:Amount.btc(this.value),script:this.script,coinbase:this.coinbase,hash:this.hash?util.revHex(this.hash):null,index:this.index,address:this.getAddress()}},Coin.prototype.toJSON=function(){return this.getJSON()},Coin.prototype.getJSON=function(network,minimal){var addr=this.getAddress();return network=Network.get(network),addr&&(addr=addr.toString(network)),{version:this.version,height:this.height,value:this.value,script:this.script.toJSON(),address:addr,coinbase:this.coinbase,hash:minimal?void 0:this.rhash(),index:minimal?void 0:this.index}},Coin.prototype.fromJSON=function(json){return assert(json,"Coin data required."),assert(json.version>>>0===json.version,"Version must be a uint32."),assert(-1===json.height||json.height>>>0===json.height,"Height must be a uint32."),assert(Number.isSafeInteger(json.value)&&json.value>=0,"Value must be a uint64."),assert("boolean"==typeof json.coinbase,"Coinbase must be a boolean."),this.version=json.version,this.height=json.height,this.value=json.value,this.script.fromJSON(json.script),this.coinbase=json.coinbase,null!=json.hash&&(assert("string"==typeof json.hash,"Hash must be a string."),assert(64===json.hash.length,"Hash must be a string."),assert(json.index>>>0===json.index,"Index must be a uint32."),this.hash=util.revHex(json.hash),this.index=json.index),this},Coin.fromJSON=function(json){return(new this).fromJSON(json)},Coin.prototype.getSize=function(){return 17+this.script.getVarSize()},Coin.prototype.toWriter=function(bw){var height=this.height;return-1===height&&(height=2147483647),bw.writeU32(this.version),bw.writeU32(height),bw.writeI64(this.value),bw.writeVarBytes(this.script.toRaw()),bw.writeU8(this.coinbase?1:0),bw},Coin.prototype.toRaw=function(){var size=this.getSize();return this.toWriter(bio.write(size)).render()},Coin.prototype.fromReader=function(br){return this.version=br.readU32(),this.height=br.readU32(),this.value=br.readI64(),this.script.fromRaw(br.readVarBytes()),this.coinbase=1===br.readU8(),2147483647===this.height&&(this.height=-1),this},Coin.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},Coin.fromReader=function(br){return(new this).fromReader(br)},Coin.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},Coin.prototype.fromTX=function(tx,index,height){return assert("number"==typeof index),assert("number"==typeof height),assert(index>=0&&index<tx.outputs.length),this.version=tx.version,this.height=height,this.value=tx.outputs[index].value,this.script=tx.outputs[index].script,this.coinbase=tx.isCoinbase(),this.hash=tx.hash("hex"),this.index=index,this},Coin.fromTX=function(tx,index,height){return(new this).fromTX(tx,index,height)},Coin.isCoin=function(obj){return obj instanceof Coin},Coin}(Output);module.exports=Coin}).call(this,require("buffer").Buffer)},{"../btc/amount":8,"../protocol/consensus":84,"../protocol/network":87,"../utils/util":106,"./output":81,assert:146,buffer:269,bufio:270}],72:[function(require,module,exports){(function(Buffer){"use strict";var bio=require("bufio"),util=require("../utils/util"),Headers=function(_AbstractBlock){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Headers,_AbstractBlock);function Headers(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Headers);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_AbstractBlock.call(this));return options&&_this.parseOptions(options),_this}return Headers.prototype.verifyBody=function(){return!0},Headers.prototype.getSize=function(){return 81},Headers.prototype.toWriter=function(bw){return this.writeHead(bw),bw.writeVarint(0),bw},Headers.prototype.toRaw=function(){var size=this.getSize();return this.toWriter(bio.write(size)).render()},Headers.prototype.fromReader=function(br){return this.readHead(br),br.readVarint(),this},Headers.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},Headers.fromReader=function(br){return(new this).fromReader(br)},Headers.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},Headers.fromHead=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromHead(data)},Headers.fromEntry=function(entry){var headers=new this;return headers.version=entry.version,headers.prevBlock=entry.prevBlock,headers.merkleRoot=entry.merkleRoot,headers.time=entry.time,headers.bits=entry.bits,headers.nonce=entry.nonce,headers._hash=Buffer.from(entry.hash,"hex"),headers._hhash=entry.hash,headers},Headers.prototype.toHeaders=function(){return this},Headers.fromBlock=function(block){var headers=new this(block);return headers._hash=block._hash,headers._hhash=block._hhash,headers},Headers.prototype.toJSON=function(){return this.getJSON()},Headers.prototype.getJSON=function(network,view,height){return{hash:this.rhash(),height:height,version:this.version,prevBlock:util.revHex(this.prevBlock),merkleRoot:util.revHex(this.merkleRoot),time:this.time,bits:this.bits,nonce:this.nonce}},Headers.prototype.fromJSON=function(json){return this.parseJSON(json),this},Headers.fromJSON=function(json){return(new this).fromJSON(json)},Headers.prototype.inspect=function(){return this.format()},Headers.prototype.format=function(view,height){return{hash:this.rhash(),height:null!=height?height:-1,date:util.date(this.time),version:this.version.toString(16),prevBlock:util.revHex(this.prevBlock),merkleRoot:util.revHex(this.merkleRoot),time:this.time,bits:this.bits,nonce:this.nonce}},Headers.isHeaders=function(obj){return obj instanceof Headers},Headers}(require("./abstractblock"));module.exports=Headers}).call(this,require("buffer").Buffer)},{"../utils/util":106,"./abstractblock":68,buffer:269,bufio:270}],73:[function(require,module,exports){"use strict";exports.AbstractBlock=require("./abstractblock"),exports.Address=require("./address"),exports.Block=require("./block"),exports.Coin=require("./coin"),exports.Headers=require("./headers"),exports.Input=require("./input"),exports.InvItem=require("./invitem"),exports.KeyRing=require("./keyring"),exports.MemBlock=require("./memblock"),exports.MerkleBlock=require("./merkleblock"),exports.MTX=require("./mtx"),exports.Outpoint=require("./outpoint"),exports.Output=require("./output"),exports.TX=require("./tx"),exports.TXMeta=require("./txmeta")},{"./abstractblock":68,"./address":69,"./block":70,"./coin":71,"./headers":72,"./input":74,"./invitem":75,"./keyring":76,"./memblock":77,"./merkleblock":78,"./mtx":79,"./outpoint":80,"./output":81,"./tx":82,"./txmeta":83}],74:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),bio=require("bufio"),Network=require("../protocol/network"),Script=require("../script/script"),Outpoint=require("./outpoint"),Input=function(){function Input(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Input),this.prevout=new Outpoint,this.script=new Script,this.sequence=4294967295,options&&this.fromOptions(options)}return Input.prototype.fromOptions=function(options){return assert(options,"Input data is required."),this.prevout.fromOptions(options.prevout),options.script&&this.script.fromOptions(options.script),null!=options.sequence&&(assert(options.sequence>>>0===options.sequence,"Sequence must be a uint32."),this.sequence=options.sequence),this},Input.fromOptions=function(options){return(new this).fromOptions(options)},Input.prototype.clone=function(){var input=new this.constructor;return input.prevout=this.prevout,input.script.inject(this.script),input.sequence=this.sequence,input},Input.prototype.equals=function(input){return assert(Input.isInput(input)),this.prevout.equals(input.prevout)},Input.prototype.compare=function(input){return assert(Input.isInput(input)),this.prevout.compare(input.prevout)},Input.prototype.getType=function(coin){if(this.isCoinbase())return"coinbase";if(coin)return coin.getType();var type=void 0;return type=this.script.getInputType(),Script.typesByVal[type].toLowerCase()},Input.prototype.getRedeem=function(coin){if(this.isCoinbase())return null;if(!coin)return this.script.isScripthashInput()?this.script.getRedeem():null;var prev=coin.script,redeem=null;return prev.isScripthash()&&(redeem=prev=this.script.getRedeem()),redeem},Input.prototype.getSubtype=function(coin){if(this.isCoinbase())return null;var redeem=this.getRedeem(coin);if(!redeem)return null;var type=redeem.getType();return Script.typesByVal[type].toLowerCase()},Input.prototype.getAddress=function(coin){return this.isCoinbase()?null:coin?coin.getAddress():this.script.code.length>0?this.script.getInputAddress():null},Input.prototype.getHash=function(coin,enc){var addr=this.getAddress(coin);return addr?addr.getHash(enc):null},Input.prototype.isFinal=function(){return 4294967295===this.sequence},Input.prototype.isCoinbase=function(){return this.prevout.isNull()},Input.prototype.inspect=function(){return this.format()},Input.prototype.format=function(coin){return{type:this.getType(coin),subtype:this.getSubtype(coin),address:this.getAddress(coin),script:this.script,redeem:this.getRedeem(coin),sequence:this.sequence,prevout:this.prevout,coin:coin||null}},Input.prototype.toJSON=function(network,coin){return this.getJSON()},Input.prototype.getJSON=function(network,coin){network=Network.get(network);var addr=void 0;return coin||(addr=this.getAddress())&&(addr=addr.toString(network)),{prevout:this.prevout.toJSON(),script:this.script.toJSON(),sequence:this.sequence,address:addr,coin:coin?coin.getJSON(network,!0):void 0}},Input.prototype.fromJSON=function(json){return assert(json,"Input data is required."),assert(json.sequence>>>0===json.sequence,"Sequence must be a uint32."),this.prevout.fromJSON(json.prevout),this.script.fromJSON(json.script),this.sequence=json.sequence,this},Input.fromJSON=function(json){return(new this).fromJSON(json)},Input.prototype.getSize=function(){return 40+this.script.getVarSize()},Input.prototype.toRaw=function(){var size=this.getSize();return this.toWriter(bio.write(size)).render()},Input.prototype.toWriter=function(bw){return this.prevout.toWriter(bw),bw.writeVarBytes(this.script.toRaw()),bw.writeU32(this.sequence),bw},Input.prototype.fromReader=function(br){return this.prevout.fromReader(br),this.script.fromRaw(br.readVarBytes()),this.sequence=br.readU32(),this},Input.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},Input.fromReader=function(br){return(new this).fromReader(br)},Input.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},Input.prototype.fromOutpoint=function(outpoint){return assert("string"==typeof outpoint.hash),assert("number"==typeof outpoint.index),this.prevout.hash=outpoint.hash,this.prevout.index=outpoint.index,this},Input.fromOutpoint=function(outpoint){return(new this).fromOutpoint(outpoint)},Input.prototype.fromCoin=function(coin){return assert("string"==typeof coin.hash),assert("number"==typeof coin.index),this.prevout.hash=coin.hash,this.prevout.index=coin.index,this},Input.fromCoin=function(coin){return(new this).fromCoin(coin)},Input.prototype.fromTX=function(tx,index){return assert(tx),assert("number"==typeof index),assert(index>=0&&index<tx.outputs.length),this.prevout.hash=tx.hash("hex"),this.prevout.index=index,this},Input.fromTX=function(tx,index){return(new this).fromTX(tx,index)},Input.isInput=function(obj){return obj instanceof Input},Input}();module.exports=Input}).call(this,require("buffer").Buffer)},{"../protocol/network":87,"../script/script":95,"./outpoint":80,assert:146,buffer:269,bufio:270}],75:[function(require,module,exports){(function(Buffer){"use strict";var bio=require("bufio"),util=require("../utils/util"),InvItem=function(){function InvItem(type,hash){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,InvItem),this.type=type,this.hash=hash}return InvItem.prototype.getSize=function(){return 36},InvItem.prototype.toWriter=function(bw){return bw.writeU32(this.type),bw.writeHash(this.hash),bw},InvItem.prototype.toRaw=function(){return this.toWriter(bio.write(36)).render()},InvItem.prototype.fromReader=function(br){return this.type=br.readU32(),this.hash=br.readHash("hex"),this},InvItem.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},InvItem.fromReader=function(br){return(new this).fromReader(br)},InvItem.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},InvItem.prototype.isBlock=function(){switch(this.type){case InvItem.types.BLOCK:case InvItem.types.FILTERED_BLOCK:case InvItem.types.CMPCT_BLOCK:return!0;default:return!1}},InvItem.prototype.isTX=function(){switch(this.type){case InvItem.types.TX:return!0;default:return!1}},InvItem.prototype.rhash=function(){return util.revHex(this.hash)},InvItem}();InvItem.types={TX:1,BLOCK:2,FILTERED_BLOCK:3,CMPCT_BLOCK:4},InvItem.typesByVal={1:"TX",2:"BLOCK",3:"FILTERED_BLOCK",4:"CMPCT_BLOCK"},module.exports=InvItem}).call(this,require("buffer").Buffer)},{"../utils/util":106,buffer:269,bufio:270}],76:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),base58=require("bstring").base58,bio=require("bufio"),hash160=require("bcrypto/lib/hash160"),hash256=require("bcrypto/lib/hash256"),Network=require("../protocol/network"),Script=require("../script/script"),Address=require("./address"),Output=require("./output"),secp256k1=require("bcrypto/lib/secp256k1"),encoding=bio.encoding,ZERO_KEY=Buffer.alloc(33,0),KeyRing=function(){function KeyRing(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,KeyRing),this.witness=!1,this.nested=!1,this.publicKey=ZERO_KEY,this.privateKey=null,this.script=null,this._keyHash=null,this._keyAddress=null,this._program=null,this._nestedHash=null,this._nestedAddress=null,this._scriptHash160=null,this._scriptHash256=null,this._scriptAddress=null,options&&this.fromOptions(options)}return KeyRing.prototype.fromOptions=function(options){var key=toKey(options);if(null!=options.witness&&(assert("boolean"==typeof options.witness),this.witness=options.witness),null!=options.nested&&(assert("boolean"==typeof options.nested),this.nested=options.nested),Buffer.isBuffer(key))return this.fromKey(key);key=toKey(options.key),options.publicKey&&(key=toKey(options.publicKey)),options.privateKey&&(key=toKey(options.privateKey));var script=options.script,compress=options.compressed;return script?this.fromScript(key,script,compress):this.fromKey(key,compress)},KeyRing.fromOptions=function(options){return(new this).fromOptions(options)},KeyRing.prototype.refresh=function(){this._keyHash=null,this._keyAddress=null,this._program=null,this._nestedHash=null,this._nestedAddress=null,this._scriptHash160=null,this._scriptHash256=null,this._scriptAddress=null},KeyRing.prototype.fromPrivate=function(key,compress){return assert(Buffer.isBuffer(key),"Private key must be a buffer."),assert(secp256k1.privateKeyVerify(key),"Not a valid private key."),this.privateKey=key,this.publicKey=secp256k1.publicKeyCreate(key,!1!==compress),this},KeyRing.fromPrivate=function(key,compress){return(new this).fromPrivate(key,compress)},KeyRing.prototype.fromPublic=function(key){return assert(Buffer.isBuffer(key),"Public key must be a buffer."),assert(secp256k1.publicKeyVerify(key),"Not a valid public key."),this.publicKey=key,this},KeyRing.prototype.generate=function(compress){var key=secp256k1.generatePrivateKey();return this.fromKey(key,compress)},KeyRing.generate=function(compress){return(new this).generate(compress)},KeyRing.fromPublic=function(key){return(new this).fromPublic(key)},KeyRing.prototype.fromKey=function(key,compress){return assert(Buffer.isBuffer(key),"Key must be a buffer."),32===key.length?this.fromPrivate(key,!1!==compress):this.fromPublic(key)},KeyRing.fromKey=function(key,compress){return(new this).fromKey(key,compress)},KeyRing.prototype.fromScript=function(key,script,compress){return assert(script instanceof Script,"Non-script passed into KeyRing."),this.fromKey(key,compress),this.script=script,this},KeyRing.fromScript=function(key,script,compress){return(new this).fromScript(key,script,compress)},KeyRing.prototype.getSecretSize=function(){var size=0;return size+=1,size+=this.privateKey.length,33===this.publicKey.length&&(size+=1),size+=4},KeyRing.prototype.toSecret=function(network){var size=this.getSecretSize(),bw=bio.write(size);return assert(this.privateKey,"Cannot serialize without private key."),network=Network.get(network),bw.writeU8(network.keyPrefix.privkey),bw.writeBytes(this.privateKey),33===this.publicKey.length&&bw.writeU8(1),bw.writeChecksum(hash256.digest),base58.encode(bw.render())},KeyRing.prototype.fromSecret=function(data,network){var br=bio.read(base58.decode(data),!0),version=br.readU8();Network.fromWIF(version,network);var key=br.readBytes(32),compress=!1;return br.left()>4&&(assert(1===br.readU8(),"Bad compression flag."),compress=!0),br.verifyChecksum(hash256.digest),this.fromPrivate(key,compress)},KeyRing.fromSecret=function(data,network){return(new this).fromSecret(data,network)},KeyRing.prototype.getPrivateKey=function(enc,network){return this.privateKey?"base58"===enc?this.toSecret(network):"hex"===enc?this.privateKey.toString("hex"):this.privateKey:null},KeyRing.prototype.getPublicKey=function(enc){return"base58"===enc?base58.encode(this.publicKey):"hex"===enc?this.publicKey.toString("hex"):this.publicKey},KeyRing.prototype.getScript=function(){return this.script},KeyRing.prototype.getProgram=function(){if(!this.witness)return null;if(!this._program){var program=void 0;if(this.script){var _hash=this.script.sha256();program=Script.fromProgram(0,_hash)}else{var hash=hash160.digest(this.publicKey);program=Script.fromProgram(0,hash)}this._program=program}return this._program},KeyRing.prototype.getNestedHash=function(enc){return this.witness?(this._nestedHash||(this._nestedHash=this.getProgram().hash160()),"hex"===enc?this._nestedHash.toString("hex"):this._nestedHash):null},KeyRing.prototype.getNestedAddress=function(enc,network){if(!this.witness)return null;if(!this._nestedAddress){var hash=this.getNestedHash(),addr=Address.fromScripthash(hash);this._nestedAddress=addr}return"base58"===enc?this._nestedAddress.toBase58(network):"string"===enc?this._nestedAddress.toString(network):this._nestedAddress},KeyRing.prototype.getScriptHash=function(enc){return this.witness?this.getScriptHash256(enc):this.getScriptHash160(enc)},KeyRing.prototype.getScriptHash160=function(enc){return this.script?(this._scriptHash160||(this._scriptHash160=this.script.hash160()),"hex"===enc?this._scriptHash160.toString("hex"):this._scriptHash160):null},KeyRing.prototype.getScriptHash256=function(enc){return this.script?(this._scriptHash256||(this._scriptHash256=this.script.sha256()),"hex"===enc?this._scriptHash256.toString("hex"):this._scriptHash256):null},KeyRing.prototype.getScriptAddress=function(enc,network){if(!this.script)return null;if(!this._scriptAddress){var addr=void 0;if(this.witness){var hash=this.getScriptHash256();addr=Address.fromWitnessScripthash(hash)}else{var _hash2=this.getScriptHash160();addr=Address.fromScripthash(_hash2)}this._scriptAddress=addr}return"base58"===enc?this._scriptAddress.toBase58(network):"string"===enc?this._scriptAddress.toString(network):this._scriptAddress},KeyRing.prototype.getKeyHash=function(enc){return this._keyHash||(this._keyHash=hash160.digest(this.publicKey)),"hex"===enc?this._keyHash.toString("hex"):this._keyHash},KeyRing.prototype.getKeyAddress=function(enc,network){if(!this._keyAddress){var hash=this.getKeyHash(),addr=void 0;addr=this.witness?Address.fromWitnessPubkeyhash(hash):Address.fromPubkeyhash(hash),this._keyAddress=addr}return"base58"===enc?this._keyAddress.toBase58(network):"string"===enc?this._keyAddress.toString(network):this._keyAddress},KeyRing.prototype.getHash=function(enc){return this.nested?this.getNestedHash(enc):this.script?this.getScriptHash(enc):this.getKeyHash(enc)},KeyRing.prototype.getAddress=function(enc,network){return this.nested?this.getNestedAddress(enc,network):this.script?this.getScriptAddress(enc,network):this.getKeyAddress(enc,network)},KeyRing.prototype.ownHash=function(hash){return!!hash&&(!!hash.equals(this.getKeyHash())||(!(!this.script||!hash.equals(this.getScriptHash()))||!(!this.witness||!hash.equals(this.getNestedHash()))))},KeyRing.prototype.ownOutput=function(tx,index){var output=void 0;return tx instanceof Output?output=tx:(output=tx.outputs[index],assert(output,"Output does not exist.")),this.ownHash(output.getHash())},KeyRing.prototype.getRedeem=function(hash){if(this.witness&&hash.equals(this.getNestedHash()))return this.getProgram();if(this.script){if(hash.equals(this.getScriptHash160()))return this.script;if(hash.equals(this.getScriptHash256()))return this.script}return null},KeyRing.prototype.sign=function(msg){return assert(this.privateKey,"Cannot sign without private key."),secp256k1.sign(msg,this.privateKey)},KeyRing.prototype.verify=function(msg,sig){return secp256k1.verify(msg,sig,this.publicKey)},KeyRing.prototype.getVersion=function(){return this.witness?this.nested?-1:0:-1},KeyRing.prototype.getType=function(){return this.nested?Address.types.SCRIPTHASH:this.witness?Address.types.WITNESS:this.script?Address.types.SCRIPTHASH:Address.types.PUBKEYHASH},KeyRing.prototype.inspect=function(){return this.toJSON()},KeyRing.prototype.toJSON=function(network){return{witness:this.witness,nested:this.nested,publicKey:this.publicKey.toString("hex"),script:this.script?this.script.toRaw().toString("hex"):null,program:this.witness?this.getProgram().toRaw().toString("hex"):null,type:Address.typesByVal[this.getType()].toLowerCase(),address:this.getAddress("string",network)}},KeyRing.prototype.fromJSON=function(json){return assert(json),assert("boolean"==typeof json.witness),assert("boolean"==typeof json.nested),assert("string"==typeof json.publicKey),assert(!json.script||"string"==typeof json.script),this.witness=json.witness,this.nested=json.nested,this.publicKey=Buffer.from(json.publicKey,"hex"),json.script&&(this.script=Buffer.from(json.script,"hex")),this},KeyRing.fromJSON=function(json){return(new this).fromJSON(json)},KeyRing.prototype.getSize=function(){var size=0;return size+=1,this.privateKey?(size+=encoding.sizeVarBytes(this.privateKey),size+=1):size+=encoding.sizeVarBytes(this.publicKey),size+=this.script?this.script.getVarSize():1},KeyRing.prototype.toWriter=function(bw){var field=0;return this.witness&&(field|=1),this.nested&&(field|=2),bw.writeU8(field),this.privateKey?(bw.writeVarBytes(this.privateKey),bw.writeU8(33===this.publicKey.length)):bw.writeVarBytes(this.publicKey),this.script?bw.writeVarBytes(this.script.toRaw()):bw.writeVarint(0),bw},KeyRing.prototype.toRaw=function(){var size=this.getSize();return this.toWriter(bio.write(size)).render()},KeyRing.prototype.fromReader=function(br){var field=br.readU8();this.witness=0!=(1&field),this.nested=0!=(2&field);var key=br.readVarBytes();if(32===key.length){var compress=1===br.readU8();this.privateKey=key,this.publicKey=secp256k1.publicKeyCreate(key,compress)}else this.publicKey=key,assert(secp256k1.publicKeyVerify(key),"Invalid public key.");var script=br.readVarBytes();return script.length>0&&(this.script=Script.fromRaw(script)),this},KeyRing.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},KeyRing.fromReader=function(br){return(new this).fromReader(br)},KeyRing.fromRaw=function(data){return(new this).fromRaw(data)},KeyRing.isKeyRing=function(obj){return obj instanceof KeyRing},KeyRing}();function toKey(opt){return opt?opt.privateKey?opt.privateKey:opt.publicKey?opt.publicKey:opt:opt}module.exports=KeyRing}).call(this,require("buffer").Buffer)},{"../protocol/network":87,"../script/script":95,"./address":69,"./output":81,assert:146,"bcrypto/lib/hash160":159,"bcrypto/lib/hash256":160,"bcrypto/lib/secp256k1":184,bstring:265,buffer:269,bufio:270}],77:[function(require,module,exports){(function(Buffer){"use strict";var bio=require("bufio"),AbstractBlock=require("./abstractblock"),Block=require("./block"),Headers=require("./headers"),Script=require("../script/script"),DUMMY=Buffer.alloc(0),MemBlock=function(_AbstractBlock){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(MemBlock,_AbstractBlock);function MemBlock(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MemBlock);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_AbstractBlock.call(this));return _this._raw=DUMMY,_this}return MemBlock.prototype.isMemory=function(){return!0},MemBlock.prototype.toHead=function(){return this._raw.slice(0,80)},MemBlock.prototype.getSize=function(){return this._raw.length},MemBlock.prototype.verifyBody=function(){return!0},MemBlock.prototype.getCoinbaseHeight=function(){if(this.version<2)return-1;try{return this.parseCoinbaseHeight()}catch(e){return-1}},MemBlock.prototype.parseCoinbaseHeight=function(){var br=bio.read(this._raw,!0);br.seek(80);if(0===br.readVarint())return-1;br.seek(4);var inCount=br.readVarint();if(0===inCount&&0!==br.readU8()&&(inCount=br.readVarint()),0===inCount)return-1;br.seek(36);var script=br.readVarBytes();return Script.getCoinbaseHeight(script)},MemBlock.prototype.fromRaw=function(data){var br=bio.read(data,!0);return this.readHead(br),this._raw=br.data,this},MemBlock.fromRaw=function(data){return(new this).fromRaw(data)},MemBlock.prototype.toRaw=function(){return this._raw},MemBlock.prototype.toNormal=function(){return this._raw},MemBlock.prototype.toBlock=function(){var block=Block.fromRaw(this._raw);return block._hash=this._hash,block._hhash=this._hhash,block},MemBlock.prototype.toHeaders=function(){return Headers.fromBlock(this)},MemBlock.isMemBlock=function(obj){return obj instanceof MemBlock},MemBlock}(AbstractBlock);module.exports=MemBlock}).call(this,require("buffer").Buffer)},{"../script/script":95,"./abstractblock":68,"./block":70,"./headers":72,buffer:269,bufio:270}],78:[function(require,module,exports){(function(Buffer){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),bio=require("bufio"),util=require("../utils/util"),hash256=require("bcrypto/lib/hash256"),consensus=require("../protocol/consensus"),AbstractBlock=require("./abstractblock"),Headers=require("./headers"),DUMMY=Buffer.from([0]),encoding=bio.encoding,MerkleBlock=function(_AbstractBlock){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(MerkleBlock,_AbstractBlock);function MerkleBlock(options){_classCallCheck(this,MerkleBlock);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_AbstractBlock.call(this));return _this.txs=[],_this.hashes=[],_this.flags=DUMMY,_this.totalTX=0,_this._tree=null,options&&_this.fromOptions(options),_this}return MerkleBlock.prototype.fromOptions=function(options){if(this.parseOptions(options),assert(options,"MerkleBlock data is required."),assert(Array.isArray(options.hashes)),assert(Buffer.isBuffer(options.flags)),assert(options.totalTX>>>0===options.totalTX),options.hashes){var _iterator=options.hashes,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var hash=_ref;"string"==typeof hash&&(hash=Buffer.from(hash,"hex")),assert(Buffer.isBuffer(hash)),this.hashes.push(hash)}}return options.flags&&(assert(Buffer.isBuffer(options.flags)),this.flags=options.flags),null!=options.totalTX&&(assert(options.totalTX>>>0===options.totalTX),this.totalTX=options.totalTX),this},MerkleBlock.fromOptions=function(data){return(new this).fromOptions(data)},MerkleBlock.prototype.refresh=function(all){if(this._refresh(),this._tree=null,all){var _iterator2=this.txs,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref2=_i2.value}_ref2.refresh()}}},MerkleBlock.prototype.hasTX=function(hash){return-1!==this.indexOf(hash)},MerkleBlock.prototype.indexOf=function(hash){var index=this.getTree().map.get(hash);return null==index?-1:index},MerkleBlock.prototype.verifyBody=function(){return this.checkBody()[0]},MerkleBlock.prototype.checkBody=function(){return this.getTree().root!==this.merkleRoot?[!1,"bad-txnmrklroot",100]:[!0,"valid",0]},MerkleBlock.prototype.getTree=function(){if(!this._tree)try{this._tree=this.extractTree()}catch(e){this._tree=new PartialTree}return this._tree},MerkleBlock.prototype.extractTree=function(){var matches=[],indexes=[],map=new Map,hashes=this.hashes,flags=this.flags,totalTX=this.totalTX,bitsUsed=0,hashUsed=0,failed=!1,height=0,width=function(height){return totalTX+(1<<height)-1>>>height};if(0===totalTX)throw new Error("Zero transactions.");if(totalTX>consensus.MAX_BLOCK_SIZE/60)throw new Error("Too many transactions.");if(hashes.length>totalTX)throw new Error("Too many hashes.");if(8*flags.length<hashes.length)throw new Error("Flags too small.");for(;width(height)>1;)height+=1;var root=function traverse(height,pos){if(bitsUsed>=8*flags.length)return failed=!0,consensus.ZERO_HASH;var parent=flags[bitsUsed/8|0]>>>bitsUsed%8&1;if(bitsUsed+=1,0===height||!parent){if(hashUsed>=hashes.length)return failed=!0,consensus.ZERO_HASH;var hash=hashes[hashUsed];if(hashUsed+=1,0===height&&parent){var txid=hash.toString("hex");matches.push(hash),indexes.push(pos),map.set(txid,pos)}return hash}var left=traverse(height-1,2*pos),right=void 0;return 2*pos+1<width(height-1)?(right=traverse(height-1,2*pos+1)).equals(left)&&(failed=!0):right=left,hash256.root(left,right)}(height,0);if(failed)throw new Error("Mutated merkle tree.");if(((bitsUsed+7)/8|0)!==flags.length)throw new Error("Too many flag bits.");if(hashUsed!==hashes.length)throw new Error("Incorrect number of hashes.");return new PartialTree(root,matches,indexes,map)},MerkleBlock.prototype.getCoinbaseHeight=function(){return-1},MerkleBlock.prototype.inspect=function(){return this.format()},MerkleBlock.prototype.format=function(view,height){return{hash:this.rhash(),height:null!=height?height:-1,date:util.date(this.time),version:this.version.toString(16),prevBlock:util.revHex(this.prevBlock),merkleRoot:util.revHex(this.merkleRoot),time:this.time,bits:this.bits,nonce:this.nonce,totalTX:this.totalTX,hashes:this.hashes.map(function(hash){return hash.toString("hex")}),flags:this.flags,map:this.getTree().map,txs:this.txs.length}},MerkleBlock.prototype.getSize=function(){var size=0;return size+=80,size+=4,size+=encoding.sizeVarint(this.hashes.length),size+=32*this.hashes.length,size+=encoding.sizeVarint(this.flags.length),size+=this.flags.length},MerkleBlock.prototype.toWriter=function(bw){this.writeHead(bw),bw.writeU32(this.totalTX),bw.writeVarint(this.hashes.length);var _iterator3=this.hashes,_isArray3=Array.isArray(_iterator3),_i3=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref3;if(_isArray3){if(_i3>=_iterator3.length)break;_ref3=_iterator3[_i3++]}else{if((_i3=_iterator3.next()).done)break;_ref3=_i3.value}var hash=_ref3;bw.writeHash(hash)}return bw.writeVarBytes(this.flags),bw},MerkleBlock.prototype.toRaw=function(){var size=this.getSize();return this.toWriter(bio.write(size)).render()},MerkleBlock.prototype.fromReader=function(br){this.readHead(br),this.totalTX=br.readU32();for(var count=br.readVarint(),i=0;i<count;i++)this.hashes.push(br.readHash());return this.flags=br.readVarBytes(),this},MerkleBlock.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},MerkleBlock.fromReader=function(br){return(new this).fromReader(br)},MerkleBlock.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},MerkleBlock.prototype.toJSON=function(){return this.getJSON()},MerkleBlock.prototype.getJSON=function(network,view,height){return{hash:this.rhash(),height:height,version:this.version,prevBlock:util.revHex(this.prevBlock),merkleRoot:util.revHex(this.merkleRoot),time:this.time,bits:this.bits,nonce:this.nonce,totalTX:this.totalTX,hashes:this.hashes.map(function(hash){return util.revHex(hash.toString("hex"))}),flags:this.flags.toString("hex")}},MerkleBlock.prototype.fromJSON=function(json){assert(json,"MerkleBlock data is required."),assert(Array.isArray(json.hashes)),assert("string"==typeof json.flags),assert(json.totalTX>>>0===json.totalTX),this.parseJSON(json);var _iterator4=json.hashes,_isArray4=Array.isArray(_iterator4),_i4=0;for(_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();;){var _ref4;if(_isArray4){if(_i4>=_iterator4.length)break;_ref4=_iterator4[_i4++]}else{if((_i4=_iterator4.next()).done)break;_ref4=_i4.value}var hash=_ref4;hash=util.revHex(hash),this.hashes.push(Buffer.from(hash,"hex"))}return this.flags=Buffer.from(json.flags,"hex"),this.totalTX=json.totalTX,this},MerkleBlock.fromJSON=function(json){return(new this).fromJSON(json)},MerkleBlock.fromBlock=function(block,filter){var matches=[],_iterator5=block.txs,_isArray5=Array.isArray(_iterator5),_i5=0;for(_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();;){var _ref5;if(_isArray5){if(_i5>=_iterator5.length)break;_ref5=_iterator5[_i5++]}else{if((_i5=_iterator5.next()).done)break;_ref5=_i5.value}var tx=_ref5;matches.push(tx.isWatched(filter)?1:0)}return this.fromMatches(block,matches)},MerkleBlock.fromHashes=function(block,hashes){var filter=new Set,_iterator6=hashes,_isArray6=Array.isArray(_iterator6),_i6=0;for(_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();;){var _ref6;if(_isArray6){if(_i6>=_iterator6.length)break;_ref6=_iterator6[_i6++]}else{if((_i6=_iterator6.next()).done)break;_ref6=_i6.value}var hash=_ref6;Buffer.isBuffer(hash)&&(hash=hash.toString("hex")),filter.add(hash)}var matches=[],_iterator7=block.txs,_isArray7=Array.isArray(_iterator7),_i7=0;for(_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();;){var _ref7;if(_isArray7){if(_i7>=_iterator7.length)break;_ref7=_iterator7[_i7++]}else{if((_i7=_iterator7.next()).done)break;_ref7=_i7.value}var _hash=_ref7.hash("hex");matches.push(filter.has(_hash)?1:0)}return this.fromMatches(block,matches)},MerkleBlock.fromMatches=function(block,matches){for(var txs=[],leaves=[],bits=[],hashes=[],totalTX=block.txs.length,height=0,width=function(height){return totalTX+(1<<height)-1>>>height},i=0;i<block.txs.length;i++){var tx=block.txs[i];matches[i]&&txs.push(tx),leaves.push(tx.hash())}for(;width(height)>1;)height+=1;!function traverse(height,pos,leaves,matches){for(var parent=0,p=pos<<height;p<pos+1<<height&&p<totalTX;p++)parent|=matches[p];bits.push(parent),0!==height&&parent?(traverse(height-1,2*pos,leaves,matches),2*pos+1<width(height-1)&&traverse(height-1,2*pos+1,leaves,matches)):hashes.push(function hash(height,pos,leaves){if(0===height)return leaves[pos];var left=hash(height-1,2*pos,leaves),right=void 0;return right=2*pos+1<width(height-1)?hash(height-1,2*pos+1,leaves):left,hash256.root(left,right)}(height,pos,leaves))}(height,0,leaves,matches);var flags=Buffer.allocUnsafe((bits.length+7)/8|0);flags.fill(0);for(var p=0;p<bits.length;p++)flags[p/8|0]|=bits[p]<<p%8;var merkle=new this;return merkle._hash=block._hash,merkle._hhash=block._hhash,merkle.version=block.version,merkle.prevBlock=block.prevBlock,merkle.merkleRoot=block.merkleRoot,merkle.time=block.time,merkle.bits=block.bits,merkle.nonce=block.nonce,merkle.totalTX=totalTX,merkle.hashes=hashes,merkle.flags=flags,merkle.txs=txs,merkle},MerkleBlock.isMerkleBlock=function(obj){return obj instanceof MerkleBlock},MerkleBlock.prototype.toHeaders=function(){return Headers.fromBlock(this)},MerkleBlock}(AbstractBlock),PartialTree=function PartialTree(root,matches,indexes,map){_classCallCheck(this,PartialTree),this.root=root?root.toString("hex"):consensus.NULL_HASH,this.matches=matches||[],this.indexes=indexes||[],this.map=map||new Map};module.exports=MerkleBlock}).call(this,require("buffer").Buffer)},{"../protocol/consensus":84,"../utils/util":106,"./abstractblock":68,"./headers":72,assert:146,"bcrypto/lib/hash256":160,buffer:269,bufio:270}],79:[function(require,module,exports){(function(Buffer){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var assert=require("assert"),encoding=require("bufio").encoding,Script=require("../script/script"),TX=require("./tx"),Input=require("./input"),Output=require("./output"),Coin=require("./coin"),Outpoint=require("./outpoint"),CoinView=require("../coins/coinview"),Address=require("./address"),consensus=require("../protocol/consensus"),policy=require("../protocol/policy"),Amount=require("../btc/amount"),Stack=require("../script/stack"),MTX=function(_TX){_inherits(MTX,_TX);function MTX(options){_classCallCheck(this,MTX);var _this=_possibleConstructorReturn(this,_TX.call(this));return _this.mutable=!0,_this.changeIndex=-1,_this.view=new CoinView,options&&_this.fromOptions(options),_this}return MTX.prototype.fromOptions=function(options){if(null!=options.version&&(assert(options.version>>>0===options.version,"Version must a be uint32."),this.version=options.version),options.inputs){assert(Array.isArray(options.inputs),"Inputs must be an array.");var _iterator=options.inputs,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var input=_ref;this.addInput(input)}}if(options.outputs){assert(Array.isArray(options.outputs),"Outputs must be an array.");var _iterator2=options.outputs,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref2=_i2.value}var output=_ref2;this.addOutput(output)}}return null!=options.locktime&&(assert(options.locktime>>>0===options.locktime,"Locktime must be a uint32."),this.locktime=options.locktime),null!=options.changeIndex&&(-1!==options.changeIndex?(assert(options.changeIndex>>>0===options.changeIndex,"Change index must be a uint32."),this.changeIndex=options.changeIndex):this.changeIndex=-1),this},MTX.fromOptions=function(options){return(new this).fromOptions(options)},MTX.prototype.clone=function(){var mtx=new this.constructor;return mtx.inject(this),mtx.changeIndex=this.changeIndex,mtx},MTX.prototype.addInput=function(options){var input=Input.fromOptions(options);return this.inputs.push(input),input},MTX.prototype.addOutpoint=function(outpoint){var prevout=Outpoint.fromOptions(outpoint),input=Input.fromOutpoint(prevout);return this.inputs.push(input),input},MTX.prototype.addCoin=function(coin){assert(coin instanceof Coin,"Cannot add non-coin.");var input=Input.fromCoin(coin);return this.inputs.push(input),this.view.addCoin(coin),input},MTX.prototype.addTX=function(tx,index,height){assert(tx instanceof TX,"Cannot add non-transaction."),null==height&&(height=-1);var input=Input.fromTX(tx,index);return this.inputs.push(input),this.view.addIndex(tx,index,height),input},MTX.prototype.addOutput=function(script,value){var output=void 0;return output=null!=value?Output.fromScript(script,value):Output.fromOptions(script),this.outputs.push(output),output},MTX.prototype.check=function(flags){return _TX.prototype.check.call(this,this.view,flags)},MTX.prototype.checkAsync=function(flags,pool){return _TX.prototype.checkAsync.call(this,this.view,flags,pool)},MTX.prototype.verify=function(flags){try{this.check(flags)}catch(e){if("ScriptError"===e.type)return!1;throw e}return!0},MTX.prototype.verifyAsync=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee(flags,pool){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,_context.next=3,this.checkAsync(flags,pool);case 3:_context.next=10;break;case 5:if(_context.prev=5,_context.t0=_context.catch(0),"ScriptError"!==_context.t0.type){_context.next=9;break}return _context.abrupt("return",!1);case 9:throw _context.t0;case 10:return _context.abrupt("return",!0);case 11:case"end":return _context.stop()}},_callee,this,[[0,5]])}));return function(_x,_x2){return _ref3.apply(this,arguments)}}(),MTX.prototype.getFee=function(){return _TX.prototype.getFee.call(this,this.view)},MTX.prototype.getInputValue=function(){return _TX.prototype.getInputValue.call(this,this.view)},MTX.prototype.getInputAddresses=function(){return _TX.prototype.getInputAddresses.call(this,this.view)},MTX.prototype.getAddresses=function(){return _TX.prototype.getAddresses.call(this,this.view)},MTX.prototype.getInputHashes=function(enc){return _TX.prototype.getInputHashes.call(this,this.view,enc)},MTX.prototype.getHashes=function(enc){return _TX.prototype.getHashes.call(this,this.view,enc)},MTX.prototype.hasCoins=function(){return _TX.prototype.hasCoins.call(this,this.view)},MTX.prototype.getSigops=function(flags){return _TX.prototype.getSigops.call(this,this.view,flags)},MTX.prototype.getSigopsCost=function(flags){return _TX.prototype.getSigopsCost.call(this,this.view,flags)},MTX.prototype.getSigopsSize=function(){return _TX.prototype.getSigopsSize.call(this,this.getSigopsCost())},MTX.prototype.verifyInputs=function(height){return-1!==this.checkInputs(height)[0]},MTX.prototype.checkInputs=function(height){return _TX.prototype.checkInputs.call(this,this.view,height)},MTX.prototype.scriptInput=function(index,coin,ring){var input=this.inputs[index];if(assert(input,"Input does not exist."),assert(coin,"No coin passed."),0!==input.script.raw.length||0!==input.witness.items.length)return!0;var prev=coin.script,sh=prev.getScripthash();if(sh){var redeem=ring.getRedeem(sh);if(!redeem)return!1;if(redeem.isProgram()){var wsh=redeem.getWitnessScripthash();if(wsh){var wredeem=ring.getRedeem(wsh);if(!wredeem)return!1;var witness=this.scriptVector(wredeem,ring);return!!witness&&(witness.push(wredeem.toRaw()),input.witness.fromStack(witness),input.script.fromItems([redeem.toRaw()]),!0)}var wpkh=redeem.getWitnessPubkeyhash();if(wpkh){var pkh=Script.fromPubkeyhash(wpkh),_witness=this.scriptVector(pkh,ring);return!!_witness&&(input.witness.fromStack(_witness),input.script.fromItems([redeem.toRaw()]),!0)}return!1}var _vector=this.scriptVector(redeem,ring);return!!_vector&&(_vector.push(redeem.toRaw()),input.script.fromStack(_vector),!0)}if(prev.isProgram()){var _wsh=prev.getWitnessScripthash();if(_wsh){var _wredeem=ring.getRedeem(_wsh);if(!_wredeem)return!1;var _vector2=this.scriptVector(_wredeem,ring);return!!_vector2&&(_vector2.push(_wredeem.toRaw()),input.witness.fromStack(_vector2),!0)}var _wpkh=prev.getWitnessPubkeyhash();if(_wpkh){var _pkh=Script.fromPubkeyhash(_wpkh),_vector3=this.scriptVector(_pkh,ring);return!!_vector3&&(input.witness.fromStack(_vector3),!0)}return!1}var vector=this.scriptVector(prev,ring);return!!vector&&(input.script.fromStack(vector),!0)},MTX.prototype.scriptVector=function(prev,ring){var pk=prev.getPubkey();if(pk){if(!pk.equals(ring.publicKey))return null;var stack=new Stack;return stack.pushInt(0),stack}var pkh=prev.getPubkeyhash();if(pkh){if(!pkh.equals(ring.getKeyHash()))return null;var _stack=new Stack;return _stack.pushInt(0),_stack.pushData(ring.publicKey),_stack}var n=prev.getMultisig()[1];if(-1!==n){if(-1===prev.indexOf(ring.publicKey))return null;var _stack2=new Stack;_stack2.pushInt(0);for(var i=0;i<n;i++)_stack2.pushInt(0);return _stack2}return null},MTX.prototype.signInputAsync=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(index,coin,ring,type,pool){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(pool){_context2.next=2;break}return _context2.abrupt("return",this.signInput(index,coin,ring,type));case 2:return _context2.next=4,pool.signInput(this,index,coin,ring,type,pool);case 4:return _context2.abrupt("return",_context2.sent);case 5:case"end":return _context2.stop()}},_callee2,this)}));return function(_x3,_x4,_x5,_x6,_x7){return _ref4.apply(this,arguments)}}(),MTX.prototype.signInput=function(index,coin,ring,type){var input=this.inputs[index],key=ring.privateKey;assert(input,"Input does not exist."),assert(coin,"No coin passed.");var value=coin.value,prev=coin.script,vector=input.script,flags=Script.flags.STANDARD_VERIFY_FLAGS,redeem=!1;if(prev.isScripthash()){if(!(prev=input.script.getRedeem()))throw new Error("Input has not been templated.");redeem=!0}null==type&&(type|=Script.hashType.SIGHASH_FORKID);var sig=this.signature(index,prev,value,key,type,flags);if(redeem){var _stack3=vector.toStack(),_redeem=_stack3.pop(),_result=this.signVector(prev,_stack3,sig,ring);return!!_result&&(_result.push(_redeem),vector.fromStack(_result),!0)}var stack=vector.toStack(),result=this.signVector(prev,stack,sig,ring);return!!result&&(vector.fromStack(result),!0)},MTX.prototype.signVector=function(prev,vector,sig,ring){var pk=prev.getPubkey();if(pk){if(!ring.publicKey.equals(pk))return null;if(0===vector.length)throw new Error("Input has not been templated.");return vector.get(0).length>0?vector:(vector.set(0,sig),vector)}var pkh=prev.getPubkeyhash();if(pkh){if(!ring.getKeyHash().equals(pkh))return null;if(2!==vector.length)throw new Error("Input has not been templated.");if(0===vector.get(1).length)throw new Error("Input has not been templated.");return vector.get(0).length>0?vector:(vector.set(0,sig),vector)}var _prev$getMultisig2=prev.getMultisig(),m=_prev$getMultisig2[0],n=_prev$getMultisig2[1];if(-1!==m){if(vector.length<2)throw new Error("Input has not been templated.");if(0!==vector.get(0).length)throw new Error("Input has not been templated.");if(vector.length-1>n)throw new Error("Input has not been templated.");for(var total=0,i=1;i<vector.length;i++){vector.get(i).length>0&&(total+=1)}if(total===m&&vector.length-1===m)return vector;for(;vector.length-1<n;)vector.pushInt(0);var keys=[],_iterator3=prev.code,_isArray3=Array.isArray(_iterator3),_i3=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref5;if(_isArray3){if(_i3>=_iterator3.length)break;_ref5=_iterator3[_i3++]}else{if((_i3=_iterator3.next()).done)break;_ref5=_i3.value}var op=_ref5;op.data&&keys.push(op.data)}for(var keyIndex=-1,_i4=0;_i4<keys.length;_i4++){if(keys[_i4].equals(ring.publicKey)){keyIndex=_i4;break}}if(-1===keyIndex)return null;if((keyIndex+=1)<vector.length&&total<m&&0===vector.get(keyIndex).length&&(vector.set(keyIndex,sig),total+=1),total>=m){for(var _i5=vector.length-1;_i5>=1;_i5--){0===vector.get(_i5).length&&vector.remove(_i5)}for(;total>m;)vector.pop(),total-=1;assert(total===m),assert(vector.length-1===m)}return vector}return null},MTX.prototype.isSigned=function(){for(var i=0;i<this.inputs.length;i++){var prevout=this.inputs[i].prevout,coin=this.view.getOutput(prevout);if(!coin)return!1;if(!this.isInputSigned(i,coin))return!1}return!0},MTX.prototype.isInputSigned=function(index,coin){var input=this.inputs[index];assert(input,"Input does not exist."),assert(coin,"No coin passed.");var prev=coin.script,vector=input.script,redeem=!1;if(prev.isScripthash()){if(!(prev=input.script.getRedeem()))return!1;redeem=!0}if(prev.isWitnessScripthash()){if(!(prev=input.witness.getRedeem()))return!1;vector=input.witness,redeem=!0}else{var wpkh=prev.getWitnessPubkeyhash();wpkh&&(prev=Script.fromPubkeyhash(wpkh),vector=input.witness,redeem=!1)}var stack=vector.toStack();return redeem&&stack.pop(),this.isVectorSigned(prev,stack)},MTX.prototype.isVectorSigned=function(prev,vector){if(prev.isPubkey())return 1===vector.length&&0!==vector.get(0).length;if(prev.isPubkeyhash())return 2===vector.length&&(0!==vector.get(0).length&&0!==vector.get(1).length);var m=prev.getMultisig()[0];if(-1!==m){if(vector.length-1!==m)return!1;for(var i=1;i<vector.length;i++){if(0===vector.get(i).length)return!1}return!0}return!1},MTX.prototype.template=function(ring){if(Array.isArray(ring)){var _total=0,_iterator4=ring,_isArray4=Array.isArray(_iterator4),_i6=0;for(_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();;){var _ref6;if(_isArray4){if(_i6>=_iterator4.length)break;_ref6=_iterator4[_i6++]}else{if((_i6=_iterator4.next()).done)break;_ref6=_i6.value}var key=_ref6;_total+=this.template(key)}return _total}for(var total=0,i=0;i<this.inputs.length;i++){var prevout=this.inputs[i].prevout,coin=this.view.getOutput(prevout);coin&&(ring.ownOutput(coin)&&this.scriptInput(i,coin,ring)&&(total+=1))}return total},MTX.prototype.sign=function(ring,type){if(Array.isArray(ring)){var _total2=0,_iterator5=ring,_isArray5=Array.isArray(_iterator5),_i7=0;for(_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();;){var _ref7;if(_isArray5){if(_i7>=_iterator5.length)break;_ref7=_iterator5[_i7++]}else{if((_i7=_iterator5.next()).done)break;_ref7=_i7.value}var key=_ref7;_total2+=this.sign(key,type)}return _total2}assert(ring.privateKey,"No private key available.");for(var total=0,i=0;i<this.inputs.length;i++){var prevout=this.inputs[i].prevout,coin=this.view.getOutput(prevout);coin&&(ring.ownOutput(coin)&&this.scriptInput(i,coin,ring)&&this.signInput(i,coin,ring,type)&&(total+=1))}return total},MTX.prototype.signAsync=function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(ring,type,pool){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(pool){_context3.next=2;break}return _context3.abrupt("return",this.sign(ring,type));case 2:return _context3.next=4,pool.sign(this,ring,type);case 4:return _context3.abrupt("return",_context3.sent);case 5:case"end":return _context3.stop()}},_callee3,this)}));return function(_x8,_x9,_x10){return _ref8.apply(this,arguments)}}(),MTX.prototype.estimateSize=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(estimate){var scale,total,_iterator6,_isArray6,_i8,_ref10,_iterator7,_isArray7,_i9,_ref12,prevout,coin,prev,_prev$getMultisig4,m,size,_size,_size2,_size3;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:scale=consensus.WITNESS_SCALE_FACTOR,total=0,total+=4,total+=encoding.sizeVarint(this.inputs.length),total+=40*this.inputs.length,total+=encoding.sizeVarint(this.outputs.length),_iterator6=this.outputs,_isArray6=Array.isArray(_iterator6),_i8=0,_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();case 7:if(!_isArray6){_context4.next=13;break}if(!(_i8>=_iterator6.length)){_context4.next=10;break}return _context4.abrupt("break",21);case 10:_ref10=_iterator6[_i8++],_context4.next=17;break;case 13:if(!(_i8=_iterator6.next()).done){_context4.next=16;break}return _context4.abrupt("break",21);case 16:_ref10=_i8.value;case 17:total+=_ref10.getSize();case 19:_context4.next=7;break;case 21:total+=4,_iterator7=this.inputs,_isArray7=Array.isArray(_iterator7),_i9=0,_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();case 23:if(!_isArray7){_context4.next=29;break}if(!(_i9>=_iterator7.length)){_context4.next=26;break}return _context4.abrupt("break",86);case 26:_ref12=_iterator7[_i9++],_context4.next=33;break;case 29:if(!(_i9=_iterator7.next()).done){_context4.next=32;break}return _context4.abrupt("break",86);case 32:_ref12=_i9.value;case 33:if(prevout=_ref12.prevout,coin=this.view.getOutput(prevout)){_context4.next=39;break}return total+=110,_context4.abrupt("continue",84);case 39:if(!(prev=coin.script).isPubkey()){_context4.next=44;break}return total+=1,total+=74,_context4.abrupt("continue",84);case 44:if(!prev.isPubkeyhash()){_context4.next=49;break}return total+=1,total+=74,total+=34,_context4.abrupt("continue",84);case 49:if(_prev$getMultisig4=prev.getMultisig(),-1===(m=_prev$getMultisig4[0])){_context4.next=57;break}return size=0,size+=1,size+=74*m,size+=encoding.sizeVarint(size),total+=size,_context4.abrupt("continue",84);case 57:if(!prev.isWitnessPubkeyhash()){_context4.next=65;break}return _size=0,_size+=1,_size+=74,total+=_size=((_size+=34)+scale-1)/scale|0,_context4.abrupt("continue",84);case 65:if(!estimate){_context4.next=72;break}return _context4.next=68,estimate(prev);case 68:if(-1===(_size2=_context4.sent)){_context4.next=72;break}return total+=_size2,_context4.abrupt("continue",84);case 72:if(!prev.isScripthash()){_context4.next=76;break}return total+=1,total+=149,_context4.abrupt("continue",84);case 76:if(!prev.isWitnessScripthash()){_context4.next=83;break}return _size3=0,_size3+=1,total+=_size3=((_size3+=149)+scale-1)/scale|0,_context4.abrupt("continue",84);case 83:total+=110;case 84:_context4.next=23;break;case 86:return _context4.abrupt("return",total);case 87:case"end":return _context4.stop()}},_callee4,this)}));return function(_x11){return _ref9.apply(this,arguments)}}(),MTX.prototype.selectCoins=function(coins,options){return new CoinSelector(this,options).select(coins)},MTX.prototype.subtractIndex=function(index,fee){assert("number"==typeof index),assert("number"==typeof fee);var output=this.outputs[index];if(!output)throw new Error("Subtraction index does not exist.");if(output.value<fee+output.getDustThreshold())throw new Error("Could not subtract fee.");output.value-=fee},MTX.prototype.subtractFee=function(fee){assert("number"==typeof fee);var outputs=0,_iterator8=this.outputs,_isArray8=Array.isArray(_iterator8),_i10=0;for(_iterator8=_isArray8?_iterator8:_iterator8[Symbol.iterator]();;){var _ref13;if(_isArray8){if(_i10>=_iterator8.length)break;_ref13=_iterator8[_i10++]}else{if((_i10=_iterator8.next()).done)break;_ref13=_i10.value}_ref13.script.isUnspendable()||(outputs+=1)}if(0===outputs)throw new Error("Could not subtract fee.");var left=fee%outputs,share=(fee-left)/outputs,_iterator9=this.outputs,_isArray9=Array.isArray(_iterator9),_i11=0;for(_iterator9=_isArray9?_iterator9:_iterator9[Symbol.iterator]();;){var _ref14;if(_isArray9){if(_i11>=_iterator9.length)break;_ref14=_iterator9[_i11++]}else{if((_i11=_iterator9.next()).done)break;_ref14=_i11.value}var _output=_ref14;if(!_output.script.isUnspendable()){if(_output.value<share+_output.getDustThreshold())throw new Error("Could not subtract fee.");_output.value-=share}}var _iterator10=this.outputs,_isArray10=Array.isArray(_iterator10),_i12=0;for(_iterator10=_isArray10?_iterator10:_iterator10[Symbol.iterator]();;){var _ref15;if(_isArray10){if(_i12>=_iterator10.length)break;_ref15=_iterator10[_i12++]}else{if((_i12=_iterator10.next()).done)break;_ref15=_i12.value}var _output2=_ref15;if(!_output2.script.isUnspendable()&&_output2.value>=left+_output2.getDustThreshold())return void(_output2.value-=left)}throw new Error("Could not subtract fee.")},MTX.prototype.fund=function(){var _ref16=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(coins,options){var select,_iterator11,_isArray11,_i13,_ref17,coin,index,output;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return assert(options,"Options are required."),assert(options.changeAddress,"Change address is required."),assert(0===this.inputs.length,"TX is already funded."),_context5.next=5,this.selectCoins(coins,options);case 5:select=_context5.sent,_iterator11=select.chosen,_isArray11=Array.isArray(_iterator11),_i13=0,_iterator11=_isArray11?_iterator11:_iterator11[Symbol.iterator]();case 7:if(!_isArray11){_context5.next=13;break}if(!(_i13>=_iterator11.length)){_context5.next=10;break}return _context5.abrupt("break",21);case 10:_ref17=_iterator11[_i13++],_context5.next=17;break;case 13:if(!(_i13=_iterator11.next()).done){_context5.next=16;break}return _context5.abrupt("break",21);case 16:_ref17=_i13.value;case 17:coin=_ref17,this.addCoin(coin);case 19:_context5.next=7;break;case 21:return select.subtractFee&&(-1!==(index=select.subtractIndex)?this.subtractIndex(index,select.fee):this.subtractFee(select.fee)),(output=new Output).value=select.change,output.script.fromAddress(select.changeAddress),output.isDust(policy.MIN_RELAY)?(this.changeIndex=-1,assert.strictEqual(this.getFee(),select.fee+select.change)):(this.outputs.push(output),this.changeIndex=this.outputs.length-1,assert.strictEqual(this.getFee(),select.fee)),_context5.abrupt("return",select);case 27:case"end":return _context5.stop()}},_callee5,this)}));return function(_x12,_x13){return _ref16.apply(this,arguments)}}(),MTX.prototype.sortMembers=function(){var changeOutput=null;-1!==this.changeIndex&&(changeOutput=this.outputs[this.changeIndex],assert(changeOutput)),this.inputs.sort(sortInputs),this.outputs.sort(sortOutputs),-1!==this.changeIndex&&(this.changeIndex=this.outputs.indexOf(changeOutput),assert(-1!==this.changeIndex))},MTX.prototype.avoidFeeSniping=function(height){assert("number"==typeof height,"Must pass in height."),0==(10*Math.random()|0)&&(height-=100*Math.random()|0)<0&&(height=0),this.setLocktime(height)},MTX.prototype.setLocktime=function(locktime){assert(locktime>>>0===locktime,"Locktime must be a uint32."),assert(this.inputs.length>0,"Cannot set sequence with no inputs.");var _iterator12=this.inputs,_isArray12=Array.isArray(_iterator12),_i14=0;for(_iterator12=_isArray12?_iterator12:_iterator12[Symbol.iterator]();;){var _ref18;if(_isArray12){if(_i14>=_iterator12.length)break;_ref18=_iterator12[_i14++]}else{if((_i14=_iterator12.next()).done)break;_ref18=_i14.value}var input=_ref18;4294967295===input.sequence&&(input.sequence=4294967294)}this.locktime=locktime},MTX.prototype.setSequence=function(index,locktime,seconds){var input=this.inputs[index];assert(input,"Input does not exist."),assert(locktime>>>0===locktime,"Locktime must be a uint32."),this.version=2,seconds?(locktime>>>=consensus.SEQUENCE_GRANULARITY,locktime&=consensus.SEQUENCE_MASK,locktime|=consensus.SEQUENCE_TYPE_FLAG):locktime&=consensus.SEQUENCE_MASK,input.sequence=locktime},MTX.prototype.inspect=function(){return this.format()},MTX.prototype.format=function(){return _TX.prototype.format.call(this,this.view)},MTX.prototype.toJSON=function(){return _TX.prototype.toJSON.call(this,null,this.view)},MTX.prototype.getJSON=function(network){return _TX.prototype.getJSON.call(this,network,this.view)},MTX.fromJSON=function(json){return(new this).fromJSON(json)},MTX.fromReader=function(br){return(new this).fromReader(br)},MTX.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},MTX.prototype.toTX=function(){return(new TX).inject(this)},MTX.prototype.commit=function(){return[this.toTX(),this.view]},MTX.fromTX=function(tx){return(new this).inject(tx)},MTX.isMTX=function(obj){return obj instanceof MTX},MTX}(TX),CoinSelector=function(){function CoinSelector(tx,options){_classCallCheck(this,CoinSelector),this.tx=tx.clone(),this.coins=[],this.outputValue=0,this.index=0,this.chosen=[],this.change=0,this.fee=CoinSelector.MIN_FEE,this.selection="value",this.subtractFee=!1,this.subtractIndex=-1,this.height=-1,this.depth=-1,this.hardFee=-1,this.rate=CoinSelector.FEE_RATE,this.maxFee=-1,this.round=!1,this.changeAddress=null,this.estimate=null,options&&this.fromOptions(options)}return CoinSelector.prototype.fromOptions=function(options){if(options.selection&&(assert("string"==typeof options.selection),this.selection=options.selection),null!=options.subtractFee&&("number"==typeof options.subtractFee?(assert(Number.isSafeInteger(options.subtractFee)),assert(options.subtractFee>=-1),this.subtractIndex=options.subtractFee,this.subtractFee=-1!==this.subtractIndex):(assert("boolean"==typeof options.subtractFee),this.subtractFee=options.subtractFee)),null!=options.subtractIndex&&(assert(Number.isSafeInteger(options.subtractIndex)),assert(options.subtractIndex>=-1),this.subtractIndex=options.subtractIndex,this.subtractFee=-1!==this.subtractIndex),null!=options.height&&(assert(Number.isSafeInteger(options.height)),assert(options.height>=-1),this.height=options.height),null!=options.confirmations&&(assert(Number.isSafeInteger(options.confirmations)),assert(options.confirmations>=-1),this.depth=options.confirmations),null!=options.depth&&(assert(Number.isSafeInteger(options.depth)),assert(options.depth>=-1),this.depth=options.depth),null!=options.hardFee&&(assert(Number.isSafeInteger(options.hardFee)),assert(options.hardFee>=-1),this.hardFee=options.hardFee),null!=options.rate&&(assert(Number.isSafeInteger(options.rate)),assert(options.rate>=0),this.rate=options.rate),null!=options.maxFee&&(assert(Number.isSafeInteger(options.maxFee)),assert(options.maxFee>=-1),this.maxFee=options.maxFee),null!=options.round&&(assert("boolean"==typeof options.round),this.round=options.round),options.changeAddress){var addr=options.changeAddress;"string"==typeof addr?this.changeAddress=Address.fromString(addr):(assert(addr instanceof Address),this.changeAddress=addr)}return options.estimate&&(assert("function"==typeof options.estimate),this.estimate=options.estimate),this},CoinSelector.prototype.init=function(coins){switch(this.coins=coins.slice(),this.outputValue=this.tx.getOutputValue(),this.index=0,this.chosen=[],this.change=0,this.fee=CoinSelector.MIN_FEE,this.tx.inputs.length=0,this.selection){case"all":case"random":this.coins.sort(sortRandom);break;case"age":this.coins.sort(sortAge);break;case"value":this.coins.sort(sortValue);break;default:throw new FundingError("Bad selection type: "+this.selection+".")}},CoinSelector.prototype.total=function(){return this.subtractFee?this.outputValue:this.outputValue+this.fee},CoinSelector.prototype.isFull=function(){return this.tx.getInputValue()>=this.total()},CoinSelector.prototype.isSpendable=function(coin){if(-1===this.height)return!0;if(coin.coinbase)return-1!==coin.height&&!(this.height+1<coin.height+consensus.COINBASE_MATURITY);if(-1===this.depth)return!0;return!(coin.getDepth(this.height)<this.depth)},CoinSelector.prototype.getFee=function(size){if(this.round){var _fee=policy.getRoundFee(size,this.rate);return Math.min(_fee,CoinSelector.MAX_FEE)}var fee=policy.getMinFee(size,this.rate);return Math.min(fee,CoinSelector.MAX_FEE)},CoinSelector.prototype.fund=function(){for(;this.index<this.coins.length;){var coin=this.coins[this.index++];if(this.isSpendable(coin)&&(this.tx.addCoin(coin),this.chosen.push(coin),"all"!==this.selection&&this.isFull()))break}},CoinSelector.prototype.select=function(){var _ref19=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(coins){return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(this.init(coins),-1===this.hardFee){_context6.next=5;break}this.selectHard(),_context6.next=7;break;case 5:return _context6.next=7,this.selectEstimate();case 7:if(this.isFull()){_context6.next=9;break}throw new FundingError("Not enough funds.",this.tx.getInputValue(),this.total());case 9:return this.change=this.tx.getInputValue()-this.total(),_context6.abrupt("return",this);case 11:case"end":return _context6.stop()}},_callee6,this)}));return function(_x14){return _ref19.apply(this,arguments)}}(),CoinSelector.prototype.selectEstimate=function(){var _ref20=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(){var change,size;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:this.fee=CoinSelector.MIN_FEE,this.fund(),change=new Output,this.changeAddress?change.script.fromAddress(this.changeAddress):change.script.fromPubkeyhash(Buffer.allocUnsafe(20)),this.tx.outputs.push(change);case 5:return _context7.next=7,this.tx.estimateSize(this.estimate);case 7:if(size=_context7.sent,this.fee=this.getFee(size),!(this.maxFee>0&&this.fee>this.maxFee)){_context7.next=11;break}throw new FundingError("Fee is too high.");case 11:this.isFull()||this.fund();case 12:if(!this.isFull()&&this.index<this.coins.length){_context7.next=5;break}case 13:case"end":return _context7.stop()}},_callee7,this)}));return function(){return _ref20.apply(this,arguments)}}(),CoinSelector.prototype.selectHard=function(){this.fee=Math.min(this.hardFee,CoinSelector.MAX_FEE),this.fund()},CoinSelector}();CoinSelector.FEE_RATE=1e4,CoinSelector.MIN_FEE=1e4,CoinSelector.MAX_FEE=consensus.COIN/10;var FundingError=function(_Error){_inherits(FundingError,_Error);function FundingError(msg,available,required){_classCallCheck(this,FundingError);var _this2=_possibleConstructorReturn(this,_Error.call(this));return _this2.type="FundingError",_this2.message=msg,_this2.availableFunds=-1,_this2.requiredFunds=-1,null!=available&&(_this2.message+=" (available="+Amount.btc(available)+",",_this2.message+=" required="+Amount.btc(required)+")",_this2.availableFunds=available,_this2.requiredFunds=required),Error.captureStackTrace&&Error.captureStackTrace(_this2,FundingError),_this2}return FundingError}(Error);function sortAge(a,b){return(a=-1===a.height?2147483647:a.height)-(b=-1===b.height?2147483647:b.height)}function sortRandom(a,b){return Math.random()>.5?1:-1}function sortValue(a,b){return-1===a.height&&-1!==b.height?1:-1!==a.height&&-1===b.height?-1:b.value-a.value}function sortInputs(a,b){return a.compare(b)}function sortOutputs(a,b){return a.compare(b)}(exports=MTX).MTX=MTX,exports.Selector=CoinSelector,exports.FundingError=FundingError,module.exports=exports}).call(this,require("buffer").Buffer)},{"../btc/amount":8,"../coins/coinview":13,"../protocol/consensus":84,"../protocol/policy":89,"../script/script":95,"../script/stack":99,"./address":69,"./coin":71,"./input":74,"./outpoint":80,"./output":81,"./tx":82,assert:146,buffer:269,bufio:270}],80:[function(require,module,exports){"use strict";var assert=require("assert"),bio=require("bufio"),util=require("../utils/util"),consensus=require("../protocol/consensus"),Outpoint=function(){function Outpoint(hash,index){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Outpoint),this.hash=consensus.NULL_HASH,this.index=4294967295,null!=hash&&(assert("string"==typeof hash,"Hash must be a string."),assert(index>>>0===index,"Index must be a uint32."),this.hash=hash,this.index=index)}return Outpoint.prototype.fromOptions=function(options){return assert(options,"Outpoint data is required."),assert("string"==typeof options.hash,"Hash must be a string."),assert(options.index>>>0===options.index,"Index must be a uint32."),this.hash=options.hash,this.index=options.index,this},Outpoint.fromOptions=function(options){return(new this).fromOptions(options)},Outpoint.prototype.clone=function(){var outpoint=new this.constructor;return outpoint.hash=this.value,outpoint.index=this.index,outpoint},Outpoint.prototype.equals=function(prevout){return assert(Outpoint.isOutpoint(prevout)),this.hash===prevout.hash&&this.index===prevout.index},Outpoint.prototype.compare=function(prevout){assert(Outpoint.isOutpoint(prevout));var cmp=function(a,b){for(var len=Math.min(a.length,b.length),i=0;i<len;i++){if(a[i]<b[i])return-1;if(a[i]>b[i])return 1}return a.length<b.length?-1:a.length>b.length?1:0}(this.txid(),prevout.txid());return 0!==cmp?cmp:this.index-prevout.index},Outpoint.prototype.isNull=function(){return 4294967295===this.index&&this.hash===consensus.NULL_HASH},Outpoint.prototype.rhash=function(){return util.revHex(this.hash)},Outpoint.prototype.txid=function(){return this.rhash()},Outpoint.prototype.toKey=function(){return Outpoint.toKey(this.hash,this.index)},Outpoint.prototype.fromKey=function(key){return assert(key.length>64),this.hash=key.slice(0,64),this.index=parseInt(key.slice(64),10),this},Outpoint.fromKey=function(key){return(new this).fromKey(key)},Outpoint.prototype.toWriter=function(bw){return bw.writeHash(this.hash),bw.writeU32(this.index),bw},Outpoint.prototype.getSize=function(){return 36},Outpoint.prototype.toRaw=function(){return this.toWriter(bio.write(36)).render()},Outpoint.prototype.fromReader=function(br){return this.hash=br.readHash("hex"),this.index=br.readU32(),this},Outpoint.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},Outpoint.fromReader=function(br){return(new this).fromReader(br)},Outpoint.fromRaw=function(data){return(new this).fromRaw(data)},Outpoint.prototype.fromJSON=function(json){return assert(json,"Outpoint data is required."),assert("string"==typeof json.hash,"Hash must be a string."),assert(json.index>>>0===json.index,"Index must be a uint32."),this.hash=util.revHex(json.hash),this.index=json.index,this},Outpoint.prototype.toJSON=function(){return{hash:util.revHex(this.hash),index:this.index}},Outpoint.fromJSON=function(json){return(new this).fromJSON(json)},Outpoint.prototype.fromTX=function(tx,index){return assert(tx),assert("number"==typeof index),assert(index>=0),this.hash=tx.hash("hex"),this.index=index,this},Outpoint.fromTX=function(tx,index){return(new this).fromTX(tx,index)},Outpoint.toKey=function(hash,index){return assert("string"==typeof hash),assert(64===hash.length),assert(index>=0),hash+index},Outpoint.prototype.inspect=function(){return"<Outpoint: "+this.rhash()+"/"+this.index+">"},Outpoint.isOutpoint=function(obj){return obj instanceof Outpoint},Outpoint}();module.exports=Outpoint},{"../protocol/consensus":84,"../utils/util":106,assert:146,bufio:270}],81:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),bio=require("bufio"),Amount=require("../btc/amount"),Network=require("../protocol/network"),Address=require("../primitives/address"),Script=require("../script/script"),policy=(require("../protocol/consensus"),require("../protocol/policy")),Output=function(){function Output(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Output),this.value=0,this.script=new Script,options&&this.fromOptions(options)}return Output.prototype.fromOptions=function(options){return assert(options,"Output data is required."),options.value&&(assert(Number.isSafeInteger(options.value)&&options.value>=0,"Value must be a uint64."),this.value=options.value),options.script&&this.script.fromOptions(options.script),options.address&&this.script.fromAddress(options.address),this},Output.fromOptions=function(options){return(new this).fromOptions(options)},Output.prototype.fromScript=function(script,value){return"string"==typeof script&&(script=Address.fromString(script)),script instanceof Address&&(script=Script.fromAddress(script)),assert(script instanceof Script,"Script must be a Script."),assert(Number.isSafeInteger(value)&&value>=0,"Value must be a uint64."),this.script=script,this.value=value,this},Output.fromScript=function(script,value){return(new this).fromScript(script,value)},Output.prototype.clone=function(){var output=new this.constructor;return output.value=this.value,output.script.inject(this.script),output},Output.prototype.equals=function(output){return assert(Output.isOutput(output)),this.value===output.value&&this.script.equals(output.script)},Output.prototype.compare=function(output){assert(Output.isOutput(output));var cmp=this.value-output.value;return 0!==cmp?cmp:this.script.compare(output.script)},Output.prototype.getType=function(){return Script.typesByVal[this.script.getType()].toLowerCase()},Output.prototype.getAddress=function(){return this.script.getAddress()},Output.prototype.getHash=function(enc){var addr=this.getAddress();return addr?addr.getHash(enc):null},Output.prototype.inspect=function(){return{type:this.getType(),value:Amount.btc(this.value),script:this.script,address:this.getAddress()}},Output.prototype.toJSON=function(){return this.getJSON()},Output.prototype.getJSON=function(network){var addr=this.getAddress();return network=Network.get(network),addr&&(addr=addr.toString(network)),{value:this.value,script:this.script.toJSON(),address:addr}},Output.prototype.getDustThreshold=function(rate){if(this.script.isUnspendable())return 0;var size=this.getSize();return this.script.isProgram()&&(size+=148),3*policy.getMinFee(size,rate)},Output.prototype.getSize=function(){return 8+this.script.getVarSize()},Output.prototype.isDust=function(rate){return this.value<this.getDustThreshold(rate)},Output.prototype.fromJSON=function(json){return assert(json,"Output data is required."),assert(Number.isSafeInteger(json.value)&&json.value>=0,"Value must be a uint64."),this.value=json.value,this.script.fromJSON(json.script),this},Output.fromJSON=function(json){return(new this).fromJSON(json)},Output.prototype.toWriter=function(bw){return bw.writeI64(this.value),bw.writeVarBytes(this.script.toRaw()),bw},Output.prototype.toRaw=function(){var size=this.getSize();return this.toWriter(bio.write(size)).render()},Output.prototype.fromReader=function(br){return this.value=br.readI64(),this.script.fromRaw(br.readVarBytes()),this},Output.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},Output.fromReader=function(br){return(new this).fromReader(br)},Output.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},Output.isOutput=function(obj){return obj instanceof Output},Output}();module.exports=Output}).call(this,require("buffer").Buffer)},{"../btc/amount":8,"../primitives/address":69,"../protocol/consensus":84,"../protocol/network":87,"../protocol/policy":89,"../script/script":95,assert:146,buffer:269,bufio:270}],82:[function(require,module,exports){(function(Buffer){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),bio=require("bufio"),hash256=require("bcrypto/lib/hash256"),secp256k1=require("bcrypto/lib/secp256k1"),util=require("../utils/util"),Amount=require("../btc/amount"),Network=require("../protocol/network"),Script=require("../script/script"),Input=require("./input"),Output=require("./output"),Outpoint=require("./outpoint"),InvItem=require("./invitem"),consensus=require("../protocol/consensus"),policy=require("../protocol/policy"),ScriptError=require("../script/scripterror"),encoding=bio.encoding,hashType=Script.hashType,TX=function(){function TX(options){_classCallCheck(this,TX),this.version=1,this.inputs=[],this.outputs=[],this.locktime=0,this.mutable=!1,this._hash=null,this._hhash=null,this._raw=null,this._size=-1,this._sigops=-1,this._hashPrevouts=null,this._hashSequence=null,this._hashOutputs=null,options&&this.fromOptions(options)}return TX.prototype.fromOptions=function(options){if(assert(options,"TX data is required."),null!=options.version&&(assert(options.version>>>0===options.version,"Version must be a uint32."),this.version=options.version),options.inputs){assert(Array.isArray(options.inputs),"Inputs must be an array.");var _iterator=options.inputs,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var input=_ref;this.inputs.push(new Input(input))}}if(options.outputs){assert(Array.isArray(options.outputs),"Outputs must be an array.");var _iterator2=options.outputs,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref2=_i2.value}var output=_ref2;this.outputs.push(new Output(output))}}return null!=options.locktime&&(assert(options.locktime>>>0===options.locktime,"Locktime must be a uint32."),this.locktime=options.locktime),this},TX.fromOptions=function(options){return(new this).fromOptions(options)},TX.prototype.clone=function(){return(new this.constructor).inject(this)},TX.prototype.inject=function(tx){this.version=tx.version;var _iterator3=tx.inputs,_isArray3=Array.isArray(_iterator3),_i3=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref3;if(_isArray3){if(_i3>=_iterator3.length)break;_ref3=_iterator3[_i3++]}else{if((_i3=_iterator3.next()).done)break;_ref3=_i3.value}var input=_ref3;this.inputs.push(input.clone())}var _iterator4=tx.outputs,_isArray4=Array.isArray(_iterator4),_i4=0;for(_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();;){var _ref4;if(_isArray4){if(_i4>=_iterator4.length)break;_ref4=_iterator4[_i4++]}else{if((_i4=_iterator4.next()).done)break;_ref4=_i4.value}var output=_ref4;this.outputs.push(output.clone())}return this.locktime=tx.locktime,this},TX.prototype.refresh=function(){this._hash=null,this._hhash=null,this._raw=null,this._size=-1,this._sigops=-1,this._hashPrevouts=null,this._hashSequence=null,this._hashOutputs=null},TX.prototype.hash=function(enc){var h=this._hash;if(h||(h=hash256.digest(this.toNormal()),this.mutable||(this._hash=h)),"hex"===enc){var hex=this._hhash;hex||(hex=h.toString("hex"),this.mutable||(this._hhash=hex)),h=hex}return h},TX.prototype.toRaw=function(){return this.frame().data},TX.prototype.toNormal=function(){return this.frameNormal().data},TX.prototype.toWriter=function(bw){return this.mutable?this.writeNormal(bw):(bw.writeBytes(this.toRaw()),bw)},TX.prototype.toNormalWriter=function(bw){return this.toWriter(bw)},TX.prototype.frame=function(){if(this.mutable)return assert(!this._raw),this.frameNormal();if(this._raw){assert(this._size>=0);var _raw=new RawTX(this._size);return _raw.data=this._raw,_raw}var raw=void 0;return raw=this.frameNormal(),this._raw=raw.data,this._size=raw.size,raw},TX.prototype.getSizes=function(){return this.mutable?this.getNormalSizes():this.frame()},TX.prototype.getVirtualSize=function(){var scale=consensus.WITNESS_SCALE_FACTOR;return(this.getWeight()+scale-1)/scale|0},TX.prototype.getSigopsSize=function(sigops){var scale=consensus.WITNESS_SCALE_FACTOR,bytes=policy.BYTES_PER_SIGOP;return(Math.max(this.getWeight(),sigops*bytes)+scale-1)/scale|0},TX.prototype.getWeight=function(){var raw=this.getSizes();return(raw.size-raw.witness)*(consensus.WITNESS_SCALE_FACTOR-1)+raw.size},TX.prototype.getSize=function(){return this.getSizes().size},TX.prototype.getBaseSize=function(){return this.getSizes().size},TX.prototype.signatureHash=function(index,prev,value,type,flags){return assert(index>=0&&index<this.inputs.length),assert(prev instanceof Script),assert("number"==typeof value),assert("number"==typeof type),null==flags&&(flags|=Script.flags.STANDARD_VERIFY_FLAGS),type&Script.hashType.SIGHASH_FORKID&&flags&Script.flags.VERIFY_SIGHASH_FORKID?this.signatureHashV1(index,prev,value,type):this.signatureHashV0(index,prev,type)},TX.prototype.signatureHashV0=function(index,prev,type){if((31&type)===hashType.SINGLE&&index>=this.outputs.length){var hash=Buffer.alloc(32,0);return hash[0]=1,hash}prev=prev.removeSeparators();var size=this.hashSize(index,prev,type),bw=bio.pool(size);if(bw.writeU32(this.version),type&hashType.ANYONECANPAY){var input=this.inputs[index];bw.writeVarint(1),input.prevout.toWriter(bw),bw.writeVarBytes(prev.toRaw()),bw.writeU32(input.sequence)}else{bw.writeVarint(this.inputs.length);for(var i=0;i<this.inputs.length;i++){var _input=this.inputs[i];if(_input.prevout.toWriter(bw),i!==index)switch(bw.writeVarint(0),31&type){case hashType.NONE:case hashType.SINGLE:bw.writeU32(0);break;default:bw.writeU32(_input.sequence)}else bw.writeVarBytes(prev.toRaw()),bw.writeU32(_input.sequence)}}switch(31&type){case hashType.NONE:bw.writeVarint(0);break;case hashType.SINGLE:var output=this.outputs[index];bw.writeVarint(index+1);for(var _i5=0;_i5<index;_i5++)bw.writeI64(-1),bw.writeVarint(0);output.toWriter(bw);break;default:bw.writeVarint(this.outputs.length);var _iterator5=this.outputs,_isArray5=Array.isArray(_iterator5),_i6=0;for(_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();;){var _ref5;if(_isArray5){if(_i6>=_iterator5.length)break;_ref5=_iterator5[_i6++]}else{if((_i6=_iterator5.next()).done)break;_ref5=_i6.value}_ref5.toWriter(bw)}}return bw.writeU32(this.locktime),bw.writeU32(type),hash256.digest(bw.render())},TX.prototype.hashSize=function(index,prev,type){var size=0;switch(size+=4,type&hashType.ANYONECANPAY?(size+=1,size+=36,size+=prev.getVarSize(),size+=4):(size+=encoding.sizeVarint(this.inputs.length),size+=41*(this.inputs.length-1),size+=36,size+=prev.getVarSize(),size+=4),31&type){case hashType.NONE:size+=1;break;case hashType.SINGLE:size+=encoding.sizeVarint(index+1),size+=9*index,size+=this.outputs[index].getSize();break;default:size+=encoding.sizeVarint(this.outputs.length);var _iterator6=this.outputs,_isArray6=Array.isArray(_iterator6),_i7=0;for(_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();;){var _ref6;if(_isArray6){if(_i7>=_iterator6.length)break;_ref6=_iterator6[_i7++]}else{if((_i7=_iterator6.next()).done)break;_ref6=_i7.value}size+=_ref6.getSize()}}return size+=8},TX.prototype.signatureHashV1=function(index,prev,value,type){var input=this.inputs[index],prevouts=consensus.ZERO_HASH,sequences=consensus.ZERO_HASH,outputs=consensus.ZERO_HASH;if(type&hashType.SIGHASH_FORKID&&Script.flags.VERIFY_SIGHASH_FORKID){if(prevouts=this._hashPrevouts,sequences=this._hashSequence,outputs=this._hashOutputs,!(type&hashType.ANYONECANPAY))if(this._hashPrevouts)prevouts=this._hashPrevouts;else{var _bw=bio.pool(36*this.inputs.length),_iterator7=this.inputs,_isArray7=Array.isArray(_iterator7),_i8=0;for(_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();;){var _ref7;if(_isArray7){if(_i8>=_iterator7.length)break;_ref7=_iterator7[_i8++]}else{if((_i8=_iterator7.next()).done)break;_ref7=_i8.value}_ref7.prevout.toWriter(_bw)}prevouts=hash256.digest(_bw.render()),this.mutable||(this._hashPrevouts=prevouts)}if(!(type&hashType.ANYONECANPAY)&&(31&type)!==hashType.SINGLE&&(31&type)!==hashType.NONE)if(this._hashSequence)sequences=this._hashSequence;else{var _bw2=bio.pool(4*this.inputs.length),_iterator8=this.inputs,_isArray8=Array.isArray(_iterator8),_i9=0;for(_iterator8=_isArray8?_iterator8:_iterator8[Symbol.iterator]();;){var _ref8;if(_isArray8){if(_i9>=_iterator8.length)break;_ref8=_iterator8[_i9++]}else{if((_i9=_iterator8.next()).done)break;_ref8=_i9.value}var _input3=_ref8;_bw2.writeU32(_input3.sequence)}sequences=hash256.digest(_bw2.render()),this.mutable||(this._hashSequence=sequences)}if((31&type)!==hashType.SINGLE&&(31&type)!==hashType.NONE)if(this._hashOutputs)outputs=this._hashOutputs;else{var _size=0,_iterator9=this.outputs,_isArray9=Array.isArray(_iterator9),_i10=0;for(_iterator9=_isArray9?_iterator9:_iterator9[Symbol.iterator]();;){var _ref9;if(_isArray9){if(_i10>=_iterator9.length)break;_ref9=_iterator9[_i10++]}else{if((_i10=_iterator9.next()).done)break;_ref9=_i10.value}_size+=_ref9.getSize()}var _bw3=bio.pool(_size),_iterator10=this.outputs,_isArray10=Array.isArray(_iterator10),_i11=0;for(_iterator10=_isArray10?_iterator10:_iterator10[Symbol.iterator]();;){var _ref10;if(_isArray10){if(_i11>=_iterator10.length)break;_ref10=_iterator10[_i11++]}else{if((_i11=_iterator10.next()).done)break;_ref10=_i11.value}_ref10.toWriter(_bw3)}outputs=hash256.digest(_bw3.render()),this.mutable||(this._hashOutputs=outputs)}else if((31&type)===hashType.SINGLE&&index<this.outputs.length){var _output3=this.outputs[index];outputs=hash256.digest(_output3.toRaw())}}var size=156+prev.getVarSize(),bw=bio.pool(size);return bw.writeU32(this.version),bw.writeBytes(prevouts),bw.writeBytes(sequences),bw.writeHash(input.prevout.hash),bw.writeU32(input.prevout.index),bw.writeVarBytes(prev.toRaw()),bw.writeI64(value),bw.writeU32(input.sequence),bw.writeBytes(outputs),bw.writeU32(this.locktime),bw.writeU32(type),hash256.digest(bw.render())},TX.prototype.checksig=function(index,prev,value,sig,key,flags){if(0===sig.length)return!1;var type=sig[sig.length-1],hash=this.signatureHash(index,prev,value,type,flags);return secp256k1.verify(hash,sig.slice(0,-1),key)},TX.prototype.signature=function(index,prev,value,key,type,flags){null==type&&(type=hashType.SIGHASH_FORKID),null==flags&&(flags=Script.flags.VERIFY_SIGHASH_FORKID);var hash=this.signatureHash(index,prev,value,flags),sig=secp256k1.sign(hash,key),bw=bio.write(sig.length+1);return bw.writeBytes(sig),bw.writeU8(type),bw.render()},TX.prototype.check=function(view,flags){if(0===this.inputs.length)throw new ScriptError("UNKNOWN_ERROR","No inputs.");if(!this.isCoinbase())for(var i=0;i<this.inputs.length;i++){var prevout=this.inputs[i].prevout,coin=view.getOutput(prevout);if(!coin)throw new ScriptError("UNKNOWN_ERROR","No coin available.");this.checkInput(i,coin,flags)}},TX.prototype.checkInput=function(index,coin,flags){var input=this.inputs[index];assert(input,"Input does not exist."),assert(coin,"No coin passed."),Script.verify(input.script,coin.script,this,index,coin.value,flags)},TX.prototype.checkAsync=function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee(view,flags,pool){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(0!==this.inputs.length){_context.next=2;break}throw new ScriptError("UNKNOWN_ERROR","No inputs.");case 2:if(!this.isCoinbase()){_context.next=4;break}return _context.abrupt("return");case 4:if(pool){_context.next=7;break}return this.check(view,flags),_context.abrupt("return");case 7:return _context.next=9,pool.check(this,view,flags);case 9:case"end":return _context.stop()}},_callee,this)}));return function(_x,_x2,_x3){return _ref11.apply(this,arguments)}}(),TX.prototype.checkInputAsync=function(){var _ref12=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(index,coin,flags,pool){var input;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(input=this.inputs[index],assert(input,"Input does not exist."),assert(coin,"No coin passed."),pool){_context2.next=6;break}return this.checkInput(index,coin,flags),_context2.abrupt("return");case 6:return _context2.next=8,pool.checkInput(this,index,coin,flags);case 8:case"end":return _context2.stop()}},_callee2,this)}));return function(_x4,_x5,_x6,_x7){return _ref12.apply(this,arguments)}}(),TX.prototype.verify=function(view,flags){try{this.check(view,flags)}catch(e){if("ScriptError"===e.type)return!1;throw e}return!0},TX.prototype.verifyInput=function(index,coin,flags){try{this.checkInput(index,coin,flags)}catch(e){if("ScriptError"===e.type)return!1;throw e}return!0},TX.prototype.verifyAsync=function(){var _ref13=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(view,flags,pool){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.prev=0,_context3.next=3,this.checkAsync(view,flags,pool);case 3:_context3.next=10;break;case 5:if(_context3.prev=5,_context3.t0=_context3.catch(0),"ScriptError"!==_context3.t0.type){_context3.next=9;break}return _context3.abrupt("return",!1);case 9:throw _context3.t0;case 10:return _context3.abrupt("return",!0);case 11:case"end":return _context3.stop()}},_callee3,this,[[0,5]])}));return function(_x8,_x9,_x10){return _ref13.apply(this,arguments)}}(),TX.prototype.verifyInputAsync=function(){var _ref14=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(index,coin,flags,pool){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.prev=0,_context4.next=3,this.checkInput(index,coin,flags,pool);case 3:_context4.next=10;break;case 5:if(_context4.prev=5,_context4.t0=_context4.catch(0),"ScriptError"!==_context4.t0.type){_context4.next=9;break}return _context4.abrupt("return",!1);case 9:throw _context4.t0;case 10:return _context4.abrupt("return",!0);case 11:case"end":return _context4.stop()}},_callee4,this,[[0,5]])}));return function(_x11,_x12,_x13,_x14){return _ref14.apply(this,arguments)}}(),TX.prototype.isCoinbase=function(){return 1===this.inputs.length&&this.inputs[0].prevout.isNull()},TX.prototype.getFee=function(view){return this.hasCoins(view)?this.getInputValue(view)-this.getOutputValue():0},TX.prototype.getInputValue=function(view){var total=0,_iterator11=this.inputs,_isArray11=Array.isArray(_iterator11),_i12=0;for(_iterator11=_isArray11?_iterator11:_iterator11[Symbol.iterator]();;){var _ref16;if(_isArray11){if(_i12>=_iterator11.length)break;_ref16=_iterator11[_i12++]}else{if((_i12=_iterator11.next()).done)break;_ref16=_i12.value}var prevout=_ref16.prevout,coin=view.getOutput(prevout);if(!coin)return 0;total+=coin.value}return total},TX.prototype.getOutputValue=function(){var total=0,_iterator12=this.outputs,_isArray12=Array.isArray(_iterator12),_i13=0;for(_iterator12=_isArray12?_iterator12:_iterator12[Symbol.iterator]();;){var _ref17;if(_isArray12){if(_i13>=_iterator12.length)break;_ref17=_iterator12[_i13++]}else{if((_i13=_iterator12.next()).done)break;_ref17=_i13.value}total+=_ref17.value}return total},TX.prototype._getInputAddresses=function(view){var table=Object.create(null),addrs=[];if(this.isCoinbase())return[addrs,table];var _iterator13=this.inputs,_isArray13=Array.isArray(_iterator13),_i14=0;for(_iterator13=_isArray13?_iterator13:_iterator13[Symbol.iterator]();;){var _ref18;if(_isArray13){if(_i14>=_iterator13.length)break;_ref18=_iterator13[_i14++]}else{if((_i14=_iterator13.next()).done)break;_ref18=_i14.value}var input=_ref18,coin=view?view.getOutputFor(input):null,addr=input.getAddress(coin);if(addr){var hash=addr.getHash("hex");table[hash]||(table[hash]=!0,addrs.push(addr))}}return[addrs,table]},TX.prototype._getOutputAddresses=function(){var table=Object.create(null),addrs=[],_iterator14=this.outputs,_isArray14=Array.isArray(_iterator14),_i15=0;for(_iterator14=_isArray14?_iterator14:_iterator14[Symbol.iterator]();;){var _ref19;if(_isArray14){if(_i15>=_iterator14.length)break;_ref19=_iterator14[_i15++]}else{if((_i15=_iterator14.next()).done)break;_ref19=_i15.value}var addr=_ref19.getAddress();if(addr){var hash=addr.getHash("hex");table[hash]||(table[hash]=!0,addrs.push(addr))}}return[addrs,table]},TX.prototype._getAddresses=function(view){var _getInputAddresses2=this._getInputAddresses(view),addrs=_getInputAddresses2[0],table=_getInputAddresses2[1],_iterator15=this.getOutputAddresses(),_isArray15=Array.isArray(_iterator15),_i16=0;for(_iterator15=_isArray15?_iterator15:_iterator15[Symbol.iterator]();;){var _ref20;if(_isArray15){if(_i16>=_iterator15.length)break;_ref20=_iterator15[_i16++]}else{if((_i16=_iterator15.next()).done)break;_ref20=_i16.value}var addr=_ref20,hash=addr.getHash("hex");table[hash]||(table[hash]=!0,addrs.push(addr))}return[addrs,table]},TX.prototype.getInputAddresses=function(view){return this._getInputAddresses(view)[0]},TX.prototype.getOutputAddresses=function(){return this._getOutputAddresses()[0]},TX.prototype.getAddresses=function(view){return this._getAddresses(view)[0]},TX.prototype.getInputHashes=function(view,enc){if("hex"===enc){var table=this._getInputAddresses(view)[1];return Object.keys(table)}var hashes=[],_iterator16=this.getInputAddresses(view),_isArray16=Array.isArray(_iterator16),_i17=0;for(_iterator16=_isArray16?_iterator16:_iterator16[Symbol.iterator]();;){var _ref21;if(_isArray16){if(_i17>=_iterator16.length)break;_ref21=_iterator16[_i17++]}else{if((_i17=_iterator16.next()).done)break;_ref21=_i17.value}var addr=_ref21;hashes.push(addr.getHash())}return hashes},TX.prototype.getOutputHashes=function(enc){if("hex"===enc){var table=this._getOutputAddresses()[1];return Object.keys(table)}var hashes=[],_iterator17=this.getOutputAddresses(),_isArray17=Array.isArray(_iterator17),_i18=0;for(_iterator17=_isArray17?_iterator17:_iterator17[Symbol.iterator]();;){var _ref22;if(_isArray17){if(_i18>=_iterator17.length)break;_ref22=_iterator17[_i18++]}else{if((_i18=_iterator17.next()).done)break;_ref22=_i18.value}var addr=_ref22;hashes.push(addr.getHash())}return hashes},TX.prototype.getHashes=function(view,enc){if("hex"===enc){var table=this._getAddresses(view)[1];return Object.keys(table)}var hashes=[],_iterator18=this.getAddresses(view),_isArray18=Array.isArray(_iterator18),_i19=0;for(_iterator18=_isArray18?_iterator18:_iterator18[Symbol.iterator]();;){var _ref23;if(_isArray18){if(_i19>=_iterator18.length)break;_ref23=_iterator18[_i19++]}else{if((_i19=_iterator18.next()).done)break;_ref23=_i19.value}var addr=_ref23;hashes.push(addr.getHash())}return hashes},TX.prototype.hasCoins=function(view){if(0===this.inputs.length)return!1;var _iterator19=this.inputs,_isArray19=Array.isArray(_iterator19),_i20=0;for(_iterator19=_isArray19?_iterator19:_iterator19[Symbol.iterator]();;){var _ref25;if(_isArray19){if(_i20>=_iterator19.length)break;_ref25=_iterator19[_i20++]}else{if((_i20=_iterator19.next()).done)break;_ref25=_i20.value}var prevout=_ref25.prevout;if(!view.hasEntry(prevout))return!1}return!0},TX.prototype.isFinal=function(height,time){var THRESHOLD=consensus.LOCKTIME_THRESHOLD;if(0===this.locktime)return!0;if(this.locktime<(this.locktime<THRESHOLD?height:time))return!0;var _iterator20=this.inputs,_isArray20=Array.isArray(_iterator20),_i21=0;for(_iterator20=_isArray20?_iterator20:_iterator20[Symbol.iterator]();;){var _ref26;if(_isArray20){if(_i21>=_iterator20.length)break;_ref26=_iterator20[_i21++]}else{if((_i21=_iterator20.next()).done)break;_ref26=_i21.value}if(4294967295!==_ref26.sequence)return!1}return!0},TX.prototype.verifyLocktime=function(index,predicate){var THRESHOLD=consensus.LOCKTIME_THRESHOLD,input=this.inputs[index];return assert(input,"Input does not exist."),assert(predicate>=0,"Locktime must be non-negative."),this.locktime<THRESHOLD==predicate<THRESHOLD&&(!(predicate>this.locktime)&&4294967295!==input.sequence)},TX.prototype.verifySequence=function(index,predicate){var DISABLE_FLAG=consensus.SEQUENCE_DISABLE_FLAG,TYPE_FLAG=consensus.SEQUENCE_TYPE_FLAG,MASK=consensus.SEQUENCE_MASK,input=this.inputs[index];return assert(input,"Input does not exist."),assert(predicate>=0,"Locktime must be non-negative."),!!(predicate&DISABLE_FLAG)||!(this.version<2)&&(!(input.sequence&DISABLE_FLAG)&&((input.sequence&TYPE_FLAG)==(predicate&TYPE_FLAG)&&!((predicate&MASK)>(input.sequence&MASK))))},TX.prototype.getLegacySigops=function(){if(-1!==this._sigops)return this._sigops;var total=0,_iterator21=this.inputs,_isArray21=Array.isArray(_iterator21),_i22=0;for(_iterator21=_isArray21?_iterator21:_iterator21[Symbol.iterator]();;){var _ref27;if(_isArray21){if(_i22>=_iterator21.length)break;_ref27=_iterator21[_i22++]}else{if((_i22=_iterator21.next()).done)break;_ref27=_i22.value}total+=_ref27.script.getSigops(!1)}var _iterator22=this.outputs,_isArray22=Array.isArray(_iterator22),_i23=0;for(_iterator22=_isArray22?_iterator22:_iterator22[Symbol.iterator]();;){var _ref28;if(_isArray22){if(_i23>=_iterator22.length)break;_ref28=_iterator22[_i23++]}else{if((_i23=_iterator22.next()).done)break;_ref28=_i23.value}total+=_ref28.script.getSigops(!1)}return this.mutable||(this._sigops=total),total},TX.prototype.getScripthashSigops=function(view){if(this.isCoinbase())return 0;var total=0,_iterator23=this.inputs,_isArray23=Array.isArray(_iterator23),_i24=0;for(_iterator23=_isArray23?_iterator23:_iterator23[Symbol.iterator]();;){var _ref29;if(_isArray23){if(_i24>=_iterator23.length)break;_ref29=_iterator23[_i24++]}else{if((_i24=_iterator23.next()).done)break;_ref29=_i24.value}var input=_ref29,coin=view.getOutputFor(input);coin&&(coin.script.isScripthash()&&(total+=coin.script.getScripthashSigops(input.script)))}return total},TX.prototype.getSigopsCount=function(view,flags){null==flags&&(flags=Script.flags.STANDARD_VERIFY_FLAGS);var sigops=this.getLegacySigops();return this.isCoinbase()?sigops:(flags&Script.flags.VERIFY_P2SH&&(sigops+=this.getScripthashSigops(view)),sigops)},TX.prototype.getSigops=function(view,flags){return this.getSigopsCount(view,flags)},TX.prototype.isSane=function(){return this.checkSanity()[0]},TX.prototype.checkSanity=function(){if(0===this.inputs.length)return[!1,"bad-txns-vin-empty",100];if(0===this.outputs.length)return[!1,"bad-txns-vout-empty",100];if(this.getBaseSize()>consensus.ONE_MEGABYTE)return[!1,"bad-txns-oversize",100];if(this.getLegacySigops()>policy.MAX_TX_SIGOPS)return[!1,"bad-txns-sigops",100];var total=0,_iterator24=this.outputs,_isArray24=Array.isArray(_iterator24),_i25=0;for(_iterator24=_isArray24?_iterator24:_iterator24[Symbol.iterator]();;){var _ref30;if(_isArray24){if(_i25>=_iterator24.length)break;_ref30=_iterator24[_i25++]}else{if((_i25=_iterator24.next()).done)break;_ref30=_i25.value}var output=_ref30;if(output.value<0)return[!1,"bad-txns-vout-negative",100];if(output.value>consensus.MAX_MONEY)return[!1,"bad-txns-vout-toolarge",100];if((total+=output.value)<0||total>consensus.MAX_MONEY)return[!1,"bad-txns-txouttotal-toolarge",100]}var prevout=new Set,_iterator25=this.inputs,_isArray25=Array.isArray(_iterator25),_i26=0;for(_iterator25=_isArray25?_iterator25:_iterator25[Symbol.iterator]();;){var _ref31;if(_isArray25){if(_i26>=_iterator25.length)break;_ref31=_iterator25[_i26++]}else{if((_i26=_iterator25.next()).done)break;_ref31=_i26.value}var key=_ref31.prevout.toKey();if(prevout.has(key))return[!1,"bad-txns-inputs-duplicate",100];prevout.add(key)}if(this.isCoinbase()){var size=this.inputs[0].script.getSize();if(size<2||size>100)return[!1,"bad-cb-length",100]}else{var _iterator26=this.inputs,_isArray26=Array.isArray(_iterator26),_i27=0;for(_iterator26=_isArray26?_iterator26:_iterator26[Symbol.iterator]();;){var _ref32;if(_isArray26){if(_i27>=_iterator26.length)break;_ref32=_iterator26[_i27++]}else{if((_i27=_iterator26.next()).done)break;_ref32=_i27.value}if(_ref32.prevout.isNull())return[!1,"bad-txns-prevout-null",10]}}return[!0,"valid",0]},TX.prototype.isStandard=function(){return this.checkStandard()[0]},TX.prototype.checkStandard=function(){if(this.version<1||this.version>policy.MAX_TX_VERSION)return[!1,"version",0];if(this.getBaseSize()>=policy.MAX_TX_SIZE)return[!1,"tx-size",0];var _iterator27=this.inputs,_isArray27=Array.isArray(_iterator27),_i28=0;for(_iterator27=_isArray27?_iterator27:_iterator27[Symbol.iterator]();;){var _ref33;if(_isArray27){if(_i28>=_iterator27.length)break;_ref33=_iterator27[_i28++]}else{if((_i28=_iterator27.next()).done)break;_ref33=_i28.value}var input=_ref33;if(input.script.getSize()>1650)return[!1,"scriptsig-size",0];if(!input.script.isPushOnly())return[!1,"scriptsig-not-pushonly",0]}var nulldata=0,_iterator28=this.outputs,_isArray28=Array.isArray(_iterator28),_i29=0;for(_iterator28=_isArray28?_iterator28:_iterator28[Symbol.iterator]();;){var _ref34;if(_isArray28){if(_i29>=_iterator28.length)break;_ref34=_iterator28[_i29++]}else{if((_i29=_iterator28.next()).done)break;_ref34=_i29.value}var output=_ref34;if(!output.script.isStandard())return[!1,"scriptpubkey",0];if(output.script.isNulldata())nulldata++;else{if(output.script.isMultisig()&&!policy.BARE_MULTISIG)return[!1,"bare-multisig",0];if(output.isDust(policy.MIN_RELAY))return[!1,"dust",0]}}return nulldata>1?[!1,"multi-op-return",0]:[!0,"valid",0]},TX.prototype.hasStandardInputs=function(view){if(this.isCoinbase())return!0;var _iterator29=this.inputs,_isArray29=Array.isArray(_iterator29),_i30=0;for(_iterator29=_isArray29?_iterator29:_iterator29[Symbol.iterator]();;){var _ref35;if(_isArray29){if(_i30>=_iterator29.length)break;_ref35=_iterator29[_i30++]}else{if((_i30=_iterator29.next()).done)break;_ref35=_i30.value}var input=_ref35,coin=view.getOutputFor(input);if(!coin)return!1;if(!coin.script.isPubkeyhash())if(coin.script.isScripthash()){var redeem=input.script.getRedeem();if(!redeem)return!1;if(redeem.getSigops(!0)>policy.MAX_P2SH_SIGOPS)return!1}else if(coin.script.isUnknown())return!1}return!0},TX.prototype.verifyInputs=function(view,height){return-1!==this.checkInputs(view,height)[0]},TX.prototype.checkInputs=function(view,height){assert("number"==typeof height);var total=0,_iterator30=this.inputs,_isArray30=Array.isArray(_iterator30),_i31=0;for(_iterator30=_isArray30?_iterator30:_iterator30[Symbol.iterator]();;){var _ref37;if(_isArray30){if(_i31>=_iterator30.length)break;_ref37=_iterator30[_i31++]}else{if((_i31=_iterator30.next()).done)break;_ref37=_i31.value}var prevout=_ref37.prevout,entry=view.getEntry(prevout);if(!entry)return[-1,"bad-txns-inputs-missingorspent",0];if(entry.coinbase&&height-entry.height<consensus.COINBASE_MATURITY)return[-1,"bad-txns-premature-spend-of-coinbase",0];var coin=view.getOutput(prevout);if(assert(coin),coin.value<0||coin.value>consensus.MAX_MONEY)return[-1,"bad-txns-inputvalues-outofrange",100];if((total+=coin.value)<0||total>consensus.MAX_MONEY)return[-1,"bad-txns-inputvalues-outofrange",100]}var value=this.getOutputValue();if(total<value)return[-1,"bad-txns-in-belowout",100];var fee=total-value;return fee<0?[-1,"bad-txns-fee-negative",100]:fee>consensus.MAX_MONEY?[-1,"bad-txns-fee-outofrange",100]:[fee,"valid",0]},TX.prototype.getModifiedSize=function(size){null==size&&(size=this.getBaseSize());var _iterator31=this.inputs,_isArray31=Array.isArray(_iterator31),_i32=0;for(_iterator31=_isArray31?_iterator31:_iterator31[Symbol.iterator]();;){var _ref38;if(_isArray31){if(_i32>=_iterator31.length)break;_ref38=_iterator31[_i32++]}else{if((_i32=_iterator31.next()).done)break;_ref38=_i32.value}var input=_ref38,offset=41+Math.min(110,input.script.getSize());size>offset&&(size-=offset)}return size},TX.prototype.getPriority=function(view,height,size){if(assert("number"==typeof height,"Must pass in height."),this.isCoinbase())return 0;null==size&&(size=this.getBaseSize());var sum=0,_iterator32=this.inputs,_isArray32=Array.isArray(_iterator32),_i33=0;for(_iterator32=_isArray32?_iterator32:_iterator32[Symbol.iterator]();;){var _ref40;if(_isArray32){if(_i33>=_iterator32.length)break;_ref40=_iterator32[_i33++]}else{if((_i33=_iterator32.next()).done)break;_ref40=_i33.value}var prevout=_ref40.prevout,coin=view.getOutput(prevout);if(coin){var coinHeight=view.getHeight(prevout);if(-1!==coinHeight&&coinHeight<=height){var age=height-coinHeight;sum+=coin.value*age}}}return Math.floor(sum/size)},TX.prototype.getChainValue=function(view){if(this.isCoinbase())return 0;var value=0,_iterator33=this.inputs,_isArray33=Array.isArray(_iterator33),_i34=0;for(_iterator33=_isArray33?_iterator33:_iterator33[Symbol.iterator]();;){var _ref42;if(_isArray33){if(_i34>=_iterator33.length)break;_ref42=_iterator33[_i34++]}else{if((_i34=_iterator33.next()).done)break;_ref42=_i34.value}var prevout=_ref42.prevout,coin=view.getOutput(prevout);if(coin){-1!==view.getHeight(prevout)&&(value+=coin.value)}}return value},TX.prototype.isFree=function(view,height,size){return this.getPriority(view,height,size)>policy.FREE_THRESHOLD},TX.prototype.getMinFee=function(size,rate){return null==size&&(size=this.getVirtualSize()),policy.getMinFee(size,rate)},TX.prototype.getRoundFee=function(size,rate){return null==size&&(size=this.getVirtualSize()),policy.getRoundFee(size,rate)},TX.prototype.getRate=function(view,size){var fee=this.getFee(view);return fee<0?0:(null==size&&(size=this.getVirtualSize()),policy.getRate(size,fee))},TX.prototype.getPrevout=function(){if(this.isCoinbase())return[];var prevout=Object.create(null),_iterator34=this.inputs,_isArray34=Array.isArray(_iterator34),_i35=0;for(_iterator34=_isArray34?_iterator34:_iterator34[Symbol.iterator]();;){var _ref43;if(_isArray34){if(_i35>=_iterator34.length)break;_ref43=_iterator34[_i35++]}else{if((_i35=_iterator34.next()).done)break;_ref43=_i35.value}prevout[_ref43.prevout.hash]=!0}return Object.keys(prevout)},TX.prototype.isWatched=function(filter){var found=!1;filter.test(this.hash())&&(found=!0);for(var i=0;i<this.outputs.length;i++){var output=this.outputs[i];if(output.script.test(filter)){if(1===filter.update){var prevout=Outpoint.fromTX(this,i);filter.add(prevout.toRaw())}else if(2===filter.update&&(output.script.isPubkey()||output.script.isMultisig())){var _prevout=Outpoint.fromTX(this,i);filter.add(_prevout.toRaw())}found=!0}}if(found)return found;var _iterator35=this.inputs,_isArray35=Array.isArray(_iterator35),_i36=0;for(_iterator35=_isArray35?_iterator35:_iterator35[Symbol.iterator]();;){var _ref44;if(_isArray35){if(_i36>=_iterator35.length)break;_ref44=_iterator35[_i36++]}else{if((_i36=_iterator35.next()).done)break;_ref44=_i36.value}var input=_ref44,_prevout2=input.prevout;if(filter.test(_prevout2.toRaw()))return!0;if(input.script.test(filter))return!0}return!1},TX.prototype.rhash=function(){return util.revHex(this.hash("hex"))},TX.prototype.txid=function(){return this.rhash()},TX.prototype.toInv=function(){return new InvItem(InvItem.types.TX,this.hash("hex"))},TX.prototype.inspect=function(){return this.format()},TX.prototype.format=function(view,entry,index){var rate=0,fee=0,height=-1,block=null,time=0,date=null;return view&&(fee=this.getFee(view),rate=this.getRate(view),Number.isSafeInteger(rate)||(rate=0)),entry&&(height=entry.height,block=util.revHex(entry.hash),time=entry.time,date=util.date(time)),null==index&&(index=-1),{hash:this.txid(),size:this.getSize(),virtualSize:this.getVirtualSize(),value:Amount.btc(this.getOutputValue()),fee:Amount.btc(fee),rate:Amount.btc(rate),minFee:Amount.btc(this.getMinFee()),height:height,block:block,time:time,date:date,index:index,version:this.version,inputs:this.inputs.map(function(input){var coin=view?view.getOutputFor(input):null;return input.format(coin)}),outputs:this.outputs,locktime:this.locktime}},TX.prototype.toJSON=function(){return this.getJSON()},TX.prototype.getJSON=function(network,view,entry,index){var rate=void 0,fee=void 0,height=void 0,block=void 0,time=void 0,date=void 0;return view&&(fee=this.getFee(view),rate=this.getRate(view),Number.isSafeInteger(rate)||(rate=0)),entry&&(height=entry.height,block=util.revHex(entry.hash),time=entry.time,date=util.date(time)),network=Network.get(network),{hash:this.txid(),fee:fee,rate:rate,mtime:util.now(),height:height,block:block,time:time,date:date,index:index,version:this.version,inputs:this.inputs.map(function(input){var coin=view?view.getCoinFor(input):null;return input.getJSON(network,coin)}),outputs:this.outputs.map(function(output){return output.getJSON(network)}),locktime:this.locktime,hex:this.toRaw().toString("hex")}},TX.prototype.fromJSON=function(json){assert(json,"TX data is required."),assert(json.version>>>0===json.version,"Version must be a uint32."),assert(Array.isArray(json.inputs),"Inputs must be an array."),assert(Array.isArray(json.outputs),"Outputs must be an array."),assert(json.locktime>>>0===json.locktime,"Locktime must be a uint32."),this.version=json.version;var _iterator36=json.inputs,_isArray36=Array.isArray(_iterator36),_i37=0;for(_iterator36=_isArray36?_iterator36:_iterator36[Symbol.iterator]();;){var _ref45;if(_isArray36){if(_i37>=_iterator36.length)break;_ref45=_iterator36[_i37++]}else{if((_i37=_iterator36.next()).done)break;_ref45=_i37.value}var input=_ref45;this.inputs.push(Input.fromJSON(input))}var _iterator37=json.outputs,_isArray37=Array.isArray(_iterator37),_i38=0;for(_iterator37=_isArray37?_iterator37:_iterator37[Symbol.iterator]();;){var _ref46;if(_isArray37){if(_i38>=_iterator37.length)break;_ref46=_iterator37[_i38++]}else{if((_i38=_iterator37.next()).done)break;_ref46=_i38.value}var output=_ref46;this.outputs.push(Output.fromJSON(output))}return this.locktime=json.locktime,this},TX.fromJSON=function(json){return(new this).fromJSON(json)},TX.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},TX.fromReader=function(br){return(new this).fromReader(br)},TX.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},TX.prototype.fromReader=function(br){br.start(),this.version=br.readU32();for(var inCount=br.readVarint(),i=0;i<inCount;i++)this.inputs.push(Input.fromReader(br));for(var outCount=br.readVarint(),_i39=0;_i39<outCount;_i39++)this.outputs.push(Output.fromReader(br));return this.locktime=br.readU32(),this.mutable?br.end():(this._raw=br.endData(),this._size=this._raw.length),this},TX.prototype.frameNormal=function(){var raw=this.getNormalSizes(),bw=bio.write(raw.size);return this.writeNormal(bw),raw.data=bw.render(),raw},TX.prototype.writeNormal=function(bw){if(0===this.inputs.length&&0!==this.outputs.length)throw new Error("Cannot serialize zero-input tx.");bw.writeU32(this.version),bw.writeVarint(this.inputs.length);var _iterator38=this.inputs,_isArray38=Array.isArray(_iterator38),_i40=0;for(_iterator38=_isArray38?_iterator38:_iterator38[Symbol.iterator]();;){var _ref47;if(_isArray38){if(_i40>=_iterator38.length)break;_ref47=_iterator38[_i40++]}else{if((_i40=_iterator38.next()).done)break;_ref47=_i40.value}_ref47.toWriter(bw)}bw.writeVarint(this.outputs.length);var _iterator39=this.outputs,_isArray39=Array.isArray(_iterator39),_i41=0;for(_iterator39=_isArray39?_iterator39:_iterator39[Symbol.iterator]();;){var _ref48;if(_isArray39){if(_i41>=_iterator39.length)break;_ref48=_iterator39[_i41++]}else{if((_i41=_iterator39.next()).done)break;_ref48=_i41.value}_ref48.toWriter(bw)}return bw.writeU32(this.locktime),bw},TX.prototype.writeWitness=function(bw){if(0===this.inputs.length&&0!==this.outputs.length)throw new Error("Cannot serialize zero-input tx.");bw.writeU32(this.version),bw.writeU8(0),bw.writeU8(1),bw.writeVarint(this.inputs.length);var _iterator40=this.inputs,_isArray40=Array.isArray(_iterator40),_i42=0;for(_iterator40=_isArray40?_iterator40:_iterator40[Symbol.iterator]();;){var _ref49;if(_isArray40){if(_i42>=_iterator40.length)break;_ref49=_iterator40[_i42++]}else{if((_i42=_iterator40.next()).done)break;_ref49=_i42.value}_ref49.toWriter(bw)}bw.writeVarint(this.outputs.length);var _iterator41=this.outputs,_isArray41=Array.isArray(_iterator41),_i43=0;for(_iterator41=_isArray41?_iterator41:_iterator41[Symbol.iterator]();;){var _ref50;if(_isArray41){if(_i43>=_iterator41.length)break;_ref50=_iterator41[_i43++]}else{if((_i43=_iterator41.next()).done)break;_ref50=_i43.value}_ref50.toWriter(bw)}var start=bw.offset,_iterator42=this.inputs,_isArray42=Array.isArray(_iterator42),_i44=0;for(_iterator42=_isArray42?_iterator42:_iterator42[Symbol.iterator]();;){var _ref51;if(_isArray42){if(_i44>=_iterator42.length)break;_ref51=_iterator42[_i44++]}else{if((_i44=_iterator42.next()).done)break;_ref51=_i44.value}_ref51.witness.toWriter(bw)}var witness=bw.offset-start;if(bw.writeU32(this.locktime),witness===this.inputs.length)throw new Error("Cannot serialize empty-witness tx.");return bw},TX.prototype.getNormalSizes=function(){var base=0;base+=4,base+=encoding.sizeVarint(this.inputs.length);var _iterator43=this.inputs,_isArray43=Array.isArray(_iterator43),_i45=0;for(_iterator43=_isArray43?_iterator43:_iterator43[Symbol.iterator]();;){var _ref52;if(_isArray43){if(_i45>=_iterator43.length)break;_ref52=_iterator43[_i45++]}else{if((_i45=_iterator43.next()).done)break;_ref52=_i45.value}base+=_ref52.getSize()}base+=encoding.sizeVarint(this.outputs.length);var _iterator44=this.outputs,_isArray44=Array.isArray(_iterator44),_i46=0;for(_iterator44=_isArray44?_iterator44:_iterator44[Symbol.iterator]();;){var _ref53;if(_isArray44){if(_i46>=_iterator44.length)break;_ref53=_iterator44[_i46++]}else{if((_i46=_iterator44.next()).done)break;_ref53=_i46.value}base+=_ref53.getSize()}return new RawTX(base+=4,0)},TX.isTX=function(obj){return obj instanceof TX},TX}();var RawTX=function RawTX(size,witness){_classCallCheck(this,RawTX),this.data=null,this.size=size};module.exports=TX}).call(this,require("buffer").Buffer)},{"../btc/amount":8,"../protocol/consensus":84,"../protocol/network":87,"../protocol/policy":89,"../script/script":95,"../script/scripterror":96,"../utils/util":106,"./input":74,"./invitem":75,"./outpoint":80,"./output":81,assert:146,"bcrypto/lib/hash256":160,"bcrypto/lib/secp256k1":184,buffer:269,bufio:270}],83:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),bio=require("bufio"),util=require("../utils/util"),TX=require("./tx"),TXMeta=function(){function TXMeta(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TXMeta),this.tx=new TX,this.mtime=util.now(),this.height=-1,this.block=null,this.time=0,this.index=-1,options&&this.fromOptions(options)}return TXMeta.prototype.fromOptions=function(options){return options.tx&&(assert(options.tx instanceof TX),this.tx=options.tx),null!=options.mtime&&(assert(options.mtime>>>0===options.mtime),this.mtime=options.mtime),null!=options.height&&(assert(Number.isSafeInteger(options.height)),this.height=options.height),void 0!==options.block&&(assert(null===options.block||"string"==typeof options.block),this.block=options.block),null!=options.time&&(assert(options.time>>>0===options.time),this.time=options.time),null!=options.index&&(assert(Number.isSafeInteger(options.index)),this.index=options.index),this},TXMeta.fromOptions=function(options){return(new this).fromOptions(options)},TXMeta.prototype.fromTX=function(tx,entry,index){return this.tx=tx,entry&&(this.height=entry.height,this.block=entry.hash,this.time=entry.time,this.index=index),this},TXMeta.fromTX=function(tx,entry,index){return(new this).fromTX(tx,entry,index)},TXMeta.prototype.inspect=function(){return this.format()},TXMeta.prototype.format=function(view){var data=this.tx.format(view,null,this.index);return data.mtime=this.mtime,data.height=this.height,data.block=this.block?util.revHex(this.block):null,data.time=this.time,data},TXMeta.prototype.toJSON=function(){return this.getJSON()},TXMeta.prototype.getJSON=function(network,view,chainHeight){var json=this.tx.getJSON(network,view,null,this.index);return json.mtime=this.mtime,json.height=this.height,json.block=this.block?util.revHex(this.block):null,json.time=this.time,json.confirmations=0,null!=chainHeight&&(json.confirmations=chainHeight-this.height+1),json},TXMeta.prototype.fromJSON=function(json){return this.tx.fromJSON(json),assert(json.mtime>>>0===json.mtime),assert(Number.isSafeInteger(json.height)),assert(!json.block||"string"==typeof json.block),assert(json.time>>>0===json.time),assert(Number.isSafeInteger(json.index)),this.mtime=json.mtime,this.height=json.height,this.block=util.revHex(json.block),this.index=json.index,this},TXMeta.fromJSON=function(json){return(new this).fromJSON(JSON)},TXMeta.prototype.getSize=function(){var size=0;return size+=this.tx.getSize(),size+=4,this.block?(size+=1,size+=32,size+=12):size+=1,size},TXMeta.prototype.toRaw=function(){var size=this.getSize(),bw=bio.write(size);return this.tx.toWriter(bw),bw.writeU32(this.mtime),this.block?(bw.writeU8(1),bw.writeHash(this.block),bw.writeU32(this.height),bw.writeU32(this.time),bw.writeU32(this.index)):bw.writeU8(0),bw.render()},TXMeta.prototype.fromRaw=function(data){var br=bio.read(data);return this.tx.fromReader(br),this.mtime=br.readU32(),1===br.readU8()&&(this.block=br.readHash("hex"),this.height=br.readU32(),this.time=br.readU32(),this.index=br.readU32(),2147483647===this.index&&(this.index=-1)),this},TXMeta.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},TXMeta.isTXMeta=function(obj){return obj instanceof TXMeta},TXMeta}();module.exports=TXMeta}).call(this,require("buffer").Buffer)},{"../utils/util":106,"./tx":82,assert:146,buffer:269,bufio:270}],84:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),BN=require("bn.js");exports.COIN=1e8,exports.MAX_MONEY=21e6*exports.COIN,exports.BASE_REWARD=50*exports.COIN,exports.HALF_REWARD=Math.floor(exports.BASE_REWARD/2),exports.MAX_BLOCK_SIZE=8e6,exports.ONE_MEGABYTE=1e6,exports.MAX_GENERATED_BLOCK_SIZE=2e6,exports.MAX_RAW_BLOCK_SIZE=4e6,exports.MAX_BLOCK_WEIGHT=4e6,exports.MAX_BLOCK_SIGOPS=2e4,exports.MEDIAN_TIMESPAN=11,exports.VERSION_TOP_BITS=536870912,exports.VERSION_TOP_MASK=3758096384,exports.COINBASE_MATURITY=100,exports.WITNESS_SCALE_FACTOR=4,exports.LOCKTIME_THRESHOLD=5e8,exports.SEQUENCE_DISABLE_FLAG=1<<31>>>0,exports.SEQUENCE_TYPE_FLAG=1<<22,exports.SEQUENCE_GRANULARITY=9,exports.SEQUENCE_MASK=65535,exports.MAX_SCRIPT_SIZE=1e4,exports.MAX_SCRIPT_STACK=1e3,exports.MAX_SCRIPT_PUSH=520,exports.MAX_SCRIPT_OPS=201,exports.MAX_MULTISIG_PUBKEYS=20,exports.BIP16_TIME=1333238400,exports.ZERO_HASH=Buffer.alloc(32,0),exports.NULL_HASH="0000000000000000000000000000000000000000000000000000000000000000",exports.fromCompact=function(compact){if(0===compact)return new BN(0);var exponent=compact>>>24,negative=compact>>>23&1,mantissa=8388607&compact,num=void 0;return exponent<=3?num=new BN(mantissa>>>=8*(3-exponent)):(num=new BN(mantissa)).iushln(8*(exponent-3)),negative&&num.ineg(),num},exports.toCompact=function(num){if(num.isZero())return 0;var exponent=num.byteLength(),mantissa=void 0;exponent<=3?(mantissa=num.toNumber(),mantissa<<=8*(3-exponent)):mantissa=num.ushrn(8*(exponent-3)).toNumber(),8388608&mantissa&&(mantissa>>=8,exponent++);var compact=exponent<<24|mantissa;return num.isNeg()&&(compact|=8388608),compact>>>=0},exports.verifyPOW=function(hash,bits){var target=exports.fromCompact(bits);if(target.isNeg()||target.isZero())return!1;return!new BN(hash,"le").gt(target)},exports.getReward=function(height,interval){assert(height>=0,"Bad height for reward.");var halvings=Math.floor(height/interval);return halvings>=33?0:0===halvings?exports.BASE_REWARD:exports.HALF_REWARD>>>halvings-1},exports.hasBit=function(version,bit){return(version&exports.VERSION_TOP_MASK)>>>0===exports.VERSION_TOP_BITS&&0!=(version&1<<bit)},exports.getMaxBlockSigopsCount=function(size){return(1+((size-1)/1e6|0))*exports.MAX_BLOCK_SIGOPS}}).call(this,require("buffer").Buffer)},{assert:146,"bn.js":217,buffer:269}],85:[function(require,module,exports){"use strict";var assert=require("assert"),VerifyError=function(_Error){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(VerifyError,_Error);function VerifyError(msg,code,reason,score,malleated){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,VerifyError);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Error.call(this));return assert("string"==typeof code),assert("string"==typeof reason),assert(score>=0),_this.type="VerifyError",_this.message="",_this.code=code,_this.reason=reason,_this.score=score,_this.hash=msg.hash("hex"),_this.malleated=malleated||!1,_this.message="Verification failure: "+reason+" (code="+code+" score="+score+" hash="+msg.rhash()+")",Error.captureStackTrace&&Error.captureStackTrace(_this,VerifyError),_this}return VerifyError}(Error);exports.VerifyError=VerifyError},{assert:146}],86:[function(require,module,exports){"use strict";exports.consensus=require("./consensus"),exports.errors=require("./errors"),exports.Network=require("./network"),exports.networks=require("./networks"),exports.policy=require("./policy"),exports.timedata=require("./timedata")},{"./consensus":84,"./errors":85,"./network":87,"./networks":88,"./policy":89,"./timedata":90}],87:[function(require,module,exports){(function(process){"use strict";var assert=require("assert"),binary=require("../utils/binary"),networks=require("./networks"),consensus=require("./consensus"),TimeData=require("./timedata"),Network=function(){function Network(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Network),assert(!Network[options.type],"Cannot create two networks."),this.type=options.type,this.seeds=options.seeds,this.magic=options.magic,this.port=options.port,this.checkpointMap=options.checkpointMap,this.lastCheckpoint=options.lastCheckpoint,this.checkpoints=[],this.halvingInterval=options.halvingInterval,this.genesis=options.genesis,this.genesisBlock=options.genesisBlock,this.pow=options.pow,this.block=options.block,this.bip30=options.bip30,this.activationThreshold=options.activationThreshold,this.minerWindow=options.minerWindow,this.deployments=options.deployments,this.deploys=options.deploys,this.unknownBits=~consensus.VERSION_TOP_MASK,this.keyPrefix=options.keyPrefix,this.addressPrefix=options.addressPrefix,this.requireStandard=options.requireStandard,this.rpcPort=options.rpcPort,this.walletPort=options.walletPort,this.minRelay=options.minRelay,this.feeRate=options.feeRate,this.maxFeeRate=options.maxFeeRate,this.selfConnect=options.selfConnect,this.requestMempool=options.requestMempool,this.time=new TimeData,this.init()}return Network.prototype.init=function(){var bits=0,_iterator=this.deploys,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}bits|=1<<_ref.bit}bits|=consensus.VERSION_TOP_MASK,this.unknownBits=~bits>>>0;var _iterator2=Object.keys(this.checkpointMap),_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref2=_i2.value}var key=_ref2,hash=this.checkpointMap[key],height=Number(key);this.checkpoints.push({hash:hash,height:height})}this.checkpoints.sort(cmpNode)},Network.prototype.byBit=function(bit){var index=binary.search(this.deploys,bit,cmpBit);return-1===index?null:this.deploys[index]},Network.prototype.now=function(){return this.time.now()},Network.prototype.ms=function(){return this.time.ms()},Network.create=function(options){if("string"==typeof options&&(options=networks[options]),assert(options,"Unknown network."),Network[options.type])return Network[options.type];var network=new Network(options);return Network[network.type]=network,Network.primary||(Network.primary=network),network},Network.set=function(type){return assert("string"==typeof type,"Bad network."),Network.primary=Network.get(type),Network.type=type,Network.primary},Network.get=function(type){if(!type)return assert(Network.primary,"No default network."),Network.primary;if(type instanceof Network)return type;if("string"==typeof type)return Network.create(type);throw new Error("Unknown network.")},Network.ensure=function(type){return type?type instanceof Network?type:"string"==typeof type&&networks[type]?Network.create(type):(assert(Network.primary,"No default network."),Network.primary):(assert(Network.primary,"No default network."),Network.primary)},Network.by=function(value,compare,network,name){if(network){if(compare(network=Network.get(network),value))return network;throw new Error("Network mismatch for "+name+".")}var _iterator3=networks.types,_isArray3=Array.isArray(_iterator3),_i3=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref3;if(_isArray3){if(_i3>=_iterator3.length)break;_ref3=_iterator3[_i3++]}else{if((_i3=_iterator3.next()).done)break;_ref3=_i3.value}var type=_ref3;if(compare(network=networks[type],value))return Network.get(type)}throw new Error("Network not found for "+name+".")},Network.fromMagic=function(value,network){return Network.by(value,cmpMagic,network,"magic number")},Network.fromCashMagic=function(value,network){return Network.by(value,cmpCashMagic,network,"magic number")},Network.fromWIF=function(prefix,network){return Network.by(prefix,cmpWIF,network,"WIF")},Network.fromPublic=function(prefix,network){return Network.by(prefix,cmpPub,network,"xpubkey")},Network.fromPrivate=function(prefix,network){return Network.by(prefix,cmpPriv,network,"xprivkey")},Network.fromPublic58=function(prefix,network){return Network.by(prefix,cmpPub58,network,"xpubkey")},Network.fromPrivate58=function(prefix,network){return Network.by(prefix,cmpPriv58,network,"xprivkey")},Network.fromAddress=function(prefix,network){return Network.by(prefix,cmpAddress,network,"base58 address")},Network.fromBech32=function(hrp,network){return Network.by(hrp,cmpBech32,network,"bech32 address")},Network.prototype.toString=function(){return this.type},Network.prototype.inspect=function(){return"<Network: "+this.type+">"},Network.isNetwork=function(obj){return obj instanceof Network},Network}();Network.primary=null,Network.type=null,Network.main=null,Network.testnet=null,Network.regtest=null,Network.set(process.env.BCOIN_NETWORK||"main");function cmpBit(a,b){return a.bit-b}function cmpNode(a,b){return a.height-b.height}function cmpMagic(network,magic){return network.magic===magic}function cmpCashMagic(network,magic){return network.netmagic===magic}function cmpWIF(network,prefix){return network.keyPrefix.privkey===prefix}function cmpPub(network,prefix){return network.keyPrefix.xpubkey===prefix}function cmpPriv(network,prefix){return network.keyPrefix.xprivkey===prefix}function cmpPub58(network,prefix){return network.keyPrefix.xpubkey58===prefix}function cmpPriv58(network,prefix){return network.keyPrefix.xprivkey58===prefix}function cmpAddress(network,prefix){var prefixes=network.addressPrefix;switch(prefix){case prefixes.pubkeyhash:case prefixes.scripthash:return!0}return!1}function cmpBech32(network,hrp){return network.addressPrefix.bech32===hrp}module.exports=Network}).call(this,require("_process"))},{"../utils/binary":100,"./consensus":84,"./networks":88,"./timedata":90,_process:374,assert:146}],88:[function(require,module,exports){(function(Buffer){"use strict";var BN=require("bn.js"),network=exports;network.types=["main","testnet","regtest"];var main={};main.type="main",main.seeds=["seed.bitcoinabc.org","seed.bitprim.org","seed.deadalnix.me","btccash-seeder.bitcoinunlimited.info","seed-abc.bitcoinforks.org","seeder.criptolayer.net"],main.magic=3652501241,main.netmagic=3908297187,main.port=8333,main.checkpointMap={11111:"1d7c6eb2fd42f55925e92efad68b61edd22fba29fde8783df744e26900000000",33333:"a6d0b5df7d0df069ceb1e736a216ad187a50b07aaa4e78748a58d52d00000000",74e3:"201a66b853f9e7814a820e2af5f5dc79c07144e31ce4c9a39339570000000000",105e3:"97dc6b1d15fbeef373a744fee0b254b0d2c820a3ae7f0228ce91020000000000",134444:"feb0d2420d4a18914c81ac30f494a5d4ff34cd15d34cfd2fb105000000000000",168e3:"63b703835cb735cb9a89d733cbe66f212f63795e0172ea619e09000000000000",193e3:"17138bca83bdc3e6f60f01177c3877a98266de40735f2a459f05000000000000",21e4:"2e3471a19b8e22b7f939c63663076603cf692f19837e34958b04000000000000",216116:"4edf231bf170234e6a811460f95c94af9464e41ee833b4f4b401000000000000",225430:"32595730b165f097e7b806a679cf7f3e439040f750433808c101000000000000",25e4:"14d2f24d29bed75354f3f88a5fb50022fc064b02291fdf873800000000000000",279e3:"407ebde958e44190fa9e810ea1fc3a7ef601c3b0a0728cae0100000000000000",295e3:"83a93246c67003105af33ae0b29dd66f689d0f0ff54e9b4d0000000000000000",300255:"b2f3a0f0de4120c1089d5f5280a263059f9b6e7c520428160000000000000000",319400:"3bf115fd057391587ca39a531c5d4989e1adec9b2e05c6210000000000000000",343185:"548536d48e7678fcfa034202dd45d4a76b1ad061f38b2b070000000000000000",352940:"ffc9520143e41c94b6e03c2fa3e62bb76b55ba2df45d75100000000000000000",382320:"b28afdde92b0899715e40362f56afdb20e3d135bedc68d0a0000000000000000",401465:"eed16cb3e893ed9366f27c39a9ecd95465d02e3ef40e45010000000000000000",42e4:"a1ff746b2d42b834cb7d6b8981b09c265c2cabc016e8cc020000000000000000",44e4:"9bf296b8de5f834f7635d5e258a434ad51b4dbbcf7c08c030000000000000000",45e4:"0ba2070c62cd9da1f8cef88a0648c661a411d33e728340010000000000000000",46e4:"8c25fc7e414d3e868d6ce0ec473c30ad44e7e8bc1b75ef000000000000000000",47e4:"89756d1ed75901437300af10d5ab69070a282e729c536c000000000000000000",478559:"ec5e1a193601f25ff1d94b421ddead0dbefcb99cf91e65000000000000000000",478641:"beba3adb9ccc2eb2802a2fdd826cd416cb9ae46fea1f7c020000000000000000",504031:"9cabb6ee1b1a4c3b659d70be75810be83d0a0db665bf1e010000000000000000"},main.lastCheckpoint=478559,main.halvingInterval=21e4,main.genesis={version:1,hash:"6fe28c0ab6f1b372c1a6a246ae63f74f931e8365e15a089c68d6190000000000",prevBlock:"0000000000000000000000000000000000000000000000000000000000000000",merkleRoot:"3ba3edfd7a7b12b27ac72c3e67768f617fc81bc3888a51323a9fb8aa4b1e5e4a",time:1231006505,bits:486604799,nonce:2083236893,height:0},main.genesisBlock="0100000000000000000000000000000000000000000000000000000000000000000000003ba3edfd7a7b12b27ac72c3e67768f617fc81bc3888a51323a9fb8aa4b1e5e4a29ab5f49ffff001d1dac2b7c0101000000010000000000000000000000000000000000000000000000000000000000000000ffffffff4d04ffff001d0104455468652054696d65732030332f4a616e2f32303039204368616e63656c6c6f72206f6e206272696e6b206f66207365636f6e64206261696c6f757420666f722062616e6b73ffffffff0100f2052a01000000434104678afdb0fe5548271967f1a67130b7105cd6a828e03909a67962e0ea1f61deb649f6bc3f4cef38c4f35504e51ec112de5c384df7ba0b8d578a4c702b6bf11d5fac00000000",main.pow={limit:new BN("00000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffff","hex"),bits:486604799,chainwork:new BN("0000000000000000000000000000000000000000007e5dbf54c7f6b58a6853cd","hex"),targetTimespan:1209600,targetSpacing:600,retargetInterval:2016,targetReset:!1,noRetargeting:!1},main.block={bip34height:227931,bip34hash:"b808089c756add1591b1d17bab44bba3fed9e02f942ab4894b02000000000000",bip65height:388381,bip65hash:"f035476cfaeb9f677c2cdad00fd908c556775ded24b6c2040000000000000000",bip66height:363725,bip66hash:"3109b588941188a9f1c2576aae462d729b8cce9da1ea79030000000000000000",pruneAfterHeight:1e3,UAHFHeight:478599,UAHFHash:"ec5e1a193601f25ff1d94b421ddead0dbefcb99cf91e65000000000000000000",daaHeight:504031,antiReplayOpReturnSunsetHeight:53e4,antiReplayOpReturnCommitment:Buffer.from("Bitcoin: A Peer-to-Peer Electronic Cash System"),keepBlocks:288,maxTipAge:86400,slowHeight:325e3},main.bip30={91842:"eccae000e3c8e4e093936360431f3b7603c563c1ff6181390a4d0a0000000000",91880:"21d77ccb4c08386a04ac0196ae10f6a1d2c2a377558ca190f143070000000000"},main.activationThreshold=1916,main.minerWindow=2016,main.deployments={csv:{name:"csv",bit:0,startTime:1462060800,timeout:1493596800,threshold:-1,window:-1,required:!1,force:!0},testdummy:{name:"testdummy",bit:28,startTime:1199145601,timeout:1230767999,threshold:-1,window:-1,required:!1,force:!0}},main.deploys=[main.deployments.csv,main.deployments.testdummy],main.keyPrefix={privkey:128,xpubkey:76067358,xprivkey:76066276,xpubkey58:"xpub",xprivkey58:"xprv",coinType:0},main.addressPrefix={pubkeyhash:0,scripthash:5},main.requireStandard=!0,main.rpcPort=8332,main.minRelay=1e3,main.feeRate=1e5,main.maxFeeRate=4e5,main.selfConnect=!1,main.requestMempool=!1;var testnet={};testnet.type="testnet",testnet.seeds=["testnet-seed-abc.bitcoinforks.org","testnet-seeder.criptolayer.net","testnet-seed.bitprim.org","testnet-seed.deadalnix.me","testnet-seed.bitcoinabc.org"],testnet.magic=118034699,testnet.netmagic=4109624820,testnet.port=18333,testnet.checkpointMap={546:"70cb6af7ebbcb1315d3414029c556c55f3e2fc353c4c9063a76c932a00000000",1e4:"02a1b43f52591e53b660069173ac83b675798e12599dbb0442b7580000000000",1e5:"1e0a16bbadccde1d80c66597b1939e45f91b570d29f95fc158299e0000000000",17e4:"508125560d202b89757889bb0e49c712477be20440058f05db4f0e0000000000",21e4:"32365454b5f29a826bff8ad9b0448cad0072fc73d50e482d91a3dece00000000",3e5:"a141bf3972424853f04367b47995e220e0b5a2706e5618766f22000000000000",39e4:"f217e183484fb6d695609cc71fa2ae24c3020943407e0150b298030000000000",42e4:"de9e73a3b91fbb014e036e8583a17d6b638a699aeb2de8573d12580800000000",5e5:"06f60922a2aab2757317820fc6ffaf6a470e2cbb0f63a2aac0a7010000000000",63e4:"bbbe117035432a6a4effcb297207a02b031735b43e0d19a9217c000000000000",7e5:"c14d3f6a1e7c7d66fd940951e44f3c3be1273bea4d2ab1786140000000000000",78e4:"0381582e34c3755964dc2813e2b33e521e5596367144e1670851050000000000",84e4:"dac1648107bd4394e57e4083c86d42b548b1cfb119665f179ea80a0000000000",9e5:"9bd8ac418beeb1a2cf5d68c8b5c6ebaa947a5b766e5524898d6f350000000000",105e4:"d8190cf0af7f08e179cab51d67db0b44b87951a78f7fdc31b4a01a0000000000",1155876:"f5b885a2a40e9a0cf77ed39fbac2d51538f47d2a58d93ef9fe380e0000000000",1188697:"fb47e0ab0d2448f71192a09fe61bc9c46cd3b4e7bd778091d00e170000000000"},testnet.lastCheckpoint=1155876,testnet.halvingInterval=21e4,testnet.genesis={version:1,hash:"43497fd7f826957108f4a30fd9cec3aeba79972084e90ead01ea330900000000",prevBlock:"0000000000000000000000000000000000000000000000000000000000000000",merkleRoot:"3ba3edfd7a7b12b27ac72c3e67768f617fc81bc3888a51323a9fb8aa4b1e5e4a",time:1296688602,bits:486604799,nonce:414098458,height:0},testnet.genesisBlock="0100000000000000000000000000000000000000000000000000000000000000000000003ba3edfd7a7b12b27ac72c3e67768f617fc81bc3888a51323a9fb8aa4b1e5e4adae5494dffff001d1aa4ae180101000000010000000000000000000000000000000000000000000000000000000000000000ffffffff4d04ffff001d0104455468652054696d65732030332f4a616e2f32303039204368616e63656c6c6f72206f6e206272696e6b206f66207365636f6e64206261696c6f757420666f722062616e6b73ffffffff0100f2052a01000000434104678afdb0fe5548271967f1a67130b7105cd6a828e03909a67962e0ea1f61deb649f6bc3f4cef38c4f35504e51ec112de5c384df7ba0b8d578a4c702b6bf11d5fac00000000",testnet.pow={limit:new BN("00000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffff","hex"),bits:486604799,chainwork:new BN("00000000000000000000000000000000000000000000002888c34d61b53a244a","hex"),targetTimespan:1209600,targetSpacing:600,retargetInterval:2016,targetReset:!0,noRetargeting:!1},testnet.block={bip34height:21111,bip34hash:"f88ecd9912d00d3f5c2a8e0f50417d3e415c75b3abe584346da9b32300000000",bip65height:581885,bip65hash:"b61e864fbec41dfaf09da05d1d76dc068b0dd82ee7982ff255667f0000000000",bip66height:330776,bip66hash:"82a14b9e5ea81d4832b8e2cd3c2a6092b5a3853285a8995ec4c8042100000000",UAHFHeight:1155876,daaHeight:1188697,cashHardForkTime:15106e5,antiReplayOpReturnSunsetHeight:125e4,antiReplayOpReturnCommitment:Buffer.from("Bitcoin: A Peer-to-Peer Electronic Cash System"),pruneAfterHeight:1e3,keepBlocks:1e4,maxTipAge:86400,slowHeight:95e4},testnet.bip30={},testnet.activationThreshold=1512,testnet.minerWindow=2016,testnet.deployments={csv:{name:"csv",bit:0,startTime:1456790400,timeout:1493596800,threshold:-1,window:-1,required:!1,force:!0},testdummy:{name:"testdummy",bit:28,startTime:1199145601,timeout:1230767999,threshold:-1,window:-1,required:!1,force:!0}},testnet.deploys=[testnet.deployments.csv,testnet.deployments.testdummy],testnet.keyPrefix={privkey:239,xpubkey:70617039,xprivkey:70615956,xpubkey58:"tpub",xprivkey58:"tprv",coinType:1},testnet.addressPrefix={pubkeyhash:111,scripthash:196},testnet.requireStandard=!1,testnet.rpcPort=18332,testnet.minRelay=1e3,testnet.feeRate=2e4,testnet.maxFeeRate=6e4,testnet.selfConnect=!1,testnet.requestMempool=!1;var regtest={};regtest.type="regtest",regtest.seeds=["127.0.0.1"],regtest.magic=3669344250,regtest.netmagic=4206867930,regtest.port=48444,regtest.checkpointMap={0:"06226e46111a0b59caaf126043eb5bbf28c34f3a5e332a1fc7b2b73cf188910f"},regtest.lastCheckpoint=0,regtest.halvingInterval=150,regtest.genesis={version:1,hash:"06226e46111a0b59caaf126043eb5bbf28c34f3a5e332a1fc7b2b73cf188910f",prevBlock:"0000000000000000000000000000000000000000000000000000000000000000",merkleRoot:"3ba3edfd7a7b12b27ac72c3e67768f617fc81bc3888a51323a9fb8aa4b1e5e4a",time:1296688602,bits:545259519,nonce:2,height:0},regtest.genesisBlock="0100000000000000000000000000000000000000000000000000000000000000000000003ba3edfd7a7b12b27ac72c3e67768f617fc81bc3888a51323a9fb8aa4b1e5e4adae5494dffff7f20020000000101000000010000000000000000000000000000000000000000000000000000000000000000ffffffff4d04ffff001d0104455468652054696d65732030332f4a616e2f32303039204368616e63656c6c6f72206f6e206272696e6b206f66207365636f6e64206261696c6f757420666f722062616e6b73ffffffff0100f2052a01000000434104678afdb0fe5548271967f1a67130b7105cd6a828e03909a67962e0ea1f61deb649f6bc3f4cef38c4f35504e51ec112de5c384df7ba0b8d578a4c702b6bf11d5fac00000000",regtest.pow={limit:new BN("7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff","hex"),bits:545259519,chainwork:new BN("0000000000000000000000000000000000000000000000000000000000000002","hex"),targetTimespan:1209600,targetSpacing:600,retargetInterval:2016,targetReset:!0,noRetargeting:!0},regtest.block={bip34height:1e8,bip34hash:null,bip65height:1351,bip65hash:null,bip66height:1251,bip66hash:null,UAHFHeight:0,daaHeight:0,cashHardForkTime:0,antiReplayOpReturnSunsetHeight:53e4,pruneAfterHeight:1e3,keepBlocks:1e4,maxTipAge:4294967295,slowHeight:0},regtest.bip30={},regtest.activationThreshold=108,regtest.minerWindow=144,regtest.deployments={csv:{name:"csv",bit:0,startTime:0,timeout:4294967295,threshold:-1,window:-1,required:!1,force:!0},testdummy:{name:"testdummy",bit:28,startTime:0,timeout:4294967295,threshold:-1,window:-1,required:!1,force:!0}},regtest.deploys=[regtest.deployments.csv,regtest.deployments.testdummy],regtest.keyPrefix={privkey:90,xpubkey:3937729029,xprivkey:3937666247,xpubkey58:"rpub",xprivkey58:"rprv",coinType:1},regtest.addressPrefix={pubkeyhash:60,scripthash:38},regtest.requireStandard=!1,regtest.rpcPort=48332,regtest.minRelay=1e3,regtest.feeRate=2e4,regtest.maxFeeRate=6e4,regtest.selfConnect=!0,regtest.requestMempool=!0,network.main=main,network.testnet=testnet,network.regtest=regtest}).call(this,require("buffer").Buffer)},{"bn.js":217,buffer:269}],89:[function(require,module,exports){"use strict";var assert=require("assert"),consensus=require("./consensus");exports.MAX_TX_VERSION=2,exports.MAX_TX_SIZE=consensus.ONE_MEGABYTE,exports.MAX_TX_WEIGHT=consensus.MAX_BLOCK_WEIGHT/10,exports.MAX_TX_SIGOPS=consensus.MAX_BLOCK_SIGOPS/5,exports.MAX_TX_SIGOPS_COST=consensus.MAX_BLOCK_SIGOPS_COST/5,exports.BYTES_PER_SIGOP=20,exports.MIN_RELAY=1e3,exports.BARE_MULTISIG=!0,exports.FREE_THRESHOLD=144*consensus.COIN/250,exports.MAX_P2SH_SIGOPS=15,exports.MAX_OP_RETURN_BYTES=83,exports.MAX_OP_RETURN=80,exports.MAX_P2WSH_STACK=100,exports.MAX_P2WSH_PUSH=80,exports.MAX_P2WSH_SIZE=3600,exports.MEMPOOL_MAX_ANCESTORS=25,exports.MEMPOOL_MAX_SIZE=1e8,exports.MEMPOOL_EXPIRY_TIME=259200,exports.MEMPOOL_MAX_ORPHANS=100,exports.MIN_BLOCK_WEIGHT=0,exports.MAX_BLOCK_WEIGHT=1e6*consensus.WITNESS_SCALE_FACTOR,exports.BLOCK_PRIORITY_WEIGHT=0,exports.BLOCK_PRIORITY_THRESHOLD=exports.FREE_THRESHOLD,exports.getMinFee=function(size,rate){if(null==rate&&(rate=exports.MIN_RELAY),assert(size>=0),assert(rate>=0),0===size)return 0;var fee=Math.floor(rate*size/1e3);return 0===fee&&rate>0&&(fee=rate),fee},exports.getRoundFee=function(size,rate){if(null==rate&&(rate=exports.MIN_RELAY),assert(size>=0),assert(rate>=0),0===size)return 0;var fee=rate*Math.ceil(size/1e3);return 0===fee&&rate>0&&(fee=rate),fee},exports.getRate=function(size,fee){return assert(size>=0),assert(fee>=0),0===size?0:Math.floor(1e3*fee/size)}},{"./consensus":84,assert:146}],90:[function(require,module,exports){"use strict";var EventEmitter=require("events"),util=require("../utils/util"),binary=require("../utils/binary"),TimeData=function(_EventEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(TimeData,_EventEmitter);function TimeData(limit){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TimeData);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return null==limit&&(limit=200),_this.samples=[],_this.known=new Map,_this.limit=limit,_this.offset=0,_this.checked=!1,_this}return TimeData.prototype.add=function(id,time){if(!(this.samples.length>=this.limit||this.known.has(id))){var sample=time-util.now();if(this.known.set(id,sample),binary.insert(this.samples,sample,compare),this.emit("sample",sample,this.samples.length),this.samples.length>=5&&this.samples.length%2==1){var median=this.samples[this.samples.length>>>1];if(Math.abs(median)>=4200){if(!this.checked){var match=!1,_iterator=this.samples,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var offset=_ref;if(0!==offset&&Math.abs(offset)<300){match=!0;break}}match||(this.checked=!0,this.emit("mismatch"))}median=0}this.offset=median,this.emit("offset",this.offset)}}},TimeData.prototype.now=function(){return util.now()+this.offset},TimeData.prototype.adjust=function(time){return time+this.offset},TimeData.prototype.local=function(time){return time-this.offset},TimeData.prototype.ms=function(){return Date.now()+1e3*this.offset},TimeData}(EventEmitter);function compare(a,b){return a-b}module.exports=TimeData},{"../utils/binary":100,"../utils/util":106,events:334}],91:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),secp256k1=require("bcrypto/lib/secp256k1"),ScriptNum=require("./scriptnum");exports.opcodes={OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SUBSTR:127,OP_LEFT:128,OP_RIGHT:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_CHECKLOCKTIMEVERIFY:177,OP_CHECKSEQUENCEVERIFY:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_INVALIDOPCODE:255},exports.opcodesByVal={0:"OP_0",76:"OP_PUSHDATA1",77:"OP_PUSHDATA2",78:"OP_PUSHDATA4",79:"OP_1NEGATE",80:"OP_RESERVED",81:"OP_1",82:"OP_2",83:"OP_3",84:"OP_4",85:"OP_5",86:"OP_6",87:"OP_7",88:"OP_8",89:"OP_9",90:"OP_10",91:"OP_11",92:"OP_12",93:"OP_13",94:"OP_14",95:"OP_15",96:"OP_16",97:"OP_NOP",98:"OP_VER",99:"OP_IF",100:"OP_NOTIF",101:"OP_VERIF",102:"OP_VERNOTIF",103:"OP_ELSE",104:"OP_ENDIF",105:"OP_VERIFY",106:"OP_RETURN",107:"OP_TOALTSTACK",108:"OP_FROMALTSTACK",109:"OP_2DROP",110:"OP_2DUP",111:"OP_3DUP",112:"OP_2OVER",113:"OP_2ROT",114:"OP_2SWAP",115:"OP_IFDUP",116:"OP_DEPTH",117:"OP_DROP",118:"OP_DUP",119:"OP_NIP",120:"OP_OVER",121:"OP_PICK",122:"OP_ROLL",123:"OP_ROT",124:"OP_SWAP",125:"OP_TUCK",126:"OP_CAT",127:"OP_SUBSTR",128:"OP_LEFT",129:"OP_RIGHT",130:"OP_SIZE",131:"OP_INVERT",132:"OP_AND",133:"OP_OR",134:"OP_XOR",135:"OP_EQUAL",136:"OP_EQUALVERIFY",137:"OP_RESERVED1",138:"OP_RESERVED2",139:"OP_1ADD",140:"OP_1SUB",141:"OP_2MUL",142:"OP_2DIV",143:"OP_NEGATE",144:"OP_ABS",145:"OP_NOT",146:"OP_0NOTEQUAL",147:"OP_ADD",148:"OP_SUB",149:"OP_MUL",150:"OP_DIV",151:"OP_MOD",152:"OP_LSHIFT",153:"OP_RSHIFT",154:"OP_BOOLAND",155:"OP_BOOLOR",156:"OP_NUMEQUAL",157:"OP_NUMEQUALVERIFY",158:"OP_NUMNOTEQUAL",159:"OP_LESSTHAN",160:"OP_GREATERTHAN",161:"OP_LESSTHANOREQUAL",162:"OP_GREATERTHANOREQUAL",163:"OP_MIN",164:"OP_MAX",165:"OP_WITHIN",166:"OP_RIPEMD160",167:"OP_SHA1",168:"OP_SHA256",169:"OP_HASH160",170:"OP_HASH256",171:"OP_CODESEPARATOR",172:"OP_CHECKSIG",173:"OP_CHECKSIGVERIFY",174:"OP_CHECKMULTISIG",175:"OP_CHECKMULTISIGVERIFY",176:"OP_NOP1",177:"OP_CHECKLOCKTIMEVERIFY",178:"OP_CHECKSEQUENCEVERIFY",179:"OP_NOP4",180:"OP_NOP5",181:"OP_NOP6",182:"OP_NOP7",183:"OP_NOP8",184:"OP_NOP9",185:"OP_NOP10",255:"OP_INVALIDOPCODE"},exports.small=[Buffer.from([129]),Buffer.from([]),Buffer.from([1]),Buffer.from([2]),Buffer.from([3]),Buffer.from([4]),Buffer.from([5]),Buffer.from([6]),Buffer.from([7]),Buffer.from([8]),Buffer.from([9]),Buffer.from([10]),Buffer.from([11]),Buffer.from([12]),Buffer.from([13]),Buffer.from([14]),Buffer.from([15]),Buffer.from([16])],exports.flags={VERIFY_NONE:0,VERIFY_P2SH:1,VERIFY_STRICTENC:2,VERIFY_DERSIG:4,VERIFY_LOW_S:8,VERIFY_NULLDUMMY:16,VERIFY_SIGPUSHONLY:32,VERIFY_MINIMALDATA:64,VERIFY_DISCOURAGE_UPGRADABLE_NOPS:128,VERIFY_CLEANSTACK:256,VERIFY_CHECKLOCKTIMEVERIFY:512,VERIFY_CHECKSEQUENCEVERIFY:1024,VERIFY_DISCOURAGE_UPGRADABLE_WITNESS_PROGRAM:4096,VERIFY_MINIMALIF:8192,VERIFY_NULLFAIL:16384,VERIFY_COMPRESSED_PUBKEYTYPE:32768,VERIFY_SIGHASH_FORKID:65536},exports.flags.MANDATORY_VERIFY_FLAGS=exports.flags.VERIFY_P2SH,exports.flags.STANDARD_VERIFY_FLAGS=0|exports.flags.MANDATORY_VERIFY_FLAGS|exports.flags.VERIFY_DERSIG|exports.flags.VERIFY_STRICTENC|exports.flags.VERIFY_MINIMALDATA|exports.flags.VERIFY_NULLDUMMY|exports.flags.VERIFY_DISCOURAGE_UPGRADABLE_NOPS|exports.flags.VERIFY_CLEANSTACK|exports.flags.VERIFY_MINIMALIF|exports.flags.VERIFY_NULLFAIL|exports.flags.VERIFY_CHECKLOCKTIMEVERIFY|exports.flags.VERIFY_CHECKSEQUENCEVERIFY|exports.flags.VERIFY_LOW_S|exports.flags.VERIFY_DISCOURAGE_UPGRADABLE_WITNESS_PROGRAM|exports.flags.VERIFY_COMPRESSED_PUBKEYTYPE,exports.flags.ONLY_STANDARD_VERIFY_FLAGS=exports.flags.STANDARD_VERIFY_FLAGS&~exports.flags.MANDATORY_VERIFY_FLAGS,exports.hashType={ALL:1,NONE:2,SINGLE:3,SIGHASH_FORKID:64,ANYONECANPAY:128},exports.hashTypeByVal={1:"ALL",2:"NONE",3:"SINGLE",64:"SIGHASH_FORKID",128:"ANYONECANPAY"},exports.types={NONSTANDARD:0,PUBKEY:1,PUBKEYHASH:2,SCRIPTHASH:3,MULTISIG:4,NULLDATA:5},exports.typesByVal={0:"NONSTANDARD",1:"PUBKEY",2:"PUBKEYHASH",3:"SCRIPTHASH",4:"MULTISIG",5:"NULLDATA"},exports.isHashType=function(sig){if(assert(Buffer.isBuffer(sig)),0===sig.length)return!1;var type=sig[sig.length-1]&~(exports.hashType.SIGHASH_FORKID||exports.hashType.ANYONECANPAY);return!(type<exports.hashType.ALL||type>exports.hashType.SINGLE)},exports.isLowDER=function(sig){return!!exports.isSignatureEncoding(sig)&&secp256k1.isLowS(sig.slice(0,-1))},exports.isKeyEncoding=function(key){if(assert(Buffer.isBuffer(key)),key.length<33)return!1;if(4===key[0]){if(65!==key.length)return!1}else{if(2!==key[0]&&3!==key[0])return!1;if(33!==key.length)return!1}return!0},exports.isCompressedEncoding=function(key){return assert(Buffer.isBuffer(key)),33===key.length&&(2===key[0]||3===key[0])},exports.isSignatureEncoding=function(sig){if(assert(Buffer.isBuffer(sig)),sig.length<9)return!1;if(sig.length>73)return!1;if(48!==sig[0])return!1;if(sig[1]!==sig.length-3)return!1;var lenR=sig[3];if(5+lenR>=sig.length)return!1;var lenS=sig[5+lenR];return lenR+lenS+7===sig.length&&(2===sig[2]&&(0!==lenR&&(!(128&sig[4])&&(!(lenR>1&&0===sig[4]&&!(128&sig[5]))&&(2===sig[lenR+4]&&(0!==lenS&&(!(128&sig[lenR+6])&&!(lenS>1&&0===sig[lenR+6]&&!(128&sig[lenR+7])))))))))},exports.toASM=function(item,decode){if(item.length<=4){return ScriptNum.decode(item).toString(10)}if(decode&&exports.isSignatureEncoding(item)){var type=item[item.length-1],symbol=exports.hashTypeByVal[31&type]||"";return symbol&&(type&exports.hashType.ANYONECANPAY&&(symbol+="|ANYONECANPAY"),symbol="["+symbol+"]"),item.slice(0,-1).toString("hex")+symbol}return item.toString("hex")}}).call(this,require("buffer").Buffer)},{"./scriptnum":97,assert:146,"bcrypto/lib/secp256k1":184,buffer:269}],92:[function(require,module,exports){"use strict";exports.common=require("./common"),exports.Opcode=require("./opcode"),exports.Program=require("./program"),exports.Script=require("./script"),exports.ScriptError=require("./scripterror"),exports.ScriptNum=require("./scriptnum"),exports.sigcache=require("./sigcache"),exports.Stack=require("./stack")},{"./common":91,"./opcode":93,"./program":94,"./script":95,"./scripterror":96,"./scriptnum":97,"./sigcache":98,"./stack":99}],93:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),bio=require("bufio"),ScriptNum=require("./scriptnum"),common=require("./common"),opcodes=common.opcodes,opCache=[],PARSE_ERROR=null,Opcode=function(){function Opcode(value,data){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Opcode),this.value=value||0,this.data=data||null}return Opcode.prototype.isMinimal=function(){if(!this.data)return!0;if(1===this.data.length){if(129===this.data[0])return!1;if(this.data[0]>=1&&this.data[0]<=16)return!1}return this.data.length<=75?this.value===this.data.length:this.data.length<=255?this.value===opcodes.OP_PUSHDATA1:this.data.length<=65535?this.value===opcodes.OP_PUSHDATA2:(assert(this.value===opcodes.OP_PUSHDATA4),!0)},Opcode.prototype.isDisabled=function(){switch(this.value){case opcodes.OP_CAT:case opcodes.OP_SUBSTR:case opcodes.OP_LEFT:case opcodes.OP_RIGHT:case opcodes.OP_INVERT:case opcodes.OP_AND:case opcodes.OP_OR:case opcodes.OP_XOR:case opcodes.OP_2MUL:case opcodes.OP_2DIV:case opcodes.OP_MUL:case opcodes.OP_DIV:case opcodes.OP_MOD:case opcodes.OP_LSHIFT:case opcodes.OP_RSHIFT:return!0}return!1},Opcode.prototype.isBranch=function(){return this.value>=opcodes.OP_IF&&this.value<=opcodes.OP_ENDIF},Opcode.prototype.equals=function(op){return assert(Opcode.isOpcode(op)),this.value===op.value&&(this.data?(assert(op.data),this.data.equals(op.data)):(assert(!op.data),!0))},Opcode.prototype.toOp=function(){return this.value},Opcode.prototype.toData=function(){return this.data},Opcode.prototype.toLength=function(){return this.data?this.data.length:-1},Opcode.prototype.toPush=function(){return this.value===opcodes.OP_0?common.small[1]:this.value===opcodes.OP_1NEGATE?common.small[0]:this.value>=opcodes.OP_1&&this.value<=opcodes.OP_16?common.small[this.value-80+1]:this.toData()},Opcode.prototype.toString=function(enc){var data=this.toPush();return data?data.toString(enc||"utf8"):null},Opcode.prototype.toSmall=function(){return this.value===opcodes.OP_0?0:this.value>=opcodes.OP_1&&this.value<=opcodes.OP_16?this.value-80:-1},Opcode.prototype.toNum=function(minimal,limit){return this.value===opcodes.OP_0?ScriptNum.fromInt(0):this.value===opcodes.OP_1NEGATE?ScriptNum.fromInt(-1):this.value>=opcodes.OP_1&&this.value<=opcodes.OP_16?ScriptNum.fromInt(this.value-80):this.data?ScriptNum.decode(this.data,minimal,limit):null},Opcode.prototype.toInt=function(minimal,limit){var num=this.toNum(minimal,limit);return num?num.getInt():-1},Opcode.prototype.toBool=function(){var smi=this.toSmall();return-1!==smi&&1===smi},Opcode.prototype.toSymbol=function(){if(-1===this.value)return"OP_INVALIDOPCODE";var symbol=common.opcodesByVal[this.value];return symbol||"0x"+hex8(this.value)},Opcode.prototype.getSize=function(){if(!this.data)return 1;switch(this.value){case opcodes.OP_PUSHDATA1:return 2+this.data.length;case opcodes.OP_PUSHDATA2:return 3+this.data.length;case opcodes.OP_PUSHDATA4:return 5+this.data.length;default:return 1+this.data.length}},Opcode.prototype.toWriter=function(bw){if(-1===this.value)throw new Error("Cannot reserialize a parse error.");if(!this.data)return bw.writeU8(this.value),bw;switch(this.value){case opcodes.OP_PUSHDATA1:bw.writeU8(this.value),bw.writeU8(this.data.length),bw.writeBytes(this.data);break;case opcodes.OP_PUSHDATA2:bw.writeU8(this.value),bw.writeU16(this.data.length),bw.writeBytes(this.data);break;case opcodes.OP_PUSHDATA4:bw.writeU8(this.value),bw.writeU32(this.data.length),bw.writeBytes(this.data);break;default:assert(this.value===this.data.length),bw.writeU8(this.value),bw.writeBytes(this.data)}return bw},Opcode.prototype.toRaw=function(){var size=this.getSize();return this.toWriter(bio.write(size)).render()},Opcode.prototype.toFormat=function(){if(-1===this.value)return"0x01";if(this.data){if(this.data.length<=4){var num=this.toNum();if(this.equals(Opcode.fromNum(num)))return num.toString(10)}var _symbol=common.opcodesByVal[this.value],data=this.data.toString("hex");if(!_symbol){return"0x"+hex8(this.value)+" 0x"+data}for(var size=this.data.length.toString(16);size.length%2!=0;)size="0"+size;return _symbol+" 0x"+size+" 0x"+data}var symbol=common.opcodesByVal[this.value];if(symbol)return symbol;return"0x"+hex8(this.value)},Opcode.prototype.toASM=function(decode){return-1===this.value?"[error]":this.data?common.toASM(this.data,decode):common.opcodesByVal[this.value]||"OP_UNKNOWN"},Opcode.fromOp=function(op){assert("number"==typeof op);var cached=opCache[op];return assert(cached,"Bad opcode."),cached},Opcode.fromData=function(data){if(assert(Buffer.isBuffer(data)),1===data.length){if(129===data[0])return this.fromOp(opcodes.OP_1NEGATE);if(data[0]>=1&&data[0]<=16)return this.fromOp(data[0]+80)}return this.fromPush(data)},Opcode.fromPush=function(data){if(assert(Buffer.isBuffer(data)),0===data.length)return this.fromOp(opcodes.OP_0);if(data.length<=75)return new this(data.length,data);if(data.length<=255)return new this(opcodes.OP_PUSHDATA1,data);if(data.length<=65535)return new this(opcodes.OP_PUSHDATA2,data);if(data.length<=4294967295)return new this(opcodes.OP_PUSHDATA4,data);throw new Error("Pushdata size too large.")},Opcode.fromString=function(str,enc){assert("string"==typeof str);var data=Buffer.from(str,enc||"utf8");return this.fromData(data)},Opcode.fromSmall=function(num){return assert((255&num)===num&&num>=0&&num<=16),this.fromOp(0===num?0:num+80)},Opcode.fromNum=function(num){return assert(ScriptNum.isScriptNum(num)),this.fromData(num.encode())},Opcode.fromInt=function(num){return assert(Number.isSafeInteger(num)),0===num?this.fromOp(opcodes.OP_0):-1===num?this.fromOp(opcodes.OP_1NEGATE):num>=1&&num<=16?this.fromOp(num+80):this.fromNum(ScriptNum.fromNumber(num))},Opcode.fromBool=function(value){return assert("boolean"==typeof value),this.fromSmall(value?1:0)},Opcode.fromSymbol=function(name){assert("string"==typeof name),assert(name.length>0),32&name.charCodeAt(0)&&(name=name.toUpperCase()),/^OP_/.test(name)||(name="OP_"+name);var op=common.opcodes[name];if(null!=op)return this.fromOp(op);assert(/^OP_0X/.test(name),"Unknown opcode."),assert(7===name.length,"Unknown opcode.");var value=parseInt(name.substring(5),16);return assert((255&value)===value,"Unknown opcode."),this.fromOp(value)},Opcode.fromReader=function(br){var value=br.readU8(),op=opCache[value];if(op)return op;switch(value){case opcodes.OP_PUSHDATA1:if(br.left()<1)return PARSE_ERROR;var size=br.readU8();if(br.left()<size)return br.seek(br.left()),PARSE_ERROR;return new this(value,br.readBytes(size));case opcodes.OP_PUSHDATA2:if(br.left()<2)return br.seek(br.left()),PARSE_ERROR;var _size2=br.readU16();if(br.left()<_size2)return br.seek(br.left()),PARSE_ERROR;return new this(value,br.readBytes(_size2));case opcodes.OP_PUSHDATA4:if(br.left()<4)return br.seek(br.left()),PARSE_ERROR;var _size3=br.readU32();if(br.left()<_size3)return br.seek(br.left()),PARSE_ERROR;return new this(value,br.readBytes(_size3));default:if(br.left()<value)return br.seek(br.left()),PARSE_ERROR;return new this(value,br.readBytes(value))}},Opcode.fromRaw=function(data){return this.fromReader(bio.read(data))},Opcode.isOpcode=function(obj){return obj instanceof Opcode},Opcode}();function hex8(num){return num<=15?"0"+num.toString(16):num.toString(16)}PARSE_ERROR=Object.freeze(new Opcode(-1));for(var value=0;value<=255;value++)if(value>=1&&value<=78)opCache.push(null);else{var op=new Opcode(value);opCache.push(Object.freeze(op))}module.exports=Opcode}).call(this,require("buffer").Buffer)},{"./common":91,"./scriptnum":97,assert:146,buffer:269,bufio:270}],94:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),common=require("./common"),scriptTypes=common.types,Program=function(){function Program(version,data){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Program),assert((255&version)===version),assert(version>=0&&version<=16),assert(Buffer.isBuffer(data)),assert(data.length>=2&&data.length<=40),this.version=version,this.data=data}return Program.prototype.getType=function(){return 0===this.version?20===this.data.length?scriptTypes.WITNESSPUBKEYHASH:32===this.data.length?scriptTypes.WITNESSSCRIPTHASH:scriptTypes.WITNESSMALFORMED:scriptTypes.NONSTANDARD},Program.prototype.isUnknown=function(){var type=this.getType();return type===scriptTypes.WITNESSMALFORMED||type===scriptTypes.NONSTANDARD},Program.prototype.isMalformed=function(){return this.getType()===scriptTypes.WITNESSMALFORMED},Program.prototype.inspect=function(){var data=this.data.toString("hex"),type=common.typesByVal[this.getType()].toLowerCase();return"<Program: version="+this.version+" data="+data+" type="+type+">"},Program}();module.exports=Program}).call(this,{isBuffer:require("../../node_modules/is-buffer/index.js")})},{"../../node_modules/is-buffer/index.js":353,"./common":91,assert:146}],95:[function(require,module,exports){(function(Buffer){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var assert=require("assert"),bio=require("bufio"),ripemd160=require("bcrypto/lib/ripemd160"),sha1=require("bcrypto/lib/sha1"),_sha=require("bcrypto/lib/sha256"),_hash=require("bcrypto/lib/hash160"),hash256=require("bcrypto/lib/hash256"),secp256k1=require("bcrypto/lib/secp256k1"),consensus=require("../protocol/consensus"),policy=require("../protocol/policy"),Program=require("./program"),Opcode=require("./opcode"),Stack=require("./stack"),ScriptError=require("./scripterror"),ScriptNum=require("./scriptnum"),common=require("./common"),Address=require("../primitives/address"),opcodes=common.opcodes,scriptTypes=common.types,encoding=bio.encoding,EMPTY_BUFFER=Buffer.alloc(0),Script=function(){function Script(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Script),this.raw=EMPTY_BUFFER,this.code=[],options&&this.fromOptions(options)}return Script.prototype.fromOptions=function(options){if(assert(options,"Script data is required."),Buffer.isBuffer(options))return this.fromRaw(options);if(Array.isArray(options))return this.fromArray(options);if(options.raw){if(!options.code)return this.fromRaw(options.raw);assert(Buffer.isBuffer(options.raw),"Raw must be a Buffer."),this.raw=options.raw}if(options.code){if(!options.raw)return this.fromArray(options.code);assert(Array.isArray(options.code),"Code must be an array."),this.code=options.code}return this},Script.fromOptions=function(options){return(new this).fromOptions(options)},Script.prototype.values=function(){return this.code.values()},Script.prototype.entries=function(){return this.code.entries()},Script.prototype[Symbol.iterator]=function(){return this.code[Symbol.iterator]()},Script.prototype.toArray=function(){return this.code.slice()},Script.prototype.fromArray=function(code){assert(Array.isArray(code)),this.clear();var _iterator=code,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var op=_ref;this.push(op)}return this.compile()},Script.fromArray=function(code){return(new this).fromArray(code)},Script.prototype.toItems=function(){var items=[],_iterator2=this.code,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref2=_i2.value}var data=_ref2.toPush();if(!data)throw new Error("Non-push opcode in script.");items.push(data)}return items},Script.prototype.fromItems=function(items){assert(Array.isArray(items)),this.clear();var _iterator3=items,_isArray3=Array.isArray(_iterator3),_i3=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref3;if(_isArray3){if(_i3>=_iterator3.length)break;_ref3=_iterator3[_i3++]}else{if((_i3=_iterator3.next()).done)break;_ref3=_i3.value}var item=_ref3;this.pushData(item)}return this.compile()},Script.fromItems=function(items){return(new this).fromItems(items)},Script.prototype.toStack=function(){return new Stack(this.toItems())},Script.prototype.fromStack=function(stack){return this.fromItems(stack.items)},Script.fromStack=function(stack){return(new this).fromStack(stack)},Script.prototype.clone=function(){return(new this.constructor).inject(this)},Script.prototype.inject=function(script){return this.raw=script.raw,this.code=script.code.slice(),this},Script.prototype.equals=function(script){return assert(Script.isScript(script)),this.raw.equals(script.raw)},Script.prototype.compare=function(script){return assert(Script.isScript(script)),this.raw.compare(script.raw)},Script.prototype.clear=function(){return this.raw=EMPTY_BUFFER,this.code.length=0,this},Script.prototype.inspect=function(){return"<Script: "+this.toString()+">"},Script.prototype.toString=function(){var out=[],_iterator4=this.code,_isArray4=Array.isArray(_iterator4),_i4=0;for(_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();;){var _ref4;if(_isArray4){if(_i4>=_iterator4.length)break;_ref4=_iterator4[_i4++]}else{if((_i4=_iterator4.next()).done)break;_ref4=_i4.value}var op=_ref4;out.push(op.toFormat())}return out.join(" ")},Script.prototype.toASM=function(decode){this.isNulldata()&&(decode=!1);var out=[],_iterator5=this.code,_isArray5=Array.isArray(_iterator5),_i5=0;for(_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();;){var _ref5;if(_isArray5){if(_i5>=_iterator5.length)break;_ref5=_iterator5[_i5++]}else{if((_i5=_iterator5.next()).done)break;_ref5=_i5.value}var op=_ref5;out.push(op.toASM(decode))}return out.join(" ")},Script.prototype.compile=function(){if(0===this.code.length)return this.clear();var size=0,_iterator6=this.code,_isArray6=Array.isArray(_iterator6),_i6=0;for(_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();;){var _ref6;if(_isArray6){if(_i6>=_iterator6.length)break;_ref6=_iterator6[_i6++]}else{if((_i6=_iterator6.next()).done)break;_ref6=_i6.value}size+=_ref6.getSize()}var bw=bio.write(size),_iterator7=this.code,_isArray7=Array.isArray(_iterator7),_i7=0;for(_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();;){var _ref7;if(_isArray7){if(_i7>=_iterator7.length)break;_ref7=_iterator7[_i7++]}else{if((_i7=_iterator7.next()).done)break;_ref7=_i7.value}_ref7.toWriter(bw)}return this.raw=bw.render(),this},Script.prototype.toWriter=function(bw){return bw.writeVarBytes(this.raw),bw},Script.prototype.toRaw=function(){return this.raw},Script.prototype.toJSON=function(){return this.toRaw().toString("hex")},Script.prototype.fromJSON=function(json){return assert("string"==typeof json,"Code must be a string."),this.fromRaw(Buffer.from(json,"hex"))},Script.fromJSON=function(json){return(new this).fromJSON(json)},Script.prototype.getSubscript=function(index){if(0===index)return this.clone();for(var script=new Script,i=index;i<this.code.length;i++){var op=this.code[i];if(-1===op.value)break;script.code.push(op)}return script.compile()},Script.prototype.removeSeparators=function(){var found=!1,_iterator8=this.code,_isArray8=Array.isArray(_iterator8),_i8=0;for(_iterator8=_isArray8?_iterator8:_iterator8[Symbol.iterator]();;){var _ref8;if(_isArray8){if(_i8>=_iterator8.length)break;_ref8=_iterator8[_i8++]}else{if((_i8=_iterator8.next()).done)break;_ref8=_i8.value}var op=_ref8;if(-1===op.value)break;if(op.value===opcodes.OP_CODESEPARATOR){found=!0;break}}if(!found)return this;var script=new Script,_iterator9=this.code,_isArray9=Array.isArray(_iterator9),_i9=0;for(_iterator9=_isArray9?_iterator9:_iterator9[Symbol.iterator]();;){var _ref9;if(_isArray9){if(_i9>=_iterator9.length)break;_ref9=_iterator9[_i9++]}else{if((_i9=_iterator9.next()).done)break;_ref9=_i9.value}var _op2=_ref9;if(-1===_op2.value)break;_op2.value!==opcodes.OP_CODESEPARATOR&&script.code.push(_op2)}return script.compile()},Script.prototype.execute=function(stack,flags,tx,index,value){if(null==flags&&(flags=Script.flags.STANDARD_VERIFY_FLAGS),this.raw.length>consensus.MAX_SCRIPT_SIZE)throw new ScriptError("SCRIPT_SIZE");var state=[],alt=[],lastSep=0,opCount=0,negate=0,minimal=!1;flags&Script.flags.VERIFY_MINIMALDATA&&(minimal=!0);for(var ip=0;ip<this.code.length;ip++){var op=this.code[ip];if(-1===op.value)throw new ScriptError("BAD_OPCODE",op,ip);if(op.data&&op.data.length>consensus.MAX_SCRIPT_PUSH)throw new ScriptError("PUSH_SIZE",op,ip);if(op.value>opcodes.OP_16&&++opCount>consensus.MAX_SCRIPT_OPS)throw new ScriptError("OP_COUNT",op,ip);if(op.isDisabled())throw new ScriptError("DISABLED_OPCODE",op,ip);if(!negate||op.isBranch())if(op.data){if(minimal&&!op.isMinimal())throw new ScriptError("MINIMALDATA",op,ip);if(stack.push(op.data),stack.length+alt.length>consensus.MAX_SCRIPT_STACK)throw new ScriptError("STACK_SIZE",op,ip)}else{switch(op.value){case opcodes.OP_0:stack.pushInt(0);break;case opcodes.OP_1NEGATE:stack.pushInt(-1);break;case opcodes.OP_1:case opcodes.OP_2:case opcodes.OP_3:case opcodes.OP_4:case opcodes.OP_5:case opcodes.OP_6:case opcodes.OP_7:case opcodes.OP_8:case opcodes.OP_9:case opcodes.OP_10:case opcodes.OP_11:case opcodes.OP_12:case opcodes.OP_13:case opcodes.OP_14:case opcodes.OP_15:case opcodes.OP_16:stack.pushInt(op.value-80);break;case opcodes.OP_NOP:break;case opcodes.OP_CHECKLOCKTIMEVERIFY:if(!(flags&Script.flags.VERIFY_CHECKLOCKTIMEVERIFY)){if(flags&Script.flags.VERIFY_DISCOURAGE_UPGRADABLE_NOPS)throw new ScriptError("DISCOURAGE_UPGRADABLE_NOPS",op,ip);break}if(!tx)throw new ScriptError("UNKNOWN_ERROR","No TX passed in.");if(0===stack.length)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);var num=stack.getNum(-1,minimal,5);if(num.isNeg())throw new ScriptError("NEGATIVE_LOCKTIME",op,ip);var locktime=num.toDouble();if(!tx.verifyLocktime(index,locktime))throw new ScriptError("UNSATISFIED_LOCKTIME",op,ip);break;case opcodes.OP_CHECKSEQUENCEVERIFY:if(!(flags&Script.flags.VERIFY_CHECKSEQUENCEVERIFY)){if(flags&Script.flags.VERIFY_DISCOURAGE_UPGRADABLE_NOPS)throw new ScriptError("DISCOURAGE_UPGRADABLE_NOPS",op,ip);break}if(!tx)throw new ScriptError("UNKNOWN_ERROR","No TX passed in.");if(0===stack.length)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);var _num=stack.getNum(-1,minimal,5);if(_num.isNeg())throw new ScriptError("NEGATIVE_LOCKTIME",op,ip);var _locktime=_num.toDouble();if(!tx.verifySequence(index,_locktime))throw new ScriptError("UNSATISFIED_LOCKTIME",op,ip);break;case opcodes.OP_NOP1:case opcodes.OP_NOP4:case opcodes.OP_NOP5:case opcodes.OP_NOP6:case opcodes.OP_NOP7:case opcodes.OP_NOP8:case opcodes.OP_NOP9:case opcodes.OP_NOP10:if(flags&Script.flags.VERIFY_DISCOURAGE_UPGRADABLE_NOPS)throw new ScriptError("DISCOURAGE_UPGRADABLE_NOPS",op,ip);break;case opcodes.OP_IF:case opcodes.OP_NOTIF:var val=!1;if(!negate){if(stack.length<1)throw new ScriptError("UNBALANCED_CONDITIONAL",op,ip);if(flags&Script.flags.VERIFY_MINIMALIF){var item=stack.get(-1);if(item.length>1)throw new ScriptError("MINIMALIF");if(1===item.length&&1!==item[0])throw new ScriptError("MINIMALIF")}val=stack.getBool(-1),op.value===opcodes.OP_NOTIF&&(val=!val),stack.pop()}state.push(val),val||(negate+=1);break;case opcodes.OP_ELSE:if(0===state.length)throw new ScriptError("UNBALANCED_CONDITIONAL",op,ip);state[state.length-1]=!state[state.length-1],state[state.length-1]?negate-=1:negate+=1;break;case opcodes.OP_ENDIF:if(0===state.length)throw new ScriptError("UNBALANCED_CONDITIONAL",op,ip);state.pop()||(negate-=1);break;case opcodes.OP_VERIFY:if(0===stack.length)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);if(!stack.getBool(-1))throw new ScriptError("VERIFY",op,ip);stack.pop();break;case opcodes.OP_RETURN:throw new ScriptError("OP_RETURN",op,ip);case opcodes.OP_TOALTSTACK:if(0===stack.length)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);alt.push(stack.pop());break;case opcodes.OP_FROMALTSTACK:if(0===alt.length)throw new ScriptError("INVALID_ALTSTACK_OPERATION",op,ip);stack.push(alt.pop());break;case opcodes.OP_2DROP:if(stack.length<2)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);stack.pop(),stack.pop();break;case opcodes.OP_2DUP:if(stack.length<2)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);var v1=stack.get(-2),v2=stack.get(-1);stack.push(v1),stack.push(v2);break;case opcodes.OP_3DUP:if(stack.length<3)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);var _v=stack.get(-3),_v2=stack.get(-2),v3=stack.get(-1);stack.push(_v),stack.push(_v2),stack.push(v3);break;case opcodes.OP_2OVER:if(stack.length<4)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);var _v3=stack.get(-4),_v4=stack.get(-3);stack.push(_v3),stack.push(_v4);break;case opcodes.OP_2ROT:if(stack.length<6)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);var _v5=stack.get(-6),_v6=stack.get(-5);stack.erase(-6,-4),stack.push(_v5),stack.push(_v6);break;case opcodes.OP_2SWAP:if(stack.length<4)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);stack.swap(-4,-2),stack.swap(-3,-1);break;case opcodes.OP_IFDUP:if(0===stack.length)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);if(stack.getBool(-1)){var _val=stack.get(-1);stack.push(_val)}break;case opcodes.OP_DEPTH:stack.pushInt(stack.length);break;case opcodes.OP_DROP:if(0===stack.length)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);stack.pop();break;case opcodes.OP_DUP:if(0===stack.length)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);stack.push(stack.get(-1));break;case opcodes.OP_NIP:if(stack.length<2)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);stack.remove(-2);break;case opcodes.OP_OVER:if(stack.length<2)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);stack.push(stack.get(-2));break;case opcodes.OP_PICK:case opcodes.OP_ROLL:if(stack.length<2)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);var _num2=stack.getInt(-1,minimal,4);if(stack.pop(),_num2<0||_num2>=stack.length)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);var _val2=stack.get(-_num2-1);op.value===opcodes.OP_ROLL&&stack.remove(-_num2-1),stack.push(_val2);break;case opcodes.OP_ROT:if(stack.length<3)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);stack.swap(-3,-2),stack.swap(-2,-1);break;case opcodes.OP_SWAP:if(stack.length<2)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);stack.swap(-2,-1);break;case opcodes.OP_TUCK:if(stack.length<2)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);stack.insert(-2,stack.get(-1));break;case opcodes.OP_SIZE:if(stack.length<1)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);stack.pushInt(stack.get(-1).length);break;case opcodes.OP_EQUAL:case opcodes.OP_EQUALVERIFY:if(stack.length<2)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);var _v7=stack.get(-2),_v8=stack.get(-1),res=_v7.equals(_v8);if(stack.pop(),stack.pop(),stack.pushBool(res),op.value===opcodes.OP_EQUALVERIFY){if(!res)throw new ScriptError("EQUALVERIFY",op,ip);stack.pop()}break;case opcodes.OP_1ADD:case opcodes.OP_1SUB:case opcodes.OP_NEGATE:case opcodes.OP_ABS:case opcodes.OP_NOT:case opcodes.OP_0NOTEQUAL:if(stack.length<1)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);var _num3=stack.getNum(-1,minimal,4),cmp=void 0;switch(op.value){case opcodes.OP_1ADD:_num3.iaddn(1);break;case opcodes.OP_1SUB:_num3.isubn(1);break;case opcodes.OP_NEGATE:_num3.ineg();break;case opcodes.OP_ABS:_num3.iabs();break;case opcodes.OP_NOT:cmp=_num3.isZero(),_num3=ScriptNum.fromBool(cmp);break;case opcodes.OP_0NOTEQUAL:cmp=!_num3.isZero(),_num3=ScriptNum.fromBool(cmp);break;default:assert(!1,"Fatal script error.")}stack.pop(),stack.pushNum(_num3);break;case opcodes.OP_ADD:case opcodes.OP_SUB:case opcodes.OP_BOOLAND:case opcodes.OP_BOOLOR:case opcodes.OP_NUMEQUAL:case opcodes.OP_NUMEQUALVERIFY:case opcodes.OP_NUMNOTEQUAL:case opcodes.OP_LESSTHAN:case opcodes.OP_GREATERTHAN:case opcodes.OP_LESSTHANOREQUAL:case opcodes.OP_GREATERTHANOREQUAL:case opcodes.OP_MIN:case opcodes.OP_MAX:if(stack.length<2)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);var n1=stack.getNum(-2,minimal,4),n2=stack.getNum(-1,minimal,4),_num4=void 0,_cmp=void 0;switch(op.value){case opcodes.OP_ADD:_num4=n1.iadd(n2);break;case opcodes.OP_SUB:_num4=n1.isub(n2);break;case opcodes.OP_BOOLAND:_cmp=n1.toBool()&&n2.toBool(),_num4=ScriptNum.fromBool(_cmp);break;case opcodes.OP_BOOLOR:_cmp=n1.toBool()||n2.toBool(),_num4=ScriptNum.fromBool(_cmp);break;case opcodes.OP_NUMEQUAL:case opcodes.OP_NUMEQUALVERIFY:_cmp=n1.eq(n2),_num4=ScriptNum.fromBool(_cmp);break;case opcodes.OP_NUMNOTEQUAL:_cmp=!n1.eq(n2),_num4=ScriptNum.fromBool(_cmp);break;case opcodes.OP_LESSTHAN:_cmp=n1.lt(n2),_num4=ScriptNum.fromBool(_cmp);break;case opcodes.OP_GREATERTHAN:_cmp=n1.gt(n2),_num4=ScriptNum.fromBool(_cmp);break;case opcodes.OP_LESSTHANOREQUAL:_cmp=n1.lte(n2),_num4=ScriptNum.fromBool(_cmp);break;case opcodes.OP_GREATERTHANOREQUAL:_cmp=n1.gte(n2),_num4=ScriptNum.fromBool(_cmp);break;case opcodes.OP_MIN:_num4=ScriptNum.min(n1,n2);break;case opcodes.OP_MAX:_num4=ScriptNum.max(n1,n2);break;default:assert(!1,"Fatal script error.")}if(stack.pop(),stack.pop(),stack.pushNum(_num4),op.value===opcodes.OP_NUMEQUALVERIFY){if(!stack.getBool(-1))throw new ScriptError("NUMEQUALVERIFY",op,ip);stack.pop()}break;case opcodes.OP_WITHIN:if(stack.length<3)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);var _n=stack.getNum(-3,minimal,4),_n2=stack.getNum(-2,minimal,4),n3=stack.getNum(-1,minimal,4),_val3=_n2.lte(_n)&&_n.lt(n3);stack.pop(),stack.pop(),stack.pop(),stack.pushBool(_val3);break;case opcodes.OP_RIPEMD160:if(0===stack.length)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);stack.push(ripemd160.digest(stack.pop()));break;case opcodes.OP_SHA1:if(0===stack.length)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);stack.push(sha1.digest(stack.pop()));break;case opcodes.OP_SHA256:if(0===stack.length)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);stack.push(_sha.digest(stack.pop()));break;case opcodes.OP_HASH160:if(0===stack.length)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);stack.push(_hash.digest(stack.pop()));break;case opcodes.OP_HASH256:if(0===stack.length)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);stack.push(hash256.digest(stack.pop()));break;case opcodes.OP_CODESEPARATOR:lastSep=ip+1;break;case opcodes.OP_CHECKSIG:case opcodes.OP_CHECKSIGVERIFY:if(!tx)throw new ScriptError("UNKNOWN_ERROR","No TX passed in.");if(stack.length<2)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);var sig=stack.get(-2),key=stack.get(-1),subscript=this.getSubscript(lastSep);flags&Script.flags.VERIFY_SIGHASH_FORKID&&sig[sig.length-1]&Script.hashType.SIGHASH_FORKID&&subscript.findAndDelete(sig),validateSignature(sig,flags),validateKey(key,flags);var _res=!1;if(sig.length>0){var type=sig[sig.length-1];_res=checksig(tx.signatureHash(index,subscript,value,type,flags),sig,key)}if(!_res&&flags&Script.flags.VERIFY_NULLFAIL&&0!==sig.length)throw new ScriptError("NULLFAIL",op,ip);if(stack.pop(),stack.pop(),stack.pushBool(_res),op.value===opcodes.OP_CHECKSIGVERIFY){if(!_res)throw new ScriptError("CHECKSIGVERIFY",op,ip);stack.pop()}break;case opcodes.OP_CHECKMULTISIG:case opcodes.OP_CHECKMULTISIGVERIFY:if(!tx)throw new ScriptError("UNKNOWN_ERROR","No TX passed in.");var i=1;if(stack.length<i)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);var n=stack.getInt(-i,minimal,4),okey=n+2,ikey=void 0,isig=void 0;if(n<0||n>consensus.MAX_MULTISIG_PUBKEYS)throw new ScriptError("PUBKEY_COUNT",op,ip);if((opCount+=n)>consensus.MAX_SCRIPT_OPS)throw new ScriptError("OP_COUNT",op,ip);if(ikey=i+=1,i+=n,stack.length<i)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);var m=stack.getInt(-i,minimal,4);if(m<0||m>n)throw new ScriptError("SIG_COUNT",op,ip);if(isig=i+=1,i+=m,stack.length<i)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);for(var _subscript=this.getSubscript(lastSep),j=0;j<m;j++){var _sig=stack.get(-isig-j);flags&Script.flags.VERIFY_SIGHASH_FORKID&&_sig[_sig.length-1]&Script.hashType.SIGHASH_FORKID&&_subscript.findAndDelete(_sig)}for(var _res2=!0;_res2&&m>0;){var _sig2=stack.get(-isig),_key=stack.get(-ikey);if(validateSignature(_sig2,flags),validateKey(_key,flags),_sig2.length>0){var _type=_sig2[_sig2.length-1];checksig(tx.signatureHash(index,_subscript,value,_type,flags),_sig2,_key)&&(isig+=1,m-=1)}ikey+=1,m>(n-=1)&&(_res2=!1)}for(;i>1;){if(!_res2&&flags&Script.flags.VERIFY_NULLFAIL&&0===okey&&0!==stack.get(-1).length)throw new ScriptError("NULLFAIL",op,ip);okey>0&&(okey-=1),stack.pop(),i-=1}if(stack.length<1)throw new ScriptError("INVALID_STACK_OPERATION",op,ip);if(flags&Script.flags.VERIFY_NULLDUMMY&&0!==stack.get(-1).length)throw new ScriptError("SIG_NULLDUMMY",op,ip);if(stack.pop(),stack.pushBool(_res2),op.value===opcodes.OP_CHECKMULTISIGVERIFY){if(!_res2)throw new ScriptError("CHECKMULTISIGVERIFY",op,ip);stack.pop()}break;default:throw new ScriptError("BAD_OPCODE",op,ip)}if(stack.length+alt.length>consensus.MAX_SCRIPT_STACK)throw new ScriptError("STACK_SIZE",op,ip)}else if(stack.length+alt.length>consensus.MAX_SCRIPT_STACK)throw new ScriptError("STACK_SIZE",op,ip)}if(0!==state.length)throw new ScriptError("UNBALANCED_CONDITIONAL")},Script.prototype.findAndDelete=function(data){var target=Opcode.fromPush(data);if(this.raw.length<target.getSize())return 0;var found=!1,_iterator10=this.code,_isArray10=Array.isArray(_iterator10),_i10=0;for(_iterator10=_isArray10?_iterator10:_iterator10[Symbol.iterator]();;){var _ref10;if(_isArray10){if(_i10>=_iterator10.length)break;_ref10=_iterator10[_i10++]}else{if((_i10=_iterator10.next()).done)break;_ref10=_i10.value}var op=_ref10;if(-1===op.value)break;if(op.equals(target)){found=!0;break}}if(!found)return 0;var code=[],total=0,_iterator11=this.code,_isArray11=Array.isArray(_iterator11),_i11=0;for(_iterator11=_isArray11?_iterator11:_iterator11[Symbol.iterator]();;){var _ref11;if(_isArray11){if(_i11>=_iterator11.length)break;_ref11=_iterator11[_i11++]}else{if((_i11=_iterator11.next()).done)break;_ref11=_i11.value}var _op3=_ref11;if(-1===_op3.value)break;_op3.equals(target)?total+=1:code.push(_op3)}return this.code=code,this.compile(),total},Script.prototype.indexOf=function(data){for(var i=0;i<this.code.length;i++){var op=this.code[i];if(-1===op.value)break;if(op.data&&op.data.equals(data))return i}return-1},Script.prototype.isCode=function(){var _iterator12=this.code,_isArray12=Array.isArray(_iterator12),_i12=0;for(_iterator12=_isArray12?_iterator12:_iterator12[Symbol.iterator]();;){var _ref12;if(_isArray12){if(_i12>=_iterator12.length)break;_ref12=_iterator12[_i12++]}else{if((_i12=_iterator12.next()).done)break;_ref12=_i12.value}var op=_ref12;if(-1===op.value)return!1;if(op.isDisabled())return!1;switch(op.value){case opcodes.OP_RESERVED:case opcodes.OP_NOP:case opcodes.OP_VER:case opcodes.OP_VERIF:case opcodes.OP_VERNOTIF:case opcodes.OP_RESERVED1:case opcodes.OP_RESERVED2:case opcodes.OP_NOP1:return!1}if(op.value>opcodes.OP_CHECKSEQUENCEVERIFY)return!1}return!0},Script.prototype.fromPubkey=function(key){return assert(Buffer.isBuffer(key)&&(33===key.length||65===key.length)),this.raw=Buffer.allocUnsafe(1+key.length+1),this.raw[0]=key.length,key.copy(this.raw,1),this.raw[1+key.length]=opcodes.OP_CHECKSIG,key=this.raw.slice(1,1+key.length),this.code.length=0,this.code.push(Opcode.fromPush(key)),this.code.push(Opcode.fromOp(opcodes.OP_CHECKSIG)),this},Script.fromPubkey=function(key){return(new this).fromPubkey(key)},Script.prototype.fromPubkeyhash=function(hash){return assert(Buffer.isBuffer(hash)&&20===hash.length),this.raw=Buffer.allocUnsafe(25),this.raw[0]=opcodes.OP_DUP,this.raw[1]=opcodes.OP_HASH160,this.raw[2]=20,hash.copy(this.raw,3),this.raw[23]=opcodes.OP_EQUALVERIFY,this.raw[24]=opcodes.OP_CHECKSIG,hash=this.raw.slice(3,23),this.code.length=0,this.code.push(Opcode.fromOp(opcodes.OP_DUP)),this.code.push(Opcode.fromOp(opcodes.OP_HASH160)),this.code.push(Opcode.fromPush(hash)),this.code.push(Opcode.fromOp(opcodes.OP_EQUALVERIFY)),this.code.push(Opcode.fromOp(opcodes.OP_CHECKSIG)),this},Script.fromPubkeyhash=function(hash){return(new this).fromPubkeyhash(hash)},Script.prototype.fromMultisig=function(m,n,keys){assert((255&m)===m&&(255&n)===n),assert(Array.isArray(keys)),assert(keys.length===n,"`n` keys are required for multisig."),assert(m>=1&&m<=n),assert(n>=1&&n<=15),this.clear(),this.pushSmall(m);var _iterator13=function(keys){return keys.slice().sort(function(a,b){return a.compare(b)})}(keys),_isArray13=Array.isArray(_iterator13),_i13=0;for(_iterator13=_isArray13?_iterator13:_iterator13[Symbol.iterator]();;){var _ref13;if(_isArray13){if(_i13>=_iterator13.length)break;_ref13=_iterator13[_i13++]}else{if((_i13=_iterator13.next()).done)break;_ref13=_i13.value}var key=_ref13;this.pushData(key)}return this.pushSmall(n),this.pushOp(opcodes.OP_CHECKMULTISIG),this.compile()},Script.fromMultisig=function(m,n,keys){return(new this).fromMultisig(m,n,keys)},Script.prototype.fromScripthash=function(hash){return assert(Buffer.isBuffer(hash)&&20===hash.length),this.raw=Buffer.allocUnsafe(23),this.raw[0]=opcodes.OP_HASH160,this.raw[1]=20,hash.copy(this.raw,2),this.raw[22]=opcodes.OP_EQUAL,hash=this.raw.slice(2,22),this.code.length=0,this.code.push(Opcode.fromOp(opcodes.OP_HASH160)),this.code.push(Opcode.fromPush(hash)),this.code.push(Opcode.fromOp(opcodes.OP_EQUAL)),this},Script.fromScripthash=function(hash){return(new this).fromScripthash(hash)},Script.prototype.fromNulldata=function(flags){return assert(Buffer.isBuffer(flags)),assert(flags.length<=policy.MAX_OP_RETURN,"Nulldata too large."),this.clear(),this.pushOp(opcodes.OP_RETURN),this.pushData(flags),this.compile()},Script.fromNulldata=function(flags){return(new this).fromNulldata(flags)},Script.prototype.fromProgram=function(version,data){return assert((255&version)===version&&version>=0&&version<=16),assert(Buffer.isBuffer(data)&&data.length>=2&&data.length<=40),this.raw=Buffer.allocUnsafe(2+data.length),this.raw[0]=0===version?0:version+80,this.raw[1]=data.length,data.copy(this.raw,2),data=this.raw.slice(2,2+data.length),this.code.length=0,this.code.push(Opcode.fromSmall(version)),this.code.push(Opcode.fromPush(data)),this},Script.fromProgram=function(version,data){return(new this).fromProgram(version,data)},Script.prototype.fromAddress=function(address){if("string"==typeof address&&(address=Address.fromString(address)),assert(address instanceof Address,"Not an address."),address.isPubkeyhash())return this.fromPubkeyhash(address.hash);if(address.isScripthash())return this.fromScripthash(address.hash);if(address.isProgram())return this.fromProgram(address.version,address.hash);throw new Error("Unknown address type.")},Script.fromAddress=function(address){return(new this).fromAddress(address)},Script.prototype.fromCommitment=function(hash,flags){var bw=bio.write(36);return bw.writeU32BE(2854332909),bw.writeHash(hash),this.clear(),this.pushOp(opcodes.OP_RETURN),this.pushData(bw.render()),flags&&this.pushData(flags),this.compile()},Script.fromCommitment=function(hash,flags){return(new this).fromCommitment(hash,flags)},Script.prototype.getRedeem=function(){var data=null,_iterator14=this.code,_isArray14=Array.isArray(_iterator14),_i14=0;for(_iterator14=_isArray14?_iterator14:_iterator14[Symbol.iterator]();;){var _ref14;if(_isArray14){if(_i14>=_iterator14.length)break;_ref14=_iterator14[_i14++]}else{if((_i14=_iterator14.next()).done)break;_ref14=_i14.value}var op=_ref14;if(-1===op.value)return null;if(op.value>opcodes.OP_16)return null;data=op.data}return data?Script.fromRaw(data):null},Script.prototype.getType=function(){return this.isPubkey()?scriptTypes.PUBKEY:this.isPubkeyhash()?scriptTypes.PUBKEYHASH:this.isScripthash()?scriptTypes.SCRIPTHASH:this.isMultisig()?scriptTypes.MULTISIG:this.isNulldata()?scriptTypes.NULLDATA:scriptTypes.NONSTANDARD},Script.prototype.isUnknown=function(){return this.getType()===scriptTypes.NONSTANDARD},Script.prototype.isStandard=function(){var _getMultisig=this.getMultisig(),m=_getMultisig[0],n=_getMultisig[1];return-1!==m?!(n<1||n>3)&&!(m<1||m>n):this.isNulldata()?this.raw.length<=policy.MAX_OP_RETURN_BYTES:this.getType()!==scriptTypes.NONSTANDARD},Script.prototype.getSize=function(){return this.raw.length},Script.prototype.getVarSize=function(){return encoding.sizeVarBytes(this.raw)},Script.prototype.getInputAddress=function(){return Address.fromInputScript(this)},Script.prototype.getAddress=function(){return Address.fromScript(this)},Script.prototype.hash160=function(enc){var hash=_hash.digest(this.toRaw());return"hex"===enc&&(hash=hash.toString("hex")),hash},Script.prototype.sha256=function(enc){var hash=_sha.digest(this.toRaw());return"hex"===enc&&(hash=hash.toString("hex")),hash},Script.prototype.isPubkey=function(minimal){if(minimal)return this.raw.length>=35&&(33===this.raw[0]||65===this.raw[0])&&this.raw[0]+2===this.raw.length&&this.raw[this.raw.length-1]===opcodes.OP_CHECKSIG;if(2!==this.code.length)return!1;var size=this.getLength(0);return(33===size||65===size)&&this.getOp(1)===opcodes.OP_CHECKSIG},Script.prototype.getPubkey=function(minimal){return this.isPubkey(minimal)?minimal?this.raw.slice(1,1+this.raw[0]):this.getData(0):null},Script.prototype.isPubkeyhash=function(minimal){return minimal||25===this.raw.length?25===this.raw.length&&this.raw[0]===opcodes.OP_DUP&&this.raw[1]===opcodes.OP_HASH160&&20===this.raw[2]&&this.raw[23]===opcodes.OP_EQUALVERIFY&&this.raw[24]===opcodes.OP_CHECKSIG:5===this.code.length&&(this.getOp(0)===opcodes.OP_DUP&&this.getOp(1)===opcodes.OP_HASH160&&20===this.getLength(2)&&this.getOp(3)===opcodes.OP_EQUALVERIFY&&this.getOp(4)===opcodes.OP_CHECKSIG)},Script.prototype.getPubkeyhash=function(minimal){return this.isPubkeyhash(minimal)?minimal?this.raw.slice(3,23):this.getData(2):null},Script.prototype.isMultisig=function(minimal){if(this.code.length<4||this.code.length>19)return!1;if(this.getOp(-1)!==opcodes.OP_CHECKMULTISIG)return!1;var m=this.getSmall(0);if(m<1)return!1;var n=this.getSmall(-2);if(n<1||m>n)return!1;if(this.code.length!==n+3)return!1;for(var i=1;i<n+1;i++){var op=this.code[i],size=op.toLength();if(33!==size&&65!==size)return!1;if(minimal&&!op.isMinimal())return!1}return!0},Script.prototype.getMultisig=function(minimal){return this.isMultisig(minimal)?[this.getSmall(0),this.getSmall(-2)]:[-1,-1]},Script.prototype.isScripthash=function(){return 23===this.raw.length&&this.raw[0]===opcodes.OP_HASH160&&20===this.raw[1]&&this.raw[22]===opcodes.OP_EQUAL},Script.prototype.getScripthash=function(){return this.isScripthash()?this.getData(1):null},Script.prototype.isNulldata=function(minimal){if(0===this.code.length)return!1;if(this.getOp(0)!==opcodes.OP_RETURN)return!1;if(1===this.code.length)return!0;if(minimal&&this.raw.length>policy.MAX_OP_RETURN_BYTES)return!1;for(var i=1;i<this.code.length;i++){var op=this.code[i];if(-1===op.value)return!1;if(op.value>opcodes.OP_16)return!1;if(minimal&&!op.isMinimal())return!1}return!0},Script.prototype.getNulldata=function(minimal){if(!this.isNulldata(minimal))return null;for(var i=1;i<this.code.length;i++){var data=this.code[i].toPush();if(data)return data}return EMPTY_BUFFER},Script.prototype.isCommitment=function(){return this.raw.length>=38&&this.raw[0]===opcodes.OP_RETURN&&36===this.raw[1]&&2854332909===this.raw.readUInt32BE(2,!0)},Script.prototype.getCommitment=function(){return this.isCommitment()?this.raw.slice(6,38):null},Script.prototype.isProgram=function(){return!(this.raw.length<4||this.raw.length>42)&&((this.raw[0]===opcodes.OP_0||!(this.raw[0]<opcodes.OP_1||this.raw[0]>opcodes.OP_16))&&this.raw[1]+2===this.raw.length)},Script.prototype.getProgram=function(){if(!this.isProgram())return null;var version=this.getSmall(0),data=this.getData(1);return new Program(version,data)},Script.prototype.forWitness=function(){if(this.isProgram())return this.clone();var pk=this.getPubkey();if(pk){var hash=_hash.digest(pk);return Script.fromProgram(0,hash)}var pkh=this.getPubkeyhash();return pkh?Script.fromProgram(0,pkh):Script.fromProgram(0,this.sha256())},Script.prototype.isWitnessPubkeyhash=function(){return 22===this.raw.length&&this.raw[0]===opcodes.OP_0&&20===this.raw[1]},Script.prototype.getWitnessPubkeyhash=function(){return this.isWitnessPubkeyhash()?this.getData(1):null},Script.prototype.isWitnessScripthash=function(){return 34===this.raw.length&&this.raw[0]===opcodes.OP_0&&32===this.raw[1]},Script.prototype.getWitnessScripthash=function(){return this.isWitnessScripthash()?this.getData(1):null},Script.prototype.isUnspendable=function(){return this.raw.length>consensus.MAX_SCRIPT_SIZE||this.raw.length>0&&this.raw[0]===opcodes.OP_RETURN},Script.prototype.getInputType=function(){return this.isPubkeyInput()?scriptTypes.PUBKEY:this.isPubkeyhashInput()?scriptTypes.PUBKEYHASH:this.isScripthashInput()?scriptTypes.SCRIPTHASH:this.isMultisigInput()?scriptTypes.MULTISIG:scriptTypes.NONSTANDARD},Script.prototype.isUnknownInput=function(){return this.getInputType()===scriptTypes.NONSTANDARD},Script.prototype.isPubkeyInput=function(){if(1!==this.code.length)return!1;var size=this.getLength(0);return size>=9&&size<=73},Script.prototype.getPubkeyInput=function(){return this.isPubkeyInput()?this.getData(0):null},Script.prototype.isPubkeyhashInput=function(){if(2!==this.code.length)return!1;var sig=this.getLength(0),key=this.getLength(1);return sig>=9&&sig<=73&&(33===key||65===key)},Script.prototype.getPubkeyhashInput=function(){return this.isPubkeyhashInput()?[this.getData(0),this.getData(1)]:[null,null]},Script.prototype.isMultisigInput=function(){if(this.code.length<2)return!1;if(this.getOp(0)!==opcodes.OP_0)return!1;if(this.getOp(1)>opcodes.OP_PUSHDATA4)return!1;if(this.isScripthashInput())return!1;for(var i=1;i<this.code.length;i++){var size=this.getLength(i);if(size<9||size>73)return!1}return!0},Script.prototype.getMultisigInput=function(){if(!this.isMultisigInput())return null;for(var sigs=[],i=1;i<this.code.length;i++)sigs.push(this.getData(i));return sigs},Script.prototype.isScripthashInput=function(){if(this.code.length<1)return!1;var raw=this.getData(-1);if(!raw)return!1;if(0===raw.length)return!1;if(common.isSignatureEncoding(raw))return!1;if(common.isKeyEncoding(raw))return!1;var redeem=Script.fromRaw(raw);return!!redeem.isCode()&&(!redeem.isUnspendable()&&!!this.isPushOnly())},Script.prototype.getScripthashInput=function(){return this.isScripthashInput()?this.getData(-1):null},Script.prototype.getCoinbaseHeight=function(){return Script.getCoinbaseHeight(this.raw)},Script.getCoinbaseHeight=function(raw){if(0===raw.length)return-1;if(raw[0]>=opcodes.OP_1&&raw[0]<=opcodes.OP_16)return raw[0]-80;if(raw[0]>6)return-1;var op=Opcode.fromRaw(raw),num=op.toNum();return num?num.isNeg()?-1:op.equals(Opcode.fromNum(num))?num.toDouble():-1:1},Script.prototype.test=function(filter){var _iterator15=this.code,_isArray15=Array.isArray(_iterator15),_i15=0;for(_iterator15=_isArray15?_iterator15:_iterator15[Symbol.iterator]();;){var _ref15;if(_isArray15){if(_i15>=_iterator15.length)break;_ref15=_iterator15[_i15++]}else{if((_i15=_iterator15.next()).done)break;_ref15=_i15.value}var op=_ref15;if(-1===op.value)break;if(op.data&&0!==op.data.length&&filter.test(op.data))return!0}return!1},Script.prototype.isPushOnly=function(){var _iterator16=this.code,_isArray16=Array.isArray(_iterator16),_i16=0;for(_iterator16=_isArray16?_iterator16:_iterator16[Symbol.iterator]();;){var _ref16;if(_isArray16){if(_i16>=_iterator16.length)break;_ref16=_iterator16[_i16++]}else{if((_i16=_iterator16.next()).done)break;_ref16=_i16.value}var op=_ref16;if(-1===op.value)return!1;if(op.value>opcodes.OP_16)return!1}return!0},Script.prototype.getSigops=function(accurate){var total=0,lastOp=-1,_iterator17=this.code,_isArray17=Array.isArray(_iterator17),_i17=0;for(_iterator17=_isArray17?_iterator17:_iterator17[Symbol.iterator]();;){var _ref17;if(_isArray17){if(_i17>=_iterator17.length)break;_ref17=_iterator17[_i17++]}else{if((_i17=_iterator17.next()).done)break;_ref17=_i17.value}var op=_ref17;if(-1===op.value)break;switch(op.value){case opcodes.OP_CHECKSIG:case opcodes.OP_CHECKSIGVERIFY:total+=1;break;case opcodes.OP_CHECKMULTISIG:case opcodes.OP_CHECKMULTISIGVERIFY:accurate&&lastOp>=opcodes.OP_1&&lastOp<=opcodes.OP_16?total+=lastOp-80:total+=consensus.MAX_MULTISIG_PUBKEYS}lastOp=op.value}return total},Script.prototype.getScripthashSigops=function(input){if(!this.isScripthash())return this.getSigops(!0);var redeem=input.getRedeem();return redeem?redeem.getSigops(!0):0},Script.prototype.getWitnessSigops=function(input,witness){var program=this.getProgram();if(!program&&this.isScripthash()){var redeem=input.getRedeem();redeem&&(program=redeem.getProgram())}if(!program)return 0;if(0===program.version){if(20===program.data.length)return 1;if(32===program.data.length&&witness.items.length>0){return witness.getRedeem().getSigops(!0)}}return 0},Script.prototype.get=function(index){return index<0&&(index+=this.code.length),index<0||index>=this.code.length?null:this.code[index]},Script.prototype.pop=function(){return this.code.pop()||null},Script.prototype.shift=function(){return this.code.shift()||null},Script.prototype.remove=function(index){if(index<0&&(index+=this.code.length),index<0||index>=this.code.length)return null;var items=this.code.splice(index,1);return 0===items.length?null:items[0]},Script.prototype.set=function(index,op){return index<0&&(index+=this.code.length),assert(Opcode.isOpcode(op)),assert(index>=0&&index<=this.code.length),this.code[index]=op,this},Script.prototype.push=function(op){return assert(Opcode.isOpcode(op)),this.code.push(op),this},Script.prototype.unshift=function(op){return assert(Opcode.isOpcode(op)),this.code.unshift(op),this},Script.prototype.insert=function(index,op){return index<0&&(index+=this.code.length),assert(Opcode.isOpcode(op)),assert(index>=0&&index<=this.code.length),this.code.splice(index,0,op),this},Script.prototype.getOp=function(index){var op=this.get(index);return op?op.value:-1},Script.prototype.popOp=function(){var op=this.pop();return op?op.value:-1},Script.prototype.shiftOp=function(){var op=this.shift();return op?op.value:-1},Script.prototype.removeOp=function(index){var op=this.remove(index);return op?op.value:-1},Script.prototype.setOp=function(index,value){return this.set(index,Opcode.fromOp(value))},Script.prototype.pushOp=function(value){return this.push(Opcode.fromOp(value))},Script.prototype.unshiftOp=function(value){return this.unshift(Opcode.fromOp(value))},Script.prototype.insertOp=function(index,value){return this.insert(index,Opcode.fromOp(value))},Script.prototype.getData=function(index){var op=this.get(index);return op?op.data:null},Script.prototype.popData=function(){var op=this.pop();return op?op.data:null},Script.prototype.shiftData=function(){var op=this.shift();return op?op.data:null},Script.prototype.removeData=function(index){var op=this.remove(index);return op?op.data:null},Script.prototype.setData=function(index,data){return this.set(index,Opcode.fromData(data))},Script.prototype.pushData=function(data){return this.push(Opcode.fromData(data))},Script.prototype.unshiftData=function(data){return this.unshift(Opcode.fromData(data))},Script.prototype.insertData=function(index,data){return this.insert(index,Opcode.fromData(data))},Script.prototype.getLength=function(index){var op=this.get(index);return op?op.toLength():-1},Script.prototype.getPush=function(index){var op=this.get(index);return op?op.toPush():null},Script.prototype.popPush=function(){var op=this.pop();return op?op.toPush():null},Script.prototype.shiftPush=function(){var op=this.shift();return op?op.toPush():null},Script.prototype.removePush=function(index){var op=this.remove(index);return op?op.toPush():null},Script.prototype.setPush=function(index,data){return this.set(index,Opcode.fromPush(data))},Script.prototype.pushPush=function(data){return this.push(Opcode.fromPush(data))},Script.prototype.unshiftPush=function(data){return this.unshift(Opcode.fromPush(data))},Script.prototype.insertPush=function(index,data){return this.insert(index,Opcode.fromPush(data))},Script.prototype.getString=function(index,enc){var op=this.get(index);return op?op.toString(enc):null},Script.prototype.popString=function(enc){var op=this.pop();return op?op.toString(enc):null},Script.prototype.shiftString=function(enc){var op=this.shift();return op?op.toString(enc):null},Script.prototype.removeString=function(index,enc){var op=this.remove(index);return op?op.toString(enc):null},Script.prototype.setString=function(index,str,enc){return this.set(index,Opcode.fromString(str,enc))},Script.prototype.pushString=function(str,enc){return this.push(Opcode.fromString(str,enc))},Script.prototype.unshiftString=function(str,enc){return this.unshift(Opcode.fromString(str,enc))},Script.prototype.insertString=function(index,str,enc){return this.insert(index,Opcode.fromString(str,enc))},Script.prototype.getSmall=function(index){var op=this.get(index);return op?op.toSmall():-1},Script.prototype.popSmall=function(){var op=this.pop();return op?op.toSmall():-1},Script.prototype.shiftSmall=function(){var op=this.shift();return op?op.toSmall():-1},Script.prototype.removeSmall=function(index){var op=this.remove(index);return op?op.toSmall():-1},Script.prototype.setSmall=function(index,num){return this.set(index,Opcode.fromSmall(num))},Script.prototype.pushSmall=function(num){return this.push(Opcode.fromSmall(num))},Script.prototype.unshiftSmall=function(num){return this.unshift(Opcode.fromSmall(num))},Script.prototype.insertSmall=function(index,num){return this.insert(index,Opcode.fromSmall(num))},Script.prototype.getNum=function(index,minimal,limit){var op=this.get(index);return op?op.toNum(minimal,limit):null},Script.prototype.popNum=function(minimal,limit){var op=this.pop();return op?op.toNum(minimal,limit):null},Script.prototype.shiftNum=function(minimal,limit){var op=this.shift();return op?op.toNum(minimal,limit):null},Script.prototype.removeNum=function(index,minimal,limit){var op=this.remove(index);return op?op.toNum(minimal,limit):null},Script.prototype.setNum=function(index,num){return this.set(index,Opcode.fromNum(num))},Script.prototype.pushNum=function(num){return this.push(Opcode.fromNum(num))},Script.prototype.unshiftNum=function(num){return this.unshift(Opcode.fromNum(num))},Script.prototype.insertNum=function(index,num){return this.insert(index,Opcode.fromNum(num))},Script.prototype.getInt=function(index,minimal,limit){var op=this.get(index);return op?op.toInt(minimal,limit):-1},Script.prototype.popInt=function(minimal,limit){var op=this.pop();return op?op.toInt(minimal,limit):-1},Script.prototype.shiftInt=function(minimal,limit){var op=this.shift();return op?op.toInt(minimal,limit):-1},Script.prototype.removeInt=function(index,minimal,limit){var op=this.remove(index);return op?op.toInt(minimal,limit):-1},Script.prototype.setInt=function(index,num){return this.set(index,Opcode.fromInt(num))},Script.prototype.pushInt=function(num){return this.push(Opcode.fromInt(num))},Script.prototype.unshiftInt=function(num){return this.unshift(Opcode.fromInt(num))},Script.prototype.insertInt=function(index,num){return this.insert(index,Opcode.fromInt(num))},Script.prototype.getBool=function(index){var op=this.get(index);return!!op&&op.toBool()},Script.prototype.popBool=function(){var op=this.pop();return!!op&&op.toBool()},Script.prototype.shiftBool=function(){var op=this.shift();return!!op&&op.toBool()},Script.prototype.removeBool=function(index){var op=this.remove(index);return!!op&&op.toBool()},Script.prototype.setBool=function(index,value){return this.set(index,Opcode.fromBool(value))},Script.prototype.pushBool=function(value){return this.push(Opcode.fromBool(value))},Script.prototype.unshiftBool=function(value){return this.unshift(Opcode.fromBool(value))},Script.prototype.insertBool=function(index,value){return this.insert(index,Opcode.fromBool(value))},Script.prototype.getSym=function(index){var op=this.get(index);return op?op.toSymbol():null},Script.prototype.popSym=function(){var op=this.pop();return op?op.toSymbol():null},Script.prototype.shiftSym=function(){var op=this.shift();return op?op.toSymbol():null},Script.prototype.removeSym=function(index){var op=this.remove(index);return op?op.toSymbol():null},Script.prototype.setSym=function(index,symbol){return this.set(index,Opcode.fromSymbol(symbol))},Script.prototype.pushSym=function(symbol){return this.push(Opcode.fromSymbol(symbol))},Script.prototype.unshiftSym=function(symbol){return this.unshift(Opcode.fromSymbol(symbol))},Script.prototype.insertSym=function(index,symbol){return this.insert(index,Opcode.fromSymbol(symbol))},Script.prototype.fromString=function(code){if(assert("string"==typeof code),0===(code=code.trim()).length)return this;var items=code.split(/\s+/),bw=bio.write(),_iterator18=items,_isArray18=Array.isArray(_iterator18),_i18=0;for(_iterator18=_isArray18?_iterator18:_iterator18[Symbol.iterator]();;){var _ref18;if(_isArray18){if(_i18>=_iterator18.length)break;_ref18=_iterator18[_i18++]}else{if((_i18=_iterator18.next()).done)break;_ref18=_i18.value}var item=_ref18,symbol=item;32&symbol.charCodeAt(0)&&(symbol=symbol.toUpperCase()),/^OP_/.test(symbol)||(symbol="OP_"+symbol);var value=opcodes[symbol];if(null!=value)bw.writeU8(value);else{if("'"===item[0]){assert("'"===item[item.length-1],"Invalid string.");var str=item.slice(1,-1),op=Opcode.fromString(str);bw.writeBytes(op.toRaw());continue}if(/^-?\d+$/.test(item)){var num=ScriptNum.fromString(item,10),_op4=Opcode.fromNum(num);bw.writeBytes(_op4.toRaw());continue}assert(0===item.indexOf("0x"),"Unknown opcode.");var hex=item.substring(2),data=Buffer.from(hex,"hex");assert(data.length===hex.length/2,"Invalid hex string."),bw.writeBytes(data)}}return this.fromRaw(bw.render())},Script.fromString=function(code){return(new this).fromString(code)},Script.verify=function(input,output,tx,index,value,flags){if(null==flags&&(flags=Script.flags.STANDARD_VERIFY_FLAGS),flags&Script.flags.VERIFY_SIGPUSHONLY&&!input.isPushOnly())throw new ScriptError("SIG_PUSHONLY");flags&Script.flags.VERIFY_SIGHASH_FORKID&&(flags|=Script.flags.VERIFY_STRICTENC);var stack=new Stack;input.execute(stack,flags,tx,index,value,0);var copy=void 0;if(flags&Script.flags.VERIFY_P2SH&&(copy=stack.clone()),output.execute(stack,flags,tx,index,value,0),0===stack.length||!stack.getBool(-1))throw new ScriptError("EVAL_FALSE");if(flags&Script.flags.VERIFY_P2SH&&output.isScripthash()){if(!input.isPushOnly())throw new ScriptError("SIG_PUSHONLY");if(0===(stack=copy).length)throw new ScriptError("EVAL_FALSE");var raw=stack.pop();if(Script.fromRaw(raw).execute(stack,flags,tx,index,value,0),0===stack.length||!stack.getBool(-1))throw new ScriptError("EVAL_FALSE")}if(flags&Script.flags.VERIFY_CLEANSTACK&&(assert(0!=(flags&Script.flags.VERIFY_P2SH)),1!==stack.length))throw new ScriptError("CLEANSTACK")},Script.verifyProgram=function(witness,output,flags,tx,index,value){var program=output.getProgram();assert(program,"verifyProgram called on non-witness-program."),assert(0!=(flags&Script.flags.VERIFY_WITNESS));var stack=witness.toStack(),redeem=void 0;if(0===program.version){if(32===program.data.length){if(0===stack.length)throw new ScriptError("WITNESS_PROGRAM_WITNESS_EMPTY");var witnessScript=stack.pop();if(!_sha.digest(witnessScript).equals(program.data))throw new ScriptError("WITNESS_PROGRAM_MISMATCH");redeem=Script.fromRaw(witnessScript)}else{if(20!==program.data.length)throw new ScriptError("WITNESS_PROGRAM_WRONG_LENGTH");if(2!==stack.length)throw new ScriptError("WITNESS_PROGRAM_MISMATCH");redeem=Script.fromPubkeyhash(program.data)}for(var j=0;j<stack.length;j++)if(stack.get(j).length>consensus.MAX_SCRIPT_PUSH)throw new ScriptError("PUSH_SIZE");if(redeem.execute(stack,flags,tx,index,value,1),1!==stack.length||!stack.getBool(-1))throw new ScriptError("EVAL_FALSE")}else if(flags&Script.flags.VERIFY_DISCOURAGE_UPGRADABLE_WITNESS_PROGRAM)throw new ScriptError("DISCOURAGE_UPGRADABLE_WITNESS_PROGRAM")},Script.prototype.fromReader=function(br){return this.fromRaw(br.readVarBytes())},Script.prototype.fromRaw=function(data){var br=bio.read(data,!0);for(this.raw=data;br.left();)this.code.push(Opcode.fromReader(br));return this},Script.fromReader=function(br){return(new this).fromReader(br)},Script.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},Script.isScript=function(obj){return obj instanceof Script},_createClass(Script,[{key:"length",get:function(){return this.code.length},set:function(value){this.code.length=value}}]),Script}();Script.opcodes=common.opcodes,Script.opcodesByVal=common.opcodesByVal,Script.flags=common.flags,Script.hashType=common.hashType,Script.hashTypeByVal=common.hashTypeByVal,Script.types=common.types,Script.typesByVal=common.typesByVal;function validateKey(key,flags){if(assert(Buffer.isBuffer(key)),assert("number"==typeof flags),flags&Script.flags.VERIFY_STRICTENC&&!common.isKeyEncoding(key))throw new ScriptError("PUBKEYTYPE");if(flags&Script.flags.VERIFY_SIGHASH_FORKID&&flags&Script.flags.VERIFY_COMPRESSED_PUBKEYTYPE&&!common.isCompressedEncoding(key))throw new ScriptError("COMPRESSED_PUBKEYTYPE");return!0}function validateSignature(sig,flags){if(assert(Buffer.isBuffer(sig)),assert("number"==typeof flags),0===sig.length)return!0;if((flags&Script.flags.VERIFY_DERSIG||flags&Script.flags.VERIFY_LOW_S||flags&Script.flags.VERIFY_STRICTENC)&&!common.isSignatureEncoding(sig))throw new ScriptError("SIG_DER");if(flags&Script.flags.VERIFY_LOW_S&&!common.isLowDER(sig))throw new ScriptError("SIG_HIGH_S");if(flags&Script.flags.VERIFY_STRICTENC){if(!common.isHashType(sig))throw new ScriptError("SIG_HASHTYPE");var usesFORKID=sig[sig.length-1]&Script.hashType.SIGHASH_FORKID,FORKIDEnabled=flags&Script.flags.VERIFY_SIGHASH_FORKID;if(!FORKIDEnabled&&usesFORKID)throw new ScriptError("ILLEGAL_FORKID");if(FORKIDEnabled&&!usesFORKID)throw new ScriptError("MUST_USE_FORKID")}return!0}function checksig(msg,sig,key){return secp256k1.verify(msg,sig.slice(0,-1),key)}module.exports=Script}).call(this,require("buffer").Buffer)},{"../primitives/address":69,"../protocol/consensus":84,"../protocol/policy":89,"./common":91,"./opcode":93,"./program":94,"./scripterror":96,"./scriptnum":97,"./stack":99,assert:146,"bcrypto/lib/hash160":159,"bcrypto/lib/hash256":160,"bcrypto/lib/ripemd160":181,"bcrypto/lib/secp256k1":184,"bcrypto/lib/sha1":185,"bcrypto/lib/sha256":186,buffer:269,bufio:270}],96:[function(require,module,exports){"use strict";var ScriptError=function(_Error){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(ScriptError,_Error);function ScriptError(code,op,ip){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ScriptError);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Error.call(this));return _this.type="ScriptError",_this.code=code,_this.message=code,_this.op=-1,_this.ip=-1,"string"==typeof op?_this.message=op:op&&(_this.message=code+" (op="+op.toSymbol()+", ip="+ip+")",_this.op=op.value,_this.ip=ip),Error.captureStackTrace&&Error.captureStackTrace(_this,ScriptError),_this}return ScriptError}(Error);module.exports=ScriptError},{}],97:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),I64=require("n64").I64,ScriptError=require("./scripterror"),EMPTY_ARRAY=Buffer.alloc(0),ScriptNum=function(_I){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(ScriptNum,_I);function ScriptNum(num,base){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ScriptNum),function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_I.call(this,num,base))}return ScriptNum.prototype.getInt=function(){return this.lt(I64.INT32_MIN)?I64.LONG_MIN:this.gt(I64.INT32_MAX)?I64.LONG_MAX:this.toInt()},ScriptNum.prototype.toRaw=function(){var num=this;if(num.isZero())return EMPTY_ARRAY;var neg=!1;num.isNeg()&&(num=num.neg(),neg=!0);var size=num.byteLength(),offset=0;num.testn(8*size-1)&&(offset=1);var data=Buffer.allocUnsafe(size+offset);switch(size){case 8:data[7]=num.hi>>>24&255;case 7:data[6]=num.hi>>16&255;case 6:data[5]=num.hi>>8&255;case 5:data[4]=255&num.hi;case 4:data[3]=num.lo>>>24&255;case 3:data[2]=num.lo>>16&255;case 2:data[1]=num.lo>>8&255;case 1:data[0]=255&num.lo}return 128&data[size-1]?(assert(1===offset),assert(data.length===size+offset),data[size]=neg?128:0):neg?(assert(0===offset),assert(data.length===size),data[size-1]|=128):(assert(0===offset),assert(data.length===size)),data},ScriptNum.prototype.fromRaw=function(data){if(assert(Buffer.isBuffer(data)),0===data.length)return this;switch(data.length){case 8:this.hi|=data[7]<<24;case 7:this.hi|=data[6]<<16;case 6:this.hi|=data[5]<<8;case 5:this.hi|=data[4];case 4:this.lo|=data[3]<<24;case 3:this.lo|=data[2]<<16;case 2:this.lo|=data[1]<<8;case 1:this.lo|=data[0];break;default:for(var i=0;i<data.length;i++)this.orb(i,data[i])}return 128&data[data.length-1]&&(this.setn(8*data.length-1,0),this.ineg()),this},ScriptNum.prototype.encode=function(){return this.toRaw()},ScriptNum.prototype.decode=function(data,minimal,limit){if(assert(Buffer.isBuffer(data)),null!=limit&&data.length>limit)throw new ScriptError("UNKNOWN_ERROR","Script number overflow.");if(minimal&&!ScriptNum.isMinimal(data))throw new ScriptError("UNKNOWN_ERROR","Non-minimal script number.");return this.fromRaw(data)},ScriptNum.prototype.inspect=function(){return"<ScriptNum: "+this.toString(10)+">"},ScriptNum.isMinimal=function(data){if(assert(Buffer.isBuffer(data)),0===data.length)return!0;if(0==(127&data[data.length-1])){if(1===data.length)return!1;if(0==(128&data[data.length-2]))return!1}return!0},ScriptNum.decode=function(data,minimal,limit){return(new this).decode(data,minimal,limit)},ScriptNum.isScriptNum=function(obj){return obj instanceof ScriptNum},ScriptNum}(I64);module.exports=ScriptNum}).call(this,require("buffer").Buffer)},{"./scripterror":96,assert:146,buffer:269,n64:360}],98:[function(require,module,exports){(function(Buffer){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),secp256k1=require("bcrypto/lib/secp256k1"),SigCache=function(){function SigCache(size){_classCallCheck(this,SigCache),null==size&&(size=1e4),assert(size>>>0===size),this.size=size,this.keys=[],this.valid=new Map}return SigCache.prototype.resize=function(size){assert(size>>>0===size),this.size=size,this.keys.length=0,this.valid.clear()},SigCache.prototype.add=function(hash,sig,key){if(0!==this.size)if(this.valid.set(hash,new SigCacheEntry(sig,key)),this.keys.length>=this.size){var i=Math.floor(Math.random()*this.keys.length),k=this.keys[i];this.valid.delete(k),this.keys[i]=hash}else this.keys.push(hash)},SigCache.prototype.has=function(hash,sig,key){var entry=this.valid.get(hash);return!!entry&&entry.equals(sig,key)},SigCache.prototype.verify=function(msg,sig,key){if(0===this.size)return secp256k1.verify(msg,sig,key);var hash=msg.toString("hex");if(this.has(hash,sig,key))return!0;return!!secp256k1.verify(msg,sig,key)&&(this.add(hash,sig,key),!0)},SigCache}(),SigCacheEntry=function(){function SigCacheEntry(sig,key){_classCallCheck(this,SigCacheEntry),this.sig=Buffer.from(sig),this.key=Buffer.from(key)}return SigCacheEntry.prototype.equals=function(sig,key){return this.sig.equals(sig)&&this.key.equals(key)},SigCacheEntry}();module.exports=SigCache}).call(this,require("buffer").Buffer)},{assert:146,"bcrypto/lib/secp256k1":184,buffer:269}],99:[function(require,module,exports){(function(Buffer){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var assert=require("assert"),common=require("./common"),ScriptNum=require("./scriptnum"),Stack=function(){function Stack(items){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Stack),this.items=items||[]}return Stack.prototype[Symbol.iterator]=function(){return this.items[Symbol.iterator]()},Stack.prototype.values=function(){return this.items.values()},Stack.prototype.entries=function(){return this.items.entries()},Stack.prototype.inspect=function(){return"<Stack: "+this.toString()+">"},Stack.prototype.toString=function(){var out=[],_iterator=this.items,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var item=_ref;out.push(item.toString("hex"))}return out.join(" ")},Stack.prototype.toASM=function(decode){var out=[],_iterator2=this.items,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref2=_i2.value}var item=_ref2;out.push(common.toASM(item,decode))}return out.join(" ")},Stack.prototype.clone=function(){return new this.constructor(this.items.slice())},Stack.prototype.clear=function(){return this.items.length=0,this},Stack.prototype.get=function(index){return index<0&&(index+=this.items.length),index<0||index>=this.items.length?null:this.items[index]},Stack.prototype.pop=function(){return this.items.pop()||null},Stack.prototype.shift=function(){return this.items.shift()||null},Stack.prototype.remove=function(index){if(index<0&&(index+=this.items.length),index<0||index>=this.items.length)return null;var items=this.items.splice(index,1);return 0===items.length?null:items[0]},Stack.prototype.set=function(index,item){return index<0&&(index+=this.items.length),assert(Buffer.isBuffer(item)),assert(index>=0&&index<=this.items.length),this.items[index]=item,this},Stack.prototype.push=function(item){return assert(Buffer.isBuffer(item)),this.items.push(item),this},Stack.prototype.unshift=function(item){return assert(Buffer.isBuffer(item)),this.items.unshift(item),this},Stack.prototype.insert=function(index,item){return index<0&&(index+=this.items.length),assert(Buffer.isBuffer(item)),assert(index>=0&&index<=this.items.length),this.items.splice(index,0,item),this},Stack.prototype.erase=function(start,end){start<0&&(start=this.items.length+start),end<0&&(end=this.items.length+end),this.items.splice(start,end-start)},Stack.prototype.swap=function(i1,i2){i1<0&&(i1=this.items.length+i1),i2<0&&(i2=this.items.length+i2);var v1=this.items[i1],v2=this.items[i2];this.items[i1]=v2,this.items[i2]=v1},Stack.prototype.getData=function(index){return this.get(index)},Stack.prototype.popData=function(){return this.pop()},Stack.prototype.shiftData=function(){return this.shift()},Stack.prototype.removeData=function(index){return this.remove(index)},Stack.prototype.setData=function(index,data){return this.set(index,data)},Stack.prototype.pushData=function(data){return this.push(data)},Stack.prototype.unshiftData=function(data){return this.unshift(data)},Stack.prototype.insertData=function(index,data){return this.insert(index,data)},Stack.prototype.getLength=function(index){var item=this.get(index);return item?item.length:-1},Stack.prototype.getString=function(index,enc){var item=this.get(index);return item?Stack.toString(item,enc):null},Stack.prototype.popString=function(enc){var item=this.pop();return item?Stack.toString(item,enc):null},Stack.prototype.shiftString=function(enc){var item=this.shift();return item?Stack.toString(item,enc):null},Stack.prototype.removeString=function(index,enc){var item=this.remove(index);return item?Stack.toString(item,enc):null},Stack.prototype.setString=function(index,str,enc){return this.set(index,Stack.fromString(str,enc))},Stack.prototype.pushString=function(str,enc){return this.push(Stack.fromString(str,enc))},Stack.prototype.unshiftString=function(str,enc){return this.unshift(Stack.fromString(str,enc))},Stack.prototype.insertString=function(index,str,enc){return this.insert(index,Stack.fromString(str,enc))},Stack.prototype.getNum=function(index,minimal,limit){var item=this.get(index);return item?Stack.toNum(item,minimal,limit):null},Stack.prototype.popNum=function(minimal,limit){var item=this.pop();return item?Stack.toNum(item,minimal,limit):null},Stack.prototype.shiftNum=function(minimal,limit){var item=this.shift();return item?Stack.toNum(item,minimal,limit):null},Stack.prototype.removeNum=function(index,minimal,limit){var item=this.remove(index);return item?Stack.toNum(item,minimal,limit):null},Stack.prototype.setNum=function(index,num){return this.set(index,Stack.fromNum(num))},Stack.prototype.pushNum=function(num){return this.push(Stack.fromNum(num))},Stack.prototype.unshiftNum=function(num){return this.unshift(Stack.fromNum(num))},Stack.prototype.insertNum=function(index,num){return this.insert(index,Stack.fromNum(num))},Stack.prototype.getInt=function(index,minimal,limit){var item=this.get(index);return item?Stack.toInt(item,minimal,limit):-1},Stack.prototype.popInt=function(minimal,limit){var item=this.pop();return item?Stack.toInt(item,minimal,limit):-1},Stack.prototype.shiftInt=function(minimal,limit){var item=this.shift();return item?Stack.toInt(item,minimal,limit):-1},Stack.prototype.removeInt=function(index,minimal,limit){var item=this.remove(index);return item?Stack.toInt(item,minimal,limit):-1},Stack.prototype.setInt=function(index,num){return this.set(index,Stack.fromInt(num))},Stack.prototype.pushInt=function(num){return this.push(Stack.fromInt(num))},Stack.prototype.unshiftInt=function(num){return this.unshift(Stack.fromInt(num))},Stack.prototype.insertInt=function(index,num){return this.insert(index,Stack.fromInt(num))},Stack.prototype.getBool=function(index){var item=this.get(index);return!!item&&Stack.toBool(item)},Stack.prototype.popBool=function(){var item=this.pop();return!!item&&Stack.toBool(item)},Stack.prototype.shiftBool=function(){var item=this.shift();return!!item&&Stack.toBool(item)},Stack.prototype.removeBool=function(index){var item=this.remove(index);return!!item&&Stack.toBool(item)},Stack.prototype.setBool=function(index,value){return this.set(index,Stack.fromBool(value))},Stack.prototype.pushBool=function(value){return this.push(Stack.fromBool(value))},Stack.prototype.unshiftBool=function(value){return this.unshift(Stack.fromBool(value))},Stack.prototype.insertBool=function(index,value){return this.insert(index,Stack.fromBool(value))},Stack.isStack=function(obj){return obj instanceof Stack},Stack.toString=function(item,enc){return assert(Buffer.isBuffer(item)),item.toString(enc||"utf8")},Stack.fromString=function(str,enc){return assert("string"==typeof str),Buffer.from(str,enc||"utf8")},Stack.toNum=function(item,minimal,limit){return ScriptNum.decode(item,minimal,limit)},Stack.fromNum=function(num){return assert(ScriptNum.isScriptNum(num)),num.encode()},Stack.toInt=function(item,minimal,limit){return Stack.toNum(item,minimal,limit).getInt()},Stack.fromInt=function(int){if(assert("number"==typeof int),int>=-1&&int<=16)return common.small[int+1];var num=ScriptNum.fromNumber(int);return Stack.fromNum(num)},Stack.toBool=function(item){assert(Buffer.isBuffer(item));for(var i=0;i<item.length;i++)if(0!==item[i])return i!==item.length-1||128!==item[i];return!1},Stack.fromBool=function(value){return assert("boolean"==typeof value),Stack.fromInt(value?1:0)},_createClass(Stack,[{key:"length",get:function(){return this.items.length},set:function(value){this.items.length=value}}]),Stack}();module.exports=Stack}).call(this,require("buffer").Buffer)},{"./common":91,"./scriptnum":97,assert:146,buffer:269}],100:[function(require,module,exports){"use strict";exports.search=function(items,key,compare,insert){for(var start=0,end=items.length-1;start<=end;){var pos=start+end>>>1,cmp=compare(items[pos],key);if(0===cmp)return pos;cmp<0?start=pos+1:end=pos-1}return insert?start:-1},exports.insert=function(items,item,compare,uniq){var i=exports.search(items,item,compare,!0);return uniq&&i<items.length&&0===compare(items[i],item)?-1:(0===i?items.unshift(item):i===items.length?items.push(item):items.splice(i,0,item),i)},exports.remove=function(items,item,compare){var i=exports.search(items,item,compare,!1);return-1!==i&&(function(list,i){if(0===i)return void list.shift();var k=i+1;for(;k<list.length;)list[i++]=list[k++];list.pop()}(items,i),!0)}},{}],101:[function(require,module,exports){"use strict";var assert=require("assert");exports.encode=function(num,exp){assert(Number.isSafeInteger(num),"Invalid integer value.");var sign="";num<0&&(num=-num,sign="-");var mult=pow10(exp),lo=num%mult,hi=(num-lo)/mult;for(lo=lo.toString(10),hi=hi.toString(10);lo.length<exp;)lo="0"+lo;return lo=lo.replace(/0+$/,""),assert(lo.length<=exp,"Invalid integer value."),0===lo.length&&(lo="0"),0===exp?""+sign+hi:""+sign+hi+"."+lo},exports.decode=function(str,exp){assert("string"==typeof str),assert(str.length<=32,"Fixed number string too large.");var sign=1;str.length>0&&"-"===str[0]&&(str=str.substring(1),sign=-1);var hi=str,lo="0",index=str.indexOf(".");for(-1!==index&&(hi=str.substring(0,index),lo=str.substring(index+1)),hi=hi.replace(/^0+/,""),lo=lo.replace(/0+$/,""),assert(hi.length<=16-exp,"Fixed number string exceeds 2^53-1."),assert(lo.length<=exp,"Too many decimal places in fixed number string."),0===hi.length&&(hi="0");lo.length<exp;)lo+="0";0===lo.length&&(lo="0"),assert(/^\d+$/.test(hi)&&/^\d+$/.test(lo),"Non-numeric characters in fixed number string."),hi=parseInt(hi,10),lo=parseInt(lo,10);var mult=pow10(exp),maxLo=function(mod){switch(mod){case 1:return 0;case 10:return 1;case 100:return 91;case 1e3:case 1e4:return 991;case 1e5:return 40991;case 1e6:return 740991;case 1e7:return 4740991;case 1e8:return 54740991}throw new Error("Exponent is too large.")}(mult),maxHi=function(div){switch(div){case 1:return 9007199254740991;case 10:return 900719925474099;case 100:return 90071992547409;case 1e3:return 9007199254740;case 1e4:return 900719925474;case 1e5:return 90071992547;case 1e6:return 9007199254;case 1e7:return 900719925;case 1e8:return 90071992}throw new Error("Exponent is too large.")}(mult);return assert(hi<maxHi||hi===maxHi&&lo<=maxLo,"Fixed number string exceeds 2^53-1."),sign*(hi*mult+lo)},exports.toFloat=function(num,exp){return parseFloat(exports.encode(num,exp))},exports.fromFloat=function(num,exp){return assert("number"==typeof num&&isFinite(num)),assert(Number.isSafeInteger(exp)),exports.decode(num.toFixed(exp),exp)};function pow10(exp){switch(exp){case 0:return 1;case 1:return 10;case 2:return 100;case 3:return 1e3;case 4:return 1e4;case 5:return 1e5;case 6:return 1e6;case 7:return 1e7;case 8:return 1e8}throw new Error("Exponent is too large.")}},{assert:146}],102:[function(require,module,exports){"use strict";var assert=require("assert"),Heap=function(){function Heap(compare){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Heap),this.compare=comparator,this.items=[],compare&&this.set(compare)}return Heap.prototype.init=function(){var n=this.items.length;if(!(n<=1))for(var i=(n/2|0)-1;i>=0;i--)this.down(i,n)},Heap.prototype.size=function(){return this.items.length},Heap.prototype.set=function(compare){assert("function"==typeof compare,"Comparator must be a function."),this.compare=compare},Heap.prototype.insert=function(item){return this.items.push(item),this.up(this.items.length-1),this.items.length},Heap.prototype.shift=function(){if(0===this.items.length)return null;var n=this.items.length-1;return this.swap(0,n),this.down(0,n),this.items.pop()},Heap.prototype.remove=function(i){if(0===this.items.length)return null;var n=this.items.length-1;return i<0||i>n?null:(n!==i&&(this.swap(i,n),this.down(i,n),this.up(i)),this.items.pop())},Heap.prototype.swap=function(a,b){var x=this.items[a],y=this.items[b];this.items[a]=y,this.items[b]=x},Heap.prototype.less=function(i,j){return this.compare(this.items[i],this.items[j])<0},Heap.prototype.down=function(i,n){for(;;){var l=2*i+1;if(assert(l>=0),l<0||l>=n)break;var j=l,r=l+1;if(r<n&&!this.less(l,r)&&(j=r),!this.less(j,i))break;this.swap(i,j),i=j}},Heap.prototype.up=function(i){for(;;){var j=(i-1)/2|0;if(assert(j>=0),j<0||j===i)break;if(!this.less(i,j))break;this.swap(j,i),i=j}},Heap.prototype.toArray=function(){var heap=new Heap,result=[];for(heap.compare=this.compare,heap.items=this.items.slice();heap.size()>0;)result.push(heap.shift());return result},Heap.fromArray=function(compare,items){var heap=new Heap;return heap.set(compare),heap.items=items,heap.init(),heap},Heap}();function comparator(a,b){throw new Error("No heap comparator set.")}module.exports=Heap},{assert:146}],103:[function(require,module,exports){"use strict";exports.binary=require("./binary"),exports.fixed=require("./fixed"),exports.Heap=require("./heap"),exports.List=require("./list"),exports.LRU=require("./lru"),exports.util=require("./util")},{"./binary":100,"./fixed":101,"./heap":102,"./list":104,"./lru":105,"./util":106}],104:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),List=function(){function List(){_classCallCheck(this,List),this.head=null,this.tail=null,this.size=0}return List.prototype.reset=function(){var item=void 0,next=void 0;for(item=this.head;item;item=next)next=item.next,item.prev=null,item.next=null;assert(!item),this.head=null,this.tail=null,this.size=0},List.prototype.shift=function(){var item=this.head;return item?(this.remove(item),item):null},List.prototype.unshift=function(item){return this.insert(null,item)},List.prototype.push=function(item){return this.insert(this.tail,item)},List.prototype.pop=function(){var item=this.tail;return item?(this.remove(item),item):null},List.prototype.insert=function(ref,item){return!item.prev&&!item.next&&item!==this.head&&(assert(!item.prev),assert(!item.next),null==ref?(this.head?(this.head.prev=item,item.next=this.head,this.head=item):(this.head=item,this.tail=item),this.size+=1,!0):(item.next=ref.next,item.prev=ref,ref.next=item,ref===this.tail&&(this.tail=item),this.size+=1,!0))},List.prototype.remove=function(item){return!(!item.prev&&!item.next&&item!==this.head)&&(item.prev&&(item.prev.next=item.next),item.next&&(item.next.prev=item.prev),item===this.head&&(this.head=item.next),item===this.tail&&(this.tail=item.prev||this.head),this.head||assert(!this.tail),this.tail||assert(!this.head),item.prev=null,item.next=null,this.size-=1,!0)},List.prototype.replace=function(ref,item){ref.prev&&(ref.prev.next=item),ref.next&&(ref.next.prev=item),item.prev=ref.prev,item.next=ref.next,ref.next=null,ref.prev=null,this.head===ref&&(this.head=item),this.tail===ref&&(this.tail=item)},List.prototype.slice=function(total){null==total&&(total=-1);for(var items=[],next=null,item=this.head;item&&(next=item.next,item.prev=null,item.next=null,this.size-=1,items.push(item),items.length!==total);item=next);return next?(this.head=next,next.prev=null):(this.head=null,this.tail=null),items},List.prototype.toArray=function(){for(var items=[],item=this.head;item;item=item.next)items.push(item);return items},List}(),ListItem=function ListItem(value){_classCallCheck(this,ListItem),this.next=null,this.prev=null,this.value=value};(exports=List).List=List,exports.ListItem=ListItem,exports.Item=ListItem,module.exports=exports},{assert:146}],105:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),LRU=function(){function LRU(capacity,getSize){_classCallCheck(this,LRU),this.map=new Map,this.size=0,this.items=0,this.head=null,this.tail=null,this.pending=null,assert("number"==typeof capacity,"Capacity must be a number."),assert(capacity>=0,"Capacity cannot be negative."),assert(!getSize||"function"==typeof getSize,"Bad size callback."),this.capacity=capacity,this.getSize=getSize}return LRU.prototype._getSize=function(item){if(this.getSize){return 120+Math.floor(1.375*item.key.length)+this.getSize(item.value)}return 1},LRU.prototype._compact=function(){if(!(this.size<=this.capacity)){var item=null,next=null;for(item=this.head;item&&!(this.size<=this.capacity);item=next)this.size-=this._getSize(item),this.items-=1,this.map.delete(item.key),next=item.next,item.prev=null,item.next=null;if(!item)return this.head=null,void(this.tail=null);this.head=item,item.prev=null}},LRU.prototype.reset=function(){var item=void 0,next=void 0;for(item=this.head;item;item=next)this.map.delete(item.key),this.items-=1,next=item.next,item.prev=null,item.next=null;assert(!item),this.size=0,this.head=null,this.tail=null},LRU.prototype.set=function(key,value){if(0!==this.capacity){var item=this.map.get(key);if(item)return this.size-=this._getSize(item),item.value=value,this.size+=this._getSize(item),this._removeList(item),this._appendList(item),void this._compact();item=new LRUItem(key,value),this.map.set(key,item),this._appendList(item),this.size+=this._getSize(item),this.items+=1,this._compact()}},LRU.prototype.get=function(key){if(0===this.capacity)return null;var item=this.map.get(key);return item?(this._removeList(item),this._appendList(item),item.value):null},LRU.prototype.has=function(key){return 0!==this.capacity&&this.map.has(key)},LRU.prototype.remove=function(key){if(0===this.capacity)return!1;var item=this.map.get(key);return!!item&&(this.size-=this._getSize(item),this.items-=1,this.map.delete(key),this._removeList(item),!0)},LRU.prototype._prependList=function(item){this._insertList(null,item)},LRU.prototype._appendList=function(item){this._insertList(this.tail,item)},LRU.prototype._insertList=function(ref,item){assert(!item.next),assert(!item.prev),null!=ref?(item.next=ref.next,item.prev=ref,ref.next=item,ref===this.tail&&(this.tail=item)):this.head?(this.head.prev=item,item.next=this.head,this.head=item):(this.head=item,this.tail=item)},LRU.prototype._removeList=function(item){item.prev&&(item.prev.next=item.next),item.next&&(item.next.prev=item.prev),item===this.head&&(this.head=item.next),item===this.tail&&(this.tail=item.prev||this.head),this.head||assert(!this.tail),this.tail||assert(!this.head),item.prev=null,item.next=null},LRU.prototype.keys=function(){for(var items=[],item=this.head;item;item=item.next)item===this.head&&assert(!item.prev),item.prev||assert(item===this.head),item.next||assert(item===this.tail),items.push(item.key);return items},LRU.prototype.values=function(){for(var items=[],item=this.head;item;item=item.next)items.push(item.value);return items},LRU.prototype.toArray=function(){for(var items=[],item=this.head;item;item=item.next)items.push(item);return items},LRU.prototype.batch=function(){return new LRUBatch(this)},LRU.prototype.start=function(){assert(!this.pending),this.pending=this.batch()},LRU.prototype.clear=function(){assert(this.pending),this.pending.clear()},LRU.prototype.drop=function(){assert(this.pending),this.pending=null},LRU.prototype.commit=function(){assert(this.pending),this.pending.commit(),this.pending=null},LRU.prototype.push=function(key,value){assert(this.pending),0!==this.capacity&&this.pending.set(key,value)},LRU.prototype.unpush=function(key){assert(this.pending),0!==this.capacity&&this.pending.remove(key)},LRU}(),LRUItem=function LRUItem(key,value){_classCallCheck(this,LRUItem),this.key=key,this.value=value,this.next=null,this.prev=null},LRUBatch=function(){function LRUBatch(lru){_classCallCheck(this,LRUBatch),this.lru=lru,this.ops=[]}return LRUBatch.prototype.set=function(key,value){this.ops.push(new LRUOp(!1,key,value))},LRUBatch.prototype.remove=function(key){this.ops.push(new LRUOp(!0,key,null))},LRUBatch.prototype.clear=function(){this.ops.length=0},LRUBatch.prototype.commit=function(){var _iterator=this.ops,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var op=_ref;op.remove?this.lru.remove(op.key):this.lru.set(op.key,op.value)}this.ops.length=0},LRUBatch}(),LRUOp=function LRUOp(remove,key,value){_classCallCheck(this,LRUOp),this.remove=remove,this.key=key,this.value=value};module.exports=LRU},{assert:146}],106:[function(require,module,exports){(function(process){"use strict";var assert=require("assert"),util=exports;util.bench=function(time){if(!process.hrtime){var now=Date.now();if(time){return now-(1e3*time[0]+time[1]/1e6)}var ms=now%1e3;return[(now-ms)/1e3,1e6*ms]}if(time){var _process$hrtime=process.hrtime(time);return 1e3*_process$hrtime[0]+_process$hrtime[1]/1e6}return process.hrtime()},util.now=function(){return Math.floor(Date.now()/1e3)},util.ms=function(){return Date.now()},util.date=function(time){return null==time&&(time=util.now()),new Date(1e3*time).toISOString().slice(0,-5)+"Z"},util.time=function(date){return null==date?util.now():new Date(date)/1e3|0},util.revHex=function(str){assert("string"==typeof str),assert(0==(1&str.length));for(var out="",i=str.length-2;i>=0;i-=2)out+=str[i]+str[i+1];return out}}).call(this,require("_process"))},{_process:374,assert:146}],107:[function(require,module,exports){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}var assert=require("assert"),bio=require("bufio"),binary=require("../utils/binary"),Path=require("./path"),common=require("./common"),Script=require("../script/script"),WalletKey=require("./walletkey"),HDPublicKey=require("../hd/hd").HDPublicKey,Account=function(){function Account(wdb,options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Account),assert(wdb,"Database is required."),this.wdb=wdb,this.network=wdb.network,this.wid=0,this.id=null,this.accountIndex=0,this.name=null,this.initialized=!1,this.witness=!0===wdb.options.witness,this.watchOnly=!1,this.type=Account.types.PUBKEYHASH,this.m=1,this.n=1,this.receiveDepth=0,this.changeDepth=0,this.nestedDepth=0,this.lookahead=10,this.accountKey=null,this.keys=[],options&&this.fromOptions(options)}return Account.prototype.fromOptions=function(options){if(assert(options,"Options are required."),assert(options.wid>>>0===options.wid),assert(common.isName(options.id),"Bad Wallet ID."),assert(HDPublicKey.isHDPublicKey(options.accountKey),"Account key is required."),assert(options.accountIndex>>>0===options.accountIndex,"Account index is required."),this.wid=options.wid,this.id=options.id,null!=options.accountIndex&&(assert(options.accountIndex>>>0===options.accountIndex),this.accountIndex=options.accountIndex),null!=options.name&&(assert(common.isName(options.name),"Bad account name."),this.name=options.name),null!=options.initialized&&(assert("boolean"==typeof options.initialized),this.initialized=options.initialized),null!=options.witness&&(assert("boolean"==typeof options.witness),this.witness=options.witness),null!=options.watchOnly&&(assert("boolean"==typeof options.watchOnly),this.watchOnly=options.watchOnly),null!=options.type&&("string"==typeof options.type?(this.type=Account.types[options.type.toUpperCase()],assert(null!=this.type)):(assert("number"==typeof options.type),this.type=options.type,assert(Account.typesByVal[this.type]))),null!=options.m&&(assert((255&options.m)===options.m),this.m=options.m),null!=options.n&&(assert((255&options.n)===options.n),this.n=options.n),null!=options.receiveDepth&&(assert(options.receiveDepth>>>0===options.receiveDepth),this.receiveDepth=options.receiveDepth),null!=options.changeDepth&&(assert(options.changeDepth>>>0===options.changeDepth),this.changeDepth=options.changeDepth),null!=options.nestedDepth&&(assert(options.nestedDepth>>>0===options.nestedDepth),this.nestedDepth=options.nestedDepth),null!=options.lookahead&&(assert(options.lookahead>>>0===options.lookahead),assert(options.lookahead>=0),assert(options.lookahead<=Account.MAX_LOOKAHEAD),this.lookahead=options.lookahead),this.accountKey=options.accountKey,this.n>1&&(this.type=Account.types.MULTISIG),this.name||(this.name=this.accountIndex.toString(10)),this.m<1||this.m>this.n)throw new Error("m ranges between 1 and n");if(options.keys){assert(Array.isArray(options.keys));var _iterator=options.keys,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var key=_ref;this.pushKey(key)}}return this},Account.fromOptions=function(wdb,options){return new this(wdb).fromOptions(options)},Account.prototype.init=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(b){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(this.keys.length===this.n-1){_context.next=4;break}return assert(!this.initialized),this.save(b),_context.abrupt("return");case 4:return assert(0===this.receiveDepth),assert(0===this.changeDepth),assert(0===this.nestedDepth),this.initialized=!0,_context.next=10,this.initDepth(b);case 10:case"end":return _context.stop()}},_callee,this)}));return function(_x){return _ref2.apply(this,arguments)}}(),Account.prototype.pushKey=function(key){if("string"==typeof key&&(key=HDPublicKey.fromBase58(key,this.network)),!HDPublicKey.isHDPublicKey(key))throw new Error("Must add HD keys to wallet.");if(!key.isAccount())throw new Error("Must add HD account keys to BIP44 wallet.");if(this.type!==Account.types.MULTISIG)throw new Error("Cannot add keys to non-multisig wallet.");if(key.equals(this.accountKey))throw new Error("Cannot add own key.");if(-1===binary.insert(this.keys,key,cmp,!0))return!1;if(this.keys.length>this.n-1)throw binary.remove(this.keys,key,cmp),new Error("Cannot add more keys.");return!0},Account.prototype.spliceKey=function(key){if("string"==typeof key&&(key=HDPublicKey.fromBase58(key,this.network)),!HDPublicKey.isHDPublicKey(key))throw new Error("Must add HD keys to wallet.");if(!key.isAccount())throw new Error("Must add HD account keys to BIP44 wallet.");if(this.type!==Account.types.MULTISIG)throw new Error("Cannot remove keys from non-multisig wallet.");if(this.keys.length===this.n-1)throw new Error("Cannot remove key.");return binary.remove(this.keys,key,cmp)},Account.prototype.addSharedKey=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(b,key){var result;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return result=this.pushKey(key),_context2.next=3,this.hasDuplicate();case 3:if(!_context2.sent){_context2.next=6;break}throw this.spliceKey(key),new Error("Cannot add a key from another account.");case 6:return _context2.next=8,this.init(b);case 8:return _context2.abrupt("return",result);case 9:case"end":return _context2.stop()}},_callee2,this)}));return function(_x2,_x3){return _ref3.apply(this,arguments)}}(),Account.prototype.hasDuplicate=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var ring,hash;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(this.keys.length===this.n-1){_context3.next=2;break}return _context3.abrupt("return",!1);case 2:return ring=this.deriveReceive(0),hash=ring.getScriptHash("hex"),_context3.abrupt("return",this.wdb.hasPath(this.wid,hash));case 5:case"end":return _context3.stop()}},_callee3,this)}));return function(){return _ref4.apply(this,arguments)}}(),Account.prototype.removeSharedKey=function(b,key){return!!this.spliceKey(key)&&(this.save(b),!0)},Account.prototype.createReceive=function(){return this.createKey(0)},Account.prototype.createChange=function(){return this.createKey(1)},Account.prototype.createNested=function(){return this.createKey(2)},Account.prototype.createKey=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(b,branch){var key,lookahead;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:key=void 0,lookahead=void 0,_context4.t0=branch,_context4.next=0===_context4.t0?4:1===_context4.t0?11:2===_context4.t0?18:25;break;case 4:return key=this.deriveReceive(this.receiveDepth),lookahead=this.deriveReceive(this.receiveDepth+this.lookahead),_context4.next=8,this.saveKey(b,lookahead);case 8:return this.receiveDepth+=1,this.receive=key,_context4.abrupt("break",26);case 11:return key=this.deriveChange(this.changeDepth),lookahead=this.deriveReceive(this.changeDepth+this.lookahead),_context4.next=15,this.saveKey(b,lookahead);case 15:return this.changeDepth+=1,this.change=key,_context4.abrupt("break",26);case 18:return key=this.deriveNested(this.nestedDepth),lookahead=this.deriveNested(this.nestedDepth+this.lookahead),_context4.next=22,this.saveKey(b,lookahead);case 22:return this.nestedDepth+=1,this.nested=key,_context4.abrupt("break",26);case 25:throw new Error("Bad branch: "+branch+".");case 26:return this.save(b),_context4.abrupt("return",key);case 28:case"end":return _context4.stop()}},_callee4,this)}));return function(_x4,_x5){return _ref5.apply(this,arguments)}}(),Account.prototype.deriveReceive=function(index,master){return this.deriveKey(0,index,master)},Account.prototype.deriveChange=function(index,master){return this.deriveKey(1,index,master)},Account.prototype.deriveNested=function(index,master){if(!this.witness)throw new Error("Cannot derive nested on non-witness account.");return this.deriveKey(2,index,master)},Account.prototype.derivePath=function(path,master){switch(path.keyType){case Path.types.HD:return this.deriveKey(path.branch,path.index,master);case Path.types.KEY:assert(this.type===Account.types.PUBKEYHASH);var data=path.data;return path.encrypted&&!(data=master.decipher(data,path.hash))?null:WalletKey.fromImport(this,data);case Path.types.ADDRESS:return null;default:throw new Error("Bad key type.")}},Account.prototype.deriveKey=function(branch,index,master){assert("number"==typeof branch);var keys=[],key=void 0;if(master&&master.key&&!this.watchOnly){var type=this.network.keyPrefix.coinType;key=(key=master.key.deriveAccount(44,type,this.accountIndex)).derive(branch).derive(index)}else key=this.accountKey.derive(branch).derive(index);var ring=WalletKey.fromHD(this,key,branch,index);switch(this.type){case Account.types.PUBKEYHASH:break;case Account.types.MULTISIG:keys.push(key.publicKey);var _iterator2=this.keys,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref6;if(_isArray2){if(_i2>=_iterator2.length)break;_ref6=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref6=_i2.value}var _key=_ref6.derive(branch).derive(index);keys.push(_key.publicKey)}ring.script=Script.fromMultisig(this.m,this.n,keys)}return ring},Account.prototype.save=function(b){return this.wdb.saveAccount(b,this)},Account.prototype.saveKey=function(b,ring){return this.wdb.saveKey(b,this.wid,ring)},Account.prototype.savePath=function(b,path){return this.wdb.savePath(b,this.wid,path)},Account.prototype.initDepth=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(b){var i,key,_i3,_key2,_i4,_key3;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:this.receiveDepth=1,i=0;case 2:if(!(i<=this.lookahead)){_context5.next=9;break}return key=this.deriveReceive(i),_context5.next=6,this.saveKey(b,key);case 6:i++,_context5.next=2;break;case 9:this.changeDepth=1,_i3=0;case 11:if(!(_i3<=this.lookahead)){_context5.next=18;break}return _key2=this.deriveChange(_i3),_context5.next=15,this.saveKey(b,_key2);case 15:_i3++,_context5.next=11;break;case 18:if(!this.witness){_context5.next=28;break}this.nestedDepth=1,_i4=0;case 21:if(!(_i4<=this.lookahead)){_context5.next=28;break}return _key3=this.deriveNested(_i4),_context5.next=25,this.saveKey(b,_key3);case 25:_i4++,_context5.next=21;break;case 28:this.save(b);case 29:case"end":return _context5.stop()}},_callee5,this)}));return function(_x6){return _ref7.apply(this,arguments)}}(),Account.prototype.syncDepth=function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(b,receive,change,nested){var derived,result,depth,i,key,_depth,_i5,_key4,_depth2,_i6,_key5;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(derived=!1,result=null,!(receive>this.receiveDepth)){_context6.next=16;break}depth=this.receiveDepth+this.lookahead,assert(receive<=depth+1),i=depth;case 6:if(!(i<receive+this.lookahead)){_context6.next=14;break}return key=this.deriveReceive(i),_context6.next=10,this.saveKey(b,key);case 10:result=key;case 11:i++,_context6.next=6;break;case 14:this.receiveDepth=receive,derived=!0;case 16:if(!(change>this.changeDepth)){_context6.next=29;break}_depth=this.changeDepth+this.lookahead,assert(change<=_depth+1),_i5=_depth;case 20:if(!(_i5<change+this.lookahead)){_context6.next=27;break}return _key4=this.deriveChange(_i5),_context6.next=24,this.saveKey(b,_key4);case 24:_i5++,_context6.next=20;break;case 27:this.changeDepth=change,derived=!0;case 29:if(!(this.witness&&nested>this.nestedDepth)){_context6.next=44;break}_depth2=this.nestedDepth+this.lookahead,assert(nested<=_depth2+1),_i6=_depth2;case 33:if(!(_i6<nested+this.lookahead)){_context6.next=41;break}return _key5=this.deriveNested(_i6),_context6.next=37,this.saveKey(b,_key5);case 37:result=_key5;case 38:_i6++,_context6.next=33;break;case 41:this.nestedDepth=nested,derived=!0,result=this.nested;case 44:return derived&&this.save(b),_context6.abrupt("return",result);case 46:case"end":return _context6.stop()}},_callee6,this)}));return function(_x7,_x8,_x9,_x10){return _ref8.apply(this,arguments)}}(),Account.prototype.setLookahead=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(b,lookahead){var diff,depth,target,i,key,_depth3,_target,_i7,_key6,_depth4,_target2,_i8,_key7;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(lookahead!==this.lookahead){_context7.next=2;break}return _context7.abrupt("return");case 2:if(!(lookahead<this.lookahead)){_context7.next=10;break}return diff=this.lookahead-lookahead,this.receiveDepth+=diff,this.changeDepth+=diff,this.witness&&(this.nestedDepth+=diff),this.lookahead=lookahead,this.save(b),_context7.abrupt("return");case 10:depth=this.receiveDepth+this.lookahead,target=this.receiveDepth+lookahead,i=depth;case 13:if(!(i<target)){_context7.next=20;break}return key=this.deriveReceive(i),_context7.next=17,this.saveKey(b,key);case 17:i++,_context7.next=13;break;case 20:_depth3=this.changeDepth+this.lookahead,_target=this.changeDepth+lookahead,_i7=_depth3;case 23:if(!(_i7<_target)){_context7.next=30;break}return _key6=this.deriveChange(_i7),_context7.next=27,this.saveKey(b,_key6);case 27:_i7++,_context7.next=23;break;case 30:if(!this.witness){_context7.next=41;break}_depth4=this.nestedDepth+this.lookahead,_target2=this.nestedDepth+lookahead,_i8=_depth4;case 34:if(!(_i8<_target2)){_context7.next=41;break}return _key7=this.deriveNested(_i8),_context7.next=38,this.saveKey(b,_key7);case 38:_i8++,_context7.next=34;break;case 41:this.lookahead=lookahead,this.save(b);case 43:case"end":return _context7.stop()}},_callee7,this)}));return function(_x11,_x12){return _ref9.apply(this,arguments)}}(),Account.prototype.receiveKey=function(){return this.initialized?this.deriveReceive(this.receiveDepth-1):null},Account.prototype.changeKey=function(){return this.initialized?this.deriveChange(this.changeDepth-1):null},Account.prototype.nestedKey=function(){return this.initialized&&this.witness?this.deriveNested(this.nestedDepth-1):null},Account.prototype.receiveAddress=function(){var key=this.receiveKey();return key?key.getAddress():null},Account.prototype.changeAddress=function(){var key=this.changeKey();return key?key.getAddress():null},Account.prototype.nestedAddress=function(){var key=this.nestedKey();return key?key.getAddress():null},Account.prototype.inspect=function(){var _this=this,receive=this.receiveAddress(),change=this.changeAddress(),nested=this.nestedAddress();return{id:this.id,wid:this.wid,name:this.name,network:this.network.type,initialized:this.initialized,witness:this.witness,watchOnly:this.watchOnly,type:Account.typesByVal[this.type].toLowerCase(),m:this.m,n:this.n,accountIndex:this.accountIndex,receiveDepth:this.receiveDepth,changeDepth:this.changeDepth,nestedDepth:this.nestedDepth,lookahead:this.lookahead,receiveAddress:receive?receive.toString(this.network):null,changeAddress:change?change.toString(this.network):null,nestedAddress:nested?nested.toString(this.network):null,accountKey:this.accountKey.toBase58(this.network),keys:this.keys.map(function(key){return key.toBase58(_this.network)})}},Account.prototype.toJSON=function(balance){var _this2=this,receive=this.receiveAddress(),change=this.changeAddress(),nested=this.nestedAddress();return{name:this.name,initialized:this.initialized,witness:this.witness,watchOnly:this.watchOnly,type:Account.typesByVal[this.type].toLowerCase(),m:this.m,n:this.n,accountIndex:this.accountIndex,receiveDepth:this.receiveDepth,changeDepth:this.changeDepth,nestedDepth:this.nestedDepth,lookahead:this.lookahead,receiveAddress:receive?receive.toString(this.network):null,changeAddress:change?change.toString(this.network):null,nestedAddress:nested?nested.toString(this.network):null,accountKey:this.accountKey.toBase58(this.network),keys:this.keys.map(function(key){return key.toBase58(_this2.network)}),balance:balance?balance.toJSON(!0):null}},Account.prototype.getSize=function(){var size=0;return size+=92,size+=74*this.keys.length},Account.prototype.toRaw=function(){var size=this.getSize(),bw=bio.write(size),flags=0;this.initialized&&(flags|=1),this.witness&&(flags|=2),bw.writeU8(flags),bw.writeU8(this.type),bw.writeU8(this.m),bw.writeU8(this.n),bw.writeU32(this.receiveDepth),bw.writeU32(this.changeDepth),bw.writeU32(this.nestedDepth),bw.writeU8(this.lookahead),writeKey(this.accountKey,bw),bw.writeU8(this.keys.length);var _iterator3=this.keys,_isArray3=Array.isArray(_iterator3),_i9=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref10;if(_isArray3){if(_i9>=_iterator3.length)break;_ref10=_iterator3[_i9++]}else{if((_i9=_iterator3.next()).done)break;_ref10=_i9.value}writeKey(_ref10,bw)}return bw.render()},Account.prototype.fromRaw=function(data){var br=bio.read(data),flags=br.readU8();this.initialized=0!=(1&flags),this.witness=0!=(2&flags),this.type=br.readU8(),this.m=br.readU8(),this.n=br.readU8(),this.receiveDepth=br.readU32(),this.changeDepth=br.readU32(),this.nestedDepth=br.readU32(),this.lookahead=br.readU8(),this.accountKey=readKey(br),assert(this.type<Account.typesByVal.length);for(var count=br.readU8(),i=0;i<count;i++){var key=readKey(br);binary.insert(this.keys,key,cmp,!0)}return this},Account.fromRaw=function(wdb,data){return new this(wdb).fromRaw(data)},Account.isAccount=function(obj){return obj instanceof Account},Account}();Account.types={PUBKEYHASH:0,MULTISIG:1},Account.typesByVal=["PUBKEYHASH","MULTISIG"],Account.MAX_LOOKAHEAD=40;function cmp(a,b){return a.compare(b)}function writeKey(key,bw){bw.writeU8(key.depth),bw.writeU32BE(key.parentFingerPrint),bw.writeU32BE(key.childIndex),bw.writeBytes(key.chainCode),bw.writeBytes(key.publicKey)}function readKey(br){var key=new HDPublicKey;return key.depth=br.readU8(),key.parentFingerPrint=br.readU32BE(),key.childIndex=br.readU32BE(),key.chainCode=br.readBytes(32),key.publicKey=br.readBytes(33),key}module.exports=Account},{"../hd/hd":18,"../script/script":95,"../utils/binary":100,"./common":109,"./path":117,"./walletkey":124,assert:146,bufio:270}],108:[function(require,module,exports){(function(Buffer){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}var assert=require("assert"),NodeClient=require("bclient").NodeClient,util=require("../utils/util"),TX=require("../primitives/tx"),hash256=require("bcrypto/lib/hash256"),parsers={"block connect":function(entry,txs){return parseBlock(entry,txs)},"block disconnect":function(entry){return[parseEntry(entry)]},"block rescan":function(entry,txs){return parseBlock(entry,txs)},"chain reset":function(entry){return[parseEntry(entry)]},tx:function(_tx){return[TX.fromRaw(_tx)]}},WalletClient=function(_NodeClient){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(WalletClient,_NodeClient);function WalletClient(options){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,WalletClient),function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_NodeClient.call(this,options))}return WalletClient.prototype.bind=function(event,handler){var parser=parsers[event];parser?_NodeClient.prototype.bind.call(this,event,function(){return handler.apply(void 0,parser.apply(void 0,arguments))}):_NodeClient.prototype.bind.call(this,event,handler)},WalletClient.prototype.hook=function(event,handler){var parser=parsers[event];parser?_NodeClient.prototype.hook.call(this,event,function(){return handler.apply(void 0,parser.apply(void 0,arguments))}):_NodeClient.prototype.hook.call(this,event,handler)},WalletClient.prototype.getTip=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.t0=parseEntry,_context.next=3,_NodeClient.prototype.getTip.call(this);case 3:return _context.t1=_context.sent,_context.abrupt("return",(0,_context.t0)(_context.t1));case 5:case"end":return _context.stop()}},_callee,this)}));return function(){return _ref.apply(this,arguments)}}(),WalletClient.prototype.getEntry=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(block){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return"string"==typeof block&&(block=util.revHex(block)),_context2.t0=parseEntry,_context2.next=4,_NodeClient.prototype.getEntry.call(this,block);case 4:return _context2.t1=_context2.sent,_context2.abrupt("return",(0,_context2.t0)(_context2.t1));case 6:case"end":return _context2.stop()}},_callee2,this)}));return function(_x){return _ref2.apply(this,arguments)}}(),WalletClient.prototype.send=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(tx){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.abrupt("return",_NodeClient.prototype.send.call(this,tx.toRaw()));case 1:case"end":return _context3.stop()}},_callee3,this)}));return function(_x2){return _ref3.apply(this,arguments)}}(),WalletClient.prototype.setFilter=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(filter){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.abrupt("return",_NodeClient.prototype.setFilter.call(this,filter.toRaw()));case 1:case"end":return _context4.stop()}},_callee4,this)}));return function(_x3){return _ref4.apply(this,arguments)}}(),WalletClient.prototype.rescan=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(start){return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return"string"==typeof start&&(start=util.revHex(start)),_context5.abrupt("return",_NodeClient.prototype.rescan.call(this,start));case 2:case"end":return _context5.stop()}},_callee5,this)}));return function(_x4){return _ref5.apply(this,arguments)}}(),WalletClient}(NodeClient);function parseEntry(data){assert(Buffer.isBuffer(data)),assert(data.length>=84);return{hash:hash256.digest(data.slice(0,80)).toString("hex"),height:data.readUInt32LE(80,!0),time:data.readUInt32LE(68,!0)}}function parseBlock(entry,txs){var block=parseEntry(entry),out=[],_iterator=txs,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref6;if(_isArray){if(_i>=_iterator.length)break;_ref6=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref6=_i.value}var tx=_ref6;out.push(TX.fromRaw(tx))}return[block,out]}module.exports=WalletClient}).call(this,{isBuffer:require("../../node_modules/is-buffer/index.js")})},{"../../node_modules/is-buffer/index.js":353,"../primitives/tx":82,"../utils/util":106,assert:146,bclient:151,"bcrypto/lib/hash256":160}],109:[function(require,module,exports){"use strict";var common=exports;common.isName=function(key){if("string"!=typeof key)return!1;if(0===key.length)return!1;if(!/^[\-\._0-9A-Za-z]+$/.test(key))return!1;switch(key[0]){case"_":case"-":case".":return!1}switch(key[key.length-1]){case"_":case"-":case".":return!1}return key.length>=1&&key.length<=40},common.sortTX=function(txs){return txs.sort(function(a,b){return a.mtime-b.mtime})},common.sortCoins=function(coins){return coins.sort(function(a,b){return(a=-1===a.height?2147483647:a.height)-(b=-1===b.height?2147483647:b.height)})},common.sortDeps=function(txs){var map=new Map,_iterator=txs,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var tx=_ref,hash=tx.hash("hex");map.set(hash,tx)}var depMap=new Map,depCount=new Map,top=[],_iterator2=map,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref3;if(_isArray2){if(_i2>=_iterator2.length)break;_ref3=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref3=_i2.value}var _ref2=_ref3,_tx=(hash=_ref2[0],_ref2[1]);depCount.set(hash,0);var hasDeps=!1,_iterator4=_tx.inputs,_isArray4=Array.isArray(_iterator4),_i4=0;for(_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();;){var _ref5;if(_isArray4){if(_i4>=_iterator4.length)break;_ref5=_iterator4[_i4++]}else{if((_i4=_iterator4.next()).done)break;_ref5=_i4.value}var prev=_ref5.prevout.hash;if(map.has(prev)){var count=depCount.get(hash);depCount.set(hash,count+1),hasDeps=!0,depMap.has(prev)||depMap.set(prev,[]),depMap.get(prev).push(_tx)}}hasDeps||top.push(_tx)}var result=[],_iterator3=top,_isArray3=Array.isArray(_iterator3),_i3=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref4;if(_isArray3){if(_i3>=_iterator3.length)break;_ref4=_iterator3[_i3++]}else{if((_i3=_iterator3.next()).done)break;_ref4=_i3.value}var _tx2=_ref4,_hash=_tx2.hash("hex"),deps=depMap.get(_hash);if(result.push(_tx2),deps){var _iterator5=deps,_isArray5=Array.isArray(_iterator5),_i5=0;for(_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();;){var _ref6;if(_isArray5){if(_i5>=_iterator5.length)break;_ref6=_iterator5[_i5++]}else{if((_i5=_iterator5.next()).done)break;_ref6=_i5.value}var _tx3=_ref6,_hash2=_tx3.hash("hex"),_count=depCount.get(_hash2);0==--_count&&top.push(_tx3),depCount.set(_hash2,_count)}}}return result}},{}],110:[function(require,module,exports){(function(Buffer){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),path=require("path"),Server=require("bweb").Server,Validator=require("bval"),base58=require("bstring").base58,MTX=require("../primitives/mtx"),Outpoint=require("../primitives/outpoint"),Script=require("../script/script"),sha256=require("bcrypto/lib/sha256"),random=require("bcrypto/lib/random"),ccmp=require("bcrypto/lib/ccmp"),Network=require("../protocol/network"),Address=require("../primitives/address"),KeyRing=require("../primitives/keyring"),Mnemonic=require("../hd/mnemonic"),HDPrivateKey=require("../hd/private"),HDPublicKey=require("../hd/public"),common=require("./common"),HTTP=function(_Server){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(HTTP,_Server);function HTTP(options){_classCallCheck(this,HTTP);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Server.call(this,new HTTPOptions(options)));return _this.network=_this.options.network,_this.logger=_this.options.logger.context("http"),_this.wdb=_this.options.node.wdb,_this.rpc=_this.options.node.rpc,_this.init(),_this}return HTTP.prototype.init=function(){var _this2=this;this.on("request",function(req,res){"POST"===req.method&&"/"===req.pathname||_this2.logger.debug("Request for method=%s path=%s (%s).",req.method,req.pathname,req.socket.remoteAddress)}),this.on("listening",function(address){_this2.logger.info("HTTP server listening on %s (port=%d).",address.address,address.port)}),this.initRouter(),this.initSockets()},HTTP.prototype.initRouter=function(){var _this3=this;this.use(this.cors()),this.options.noAuth||this.use(this.basicAuth({hash:sha256.digest,password:this.options.apiKey,realm:"wallet"})),this.use(this.bodyParser({type:"json"})),this.use(function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(req,res){var valid,token;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(_this3.options.walletAuth){_context.next=3;break}return req.admin=!0,_context.abrupt("return");case 3:if(valid=Validator.fromRequest(req),!(token=valid.buf("token"))||!ccmp(token,_this3.options.adminToken)){_context.next=8;break}return req.admin=!0,_context.abrupt("return");case 8:if("POST"!==req.method||0!==req.path.length){_context.next=11;break}return res.json(403),_context.abrupt("return");case 11:case"end":return _context.stop()}},_callee,_this3)}));return function(_x,_x2){return _ref.apply(this,arguments)}}()),this.use(this.jsonRPC()),this.use(this.router()),this.error(function(err,req,res){var code=err.statusCode||500;res.json(code,{error:{type:err.type,code:err.code,message:err.message}})}),this.hook(function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(req,res){var valid,id,token,_wallet,wallet;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(!(req.path.length<2)){_context2.next=2;break}return _context2.abrupt("return");case 2:if("wallet"===req.path[0]){_context2.next=4;break}return _context2.abrupt("return");case 4:if("PUT"!==req.method||2!==req.path.length){_context2.next=6;break}return _context2.abrupt("return");case 6:if(valid=Validator.fromRequest(req),id=valid.str("id"),token=valid.buf("token"),id){_context2.next=12;break}return res.json(403),_context2.abrupt("return");case 12:if(!req.admin&&_this3.options.walletAuth){_context2.next=21;break}return _context2.next=15,_this3.wdb.get(id);case 15:if(_wallet=_context2.sent){_context2.next=19;break}return res.json(404),_context2.abrupt("return");case 19:return req.wallet=_wallet,_context2.abrupt("return");case 21:if(token){_context2.next=24;break}return res.json(403),_context2.abrupt("return");case 24:return wallet=void 0,_context2.prev=25,_context2.next=28,_this3.wdb.auth(id,token);case 28:wallet=_context2.sent,_context2.next=36;break;case 31:return _context2.prev=31,_context2.t0=_context2.catch(25),_this3.logger.info("Auth failure for %s: %s.",id,_context2.t0.message),res.json(403),_context2.abrupt("return");case 36:if(wallet){_context2.next=39;break}return res.json(404),_context2.abrupt("return");case 39:req.wallet=wallet,_this3.logger.info("Successful auth for %s.",id);case 41:case"end":return _context2.stop()}},_callee2,_this3,[[25,31]])}));return function(_x3,_x4){return _ref2.apply(this,arguments)}}()),this.post("/rescan",function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(req,res){var valid,height;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(req.admin){_context3.next=3;break}return res.json(403),_context3.abrupt("return");case 3:return valid=Validator.fromRequest(req),height=valid.u32("height"),res.json(200,{success:!0}),_context3.next=8,_this3.wdb.rescan(height);case 8:case"end":return _context3.stop()}},_callee3,_this3)}));return function(_x5,_x6){return _ref3.apply(this,arguments)}}()),this.post("/resend",function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(req,res){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(req.admin){_context4.next=3;break}return res.json(403),_context4.abrupt("return");case 3:return _context4.next=5,_this3.wdb.resend();case 5:res.json(200,{success:!0});case 6:case"end":return _context4.stop()}},_callee4,_this3)}));return function(_x7,_x8){return _ref4.apply(this,arguments)}}()),this.post("/backup",function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(req,res){var valid,path;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(req.admin){_context5.next=3;break}return res.json(403),_context5.abrupt("return");case 3:return valid=Validator.fromRequest(req),enforce(path=valid.str("path"),"Path is required."),_context5.next=8,_this3.wdb.backup(path);case 8:res.json(200,{success:!0});case 9:case"end":return _context5.stop()}},_callee5,_this3)}));return function(_x9,_x10){return _ref5.apply(this,arguments)}}()),this.get("/wallet",function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(req,res){var wallets;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(req.admin){_context6.next=3;break}return res.json(403),_context6.abrupt("return");case 3:return _context6.next=5,_this3.wdb.getWallets();case 5:wallets=_context6.sent,res.json(200,wallets);case 7:case"end":return _context6.stop()}},_callee6,_this3)}));return function(_x11,_x12){return _ref6.apply(this,arguments)}}()),this.get("/wallet/:id",function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(req,res){var balance;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.next=2,req.wallet.getBalance();case 2:balance=_context7.sent,res.json(200,req.wallet.toJSON(!1,balance));case 4:case"end":return _context7.stop()}},_callee7,_this3)}));return function(_x13,_x14){return _ref7.apply(this,arguments)}}()),this.get("/wallet/:id/master",function(req,res){req.admin?res.json(200,req.wallet.master.toJSON(_this3.network,!0)):res.json(403)}),this.put("/wallet/:id",function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(req,res){var valid,master,mnemonic,accountKey,wallet,balance;return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return valid=Validator.fromRequest(req),master=valid.str("master"),mnemonic=valid.str("mnemonic"),accountKey=valid.str("accountKey"),master&&(master=HDPrivateKey.fromBase58(master,_this3.network)),mnemonic&&(mnemonic=Mnemonic.fromPhrase(mnemonic)),accountKey&&(accountKey=HDPublicKey.fromBase58(accountKey,_this3.network)),_context8.next=9,_this3.wdb.create({id:valid.str("id"),type:valid.str("type"),m:valid.u32("m"),n:valid.u32("n"),passphrase:valid.str("passphrase"),master:master,mnemonic:mnemonic,witness:valid.bool("witness"),accountKey:accountKey,watchOnly:valid.bool("watchOnly")});case 9:return wallet=_context8.sent,_context8.next=12,wallet.getBalance();case 12:balance=_context8.sent,res.json(200,wallet.toJSON(!1,balance));case 14:case"end":return _context8.stop()}},_callee8,_this3)}));return function(_x15,_x16){return _ref8.apply(this,arguments)}}()),this.get("/wallet/:id/account",function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(req,res){var accounts;return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return _context9.next=2,req.wallet.getAccounts();case 2:accounts=_context9.sent,res.json(200,accounts);case 4:case"end":return _context9.stop()}},_callee9,_this3)}));return function(_x17,_x18){return _ref9.apply(this,arguments)}}()),this.get("/wallet/:id/account/:account",function(){var _ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(req,res){var valid,acct,account,balance;return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return valid=Validator.fromRequest(req),acct=valid.str("account"),_context10.next=4,req.wallet.getAccount(acct);case 4:if(account=_context10.sent){_context10.next=8;break}return res.json(404),_context10.abrupt("return");case 8:return _context10.next=10,req.wallet.getBalance(account.accountIndex);case 10:balance=_context10.sent,res.json(200,account.toJSON(balance));case 12:case"end":return _context10.stop()}},_callee10,_this3)}));return function(_x19,_x20){return _ref10.apply(this,arguments)}}()),this.put("/wallet/:id/account/:account",function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(req,res){var valid,passphrase,accountKey,options,account,balance;return regeneratorRuntime.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:return valid=Validator.fromRequest(req),passphrase=valid.str("passphrase"),(accountKey=valid.get("accountKey"))&&(accountKey=HDPublicKey.fromBase58(accountKey,_this3.network)),options={name:valid.str("account"),witness:valid.bool("witness"),watchOnly:valid.bool("watchOnly"),type:valid.str("type"),m:valid.u32("m"),n:valid.u32("n"),accountKey:accountKey,lookahead:valid.u32("lookahead")},_context11.next=7,req.wallet.createAccount(options,passphrase);case 7:return account=_context11.sent,_context11.next=10,req.wallet.getBalance(account.accountIndex);case 10:balance=_context11.sent,res.json(200,account.toJSON(balance));case 12:case"end":return _context11.stop()}},_callee11,_this3)}));return function(_x21,_x22){return _ref11.apply(this,arguments)}}()),this.post("/wallet/:id/passphrase",function(){var _ref12=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(req,res){var valid,passphrase,old;return regeneratorRuntime.wrap(function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:return valid=Validator.fromRequest(req),passphrase=valid.str("passphrase"),old=valid.str("old"),enforce(passphrase,"Passphrase is required."),_context12.next=6,req.wallet.setPassphrase(passphrase,old);case 6:res.json(200,{success:!0});case 7:case"end":return _context12.stop()}},_callee12,_this3)}));return function(_x23,_x24){return _ref12.apply(this,arguments)}}()),this.post("/wallet/:id/unlock",function(){var _ref13=_asyncToGenerator(regeneratorRuntime.mark(function _callee13(req,res){var valid,passphrase,timeout;return regeneratorRuntime.wrap(function(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:return valid=Validator.fromRequest(req),passphrase=valid.str("passphrase"),timeout=valid.u32("timeout"),enforce(passphrase,"Passphrase is required."),_context13.next=6,req.wallet.unlock(passphrase,timeout);case 6:res.json(200,{success:!0});case 7:case"end":return _context13.stop()}},_callee13,_this3)}));return function(_x25,_x26){return _ref13.apply(this,arguments)}}()),this.post("/wallet/:id/lock",function(){var _ref14=_asyncToGenerator(regeneratorRuntime.mark(function _callee14(req,res){return regeneratorRuntime.wrap(function(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:return _context14.next=2,req.wallet.lock();case 2:res.json(200,{success:!0});case 3:case"end":return _context14.stop()}},_callee14,_this3)}));return function(_x27,_x28){return _ref14.apply(this,arguments)}}()),this.post("/wallet/:id/import",function(){var _ref15=_asyncToGenerator(regeneratorRuntime.mark(function _callee15(req,res){var valid,acct,passphrase,pub,priv,b58,key,_key,addr;return regeneratorRuntime.wrap(function(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:if(valid=Validator.fromRequest(req),acct=valid.str("account"),passphrase=valid.str("passphrase"),pub=valid.buf("publicKey"),priv=valid.str("privateKey"),b58=valid.str("address"),!pub){_context15.next=12;break}return key=KeyRing.fromPublic(pub),_context15.next=10,req.wallet.importKey(acct,key);case 10:return res.json(200,{success:!0}),_context15.abrupt("return");case 12:if(!priv){_context15.next=18;break}return _key=KeyRing.fromSecret(priv,_this3.network),_context15.next=16,req.wallet.importKey(acct,_key,passphrase);case 16:return res.json(200,{success:!0}),_context15.abrupt("return");case 18:if(!b58){_context15.next=24;break}return addr=Address.fromString(b58,_this3.network),_context15.next=22,req.wallet.importAddress(acct,addr);case 22:return res.json(200,{success:!0}),_context15.abrupt("return");case 24:enforce(!1,"Key or address is required.");case 25:case"end":return _context15.stop()}},_callee15,_this3)}));return function(_x29,_x30){return _ref15.apply(this,arguments)}}()),this.post("/wallet/:id/retoken",function(){var _ref16=_asyncToGenerator(regeneratorRuntime.mark(function _callee16(req,res){var valid,passphrase,token;return regeneratorRuntime.wrap(function(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:return valid=Validator.fromRequest(req),passphrase=valid.str("passphrase"),_context16.next=4,req.wallet.retoken(passphrase);case 4:token=_context16.sent,res.json(200,{token:token.toString("hex")});case 6:case"end":return _context16.stop()}},_callee16,_this3)}));return function(_x31,_x32){return _ref16.apply(this,arguments)}}()),this.post("/wallet/:id/send",function(){var _ref17=_asyncToGenerator(regeneratorRuntime.mark(function _callee17(req,res){var valid,passphrase,outputs,options,_iterator,_isArray,_i,_ref18,_valid,addr,script,tx,details;return regeneratorRuntime.wrap(function(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:valid=Validator.fromRequest(req),passphrase=valid.str("passphrase"),outputs=valid.array("outputs",[]),options={rate:valid.u64("rate"),blocks:valid.u32("blocks"),maxFee:valid.u64("maxFee"),selection:valid.str("selection"),smart:valid.bool("smart"),subtractFee:valid.bool("subtractFee"),subtractIndex:valid.i32("subtractIndex"),depth:valid.u32(["confirmations","depth"]),outputs:[]},_iterator=outputs,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();case 5:if(!_isArray){_context17.next=11;break}if(!(_i>=_iterator.length)){_context17.next=8;break}return _context17.abrupt("break",24);case 8:_ref18=_iterator[_i++],_context17.next=15;break;case 11:if(!(_i=_iterator.next()).done){_context17.next=14;break}return _context17.abrupt("break",24);case 14:_ref18=_i.value;case 15:_valid=new Validator(_ref18),addr=_valid.str("address"),script=_valid.buf("script"),addr&&(addr=Address.fromString(addr,_this3.network)),script&&(script=Script.fromRaw(script)),options.outputs.push({address:addr,script:script,value:_valid.u64("value")});case 22:_context17.next=5;break;case 24:return _context17.next=26,req.wallet.send(options,passphrase);case 26:return tx=_context17.sent,_context17.next=29,req.wallet.getDetails(tx.hash("hex"));case 29:details=_context17.sent,res.json(200,details.toJSON(_this3.network,_this3.wdb.height));case 31:case"end":return _context17.stop()}},_callee17,_this3)}));return function(_x33,_x34){return _ref17.apply(this,arguments)}}()),this.post("/wallet/:id/create",function(){var _ref19=_asyncToGenerator(regeneratorRuntime.mark(function _callee18(req,res){var valid,passphrase,outputs,options,_iterator2,_isArray2,_i2,_ref20,_valid2,addr,script,tx;return regeneratorRuntime.wrap(function(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:valid=Validator.fromRequest(req),passphrase=valid.str("passphrase"),outputs=valid.array("outputs",[]),options={rate:valid.u64("rate"),maxFee:valid.u64("maxFee"),selection:valid.str("selection"),smart:valid.bool("smart"),subtractFee:valid.bool("subtractFee"),subtractIndex:valid.i32("subtractIndex"),depth:valid.u32(["confirmations","depth"]),outputs:[]},_iterator2=outputs,_isArray2=Array.isArray(_iterator2),_i2=0,_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();case 5:if(!_isArray2){_context18.next=11;break}if(!(_i2>=_iterator2.length)){_context18.next=8;break}return _context18.abrupt("break",24);case 8:_ref20=_iterator2[_i2++],_context18.next=15;break;case 11:if(!(_i2=_iterator2.next()).done){_context18.next=14;break}return _context18.abrupt("break",24);case 14:_ref20=_i2.value;case 15:_valid2=new Validator(_ref20),addr=_valid2.str("address"),script=_valid2.buf("script"),addr&&(addr=Address.fromString(addr,_this3.network)),script&&(script=Script.fromRaw(script)),options.outputs.push({address:addr,script:script,value:_valid2.u64("value")});case 22:_context18.next=5;break;case 24:return _context18.next=26,req.wallet.createTX(options);case 26:return tx=_context18.sent,_context18.next=29,req.wallet.sign(tx,passphrase);case 29:res.json(200,tx.getJSON(_this3.network));case 30:case"end":return _context18.stop()}},_callee18,_this3)}));return function(_x35,_x36){return _ref19.apply(this,arguments)}}()),this.post("/wallet/:id/sign",function(){var _ref21=_asyncToGenerator(regeneratorRuntime.mark(function _callee19(req,res){var valid,passphrase,raw,tx;return regeneratorRuntime.wrap(function(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:return valid=Validator.fromRequest(req),passphrase=valid.str("passphrase"),enforce(raw=valid.buf("tx"),"TX is required."),tx=MTX.fromRaw(raw),_context19.next=7,req.wallet.getCoinView(tx);case 7:return tx.view=_context19.sent,_context19.next=10,req.wallet.sign(tx,passphrase);case 10:res.json(200,tx.getJSON(_this3.network));case 11:case"end":return _context19.stop()}},_callee19,_this3)}));return function(_x37,_x38){return _ref21.apply(this,arguments)}}()),this.post("/wallet/:id/zap",function(){var _ref22=_asyncToGenerator(regeneratorRuntime.mark(function _callee20(req,res){var valid,acct,age;return regeneratorRuntime.wrap(function(_context20){for(;;)switch(_context20.prev=_context20.next){case 0:return valid=Validator.fromRequest(req),acct=valid.str("account"),enforce(age=valid.u32("age"),"Age is required."),_context20.next=6,req.wallet.zap(acct,age);case 6:res.json(200,{success:!0});case 7:case"end":return _context20.stop()}},_callee20,_this3)}));return function(_x39,_x40){return _ref22.apply(this,arguments)}}()),this.del("/wallet/:id/tx/:hash",function(){var _ref23=_asyncToGenerator(regeneratorRuntime.mark(function _callee21(req,res){var valid,hash;return regeneratorRuntime.wrap(function(_context21){for(;;)switch(_context21.prev=_context21.next){case 0:return valid=Validator.fromRequest(req),enforce(hash=valid.rhash("hash"),"Hash is required."),_context21.next=5,req.wallet.abandon(hash);case 5:res.json(200,{success:!0});case 6:case"end":return _context21.stop()}},_callee21,_this3)}));return function(_x41,_x42){return _ref23.apply(this,arguments)}}()),this.get("/wallet/:id/block",function(){var _ref24=_asyncToGenerator(regeneratorRuntime.mark(function _callee22(req,res){var heights;return regeneratorRuntime.wrap(function(_context22){for(;;)switch(_context22.prev=_context22.next){case 0:return _context22.next=2,req.wallet.getBlocks();case 2:heights=_context22.sent,res.json(200,heights);case 4:case"end":return _context22.stop()}},_callee22,_this3)}));return function(_x43,_x44){return _ref24.apply(this,arguments)}}()),this.get("/wallet/:id/block/:height",function(){var _ref25=_asyncToGenerator(regeneratorRuntime.mark(function _callee23(req,res){var valid,height,block;return regeneratorRuntime.wrap(function(_context23){for(;;)switch(_context23.prev=_context23.next){case 0:return valid=Validator.fromRequest(req),enforce(null!=(height=valid.u32("height")),"Height is required."),_context23.next=5,req.wallet.getBlock(height);case 5:if(block=_context23.sent){_context23.next=9;break}return res.json(404),_context23.abrupt("return");case 9:res.json(200,block.toJSON());case 10:case"end":return _context23.stop()}},_callee23,_this3)}));return function(_x45,_x46){return _ref25.apply(this,arguments)}}()),this.put("/wallet/:id/shared-key",function(){var _ref26=_asyncToGenerator(regeneratorRuntime.mark(function _callee24(req,res){var valid,acct,b58,key;return regeneratorRuntime.wrap(function(_context24){for(;;)switch(_context24.prev=_context24.next){case 0:return valid=Validator.fromRequest(req),acct=valid.str("account"),enforce(b58=valid.str("accountKey"),"Key is required."),key=HDPublicKey.fromBase58(b58,_this3.network),_context24.next=7,req.wallet.addSharedKey(acct,key);case 7:res.json(200,{success:!0});case 8:case"end":return _context24.stop()}},_callee24,_this3)}));return function(_x47,_x48){return _ref26.apply(this,arguments)}}()),this.del("/wallet/:id/shared-key",function(){var _ref27=_asyncToGenerator(regeneratorRuntime.mark(function _callee25(req,res){var valid,acct,b58,key;return regeneratorRuntime.wrap(function(_context25){for(;;)switch(_context25.prev=_context25.next){case 0:return valid=Validator.fromRequest(req),acct=valid.str("account"),enforce(b58=valid.str("accountKey"),"Key is required."),key=HDPublicKey.fromBase58(b58,_this3.network),_context25.next=7,req.wallet.removeSharedKey(acct,key);case 7:res.json(200,{success:!0});case 8:case"end":return _context25.stop()}},_callee25,_this3)}));return function(_x49,_x50){return _ref27.apply(this,arguments)}}()),this.get("/wallet/:id/key/:address",function(){var _ref28=_asyncToGenerator(regeneratorRuntime.mark(function _callee26(req,res){var valid,b58,addr,key;return regeneratorRuntime.wrap(function(_context26){for(;;)switch(_context26.prev=_context26.next){case 0:return valid=Validator.fromRequest(req),enforce(b58=valid.str("address"),"Address is required."),addr=Address.fromString(b58,_this3.network),_context26.next=6,req.wallet.getKey(addr);case 6:if(key=_context26.sent){_context26.next=10;break}return res.json(404),_context26.abrupt("return");case 10:res.json(200,key.toJSON(_this3.network));case 11:case"end":return _context26.stop()}},_callee26,_this3)}));return function(_x51,_x52){return _ref28.apply(this,arguments)}}()),this.get("/wallet/:id/wif/:address",function(){var _ref29=_asyncToGenerator(regeneratorRuntime.mark(function _callee27(req,res){var valid,b58,passphrase,addr,key;return regeneratorRuntime.wrap(function(_context27){for(;;)switch(_context27.prev=_context27.next){case 0:return valid=Validator.fromRequest(req),b58=valid.str("address"),passphrase=valid.str("passphrase"),enforce(b58,"Address is required."),addr=Address.fromString(b58,_this3.network),_context27.next=7,req.wallet.getPrivateKey(addr,passphrase);case 7:if(key=_context27.sent){_context27.next=11;break}return res.json(404),_context27.abrupt("return");case 11:res.json(200,{privateKey:key.toSecret(_this3.network)});case 12:case"end":return _context27.stop()}},_callee27,_this3)}));return function(_x53,_x54){return _ref29.apply(this,arguments)}}()),this.post("/wallet/:id/address",function(){var _ref30=_asyncToGenerator(regeneratorRuntime.mark(function _callee28(req,res){var valid,acct,addr;return regeneratorRuntime.wrap(function(_context28){for(;;)switch(_context28.prev=_context28.next){case 0:return valid=Validator.fromRequest(req),acct=valid.str("account"),_context28.next=4,req.wallet.createReceive(acct);case 4:addr=_context28.sent,res.json(200,addr.toJSON(_this3.network));case 6:case"end":return _context28.stop()}},_callee28,_this3)}));return function(_x55,_x56){return _ref30.apply(this,arguments)}}()),this.post("/wallet/:id/change",function(){var _ref31=_asyncToGenerator(regeneratorRuntime.mark(function _callee29(req,res){var valid,acct,addr;return regeneratorRuntime.wrap(function(_context29){for(;;)switch(_context29.prev=_context29.next){case 0:return valid=Validator.fromRequest(req),acct=valid.str("account"),_context29.next=4,req.wallet.createChange(acct);case 4:addr=_context29.sent,res.json(200,addr.toJSON(_this3.network));case 6:case"end":return _context29.stop()}},_callee29,_this3)}));return function(_x57,_x58){return _ref31.apply(this,arguments)}}()),this.post("/wallet/:id/nested",function(){var _ref32=_asyncToGenerator(regeneratorRuntime.mark(function _callee30(req,res){var valid,acct,addr;return regeneratorRuntime.wrap(function(_context30){for(;;)switch(_context30.prev=_context30.next){case 0:return valid=Validator.fromRequest(req),acct=valid.str("account"),_context30.next=4,req.wallet.createNested(acct);case 4:addr=_context30.sent,res.json(200,addr.toJSON(_this3.network));case 6:case"end":return _context30.stop()}},_callee30,_this3)}));return function(_x59,_x60){return _ref32.apply(this,arguments)}}()),this.get("/wallet/:id/balance",function(){var _ref33=_asyncToGenerator(regeneratorRuntime.mark(function _callee31(req,res){var valid,acct,balance;return regeneratorRuntime.wrap(function(_context31){for(;;)switch(_context31.prev=_context31.next){case 0:return valid=Validator.fromRequest(req),acct=valid.str("account"),_context31.next=4,req.wallet.getBalance(acct);case 4:if(balance=_context31.sent){_context31.next=8;break}return res.json(404),_context31.abrupt("return");case 8:res.json(200,balance.toJSON());case 9:case"end":return _context31.stop()}},_callee31,_this3)}));return function(_x61,_x62){return _ref33.apply(this,arguments)}}()),this.get("/wallet/:id/coin",function(){var _ref34=_asyncToGenerator(regeneratorRuntime.mark(function _callee32(req,res){var valid,acct,coins,result,_iterator3,_isArray3,_i3,_ref35,coin;return regeneratorRuntime.wrap(function(_context32){for(;;)switch(_context32.prev=_context32.next){case 0:return valid=Validator.fromRequest(req),acct=valid.str("account"),_context32.next=4,req.wallet.getCoins(acct);case 4:coins=_context32.sent,result=[],common.sortCoins(coins),_iterator3=coins,_isArray3=Array.isArray(_iterator3),_i3=0,_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();case 8:if(!_isArray3){_context32.next=14;break}if(!(_i3>=_iterator3.length)){_context32.next=11;break}return _context32.abrupt("break",22);case 11:_ref35=_iterator3[_i3++],_context32.next=18;break;case 14:if(!(_i3=_iterator3.next()).done){_context32.next=17;break}return _context32.abrupt("break",22);case 17:_ref35=_i3.value;case 18:coin=_ref35,result.push(coin.getJSON(_this3.network));case 20:_context32.next=8;break;case 22:res.json(200,result);case 23:case"end":return _context32.stop()}},_callee32,_this3)}));return function(_x63,_x64){return _ref34.apply(this,arguments)}}()),this.get("/wallet/:id/locked",function(){var _ref36=_asyncToGenerator(regeneratorRuntime.mark(function _callee33(req,res){var locked,result,_iterator4,_isArray4,_i4,_ref37,outpoint;return regeneratorRuntime.wrap(function(_context33){for(;;)switch(_context33.prev=_context33.next){case 0:locked=req.wallet.getLocked(),result=[],_iterator4=locked,_isArray4=Array.isArray(_iterator4),_i4=0,_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();case 3:if(!_isArray4){_context33.next=9;break}if(!(_i4>=_iterator4.length)){_context33.next=6;break}return _context33.abrupt("break",17);case 6:_ref37=_iterator4[_i4++],_context33.next=13;break;case 9:if(!(_i4=_iterator4.next()).done){_context33.next=12;break}return _context33.abrupt("break",17);case 12:_ref37=_i4.value;case 13:outpoint=_ref37,result.push(outpoint.toJSON());case 15:_context33.next=3;break;case 17:res.json(200,result);case 18:case"end":return _context33.stop()}},_callee33,_this3)}));return function(_x65,_x66){return _ref36.apply(this,arguments)}}()),this.put("/wallet/:id/locked/:hash/:index",function(){var _ref38=_asyncToGenerator(regeneratorRuntime.mark(function _callee34(req,res){var valid,hash,index,outpoint;return regeneratorRuntime.wrap(function(_context34){for(;;)switch(_context34.prev=_context34.next){case 0:valid=Validator.fromRequest(req),hash=valid.rhash("hash"),index=valid.u32("index"),enforce(hash,"Hash is required."),enforce(null!=index,"Index is required."),outpoint=new Outpoint(hash,index),req.wallet.lockCoin(outpoint),res.json(200,{success:!0});case 8:case"end":return _context34.stop()}},_callee34,_this3)}));return function(_x67,_x68){return _ref38.apply(this,arguments)}}()),this.del("/wallet/:id/locked/:hash/:index",function(){var _ref39=_asyncToGenerator(regeneratorRuntime.mark(function _callee35(req,res){var valid,hash,index,outpoint;return regeneratorRuntime.wrap(function(_context35){for(;;)switch(_context35.prev=_context35.next){case 0:valid=Validator.fromRequest(req),hash=valid.rhash("hash"),index=valid.u32("index"),enforce(hash,"Hash is required."),enforce(null!=index,"Index is required."),outpoint=new Outpoint(hash,index),req.wallet.unlockCoin(outpoint),res.json(200,{success:!0});case 8:case"end":return _context35.stop()}},_callee35,_this3)}));return function(_x69,_x70){return _ref39.apply(this,arguments)}}()),this.get("/wallet/:id/coin/:hash/:index",function(){var _ref40=_asyncToGenerator(regeneratorRuntime.mark(function _callee36(req,res){var valid,hash,index,coin;return regeneratorRuntime.wrap(function(_context36){for(;;)switch(_context36.prev=_context36.next){case 0:return valid=Validator.fromRequest(req),hash=valid.rhash("hash"),index=valid.u32("index"),enforce(hash,"Hash is required."),enforce(null!=index,"Index is required."),_context36.next=7,req.wallet.getCoin(hash,index);case 7:if(coin=_context36.sent){_context36.next=11;break}return res.json(404),_context36.abrupt("return");case 11:res.json(200,coin.getJSON(_this3.network));case 12:case"end":return _context36.stop()}},_callee36,_this3)}));return function(_x71,_x72){return _ref40.apply(this,arguments)}}()),this.get("/wallet/:id/tx/history",function(){var _ref41=_asyncToGenerator(regeneratorRuntime.mark(function _callee37(req,res){var valid,acct,txs,details,result,_iterator5,_isArray5,_i5,_ref42,item;return regeneratorRuntime.wrap(function(_context37){for(;;)switch(_context37.prev=_context37.next){case 0:return valid=Validator.fromRequest(req),acct=valid.str("account"),_context37.next=4,req.wallet.getHistory(acct);case 4:return txs=_context37.sent,common.sortTX(txs),_context37.next=8,req.wallet.toDetails(txs);case 8:details=_context37.sent,result=[],_iterator5=details,_isArray5=Array.isArray(_iterator5),_i5=0,_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();case 11:if(!_isArray5){_context37.next=17;break}if(!(_i5>=_iterator5.length)){_context37.next=14;break}return _context37.abrupt("break",25);case 14:_ref42=_iterator5[_i5++],_context37.next=21;break;case 17:if(!(_i5=_iterator5.next()).done){_context37.next=20;break}return _context37.abrupt("break",25);case 20:_ref42=_i5.value;case 21:item=_ref42,result.push(item.toJSON(_this3.network,_this3.wdb.height));case 23:_context37.next=11;break;case 25:res.json(200,result);case 26:case"end":return _context37.stop()}},_callee37,_this3)}));return function(_x73,_x74){return _ref41.apply(this,arguments)}}()),this.get("/wallet/:id/tx/unconfirmed",function(){var _ref43=_asyncToGenerator(regeneratorRuntime.mark(function _callee38(req,res){var valid,acct,txs,details,result,_iterator6,_isArray6,_i6,_ref44,item;return regeneratorRuntime.wrap(function(_context38){for(;;)switch(_context38.prev=_context38.next){case 0:return valid=Validator.fromRequest(req),acct=valid.str("account"),_context38.next=4,req.wallet.getPending(acct);case 4:return txs=_context38.sent,common.sortTX(txs),_context38.next=8,req.wallet.toDetails(txs);case 8:details=_context38.sent,result=[],_iterator6=details,_isArray6=Array.isArray(_iterator6),_i6=0,_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();case 11:if(!_isArray6){_context38.next=17;break}if(!(_i6>=_iterator6.length)){_context38.next=14;break}return _context38.abrupt("break",25);case 14:_ref44=_iterator6[_i6++],_context38.next=21;break;case 17:if(!(_i6=_iterator6.next()).done){_context38.next=20;break}return _context38.abrupt("break",25);case 20:_ref44=_i6.value;case 21:item=_ref44,result.push(item.toJSON(_this3.network,_this3.wdb.height));case 23:_context38.next=11;break;case 25:res.json(200,result);case 26:case"end":return _context38.stop()}},_callee38,_this3)}));return function(_x75,_x76){return _ref43.apply(this,arguments)}}()),this.get("/wallet/:id/tx/range",function(){var _ref45=_asyncToGenerator(regeneratorRuntime.mark(function _callee39(req,res){var valid,acct,options,txs,details,result,_iterator7,_isArray7,_i7,_ref46,item;return regeneratorRuntime.wrap(function(_context39){for(;;)switch(_context39.prev=_context39.next){case 0:return valid=Validator.fromRequest(req),acct=valid.str("account"),options={start:valid.u32("start"),end:valid.u32("end"),limit:valid.u32("limit"),reverse:valid.bool("reverse")},_context39.next=5,req.wallet.getRange(acct,options);case 5:return txs=_context39.sent,_context39.next=8,req.wallet.toDetails(txs);case 8:details=_context39.sent,result=[],_iterator7=details,_isArray7=Array.isArray(_iterator7),_i7=0,_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();case 11:if(!_isArray7){_context39.next=17;break}if(!(_i7>=_iterator7.length)){_context39.next=14;break}return _context39.abrupt("break",25);case 14:_ref46=_iterator7[_i7++],_context39.next=21;break;case 17:if(!(_i7=_iterator7.next()).done){_context39.next=20;break}return _context39.abrupt("break",25);case 20:_ref46=_i7.value;case 21:item=_ref46,result.push(item.toJSON(_this3.network,_this3.wdb.height));case 23:_context39.next=11;break;case 25:res.json(200,result);case 26:case"end":return _context39.stop()}},_callee39,_this3)}));return function(_x77,_x78){return _ref45.apply(this,arguments)}}()),this.get("/wallet/:id/tx/last",function(){var _ref47=_asyncToGenerator(regeneratorRuntime.mark(function _callee40(req,res){var valid,acct,limit,txs,details,result,_iterator8,_isArray8,_i8,_ref48,item;return regeneratorRuntime.wrap(function(_context40){for(;;)switch(_context40.prev=_context40.next){case 0:return valid=Validator.fromRequest(req),acct=valid.str("account"),limit=valid.u32("limit"),_context40.next=5,req.wallet.getLast(acct,limit);case 5:return txs=_context40.sent,_context40.next=8,req.wallet.toDetails(txs);case 8:details=_context40.sent,result=[],_iterator8=details,_isArray8=Array.isArray(_iterator8),_i8=0,_iterator8=_isArray8?_iterator8:_iterator8[Symbol.iterator]();case 11:if(!_isArray8){_context40.next=17;break}if(!(_i8>=_iterator8.length)){_context40.next=14;break}return _context40.abrupt("break",25);case 14:_ref48=_iterator8[_i8++],_context40.next=21;break;case 17:if(!(_i8=_iterator8.next()).done){_context40.next=20;break}return _context40.abrupt("break",25);case 20:_ref48=_i8.value;case 21:item=_ref48,result.push(item.toJSON(_this3.network,_this3.wdb.height));case 23:_context40.next=11;break;case 25:res.json(200,result);case 26:case"end":return _context40.stop()}},_callee40,_this3)}));return function(_x79,_x80){return _ref47.apply(this,arguments)}}()),this.get("/wallet/:id/tx/:hash",function(){var _ref49=_asyncToGenerator(regeneratorRuntime.mark(function _callee41(req,res){var valid,hash,tx,details;return regeneratorRuntime.wrap(function(_context41){for(;;)switch(_context41.prev=_context41.next){case 0:return valid=Validator.fromRequest(req),enforce(hash=valid.rhash("hash"),"Hash is required."),_context41.next=5,req.wallet.getTX(hash);case 5:if(tx=_context41.sent){_context41.next=9;break}return res.json(404),_context41.abrupt("return");case 9:return _context41.next=11,req.wallet.toDetails(tx);case 11:details=_context41.sent,res.json(200,details.toJSON(_this3.network,_this3.wdb.height));case 13:case"end":return _context41.stop()}},_callee41,_this3)}));return function(_x81,_x82){return _ref49.apply(this,arguments)}}()),this.post("/wallet/:id/resend",function(){var _ref50=_asyncToGenerator(regeneratorRuntime.mark(function _callee42(req,res){return regeneratorRuntime.wrap(function(_context42){for(;;)switch(_context42.prev=_context42.next){case 0:return _context42.next=2,req.wallet.resend();case 2:res.json(200,{success:!0});case 3:case"end":return _context42.stop()}},_callee42,_this3)}));return function(_x83,_x84){return _ref50.apply(this,arguments)}}())},HTTP.prototype.initSockets=function(){var _this4=this,handleTX=function(event,wallet,tx,details){var name="w:"+wallet.id;if(_this4.channel(name)||_this4.channel("w:*")){var json=details.toJSON(_this4.network,_this4.wdb.height);_this4.channel(name)&&_this4.to(name,event,wallet.id,json),_this4.channel("w:*")&&_this4.to("w:*",event,wallet.id,json)}};this.wdb.on("tx",function(wallet,tx,details){handleTX("tx",wallet,0,details)}),this.wdb.on("confirmed",function(wallet,tx,details){handleTX("confirmed",wallet,0,details)}),this.wdb.on("unconfirmed",function(wallet,tx,details){handleTX("unconfirmed",wallet,0,details)}),this.wdb.on("conflict",function(wallet,tx,details){handleTX("conflict",wallet,0,details)}),this.wdb.on("balance",function(wallet,balance){var name="w:"+wallet.id;if(_this4.channel(name)||_this4.channel("w:*")){var json=balance.toJSON();_this4.channel(name)&&_this4.to(name,"balance",wallet.id,json),_this4.channel("w:*")&&_this4.to("w:*","balance",wallet.id,json)}}),this.wdb.on("address",function(wallet,receive){var name="w:"+wallet.id;if(_this4.channel(name)||_this4.channel("w:*")){var json=[],_iterator9=receive,_isArray9=Array.isArray(_iterator9),_i9=0;for(_iterator9=_isArray9?_iterator9:_iterator9[Symbol.iterator]();;){var _ref51;if(_isArray9){if(_i9>=_iterator9.length)break;_ref51=_iterator9[_i9++]}else{if((_i9=_iterator9.next()).done)break;_ref51=_i9.value}var addr=_ref51;json.push(addr.toJSON(_this4.network))}_this4.channel(name)&&_this4.to(name,"address",wallet.id,json),_this4.channel("w:*")&&_this4.to("w:*","address",wallet.id,json)}})},HTTP.prototype.handleSocket=function(socket){var _this5=this;socket.hook("auth",function(){for(var _len=arguments.length,args=Array(_len),_key2=0;_key2<_len;_key2++)args[_key2]=arguments[_key2];if(socket.channel("auth"))throw new Error("Already authed.");if(!_this5.options.noAuth){var key=new Validator(args).str(0,"");if(key.length>255)throw new Error("Invalid API key.");var data=Buffer.from(key,"utf8"),hash=sha256.digest(data);if(!ccmp(hash,_this5.options.apiHash))throw new Error("Invalid API key.")}return socket.join("auth"),_this5.logger.info("Successful auth from %s.",socket.host),_this5.handleAuth(socket),null})},HTTP.prototype.handleAuth=function(socket){var _this6=this;socket.hook("join",_asyncToGenerator(regeneratorRuntime.mark(function _callee43(){for(var _len2=arguments.length,args=Array(_len2),_key3=0;_key3<_len2;_key3++)args[_key3]=arguments[_key3];var valid,id,token,wallet;return regeneratorRuntime.wrap(function(_context43){for(;;)switch(_context43.prev=_context43.next){case 0:if(valid=new Validator(args),id=valid.str(0,""),token=valid.buf(1),id){_context43.next=5;break}throw new Error("Invalid parameter.");case 5:if(_this6.options.walletAuth?token&&ccmp(token,_this6.options.adminToken)&&socket.join("admin"):socket.join("admin"),!socket.channel("admin")&&_this6.options.walletAuth){_context43.next=9;break}return socket.join("w:"+id),_context43.abrupt("return",null);case 9:if("*"!==id){_context43.next=11;break}throw new Error("Bad token.");case 11:if(token){_context43.next=13;break}throw new Error("Invalid parameter.");case 13:return wallet=void 0,_context43.prev=14,_context43.next=17,_this6.wdb.auth(id,token);case 17:wallet=_context43.sent,_context43.next=24;break;case 20:throw _context43.prev=20,_context43.t0=_context43.catch(14),_this6.logger.info("Wallet auth failure for %s: %s.",id,_context43.t0.message),new Error("Bad token.");case 24:if(wallet){_context43.next=26;break}throw new Error("Wallet does not exist.");case 26:return _this6.logger.info("Successful wallet auth for %s.",id),socket.join("w:"+id),_context43.abrupt("return",null);case 29:case"end":return _context43.stop()}},_callee43,_this6,[[14,20]])}))),socket.hook("leave",function(){for(var _len3=arguments.length,args=Array(_len3),_key4=0;_key4<_len3;_key4++)args[_key4]=arguments[_key4];var id=new Validator(args).str(0,"");if(!id)throw new Error("Invalid parameter.");return socket.leave("w:"+id),null})},HTTP}(Server),HTTPOptions=function(){function HTTPOptions(options){_classCallCheck(this,HTTPOptions),this.network=Network.primary,this.logger=null,this.node=null,this.apiKey=base58.encode(random.randomBytes(20)),this.apiHash=sha256.digest(Buffer.from(this.apiKey,"ascii")),this.adminToken=random.randomBytes(32),this.serviceHash=this.apiHash,this.noAuth=!1,this.walletAuth=!1,this.prefix=null,this.host="127.0.0.1",this.port=8080,this.ssl=!1,this.keyFile=null,this.certFile=null,this.fromOptions(options)}return HTTPOptions.prototype.fromOptions=function(options){if(assert(options),assert(options.node&&"object"===_typeof(options.node),"HTTP Server requires a WalletDB."),this.node=options.node,this.network=options.node.network,this.logger=options.node.logger,this.port=this.network.walletPort,null!=options.logger&&(assert("object"===_typeof(options.logger)),this.logger=options.logger),null!=options.apiKey&&(assert("string"==typeof options.apiKey,"API key must be a string."),assert(options.apiKey.length<=255,"API key must be under 255 bytes."),this.apiKey=options.apiKey,this.apiHash=sha256.digest(Buffer.from(this.apiKey,"ascii"))),null!=options.adminToken)if("string"==typeof options.adminToken){assert(64===options.adminToken.length,"Admin token must be a 32 byte hex string.");var token=Buffer.from(options.adminToken,"hex");assert(32===token.length,"Admin token must be a 32 byte hex string."),this.adminToken=token}else assert(Buffer.isBuffer(options.adminToken),"Admin token must be a hex string or buffer."),assert(32===options.adminToken.length,"Admin token must be 32 bytes."),this.adminToken=options.adminToken;return null!=options.noAuth&&(assert("boolean"==typeof options.noAuth),this.noAuth=options.noAuth),null!=options.walletAuth&&(assert("boolean"==typeof options.walletAuth),this.walletAuth=options.walletAuth),null!=options.prefix&&(assert("string"==typeof options.prefix),this.prefix=options.prefix,this.keyFile=path.join(this.prefix,"key.pem"),this.certFile=path.join(this.prefix,"cert.pem")),null!=options.host&&(assert("string"==typeof options.host),this.host=options.host),null!=options.port&&(assert((65535&options.port)===options.port,"Port must be a number."),this.port=options.port),null!=options.ssl&&(assert("boolean"==typeof options.ssl),this.ssl=options.ssl),null!=options.keyFile&&(assert("string"==typeof options.keyFile),this.keyFile=options.keyFile),null!=options.certFile&&(assert("string"==typeof options.certFile),this.certFile=options.certFile),options.apiKey||"127.0.0.1"!==this.host&&"::1"!==this.host||(this.noAuth=!0),this},HTTPOptions.fromOptions=function(options){return(new HTTPOptions).fromOptions(options)},HTTPOptions}();function enforce(value,msg){if(!value){var err=new Error(msg);throw err.statusCode=400,err}}module.exports=HTTP}).call(this,require("buffer").Buffer)},{"../hd/mnemonic":20,"../hd/private":22,"../hd/public":23,"../primitives/address":69,"../primitives/keyring":76,"../primitives/mtx":79,"../primitives/outpoint":80,"../protocol/network":87,"../script/script":95,"./common":109,assert:146,"bcrypto/lib/ccmp":156,"bcrypto/lib/random":180,"bcrypto/lib/sha256":186,bstring:265,buffer:269,bval:280,bweb:282,path:367}],111:[function(require,module,exports){"use strict";exports.Account=require("./account"),exports.Client=require("./client"),exports.common=require("./common"),exports.HTTP=require("./http"),exports.layout=require("./layout"),exports.MasterKey=require("./masterkey"),exports.NodeClient=require("./nodeclient"),exports.Path=require("./path"),exports.plugin=require("./plugin"),exports.records=require("./records"),exports.RPC=require("./rpc"),exports.Node=require("./node"),exports.TXDB=require("./txdb"),exports.WalletDB=require("./walletdb"),exports.Wallet=require("./wallet"),exports.WalletKey=require("./walletkey")},{"./account":107,"./client":108,"./common":109,"./http":110,"./layout":112,"./masterkey":113,"./node":114,"./nodeclient":115,"./path":117,"./plugin":118,"./records":119,"./rpc":120,"./txdb":121,"./wallet":122,"./walletdb":123,"./walletkey":124}],112:[function(require,module,exports){"use strict";var bdb=require("bdb");exports.wdb={V:bdb.key("V"),O:bdb.key("O"),R:bdb.key("R"),D:bdb.key("D"),p:bdb.key("p",["hash"]),P:bdb.key("P",["uint32","hash"]),r:bdb.key("r",["uint32","uint32","hash"]),w:bdb.key("w",["uint32"]),W:bdb.key("W",["uint32"]),l:bdb.key("l",["ascii"]),a:bdb.key("a",["uint32","uint32"]),i:bdb.key("i",["uint32","ascii"]),n:bdb.key("n",["uint32","uint32"]),h:bdb.key("h",["uint32"]),b:bdb.key("b",["uint32"]),o:bdb.key("o",["hash256","uint32"]),T:bdb.key("T",["hash256"]),t:bdb.key("t",["uint32"])},exports.txdb={prefix:bdb.key("t",["uint32"]),R:bdb.key("R"),r:bdb.key("r",["uint32"]),t:bdb.key("t",["hash256"]),c:bdb.key("c",["hash256","uint32"]),d:bdb.key("d",["hash256","uint32"]),s:bdb.key("s",["hash256","uint32"]),p:bdb.key("p",["hash256"]),m:bdb.key("m",["uint32","hash256"]),h:bdb.key("h",["uint32","hash256"]),T:bdb.key("T",["uint32","hash256"]),P:bdb.key("P",["uint32","hash256"]),M:bdb.key("M",["uint32","uint32","hash256"]),H:bdb.key("H",["uint32","uint32","hash256"]),C:bdb.key("C",["uint32","hash256","uint32"]),b:bdb.key("b",["uint32"])}},{bdb:191}],113:[function(require,module,exports){(function(Buffer){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}var assert=require("assert"),bio=require("bufio"),Lock=require("bmutex").Lock,random=require("bcrypto/lib/random"),cleanse=require("bcrypto/lib/cleanse"),aes=require("bcrypto/lib/aes"),sha256=require("bcrypto/lib/sha256"),hash256=require("bcrypto/lib/hash256"),secp256k1=require("bcrypto/lib/secp256k1"),pbkdf2=require("bcrypto/lib/pbkdf2"),scrypt=require("bcrypto/lib/scrypt"),util=require("../utils/util"),HDPrivateKey=require("../hd/private"),Mnemonic=require("../hd/mnemonic"),encoding=bio.encoding,MasterKey=function(){function MasterKey(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MasterKey),this.encrypted=!1,this.iv=null,this.ciphertext=null,this.key=null,this.mnemonic=null,this.alg=MasterKey.alg.PBKDF2,this.n=5e4,this.r=0,this.p=0,this.aesKey=null,this.timer=null,this.until=0,this.locker=new Lock,options&&this.fromOptions(options)}return MasterKey.prototype.fromOptions=function(options){return assert(options),null!=options.encrypted&&(assert("boolean"==typeof options.encrypted),this.encrypted=options.encrypted),options.iv&&(assert(Buffer.isBuffer(options.iv)),this.iv=options.iv),options.ciphertext&&(assert(Buffer.isBuffer(options.ciphertext)),this.ciphertext=options.ciphertext),options.key&&(assert(HDPrivateKey.isHDPrivateKey(options.key)),this.key=options.key),options.mnemonic&&(assert(options.mnemonic instanceof Mnemonic),this.mnemonic=options.mnemonic),null!=options.alg&&("string"==typeof options.alg?(this.alg=MasterKey.alg[options.alg.toUpperCase()],assert(null!=this.alg,"Unknown algorithm.")):(assert("number"==typeof options.alg),assert(MasterKey.algByVal[options.alg]),this.alg=options.alg)),null!=options.rounds&&(assert(options.rounds>>>0===options.rounds),this.rounds=options.rounds),null!=options.n&&(assert(options.n>>>0===options.n),this.n=options.n),null!=options.r&&(assert(options.r>>>0===options.r),this.r=options.r),null!=options.p&&(assert(options.p>>>0===options.p),this.p=options.p),assert(this.encrypted?!this.key:this.key),this},MasterKey.fromOptions=function(options){return(new this).fromOptions(options)},MasterKey.prototype.unlock=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(passphrase,timeout){var _unlock;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,this.locker.lock();case 2:return _unlock=_context.sent,_context.prev=3,_context.next=6,this._unlock(passphrase,timeout);case 6:return _context.abrupt("return",_context.sent);case 7:return _context.prev=7,_unlock(),_context.finish(7);case 10:case"end":return _context.stop()}},_callee,this,[[3,,7,10]])}));return function(_x,_x2){return _ref.apply(this,arguments)}}(),MasterKey.prototype._unlock=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(passphrase,timeout){var key,data;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(!this.key){_context2.next=3;break}return this.encrypted&&(assert(null!=this.timer),this.start(timeout)),_context2.abrupt("return",this.key);case 3:if(passphrase){_context2.next=5;break}throw new Error("No passphrase.");case 5:return assert(this.encrypted),_context2.next=8,this.derive(passphrase);case 8:return key=_context2.sent,data=aes.decipher(this.ciphertext,key,this.iv),this.readKey(data),this.start(timeout),this.aesKey=key,_context2.abrupt("return",this.key);case 14:case"end":return _context2.stop()}},_callee2,this)}));return function(_x3,_x4){return _ref2.apply(this,arguments)}}(),MasterKey.prototype.start=function(timeout){var _this=this;timeout||(timeout=60),this.stop(),-1!==timeout&&(assert(timeout>>>0===timeout),this.until=util.now()+timeout,this.timer=setTimeout(function(){return _this.lock()},1e3*timeout))},MasterKey.prototype.stop=function(){null!=this.timer&&(clearTimeout(this.timer),this.timer=null,this.until=0)},MasterKey.prototype.derive=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(passwd){var salt,n,r,p;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:salt=MasterKey.SALT,n=this.n,r=this.r,p=this.p,"string"==typeof passwd&&(passwd=Buffer.from(passwd,"utf8")),_context3.t0=this.alg,_context3.next=_context3.t0===MasterKey.alg.PBKDF2?8:_context3.t0===MasterKey.alg.SCRYPT?9:10;break;case 8:return _context3.abrupt("return",pbkdf2.deriveAsync(sha256,passwd,salt,n,32));case 9:return _context3.abrupt("return",scrypt.deriveAsync(passwd,salt,n,r,p,32));case 10:throw new Error("Unknown algorithm: "+this.alg+".");case 11:case"end":return _context3.stop()}},_callee3,this)}));return function(_x5){return _ref3.apply(this,arguments)}}(),MasterKey.prototype.encipher=function(data,iv){return this.aesKey?("string"==typeof iv&&(iv=Buffer.from(iv,"hex")),aes.encipher(data,this.aesKey,iv.slice(0,16))):null},MasterKey.prototype.decipher=function(data,iv){return this.aesKey?("string"==typeof iv&&(iv=Buffer.from(iv,"hex")),aes.decipher(data,this.aesKey,iv.slice(0,16))):null},MasterKey.prototype.lock=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){var unlock;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,this.locker.lock();case 2:return unlock=_context4.sent,_context4.prev=3,_context4.next=6,this._lock();case 6:return _context4.abrupt("return",_context4.sent);case 7:return _context4.prev=7,unlock(),_context4.finish(7);case 10:case"end":return _context4.stop()}},_callee4,this,[[3,,7,10]])}));return function(){return _ref4.apply(this,arguments)}}(),MasterKey.prototype._lock=function(){if(!this.encrypted)return assert(null==this.timer),void assert(this.key);this.stop(),this.key&&(this.key.destroy(!0),this.key=null),this.aesKey&&(cleanse(this.aesKey),this.aesKey=null)},MasterKey.prototype.destroy=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,this.lock();case 2:this.locker.destroy();case 3:case"end":return _context5.stop()}},_callee5,this)}));return function(){return _ref5.apply(this,arguments)}}(),MasterKey.prototype.decrypt=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(passphrase,clean){var unlock;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=2,this.locker.lock();case 2:return unlock=_context6.sent,_context6.prev=3,_context6.next=6,this._decrypt(passphrase,clean);case 6:return _context6.abrupt("return",_context6.sent);case 7:return _context6.prev=7,unlock(),_context6.finish(7);case 10:case"end":return _context6.stop()}},_callee6,this,[[3,,7,10]])}));return function(_x6,_x7){return _ref6.apply(this,arguments)}}(),MasterKey.prototype._decrypt=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(passphrase,clean){var key,data;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(this.encrypted){_context7.next=2;break}throw new Error("Master key is not encrypted.");case 2:if(passphrase){_context7.next=4;break}throw new Error("No passphrase provided.");case 4:return this._lock(),_context7.next=7,this.derive(passphrase);case 7:if(key=_context7.sent,data=aes.decipher(this.ciphertext,key,this.iv),this.readKey(data),this.encrypted=!1,this.iv=null,this.ciphertext=null,clean){_context7.next=16;break}return cleanse(key),_context7.abrupt("return",null);case 16:return _context7.abrupt("return",key);case 17:case"end":return _context7.stop()}},_callee7,this)}));return function(_x8,_x9){return _ref7.apply(this,arguments)}}(),MasterKey.prototype.encrypt=function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(passphrase,clean){var unlock;return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return _context8.next=2,this.locker.lock();case 2:return unlock=_context8.sent,_context8.prev=3,_context8.next=6,this._encrypt(passphrase,clean);case 6:return _context8.abrupt("return",_context8.sent);case 7:return _context8.prev=7,unlock(),_context8.finish(7);case 10:case"end":return _context8.stop()}},_callee8,this,[[3,,7,10]])}));return function(_x10,_x11){return _ref8.apply(this,arguments)}}(),MasterKey.prototype._encrypt=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(passphrase,clean){var raw,iv,key,data;return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:if(!this.encrypted){_context9.next=2;break}throw new Error("Master key is already encrypted.");case 2:if(passphrase){_context9.next=4;break}throw new Error("No passphrase provided.");case 4:return raw=this.writeKey(),iv=random.randomBytes(16),this.stop(),_context9.next=9,this.derive(passphrase);case 9:if(key=_context9.sent,data=aes.encipher(raw,key,iv),this.key=null,this.mnemonic=null,this.encrypted=!0,this.iv=iv,this.ciphertext=data,clean){_context9.next=19;break}return cleanse(key),_context9.abrupt("return",null);case 19:return _context9.abrupt("return",key);case 20:case"end":return _context9.stop()}},_callee9,this)}));return function(_x12,_x13){return _ref9.apply(this,arguments)}}(),MasterKey.prototype.keySize=function(){var size=0;return size+=64,size+=1,this.mnemonic&&(size+=this.mnemonic.getSize()),size},MasterKey.prototype.writeKey=function(){var bw=bio.write(this.keySize());return bw.writeBytes(this.key.chainCode),bw.writeBytes(this.key.privateKey),this.mnemonic?(bw.writeU8(1),this.mnemonic.toWriter(bw)):bw.writeU8(0),bw.render()},MasterKey.prototype.readKey=function(data){var br=bio.read(data);return this.key=new HDPrivateKey,!function(data){if(data.length<82)return!1;var key=data.slice(0,78),chk=data.readUInt32LE(78,!0);return hash256.digest(key).readUInt32LE(0,!0)===chk}(data)?(this.key.chainCode=br.readBytes(32),this.key.privateKey=br.readBytes(32)):(br.seek(13),this.key.chainCode=br.readBytes(32),assert(0===br.readU8()),this.key.privateKey=br.readBytes(32)),this.key.publicKey=secp256k1.publicKeyCreate(this.key.privateKey,!0),1===br.readU8()&&(this.mnemonic=Mnemonic.fromReader(br)),this},MasterKey.prototype.getSize=function(){var size=0;return this.encrypted?(size+=1,size+=encoding.sizeVarBytes(this.iv),size+=encoding.sizeVarBytes(this.ciphertext),size+=13):(size+=1,size+=this.keySize())},MasterKey.prototype.toWriter=function(bw){return this.encrypted?(bw.writeU8(1),bw.writeVarBytes(this.iv),bw.writeVarBytes(this.ciphertext),bw.writeU8(this.alg),bw.writeU32(this.n),bw.writeU32(this.r),bw.writeU32(this.p),bw):(bw.writeU8(0),bw.writeBytes(this.key.chainCode),bw.writeBytes(this.key.privateKey),this.mnemonic?(bw.writeU8(1),this.mnemonic.toWriter(bw)):bw.writeU8(0),bw)},MasterKey.prototype.toRaw=function(){var size=this.getSize();return this.toWriter(bio.write(size)).render()},MasterKey.prototype.fromReader=function(br){return this.encrypted=1===br.readU8(),this.encrypted?(this.iv=br.readVarBytes(),this.ciphertext=br.readVarBytes(),this.alg=br.readU8(),assert(this.alg<MasterKey.algByVal.length),this.n=br.readU32(),this.r=br.readU32(),this.p=br.readU32(),this):(this.key=new HDPrivateKey,this.key.chainCode=br.readBytes(32),this.key.privateKey=br.readBytes(32),this.key.publicKey=secp256k1.publicKeyCreate(this.key.privateKey,!0),1===br.readU8()&&(this.mnemonic=Mnemonic.fromReader(br)),this)},MasterKey.fromReader=function(br){return(new this).fromReader(br)},MasterKey.prototype.fromRaw=function(raw){return this.fromReader(bio.read(raw))},MasterKey.fromRaw=function(raw){return(new this).fromRaw(raw)},MasterKey.prototype.fromKey=function(key,mnemonic){return this.encrypted=!1,this.iv=null,this.ciphertext=null,this.key=key,this.mnemonic=mnemonic||null,this},MasterKey.fromKey=function(key,mnemonic){return(new this).fromKey(key,mnemonic)},MasterKey.prototype.toJSON=function(network,unsafe){return this.encrypted?{encrypted:!0,until:this.until,iv:this.iv.toString("hex"),ciphertext:unsafe?this.ciphertext.toString("hex"):void 0,algorithm:MasterKey.algByVal[this.alg].toLowerCase(),n:this.n,r:this.r,p:this.p}:{encrypted:!1,key:unsafe?this.key.toJSON(network):void 0,mnemonic:unsafe&&this.mnemonic?this.mnemonic.toJSON():void 0}},MasterKey.prototype.inspect=function(){var json=this.toJSON(null,!0);return this.key&&(json.key=this.key.toJSON()),this.mnemonic&&(json.mnemonic=this.mnemonic.toJSON()),json},MasterKey.isMasterKey=function(obj){return obj instanceof MasterKey},MasterKey}();MasterKey.SALT=Buffer.from("bcoin","ascii"),MasterKey.alg={PBKDF2:0,SCRYPT:1},MasterKey.algByVal=["PBKDF2","SCRYPT"];module.exports=MasterKey}).call(this,require("buffer").Buffer)},{"../hd/mnemonic":20,"../hd/private":22,"../utils/util":106,assert:146,"bcrypto/lib/aes":155,"bcrypto/lib/cleanse":158,"bcrypto/lib/hash256":160,"bcrypto/lib/pbkdf2":178,"bcrypto/lib/random":180,"bcrypto/lib/scrypt":182,"bcrypto/lib/secp256k1":184,"bcrypto/lib/sha256":186,bmutex:214,buffer:269,bufio:270}],114:[function(require,module,exports){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}var assert=require("assert"),Node=require("../node/node"),WalletDB=require("./walletdb"),HTTP=require("./http"),Client=require("./client"),RPC=require("./rpc"),WalletNode=function(_Node){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(WalletNode,_Node);function WalletNode(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,WalletNode);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Node.call(this,"bcoin","wallet.conf","wallet.log",options));return _this.opened=!1,_this.client=new Client({network:_this.network,url:_this.config.str("node-url"),host:_this.config.str("node-host"),port:_this.config.str("node-port",_this.network.rpcPort),ssl:_this.config.str("node-ssl"),apiKey:_this.config.str("node-api-key")}),_this.wdb=new WalletDB({network:_this.network,logger:_this.logger,workers:_this.workers,client:_this.client,prefix:_this.config.prefix,memory:_this.config.bool("memory"),maxFiles:_this.config.uint("max-files"),cacheSize:_this.config.mb("cache-size"),witness:_this.config.bool("witness"),checkpoints:_this.config.bool("checkpoints"),wipeNoReally:_this.config.bool("wipe-no-really"),spv:_this.config.bool("spv")}),_this.rpc=new RPC(_this),_this.http=new HTTP({network:_this.network,logger:_this.logger,node:_this,prefix:_this.config.prefix,ssl:_this.config.bool("ssl"),keyFile:_this.config.path("ssl-key"),certFile:_this.config.path("ssl-cert"),host:_this.config.str("http-host"),port:_this.config.uint("http-port"),apiKey:_this.config.str("api-key"),walletAuth:_this.config.bool("wallet-auth"),noAuth:_this.config.bool("no-auth"),adminToken:_this.config.str("admin-token")}),_this.init(),_this}return WalletNode.prototype.init=function(){var _this2=this;this.wdb.on("error",function(err){return _this2.error(err)}),this.http.on("error",function(err){return _this2.error(err)}),this.loadPlugins()},WalletNode.prototype.open=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return assert(!this.opened,"WalletNode is already open."),this.opened=!0,_context.next=4,this.handlePreopen();case 4:return _context.next=6,this.wdb.open();case 6:return this.rpc.wallet=this.wdb.primary,_context.next=9,this.openPlugins();case 9:return _context.next=11,this.http.open();case 11:return _context.next=13,this.handleOpen();case 13:this.logger.info("Wallet node is loaded.");case 14:case"end":return _context.stop()}},_callee,this)}));return function(){return _ref.apply(this,arguments)}}(),WalletNode.prototype.close=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return assert(this.opened,"WalletNode is not open."),this.opened=!1,_context2.next=4,this.handlePreclose();case 4:return _context2.next=6,this.http.close();case 6:return _context2.next=8,this.closePlugins();case 8:return this.rpc.wallet=null,_context2.next=11,this.wdb.close();case 11:return _context2.next=13,this.handleClose();case 13:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref2.apply(this,arguments)}}(),WalletNode}(Node);module.exports=WalletNode},{"../node/node":64,"./client":108,"./http":110,"./rpc":120,"./walletdb":123,assert:146}],115:[function(require,module,exports){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}var assert=require("assert"),NodeClient=function(_AsyncEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(NodeClient,_AsyncEmitter);function NodeClient(node){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,NodeClient);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_AsyncEmitter.call(this));return _this.node=node,_this.network=node.network,_this.filter=null,_this.opened=!1,_this.init(),_this}return NodeClient.prototype.init=function(){var _this2=this;this.node.on("connect",function(entry,block){_this2.opened&&_this2.emit("block connect",entry,block.txs)}),this.node.on("disconnect",function(entry,block){_this2.opened&&_this2.emit("block disconnect",entry)}),this.node.on("tx",function(tx){_this2.opened&&_this2.emit("tx",tx)}),this.node.on("reset",function(tip){_this2.opened&&_this2.emit("chain reset",tip)})},NodeClient.prototype.open=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(options){var _this3=this;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:assert(!this.opened,"NodeClient is already open."),this.opened=!0,setImmediate(function(){return _this3.emit("connect")});case 3:case"end":return _context.stop()}},_callee,this)}));return function(_x){return _ref.apply(this,arguments)}}(),NodeClient.prototype.close=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var _this4=this;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:assert(this.opened,"NodeClient is not open."),this.opened=!1,setImmediate(function(){return _this4.emit("disconnect")});case 3:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref2.apply(this,arguments)}}(),NodeClient.prototype.bind=function(type,handler){return this.on(type,handler)},NodeClient.prototype.hook=function(type,handler){return this.on(type,handler)},NodeClient.prototype.getTip=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.abrupt("return",this.node.chain.tip);case 1:case"end":return _context3.stop()}},_callee3,this)}));return function(){return _ref3.apply(this,arguments)}}(),NodeClient.prototype.getEntry=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(hash){var entry;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,this.node.chain.getEntry(hash);case 2:if(entry=_context4.sent){_context4.next=5;break}return _context4.abrupt("return",null);case 5:return _context4.next=7,this.node.chain.isMainChain(entry);case 7:if(_context4.sent){_context4.next=9;break}return _context4.abrupt("return",null);case 9:return _context4.abrupt("return",entry);case 10:case"end":return _context4.stop()}},_callee4,this)}));return function(_x2){return _ref4.apply(this,arguments)}}(),NodeClient.prototype.send=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(tx){return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:this.node.relay(tx);case 1:case"end":return _context5.stop()}},_callee5,this)}));return function(_x3){return _ref5.apply(this,arguments)}}(),NodeClient.prototype.setFilter=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(filter){return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:this.filter=filter,this.node.pool.setFilter(filter);case 2:case"end":return _context6.stop()}},_callee6,this)}));return function(_x4){return _ref6.apply(this,arguments)}}(),NodeClient.prototype.addFilter=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(data){return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:this.node.pool.queueFilterLoad();case 1:case"end":return _context7.stop()}},_callee7,this)}));return function(_x5){return _ref7.apply(this,arguments)}}(),NodeClient.prototype.resetFilter=function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(){return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:this.node.pool.queueFilterLoad();case 1:case"end":return _context8.stop()}},_callee8,this)}));return function(){return _ref8.apply(this,arguments)}}(),NodeClient.prototype.estimateFee=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(blocks){return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:if(this.node.fees){_context9.next=2;break}return _context9.abrupt("return",this.network.feeRate);case 2:return _context9.abrupt("return",this.node.fees.estimateFee(blocks));case 3:case"end":return _context9.stop()}},_callee9,this)}));return function(_x6){return _ref9.apply(this,arguments)}}(),NodeClient.prototype.getHashes=function(){var _ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(){var start=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,end=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return _context10.abrupt("return",this.node.chain.getHashes(start,end));case 1:case"end":return _context10.stop()}},_callee10,this)}));return function(){return _ref10.apply(this,arguments)}}(),NodeClient.prototype.rescan=function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(start){var _this5=this;return regeneratorRuntime.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:return _context11.abrupt("return",this.node.chain.scan(start,this.filter,function(entry,txs){return _this5.emitAsync("block rescan",entry,txs)}));case 1:case"end":return _context11.stop()}},_callee11,this)}));return function(_x9){return _ref11.apply(this,arguments)}}(),NodeClient}(require("bevent"));module.exports=NodeClient},{assert:146,bevent:200}],116:[function(require,module,exports){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}var assert=require("assert"),NullClient=function(_EventEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(NullClient,_EventEmitter);function NullClient(wdb){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,NullClient);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return _this.wdb=wdb,_this.network=wdb.network,_this.opened=!1,_this}return NullClient.prototype.open=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(options){var _this2=this;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:assert(!this.opened,"NullClient is already open."),this.opened=!0,setImmediate(function(){return _this2.emit("connect")});case 3:case"end":return _context.stop()}},_callee,this)}));return function(_x){return _ref.apply(this,arguments)}}(),NullClient.prototype.close=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var _this3=this;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:assert(this.opened,"NullClient is not open."),this.opened=!1,setImmediate(function(){return _this3.emit("disconnect")});case 3:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref2.apply(this,arguments)}}(),NullClient.prototype.bind=function(type,handler){return this.on(type,handler)},NullClient.prototype.hook=function(type,handler){return this.on(type,handler)},NullClient.prototype.getTip=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var _network$genesis,hash,height,time;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _network$genesis=this.network.genesis,hash=_network$genesis.hash,height=_network$genesis.height,time=_network$genesis.time,_context3.abrupt("return",{hash:hash,height:height,time:time});case 2:case"end":return _context3.stop()}},_callee3,this)}));return function(){return _ref3.apply(this,arguments)}}(),NullClient.prototype.getEntry=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(hash){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.abrupt("return",{hash:hash,height:0,time:0});case 1:case"end":return _context4.stop()}},_callee4,this)}));return function(_x2){return _ref4.apply(this,arguments)}}(),NullClient.prototype.send=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(tx){return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:this.wdb.emit("send",tx);case 1:case"end":return _context5.stop()}},_callee5,this)}));return function(_x3){return _ref5.apply(this,arguments)}}(),NullClient.prototype.setFilter=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(filter){return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:this.wdb.emit("set filter",filter);case 1:case"end":return _context6.stop()}},_callee6,this)}));return function(_x4){return _ref6.apply(this,arguments)}}(),NullClient.prototype.addFilter=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(data){return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:this.wdb.emit("add filter",data);case 1:case"end":return _context7.stop()}},_callee7,this)}));return function(_x5){return _ref7.apply(this,arguments)}}(),NullClient.prototype.resetFilter=function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(){return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:this.wdb.emit("reset filter");case 1:case"end":return _context8.stop()}},_callee8,this)}));return function(){return _ref8.apply(this,arguments)}}(),NullClient.prototype.estimateFee=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(blocks){return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return _context9.abrupt("return",this.network.feeRate);case 1:case"end":return _context9.stop()}},_callee9,this)}));return function(_x6){return _ref9.apply(this,arguments)}}(),NullClient.prototype.getHashes=function(){var _ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]&&arguments[1];return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return _context10.abrupt("return",[this.network.genesis.hash]);case 1:case"end":return _context10.stop()}},_callee10,this)}));return function(){return _ref10.apply(this,arguments)}}(),NullClient.prototype.rescan=function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(start){return regeneratorRuntime.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:case 1:case"end":return _context11.stop()}},_callee11,this)}));return function(_x9){return _ref11.apply(this,arguments)}}(),NullClient}(require("events"));module.exports=NullClient},{assert:146,events:334}],117:[function(require,module,exports){"use strict";var assert=require("assert"),bio=require("bufio"),Address=require("../primitives/address"),encoding=bio.encoding,Path=function(){function Path(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Path),this.keyType=Path.types.HD,this.name=null,this.account=0,this.type=Address.types.PUBKEYHASH,this.version=-1,this.branch=-1,this.index=-1,this.encrypted=!1,this.data=null,this.hash=null,options&&this.fromOptions(options)}return Path.prototype.fromOptions=function(options){return this.keyType=options.keyType,this.name=options.name,this.account=options.account,this.branch=options.branch,this.index=options.index,this.encrypted=options.encrypted,this.data=options.data,this.type=options.type,this.version=options.version,this.hash=options.hash,this},Path.fromOptions=function(options){return(new this).fromOptions(options)},Path.prototype.clone=function(){var path=new this.constructor;return path.keyType=this.keyType,path.name=this.name,path.account=this.account,path.branch=this.branch,path.index=this.index,path.encrypted=this.encrypted,path.data=this.data,path.type=this.type,path.version=this.version,path.hash=this.hash,path},Path.prototype.fromRaw=function(data){var br=bio.read(data);this.account=br.readU32(),this.keyType=br.readU8();var flags=br.readU8();switch(this.type=7&flags,this.version=flags>>>3,31===this.version&&(this.version=-1),this.keyType){case Path.types.HD:this.branch=br.readU32(),this.index=br.readU32();break;case Path.types.KEY:this.encrypted=1===br.readU8(),this.data=br.readVarBytes();break;case Path.types.ADDRESS:break;default:assert(!1)}return this},Path.fromRaw=function(data){return(new this).fromRaw(data)},Path.prototype.getSize=function(){var size=0;switch(size+=6,this.keyType){case Path.types.HD:size+=8;break;case Path.types.KEY:size+=1,size+=encoding.sizeVarBytes(this.data)}return size},Path.prototype.toRaw=function(){var size=this.getSize(),bw=bio.write(size);bw.writeU32(this.account),bw.writeU8(this.keyType);var version=this.version;-1===version&&(version=31);var flags=version<<3|this.type;switch(bw.writeU8(flags),this.keyType){case Path.types.HD:assert(!this.data),assert(-1!==this.index),bw.writeU32(this.branch),bw.writeU32(this.index);break;case Path.types.KEY:assert(this.data),assert(-1===this.index),bw.writeU8(this.encrypted?1:0),bw.writeVarBytes(this.data);break;case Path.types.ADDRESS:assert(!this.data),assert(-1===this.index);break;default:assert(!1)}return bw.render()},Path.prototype.fromAddress=function(account,address){return this.keyType=Path.types.ADDRESS,this.name=account.name,this.account=account.accountIndex,this.version=address.version,this.type=address.type,this.hash=address.getHash("hex"),this},Path.fromAddress=function(account,address){return(new this).fromAddress(account,address)},Path.prototype.toPath=function(){return this.keyType!==Path.types.HD?null:"m/"+this.account+"'/"+this.branch+"/"+this.index},Path.prototype.toAddress=function(){return Address.fromHash(this.hash,this.type,this.version)},Path.prototype.toJSON=function(){return{name:this.name,account:this.account,change:1===this.branch,derivation:this.toPath()}},Path.prototype.inspect=function(){return"<Path: "+this.name+":"+this.toPath()+">"},Path}();Path.types={HD:0,KEY:1,ADDRESS:2},Path.typesByVal=["HD","KEY","ADDRESS"],module.exports=Path},{"../primitives/address":69,assert:146,bufio:270}],118:[function(require,module,exports){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}var EventEmitter=require("events"),WalletDB=require("./walletdb"),NodeClient=require("./nodeclient"),HTTP=require("./http"),RPC=require("./rpc"),plugin=exports,Plugin=function(_EventEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Plugin,_EventEmitter);function Plugin(node){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Plugin);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return _this.config=node.config.filter("wallet"),_this.config.open("wallet.conf"),_this.network=node.network,_this.logger=node.logger,_this.client=new NodeClient(node),_this.wdb=new WalletDB({network:_this.network,logger:_this.logger,workers:_this.workers,client:_this.client,prefix:_this.config.prefix,memory:_this.config.bool("memory",node.memory),maxFiles:_this.config.uint("max-files"),cacheSize:_this.config.mb("cache-size"),witness:_this.config.bool("witness"),checkpoints:_this.config.bool("checkpoints"),wipeNoReally:_this.config.bool("wipe-no-really"),spv:node.spv}),_this.rpc=new RPC(_this),_this.http=new HTTP({network:_this.network,logger:_this.logger,node:_this,ssl:_this.config.bool("ssl"),keyFile:_this.config.path("ssl-key"),certFile:_this.config.path("ssl-cert"),host:_this.config.str("http-host"),port:_this.config.uint("http-port"),apiKey:_this.config.str("api-key",node.config.str("api-key")),walletAuth:_this.config.bool("wallet-auth"),noAuth:_this.config.bool("no-auth"),adminToken:_this.config.str("admin-token")}),_this.init(),_this}return Plugin.prototype.init=function(){var _this2=this;this.wdb.on("error",function(err){return _this2.emit("error",err)}),this.http.on("error",function(err){return _this2.emit("error",err)})},Plugin.prototype.open=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,this.wdb.open();case 2:return this.rpc.wallet=this.wdb.primary,_context.next=5,this.http.open();case 5:case"end":return _context.stop()}},_callee,this)}));return function(){return _ref.apply(this,arguments)}}(),Plugin.prototype.close=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,this.http.close();case 2:return this.rpc.wallet=null,_context2.next=5,this.wdb.close();case 5:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref2.apply(this,arguments)}}(),Plugin}(EventEmitter);plugin.id="walletdb",plugin.init=function(node){return new Plugin(node)}},{"./http":110,"./nodeclient":115,"./rpc":120,"./walletdb":123,events:334}],119:[function(require,module,exports){(function(Buffer){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),bio=require("bufio"),util=require("../utils/util"),TX=require("../primitives/tx"),consensus=require("../protocol/consensus"),ChainState=function(){function ChainState(){_classCallCheck(this,ChainState),this.startHeight=0,this.startHash=consensus.NULL_HASH,this.height=0,this.marked=!1}return ChainState.prototype.clone=function(){var state=new ChainState;return state.startHeight=this.startHeight,state.startHash=this.startHash,state.height=this.height,state.marked=this.marked,state},ChainState.prototype.fromRaw=function(data){var br=bio.read(data);return this.startHeight=br.readU32(),this.startHash=br.readHash("hex"),this.height=br.readU32(),this.marked=1===br.readU8(),this},ChainState.fromRaw=function(data){return(new this).fromRaw(data)},ChainState.prototype.toRaw=function(){var bw=bio.write(41);return bw.writeU32(this.startHeight),bw.writeHash(this.startHash),bw.writeU32(this.height),bw.writeU8(this.marked?1:0),bw.render()},ChainState}(),BlockMeta=function(){function BlockMeta(hash,height,time){_classCallCheck(this,BlockMeta),this.hash=hash||consensus.NULL_HASH,this.height=null!=height?height:-1,this.time=time||0}return BlockMeta.prototype.clone=function(){return new this.constructor(this.hash,this.height,this.time)},BlockMeta.prototype.toHash=function(){return Buffer.from(this.hash,"hex")},BlockMeta.prototype.fromEntry=function(entry){return this.hash=entry.hash,this.height=entry.height,this.time=entry.time,this},BlockMeta.prototype.fromJSON=function(json){return this.hash=util.revHex(json.hash),this.height=json.height,this.time=json.time,this},BlockMeta.prototype.fromRaw=function(data){var br=bio.read(data);return this.hash=br.readHash("hex"),this.height=br.readU32(),this.time=br.readU32(),this},BlockMeta.fromEntry=function(entry){return(new this).fromEntry(entry)},BlockMeta.fromJSON=function(json){return(new this).fromJSON(json)},BlockMeta.fromRaw=function(data){return(new this).fromRaw(data)},BlockMeta.prototype.toRaw=function(){var bw=bio.write(42);return bw.writeHash(this.hash),bw.writeU32(this.height),bw.writeU32(this.time),bw.render()},BlockMeta.prototype.toJSON=function(){return{hash:util.revHex(this.hash),height:this.height,time:this.time}},BlockMeta}(),TXRecord=function(){function TXRecord(tx,block){_classCallCheck(this,TXRecord),this.tx=null,this.hash=null,this.mtime=util.now(),this.height=-1,this.block=null,this.index=-1,this.time=0,tx&&this.fromTX(tx,block)}return TXRecord.prototype.fromTX=function(tx,block){return this.tx=tx,this.hash=tx.hash("hex"),block&&this.setBlock(block),this},TXRecord.fromTX=function(tx,block){return(new this).fromTX(tx,block)},TXRecord.prototype.setBlock=function(block){this.height=block.height,this.block=block.hash,this.time=block.time},TXRecord.prototype.unsetBlock=function(){this.height=-1,this.block=null,this.time=0},TXRecord.prototype.getBlock=function(){return-1===this.height?null:new BlockMeta(this.block,this.height,this.time)},TXRecord.prototype.getDepth=function(height){return assert("number"==typeof height,"Must pass in height."),-1===this.height?0:height<this.height?0:height-this.height+1},TXRecord.prototype.getSize=function(){var size=0;return size+=this.tx.getSize(),size+=4,this.block?(size+=1,size+=32,size+=12):size+=1,size},TXRecord.prototype.toRaw=function(){var size=this.getSize(),bw=bio.write(size),index=this.index;return this.tx.toWriter(bw),bw.writeU32(this.mtime),this.block?(-1===index&&(index=2147483647),bw.writeU8(1),bw.writeHash(this.block),bw.writeU32(this.height),bw.writeU32(this.time),bw.writeU32(index)):bw.writeU8(0),bw.render()},TXRecord.prototype.fromRaw=function(data){var br=bio.read(data);return this.tx=new TX,this.tx.fromReader(br),this.hash=this.tx.hash("hex"),this.mtime=br.readU32(),1===br.readU8()&&(this.block=br.readHash("hex"),this.height=br.readU32(),this.time=br.readU32(),this.index=br.readU32(),2147483647===this.index&&(this.index=-1)),this},TXRecord.fromRaw=function(data){return(new this).fromRaw(data)},TXRecord}(),MapRecord=function(){function MapRecord(){_classCallCheck(this,MapRecord),this.wids=new Set}return MapRecord.prototype.add=function(wid){return!this.wids.has(wid)&&(this.wids.add(wid),!0)},MapRecord.prototype.remove=function(wid){return this.wids.delete(wid)},MapRecord.prototype.toWriter=function(bw){bw.writeU32(this.wids.size);var _iterator=this.wids,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var wid=_ref;bw.writeU32(wid)}return bw},MapRecord.prototype.getSize=function(){return 4+4*this.wids.size},MapRecord.prototype.toRaw=function(){var size=this.getSize();return this.toWriter(bio.write(size)).render()},MapRecord.prototype.fromReader=function(br){for(var count=br.readU32(),i=0;i<count;i++)this.wids.add(br.readU32());return this},MapRecord.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},MapRecord.fromReader=function(br){return(new this).fromReader(br)},MapRecord.fromRaw=function(data){return(new this).fromRaw(data)},MapRecord}();exports.ChainState=ChainState,exports.BlockMeta=BlockMeta,exports.TXRecord=TXRecord,exports.MapRecord=MapRecord,module.exports=exports}).call(this,require("buffer").Buffer)},{"../primitives/tx":82,"../protocol/consensus":84,"../utils/util":106,assert:146,buffer:269,bufio:270}],120:[function(require,module,exports){(function(Buffer){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}var assert=require("assert"),format=require("util").format,bweb=require("bweb"),Lock=require("bmutex").Lock,fs=require("bfile"),Validator=require("bval"),hash256=require("bcrypto/lib/hash256"),util=require("../utils/util"),Amount=require("../btc/amount"),Script=require("../script/script"),Address=require("../primitives/address"),KeyRing=require("../primitives/keyring"),MerkleBlock=require("../primitives/merkleblock"),MTX=require("../primitives/mtx"),Outpoint=require("../primitives/outpoint"),Output=require("../primitives/output"),TX=require("../primitives/tx"),consensus=require("../protocol/consensus"),pkg=require("../pkg"),common=require("./common"),RPCBase=bweb.RPC,RPCError=bweb.RPCError,errs={INVALID_REQUEST:bweb.errors.INVALID_REQUEST,METHOD_NOT_FOUND:bweb.errors.METHOD_NOT_FOUND,INVALID_PARAMS:bweb.errors.INVALID_PARAMS,INTERNAL_ERROR:bweb.errors.INTERNAL_ERROR,PARSE_ERROR:bweb.errors.PARSE_ERROR,MISC_ERROR:-1,FORBIDDEN_BY_SAFE_MODE:-2,TYPE_ERROR:-3,INVALID_ADDRESS_OR_KEY:-5,OUT_OF_MEMORY:-7,INVALID_PARAMETER:-8,DATABASE_ERROR:-20,DESERIALIZATION_ERROR:-22,VERIFY_ERROR:-25,VERIFY_REJECTED:-26,VERIFY_ALREADY_IN_CHAIN:-27,IN_WARMUP:-28,WALLET_ERROR:-4,WALLET_INSUFFICIENT_FUNDS:-6,WALLET_INVALID_ACCOUNT_NAME:-11,WALLET_KEYPOOL_RAN_OUT:-12,WALLET_UNLOCK_NEEDED:-13,WALLET_PASSPHRASE_INCORRECT:-14,WALLET_WRONG_ENC_STATE:-15,WALLET_ENCRYPTION_FAILED:-16,WALLET_ALREADY_UNLOCKED:-17},RPC=function(_RPCBase){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(RPC,_RPCBase);function RPC(node){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,RPC);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_RPCBase.call(this));return assert(node,"RPC requires a WalletDB."),_this.wdb=node.wdb,_this.network=node.network,_this.logger=node.logger.context("rpc"),_this.client=node.client,_this.locker=new Lock,_this.wallet=null,_this.init(),_this}return RPC.prototype.getCode=function(err){switch(err.type){case"RPCError":return err.code;case"ValidationError":return errs.TYPE_ERROR;case"EncodingError":return errs.DESERIALIZATION_ERROR;case"FundingError":return errs.WALLET_INSUFFICIENT_FUNDS;default:return errs.INTERNAL_ERROR}},RPC.prototype.init=function(){this.add("help",this.help),this.add("stop",this.stop),this.add("fundrawtransaction",this.fundRawTransaction),this.add("resendwallettransactions",this.resendWalletTransactions),this.add("abandontransaction",this.abandonTransaction),this.add("addmultisigaddress",this.addMultisigAddress),this.add("backupwallet",this.backupWallet),this.add("dumpprivkey",this.dumpPrivKey),this.add("dumpwallet",this.dumpWallet),this.add("encryptwallet",this.encryptWallet),this.add("getaccountaddress",this.getAccountAddress),this.add("getaccount",this.getAccount),this.add("getaddressesbyaccount",this.getAddressesByAccount),this.add("getbalance",this.getBalance),this.add("getnewaddress",this.getNewAddress),this.add("getrawchangeaddress",this.getRawChangeAddress),this.add("getreceivedbyaccount",this.getReceivedByAccount),this.add("getreceivedbyaddress",this.getReceivedByAddress),this.add("gettransaction",this.getTransaction),this.add("getunconfirmedbalance",this.getUnconfirmedBalance),this.add("getwalletinfo",this.getWalletInfo),this.add("importprivkey",this.importPrivKey),this.add("importwallet",this.importWallet),this.add("importaddress",this.importAddress),this.add("importprunedfunds",this.importPrunedFunds),this.add("importpubkey",this.importPubkey),this.add("keypoolrefill",this.keyPoolRefill),this.add("listaccounts",this.listAccounts),this.add("listaddressgroupings",this.listAddressGroupings),this.add("listlockunspent",this.listLockUnspent),this.add("listreceivedbyaccount",this.listReceivedByAccount),this.add("listreceivedbyaddress",this.listReceivedByAddress),this.add("listsinceblock",this.listSinceBlock),this.add("listtransactions",this.listTransactions),this.add("listunspent",this.listUnspent),this.add("lockunspent",this.lockUnspent),this.add("move",this.move),this.add("sendfrom",this.sendFrom),this.add("sendmany",this.sendMany),this.add("sendtoaddress",this.sendToAddress),this.add("setaccount",this.setAccount),this.add("settxfee",this.setTXFee),this.add("signmessage",this.signMessage),this.add("walletlock",this.walletLock),this.add("walletpassphrasechange",this.walletPassphraseChange),this.add("walletpassphrase",this.walletPassphrase),this.add("removeprunedfunds",this.removePrunedFunds),this.add("selectwallet",this.selectWallet),this.add("getmemoryinfo",this.getMemoryInfo),this.add("setloglevel",this.setLogLevel)},RPC.prototype.help=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(args,_help){var json;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(0!==args.length){_context.next=2;break}return _context.abrupt("return","Select a command.");case 2:return json={method:args[0],params:[]},_context.next=5,this.execute(json,!0);case 5:return _context.abrupt("return",_context.sent);case 6:case"end":return _context.stop()}},_callee,this)}));return function(_x,_x2){return _ref.apply(this,arguments)}}(),RPC.prototype.stop=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(args,help){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(!help&&0===args.length){_context2.next=2;break}throw new RPCError(errs.MISC_ERROR,"stop");case 2:return this.wdb.close(),_context2.abrupt("return","Stopping.");case 4:case"end":return _context2.stop()}},_callee2,this)}));return function(_x3,_x4){return _ref2.apply(this,arguments)}}(),RPC.prototype.fundRawTransaction=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(args,help){var wallet,valid,data,options,tx,rate,change,_valid;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(!(help||args.length<1||args.length>2)){_context3.next=2;break}throw new RPCError(errs.MISC_ERROR,'fundrawtransaction "hexstring" ( options )');case 2:if(wallet=this.wallet,valid=new Validator(args),data=valid.buf(0),options=valid.obj(1),data){_context3.next=8;break}throw new RPCError(errs.TYPE_ERROR,"Invalid hex string.");case 8:if(0!==(tx=MTX.fromRaw(data)).outputs.length){_context3.next=11;break}throw new RPCError(errs.INVALID_PARAMETER,"TX must have at least one output.");case 11:return rate=null,change=null,options&&(_valid=new Validator(options),rate=_valid.ufixed("feeRate",8),(change=_valid.str("changeAddress"))&&(change=parseAddress(change,this.network))),_context3.next=16,wallet.fund(tx,{rate:rate,changeAddress:change});case 16:return _context3.abrupt("return",{hex:tx.toRaw().toString("hex"),changepos:tx.changeIndex,fee:Amount.btc(tx.getFee(),!0)});case 17:case"end":return _context3.stop()}},_callee3,this)}));return function(_x5,_x6){return _ref3.apply(this,arguments)}}(),RPC.prototype.resendWalletTransactions=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(args,help){var wallet,txs,hashes,_iterator,_isArray,_i,_ref5,tx;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(!help&&0===args.length){_context4.next=2;break}throw new RPCError(errs.MISC_ERROR,"resendwallettransactions");case 2:return wallet=this.wallet,_context4.next=5,wallet.resend();case 5:txs=_context4.sent,hashes=[],_iterator=txs,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();case 8:if(!_isArray){_context4.next=14;break}if(!(_i>=_iterator.length)){_context4.next=11;break}return _context4.abrupt("break",22);case 11:_ref5=_iterator[_i++],_context4.next=18;break;case 14:if(!(_i=_iterator.next()).done){_context4.next=17;break}return _context4.abrupt("break",22);case 17:_ref5=_i.value;case 18:tx=_ref5,hashes.push(tx.txid());case 20:_context4.next=8;break;case 22:return _context4.abrupt("return",hashes);case 23:case"end":return _context4.stop()}},_callee4,this)}));return function(_x7,_x8){return _ref4.apply(this,arguments)}}(),RPC.prototype.addMultisigAddress=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(args,help){return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(!(help||args.length<2||args.length>3)){_context5.next=2;break}throw new RPCError(errs.MISC_ERROR,'addmultisigaddress nrequired ["key",...] ( "account" )');case 2:throw new Error("Not implemented.");case 3:case"end":return _context5.stop()}},_callee5,this)}));return function(_x9,_x10){return _ref6.apply(this,arguments)}}(),RPC.prototype.backupWallet=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(args,help){var valid,dest;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(valid=new Validator(args),dest=valid.str(0),!help&&1===args.length&&dest){_context6.next=4;break}throw new RPCError(errs.MISC_ERROR,'backupwallet "destination"');case 4:return _context6.next=6,this.wdb.backup(dest);case 6:return _context6.abrupt("return",null);case 7:case"end":return _context6.stop()}},_callee6,this)}));return function(_x11,_x12){return _ref7.apply(this,arguments)}}(),RPC.prototype.dumpPrivKey=function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(args,help){var wallet,valid,addr,hash,ring;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(!help&&1===args.length){_context7.next=2;break}throw new RPCError(errs.MISC_ERROR,'dumpprivkey "bitcoinaddress"');case 2:return wallet=this.wallet,valid=new Validator(args),addr=valid.str(0,""),hash=parseHash(addr,this.network),_context7.next=8,wallet.getPrivateKey(hash);case 8:if(ring=_context7.sent){_context7.next=11;break}throw new RPCError(errs.MISC_ERROR,"Key not found.");case 11:return _context7.abrupt("return",ring.toSecret(this.network));case 12:case"end":return _context7.stop()}},_callee7,this)}));return function(_x13,_x14){return _ref8.apply(this,arguments)}}(),RPC.prototype.dumpWallet=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(args,help){var wallet,valid,file,tip,time,out,hashes,_iterator2,_isArray2,_i2,_ref10,hash,ring,addr,fmt,str,dump;return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(!help&&1===args.length){_context8.next=2;break}throw new RPCError(errs.MISC_ERROR,'dumpwallet "filename"');case 2:if(wallet=this.wallet,valid=new Validator(args),file=valid.str(0)){_context8.next=7;break}throw new RPCError(errs.TYPE_ERROR,"Invalid parameter.");case 7:return _context8.next=9,this.wdb.getTip();case 9:return tip=_context8.sent,time=util.date(),out=[format("# Wallet Dump created by Bcoin %s",pkg.version),format("# * Created on %s",time),format("# * Best block at time of backup was %d (%s).",tip.height,util.revHex(tip.hash)),format("# * File: %s",file),""],_context8.next=14,wallet.getAddressHashes();case 14:hashes=_context8.sent,_iterator2=hashes,_isArray2=Array.isArray(_iterator2),_i2=0,_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();case 16:if(!_isArray2){_context8.next=22;break}if(!(_i2>=_iterator2.length)){_context8.next=19;break}return _context8.abrupt("break",39);case 19:_ref10=_iterator2[_i2++],_context8.next=26;break;case 22:if(!(_i2=_iterator2.next()).done){_context8.next=25;break}return _context8.abrupt("break",39);case 25:_ref10=_i2.value;case 26:return hash=_ref10,_context8.next=29,wallet.getPrivateKey(hash);case 29:if(ring=_context8.sent){_context8.next=32;break}return _context8.abrupt("continue",37);case 32:addr=ring.getAddress("string"),fmt="%s %s label= addr=%s",1===ring.branch&&(fmt="%s %s change=1 addr=%s"),str=format(fmt,ring.toSecret(this.network),time,addr),out.push(str);case 37:_context8.next=16;break;case 39:if(out.push(""),out.push("# End of dump"),out.push(""),dump=out.join("\n"),!fs.unsupported){_context8.next=45;break}return _context8.abrupt("return",dump);case 45:return _context8.next=47,fs.writeFile(file,dump,"utf8");case 47:return _context8.abrupt("return",null);case 48:case"end":return _context8.stop()}},_callee8,this)}));return function(_x15,_x16){return _ref9.apply(this,arguments)}}(),RPC.prototype.encryptWallet=function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(args,help){var wallet,valid,passphrase;return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:if((wallet=this.wallet).master.encrypted||!help&&1===args.length){_context9.next=3;break}throw new RPCError(errs.MISC_ERROR,'encryptwallet "passphrase"');case 3:if(valid=new Validator(args),passphrase=valid.str(0,""),!wallet.master.encrypted){_context9.next=7;break}throw new RPCError(errs.WALLET_WRONG_ENC_STATE,"Already running with an encrypted wallet.");case 7:if(!(passphrase.length<1)){_context9.next=9;break}throw new RPCError(errs.MISC_ERROR,'encryptwallet "passphrase"');case 9:return _context9.prev=9,_context9.next=12,wallet.encrypt(passphrase);case 12:_context9.next=17;break;case 14:throw _context9.prev=14,_context9.t0=_context9.catch(9),new RPCError(errs.WALLET_ENCRYPTION_FAILED,"Encryption failed.");case 17:return _context9.abrupt("return","wallet encrypted; we do not need to stop!");case 18:case"end":return _context9.stop()}},_callee9,this,[[9,14]])}));return function(_x17,_x18){return _ref11.apply(this,arguments)}}(),RPC.prototype.getAccountAddress=function(){var _ref12=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(args,help){var wallet,valid,name,addr;return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:if(!help&&1===args.length){_context10.next=2;break}throw new RPCError(errs.MISC_ERROR,'getaccountaddress "account"');case 2:return wallet=this.wallet,valid=new Validator(args),(name=valid.str(0,""))||(name="default"),_context10.next=8,wallet.receiveAddress(name);case 8:if(addr=_context10.sent){_context10.next=11;break}return _context10.abrupt("return","");case 11:return _context10.abrupt("return",addr.toString(this.network));case 12:case"end":return _context10.stop()}},_callee10,this)}));return function(_x19,_x20){return _ref12.apply(this,arguments)}}(),RPC.prototype.getAccount=function(){var _ref13=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(args,help){var wallet,valid,addr,hash,path;return regeneratorRuntime.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:if(!help&&1===args.length){_context11.next=2;break}throw new RPCError(errs.MISC_ERROR,'getaccount "bitcoinaddress"');case 2:return wallet=this.wallet,valid=new Validator(args),addr=valid.str(0,""),hash=parseHash(addr,this.network),_context11.next=8,wallet.getPath(hash);case 8:if(path=_context11.sent){_context11.next=11;break}return _context11.abrupt("return","");case 11:return _context11.abrupt("return",path.name);case 12:case"end":return _context11.stop()}},_callee11,this)}));return function(_x21,_x22){return _ref13.apply(this,arguments)}}(),RPC.prototype.getAddressesByAccount=function(){var _ref14=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(args,help){var wallet,valid,name,addrs,paths,_iterator3,_isArray3,_i3,_ref15,addr;return regeneratorRuntime.wrap(function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:if(!help&&1===args.length){_context12.next=2;break}throw new RPCError(errs.MISC_ERROR,'getaddressesbyaccount "account"');case 2:return wallet=this.wallet,valid=new Validator(args),name=valid.str(0,""),addrs=[],""===name&&(name="default"),_context12.next=9,wallet.getPaths(name);case 9:paths=_context12.sent,_iterator3=paths,_isArray3=Array.isArray(_iterator3),_i3=0,_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();case 11:if(!_isArray3){_context12.next=17;break}if(!(_i3>=_iterator3.length)){_context12.next=14;break}return _context12.abrupt("break",26);case 14:_ref15=_iterator3[_i3++],_context12.next=21;break;case 17:if(!(_i3=_iterator3.next()).done){_context12.next=20;break}return _context12.abrupt("break",26);case 20:_ref15=_i3.value;case 21:addr=_ref15.toAddress(),addrs.push(addr.toString(this.network));case 24:_context12.next=11;break;case 26:return _context12.abrupt("return",addrs);case 27:case"end":return _context12.stop()}},_callee12,this)}));return function(_x23,_x24){return _ref14.apply(this,arguments)}}(),RPC.prototype.getBalance=function(){var _ref16=_asyncToGenerator(regeneratorRuntime.mark(function _callee13(args,help){var wallet,valid,name,minconf,watchOnly,balance,value;return regeneratorRuntime.wrap(function(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:if(!(help||args.length>3)){_context13.next=2;break}throw new RPCError(errs.MISC_ERROR,'getbalance ( "account" minconf includeWatchonly )');case 2:if(wallet=this.wallet,valid=new Validator(args),name=valid.str(0),minconf=valid.u32(1,1),watchOnly=valid.bool(2,!1),""===name&&(name="default"),"*"===name&&(name=null),wallet.watchOnly===watchOnly){_context13.next=11;break}return _context13.abrupt("return",0);case 11:return _context13.next=13,wallet.getBalance(name);case 13:return balance=_context13.sent,value=void 0,value=minconf>0?balance.confirmed:balance.unconfirmed,_context13.abrupt("return",Amount.btc(value,!0));case 17:case"end":return _context13.stop()}},_callee13,this)}));return function(_x25,_x26){return _ref16.apply(this,arguments)}}(),RPC.prototype.getNewAddress=function(){var _ref17=_asyncToGenerator(regeneratorRuntime.mark(function _callee14(args,help){var wallet,valid,name,addr;return regeneratorRuntime.wrap(function(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:if(!(help||args.length>1)){_context14.next=2;break}throw new RPCError(errs.MISC_ERROR,'getnewaddress ( "account" )');case 2:return wallet=this.wallet,valid=new Validator(args),""===(name=valid.str(0))&&(name="default"),_context14.next=8,wallet.createReceive(name);case 8:return addr=_context14.sent,_context14.abrupt("return",addr.getAddress("string"));case 10:case"end":return _context14.stop()}},_callee14,this)}));return function(_x27,_x28){return _ref17.apply(this,arguments)}}(),RPC.prototype.getRawChangeAddress=function(){var _ref18=_asyncToGenerator(regeneratorRuntime.mark(function _callee15(args,help){var wallet,addr;return regeneratorRuntime.wrap(function(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:if(!(help||args.length>1)){_context15.next=2;break}throw new RPCError(errs.MISC_ERROR,"getrawchangeaddress");case 2:return wallet=this.wallet,_context15.next=5,wallet.createChange();case 5:return addr=_context15.sent,_context15.abrupt("return",addr.getAddress("string"));case 7:case"end":return _context15.stop()}},_callee15,this)}));return function(_x29,_x30){return _ref18.apply(this,arguments)}}(),RPC.prototype.getReceivedByAccount=function(){var _ref19=_asyncToGenerator(regeneratorRuntime.mark(function _callee16(args,help){var wallet,valid,name,minconf,height,paths,filter,_iterator4,_isArray4,_i4,_ref20,path,txs,total,lastConf,_iterator5,_isArray5,_i5,_ref21,wtx,conf,_iterator6,_isArray6,_i6,_ref22,output,hash;return regeneratorRuntime.wrap(function(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:if(!(help||args.length<1||args.length>2)){_context16.next=2;break}throw new RPCError(errs.MISC_ERROR,'getreceivedbyaccount "account" ( minconf )');case 2:return wallet=this.wallet,valid=new Validator(args),name=valid.str(0),minconf=valid.u32(1,0),height=this.wdb.state.height,""===name&&(name="default"),_context16.next=10,wallet.getPaths(name);case 10:paths=_context16.sent,filter=new Set,_iterator4=paths,_isArray4=Array.isArray(_iterator4),_i4=0,_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();case 13:if(!_isArray4){_context16.next=19;break}if(!(_i4>=_iterator4.length)){_context16.next=16;break}return _context16.abrupt("break",27);case 16:_ref20=_iterator4[_i4++],_context16.next=23;break;case 19:if(!(_i4=_iterator4.next()).done){_context16.next=22;break}return _context16.abrupt("break",27);case 22:_ref20=_i4.value;case 23:path=_ref20,filter.add(path.hash);case 25:_context16.next=13;break;case 27:return _context16.next=29,wallet.getHistory(name);case 29:txs=_context16.sent,total=0,lastConf=-1,_iterator5=txs,_isArray5=Array.isArray(_iterator5),_i5=0,_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();case 33:if(!_isArray5){_context16.next=39;break}if(!(_i5>=_iterator5.length)){_context16.next=36;break}return _context16.abrupt("break",66);case 36:_ref21=_iterator5[_i5++],_context16.next=43;break;case 39:if(!(_i5=_iterator5.next()).done){_context16.next=42;break}return _context16.abrupt("break",66);case 42:_ref21=_i5.value;case 43:if(!((conf=(wtx=_ref21).getDepth(height))<minconf)){_context16.next=47;break}return _context16.abrupt("continue",64);case 47:(-1===lastConf||conf<lastConf)&&(lastConf=conf),_iterator6=wtx.tx.outputs,_isArray6=Array.isArray(_iterator6),_i6=0,_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();case 49:if(!_isArray6){_context16.next=55;break}if(!(_i6>=_iterator6.length)){_context16.next=52;break}return _context16.abrupt("break",64);case 52:_ref22=_iterator6[_i6++],_context16.next=59;break;case 55:if(!(_i6=_iterator6.next()).done){_context16.next=58;break}return _context16.abrupt("break",64);case 58:_ref22=_i6.value;case 59:(hash=(output=_ref22).getHash("hex"))&&filter.has(hash)&&(total+=output.value);case 62:_context16.next=49;break;case 64:_context16.next=33;break;case 66:return _context16.abrupt("return",Amount.btc(total,!0));case 67:case"end":return _context16.stop()}},_callee16,this)}));return function(_x31,_x32){return _ref19.apply(this,arguments)}}(),RPC.prototype.getReceivedByAddress=function(){var _ref23=_asyncToGenerator(regeneratorRuntime.mark(function _callee17(args,help){var wallet,valid,addr,minconf,height,hash,txs,total,_iterator7,_isArray7,_i7,_ref24,wtx,_iterator8,_isArray8,_i8,_ref25,output;return regeneratorRuntime.wrap(function(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:if(!(help||args.length<1||args.length>2)){_context17.next=2;break}throw new RPCError(errs.MISC_ERROR,'getreceivedbyaddress "bitcoinaddress" ( minconf )');case 2:return wallet=this.wallet,valid=new Validator(args),addr=valid.str(0,""),minconf=valid.u32(1,0),height=this.wdb.state.height,hash=parseHash(addr,this.network),_context17.next=10,wallet.getHistory();case 10:txs=_context17.sent,total=0,_iterator7=txs,_isArray7=Array.isArray(_iterator7),_i7=0,_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();case 13:if(!_isArray7){_context17.next=19;break}if(!(_i7>=_iterator7.length)){_context17.next=16;break}return _context17.abrupt("break",43);case 16:_ref24=_iterator7[_i7++],_context17.next=23;break;case 19:if(!(_i7=_iterator7.next()).done){_context17.next=22;break}return _context17.abrupt("break",43);case 22:_ref24=_i7.value;case 23:if(!((wtx=_ref24).getDepth(height)<minconf)){_context17.next=26;break}return _context17.abrupt("continue",41);case 26:_iterator8=wtx.tx.outputs,_isArray8=Array.isArray(_iterator8),_i8=0,_iterator8=_isArray8?_iterator8:_iterator8[Symbol.iterator]();case 27:if(!_isArray8){_context17.next=33;break}if(!(_i8>=_iterator8.length)){_context17.next=30;break}return _context17.abrupt("break",41);case 30:_ref25=_iterator8[_i8++],_context17.next=37;break;case 33:if(!(_i8=_iterator8.next()).done){_context17.next=36;break}return _context17.abrupt("break",41);case 36:_ref25=_i8.value;case 37:(output=_ref25).getHash("hex")===hash&&(total+=output.value);case 39:_context17.next=27;break;case 41:_context17.next=13;break;case 43:return _context17.abrupt("return",Amount.btc(total,!0));case 44:case"end":return _context17.stop()}},_callee17,this)}));return function(_x33,_x34){return _ref23.apply(this,arguments)}}(),RPC.prototype._toWalletTX=function(){var _ref26=_asyncToGenerator(regeneratorRuntime.mark(function _callee18(wtx){var wallet,details,receive,_iterator9,_isArray9,_i9,_ref27,det,sent,received,i,_member;return regeneratorRuntime.wrap(function(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:return wallet=this.wallet,_context18.next=3,wallet.toDetails(wtx);case 3:if(details=_context18.sent){_context18.next=6;break}throw new RPCError(errs.WALLET_ERROR,"TX not found.");case 6:receive=!0,_iterator9=details.inputs,_isArray9=Array.isArray(_iterator9),_i9=0,_iterator9=_isArray9?_iterator9:_iterator9[Symbol.iterator]();case 8:if(!_isArray9){_context18.next=14;break}if(!(_i9>=_iterator9.length)){_context18.next=11;break}return _context18.abrupt("break",24);case 11:_ref27=_iterator9[_i9++],_context18.next=18;break;case 14:if(!(_i9=_iterator9.next()).done){_context18.next=17;break}return _context18.abrupt("break",24);case 17:_ref27=_i9.value;case 18:if(!_ref27.path){_context18.next=22;break}return receive=!1,_context18.abrupt("break",24);case 22:_context18.next=8;break;case 24:det=[],sent=0,received=0,i=0;case 28:if(!(i<details.outputs.length)){_context18.next=43;break}if(!(_member=details.outputs[i]).path){_context18.next=36;break}if(1!==_member.path.branch){_context18.next=33;break}return _context18.abrupt("continue",40);case 33:return det.push({account:_member.path.name,address:_member.address.toString(this.network),category:"receive",amount:Amount.btc(_member.value,!0),label:_member.path.name,vout:i}),received+=_member.value,_context18.abrupt("continue",40);case 36:if(!receive){_context18.next=38;break}return _context18.abrupt("continue",40);case 38:det.push({account:"",address:_member.address?_member.address.toString(this.network):null,category:"send",amount:-Amount.btc(_member.value,!0),fee:-Amount.btc(details.fee,!0),vout:i}),sent+=_member.value;case 40:i++,_context18.next=28;break;case 43:return _context18.abrupt("return",{amount:Amount.btc(receive?received:-sent,!0),confirmations:details.confirmations,blockhash:details.block?util.revHex(details.block):null,blockindex:details.index,blocktime:details.time,txid:util.revHex(details.hash),walletconflicts:[],time:details.mtime,timereceived:details.mtime,"bip125-replaceable":"no",details:det,hex:details.tx.toRaw().toString("hex")});case 44:case"end":return _context18.stop()}},_callee18,this)}));return function(_x35){return _ref26.apply(this,arguments)}}(),RPC.prototype.getTransaction=function(){var _ref28=_asyncToGenerator(regeneratorRuntime.mark(function _callee19(args,help){var wallet,valid,hash,watchOnly,wtx;return regeneratorRuntime.wrap(function(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:if(!(help||args.length<1||args.length>2)){_context19.next=2;break}throw new RPCError(errs.MISC_ERROR,'gettransaction "txid" ( includeWatchonly )');case 2:if(wallet=this.wallet,valid=new Validator(args),hash=valid.rhash(0),watchOnly=valid.bool(1,!1),hash){_context19.next=8;break}throw new RPCError(errs.TYPE_ERROR,"Invalid parameter");case 8:return _context19.next=10,wallet.getTX(hash);case 10:if(wtx=_context19.sent){_context19.next=13;break}throw new RPCError(errs.WALLET_ERROR,"TX not found.");case 13:return _context19.next=15,this._toWalletTX(wtx,watchOnly);case 15:return _context19.abrupt("return",_context19.sent);case 16:case"end":return _context19.stop()}},_callee19,this)}));return function(_x36,_x37){return _ref28.apply(this,arguments)}}(),RPC.prototype.abandonTransaction=function(){var _ref29=_asyncToGenerator(regeneratorRuntime.mark(function _callee20(args,help){var wallet,valid,hash;return regeneratorRuntime.wrap(function(_context20){for(;;)switch(_context20.prev=_context20.next){case 0:if(!help&&1===args.length){_context20.next=2;break}throw new RPCError(errs.MISC_ERROR,'abandontransaction "txid"');case 2:if(wallet=this.wallet,valid=new Validator(args),hash=valid.rhash(0)){_context20.next=7;break}throw new RPCError(errs.TYPE_ERROR,"Invalid parameter.");case 7:return _context20.next=9,wallet.abandon(hash);case 9:if(_context20.sent){_context20.next=12;break}throw new RPCError(errs.WALLET_ERROR,"Transaction not in wallet.");case 12:return _context20.abrupt("return",null);case 13:case"end":return _context20.stop()}},_callee20,this)}));return function(_x38,_x39){return _ref29.apply(this,arguments)}}(),RPC.prototype.getUnconfirmedBalance=function(){var _ref30=_asyncToGenerator(regeneratorRuntime.mark(function _callee21(args,help){var wallet,balance;return regeneratorRuntime.wrap(function(_context21){for(;;)switch(_context21.prev=_context21.next){case 0:if(!(help||args.length>0)){_context21.next=2;break}throw new RPCError(errs.MISC_ERROR,"getunconfirmedbalance");case 2:return wallet=this.wallet,_context21.next=5,wallet.getBalance();case 5:return balance=_context21.sent,_context21.abrupt("return",Amount.btc(balance.unconfirmed,!0));case 7:case"end":return _context21.stop()}},_callee21,this)}));return function(_x40,_x41){return _ref30.apply(this,arguments)}}(),RPC.prototype.getWalletInfo=function(){var _ref31=_asyncToGenerator(regeneratorRuntime.mark(function _callee22(args,help){var wallet,balance;return regeneratorRuntime.wrap(function(_context22){for(;;)switch(_context22.prev=_context22.next){case 0:if(!help&&0===args.length){_context22.next=2;break}throw new RPCError(errs.MISC_ERROR,"getwalletinfo");case 2:return wallet=this.wallet,_context22.next=5,wallet.getBalance();case 5:return balance=_context22.sent,_context22.abrupt("return",{walletid:wallet.id,walletversion:6,balance:Amount.btc(balance.unconfirmed,!0),unconfirmed_balance:Amount.btc(balance.unconfirmed,!0),txcount:balance.tx,keypoololdest:0,keypoolsize:0,unlocked_until:wallet.master.until,paytxfee:Amount.btc(this.wdb.feeRate,!0)});case 7:case"end":return _context22.stop()}},_callee22,this)}));return function(_x42,_x43){return _ref31.apply(this,arguments)}}(),RPC.prototype.importPrivKey=function(){var _ref32=_asyncToGenerator(regeneratorRuntime.mark(function _callee23(args,help){var wallet,valid,secret,rescan,key;return regeneratorRuntime.wrap(function(_context23){for(;;)switch(_context23.prev=_context23.next){case 0:if(!(help||args.length<1||args.length>3)){_context23.next=2;break}throw new RPCError(errs.MISC_ERROR,'importprivkey "bitcoinprivkey" ( "label" rescan )');case 2:return wallet=this.wallet,valid=new Validator(args),secret=valid.str(0),rescan=valid.bool(2,!1),key=parseSecret(secret,this.network),_context23.next=9,wallet.importKey(0,key);case 9:if(!rescan){_context23.next=12;break}return _context23.next=12,this.wdb.rescan(0);case 12:return _context23.abrupt("return",null);case 13:case"end":return _context23.stop()}},_callee23,this)}));return function(_x44,_x45){return _ref32.apply(this,arguments)}}(),RPC.prototype.importWallet=function(){var _ref33=_asyncToGenerator(regeneratorRuntime.mark(function _callee24(args,help){var wallet,valid,file,rescan,data,lines,keys,_iterator10,_isArray10,_i10,_ref34,line,parts,secret,_iterator11,_isArray11,_i11,_ref35,key;return regeneratorRuntime.wrap(function(_context24){for(;;)switch(_context24.prev=_context24.next){case 0:if(!help&&1===args.length){_context24.next=2;break}throw new RPCError(errs.MISC_ERROR,'importwallet "filename" ( rescan )');case 2:if(wallet=this.wallet,valid=new Validator(args),file=valid.str(0),rescan=valid.bool(1,!1),!fs.unsupported){_context24.next=8;break}throw new RPCError(errs.INTERNAL_ERROR,"FS not available.");case 8:return data=void 0,_context24.prev=9,_context24.next=12,fs.readFile(file,"utf8");case 12:data=_context24.sent,_context24.next=18;break;case 15:throw _context24.prev=15,_context24.t0=_context24.catch(9),new RPCError(errs.INTERNAL_ERROR,_context24.t0.code||"");case 18:lines=data.split(/\n+/),keys=[],_iterator10=lines,_isArray10=Array.isArray(_iterator10),_i10=0,_iterator10=_isArray10?_iterator10:_iterator10[Symbol.iterator]();case 21:if(!_isArray10){_context24.next=27;break}if(!(_i10>=_iterator10.length)){_context24.next=24;break}return _context24.abrupt("break",44);case 24:_ref34=_iterator10[_i10++],_context24.next=31;break;case 27:if(!(_i10=_iterator10.next()).done){_context24.next=30;break}return _context24.abrupt("break",44);case 30:_ref34=_i10.value;case 31:if(0!==(line=(line=_ref34).trim()).length){_context24.next=35;break}return _context24.abrupt("continue",42);case 35:if(!/^\s*#/.test(line)){_context24.next=37;break}return _context24.abrupt("continue",42);case 37:if(!((parts=line.split(/\s+/)).length<4)){_context24.next=40;break}throw new RPCError(errs.DESERIALIZATION_ERROR,"Malformed wallet.");case 40:secret=parseSecret(parts[0],this.network),keys.push(secret);case 42:_context24.next=21;break;case 44:_iterator11=keys,_isArray11=Array.isArray(_iterator11),_i11=0,_iterator11=_isArray11?_iterator11:_iterator11[Symbol.iterator]();case 45:if(!_isArray11){_context24.next=51;break}if(!(_i11>=_iterator11.length)){_context24.next=48;break}return _context24.abrupt("break",60);case 48:_ref35=_iterator11[_i11++],_context24.next=55;break;case 51:if(!(_i11=_iterator11.next()).done){_context24.next=54;break}return _context24.abrupt("break",60);case 54:_ref35=_i11.value;case 55:return key=_ref35,_context24.next=58,wallet.importKey(0,key);case 58:_context24.next=45;break;case 60:if(!rescan){_context24.next=63;break}return _context24.next=63,this.wdb.rescan(0);case 63:return _context24.abrupt("return",null);case 64:case"end":return _context24.stop()}},_callee24,this,[[9,15]])}));return function(_x46,_x47){return _ref33.apply(this,arguments)}}(),RPC.prototype.importAddress=function(){var _ref36=_asyncToGenerator(regeneratorRuntime.mark(function _callee25(args,help){var wallet,valid,addr,rescan,script;return regeneratorRuntime.wrap(function(_context25){for(;;)switch(_context25.prev=_context25.next){case 0:if(!(help||args.length<1||args.length>4)){_context25.next=2;break}throw new RPCError(errs.MISC_ERROR,'importaddress "address" ( "label" rescan p2sh )');case 2:if(wallet=this.wallet,valid=new Validator(args),addr=valid.str(0,""),rescan=valid.bool(2,!1),!valid.bool(3,!1)){_context25.next=16;break}if(script=valid.buf(0)){_context25.next=11;break}throw new RPCError(errs.TYPE_ERROR,"Invalid parameters.");case 11:script=Script.fromRaw(script),script=Script.fromScripthash(script.hash160()),addr=script.getAddress(),_context25.next=17;break;case 16:addr=parseAddress(addr,this.network);case 17:return _context25.next=19,wallet.importAddress(0,addr);case 19:if(!rescan){_context25.next=22;break}return _context25.next=22,this.wdb.rescan(0);case 22:return _context25.abrupt("return",null);case 23:case"end":return _context25.stop()}},_callee25,this)}));return function(_x48,_x49){return _ref36.apply(this,arguments)}}(),RPC.prototype.importPubkey=function(){var _ref37=_asyncToGenerator(regeneratorRuntime.mark(function _callee26(args,help){var wallet,valid,data,rescan,key;return regeneratorRuntime.wrap(function(_context26){for(;;)switch(_context26.prev=_context26.next){case 0:if(!(help||args.length<1||args.length>4)){_context26.next=2;break}throw new RPCError(errs.MISC_ERROR,'importpubkey "pubkey" ( "label" rescan )');case 2:if(wallet=this.wallet,valid=new Validator(args),data=valid.buf(0),rescan=valid.bool(2,!1),data){_context26.next=8;break}throw new RPCError(errs.TYPE_ERROR,"Invalid parameter.");case 8:return key=KeyRing.fromPublic(data,this.network),_context26.next=11,wallet.importKey(0,key);case 11:if(!rescan){_context26.next=14;break}return _context26.next=14,this.wdb.rescan(0);case 14:return _context26.abrupt("return",null);case 15:case"end":return _context26.stop()}},_callee26,this)}));return function(_x50,_x51){return _ref37.apply(this,arguments)}}(),RPC.prototype.keyPoolRefill=function(){var _ref38=_asyncToGenerator(regeneratorRuntime.mark(function _callee27(args,help){return regeneratorRuntime.wrap(function(_context27){for(;;)switch(_context27.prev=_context27.next){case 0:if(!(help||args.length>1)){_context27.next=2;break}throw new RPCError(errs.MISC_ERROR,"keypoolrefill ( newsize )");case 2:return _context27.abrupt("return",null);case 3:case"end":return _context27.stop()}},_callee27,this)}));return function(_x52,_x53){return _ref38.apply(this,arguments)}}(),RPC.prototype.listAccounts=function(){var _ref39=_asyncToGenerator(regeneratorRuntime.mark(function _callee28(args,help){var wallet,valid,minconf,watchOnly,accounts,map,_iterator12,_isArray12,_i12,_ref40,account,balance,value;return regeneratorRuntime.wrap(function(_context28){for(;;)switch(_context28.prev=_context28.next){case 0:if(!(help||args.length>2)){_context28.next=2;break}throw new RPCError(errs.MISC_ERROR,"listaccounts ( minconf includeWatchonly)");case 2:return wallet=this.wallet,valid=new Validator(args),minconf=valid.u32(0,0),watchOnly=valid.bool(1,!1),_context28.next=8,wallet.getAccounts();case 8:accounts=_context28.sent,map={},_iterator12=accounts,_isArray12=Array.isArray(_iterator12),_i12=0,_iterator12=_isArray12?_iterator12:_iterator12[Symbol.iterator]();case 11:if(!_isArray12){_context28.next=17;break}if(!(_i12>=_iterator12.length)){_context28.next=14;break}return _context28.abrupt("break",31);case 14:_ref40=_iterator12[_i12++],_context28.next=21;break;case 17:if(!(_i12=_iterator12.next()).done){_context28.next=20;break}return _context28.abrupt("break",31);case 20:_ref40=_i12.value;case 21:return account=_ref40,_context28.next=24,wallet.getBalance(account);case 24:balance=_context28.sent,value=balance.unconfirmed,minconf>0&&(value=balance.confirmed),wallet.watchOnly!==watchOnly&&(value=0),map[account]=Amount.btc(value,!0);case 29:_context28.next=11;break;case 31:return _context28.abrupt("return",map);case 32:case"end":return _context28.stop()}},_callee28,this)}));return function(_x54,_x55){return _ref39.apply(this,arguments)}}(),RPC.prototype.listAddressGroupings=function(){var _ref41=_asyncToGenerator(regeneratorRuntime.mark(function _callee29(args,help){return regeneratorRuntime.wrap(function(_context29){for(;;)switch(_context29.prev=_context29.next){case 0:if(!help){_context29.next=2;break}throw new RPCError(errs.MISC_ERROR,"listaddressgroupings");case 2:throw new Error("Not implemented.");case 3:case"end":return _context29.stop()}},_callee29,this)}));return function(_x56,_x57){return _ref41.apply(this,arguments)}}(),RPC.prototype.listLockUnspent=function(){var _ref42=_asyncToGenerator(regeneratorRuntime.mark(function _callee30(args,help){var wallet,outpoints,out,_iterator13,_isArray13,_i13,_ref43,outpoint;return regeneratorRuntime.wrap(function(_context30){for(;;)switch(_context30.prev=_context30.next){case 0:if(!(help||args.length>0)){_context30.next=2;break}throw new RPCError(errs.MISC_ERROR,"listlockunspent");case 2:wallet=this.wallet,outpoints=wallet.getLocked(),out=[],_iterator13=outpoints,_isArray13=Array.isArray(_iterator13),_i13=0,_iterator13=_isArray13?_iterator13:_iterator13[Symbol.iterator]();case 6:if(!_isArray13){_context30.next=12;break}if(!(_i13>=_iterator13.length)){_context30.next=9;break}return _context30.abrupt("break",20);case 9:_ref43=_iterator13[_i13++],_context30.next=16;break;case 12:if(!(_i13=_iterator13.next()).done){_context30.next=15;break}return _context30.abrupt("break",20);case 15:_ref43=_i13.value;case 16:outpoint=_ref43,out.push({txid:outpoint.txid(),vout:outpoint.index});case 18:_context30.next=6;break;case 20:return _context30.abrupt("return",out);case 21:case"end":return _context30.stop()}},_callee30,this)}));return function(_x58,_x59){return _ref42.apply(this,arguments)}}(),RPC.prototype.listReceivedByAccount=function(){var _ref44=_asyncToGenerator(regeneratorRuntime.mark(function _callee31(args,help){var valid,minconf,includeEmpty,watchOnly;return regeneratorRuntime.wrap(function(_context31){for(;;)switch(_context31.prev=_context31.next){case 0:if(!(help||args.length>3)){_context31.next=2;break}throw new RPCError(errs.MISC_ERROR,"listreceivedbyaccount ( minconf includeempty includeWatchonly )");case 2:return valid=new Validator(args),minconf=valid.u32(0,0),includeEmpty=valid.bool(1,!1),watchOnly=valid.bool(2,!1),_context31.next=8,this._listReceived(minconf,includeEmpty,watchOnly,!0);case 8:return _context31.abrupt("return",_context31.sent);case 9:case"end":return _context31.stop()}},_callee31,this)}));return function(_x60,_x61){return _ref44.apply(this,arguments)}}(),RPC.prototype.listReceivedByAddress=function(){var _ref45=_asyncToGenerator(regeneratorRuntime.mark(function _callee32(args,help){var valid,minconf,includeEmpty,watchOnly;return regeneratorRuntime.wrap(function(_context32){for(;;)switch(_context32.prev=_context32.next){case 0:if(!(help||args.length>3)){_context32.next=2;break}throw new RPCError(errs.MISC_ERROR,"listreceivedbyaddress ( minconf includeempty includeWatchonly )");case 2:return valid=new Validator(args),minconf=valid.u32(0,0),includeEmpty=valid.bool(1,!1),watchOnly=valid.bool(2,!1),_context32.next=8,this._listReceived(minconf,includeEmpty,watchOnly,!1);case 8:return _context32.abrupt("return",_context32.sent);case 9:case"end":return _context32.stop()}},_callee32,this)}));return function(_x62,_x63){return _ref45.apply(this,arguments)}}(),RPC.prototype._listReceived=function(){var _ref46=_asyncToGenerator(regeneratorRuntime.mark(function _callee33(minconf,empty,watchOnly,account){var wallet,paths,height,map,_iterator14,_isArray14,_i14,_ref47,path,addr,txs,_iterator15,_isArray15,_i15,_ref48,wtx,conf,_iterator20,_isArray20,_i20,_ref53,output,_addr,hash,_entry4,out,_iterator16,_isArray16,_i16,_ref49,entry,_map,_iterator17,_isArray17,_i17,_ref50,_entry,item,_iterator18,_isArray18,_i18,_ref51,_entry2,result,_iterator19,_isArray19,_i19,_ref52,_entry3;return regeneratorRuntime.wrap(function(_context33){for(;;)switch(_context33.prev=_context33.next){case 0:return wallet=this.wallet,_context33.next=3,wallet.getPaths();case 3:paths=_context33.sent,height=this.wdb.state.height,map=new Map,_iterator14=paths,_isArray14=Array.isArray(_iterator14),_i14=0,_iterator14=_isArray14?_iterator14:_iterator14[Symbol.iterator]();case 7:if(!_isArray14){_context33.next=13;break}if(!(_i14>=_iterator14.length)){_context33.next=10;break}return _context33.abrupt("break",22);case 10:_ref47=_iterator14[_i14++],_context33.next=17;break;case 13:if(!(_i14=_iterator14.next()).done){_context33.next=16;break}return _context33.abrupt("break",22);case 16:_ref47=_i14.value;case 17:addr=(path=_ref47).toAddress(),map.set(path.hash,{involvesWatchonly:wallet.watchOnly,address:addr.toString(this.network),account:path.name,amount:0,confirmations:-1,label:""});case 20:_context33.next=7;break;case 22:return _context33.next=24,wallet.getHistory();case 24:txs=_context33.sent,_iterator15=txs,_isArray15=Array.isArray(_iterator15),_i15=0,_iterator15=_isArray15?_iterator15:_iterator15[Symbol.iterator]();case 26:if(!_isArray15){_context33.next=32;break}if(!(_i15>=_iterator15.length)){_context33.next=29;break}return _context33.abrupt("break",62);case 29:_ref48=_iterator15[_i15++],_context33.next=36;break;case 32:if(!(_i15=_iterator15.next()).done){_context33.next=35;break}return _context33.abrupt("break",62);case 35:_ref48=_i15.value;case 36:if(!((conf=(wtx=_ref48).getDepth(height))<minconf)){_context33.next=40;break}return _context33.abrupt("continue",60);case 40:_iterator20=wtx.tx.outputs,_isArray20=Array.isArray(_iterator20),_i20=0,_iterator20=_isArray20?_iterator20:_iterator20[Symbol.iterator]();case 41:if(!_isArray20){_context33.next=47;break}if(!(_i20>=_iterator20.length)){_context33.next=44;break}return _context33.abrupt("break",60);case 44:_ref53=_iterator20[_i20++],_context33.next=51;break;case 47:if(!(_i20=_iterator20.next()).done){_context33.next=50;break}return _context33.abrupt("break",60);case 50:_ref53=_i20.value;case 51:if(_addr=(output=_ref53).getAddress()){_context33.next=55;break}return _context33.abrupt("continue",58);case 55:hash=_addr.getHash("hex"),(_entry4=map.get(hash))&&((-1===_entry4.confirmations||conf<_entry4.confirmations)&&(_entry4.confirmations=conf),_entry4.address=_addr.toString(this.network),_entry4.amount+=output.value);case 58:_context33.next=41;break;case 60:_context33.next=26;break;case 62:out=[],_iterator16=map.values(),_isArray16=Array.isArray(_iterator16),_i16=0,_iterator16=_isArray16?_iterator16:_iterator16[Symbol.iterator]();case 64:if(!_isArray16){_context33.next=70;break}if(!(_i16>=_iterator16.length)){_context33.next=67;break}return _context33.abrupt("break",78);case 67:_ref49=_iterator16[_i16++],_context33.next=74;break;case 70:if(!(_i16=_iterator16.next()).done){_context33.next=73;break}return _context33.abrupt("break",78);case 73:_ref49=_i16.value;case 74:entry=_ref49,out.push(entry);case 76:_context33.next=64;break;case 78:if(!account){_context33.next=116;break}_map=new Map,_iterator17=out,_isArray17=Array.isArray(_iterator17),_i17=0,_iterator17=_isArray17?_iterator17:_iterator17[Symbol.iterator]();case 81:if(!_isArray17){_context33.next=87;break}if(!(_i17>=_iterator17.length)){_context33.next=84;break}return _context33.abrupt("break",100);case 84:_ref50=_iterator17[_i17++],_context33.next=91;break;case 87:if(!(_i17=_iterator17.next()).done){_context33.next=90;break}return _context33.abrupt("break",100);case 90:_ref50=_i17.value;case 91:if(_entry=_ref50,item=_map.get(_entry.account)){_context33.next=97;break}return _map.set(_entry.account,_entry),_entry.address=void 0,_context33.abrupt("continue",98);case 97:item.amount+=_entry.amount;case 98:_context33.next=81;break;case 100:out=[],_iterator18=_map.values(),_isArray18=Array.isArray(_iterator18),_i18=0,_iterator18=_isArray18?_iterator18:_iterator18[Symbol.iterator]();case 102:if(!_isArray18){_context33.next=108;break}if(!(_i18>=_iterator18.length)){_context33.next=105;break}return _context33.abrupt("break",116);case 105:_ref51=_iterator18[_i18++],_context33.next=112;break;case 108:if(!(_i18=_iterator18.next()).done){_context33.next=111;break}return _context33.abrupt("break",116);case 111:_ref51=_i18.value;case 112:_entry2=_ref51,out.push(_entry2);case 114:_context33.next=102;break;case 116:result=[],_iterator19=out,_isArray19=Array.isArray(_iterator19),_i19=0,_iterator19=_isArray19?_iterator19:_iterator19[Symbol.iterator]();case 118:if(!_isArray19){_context33.next=124;break}if(!(_i19>=_iterator19.length)){_context33.next=121;break}return _context33.abrupt("break",136);case 121:_ref52=_iterator19[_i19++],_context33.next=128;break;case 124:if(!(_i19=_iterator19.next()).done){_context33.next=127;break}return _context33.abrupt("break",136);case 127:_ref52=_i19.value;case 128:if(_entry3=_ref52,empty||0!==_entry3.amount){_context33.next=131;break}return _context33.abrupt("continue",134);case 131:-1===_entry3.confirmations&&(_entry3.confirmations=0),_entry3.amount=Amount.btc(_entry3.amount,!0),result.push(_entry3);case 134:_context33.next=118;break;case 136:return _context33.abrupt("return",result);case 137:case"end":return _context33.stop()}},_callee33,this)}));return function(_x64,_x65,_x66,_x67){return _ref46.apply(this,arguments)}}(),RPC.prototype.listSinceBlock=function(){var _ref54=_asyncToGenerator(regeneratorRuntime.mark(function _callee34(args,help){var wallet,chainHeight,valid,block,minconf,watchOnly,height,entry,txs,out,highest,_iterator21,_isArray21,_i21,_ref55,wtx,json;return regeneratorRuntime.wrap(function(_context34){for(;;)switch(_context34.prev=_context34.next){case 0:if(wallet=this.wallet,chainHeight=this.wdb.state.height,valid=new Validator(args),block=valid.rhash(0),minconf=valid.u32(1,0),watchOnly=valid.bool(2,!1),!help){_context34.next=8;break}throw new RPCError(errs.MISC_ERROR,'listsinceblock ( "blockhash" target-confirmations includeWatchonly)');case 8:if(wallet.watchOnly===watchOnly){_context34.next=10;break}return _context34.abrupt("return",[]);case 10:if(height=-1,!block){_context34.next=16;break}return _context34.next=14,this.client.getEntry(block);case 14:(entry=_context34.sent)&&(height=entry.height);case 16:return-1===height&&(height=this.chain.height),_context34.next=19,wallet.getHistory();case 19:txs=_context34.sent,out=[],highest=null,_iterator21=txs,_isArray21=Array.isArray(_iterator21),_i21=0,_iterator21=_isArray21?_iterator21:_iterator21[Symbol.iterator]();case 23:if(!_isArray21){_context34.next=29;break}if(!(_i21>=_iterator21.length)){_context34.next=26;break}return _context34.abrupt("break",45);case 26:_ref55=_iterator21[_i21++],_context34.next=33;break;case 29:if(!(_i21=_iterator21.next()).done){_context34.next=32;break}return _context34.abrupt("break",45);case 32:_ref55=_i21.value;case 33:if(!((wtx=_ref55).height<height)){_context34.next=36;break}return _context34.abrupt("continue",43);case 36:if(!(wtx.getDepth(chainHeight)<minconf)){_context34.next=38;break}return _context34.abrupt("continue",43);case 38:return(!highest||wtx.height>highest)&&(highest=wtx),_context34.next=41,this._toListTX(wtx);case 41:json=_context34.sent,out.push(json);case 43:_context34.next=23;break;case 45:return _context34.abrupt("return",{transactions:out,lastblock:highest&&highest.block?util.revHex(highest.block):consensus.NULL_HASH});case 46:case"end":return _context34.stop()}},_callee34,this)}));return function(_x68,_x69){return _ref54.apply(this,arguments)}}(),RPC.prototype._toListTX=function(){var _ref56=_asyncToGenerator(regeneratorRuntime.mark(function _callee35(wtx){var wallet,details,receive,_iterator22,_isArray22,_i22,_ref57,sent,received,sendMember,recMember,sendIndex,recIndex,i,_member3,member,index,rbf;return regeneratorRuntime.wrap(function(_context35){for(;;)switch(_context35.prev=_context35.next){case 0:return wallet=this.wallet,_context35.next=3,wallet.toDetails(wtx);case 3:if(details=_context35.sent){_context35.next=6;break}throw new RPCError(errs.WALLET_ERROR,"TX not found.");case 6:receive=!0,_iterator22=details.inputs,_isArray22=Array.isArray(_iterator22),_i22=0,_iterator22=_isArray22?_iterator22:_iterator22[Symbol.iterator]();case 8:if(!_isArray22){_context35.next=14;break}if(!(_i22>=_iterator22.length)){_context35.next=11;break}return _context35.abrupt("break",24);case 11:_ref57=_iterator22[_i22++],_context35.next=18;break;case 14:if(!(_i22=_iterator22.next()).done){_context35.next=17;break}return _context35.abrupt("break",24);case 17:_ref57=_i22.value;case 18:if(!_ref57.path){_context35.next=22;break}return receive=!1,_context35.abrupt("break",24);case 22:_context35.next=8;break;case 24:sent=0,received=0,sendMember=null,recMember=null,sendIndex=-1,recIndex=-1,i=0;case 31:if(!(i<details.outputs.length)){_context35.next=46;break}if(!(_member3=details.outputs[i]).path){_context35.next=40;break}if(1!==_member3.path.branch){_context35.next=36;break}return _context35.abrupt("continue",43);case 36:return received+=_member3.value,recMember=_member3,recIndex=i,_context35.abrupt("continue",43);case 40:sent+=_member3.value,sendMember=_member3,sendIndex=i;case 43:i++,_context35.next=31;break;case 46:return member=null,index=-1,receive?(assert(recMember),member=recMember,index=recIndex):sendMember?(member=sendMember,index=sendIndex):(receive=!0,received=0,member=recMember,index=recIndex),rbf=!1,-1===wtx.height&&wtx.tx.isRBF()&&(rbf=!0),_context35.abrupt("return",{account:member.path?member.path.name:"",address:member.address?member.address.toString(this.network):null,category:receive?"receive":"send",amount:Amount.btc(receive?received:-sent,!0),label:member.path?member.path.name:void 0,vout:index,confirmations:details.getDepth(this.wdb.height),blockhash:details.block?util.revHex(details.block):null,blockindex:-1,blocktime:details.time,blockheight:details.height,txid:util.revHex(details.hash),walletconflicts:[],time:details.mtime,timereceived:details.mtime,"bip125-replaceable":rbf?"yes":"no"});case 52:case"end":return _context35.stop()}},_callee35,this)}));return function(_x70){return _ref56.apply(this,arguments)}}(),RPC.prototype.listTransactions=function(){var _ref58=_asyncToGenerator(regeneratorRuntime.mark(function _callee36(args,help){var wallet,valid,name,count,from,watchOnly,txs,end,to,out,i,wtx,json;return regeneratorRuntime.wrap(function(_context36){for(;;)switch(_context36.prev=_context36.next){case 0:if(!(help||args.length>4)){_context36.next=2;break}throw new RPCError(errs.MISC_ERROR,'listtransactions ( "account" count from includeWatchonly)');case 2:if(wallet=this.wallet,valid=new Validator(args),name=valid.str(0),count=valid.u32(1,10),from=valid.u32(2,0),watchOnly=valid.bool(3,!1),wallet.watchOnly===watchOnly){_context36.next=10;break}return _context36.abrupt("return",[]);case 10:return""===name&&(name="default"),_context36.next=13,wallet.getHistory();case 13:txs=_context36.sent,common.sortTX(txs),end=from+count,to=Math.min(end,txs.length),out=[],i=from;case 19:if(!(i<to)){_context36.next=28;break}return wtx=txs[i],_context36.next=23,this._toListTX(wtx);case 23:json=_context36.sent,out.push(json);case 25:i++,_context36.next=19;break;case 28:return _context36.abrupt("return",out);case 29:case"end":return _context36.stop()}},_callee36,this)}));return function(_x71,_x72){return _ref58.apply(this,arguments)}}(),RPC.prototype.listUnspent=function(){var _ref59=_asyncToGenerator(regeneratorRuntime.mark(function _callee37(args,help){var wallet,valid,minDepth,maxDepth,addrs,height,map,_valid2,i,addr,hash,coins,out,_iterator23,_isArray23,_i23,_ref60,coin,depth,_addr2,_hash,ring;return regeneratorRuntime.wrap(function(_context37){for(;;)switch(_context37.prev=_context37.next){case 0:if(!(help||args.length>3)){_context37.next=2;break}throw new RPCError(errs.MISC_ERROR,'listunspent ( minconf maxconf  ["address",...] )');case 2:if(wallet=this.wallet,valid=new Validator(args),minDepth=valid.u32(0,1),maxDepth=valid.u32(1,9999999),addrs=valid.array(2),height=this.wdb.state.height,map=new Set,!addrs){_context37.next=21;break}_valid2=new Validator(addrs),i=0;case 12:if(!(i<addrs.length)){_context37.next=21;break}if(addr=_valid2.str(i,""),hash=parseHash(addr,this.network),!map.has(hash)){_context37.next=17;break}throw new RPCError(errs.INVALID_PARAMETER,"Duplicate address.");case 17:map.add(hash);case 18:i++,_context37.next=12;break;case 21:return _context37.next=23,wallet.getCoins();case 23:coins=_context37.sent,common.sortCoins(coins),out=[],_iterator23=coins,_isArray23=Array.isArray(_iterator23),_i23=0,_iterator23=_isArray23?_iterator23:_iterator23[Symbol.iterator]();case 27:if(!_isArray23){_context37.next=33;break}if(!(_i23>=_iterator23.length)){_context37.next=30;break}return _context37.abrupt("break",54);case 30:_ref60=_iterator23[_i23++],_context37.next=37;break;case 33:if(!(_i23=_iterator23.next()).done){_context37.next=36;break}return _context37.abrupt("break",54);case 36:_ref60=_i23.value;case 37:if(!((depth=(coin=_ref60).getDepth(height))<minDepth||depth>maxDepth)){_context37.next=41;break}return _context37.abrupt("continue",52);case 41:if(_addr2=coin.getAddress()){_context37.next=44;break}return _context37.abrupt("continue",52);case 44:if(_hash=coin.getHash("hex"),!addrs){_context37.next=48;break}if(_hash&&map.has(_hash)){_context37.next=48;break}return _context37.abrupt("continue",52);case 48:return _context37.next=50,wallet.getKey(_hash);case 50:ring=_context37.sent,out.push({txid:coin.txid(),vout:coin.index,address:_addr2?_addr2.toString(this.network):null,account:ring?ring.name:void 0,redeemScript:ring&&ring.script?ring.script.toJSON():void 0,scriptPubKey:coin.script.toJSON(),amount:Amount.btc(coin.value,!0),confirmations:depth,spendable:!wallet.isLocked(coin),solvable:!0});case 52:_context37.next=27;break;case 54:return _context37.abrupt("return",out);case 55:case"end":return _context37.stop()}},_callee37,this)}));return function(_x73,_x74){return _ref59.apply(this,arguments)}}(),RPC.prototype.lockUnspent=function(){var _ref61=_asyncToGenerator(regeneratorRuntime.mark(function _callee38(args,help){var wallet,valid,unlock,outputs,_iterator24,_isArray24,_i24,_ref62,_valid3,hash,index,outpoint;return regeneratorRuntime.wrap(function(_context38){for(;;)switch(_context38.prev=_context38.next){case 0:if(!(help||args.length<1||args.length>2)){_context38.next=2;break}throw new RPCError(errs.MISC_ERROR,'lockunspent unlock ([{"txid":"txid","vout":n},...])');case 2:if(wallet=this.wallet,valid=new Validator(args),unlock=valid.bool(0,!1),outputs=valid.array(1),1!==args.length){_context38.next=9;break}return unlock&&wallet.unlockCoins(),_context38.abrupt("return",!0);case 9:if(outputs){_context38.next=11;break}throw new RPCError(errs.TYPE_ERROR,"Invalid parameter.");case 11:_iterator24=outputs,_isArray24=Array.isArray(_iterator24),_i24=0,_iterator24=_isArray24?_iterator24:_iterator24[Symbol.iterator]();case 12:if(!_isArray24){_context38.next=18;break}if(!(_i24>=_iterator24.length)){_context38.next=15;break}return _context38.abrupt("break",35);case 15:_ref62=_iterator24[_i24++],_context38.next=22;break;case 18:if(!(_i24=_iterator24.next()).done){_context38.next=21;break}return _context38.abrupt("break",35);case 21:_ref62=_i24.value;case 22:if(_valid3=new Validator(_ref62),hash=_valid3.rhash("txid"),index=_valid3.u32("vout"),null!=hash&&null!=index){_context38.next=28;break}throw new RPCError(errs.INVALID_PARAMETER,"Invalid parameter.");case 28:if(outpoint=new Outpoint(hash,index),!unlock){_context38.next=32;break}return wallet.unlockCoin(outpoint),_context38.abrupt("continue",33);case 32:wallet.lockCoin(outpoint);case 33:_context38.next=12;break;case 35:return _context38.abrupt("return",!0);case 36:case"end":return _context38.stop()}},_callee38,this)}));return function(_x75,_x76){return _ref61.apply(this,arguments)}}(),RPC.prototype.move=function(){var _ref63=_asyncToGenerator(regeneratorRuntime.mark(function _callee39(args,help){return regeneratorRuntime.wrap(function(_context39){for(;;)switch(_context39.prev=_context39.next){case 0:throw new Error("Not implemented.");case 1:case"end":return _context39.stop()}},_callee39,this)}));return function(_x77,_x78){return _ref63.apply(this,arguments)}}(),RPC.prototype.sendFrom=function(){var _ref64=_asyncToGenerator(regeneratorRuntime.mark(function _callee40(args,help){var wallet,valid,name,str,value,minconf,addr,options,tx;return regeneratorRuntime.wrap(function(_context40){for(;;)switch(_context40.prev=_context40.next){case 0:if(!(help||args.length<3||args.length>6)){_context40.next=2;break}throw new RPCError(errs.MISC_ERROR,'sendfrom "fromaccount" "tobitcoinaddress" amount ( minconf "comment" "comment-to" )');case 2:if(wallet=this.wallet,valid=new Validator(args),name=valid.str(0),str=valid.str(1),value=valid.ufixed(2,8),minconf=valid.u32(3,0),(addr=parseAddress(str,this.network))&&null!=value){_context40.next=11;break}throw new RPCError(errs.TYPE_ERROR,"Invalid parameter.");case 11:return""===name&&(name="default"),options={account:name,depth:minconf,outputs:[{address:addr,value:value}]},_context40.next=15,wallet.send(options);case 15:return tx=_context40.sent,_context40.abrupt("return",tx.txid());case 17:case"end":return _context40.stop()}},_callee40,this)}));return function(_x79,_x80){return _ref64.apply(this,arguments)}}(),RPC.prototype.sendMany=function(){var _ref65=_asyncToGenerator(regeneratorRuntime.mark(function _callee41(args,help){var wallet,valid,name,sendTo,minconf,subtract,to,uniq,outputs,_iterator25,_isArray25,_i25,_ref66,key,value,addr,hash,output,options,tx;return regeneratorRuntime.wrap(function(_context41){for(;;)switch(_context41.prev=_context41.next){case 0:if(!(help||args.length<2||args.length>5)){_context41.next=2;break}throw new RPCError(errs.MISC_ERROR,'sendmany "fromaccount" {"address":amount,...} ( minconf "comment" ["address",...] )');case 2:if(wallet=this.wallet,valid=new Validator(args),name=valid.str(0),sendTo=valid.obj(1),minconf=valid.u32(2,1),subtract=valid.bool(4,!1),""===name&&(name="default"),sendTo){_context41.next=11;break}throw new RPCError(errs.TYPE_ERROR,"Invalid parameter.");case 11:to=new Validator(sendTo),uniq=new Set,outputs=[],_iterator25=Object.keys(sendTo),_isArray25=Array.isArray(_iterator25),_i25=0,_iterator25=_isArray25?_iterator25:_iterator25[Symbol.iterator]();case 15:if(!_isArray25){_context41.next=21;break}if(!(_i25>=_iterator25.length)){_context41.next=18;break}return _context41.abrupt("break",40);case 18:_ref66=_iterator25[_i25++],_context41.next=25;break;case 21:if(!(_i25=_iterator25.next()).done){_context41.next=24;break}return _context41.abrupt("break",40);case 24:_ref66=_i25.value;case 25:if(key=_ref66,value=to.ufixed(key,8),addr=parseAddress(key,this.network),hash=addr.getHash("hex"),null!=value){_context41.next=31;break}throw new RPCError(errs.INVALID_PARAMETER,"Invalid parameter.");case 31:if(!uniq.has(hash)){_context41.next=33;break}throw new RPCError(errs.INVALID_PARAMETER,"Invalid parameter.");case 33:uniq.add(hash),(output=new Output).value=value,output.script.fromAddress(addr),outputs.push(output);case 38:_context41.next=15;break;case 40:return options={outputs:outputs,subtractFee:subtract,account:name,depth:minconf},_context41.next=43,wallet.send(options);case 43:return tx=_context41.sent,_context41.abrupt("return",tx.txid());case 45:case"end":return _context41.stop()}},_callee41,this)}));return function(_x81,_x82){return _ref65.apply(this,arguments)}}(),RPC.prototype.sendToAddress=function(){var _ref67=_asyncToGenerator(regeneratorRuntime.mark(function _callee42(args,help){var wallet,valid,str,value,subtract,addr,options,tx;return regeneratorRuntime.wrap(function(_context42){for(;;)switch(_context42.prev=_context42.next){case 0:if(!(help||args.length<2||args.length>5)){_context42.next=2;break}throw new RPCError(errs.MISC_ERROR,'sendtoaddress "bitcoinaddress" amount ( "comment" "comment-to" subtractfeefromamount )');case 2:if(wallet=this.wallet,valid=new Validator(args),str=valid.str(0),value=valid.ufixed(1,8),subtract=valid.bool(4,!1),(addr=parseAddress(str,this.network))&&null!=value){_context42.next=10;break}throw new RPCError(errs.TYPE_ERROR,"Invalid parameter.");case 10:return options={subtractFee:subtract,outputs:[{address:addr,value:value}]},_context42.next=13,wallet.send(options);case 13:return tx=_context42.sent,_context42.abrupt("return",tx.txid());case 15:case"end":return _context42.stop()}},_callee42,this)}));return function(_x83,_x84){return _ref67.apply(this,arguments)}}(),RPC.prototype.setAccount=function(){var _ref68=_asyncToGenerator(regeneratorRuntime.mark(function _callee43(args,help){return regeneratorRuntime.wrap(function(_context43){for(;;)switch(_context43.prev=_context43.next){case 0:if(!(help||args.length<1||args.length>2)){_context43.next=2;break}throw new RPCError(errs.MISC_ERROR,'setaccount "bitcoinaddress" "account"');case 2:throw new Error("Not implemented.");case 3:case"end":return _context43.stop()}},_callee43,this)}));return function(_x85,_x86){return _ref68.apply(this,arguments)}}(),RPC.prototype.setTXFee=function(){var _ref69=_asyncToGenerator(regeneratorRuntime.mark(function _callee44(args,help){var valid,rate;return regeneratorRuntime.wrap(function(_context44){for(;;)switch(_context44.prev=_context44.next){case 0:if(valid=new Validator(args),rate=valid.ufixed(0,8),!(help||args.length<1||args.length>1)){_context44.next=4;break}throw new RPCError(errs.MISC_ERROR,"settxfee amount");case 4:if(null!=rate){_context44.next=6;break}throw new RPCError(errs.TYPE_ERROR,"Invalid parameter.");case 6:return this.wdb.feeRate=rate,_context44.abrupt("return",!0);case 8:case"end":return _context44.stop()}},_callee44,this)}));return function(_x87,_x88){return _ref69.apply(this,arguments)}}(),RPC.prototype.signMessage=function(){var _ref70=_asyncToGenerator(regeneratorRuntime.mark(function _callee45(args,help){var wallet,valid,b58,str,addr,ring,msg,hash,sig;return regeneratorRuntime.wrap(function(_context45){for(;;)switch(_context45.prev=_context45.next){case 0:if(!help&&2===args.length){_context45.next=2;break}throw new RPCError(errs.MISC_ERROR,'signmessage "bitcoinaddress" "message"');case 2:return wallet=this.wallet,valid=new Validator(args),b58=valid.str(0,""),str=valid.str(1,""),addr=parseHash(b58,this.network),_context45.next=9,wallet.getKey(addr);case 9:if(ring=_context45.sent){_context45.next=12;break}throw new RPCError(errs.WALLET_ERROR,"Address not found.");case 12:if(wallet.master.key){_context45.next=14;break}throw new RPCError(errs.WALLET_UNLOCK_NEEDED,"Wallet is locked.");case 14:return msg=Buffer.from("Bitcoin Signed Message:\n"+str,"utf8"),hash=hash256.digest(msg),sig=ring.sign(hash),_context45.abrupt("return",sig.toString("base64"));case 18:case"end":return _context45.stop()}},_callee45,this)}));return function(_x89,_x90){return _ref70.apply(this,arguments)}}(),RPC.prototype.walletLock=function(){var _ref71=_asyncToGenerator(regeneratorRuntime.mark(function _callee46(args,help){var wallet;return regeneratorRuntime.wrap(function(_context46){for(;;)switch(_context46.prev=_context46.next){case 0:if(wallet=this.wallet,!(help||wallet.master.encrypted&&0!==args.length)){_context46.next=3;break}throw new RPCError(errs.MISC_ERROR,"walletlock");case 3:if(wallet.master.encrypted){_context46.next=5;break}throw new RPCError(errs.WALLET_WRONG_ENC_STATE,"Wallet is not encrypted.");case 5:return _context46.next=7,wallet.lock();case 7:return _context46.abrupt("return",null);case 8:case"end":return _context46.stop()}},_callee46,this)}));return function(_x91,_x92){return _ref71.apply(this,arguments)}}(),RPC.prototype.walletPassphraseChange=function(){var _ref72=_asyncToGenerator(regeneratorRuntime.mark(function _callee47(args,help){var wallet,valid,old,passphrase;return regeneratorRuntime.wrap(function(_context47){for(;;)switch(_context47.prev=_context47.next){case 0:if(wallet=this.wallet,!(help||wallet.master.encrypted&&2!==args.length)){_context47.next=3;break}throw new RPCError(errs.MISC_ERROR,'walletpassphrasechange "oldpassphrase" "newpassphrase"');case 3:if(valid=new Validator(args),old=valid.str(0,""),passphrase=valid.str(1,""),wallet.master.encrypted){_context47.next=8;break}throw new RPCError(errs.WALLET_WRONG_ENC_STATE,"Wallet is not encrypted.");case 8:if(!(old.length<1||passphrase.length<1)){_context47.next=10;break}throw new RPCError(errs.INVALID_PARAMETER,"Invalid parameter");case 10:return _context47.next=12,wallet.setPassphrase(passphrase,old);case 12:return _context47.abrupt("return",null);case 13:case"end":return _context47.stop()}},_callee47,this)}));return function(_x93,_x94){return _ref72.apply(this,arguments)}}(),RPC.prototype.walletPassphrase=function(){var _ref73=_asyncToGenerator(regeneratorRuntime.mark(function _callee48(args,help){var wallet,valid,passphrase,timeout;return regeneratorRuntime.wrap(function(_context48){for(;;)switch(_context48.prev=_context48.next){case 0:if(wallet=this.wallet,valid=new Validator(args),passphrase=valid.str(0,""),timeout=valid.u32(1),!(help||wallet.master.encrypted&&2!==args.length)){_context48.next=6;break}throw new RPCError(errs.MISC_ERROR,'walletpassphrase "passphrase" timeout');case 6:if(wallet.master.encrypted){_context48.next=8;break}throw new RPCError(errs.WALLET_WRONG_ENC_STATE,"Wallet is not encrypted.");case 8:if(!(passphrase.length<1)){_context48.next=10;break}throw new RPCError(errs.INVALID_PARAMETER,"Invalid parameter");case 10:if(null!=timeout){_context48.next=12;break}throw new RPCError(errs.TYPE_ERROR,"Invalid parameter");case 12:return _context48.next=14,wallet.unlock(passphrase,timeout);case 14:return _context48.abrupt("return",null);case 15:case"end":return _context48.stop()}},_callee48,this)}));return function(_x95,_x96){return _ref73.apply(this,arguments)}}(),RPC.prototype.importPrunedFunds=function(){var _ref74=_asyncToGenerator(regeneratorRuntime.mark(function _callee49(args,help){var valid,txRaw,blockRaw,tx,block,hash,height,entry;return regeneratorRuntime.wrap(function(_context49){for(;;)switch(_context49.prev=_context49.next){case 0:if(!(help||args.length<2||args.length>3)){_context49.next=2;break}throw new RPCError(errs.MISC_ERROR,'importprunedfunds "rawtransaction" "txoutproof" ( "label" )');case 2:if(valid=new Validator(args),txRaw=valid.buf(0),blockRaw=valid.buf(1),txRaw&&blockRaw){_context49.next=7;break}throw new RPCError(errs.TYPE_ERROR,"Invalid parameter.");case 7:if(tx=TX.fromRaw(txRaw),block=MerkleBlock.fromRaw(blockRaw),hash=block.hash("hex"),block.verify()){_context49.next=12;break}throw new RPCError(errs.VERIFY_ERROR,"Invalid proof.");case 12:if(block.hasTX(tx.hash("hex"))){_context49.next=14;break}throw new RPCError(errs.VERIFY_ERROR,"Invalid proof.");case 14:return _context49.next=16,this.client.getEntry(hash);case 16:if(-1!==(height=_context49.sent)){_context49.next=19;break}throw new RPCError(errs.VERIFY_ERROR,"Invalid proof.");case 19:return entry={hash:hash,time:block.time,height:height},_context49.next=22,this.wdb.addTX(tx,entry);case 22:if(_context49.sent){_context49.next=24;break}throw new RPCError(errs.WALLET_ERROR,"No tracked address for TX.");case 24:return _context49.abrupt("return",null);case 25:case"end":return _context49.stop()}},_callee49,this)}));return function(_x97,_x98){return _ref74.apply(this,arguments)}}(),RPC.prototype.removePrunedFunds=function(){var _ref75=_asyncToGenerator(regeneratorRuntime.mark(function _callee50(args,help){var wallet,valid,hash;return regeneratorRuntime.wrap(function(_context50){for(;;)switch(_context50.prev=_context50.next){case 0:if(!help&&1===args.length){_context50.next=2;break}throw new RPCError(errs.MISC_ERROR,'removeprunedfunds "txid"');case 2:if(wallet=this.wallet,valid=new Validator(args),hash=valid.rhash(0)){_context50.next=7;break}throw new RPCError(errs.TYPE_ERROR,"Invalid parameter.");case 7:return _context50.next=9,wallet.remove(hash);case 9:if(_context50.sent){_context50.next=11;break}throw new RPCError(errs.WALLET_ERROR,"Transaction not in wallet.");case 11:return _context50.abrupt("return",null);case 12:case"end":return _context50.stop()}},_callee50,this)}));return function(_x99,_x100){return _ref75.apply(this,arguments)}}(),RPC.prototype.selectWallet=function(){var _ref76=_asyncToGenerator(regeneratorRuntime.mark(function _callee51(args,help){var valid,id,wallet;return regeneratorRuntime.wrap(function(_context51){for(;;)switch(_context51.prev=_context51.next){case 0:if(valid=new Validator(args),id=valid.str(0),!help&&1===args.length){_context51.next=4;break}throw new RPCError(errs.MISC_ERROR,'selectwallet "id"');case 4:return _context51.next=6,this.wdb.get(id);case 6:if(wallet=_context51.sent){_context51.next=9;break}throw new RPCError(errs.WALLET_ERROR,"Wallet not found.");case 9:return this.wallet=wallet,_context51.abrupt("return",null);case 11:case"end":return _context51.stop()}},_callee51,this)}));return function(_x101,_x102){return _ref76.apply(this,arguments)}}(),RPC.prototype.getMemoryInfo=function(){var _ref77=_asyncToGenerator(regeneratorRuntime.mark(function _callee52(args,help){return regeneratorRuntime.wrap(function(_context52){for(;;)switch(_context52.prev=_context52.next){case 0:if(!help&&0===args.length){_context52.next=2;break}throw new RPCError(errs.MISC_ERROR,"getmemoryinfo");case 2:return _context52.abrupt("return",this.logger.memoryUsage());case 3:case"end":return _context52.stop()}},_callee52,this)}));return function(_x103,_x104){return _ref77.apply(this,arguments)}}(),RPC.prototype.setLogLevel=function(){var _ref78=_asyncToGenerator(regeneratorRuntime.mark(function _callee53(args,help){var valid,level;return regeneratorRuntime.wrap(function(_context53){for(;;)switch(_context53.prev=_context53.next){case 0:if(!help&&1===args.length){_context53.next=2;break}throw new RPCError(errs.MISC_ERROR,'setloglevel "level"');case 2:return valid=new Validator(args),level=valid.str(0,""),this.logger.setLevel(level),_context53.abrupt("return",null);case 6:case"end":return _context53.stop()}},_callee53,this)}));return function(_x105,_x106){return _ref78.apply(this,arguments)}}(),RPC}(RPCBase);function parseHash(raw,network){return parseAddress(raw,network).getHash("hex")}function parseAddress(raw,network){try{return Address.fromString(raw,network)}catch(e){throw new RPCError(errs.INVALID_ADDRESS_OR_KEY,"Invalid address.")}}function parseSecret(raw,network){try{return KeyRing.fromSecret(raw,network)}catch(e){throw new RPCError(errs.INVALID_ADDRESS_OR_KEY,"Invalid key.")}}module.exports=RPC}).call(this,require("buffer").Buffer)},{"../btc/amount":8,"../pkg":67,"../primitives/address":69,"../primitives/keyring":76,"../primitives/merkleblock":78,"../primitives/mtx":79,"../primitives/outpoint":80,"../primitives/output":81,"../primitives/tx":82,"../protocol/consensus":84,"../script/script":95,"../utils/util":106,"./common":109,assert:146,"bcrypto/lib/hash256":160,bfile:201,bmutex:214,buffer:269,bval:280,bweb:282,util:428}],121:[function(require,module,exports){(function(Buffer){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),bio=require("bufio"),util=require("../utils/util"),Amount=require("../btc/amount"),CoinView=require("../coins/coinview"),Coin=require("../primitives/coin"),Outpoint=require("../primitives/outpoint"),records=require("./records"),layout=require("./layout").txdb,consensus=require("../protocol/consensus"),policy=require("../protocol/policy"),TXRecord=records.TXRecord,TXDB=function(){function TXDB(wdb,wid){_classCallCheck(this,TXDB),this.wdb=wdb,this.db=wdb.db,this.logger=wdb.logger,this.wid=wid||0,this.bucket=null,this.wallet=null,this.locked=new Set}return TXDB.prototype.open=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(wallet){var prefix;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:prefix=layout.prefix.build(wallet.wid),this.wid=wallet.wid,this.bucket=this.db.bucket(prefix),this.wallet=wallet;case 4:case"end":return _context.stop()}},_callee,this)}));return function(_x){return _ref.apply(this,arguments)}}(),TXDB.prototype.emit=function(event,data,details){this.wdb.emit(event,this.wallet,data,details),this.wallet.emit(event,data,details)},TXDB.prototype.getPath=function(output){var hash=output.getHash("hex");return hash?this.wdb.getPath(this.wid,hash):null},TXDB.prototype.hasPath=function(output){var hash=output.getHash("hex");return!!hash&&this.wdb.hasPath(this.wid,hash)},TXDB.prototype.saveCredit=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(b,credit,path){var coin;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return coin=credit.coin,b.put(layout.c.build(coin.hash,coin.index),credit.toRaw()),b.put(layout.C.build(path.account,coin.hash,coin.index),null),_context2.abrupt("return",this.addOutpointMap(b,coin.hash,coin.index));case 4:case"end":return _context2.stop()}},_callee2,this)}));return function(_x2,_x3,_x4){return _ref2.apply(this,arguments)}}(),TXDB.prototype.removeCredit=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(b,credit,path){var coin;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return coin=credit.coin,b.del(layout.c.build(coin.hash,coin.index)),b.del(layout.C.build(path.account,coin.hash,coin.index)),_context3.abrupt("return",this.removeOutpointMap(b,coin.hash,coin.index));case 4:case"end":return _context3.stop()}},_callee3,this)}));return function(_x5,_x6,_x7){return _ref3.apply(this,arguments)}}(),TXDB.prototype.spendCredit=function(b,credit,tx,index){var prevout=tx.inputs[index].prevout,spender=Outpoint.fromTX(tx,index);b.put(layout.s.build(prevout.hash,prevout.index),spender.toRaw()),b.put(layout.d.build(spender.hash,spender.index),credit.coin.toRaw())},TXDB.prototype.unspendCredit=function(b,tx,index){var prevout=tx.inputs[index].prevout,spender=Outpoint.fromTX(tx,index);b.del(layout.s.build(prevout.hash,prevout.index)),b.del(layout.d.build(spender.hash,spender.index))},TXDB.prototype.writeInput=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(b,tx,index){var prevout,spender;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return prevout=tx.inputs[index].prevout,spender=Outpoint.fromTX(tx,index),b.put(layout.s.build(prevout.hash,prevout.index),spender.toRaw()),_context4.abrupt("return",this.addOutpointMap(b,prevout.hash,prevout.index));case 4:case"end":return _context4.stop()}},_callee4,this)}));return function(_x8,_x9,_x10){return _ref4.apply(this,arguments)}}(),TXDB.prototype.removeInput=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(b,tx,index){var prevout;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return prevout=tx.inputs[index].prevout,b.del(layout.s.build(prevout.hash,prevout.index)),_context5.abrupt("return",this.removeOutpointMap(b,prevout.hash,prevout.index));case 3:case"end":return _context5.stop()}},_callee5,this)}));return function(_x11,_x12,_x13){return _ref5.apply(this,arguments)}}(),TXDB.prototype.updateBalance=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(b,state){var balance;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=2,this.getWalletBalance();case 2:return balance=_context6.sent,state.applyTo(balance),b.put(layout.R.build(),balance.toRaw()),_context6.abrupt("return",balance);case 6:case"end":return _context6.stop()}},_callee6,this)}));return function(_x14,_x15){return _ref6.apply(this,arguments)}}(),TXDB.prototype.updateAccountBalance=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(b,acct,delta){var balance;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.next=2,this.getAccountBalance(acct);case 2:return balance=_context7.sent,delta.applyTo(balance),b.put(layout.r.build(acct),balance.toRaw()),_context7.abrupt("return",balance);case 6:case"end":return _context7.stop()}},_callee7,this)}));return function(_x16,_x17,_x18){return _ref7.apply(this,arguments)}}(),TXDB.prototype.getSpent=function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(hash,index){var data;return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return _context8.next=2,this.bucket.get(layout.s.build(hash,index));case 2:if(data=_context8.sent){_context8.next=5;break}return _context8.abrupt("return",null);case 5:return _context8.abrupt("return",Outpoint.fromRaw(data));case 6:case"end":return _context8.stop()}},_callee8,this)}));return function(_x19,_x20){return _ref8.apply(this,arguments)}}(),TXDB.prototype.isSpent=function(hash,index){return this.bucket.has(layout.s.build(hash,index))},TXDB.prototype.addBlockMap=function(b,height){return this.wdb.addBlockMap(b.root(),height,this.wid)},TXDB.prototype.removeBlockMap=function(b,height){return this.wdb.removeBlockMap(b.root(),height,this.wid)},TXDB.prototype.addTXMap=function(b,hash){return this.wdb.addTXMap(b.root(),hash,this.wid)},TXDB.prototype.removeTXMap=function(b,hash){return this.wdb.removeTXMap(b.root(),hash,this.wid)},TXDB.prototype.addOutpointMap=function(b,hash,index){return this.wdb.addOutpointMap(b.root(),hash,index,this.wid)},TXDB.prototype.removeOutpointMap=function(b,hash,index){return this.wdb.removeOutpointMap(b.root(),hash,index,this.wid)},TXDB.prototype.getBlocks=function(){return this.bucket.keys({gte:layout.b.min(),lte:layout.b.max(),parse:function(key){return layout.b.parse(key)}})},TXDB.prototype.getBlock=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(height){var data;return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return _context9.next=2,this.bucket.get(layout.b.build(height));case 2:if(data=_context9.sent){_context9.next=5;break}return _context9.abrupt("return",null);case 5:return _context9.abrupt("return",BlockRecord.fromRaw(data));case 6:case"end":return _context9.stop()}},_callee9,this)}));return function(_x21){return _ref9.apply(this,arguments)}}(),TXDB.prototype.addBlock=function(){var _ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(b,hash,block){var key,data,blk,raw,size;return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return key=layout.b.build(block.height),_context10.next=3,this.bucket.get(key);case 3:if(data=_context10.sent){_context10.next=9;break}return(blk=BlockRecord.fromMeta(block)).add(hash),b.put(key,blk.toRaw()),_context10.abrupt("return");case 9:raw=Buffer.allocUnsafe(data.length+32),data.copy(raw,0),size=raw.readUInt32LE(40,!0),raw.writeUInt32LE(size+1,40,!0),hash.copy(raw,data.length),b.put(key,raw);case 15:case"end":return _context10.stop()}},_callee10,this)}));return function(_x22,_x23,_x24){return _ref10.apply(this,arguments)}}(),TXDB.prototype.removeBlock=function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(b,hash,height){var key,data,size,raw;return regeneratorRuntime.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:return key=layout.b.build(height),_context11.next=3,this.bucket.get(key);case 3:if(data=_context11.sent){_context11.next=6;break}return _context11.abrupt("return");case 6:if(size=data.readUInt32LE(40,!0),assert(size>0),assert(data.slice(-32).equals(hash)),1!==size){_context11.next=12;break}return b.del(key),_context11.abrupt("return");case 12:(raw=data.slice(0,-32)).writeUInt32LE(size-1,40,!0),b.put(key,raw);case 15:case"end":return _context11.stop()}},_callee11,this)}));return function(_x25,_x26,_x27){return _ref11.apply(this,arguments)}}(),TXDB.prototype.spliceBlock=function(){var _ref12=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(b,hash,height){var block;return regeneratorRuntime.wrap(function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:return _context12.next=2,this.getBlock(height);case 2:if(block=_context12.sent){_context12.next=5;break}return _context12.abrupt("return");case 5:if(block.remove(hash)){_context12.next=7;break}return _context12.abrupt("return");case 7:if(0!==block.hashes.size){_context12.next=10;break}return b.del(layout.b.build(height)),_context12.abrupt("return");case 10:b.put(layout.b.build(height),block.toRaw());case 11:case"end":return _context12.stop()}},_callee12,this)}));return function(_x28,_x29,_x30){return _ref12.apply(this,arguments)}}(),TXDB.prototype.add=function(){var _ref13=_asyncToGenerator(regeneratorRuntime.mark(function _callee13(tx,block){var hash,existing,wtx;return regeneratorRuntime.wrap(function(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:return hash=tx.hash("hex"),_context13.next=3,this.getTX(hash);case 3:if(existing=_context13.sent,assert(!tx.mutable,"Cannot add mutable TX to wallet."),!existing){_context13.next=11;break}if(-1===existing.height){_context13.next=8;break}return _context13.abrupt("return",null);case 8:if(block){_context13.next=10;break}return _context13.abrupt("return",null);case 10:return _context13.abrupt("return",this.confirm(existing,block));case 11:if(wtx=TXRecord.fromTX(tx,block),block){_context13.next=19;break}return _context13.next=15,this.removeConflicts(tx,!0);case 15:if(_context13.sent){_context13.next=17;break}return _context13.abrupt("return",null);case 17:_context13.next=21;break;case 19:return _context13.next=21,this.removeConflicts(tx,!1);case 21:return _context13.abrupt("return",this.insert(wtx,block));case 22:case"end":return _context13.stop()}},_callee13,this)}));return function(_x31,_x32){return _ref13.apply(this,arguments)}}(),TXDB.prototype.insert=function(){var _ref14=_asyncToGenerator(regeneratorRuntime.mark(function _callee14(wtx,block){var b,tx,hash,height,details,state,own,i,input,_input$prevout,_hash,index,credit,coin,path,_i,output,_path,_credit,_iterator,_isArray,_i2,_ref16,_ref15,acct,delta,balance;return regeneratorRuntime.wrap(function(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:if(b=this.bucket.batch(),tx=wtx.tx,hash=wtx.hash,height=block?block.height:-1,details=new Details(wtx,block),state=new BalanceDelta,own=!1,tx.isCoinbase()){_context14.next=42;break}i=0;case 8:if(!(i<tx.inputs.length)){_context14.next=42;break}return input=tx.inputs[i],_input$prevout=input.prevout,_hash=_input$prevout.hash,index=_input$prevout.index,_context14.next=13,this.getCredit(_hash,index);case 13:if(credit=_context14.sent){_context14.next=19;break}if(block){_context14.next=18;break}return _context14.next=18,this.writeInput(b,tx,i);case 18:return _context14.abrupt("continue",39);case 19:return coin=credit.coin,_context14.next=22,this.getPath(coin);case 22:if(path=_context14.sent,assert(path),details.setInput(i,path,coin),this.spendCredit(b,credit,tx,i),state.tx(path,1),state.coin(path,-1),state.unconfirmed(path,-coin.value),block){_context14.next=35;break}return credit.spent=!0,_context14.next=33,this.saveCredit(b,credit,path);case 33:_context14.next=38;break;case 35:return state.confirmed(path,-coin.value),_context14.next=38,this.removeCredit(b,credit,path);case 38:own=!0;case 39:i++,_context14.next=8;break;case 42:_i=0;case 43:if(!(_i<tx.outputs.length)){_context14.next=62;break}return output=tx.outputs[_i],_context14.next=47,this.getPath(output);case 47:if(_path=_context14.sent){_context14.next=50;break}return _context14.abrupt("continue",59);case 50:return details.setOutput(_i,_path),(_credit=Credit.fromTX(tx,_i,height)).own=own,state.tx(_path,1),state.coin(_path,1),state.unconfirmed(_path,output.value),block&&state.confirmed(_path,output.value),_context14.next=59,this.saveCredit(b,_credit,_path);case 59:_i++,_context14.next=43;break;case 62:if(state.updated()){_context14.next=64;break}return _context14.abrupt("return",null);case 64:b.put(layout.t.build(hash),wtx.toRaw()),b.put(layout.m.build(wtx.mtime,hash),null),block?b.put(layout.h.build(height,hash),null):b.put(layout.p.build(hash),null),_iterator=state.accounts,_isArray=Array.isArray(_iterator),_i2=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();case 68:if(!_isArray){_context14.next=74;break}if(!(_i2>=_iterator.length)){_context14.next=71;break}return _context14.abrupt("break",88);case 71:_ref16=_iterator[_i2++],_context14.next=78;break;case 74:if(!(_i2=_iterator.next()).done){_context14.next=77;break}return _context14.abrupt("break",88);case 77:_ref16=_i2.value;case 78:return acct=(_ref15=_ref16)[0],delta=_ref15[1],_context14.next=83,this.updateAccountBalance(b,acct,delta);case 83:b.put(layout.T.build(acct,hash),null),b.put(layout.M.build(acct,wtx.mtime,hash),null),block?b.put(layout.H.build(acct,height,hash),null):b.put(layout.P.build(acct,hash),null);case 86:_context14.next=68;break;case 88:if(!block){_context14.next=95;break}return _context14.next=91,this.addBlockMap(b,height);case 91:return _context14.next=93,this.addBlock(b,tx.hash(),block);case 93:_context14.next=97;break;case 95:return _context14.next=97,this.addTXMap(b,hash);case 97:return _context14.next=99,this.updateBalance(b,state);case 99:return balance=_context14.sent,_context14.next=102,b.write();case 102:return this.unlockTX(tx),this.emit("tx",tx,details),this.emit("balance",balance),_context14.abrupt("return",details);case 106:case"end":return _context14.stop()}},_callee14,this)}));return function(_x33,_x34){return _ref14.apply(this,arguments)}}(),TXDB.prototype.confirm=function(){var _ref17=_asyncToGenerator(regeneratorRuntime.mark(function _callee15(wtx,block){var b,tx,hash,height,details,state,credits,i,input,_input$prevout2,_hash2,index,resolved,_credit2,credit,coin,path,_i3,output,_path2,_credit3,_iterator2,_isArray2,_i4,_ref19,_ref18,acct,delta,balance;return regeneratorRuntime.wrap(function(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:if(b=this.bucket.batch(),tx=wtx.tx,hash=wtx.hash,height=block.height,details=new Details(wtx,block),state=new BalanceDelta,wtx.setBlock(block),tx.isCoinbase()){_context15.next=41;break}return _context15.next=9,this.getSpentCredits(tx);case 9:credits=_context15.sent,i=0;case 11:if(!(i<tx.inputs.length)){_context15.next=41;break}if(input=tx.inputs[i],_input$prevout2=input.prevout,_hash2=_input$prevout2.hash,index=_input$prevout2.index,resolved=!1,credits[i]){_context15.next=26;break}return _context15.next=18,this.removeInput(b,tx,i);case 18:return _context15.next=20,this.getCredit(_hash2,index);case 20:if(_credit2=_context15.sent){_context15.next=23;break}return _context15.abrupt("continue",38);case 23:this.spendCredit(b,_credit2,tx,i),credits[i]=_credit2,resolved=!0;case 26:return credit=credits[i],coin=credit.coin,assert(-1!==coin.height),_context15.next=31,this.getPath(coin);case 31:return path=_context15.sent,assert(path),details.setInput(i,path,coin),resolved&&(state.coin(path,-1),state.unconfirmed(path,-coin.value)),state.confirmed(path,-coin.value),_context15.next=38,this.removeCredit(b,credit,path);case 38:i++,_context15.next=11;break;case 41:_i3=0;case 42:if(!(_i3<tx.outputs.length)){_context15.next=64;break}return output=tx.outputs[_i3],_context15.next=46,this.getPath(output);case 46:if(_path2=_context15.sent){_context15.next=49;break}return _context15.abrupt("continue",61);case 49:return details.setOutput(_i3,_path2),_context15.next=52,this.getCredit(hash,_i3);case 52:if(_credit3=_context15.sent,assert(_credit3),!_credit3.spent){_context15.next=57;break}return _context15.next=57,this.updateSpentCoin(b,tx,_i3,height);case 57:return state.confirmed(_path2,output.value),_credit3.coin.height=height,_context15.next=61,this.saveCredit(b,_credit3,_path2);case 61:_i3++,_context15.next=42;break;case 64:b.put(layout.t.build(hash),wtx.toRaw()),b.del(layout.p.build(hash)),b.put(layout.h.build(height,hash),null),_iterator2=state.accounts,_isArray2=Array.isArray(_iterator2),_i4=0,_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();case 68:if(!_isArray2){_context15.next=74;break}if(!(_i4>=_iterator2.length)){_context15.next=71;break}return _context15.abrupt("break",87);case 71:_ref19=_iterator2[_i4++],_context15.next=78;break;case 74:if(!(_i4=_iterator2.next()).done){_context15.next=77;break}return _context15.abrupt("break",87);case 77:_ref19=_i4.value;case 78:return acct=(_ref18=_ref19)[0],delta=_ref18[1],_context15.next=83,this.updateAccountBalance(b,acct,delta);case 83:b.del(layout.P.build(acct,hash)),b.put(layout.H.build(acct,height,hash),null);case 85:_context15.next=68;break;case 87:return _context15.next=89,this.removeTXMap(b,hash);case 89:return _context15.next=91,this.addBlockMap(b,height);case 91:return _context15.next=93,this.addBlock(b,tx.hash(),block);case 93:return _context15.next=95,this.updateBalance(b,state);case 95:return balance=_context15.sent,_context15.next=98,b.write();case 98:return this.unlockTX(tx),this.emit("confirmed",tx,details),this.emit("balance",balance),_context15.abrupt("return",details);case 102:case"end":return _context15.stop()}},_callee15,this)}));return function(_x35,_x36){return _ref17.apply(this,arguments)}}(),TXDB.prototype.remove=function(){var _ref20=_asyncToGenerator(regeneratorRuntime.mark(function _callee16(hash){var wtx;return regeneratorRuntime.wrap(function(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:return _context16.next=2,this.getTX(hash);case 2:if(wtx=_context16.sent){_context16.next=5;break}return _context16.abrupt("return",null);case 5:return _context16.abrupt("return",this.removeRecursive(wtx));case 6:case"end":return _context16.stop()}},_callee16,this)}));return function(_x37){return _ref20.apply(this,arguments)}}(),TXDB.prototype.erase=function(){var _ref21=_asyncToGenerator(regeneratorRuntime.mark(function _callee17(wtx,block){var b,tx,hash,height,details,state,credits,i,credit,coin,path,_i5,output,_path3,_credit4,_iterator3,_isArray3,_i6,_ref23,_ref22,acct,delta,balance;return regeneratorRuntime.wrap(function(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:if(b=this.bucket.batch(),tx=wtx.tx,hash=wtx.hash,height=block?block.height:-1,details=new Details(wtx,block),state=new BalanceDelta,tx.isCoinbase()){_context17.next=34;break}return _context17.next=8,this.getSpentCredits(tx);case 8:credits=_context17.sent,i=0;case 10:if(!(i<tx.inputs.length)){_context17.next=34;break}if(credit=credits[i]){_context17.next=17;break}if(block){_context17.next=16;break}return _context17.next=16,this.removeInput(b,tx,i);case 16:return _context17.abrupt("continue",31);case 17:return coin=credit.coin,_context17.next=20,this.getPath(coin);case 20:return path=_context17.sent,assert(path),details.setInput(i,path,coin),state.tx(path,-1),state.coin(path,1),state.unconfirmed(path,coin.value),block&&state.confirmed(path,coin.value),this.unspendCredit(b,tx,i),credit.spent=!1,_context17.next=31,this.saveCredit(b,credit,path);case 31:i++,_context17.next=10;break;case 34:_i5=0;case 35:if(!(_i5<tx.outputs.length)){_context17.next=53;break}return output=tx.outputs[_i5],_context17.next=39,this.getPath(output);case 39:if(_path3=_context17.sent){_context17.next=42;break}return _context17.abrupt("continue",50);case 42:return details.setOutput(_i5,_path3),_credit4=Credit.fromTX(tx,_i5,height),state.tx(_path3,-1),state.coin(_path3,-1),state.unconfirmed(_path3,-output.value),block&&state.confirmed(_path3,-output.value),_context17.next=50,this.removeCredit(b,_credit4,_path3);case 50:_i5++,_context17.next=35;break;case 53:b.del(layout.t.build(hash)),b.del(layout.m.build(wtx.mtime,hash)),block?b.del(layout.h.build(height,hash)):b.del(layout.p.build(hash)),_iterator3=state.accounts,_isArray3=Array.isArray(_iterator3),_i6=0,_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();case 57:if(!_isArray3){_context17.next=63;break}if(!(_i6>=_iterator3.length)){_context17.next=60;break}return _context17.abrupt("break",77);case 60:_ref23=_iterator3[_i6++],_context17.next=67;break;case 63:if(!(_i6=_iterator3.next()).done){_context17.next=66;break}return _context17.abrupt("break",77);case 66:_ref23=_i6.value;case 67:return acct=(_ref22=_ref23)[0],delta=_ref22[1],_context17.next=72,this.updateAccountBalance(b,acct,delta);case 72:b.del(layout.T.build(acct,hash)),b.del(layout.M.build(acct,wtx.mtime,hash)),block?b.del(layout.H.build(acct,height,hash)):b.del(layout.P.build(acct,hash));case 75:_context17.next=57;break;case 77:if(!block){_context17.next=84;break}return _context17.next=80,this.removeBlockMap(b,height);case 80:return _context17.next=82,this.spliceBlock(b,hash,height);case 82:_context17.next=86;break;case 84:return _context17.next=86,this.removeTXMap(b,hash);case 86:return _context17.next=88,this.updateBalance(b,state);case 88:return balance=_context17.sent,_context17.next=91,b.write();case 91:return this.emit("remove tx",tx,details),this.emit("balance",balance),_context17.abrupt("return",details);case 94:case"end":return _context17.stop()}},_callee17,this)}));return function(_x38,_x39){return _ref21.apply(this,arguments)}}(),TXDB.prototype.removeRecursive=function(){var _ref24=_asyncToGenerator(regeneratorRuntime.mark(function _callee18(wtx){var tx,hash,i,spent,stx;return regeneratorRuntime.wrap(function(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:tx=wtx.tx,hash=wtx.hash,i=0;case 2:if(!(i<tx.outputs.length)){_context18.next=17;break}return _context18.next=5,this.getSpent(hash,i);case 5:if(spent=_context18.sent){_context18.next=8;break}return _context18.abrupt("continue",14);case 8:return _context18.next=10,this.getTX(spent.hash);case 10:return stx=_context18.sent,assert(stx),_context18.next=14,this.removeRecursive(stx);case 14:i++,_context18.next=2;break;case 17:return _context18.abrupt("return",this.erase(wtx,wtx.getBlock()));case 18:case"end":return _context18.stop()}},_callee18,this)}));return function(_x40){return _ref24.apply(this,arguments)}}(),TXDB.prototype.revert=function(){var _ref25=_asyncToGenerator(regeneratorRuntime.mark(function _callee19(height){var block,hashes,i,hash;return regeneratorRuntime.wrap(function(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:return _context19.next=2,this.getBlock(height);case 2:if(block=_context19.sent){_context19.next=5;break}return _context19.abrupt("return",0);case 5:hashes=block.toArray(),i=hashes.length-1;case 7:if(!(i>=0)){_context19.next=14;break}return hash=hashes[i],_context19.next=11,this.unconfirm(hash);case 11:i--,_context19.next=7;break;case 14:return _context19.abrupt("return",hashes.length);case 15:case"end":return _context19.stop()}},_callee19,this)}));return function(_x41){return _ref25.apply(this,arguments)}}(),TXDB.prototype.unconfirm=function(){var _ref26=_asyncToGenerator(regeneratorRuntime.mark(function _callee20(hash){var wtx;return regeneratorRuntime.wrap(function(_context20){for(;;)switch(_context20.prev=_context20.next){case 0:return _context20.next=2,this.getTX(hash);case 2:if(wtx=_context20.sent){_context20.next=5;break}return _context20.abrupt("return",null);case 5:if(-1!==wtx.height){_context20.next=7;break}return _context20.abrupt("return",null);case 7:return _context20.abrupt("return",this.disconnect(wtx,wtx.getBlock()));case 8:case"end":return _context20.stop()}},_callee20,this)}));return function(_x42){return _ref26.apply(this,arguments)}}(),TXDB.prototype.disconnect=function(){var _ref27=_asyncToGenerator(regeneratorRuntime.mark(function _callee21(wtx,block){var b,tx,hash,height,details,state,credits,i,credit,coin,path,_i7,output,_path4,_credit5,_iterator4,_isArray4,_i8,_ref29,_ref28,acct,delta,balance;return regeneratorRuntime.wrap(function(_context21){for(;;)switch(_context21.prev=_context21.next){case 0:if(b=this.bucket.batch(),tx=wtx.tx,hash=wtx.hash,height=wtx.height,details=new Details(wtx,block),state=new BalanceDelta,assert(block),wtx.unsetBlock(),tx.isCoinbase()){_context21.next=31;break}return _context21.next=9,this.getSpentCredits(tx);case 9:credits=_context21.sent,i=0;case 11:if(!(i<tx.inputs.length)){_context21.next=31;break}if(credit=credits[i]){_context21.next=17;break}return _context21.next=16,this.writeInput(b,tx,i);case 16:return _context21.abrupt("continue",28);case 17:return coin=credit.coin,assert(-1!==coin.height),_context21.next=21,this.getPath(coin);case 21:return path=_context21.sent,assert(path),details.setInput(i,path,coin),state.confirmed(path,coin.value),credit.spent=!0,_context21.next=28,this.saveCredit(b,credit,path);case 28:i++,_context21.next=11;break;case 31:_i7=0;case 32:if(!(_i7<tx.outputs.length)){_context21.next=57;break}return output=tx.outputs[_i7],_context21.next=36,this.getPath(output);case 36:if(_path4=_context21.sent){_context21.next=39;break}return _context21.abrupt("continue",54);case 39:return _context21.next=41,this.getCredit(hash,_i7);case 41:if(_credit5=_context21.sent){_context21.next=46;break}return _context21.next=45,this.updateSpentCoin(b,tx,_i7,height);case 45:return _context21.abrupt("continue",54);case 46:if(!_credit5.spent){_context21.next=49;break}return _context21.next=49,this.updateSpentCoin(b,tx,_i7,height);case 49:return details.setOutput(_i7,_path4),_credit5.coin.height=-1,state.confirmed(_path4,-output.value),_context21.next=54,this.saveCredit(b,_credit5,_path4);case 54:_i7++,_context21.next=32;break;case 57:return _context21.next=59,this.addTXMap(b,hash);case 59:return _context21.next=61,this.removeBlockMap(b,height);case 61:return _context21.next=63,this.removeBlock(b,tx.hash(),height);case 63:b.put(layout.t.build(hash),wtx.toRaw()),b.put(layout.p.build(hash),null),b.del(layout.h.build(height,hash)),_iterator4=state.accounts,_isArray4=Array.isArray(_iterator4),_i8=0,_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();case 67:if(!_isArray4){_context21.next=73;break}if(!(_i8>=_iterator4.length)){_context21.next=70;break}return _context21.abrupt("break",86);case 70:_ref29=_iterator4[_i8++],_context21.next=77;break;case 73:if(!(_i8=_iterator4.next()).done){_context21.next=76;break}return _context21.abrupt("break",86);case 76:_ref29=_i8.value;case 77:return acct=(_ref28=_ref29)[0],delta=_ref28[1],_context21.next=82,this.updateAccountBalance(b,acct,delta);case 82:b.put(layout.P.build(acct,hash),null),b.del(layout.H.build(acct,height,hash));case 84:_context21.next=67;break;case 86:return _context21.next=88,this.updateBalance(b,state);case 88:return balance=_context21.sent,_context21.next=91,b.write();case 91:return this.emit("unconfirmed",tx,details),this.emit("balance",balance),_context21.abrupt("return",details);case 94:case"end":return _context21.stop()}},_callee21,this)}));return function(_x43,_x44){return _ref27.apply(this,arguments)}}(),TXDB.prototype.removeConflict=function(){var _ref30=_asyncToGenerator(regeneratorRuntime.mark(function _callee22(wtx){var tx,details;return regeneratorRuntime.wrap(function(_context22){for(;;)switch(_context22.prev=_context22.next){case 0:return tx=wtx.tx,this.logger.warning("Handling conflicting tx: %s.",tx.txid()),_context22.next=4,this.removeRecursive(wtx);case 4:return details=_context22.sent,this.logger.warning("Removed conflict: %s.",tx.txid()),this.emit("conflict",tx,details),_context22.abrupt("return",details);case 8:case"end":return _context22.stop()}},_callee22,this)}));return function(_x45){return _ref30.apply(this,arguments)}}(),TXDB.prototype.removeConflicts=function(){var _ref31=_asyncToGenerator(regeneratorRuntime.mark(function _callee23(tx,conf){var txid,spends,_iterator5,_isArray5,_i9,_ref33,prevout,hash,index,spent,spender,_iterator6,_isArray6,_i10,_ref34;return regeneratorRuntime.wrap(function(_context23){for(;;)switch(_context23.prev=_context23.next){case 0:if(!tx.isCoinbase()){_context23.next=2;break}return _context23.abrupt("return",!0);case 2:txid=tx.hash("hex"),spends=[],_iterator5=tx.inputs,_isArray5=Array.isArray(_iterator5),_i9=0,_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();case 5:if(!_isArray5){_context23.next=11;break}if(!(_i9>=_iterator5.length)){_context23.next=8;break}return _context23.abrupt("break",34);case 8:_ref33=_iterator5[_i9++],_context23.next=15;break;case 11:if(!(_i9=_iterator5.next()).done){_context23.next=14;break}return _context23.abrupt("break",34);case 14:_ref33=_i9.value;case 15:return prevout=_ref33.prevout,hash=prevout.hash,index=prevout.index,_context23.next=20,this.getSpent(hash,index);case 20:if(spent=_context23.sent){_context23.next=23;break}return _context23.abrupt("continue",32);case 23:if(spent.hash!==txid){_context23.next=25;break}return _context23.abrupt("continue",32);case 25:return _context23.next=27,this.getTX(spent.hash);case 27:if(spender=_context23.sent,assert(spender),!conf||-1===spender.height){_context23.next=31;break}return _context23.abrupt("return",!1);case 31:spends.push(spender);case 32:_context23.next=5;break;case 34:_iterator6=spends,_isArray6=Array.isArray(_iterator6),_i10=0,_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();case 35:if(!_isArray6){_context23.next=41;break}if(!(_i10>=_iterator6.length)){_context23.next=38;break}return _context23.abrupt("break",50);case 38:_ref34=_iterator6[_i10++],_context23.next=45;break;case 41:if(!(_i10=_iterator6.next()).done){_context23.next=44;break}return _context23.abrupt("break",50);case 44:_ref34=_i10.value;case 45:return spender=_ref34,_context23.next=48,this.removeConflict(spender);case 48:_context23.next=35;break;case 50:return _context23.abrupt("return",!0);case 51:case"end":return _context23.stop()}},_callee23,this)}));return function(_x46,_x47){return _ref31.apply(this,arguments)}}(),TXDB.prototype.lockTX=function(tx){if(!tx.isCoinbase()){var _iterator7=tx.inputs,_isArray7=Array.isArray(_iterator7),_i11=0;for(_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();;){var _ref35;if(_isArray7){if(_i11>=_iterator7.length)break;_ref35=_iterator7[_i11++]}else{if((_i11=_iterator7.next()).done)break;_ref35=_i11.value}var input=_ref35;this.lockCoin(input.prevout)}}},TXDB.prototype.unlockTX=function(tx){if(!tx.isCoinbase()){var _iterator8=tx.inputs,_isArray8=Array.isArray(_iterator8),_i12=0;for(_iterator8=_isArray8?_iterator8:_iterator8[Symbol.iterator]();;){var _ref36;if(_isArray8){if(_i12>=_iterator8.length)break;_ref36=_iterator8[_i12++]}else{if((_i12=_iterator8.next()).done)break;_ref36=_i12.value}var input=_ref36;this.unlockCoin(input.prevout)}}},TXDB.prototype.lockCoin=function(coin){var key=coin.toKey();this.locked.add(key)},TXDB.prototype.unlockCoin=function(coin){var key=coin.toKey();return this.locked.delete(key)},TXDB.prototype.isLocked=function(coin){var key=coin.toKey();return this.locked.has(key)},TXDB.prototype.filterLocked=function(coins){var out=[],_iterator9=coins,_isArray9=Array.isArray(_iterator9),_i13=0;for(_iterator9=_isArray9?_iterator9:_iterator9[Symbol.iterator]();;){var _ref37;if(_isArray9){if(_i13>=_iterator9.length)break;_ref37=_iterator9[_i13++]}else{if((_i13=_iterator9.next()).done)break;_ref37=_i13.value}var coin=_ref37;this.isLocked(coin)||out.push(coin)}return out},TXDB.prototype.getLocked=function(){var outpoints=[],_iterator10=this.locked.keys(),_isArray10=Array.isArray(_iterator10),_i14=0;for(_iterator10=_isArray10?_iterator10:_iterator10[Symbol.iterator]();;){var _ref38;if(_isArray10){if(_i14>=_iterator10.length)break;_ref38=_iterator10[_i14++]}else{if((_i14=_iterator10.next()).done)break;_ref38=_i14.value}var key=_ref38;outpoints.push(Outpoint.fromKey(key))}return outpoints},TXDB.prototype.getAccountHistoryHashes=function(acct){return assert("number"==typeof acct),this.bucket.keys({gte:layout.T.min(acct),lte:layout.T.max(acct),parse:function(key){return layout.T.parse(key)[1]}})},TXDB.prototype.getHistoryHashes=function(acct){return assert("number"==typeof acct),-1!==acct?this.getAccountHistoryHashes(acct):this.bucket.keys({gte:layout.t.min(),lte:layout.t.max(),parse:function(key){return layout.t.parse(key)}})},TXDB.prototype.getAccountPendingHashes=function(acct){return assert("number"==typeof acct),this.bucket.keys({gte:layout.P.min(acct),lte:layout.P.max(acct),parse:function(key){return layout.P.parse(key)[1]}})},TXDB.prototype.getPendingHashes=function(acct){return assert("number"==typeof acct),-1!==acct?this.getAccountPendingHashes(acct):this.bucket.keys({gte:layout.p.min(),lte:layout.p.max(),parse:function(key){return layout.p.parse(key)}})},TXDB.prototype.getAccountOutpoints=function(acct){return assert("number"==typeof acct),this.bucket.keys({gte:layout.C.min(acct),lte:layout.C.max(acct),parse:function(key){var _layout$C$parse=layout.C.parse(key),hash=_layout$C$parse[1],index=_layout$C$parse[2];return new Outpoint(hash,index)}})},TXDB.prototype.getOutpoints=function(acct){return assert("number"==typeof acct),-1!==acct?this.getAccountOutpoints(acct):this.bucket.keys({gte:layout.c.min(),lte:layout.c.max(),parse:function(key){var _layout$c$parse=layout.c.parse(key),hash=_layout$c$parse[0],index=_layout$c$parse[1];return new Outpoint(hash,index)}})},TXDB.prototype.getAccountHeightRangeHashes=function(acct,options){assert("number"==typeof acct);var start=options.start||0,end=options.end||4294967295;return this.bucket.keys({gte:layout.H.min(acct,start),lte:layout.H.max(acct,end),limit:options.limit,reverse:options.reverse,parse:function(key){return layout.H.parse(key)[2]}})},TXDB.prototype.getHeightRangeHashes=function(acct,options){if(assert("number"==typeof acct),-1!==acct)return this.getAccountHeightRangeHashes(acct,options);var start=options.start||0,end=options.end||4294967295;return this.bucket.keys({gte:layout.h.min(start),lte:layout.h.max(end),limit:options.limit,reverse:options.reverse,parse:function(key){return layout.h.parse(key)[1]}})},TXDB.prototype.getHeightHashes=function(height){return this.getHeightRangeHashes({start:height,end:height})},TXDB.prototype.getAccountRangeHashes=function(acct,options){assert("number"==typeof acct);var start=options.start||0,end=options.end||4294967295;return this.bucket.keys({gte:layout.M.min(acct,start),lte:layout.M.max(acct,end),limit:options.limit,reverse:options.reverse,parse:function(key){return layout.M.parse(key)[2]}})},TXDB.prototype.getRangeHashes=function(acct,options){if(assert("number"==typeof acct),-1!==acct)return this.getAccountRangeHashes(acct,options);var start=options.start||0,end=options.end||4294967295;return this.bucket.keys({gte:layout.m.min(start),lte:layout.m.max(end),limit:options.limit,reverse:options.reverse,parse:function(key){return layout.m.parse(key)[1]}})},TXDB.prototype.getRange=function(){var _ref39=_asyncToGenerator(regeneratorRuntime.mark(function _callee24(acct,options){var hashes,txs,_iterator11,_isArray11,_i15,_ref40,hash,tx;return regeneratorRuntime.wrap(function(_context24){for(;;)switch(_context24.prev=_context24.next){case 0:return _context24.next=2,this.getRangeHashes(acct,options);case 2:hashes=_context24.sent,txs=[],_iterator11=hashes,_isArray11=Array.isArray(_iterator11),_i15=0,_iterator11=_isArray11?_iterator11:_iterator11[Symbol.iterator]();case 5:if(!_isArray11){_context24.next=11;break}if(!(_i15>=_iterator11.length)){_context24.next=8;break}return _context24.abrupt("break",23);case 8:_ref40=_iterator11[_i15++],_context24.next=15;break;case 11:if(!(_i15=_iterator11.next()).done){_context24.next=14;break}return _context24.abrupt("break",23);case 14:_ref40=_i15.value;case 15:return hash=_ref40,_context24.next=18,this.getTX(hash);case 18:tx=_context24.sent,assert(tx),txs.push(tx);case 21:_context24.next=5;break;case 23:return _context24.abrupt("return",txs);case 24:case"end":return _context24.stop()}},_callee24,this)}));return function(_x48,_x49){return _ref39.apply(this,arguments)}}(),TXDB.prototype.getLast=function(acct,limit){return this.getRange(acct,{start:0,end:4294967295,reverse:!0,limit:limit||10})},TXDB.prototype.getHistory=function(acct){return assert("number"==typeof acct),-1!==acct?this.getAccountHistory(acct):this.bucket.values({gte:layout.t.min(),lte:layout.t.max(),parse:function(data){return TXRecord.fromRaw(data)}})},TXDB.prototype.getAccountHistory=function(){var _ref41=_asyncToGenerator(regeneratorRuntime.mark(function _callee25(acct){var hashes,txs,_iterator12,_isArray12,_i16,_ref42,hash,tx;return regeneratorRuntime.wrap(function(_context25){for(;;)switch(_context25.prev=_context25.next){case 0:return _context25.next=2,this.getHistoryHashes(acct);case 2:hashes=_context25.sent,txs=[],_iterator12=hashes,_isArray12=Array.isArray(_iterator12),_i16=0,_iterator12=_isArray12?_iterator12:_iterator12[Symbol.iterator]();case 5:if(!_isArray12){_context25.next=11;break}if(!(_i16>=_iterator12.length)){_context25.next=8;break}return _context25.abrupt("break",23);case 8:_ref42=_iterator12[_i16++],_context25.next=15;break;case 11:if(!(_i16=_iterator12.next()).done){_context25.next=14;break}return _context25.abrupt("break",23);case 14:_ref42=_i16.value;case 15:return hash=_ref42,_context25.next=18,this.getTX(hash);case 18:tx=_context25.sent,assert(tx),txs.push(tx);case 21:_context25.next=5;break;case 23:return _context25.abrupt("return",txs);case 24:case"end":return _context25.stop()}},_callee25,this)}));return function(_x50){return _ref41.apply(this,arguments)}}(),TXDB.prototype.getPending=function(){var _ref43=_asyncToGenerator(regeneratorRuntime.mark(function _callee26(acct){var hashes,txs,_iterator13,_isArray13,_i17,_ref44,hash,tx;return regeneratorRuntime.wrap(function(_context26){for(;;)switch(_context26.prev=_context26.next){case 0:return _context26.next=2,this.getPendingHashes(acct);case 2:hashes=_context26.sent,txs=[],_iterator13=hashes,_isArray13=Array.isArray(_iterator13),_i17=0,_iterator13=_isArray13?_iterator13:_iterator13[Symbol.iterator]();case 5:if(!_isArray13){_context26.next=11;break}if(!(_i17>=_iterator13.length)){_context26.next=8;break}return _context26.abrupt("break",23);case 8:_ref44=_iterator13[_i17++],_context26.next=15;break;case 11:if(!(_i17=_iterator13.next()).done){_context26.next=14;break}return _context26.abrupt("break",23);case 14:_ref44=_i17.value;case 15:return hash=_ref44,_context26.next=18,this.getTX(hash);case 18:tx=_context26.sent,assert(tx),txs.push(tx);case 21:_context26.next=5;break;case 23:return _context26.abrupt("return",txs);case 24:case"end":return _context26.stop()}},_callee26,this)}));return function(_x51){return _ref43.apply(this,arguments)}}(),TXDB.prototype.getCredits=function(acct){return assert("number"==typeof acct),-1!==acct?this.getAccountCredits(acct):this.bucket.range({gte:layout.c.min(),lte:layout.c.max(),parse:function(key,value){var _layout$c$parse2=layout.c.parse(key),hash=_layout$c$parse2[0],index=_layout$c$parse2[1],credit=Credit.fromRaw(value);return credit.coin.hash=hash,credit.coin.index=index,credit}})},TXDB.prototype.getAccountCredits=function(){var _ref45=_asyncToGenerator(regeneratorRuntime.mark(function _callee27(acct){var outpoints,credits,_iterator14,_isArray14,_i18,_ref47,_ref46,hash,index,credit;return regeneratorRuntime.wrap(function(_context27){for(;;)switch(_context27.prev=_context27.next){case 0:return _context27.next=2,this.getOutpoints(acct);case 2:outpoints=_context27.sent,credits=[],_iterator14=outpoints,_isArray14=Array.isArray(_iterator14),_i18=0,_iterator14=_isArray14?_iterator14:_iterator14[Symbol.iterator]();case 5:if(!_isArray14){_context27.next=11;break}if(!(_i18>=_iterator14.length)){_context27.next=8;break}return _context27.abrupt("break",25);case 8:_ref47=_iterator14[_i18++],_context27.next=15;break;case 11:if(!(_i18=_iterator14.next()).done){_context27.next=14;break}return _context27.abrupt("break",25);case 14:_ref47=_i18.value;case 15:return hash=(_ref46=_ref47).hash,index=_ref46.index,_context27.next=20,this.getCredit(hash,index);case 20:credit=_context27.sent,assert(credit),credits.push(credit);case 23:_context27.next=5;break;case 25:return _context27.abrupt("return",credits);case 26:case"end":return _context27.stop()}},_callee27,this)}));return function(_x52){return _ref45.apply(this,arguments)}}(),TXDB.prototype.getSpentCredits=function(){var _ref48=_asyncToGenerator(regeneratorRuntime.mark(function _callee28(tx){var hash,credits,i;return regeneratorRuntime.wrap(function(_context28){for(;;)switch(_context28.prev=_context28.next){case 0:if(!tx.isCoinbase()){_context28.next=2;break}return _context28.abrupt("return",[]);case 2:for(hash=tx.hash("hex"),credits=[],i=0;i<tx.inputs.length;i++)credits.push(null);return _context28.next=7,this.bucket.range({gte:layout.d.min(hash),lte:layout.d.max(hash),parse:function(key,value){var index=layout.d.parse(key)[1],coin=Coin.fromRaw(value),input=tx.inputs[index];assert(input),coin.hash=input.prevout.hash,coin.index=input.prevout.index,credits[index]=new Credit(coin)}});case 7:return _context28.abrupt("return",credits);case 8:case"end":return _context28.stop()}},_callee28,this)}));return function(_x53){return _ref48.apply(this,arguments)}}(),TXDB.prototype.getCoins=function(){var _ref49=_asyncToGenerator(regeneratorRuntime.mark(function _callee29(acct){var credits,coins,_iterator15,_isArray15,_i19,_ref50,credit;return regeneratorRuntime.wrap(function(_context29){for(;;)switch(_context29.prev=_context29.next){case 0:return _context29.next=2,this.getCredits(acct);case 2:credits=_context29.sent,coins=[],_iterator15=credits,_isArray15=Array.isArray(_iterator15),_i19=0,_iterator15=_isArray15?_iterator15:_iterator15[Symbol.iterator]();case 5:if(!_isArray15){_context29.next=11;break}if(!(_i19>=_iterator15.length)){_context29.next=8;break}return _context29.abrupt("break",21);case 8:_ref50=_iterator15[_i19++],_context29.next=15;break;case 11:if(!(_i19=_iterator15.next()).done){_context29.next=14;break}return _context29.abrupt("break",21);case 14:_ref50=_i19.value;case 15:if(!(credit=_ref50).spent){_context29.next=18;break}return _context29.abrupt("continue",19);case 18:coins.push(credit.coin);case 19:_context29.next=5;break;case 21:return _context29.abrupt("return",coins);case 22:case"end":return _context29.stop()}},_callee29,this)}));return function(_x54){return _ref49.apply(this,arguments)}}(),TXDB.prototype.getAccountCoins=function(){var _ref51=_asyncToGenerator(regeneratorRuntime.mark(function _callee30(acct){var credits,coins,_iterator16,_isArray16,_i20,_ref52,credit;return regeneratorRuntime.wrap(function(_context30){for(;;)switch(_context30.prev=_context30.next){case 0:return _context30.next=2,this.getAccountCredits(acct);case 2:credits=_context30.sent,coins=[],_iterator16=credits,_isArray16=Array.isArray(_iterator16),_i20=0,_iterator16=_isArray16?_iterator16:_iterator16[Symbol.iterator]();case 5:if(!_isArray16){_context30.next=11;break}if(!(_i20>=_iterator16.length)){_context30.next=8;break}return _context30.abrupt("break",21);case 8:_ref52=_iterator16[_i20++],_context30.next=15;break;case 11:if(!(_i20=_iterator16.next()).done){_context30.next=14;break}return _context30.abrupt("break",21);case 14:_ref52=_i20.value;case 15:if(!(credit=_ref52).spent){_context30.next=18;break}return _context30.abrupt("continue",19);case 18:coins.push(credit.coin);case 19:_context30.next=5;break;case 21:return _context30.abrupt("return",coins);case 22:case"end":return _context30.stop()}},_callee30,this)}));return function(_x55){return _ref51.apply(this,arguments)}}(),TXDB.prototype.getSpentCoins=function(){var _ref53=_asyncToGenerator(regeneratorRuntime.mark(function _callee31(tx){var credits,coins,_iterator17,_isArray17,_i21,_ref54,credit;return regeneratorRuntime.wrap(function(_context31){for(;;)switch(_context31.prev=_context31.next){case 0:if(!tx.isCoinbase()){_context31.next=2;break}return _context31.abrupt("return",[]);case 2:return _context31.next=4,this.getSpentCredits(tx);case 4:credits=_context31.sent,coins=[],_iterator17=credits,_isArray17=Array.isArray(_iterator17),_i21=0,_iterator17=_isArray17?_iterator17:_iterator17[Symbol.iterator]();case 7:if(!_isArray17){_context31.next=13;break}if(!(_i21>=_iterator17.length)){_context31.next=10;break}return _context31.abrupt("break",24);case 10:_ref54=_iterator17[_i21++],_context31.next=17;break;case 13:if(!(_i21=_iterator17.next()).done){_context31.next=16;break}return _context31.abrupt("break",24);case 16:_ref54=_i21.value;case 17:if(credit=_ref54){_context31.next=21;break}return coins.push(null),_context31.abrupt("continue",22);case 21:coins.push(credit.coin);case 22:_context31.next=7;break;case 24:return _context31.abrupt("return",coins);case 25:case"end":return _context31.stop()}},_callee31,this)}));return function(_x56){return _ref53.apply(this,arguments)}}(),TXDB.prototype.getCoinView=function(){var _ref55=_asyncToGenerator(regeneratorRuntime.mark(function _callee32(tx){var view,_iterator18,_isArray18,_i22,_ref57,prevout,hash,index,coin;return regeneratorRuntime.wrap(function(_context32){for(;;)switch(_context32.prev=_context32.next){case 0:if(view=new CoinView,!tx.isCoinbase()){_context32.next=3;break}return _context32.abrupt("return",view);case 3:_iterator18=tx.inputs,_isArray18=Array.isArray(_iterator18),_i22=0,_iterator18=_isArray18?_iterator18:_iterator18[Symbol.iterator]();case 4:if(!_isArray18){_context32.next=10;break}if(!(_i22>=_iterator18.length)){_context32.next=7;break}return _context32.abrupt("break",25);case 7:_ref57=_iterator18[_i22++],_context32.next=14;break;case 10:if(!(_i22=_iterator18.next()).done){_context32.next=13;break}return _context32.abrupt("break",25);case 13:_ref57=_i22.value;case 14:return prevout=_ref57.prevout,hash=prevout.hash,index=prevout.index,_context32.next=19,this.getCoin(hash,index);case 19:if(coin=_context32.sent){_context32.next=22;break}return _context32.abrupt("continue",23);case 22:view.addCoin(coin);case 23:_context32.next=4;break;case 25:return _context32.abrupt("return",view);case 26:case"end":return _context32.stop()}},_callee32,this)}));return function(_x57){return _ref55.apply(this,arguments)}}(),TXDB.prototype.getSpentView=function(){var _ref58=_asyncToGenerator(regeneratorRuntime.mark(function _callee33(tx){var view,coins,_iterator19,_isArray19,_i23,_ref59,coin;return regeneratorRuntime.wrap(function(_context33){for(;;)switch(_context33.prev=_context33.next){case 0:if(view=new CoinView,!tx.isCoinbase()){_context33.next=3;break}return _context33.abrupt("return",view);case 3:return _context33.next=5,this.getSpentCoins(tx);case 5:coins=_context33.sent,_iterator19=coins,_isArray19=Array.isArray(_iterator19),_i23=0,_iterator19=_isArray19?_iterator19:_iterator19[Symbol.iterator]();case 7:if(!_isArray19){_context33.next=13;break}if(!(_i23>=_iterator19.length)){_context33.next=10;break}return _context33.abrupt("break",23);case 10:_ref59=_iterator19[_i23++],_context33.next=17;break;case 13:if(!(_i23=_iterator19.next()).done){_context33.next=16;break}return _context33.abrupt("break",23);case 16:_ref59=_i23.value;case 17:if(coin=_ref59){_context33.next=20;break}return _context33.abrupt("continue",21);case 20:view.addCoin(coin);case 21:_context33.next=7;break;case 23:return _context33.abrupt("return",view);case 24:case"end":return _context33.stop()}},_callee33,this)}));return function(_x58){return _ref58.apply(this,arguments)}}(),TXDB.prototype.getTX=function(){var _ref60=_asyncToGenerator(regeneratorRuntime.mark(function _callee34(hash){var raw;return regeneratorRuntime.wrap(function(_context34){for(;;)switch(_context34.prev=_context34.next){case 0:return _context34.next=2,this.bucket.get(layout.t.build(hash));case 2:if(raw=_context34.sent){_context34.next=5;break}return _context34.abrupt("return",null);case 5:return _context34.abrupt("return",TXRecord.fromRaw(raw));case 6:case"end":return _context34.stop()}},_callee34,this)}));return function(_x59){return _ref60.apply(this,arguments)}}(),TXDB.prototype.getDetails=function(){var _ref61=_asyncToGenerator(regeneratorRuntime.mark(function _callee35(hash){var wtx;return regeneratorRuntime.wrap(function(_context35){for(;;)switch(_context35.prev=_context35.next){case 0:return _context35.next=2,this.getTX(hash);case 2:if(wtx=_context35.sent){_context35.next=5;break}return _context35.abrupt("return",null);case 5:return _context35.abrupt("return",this.toDetails(wtx));case 6:case"end":return _context35.stop()}},_callee35,this)}));return function(_x60){return _ref61.apply(this,arguments)}}(),TXDB.prototype.toDetails=function(){var _ref62=_asyncToGenerator(regeneratorRuntime.mark(function _callee36(wtxs){var out,_iterator20,_isArray20,_i24,_ref63,wtx,details;return regeneratorRuntime.wrap(function(_context36){for(;;)switch(_context36.prev=_context36.next){case 0:if(out=[],Array.isArray(wtxs)){_context36.next=3;break}return _context36.abrupt("return",this._toDetails(wtxs));case 3:_iterator20=wtxs,_isArray20=Array.isArray(_iterator20),_i24=0,_iterator20=_isArray20?_iterator20:_iterator20[Symbol.iterator]();case 4:if(!_isArray20){_context36.next=10;break}if(!(_i24>=_iterator20.length)){_context36.next=7;break}return _context36.abrupt("break",23);case 7:_ref63=_iterator20[_i24++],_context36.next=14;break;case 10:if(!(_i24=_iterator20.next()).done){_context36.next=13;break}return _context36.abrupt("break",23);case 13:_ref63=_i24.value;case 14:return wtx=_ref63,_context36.next=17,this._toDetails(wtx);case 17:if(details=_context36.sent){_context36.next=20;break}return _context36.abrupt("continue",21);case 20:out.push(details);case 21:_context36.next=4;break;case 23:return _context36.abrupt("return",out);case 24:case"end":return _context36.stop()}},_callee36,this)}));return function(_x61){return _ref62.apply(this,arguments)}}(),TXDB.prototype._toDetails=function(){var _ref64=_asyncToGenerator(regeneratorRuntime.mark(function _callee37(wtx){var tx,block,details,coins,i,coin,path,_i25,output,_path5;return regeneratorRuntime.wrap(function(_context37){for(;;)switch(_context37.prev=_context37.next){case 0:return tx=wtx.tx,block=wtx.getBlock(),details=new Details(wtx,block),_context37.next=5,this.getSpentCoins(tx);case 5:coins=_context37.sent,i=0;case 7:if(!(i<tx.inputs.length)){_context37.next=18;break}if(coin=coins[i],path=null,!coin){_context37.next=14;break}return _context37.next=13,this.getPath(coin);case 13:path=_context37.sent;case 14:details.setInput(i,path,coin);case 15:i++,_context37.next=7;break;case 18:_i25=0;case 19:if(!(_i25<tx.outputs.length)){_context37.next=28;break}return output=tx.outputs[_i25],_context37.next=23,this.getPath(output);case 23:_path5=_context37.sent,details.setOutput(_i25,_path5);case 25:_i25++,_context37.next=19;break;case 28:return _context37.abrupt("return",details);case 29:case"end":return _context37.stop()}},_callee37,this)}));return function(_x62){return _ref64.apply(this,arguments)}}(),TXDB.prototype.hasTX=function(hash){return this.bucket.has(layout.t.build(hash))},TXDB.prototype.getCoin=function(){var _ref65=_asyncToGenerator(regeneratorRuntime.mark(function _callee38(hash,index){var credit;return regeneratorRuntime.wrap(function(_context38){for(;;)switch(_context38.prev=_context38.next){case 0:return _context38.next=2,this.getCredit(hash,index);case 2:if(credit=_context38.sent){_context38.next=5;break}return _context38.abrupt("return",null);case 5:return _context38.abrupt("return",credit.coin);case 6:case"end":return _context38.stop()}},_callee38,this)}));return function(_x63,_x64){return _ref65.apply(this,arguments)}}(),TXDB.prototype.getCredit=function(){var _ref66=_asyncToGenerator(regeneratorRuntime.mark(function _callee39(hash,index){var data,credit;return regeneratorRuntime.wrap(function(_context39){for(;;)switch(_context39.prev=_context39.next){case 0:return _context39.next=2,this.bucket.get(layout.c.build(hash,index));case 2:if(data=_context39.sent){_context39.next=5;break}return _context39.abrupt("return",null);case 5:return(credit=Credit.fromRaw(data)).coin.hash=hash,credit.coin.index=index,_context39.abrupt("return",credit);case 9:case"end":return _context39.stop()}},_callee39,this)}));return function(_x65,_x66){return _ref66.apply(this,arguments)}}(),TXDB.prototype.getSpentCoin=function(){var _ref67=_asyncToGenerator(regeneratorRuntime.mark(function _callee40(spent,prevout){var data,coin;return regeneratorRuntime.wrap(function(_context40){for(;;)switch(_context40.prev=_context40.next){case 0:return _context40.next=2,this.bucket.get(layout.d.build(spent.hash,spent.index));case 2:if(data=_context40.sent){_context40.next=5;break}return _context40.abrupt("return",null);case 5:return(coin=Coin.fromRaw(data)).hash=prevout.hash,coin.index=prevout.index,_context40.abrupt("return",coin);case 9:case"end":return _context40.stop()}},_callee40,this)}));return function(_x67,_x68){return _ref67.apply(this,arguments)}}(),TXDB.prototype.hasSpentCoin=function(spent){return this.bucket.has(layout.d.build(spent.hash,spent.index))},TXDB.prototype.updateSpentCoin=function(){var _ref68=_asyncToGenerator(regeneratorRuntime.mark(function _callee41(b,tx,index,height){var prevout,spent,coin;return regeneratorRuntime.wrap(function(_context41){for(;;)switch(_context41.prev=_context41.next){case 0:return prevout=Outpoint.fromTX(tx,index),_context41.next=3,this.getSpent(prevout.hash,prevout.index);case 3:if(spent=_context41.sent){_context41.next=6;break}return _context41.abrupt("return");case 6:return _context41.next=8,this.getSpentCoin(spent,prevout);case 8:if(coin=_context41.sent){_context41.next=11;break}return _context41.abrupt("return");case 11:coin.height=height,b.put(layout.d.build(spent.hash,spent.index),coin.toRaw());case 13:case"end":return _context41.stop()}},_callee41,this)}));return function(_x69,_x70,_x71,_x72){return _ref68.apply(this,arguments)}}(),TXDB.prototype.hasCoin=function(){var _ref69=_asyncToGenerator(regeneratorRuntime.mark(function _callee42(hash,index){return regeneratorRuntime.wrap(function(_context42){for(;;)switch(_context42.prev=_context42.next){case 0:return _context42.abrupt("return",this.bucket.has(layout.c.build(hash,index)));case 1:case"end":return _context42.stop()}},_callee42,this)}));return function(_x73,_x74){return _ref69.apply(this,arguments)}}(),TXDB.prototype.getBalance=function(){var _ref70=_asyncToGenerator(regeneratorRuntime.mark(function _callee43(acct){return regeneratorRuntime.wrap(function(_context43){for(;;)switch(_context43.prev=_context43.next){case 0:if(assert("number"==typeof acct),-1===acct){_context43.next=3;break}return _context43.abrupt("return",this.getAccountBalance(acct));case 3:return _context43.abrupt("return",this.getWalletBalance());case 4:case"end":return _context43.stop()}},_callee43,this)}));return function(_x75){return _ref70.apply(this,arguments)}}(),TXDB.prototype.getWalletBalance=function(){var _ref71=_asyncToGenerator(regeneratorRuntime.mark(function _callee44(){var data;return regeneratorRuntime.wrap(function(_context44){for(;;)switch(_context44.prev=_context44.next){case 0:return _context44.next=2,this.bucket.get(layout.R.build());case 2:if(data=_context44.sent){_context44.next=5;break}return _context44.abrupt("return",new Balance);case 5:return _context44.abrupt("return",Balance.fromRaw(-1,data));case 6:case"end":return _context44.stop()}},_callee44,this)}));return function(){return _ref71.apply(this,arguments)}}(),TXDB.prototype.getAccountBalance=function(){var _ref72=_asyncToGenerator(regeneratorRuntime.mark(function _callee45(acct){var data;return regeneratorRuntime.wrap(function(_context45){for(;;)switch(_context45.prev=_context45.next){case 0:return _context45.next=2,this.bucket.get(layout.r.build(acct));case 2:if(data=_context45.sent){_context45.next=5;break}return _context45.abrupt("return",new Balance(acct));case 5:return _context45.abrupt("return",Balance.fromRaw(acct,data));case 6:case"end":return _context45.stop()}},_callee45,this)}));return function(_x76){return _ref72.apply(this,arguments)}}(),TXDB.prototype.zap=function(){var _ref73=_asyncToGenerator(regeneratorRuntime.mark(function _callee46(acct,age){var now,txs,hashes,_iterator21,_isArray21,_i26,_ref74,wtx;return regeneratorRuntime.wrap(function(_context46){for(;;)switch(_context46.prev=_context46.next){case 0:return assert(age>>>0===age),now=util.now(),_context46.next=4,this.getRange(acct,{start:0,end:now-age});case 4:txs=_context46.sent,hashes=[],_iterator21=txs,_isArray21=Array.isArray(_iterator21),_i26=0,_iterator21=_isArray21?_iterator21:_iterator21[Symbol.iterator]();case 7:if(!_isArray21){_context46.next=13;break}if(!(_i26>=_iterator21.length)){_context46.next=10;break}return _context46.abrupt("break",27);case 10:_ref74=_iterator21[_i26++],_context46.next=17;break;case 13:if(!(_i26=_iterator21.next()).done){_context46.next=16;break}return _context46.abrupt("break",27);case 16:_ref74=_i26.value;case 17:if(-1===(wtx=_ref74).height){_context46.next=20;break}return _context46.abrupt("continue",25);case 20:return assert(now-wtx.mtime>=age),this.logger.debug("Zapping TX: %s (%d)",wtx.tx.txid(),this.wid),_context46.next=24,this.remove(wtx.hash);case 24:hashes.push(wtx.hash);case 25:_context46.next=7;break;case 27:return _context46.abrupt("return",hashes);case 28:case"end":return _context46.stop()}},_callee46,this)}));return function(_x77,_x78){return _ref73.apply(this,arguments)}}(),TXDB.prototype.abandon=function(){var _ref75=_asyncToGenerator(regeneratorRuntime.mark(function _callee47(hash){return regeneratorRuntime.wrap(function(_context47){for(;;)switch(_context47.prev=_context47.next){case 0:return _context47.next=2,this.bucket.has(layout.p.build(hash));case 2:if(_context47.sent){_context47.next=5;break}throw new Error("TX not eligible.");case 5:return _context47.abrupt("return",this.remove(hash));case 6:case"end":return _context47.stop()}},_callee47,this)}));return function(_x79){return _ref75.apply(this,arguments)}}(),TXDB}(),Balance=function(){function Balance(){var acct=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;_classCallCheck(this,Balance),assert("number"==typeof acct),this.account=acct,this.tx=0,this.coin=0,this.unconfirmed=0,this.confirmed=0}return Balance.prototype.applyTo=function(balance){balance.tx+=this.tx,balance.coin+=this.coin,balance.unconfirmed+=this.unconfirmed,balance.confirmed+=this.confirmed,assert(balance.tx>=0),assert(balance.coin>=0),assert(balance.unconfirmed>=0),assert(balance.confirmed>=0)},Balance.prototype.toRaw=function(){var bw=bio.write(32);return bw.writeU64(this.tx),bw.writeU64(this.coin),bw.writeU64(this.unconfirmed),bw.writeU64(this.confirmed),bw.render()},Balance.prototype.fromRaw=function(data){var br=bio.read(data);return this.tx=br.readU64(),this.coin=br.readU64(),this.unconfirmed=br.readU64(),this.confirmed=br.readU64(),this},Balance.fromRaw=function(acct,data){return new this(acct).fromRaw(data)},Balance.prototype.toJSON=function(minimal){return{account:minimal?void 0:this.account,tx:this.tx,coin:this.coin,unconfirmed:this.unconfirmed,confirmed:this.confirmed}},Balance.prototype.inspect=function(){return"<Balance tx="+this.tx+" coin="+this.coin+" unconfirmed="+Amount.btc(this.unconfirmed)+" confirmed="+Amount.btc(this.confirmed)+">"},Balance}(),BalanceDelta=function(){function BalanceDelta(){_classCallCheck(this,BalanceDelta),this.wallet=new Balance,this.accounts=new Map}return BalanceDelta.prototype.updated=function(){return 0!==this.wallet.tx},BalanceDelta.prototype.applyTo=function(balance){this.wallet.applyTo(balance)},BalanceDelta.prototype.get=function(path){return this.accounts.has(path.account)||this.accounts.set(path.account,new Balance),this.accounts.get(path.account)},BalanceDelta.prototype.tx=function(path,value){this.get(path).tx=value,this.wallet.tx=value},BalanceDelta.prototype.coin=function(path,value){this.get(path).coin+=value,this.wallet.coin+=value},BalanceDelta.prototype.unconfirmed=function(path,value){this.get(path).unconfirmed+=value,this.wallet.unconfirmed+=value},BalanceDelta.prototype.confirmed=function(path,value){this.get(path).confirmed+=value,this.wallet.confirmed+=value},BalanceDelta}(),Credit=function(){function Credit(coin,spent){_classCallCheck(this,Credit),this.coin=coin||new Coin,this.spent=spent||!1,this.own=!1}return Credit.prototype.fromRaw=function(data){var br=bio.read(data);return this.coin.fromReader(br),this.spent=1===br.readU8(),this.own=1===br.readU8(),this},Credit.fromRaw=function(data){return(new this).fromRaw(data)},Credit.prototype.getSize=function(){return this.coin.getSize()+2},Credit.prototype.toRaw=function(){var size=this.getSize(),bw=bio.write(size);return this.coin.toWriter(bw),bw.writeU8(this.spent?1:0),bw.writeU8(this.own?1:0),bw.render()},Credit.prototype.fromTX=function(tx,index,height){return this.coin.fromTX(tx,index,height),this.spent=!1,this.own=!1,this},Credit.fromTX=function(tx,index,height){return(new this).fromTX(tx,index,height)},Credit}(),Details=function(){function Details(wtx,block){_classCallCheck(this,Details),this.hash=wtx.hash,this.tx=wtx.tx,this.mtime=wtx.mtime,this.size=this.tx.getSize(),this.vsize=this.tx.getVirtualSize(),this.block=null,this.height=-1,this.time=0,block&&(this.block=block.hash,this.height=block.height,this.time=block.time),this.inputs=[],this.outputs=[],this.init()}return Details.prototype.init=function(){var _iterator22=this.tx.inputs,_isArray22=Array.isArray(_iterator22),_i27=0;for(_iterator22=_isArray22?_iterator22:_iterator22[Symbol.iterator]();;){var _ref76;if(_isArray22){if(_i27>=_iterator22.length)break;_ref76=_iterator22[_i27++]}else{if((_i27=_iterator22.next()).done)break;_ref76=_i27.value}var input=_ref76;(member=new DetailsMember).address=input.getAddress(),this.inputs.push(member)}var _iterator23=this.tx.outputs,_isArray23=Array.isArray(_iterator23),_i28=0;for(_iterator23=_isArray23?_iterator23:_iterator23[Symbol.iterator]();;){var _ref77;if(_isArray23){if(_i28>=_iterator23.length)break;_ref77=_iterator23[_i28++]}else{if((_i28=_iterator23.next()).done)break;_ref77=_i28.value}var member,output=_ref77;(member=new DetailsMember).value=output.value,member.address=output.getAddress(),this.outputs.push(member)}},Details.prototype.setInput=function(i,path,coin){var member=this.inputs[i];coin&&(member.value=coin.value,member.address=coin.getAddress()),path&&(member.path=path)},Details.prototype.setOutput=function(i,path){var member=this.outputs[i];path&&(member.path=path)},Details.prototype.getDepth=function(height){if(-1===this.height)return 0;if(null==height)return 0;var depth=height-this.height;return depth<0?0:depth+1},Details.prototype.getFee=function(){var inputValue=0,outputValue=0,_iterator24=this.inputs,_isArray24=Array.isArray(_iterator24),_i29=0;for(_iterator24=_isArray24?_iterator24:_iterator24[Symbol.iterator]();;){var _ref78;if(_isArray24){if(_i29>=_iterator24.length)break;_ref78=_iterator24[_i29++]}else{if((_i29=_iterator24.next()).done)break;_ref78=_i29.value}var input=_ref78;if(!input.path)return 0;inputValue+=input.value}var _iterator25=this.outputs,_isArray25=Array.isArray(_iterator25),_i30=0;for(_iterator25=_isArray25?_iterator25:_iterator25[Symbol.iterator]();;){var _ref79;if(_isArray25){if(_i30>=_iterator25.length)break;_ref79=_iterator25[_i30++]}else{if((_i30=_iterator25.next()).done)break;_ref79=_i30.value}outputValue+=_ref79.value}return inputValue-outputValue},Details.prototype.getRate=function(fee){return policy.getRate(this.vsize,fee)},Details.prototype.toJSON=function(network,height){var fee=this.getFee(),rate=this.getRate(fee);return{hash:util.revHex(this.hash),height:this.height,block:this.block?util.revHex(this.block):null,time:this.time,mtime:this.mtime,date:util.date(this.time),mdate:util.date(this.mtime),size:this.size,virtualSize:this.vsize,fee:fee,rate:rate,confirmations:this.getDepth(height),inputs:this.inputs.map(function(input){return input.getJSON(network)}),outputs:this.outputs.map(function(output){return output.getJSON(network)}),tx:this.tx.toRaw().toString("hex")}},Details}(),DetailsMember=function(){function DetailsMember(){_classCallCheck(this,DetailsMember),this.value=0,this.address=null,this.path=null}return DetailsMember.prototype.toJSON=function(){return this.getJSON()},DetailsMember.prototype.getJSON=function(network){return{value:this.value,address:this.address?this.address.toString(network):null,path:this.path?this.path.toJSON():null}},DetailsMember}(),BlockRecord=function(){function BlockRecord(hash,height,time){_classCallCheck(this,BlockRecord),this.hash=hash||consensus.NULL_HASH,this.height=null!=height?height:-1,this.time=time||0,this.hashes=new Set}return BlockRecord.prototype.add=function(hash){return!this.hashes.has(hash)&&(this.hashes.add(hash),!0)},BlockRecord.prototype.remove=function(hash){return this.hashes.delete(hash)},BlockRecord.prototype.fromRaw=function(data){var br=bio.read(data);this.hash=br.readHash("hex"),this.height=br.readU32(),this.time=br.readU32();for(var count=br.readU32(),i=0;i<count;i++){var hash=br.readHash("hex");this.hashes.add(hash)}return this},BlockRecord.fromRaw=function(data){return(new this).fromRaw(data)},BlockRecord.prototype.getSize=function(){return 44+32*this.hashes.size},BlockRecord.prototype.toRaw=function(){var size=this.getSize(),bw=bio.write(size);bw.writeHash(this.hash),bw.writeU32(this.height),bw.writeU32(this.time),bw.writeU32(this.hashes.size);var _iterator26=this.hashes,_isArray26=Array.isArray(_iterator26),_i31=0;for(_iterator26=_isArray26?_iterator26:_iterator26[Symbol.iterator]();;){var _ref80;if(_isArray26){if(_i31>=_iterator26.length)break;_ref80=_iterator26[_i31++]}else{if((_i31=_iterator26.next()).done)break;_ref80=_i31.value}var hash=_ref80;bw.writeHash(hash)}return bw.render()},BlockRecord.prototype.toArray=function(){var hashes=[],_iterator27=this.hashes,_isArray27=Array.isArray(_iterator27),_i32=0;for(_iterator27=_isArray27?_iterator27:_iterator27[Symbol.iterator]();;){var _ref81;if(_isArray27){if(_i32>=_iterator27.length)break;_ref81=_iterator27[_i32++]}else{if((_i32=_iterator27.next()).done)break;_ref81=_i32.value}var hash=_ref81;hashes.push(hash)}return hashes},BlockRecord.prototype.toJSON=function(){return{hash:util.revHex(this.hash),height:this.height,time:this.time,hashes:this.toArray().map(util.revHex)}},BlockRecord.prototype.fromMeta=function(block){return this.hash=block.hash,this.height=block.height,this.time=block.time,this},BlockRecord.fromMeta=function(block){return(new this).fromMeta(block)},BlockRecord}();module.exports=TXDB}).call(this,require("buffer").Buffer)},{"../btc/amount":8,"../coins/coinview":13,"../primitives/coin":71,"../primitives/outpoint":80,"../protocol/consensus":84,"../protocol/policy":89,"../utils/util":106,"./layout":112,"./records":119,assert:146,buffer:269,bufio:270}],122:[function(require,module,exports){(function(Buffer){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}var assert=require("assert"),EventEmitter=require("events"),Lock=require("bmutex").Lock,base58=require("bstring").base58,bio=require("bufio"),hash160=require("bcrypto/lib/hash160"),hash256=require("bcrypto/lib/hash256"),cleanse=require("bcrypto/lib/cleanse"),TXDB=require("./txdb"),Path=require("./path"),common=require("./common"),Address=require("../primitives/address"),MTX=require("../primitives/mtx"),Script=require("../script/script"),WalletKey=require("./walletkey"),HD=require("../hd/hd"),Output=require("../primitives/output"),Account=require("./account"),MasterKey=require("./masterkey"),policy=require("../protocol/policy"),consensus=require("../protocol/consensus"),encoding=bio.encoding,Mnemonic=HD.Mnemonic,Wallet=function(_EventEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Wallet,_EventEmitter);function Wallet(wdb,options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Wallet);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return assert(wdb,"WDB required."),_this.wdb=wdb,_this.db=wdb.db,_this.network=wdb.network,_this.logger=wdb.logger,_this.writeLock=new Lock,_this.fundLock=new Lock,_this.wid=0,_this.id=null,_this.watchOnly=!1,_this.accountDepth=0,_this.token=consensus.ZERO_HASH,_this.tokenDepth=0,_this.master=new MasterKey,_this.txdb=new TXDB(_this.wdb),options&&_this.fromOptions(options),_this}return Wallet.prototype.fromOptions=function(options){if(!options)return this;var key=options.master,id=void 0,token=void 0,mnemonic=void 0;return key?("string"==typeof key&&(key=HD.PrivateKey.fromBase58(key,this.network)),assert(HD.isPrivate(key),"Must create wallet with hd private key.")):(mnemonic=new Mnemonic(options.mnemonic),key=HD.fromMnemonic(mnemonic,options.password)),this.master.fromKey(key,mnemonic),null!=options.wid&&(assert(options.wid>>>0===options.wid),this.wid=options.wid),options.id&&(assert(common.isName(options.id),"Bad wallet ID."),id=options.id),null!=options.watchOnly&&(assert("boolean"==typeof options.watchOnly),this.watchOnly=options.watchOnly),null!=options.accountDepth&&(assert(options.accountDepth>>>0===options.accountDepth),this.accountDepth=options.accountDepth),options.token&&(assert(Buffer.isBuffer(options.token)),assert(32===options.token.length),token=options.token),null!=options.tokenDepth&&(assert(options.tokenDepth>>>0===options.tokenDepth),this.tokenDepth=options.tokenDepth),id||(id=this.getID()),token||(token=this.getToken(this.tokenDepth)),this.id=id,this.token=token,this},Wallet.fromOptions=function(wdb,options){return new this(wdb).fromOptions(options)},Wallet.prototype.init=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(options,passphrase){var account;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!passphrase){_context.next=3;break}return _context.next=3,this.master.encrypt(passphrase);case 3:return _context.next=5,this._createAccount(options,passphrase);case 5:return account=_context.sent,assert(account),this.logger.info("Wallet initialized (%s).",this.id),_context.abrupt("return",this.txdb.open(this));case 9:case"end":return _context.stop()}},_callee,this)}));return function(_x,_x2){return _ref.apply(this,arguments)}}(),Wallet.prototype.open=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,this.getAccount(0);case 2:if(_context2.sent){_context2.next=5;break}throw new Error("Default account not found.");case 5:return this.logger.info("Wallet opened (%s).",this.id),_context2.abrupt("return",this.txdb.open(this));case 7:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref2.apply(this,arguments)}}(),Wallet.prototype.destroy=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var unlock1,unlock2;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,this.writeLock.lock();case 2:return unlock1=_context3.sent,_context3.next=5,this.fundLock.lock();case 5:return unlock2=_context3.sent,_context3.prev=6,_context3.next=9,this.master.destroy();case 9:this.writeLock.destroy(),this.fundLock.destroy();case 11:return _context3.prev=11,unlock2(),unlock1(),_context3.finish(11);case 15:case"end":return _context3.stop()}},_callee3,this,[[6,,11,15]])}));return function(){return _ref3.apply(this,arguments)}}(),Wallet.prototype.addSharedKey=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(acct,key){var unlock;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,this.writeLock.lock();case 2:return unlock=_context4.sent,_context4.prev=3,_context4.next=6,this._addSharedKey(acct,key);case 6:return _context4.abrupt("return",_context4.sent);case 7:return _context4.prev=7,unlock(),_context4.finish(7);case 10:case"end":return _context4.stop()}},_callee4,this,[[3,,7,10]])}));return function(_x3,_x4){return _ref4.apply(this,arguments)}}(),Wallet.prototype._addSharedKey=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(acct,key){var account,b,result;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,this.getAccount(acct);case 2:if(account=_context5.sent){_context5.next=5;break}throw new Error("Account not found.");case 5:return b=this.db.batch(),_context5.next=8,account.addSharedKey(b,key);case 8:return result=_context5.sent,_context5.next=11,b.write();case 11:return _context5.abrupt("return",result);case 12:case"end":return _context5.stop()}},_callee5,this)}));return function(_x5,_x6){return _ref5.apply(this,arguments)}}(),Wallet.prototype.removeSharedKey=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(acct,key){var unlock;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=2,this.writeLock.lock();case 2:return unlock=_context6.sent,_context6.prev=3,_context6.next=6,this._removeSharedKey(acct,key);case 6:return _context6.abrupt("return",_context6.sent);case 7:return _context6.prev=7,unlock(),_context6.finish(7);case 10:case"end":return _context6.stop()}},_callee6,this,[[3,,7,10]])}));return function(_x7,_x8){return _ref6.apply(this,arguments)}}(),Wallet.prototype._removeSharedKey=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(acct,key){var account,b,result;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.next=2,this.getAccount(acct);case 2:if(account=_context7.sent){_context7.next=5;break}throw new Error("Account not found.");case 5:return b=this.db.batch(),_context7.next=8,account.removeSharedKey(b,key);case 8:return result=_context7.sent,_context7.next=11,b.write();case 11:return _context7.abrupt("return",result);case 12:case"end":return _context7.stop()}},_callee7,this)}));return function(_x9,_x10){return _ref7.apply(this,arguments)}}(),Wallet.prototype.setPassphrase=function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(passphrase,old){return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(null==old){_context8.next=3;break}return _context8.next=3,this.decrypt(old);case 3:return _context8.next=5,this.encrypt(passphrase);case 5:case"end":return _context8.stop()}},_callee8,this)}));return function(_x11,_x12){return _ref8.apply(this,arguments)}}(),Wallet.prototype.encrypt=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(passphrase){var unlock;return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return _context9.next=2,this.writeLock.lock();case 2:return unlock=_context9.sent,_context9.prev=3,_context9.next=6,this._encrypt(passphrase);case 6:return _context9.abrupt("return",_context9.sent);case 7:return _context9.prev=7,unlock(),_context9.finish(7);case 10:case"end":return _context9.stop()}},_callee9,this,[[3,,7,10]])}));return function(_x13){return _ref9.apply(this,arguments)}}(),Wallet.prototype._encrypt=function(){var _ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(passphrase){var key,b;return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return _context10.next=2,this.master.encrypt(passphrase,!0);case 2:return key=_context10.sent,b=this.db.batch(),_context10.prev=4,_context10.next=7,this.wdb.encryptKeys(b,this.wid,key);case 7:return _context10.prev=7,cleanse(key),_context10.finish(7);case 10:return this.save(b),_context10.next=13,b.write();case 13:case"end":return _context10.stop()}},_callee10,this,[[4,,7,10]])}));return function(_x14){return _ref10.apply(this,arguments)}}(),Wallet.prototype.decrypt=function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(passphrase){var unlock;return regeneratorRuntime.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:return _context11.next=2,this.writeLock.lock();case 2:return unlock=_context11.sent,_context11.prev=3,_context11.next=6,this._decrypt(passphrase);case 6:return _context11.abrupt("return",_context11.sent);case 7:return _context11.prev=7,unlock(),_context11.finish(7);case 10:case"end":return _context11.stop()}},_callee11,this,[[3,,7,10]])}));return function(_x15){return _ref11.apply(this,arguments)}}(),Wallet.prototype._decrypt=function(){var _ref12=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(passphrase){var key,b;return regeneratorRuntime.wrap(function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:return _context12.next=2,this.master.decrypt(passphrase,!0);case 2:return key=_context12.sent,b=this.db.batch(),_context12.prev=4,_context12.next=7,this.wdb.decryptKeys(b,this.wid,key);case 7:return _context12.prev=7,cleanse(key),_context12.finish(7);case 10:return this.save(b),_context12.next=13,b.write();case 13:case"end":return _context12.stop()}},_callee12,this,[[4,,7,10]])}));return function(_x16){return _ref12.apply(this,arguments)}}(),Wallet.prototype.retoken=function(){var _ref13=_asyncToGenerator(regeneratorRuntime.mark(function _callee13(passphrase){var unlock;return regeneratorRuntime.wrap(function(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:return _context13.next=2,this.writeLock.lock();case 2:return unlock=_context13.sent,_context13.prev=3,_context13.next=6,this._retoken(passphrase);case 6:return _context13.abrupt("return",_context13.sent);case 7:return _context13.prev=7,unlock(),_context13.finish(7);case 10:case"end":return _context13.stop()}},_callee13,this,[[3,,7,10]])}));return function(_x17){return _ref13.apply(this,arguments)}}(),Wallet.prototype._retoken=function(){var _ref14=_asyncToGenerator(regeneratorRuntime.mark(function _callee14(passphrase){var b;return regeneratorRuntime.wrap(function(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:if(!passphrase){_context14.next=3;break}return _context14.next=3,this.unlock(passphrase);case 3:return this.tokenDepth+=1,this.token=this.getToken(this.tokenDepth),b=this.db.batch(),this.save(b),_context14.next=9,b.write();case 9:return _context14.abrupt("return",this.token);case 10:case"end":return _context14.stop()}},_callee14,this)}));return function(_x18){return _ref14.apply(this,arguments)}}(),Wallet.prototype.rename=function(){var _ref15=_asyncToGenerator(regeneratorRuntime.mark(function _callee15(id){var unlock;return regeneratorRuntime.wrap(function(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:return _context15.next=2,this.writeLock.lock();case 2:return unlock=_context15.sent,_context15.prev=3,_context15.next=6,this.wdb.rename(this,id);case 6:return _context15.abrupt("return",_context15.sent);case 7:return _context15.prev=7,unlock(),_context15.finish(7);case 10:case"end":return _context15.stop()}},_callee15,this,[[3,,7,10]])}));return function(_x19){return _ref15.apply(this,arguments)}}(),Wallet.prototype.renameAccount=function(){var _ref16=_asyncToGenerator(regeneratorRuntime.mark(function _callee16(acct,name){var unlock;return regeneratorRuntime.wrap(function(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:return _context16.next=2,this.writeLock.lock();case 2:return unlock=_context16.sent,_context16.prev=3,_context16.next=6,this._renameAccount(acct,name);case 6:return _context16.abrupt("return",_context16.sent);case 7:return _context16.prev=7,unlock(),_context16.finish(7);case 10:case"end":return _context16.stop()}},_callee16,this,[[3,,7,10]])}));return function(_x20,_x21){return _ref16.apply(this,arguments)}}(),Wallet.prototype._renameAccount=function(){var _ref17=_asyncToGenerator(regeneratorRuntime.mark(function _callee17(acct,name){var account,b;return regeneratorRuntime.wrap(function(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:if(common.isName(name)){_context17.next=2;break}throw new Error("Bad account name.");case 2:return _context17.next=4,this.getAccount(acct);case 4:if(account=_context17.sent){_context17.next=7;break}throw new Error("Account not found.");case 7:if(0!==account.accountIndex){_context17.next=9;break}throw new Error("Cannot rename default account.");case 9:return _context17.next=11,this.hasAccount(name);case 11:if(!_context17.sent){_context17.next=13;break}throw new Error("Account name not available.");case 13:return b=this.db.batch(),this.wdb.renameAccount(b,account,name),_context17.next=17,b.write();case 17:case"end":return _context17.stop()}},_callee17,this)}));return function(_x22,_x23){return _ref17.apply(this,arguments)}}(),Wallet.prototype.lock=function(){var _ref18=_asyncToGenerator(regeneratorRuntime.mark(function _callee18(){var unlock1,unlock2;return regeneratorRuntime.wrap(function(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:return _context18.next=2,this.writeLock.lock();case 2:return unlock1=_context18.sent,_context18.next=5,this.fundLock.lock();case 5:return unlock2=_context18.sent,_context18.prev=6,_context18.next=9,this.master.lock();case 9:return _context18.prev=9,unlock2(),unlock1(),_context18.finish(9);case 13:case"end":return _context18.stop()}},_callee18,this,[[6,,9,13]])}));return function(){return _ref18.apply(this,arguments)}}(),Wallet.prototype.unlock=function(passphrase,timeout){return this.master.unlock(passphrase,timeout)},Wallet.prototype.getID=function(){assert(this.master.key,"Cannot derive id.");var key=this.master.key.derive(44),bw=bio.write(37);bw.writeBytes(key.publicKey),bw.writeU32(this.network.magic);var hash=hash160.digest(bw.render()),b58=bio.write(27);return b58.writeU8(3),b58.writeU8(190),b58.writeU8(4),b58.writeBytes(hash),b58.writeChecksum(hash256.digest),base58.encode(b58.render())},Wallet.prototype.getToken=function(nonce){if(!this.master.key)throw new Error("Cannot derive token.");var key=this.master.key.derive(44,!0),bw=bio.write(36);return bw.writeBytes(key.privateKey),bw.writeU32(nonce),hash256.digest(bw.render())},Wallet.prototype.createAccount=function(){var _ref19=_asyncToGenerator(regeneratorRuntime.mark(function _callee19(options,passphrase){var unlock;return regeneratorRuntime.wrap(function(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:return _context19.next=2,this.writeLock.lock();case 2:return unlock=_context19.sent,_context19.prev=3,_context19.next=6,this._createAccount(options,passphrase);case 6:return _context19.abrupt("return",_context19.sent);case 7:return _context19.prev=7,unlock(),_context19.finish(7);case 10:case"end":return _context19.stop()}},_callee19,this,[[3,,7,10]])}));return function(_x24,_x25){return _ref19.apply(this,arguments)}}(),Wallet.prototype._createAccount=function(){var _ref20=_asyncToGenerator(regeneratorRuntime.mark(function _callee20(options,passphrase){var name,key,type,opt,b,account;return regeneratorRuntime.wrap(function(_context20){for(;;)switch(_context20.prev=_context20.next){case 0:return(name=options.name)||(name=this.accountDepth.toString(10)),_context20.next=4,this.hasAccount(name);case 4:if(!_context20.sent){_context20.next=6;break}throw new Error("Account already exists.");case 6:return _context20.next=8,this.unlock(passphrase);case 8:if(key=void 0,!this.watchOnly||!options.accountKey){_context20.next=16;break}if("string"==typeof(key=options.accountKey)&&(key=HD.PublicKey.fromBase58(key,this.network)),HD.isPublic(key)){_context20.next=14;break}throw new Error("Must add HD public keys to watch only wallet.");case 14:_context20.next=20;break;case 16:assert(this.master.key),type=this.network.keyPrefix.coinType,key=(key=this.master.key.deriveAccount(44,type,this.accountDepth)).toPublic();case 20:return opt={wid:this.wid,id:this.id,name:0===this.accountDepth?"default":name,witness:options.witness,watchOnly:this.watchOnly,accountKey:key,accountIndex:this.accountDepth,type:options.type,m:options.m,n:options.n,keys:options.keys},b=this.db.batch(),account=Account.fromOptions(this.wdb,opt),_context20.next=25,account.init(b);case 25:return this.logger.info("Created account %s/%s/%d.",account.id,account.name,account.accountIndex),this.accountDepth+=1,this.save(b),0===this.accountDepth&&this.increment(b),_context20.next=31,b.write();case 31:return _context20.abrupt("return",account);case 32:case"end":return _context20.stop()}},_callee20,this)}));return function(_x26,_x27){return _ref20.apply(this,arguments)}}(),Wallet.prototype.ensureAccount=function(){var _ref21=_asyncToGenerator(regeneratorRuntime.mark(function _callee21(options,passphrase){var name,account;return regeneratorRuntime.wrap(function(_context21){for(;;)switch(_context21.prev=_context21.next){case 0:return name=options.name,_context21.next=3,this.getAccount(name);case 3:if(!(account=_context21.sent)){_context21.next=6;break}return _context21.abrupt("return",account);case 6:return _context21.abrupt("return",this.createAccount(options,passphrase));case 7:case"end":return _context21.stop()}},_callee21,this)}));return function(_x28,_x29){return _ref21.apply(this,arguments)}}(),Wallet.prototype.getAccounts=function(){return this.wdb.getAccounts(this.wid)},Wallet.prototype.getAddressHashes=function(acct){return null!=acct?this.getAccountHashes(acct):this.wdb.getWalletHashes(this.wid)},Wallet.prototype.getAccountHashes=function(){var _ref22=_asyncToGenerator(regeneratorRuntime.mark(function _callee22(acct){var index;return regeneratorRuntime.wrap(function(_context22){for(;;)switch(_context22.prev=_context22.next){case 0:return _context22.next=2,this.getAccountIndex(acct);case 2:if(-1!==(index=_context22.sent)){_context22.next=5;break}throw new Error("Account not found.");case 5:return _context22.abrupt("return",this.wdb.getAccountHashes(this.wid,index));case 6:case"end":return _context22.stop()}},_callee22,this)}));return function(_x30){return _ref22.apply(this,arguments)}}(),Wallet.prototype.getAccount=function(){var _ref23=_asyncToGenerator(regeneratorRuntime.mark(function _callee23(acct){var index,account;return regeneratorRuntime.wrap(function(_context23){for(;;)switch(_context23.prev=_context23.next){case 0:return _context23.next=2,this.getAccountIndex(acct);case 2:if(-1!==(index=_context23.sent)){_context23.next=5;break}return _context23.abrupt("return",null);case 5:return _context23.next=7,this.wdb.getAccount(this.wid,index);case 7:if(account=_context23.sent){_context23.next=10;break}return _context23.abrupt("return",null);case 10:return account.wid=this.wid,account.id=this.id,account.watchOnly=this.watchOnly,_context23.abrupt("return",account);case 14:case"end":return _context23.stop()}},_callee23,this)}));return function(_x31){return _ref23.apply(this,arguments)}}(),Wallet.prototype.getAccountIndex=function(acct){return null==acct?-1:"number"==typeof acct?acct:this.wdb.getAccountIndex(this.wid,acct)},Wallet.prototype.ensureIndex=function(){var _ref24=_asyncToGenerator(regeneratorRuntime.mark(function _callee24(acct){var index;return regeneratorRuntime.wrap(function(_context24){for(;;)switch(_context24.prev=_context24.next){case 0:if(null!=acct&&-1!==acct){_context24.next=2;break}return _context24.abrupt("return",-1);case 2:return _context24.next=4,this.getAccountIndex(acct);case 4:if(-1!==(index=_context24.sent)){_context24.next=7;break}throw new Error("Account not found.");case 7:return _context24.abrupt("return",index);case 8:case"end":return _context24.stop()}},_callee24,this)}));return function(_x32){return _ref24.apply(this,arguments)}}(),Wallet.prototype.getAccountName=function(){var _ref25=_asyncToGenerator(regeneratorRuntime.mark(function _callee25(index){return regeneratorRuntime.wrap(function(_context25){for(;;)switch(_context25.prev=_context25.next){case 0:if("string"!=typeof index){_context25.next=2;break}return _context25.abrupt("return",index);case 2:return _context25.abrupt("return",this.wdb.getAccountName(this.wid,index));case 3:case"end":return _context25.stop()}},_callee25,this)}));return function(_x33){return _ref25.apply(this,arguments)}}(),Wallet.prototype.hasAccount=function(){var _ref26=_asyncToGenerator(regeneratorRuntime.mark(function _callee26(acct){var index;return regeneratorRuntime.wrap(function(_context26){for(;;)switch(_context26.prev=_context26.next){case 0:return _context26.next=2,this.getAccountIndex(acct);case 2:if(-1!==(index=_context26.sent)){_context26.next=5;break}return _context26.abrupt("return",!1);case 5:return _context26.abrupt("return",this.db.hasAccount(this.wid,index));case 6:case"end":return _context26.stop()}},_callee26,this)}));return function(_x34){return _ref26.apply(this,arguments)}}(),Wallet.prototype.createReceive=function(){var acct=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.createKey(acct,0)},Wallet.prototype.createChange=function(){var acct=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.createKey(acct,1)},Wallet.prototype.createNested=function(){var acct=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.createKey(acct,2)},Wallet.prototype.createKey=function(){var _ref27=_asyncToGenerator(regeneratorRuntime.mark(function _callee27(acct,branch){var unlock;return regeneratorRuntime.wrap(function(_context27){for(;;)switch(_context27.prev=_context27.next){case 0:return _context27.next=2,this.writeLock.lock();case 2:return unlock=_context27.sent,_context27.prev=3,_context27.next=6,this._createKey(acct,branch);case 6:return _context27.abrupt("return",_context27.sent);case 7:return _context27.prev=7,unlock(),_context27.finish(7);case 10:case"end":return _context27.stop()}},_callee27,this,[[3,,7,10]])}));return function(_x38,_x39){return _ref27.apply(this,arguments)}}(),Wallet.prototype._createKey=function(){var _ref28=_asyncToGenerator(regeneratorRuntime.mark(function _callee28(acct,branch){var account,b,key;return regeneratorRuntime.wrap(function(_context28){for(;;)switch(_context28.prev=_context28.next){case 0:return _context28.next=2,this.getAccount(acct);case 2:if(account=_context28.sent){_context28.next=5;break}throw new Error("Account not found.");case 5:return b=this.db.batch(),_context28.next=8,account.createKey(b,branch);case 8:return key=_context28.sent,_context28.next=11,b.write();case 11:return _context28.abrupt("return",key);case 12:case"end":return _context28.stop()}},_callee28,this)}));return function(_x40,_x41){return _ref28.apply(this,arguments)}}(),Wallet.prototype.save=function(b){return this.wdb.save(b,this)},Wallet.prototype.increment=function(b){return this.wdb.increment(b,this.wid)},Wallet.prototype.hasAddress=function(){var _ref29=_asyncToGenerator(regeneratorRuntime.mark(function _callee29(address){var hash,path;return regeneratorRuntime.wrap(function(_context29){for(;;)switch(_context29.prev=_context29.next){case 0:return hash=Address.getHash(address,"hex"),_context29.next=3,this.getPath(hash);case 3:return path=_context29.sent,_context29.abrupt("return",null!=path);case 5:case"end":return _context29.stop()}},_callee29,this)}));return function(_x42){return _ref29.apply(this,arguments)}}(),Wallet.prototype.getPath=function(){var _ref30=_asyncToGenerator(regeneratorRuntime.mark(function _callee30(address){var hash;return regeneratorRuntime.wrap(function(_context30){for(;;)switch(_context30.prev=_context30.next){case 0:return hash=Address.getHash(address,"hex"),_context30.abrupt("return",this.wdb.getPath(this.wid,hash));case 2:case"end":return _context30.stop()}},_callee30,this)}));return function(_x43){return _ref30.apply(this,arguments)}}(),Wallet.prototype.readPath=function(){var _ref31=_asyncToGenerator(regeneratorRuntime.mark(function _callee31(address){var hash;return regeneratorRuntime.wrap(function(_context31){for(;;)switch(_context31.prev=_context31.next){case 0:return hash=Address.getHash(address,"hex"),_context31.abrupt("return",this.wdb.readPath(this.wid,hash));case 2:case"end":return _context31.stop()}},_callee31,this)}));return function(_x44){return _ref31.apply(this,arguments)}}(),Wallet.prototype.hasPath=function(){var _ref32=_asyncToGenerator(regeneratorRuntime.mark(function _callee32(address){var hash;return regeneratorRuntime.wrap(function(_context32){for(;;)switch(_context32.prev=_context32.next){case 0:return hash=Address.getHash(address,"hex"),_context32.abrupt("return",this.wdb.hasPath(this.wid,hash));case 2:case"end":return _context32.stop()}},_callee32,this)}));return function(_x45){return _ref32.apply(this,arguments)}}(),Wallet.prototype.getPaths=function(){var _ref33=_asyncToGenerator(regeneratorRuntime.mark(function _callee33(acct){return regeneratorRuntime.wrap(function(_context33){for(;;)switch(_context33.prev=_context33.next){case 0:if(null==acct){_context33.next=2;break}return _context33.abrupt("return",this.getAccountPaths(acct));case 2:return _context33.abrupt("return",this.wdb.getWalletPaths(this.wid));case 3:case"end":return _context33.stop()}},_callee33,this)}));return function(_x46){return _ref33.apply(this,arguments)}}(),Wallet.prototype.getAccountPaths=function(){var _ref34=_asyncToGenerator(regeneratorRuntime.mark(function _callee34(acct){var index,hashes,name,result,_iterator,_isArray,_i,_ref35,hash,path;return regeneratorRuntime.wrap(function(_context34){for(;;)switch(_context34.prev=_context34.next){case 0:return _context34.next=2,this.getAccountIndex(acct);case 2:if(-1!==(index=_context34.sent)){_context34.next=5;break}throw new Error("Account not found.");case 5:return _context34.next=7,this.getAccountHashes(index);case 7:return hashes=_context34.sent,_context34.next=10,this.getAccountName(acct);case 10:name=_context34.sent,assert(name),result=[],_iterator=hashes,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();case 14:if(!_isArray){_context34.next=20;break}if(!(_i>=_iterator.length)){_context34.next=17;break}return _context34.abrupt("break",34);case 17:_ref35=_iterator[_i++],_context34.next=24;break;case 20:if(!(_i=_iterator.next()).done){_context34.next=23;break}return _context34.abrupt("break",34);case 23:_ref35=_i.value;case 24:return hash=_ref35,_context34.next=27,this.readPath(hash);case 27:path=_context34.sent,assert(path),assert(path.account===index),path.name=name,result.push(path);case 32:_context34.next=14;break;case 34:return _context34.abrupt("return",result);case 35:case"end":return _context34.stop()}},_callee34,this)}));return function(_x47){return _ref34.apply(this,arguments)}}(),Wallet.prototype.importKey=function(){var _ref36=_asyncToGenerator(regeneratorRuntime.mark(function _callee35(acct,ring,passphrase){var unlock;return regeneratorRuntime.wrap(function(_context35){for(;;)switch(_context35.prev=_context35.next){case 0:return _context35.next=2,this.writeLock.lock();case 2:return unlock=_context35.sent,_context35.prev=3,_context35.next=6,this._importKey(acct,ring,passphrase);case 6:return _context35.abrupt("return",_context35.sent);case 7:return _context35.prev=7,unlock(),_context35.finish(7);case 10:case"end":return _context35.stop()}},_callee35,this,[[3,,7,10]])}));return function(_x48,_x49,_x50){return _ref36.apply(this,arguments)}}(),Wallet.prototype._importKey=function(){var _ref37=_asyncToGenerator(regeneratorRuntime.mark(function _callee36(acct,ring,passphrase){var hash,account,key,path,b;return regeneratorRuntime.wrap(function(_context36){for(;;)switch(_context36.prev=_context36.next){case 0:if(this.watchOnly){_context36.next=5;break}if(ring.privateKey){_context36.next=3;break}throw new Error("Cannot import pubkey into non watch-only wallet.");case 3:_context36.next=7;break;case 5:if(!ring.privateKey){_context36.next=7;break}throw new Error("Cannot import privkey into watch-only wallet.");case 7:return hash=ring.getHash("hex"),_context36.next=10,this.getPath(hash);case 10:if(!_context36.sent){_context36.next=12;break}throw new Error("Key already exists.");case 12:return _context36.next=14,this.getAccount(acct);case 14:if(account=_context36.sent){_context36.next=17;break}throw new Error("Account not found.");case 17:if(account.type===Account.types.PUBKEYHASH){_context36.next=19;break}throw new Error("Cannot import into non-pkh account.");case 19:return _context36.next=21,this.unlock(passphrase);case 21:return key=WalletKey.fromRing(account,ring),path=key.toPath(),this.master.encrypted&&(path.data=this.master.encipher(path.data,path.hash),assert(path.data),path.encrypted=!0),b=this.db.batch(),_context36.next=27,account.savePath(b,path);case 27:return _context36.next=29,b.write();case 29:case"end":return _context36.stop()}},_callee36,this)}));return function(_x51,_x52,_x53){return _ref37.apply(this,arguments)}}(),Wallet.prototype.importAddress=function(){var _ref38=_asyncToGenerator(regeneratorRuntime.mark(function _callee37(acct,address){var unlock;return regeneratorRuntime.wrap(function(_context37){for(;;)switch(_context37.prev=_context37.next){case 0:return _context37.next=2,this.writeLock.lock();case 2:return unlock=_context37.sent,_context37.prev=3,_context37.next=6,this._importAddress(acct,address);case 6:return _context37.abrupt("return",_context37.sent);case 7:return _context37.prev=7,unlock(),_context37.finish(7);case 10:case"end":return _context37.stop()}},_callee37,this,[[3,,7,10]])}));return function(_x54,_x55){return _ref38.apply(this,arguments)}}(),Wallet.prototype._importAddress=function(){var _ref39=_asyncToGenerator(regeneratorRuntime.mark(function _callee38(acct,address){var account,path,b;return regeneratorRuntime.wrap(function(_context38){for(;;)switch(_context38.prev=_context38.next){case 0:if(this.watchOnly){_context38.next=2;break}throw new Error("Cannot import address into non watch-only wallet.");case 2:return _context38.next=4,this.getPath(address);case 4:if(!_context38.sent){_context38.next=6;break}throw new Error("Address already exists.");case 6:return _context38.next=8,this.getAccount(acct);case 8:if(account=_context38.sent){_context38.next=11;break}throw new Error("Account not found.");case 11:if(account.type===Account.types.PUBKEYHASH){_context38.next=13;break}throw new Error("Cannot import into non-pkh account.");case 13:return path=Path.fromAddress(account,address),b=this.db.batch(),_context38.next=17,account.savePath(b,path);case 17:return _context38.next=19,b.write();case 19:case"end":return _context38.stop()}},_callee38,this)}));return function(_x56,_x57){return _ref39.apply(this,arguments)}}(),Wallet.prototype.fund=function(){var _ref40=_asyncToGenerator(regeneratorRuntime.mark(function _callee39(mtx,options,force){var unlock;return regeneratorRuntime.wrap(function(_context39){for(;;)switch(_context39.prev=_context39.next){case 0:return _context39.next=2,this.fundLock.lock(force);case 2:return unlock=_context39.sent,_context39.prev=3,_context39.next=6,this._fund(mtx,options);case 6:return _context39.abrupt("return",_context39.sent);case 7:return _context39.prev=7,unlock(),_context39.finish(7);case 10:case"end":return _context39.stop()}},_callee39,this,[[3,,7,10]])}));return function(_x58,_x59,_x60){return _ref40.apply(this,arguments)}}(),Wallet.prototype._fund=function(){var _ref41=_asyncToGenerator(regeneratorRuntime.mark(function _callee40(mtx,options){var acct,change,rate,coins,_this2=this;return regeneratorRuntime.wrap(function(_context40){for(;;)switch(_context40.prev=_context40.next){case 0:if(options||(options={}),!this.watchOnly){_context40.next=3;break}throw new Error("Cannot fund from watch-only wallet.");case 3:return acct=options.account||0,_context40.next=6,this.changeAddress(acct);case 6:if(change=_context40.sent){_context40.next=9;break}throw new Error("Account not found.");case 9:if(null!=(rate=options.rate)){_context40.next=14;break}return _context40.next=13,this.wdb.estimateFee(options.blocks);case 13:rate=_context40.sent;case 14:if(coins=void 0,!options.smart){_context40.next=21;break}return _context40.next=18,this.getSmartCoins(options.account);case 18:coins=_context40.sent,_context40.next=25;break;case 21:return _context40.next=23,this.getCoins(options.account);case 23:coins=_context40.sent,coins=this.txdb.filterLocked(coins);case 25:return _context40.next=27,mtx.fund(coins,{selection:options.selection,round:options.round,depth:options.depth,hardFee:options.hardFee,subtractFee:options.subtractFee,subtractIndex:options.subtractIndex,changeAddress:change,height:this.wdb.state.height,rate:rate,maxFee:options.maxFee,estimate:function(prev){return _this2.estimateSize(prev)}});case 27:assert(mtx.getFee()<=MTX.Selector.MAX_FEE,"TX exceeds MAX_FEE.");case 28:case"end":return _context40.stop()}},_callee40,this)}));return function(_x61,_x62){return _ref41.apply(this,arguments)}}(),Wallet.prototype.getAccountByAddress=function(){var _ref42=_asyncToGenerator(regeneratorRuntime.mark(function _callee41(address){var hash,path;return regeneratorRuntime.wrap(function(_context41){for(;;)switch(_context41.prev=_context41.next){case 0:return hash=Address.getHash(address,"hex"),_context41.next=3,this.getPath(hash);case 3:if(path=_context41.sent){_context41.next=6;break}return _context41.abrupt("return",null);case 6:return _context41.abrupt("return",this.getAccount(path.account));case 7:case"end":return _context41.stop()}},_callee41,this)}));return function(_x63){return _ref42.apply(this,arguments)}}(),Wallet.prototype.estimateSize=function(){var _ref43=_asyncToGenerator(regeneratorRuntime.mark(function _callee42(prev){var address,account,size;return regeneratorRuntime.wrap(function(_context42){for(;;)switch(_context42.prev=_context42.next){case 0:if(consensus.WITNESS_SCALE_FACTOR,address=prev.getAddress()){_context42.next=4;break}return _context42.abrupt("return",-1);case 4:return _context42.next=6,this.getAccountByAddress(address);case 6:if(account=_context42.sent){_context42.next=9;break}return _context42.abrupt("return",-1);case 9:if(size=0,!prev.isScripthash()){_context42.next=21;break}if(!account.witness){_context42.next=21;break}_context42.t0=account.type,_context42.next=_context42.t0===Account.types.PUBKEYHASH?15:_context42.t0===Account.types.MULTISIG?18:21;break;case 15:return size+=23,size*=4,_context42.abrupt("break",21);case 18:return size+=35,size*=4,_context42.abrupt("break",21);case 21:_context42.t1=account.type,_context42.next=_context42.t1===Account.types.PUBKEYHASH?24:_context42.t1===Account.types.MULTISIG?27:35;break;case 24:return size+=74,size+=34,_context42.abrupt("break",35);case 27:return size+=1,size+=74*account.m,size+=3,size+=1,size+=34*account.n,size+=1,size+=1,_context42.abrupt("break",35);case 35:return account.witness&&(size+=1,size+=encoding.sizeVarint(size)),_context42.abrupt("return",size);case 37:case"end":return _context42.stop()}},_callee42,this)}));return function(_x64){return _ref43.apply(this,arguments)}}(),Wallet.prototype.createTX=function(){var _ref44=_asyncToGenerator(regeneratorRuntime.mark(function _callee43(options,force){var outputs,mtx,_iterator2,_isArray2,_i2,_ref45,output,addr;return regeneratorRuntime.wrap(function(_context43){for(;;)switch(_context43.prev=_context43.next){case 0:outputs=options.outputs,mtx=new MTX,assert(Array.isArray(outputs),"Outputs must be an array."),assert(outputs.length>0,"No outputs available."),_iterator2=outputs,_isArray2=Array.isArray(_iterator2),_i2=0,_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();case 5:if(!_isArray2){_context43.next=11;break}if(!(_i2>=_iterator2.length)){_context43.next=8;break}return _context43.abrupt("break",28);case 8:_ref45=_iterator2[_i2++],_context43.next=15;break;case 11:if(!(_i2=_iterator2.next()).done){_context43.next=14;break}return _context43.abrupt("break",28);case 14:_ref45=_i2.value;case 15:if(output=new Output(_ref45),addr=output.getAddress(),!output.isDust()){_context43.next=20;break}throw new Error("Output is dust.");case 20:if(!(output.value>0)){_context43.next=25;break}if(addr){_context43.next=23;break}throw new Error("Cannot send to unknown address.");case 23:if(!addr.isNull()){_context43.next=25;break}throw new Error("Cannot send to null address.");case 25:mtx.outputs.push(output);case 26:_context43.next=5;break;case 28:return _context43.next=30,this.fund(mtx,options,force);case 30:return!1!==options.sort&&mtx.sortMembers(),null!=options.locktime&&mtx.setLocktime(options.locktime),assert(mtx.isSane(),"TX failed sanity check."),assert(mtx.verifyInputs(this.wdb.state.height+1),"TX failed context check."),_context43.next=36,this.template(mtx);case 36:if(0!==_context43.sent){_context43.next=39;break}throw new Error("Templating failed.");case 39:return _context43.abrupt("return",mtx);case 40:case"end":return _context43.stop()}},_callee43,this)}));return function(_x65,_x66){return _ref44.apply(this,arguments)}}(),Wallet.prototype.send=function(){var _ref46=_asyncToGenerator(regeneratorRuntime.mark(function _callee44(options,passphrase){var unlock;return regeneratorRuntime.wrap(function(_context44){for(;;)switch(_context44.prev=_context44.next){case 0:return _context44.next=2,this.fundLock.lock();case 2:return unlock=_context44.sent,_context44.prev=3,_context44.next=6,this._send(options,passphrase);case 6:return _context44.abrupt("return",_context44.sent);case 7:return _context44.prev=7,unlock(),_context44.finish(7);case 10:case"end":return _context44.stop()}},_callee44,this,[[3,,7,10]])}));return function(_x67,_x68){return _ref46.apply(this,arguments)}}(),Wallet.prototype._send=function(){var _ref47=_asyncToGenerator(regeneratorRuntime.mark(function _callee45(options,passphrase){var mtx,tx;return regeneratorRuntime.wrap(function(_context45){for(;;)switch(_context45.prev=_context45.next){case 0:return _context45.next=2,this.createTX(options,!0);case 2:return mtx=_context45.sent,_context45.next=5,this.sign(mtx,passphrase);case 5:if(mtx.isSigned()){_context45.next=7;break}throw new Error("TX could not be fully signed.");case 7:if(!((tx=mtx.toTX()).getSigopsCount(mtx.view)>policy.MAX_TX_SIGOPS)){_context45.next=10;break}throw new Error("TX exceeds policy sigops.");case 10:if(!(tx.getWeight()>policy.MAX_TX_WEIGHT)){_context45.next=12;break}throw new Error("TX exceeds policy weight.");case 12:return _context45.next=14,this.wdb.addTX(tx);case 14:return this.logger.debug("Sending wallet tx (%s): %s",this.id,tx.txid()),_context45.next=17,this.wdb.send(tx);case 17:return _context45.abrupt("return",tx);case 18:case"end":return _context45.stop()}},_callee45,this)}));return function(_x69,_x70){return _ref47.apply(this,arguments)}}(),Wallet.prototype.increaseFee=function(){var _ref48=_asyncToGenerator(regeneratorRuntime.mark(function _callee46(hash,rate,passphrase){var wtx,tx,view,oldFee,fee,mtx,_iterator3,_isArray3,_i3,_ref49,change,i,output,addr,path,ntx;return regeneratorRuntime.wrap(function(_context46){for(;;)switch(_context46.prev=_context46.next){case 0:return assert(rate>>>0===rate,"Rate must be a number."),_context46.next=3,this.getTX(hash);case 3:if(wtx=_context46.sent){_context46.next=6;break}throw new Error("Transaction not found.");case 6:if(-1===wtx.height){_context46.next=8;break}throw new Error("Transaction is confirmed.");case 8:if(!(tx=wtx.tx).isCoinbase()){_context46.next=11;break}throw new Error("Transaction is a coinbase.");case 11:return _context46.next=13,this.getSpentView(tx);case 13:if(view=_context46.sent,tx.hasCoins(view)){_context46.next=16;break}throw new Error("Not all coins available.");case 16:if(oldFee=tx.getFee(view),(fee=tx.getMinFee(null,rate))>MTX.Selector.MAX_FEE&&(fee=MTX.Selector.MAX_FEE),!(oldFee>=fee)){_context46.next=21;break}throw new Error("Fee is not increasing.");case 21:(mtx=MTX.fromTX(tx)).view=view,_iterator3=mtx.inputs,_isArray3=Array.isArray(_iterator3),_i3=0,_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();case 24:if(!_isArray3){_context46.next=30;break}if(!(_i3>=_iterator3.length)){_context46.next=27;break}return _context46.abrupt("break",38);case 27:_ref49=_iterator3[_i3++],_context46.next=34;break;case 30:if(!(_i3=_iterator3.next()).done){_context46.next=33;break}return _context46.abrupt("break",38);case 33:_ref49=_i3.value;case 34:_ref49.script.clear();case 36:_context46.next=24;break;case 38:change=void 0,i=0;case 40:if(!(i<mtx.outputs.length)){_context46.next=57;break}if(output=mtx.outputs[i],addr=output.getAddress()){_context46.next=45;break}return _context46.abrupt("continue",54);case 45:return _context46.next=47,this.getPath(addr);case 47:if(path=_context46.sent){_context46.next=50;break}return _context46.abrupt("continue",54);case 50:if(1!==path.branch){_context46.next=54;break}return change=output,mtx.changeIndex=i,_context46.abrupt("break",57);case 54:i++,_context46.next=40;break;case 57:if(change){_context46.next=59;break}throw new Error("No change output.");case 59:if(change.value+=oldFee,0===mtx.getFee()){_context46.next=62;break}throw new Error("Arithmetic error for change.");case 62:if(change.value-=fee,!(change.value<0)){_context46.next=65;break}throw new Error("Fee is too high.");case 65:return change.isDust()&&(mtx.outputs.splice(mtx.changeIndex,1),mtx.changeIndex=-1),_context46.next=68,this.sign(mtx,passphrase);case 68:if(mtx.isSigned()){_context46.next=70;break}throw new Error("TX could not be fully signed.");case 70:return ntx=mtx.toTX(),this.logger.debug("Increasing fee for wallet tx (%s): %s",this.id,ntx.txid()),_context46.next=74,this.wdb.addTX(ntx);case 74:return _context46.next=76,this.wdb.send(ntx);case 76:return _context46.abrupt("return",ntx);case 77:case"end":return _context46.stop()}},_callee46,this)}));return function(_x71,_x72,_x73){return _ref48.apply(this,arguments)}}(),Wallet.prototype.resend=function(){var _ref50=_asyncToGenerator(regeneratorRuntime.mark(function _callee47(){var wtxs,txs,_iterator4,_isArray4,_i4,_ref51,wtx,sorted,_iterator5,_isArray5,_i5,_ref52,tx;return regeneratorRuntime.wrap(function(_context47){for(;;)switch(_context47.prev=_context47.next){case 0:return _context47.next=2,this.getPending();case 2:(wtxs=_context47.sent).length>0&&this.logger.info("Rebroadcasting %d transactions.",wtxs.length),txs=[],_iterator4=wtxs,_isArray4=Array.isArray(_iterator4),_i4=0,_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();case 6:if(!_isArray4){_context47.next=12;break}if(!(_i4>=_iterator4.length)){_context47.next=9;break}return _context47.abrupt("break",20);case 9:_ref51=_iterator4[_i4++],_context47.next=16;break;case 12:if(!(_i4=_iterator4.next()).done){_context47.next=15;break}return _context47.abrupt("break",20);case 15:_ref51=_i4.value;case 16:wtx=_ref51,txs.push(wtx.tx);case 18:_context47.next=6;break;case 20:sorted=common.sortDeps(txs),_iterator5=sorted,_isArray5=Array.isArray(_iterator5),_i5=0,_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();case 22:if(!_isArray5){_context47.next=28;break}if(!(_i5>=_iterator5.length)){_context47.next=25;break}return _context47.abrupt("break",37);case 25:_ref52=_iterator5[_i5++],_context47.next=32;break;case 28:if(!(_i5=_iterator5.next()).done){_context47.next=31;break}return _context47.abrupt("break",37);case 31:_ref52=_i5.value;case 32:return tx=_ref52,_context47.next=35,this.wdb.send(tx);case 35:_context47.next=22;break;case 37:return _context47.abrupt("return",txs);case 38:case"end":return _context47.stop()}},_callee47,this)}));return function(){return _ref50.apply(this,arguments)}}(),Wallet.prototype.deriveInputs=function(){var _ref53=_asyncToGenerator(regeneratorRuntime.mark(function _callee48(mtx){var paths,rings,_iterator6,_isArray6,_i6,_ref54,path,account,ring;return regeneratorRuntime.wrap(function(_context48){for(;;)switch(_context48.prev=_context48.next){case 0:return assert(mtx.mutable),_context48.next=3,this.getInputPaths(mtx);case 3:paths=_context48.sent,rings=[],_iterator6=paths,_isArray6=Array.isArray(_iterator6),_i6=0,_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();case 6:if(!_isArray6){_context48.next=12;break}if(!(_i6>=_iterator6.length)){_context48.next=9;break}return _context48.abrupt("break",26);case 9:_ref54=_iterator6[_i6++],_context48.next=16;break;case 12:if(!(_i6=_iterator6.next()).done){_context48.next=15;break}return _context48.abrupt("break",26);case 15:_ref54=_i6.value;case 16:return path=_ref54,_context48.next=19,this.getAccount(path.account);case 19:if(account=_context48.sent){_context48.next=22;break}return _context48.abrupt("continue",24);case 22:(ring=account.derivePath(path,this.master))&&rings.push(ring);case 24:_context48.next=6;break;case 26:return _context48.abrupt("return",rings);case 27:case"end":return _context48.stop()}},_callee48,this)}));return function(_x74){return _ref53.apply(this,arguments)}}(),Wallet.prototype.getKey=function(){var _ref55=_asyncToGenerator(regeneratorRuntime.mark(function _callee49(address){var hash,path,account;return regeneratorRuntime.wrap(function(_context49){for(;;)switch(_context49.prev=_context49.next){case 0:return hash=Address.getHash(address,"hex"),_context49.next=3,this.getPath(hash);case 3:if(path=_context49.sent){_context49.next=6;break}return _context49.abrupt("return",null);case 6:return _context49.next=8,this.getAccount(path.account);case 8:if(account=_context49.sent){_context49.next=11;break}return _context49.abrupt("return",null);case 11:return _context49.abrupt("return",account.derivePath(path,this.master));case 12:case"end":return _context49.stop()}},_callee49,this)}));return function(_x75){return _ref55.apply(this,arguments)}}(),Wallet.prototype.getPrivateKey=function(){var _ref56=_asyncToGenerator(regeneratorRuntime.mark(function _callee50(address,passphrase){var hash,path,account,key;return regeneratorRuntime.wrap(function(_context50){for(;;)switch(_context50.prev=_context50.next){case 0:return hash=Address.getHash(address,"hex"),_context50.next=3,this.getPath(hash);case 3:if(path=_context50.sent){_context50.next=6;break}return _context50.abrupt("return",null);case 6:return _context50.next=8,this.getAccount(path.account);case 8:if(account=_context50.sent){_context50.next=11;break}return _context50.abrupt("return",null);case 11:return _context50.next=13,this.unlock(passphrase);case 13:if((key=account.derivePath(path,this.master)).privateKey){_context50.next=16;break}return _context50.abrupt("return",null);case 16:return _context50.abrupt("return",key);case 17:case"end":return _context50.stop()}},_callee50,this)}));return function(_x76,_x77){return _ref56.apply(this,arguments)}}(),Wallet.prototype.getInputPaths=function(){var _ref57=_asyncToGenerator(regeneratorRuntime.mark(function _callee51(mtx){var hashes,paths,_iterator7,_isArray7,_i7,_ref58,hash,path;return regeneratorRuntime.wrap(function(_context51){for(;;)switch(_context51.prev=_context51.next){case 0:if(assert(mtx.mutable),mtx.hasCoins()){_context51.next=3;break}throw new Error("Not all coins available.");case 3:hashes=mtx.getInputHashes("hex"),paths=[],_iterator7=hashes,_isArray7=Array.isArray(_iterator7),_i7=0,_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();case 6:if(!_isArray7){_context51.next=12;break}if(!(_i7>=_iterator7.length)){_context51.next=9;break}return _context51.abrupt("break",23);case 9:_ref58=_iterator7[_i7++],_context51.next=16;break;case 12:if(!(_i7=_iterator7.next()).done){_context51.next=15;break}return _context51.abrupt("break",23);case 15:_ref58=_i7.value;case 16:return hash=_ref58,_context51.next=19,this.getPath(hash);case 19:(path=_context51.sent)&&paths.push(path);case 21:_context51.next=6;break;case 23:return _context51.abrupt("return",paths);case 24:case"end":return _context51.stop()}},_callee51,this)}));return function(_x78){return _ref57.apply(this,arguments)}}(),Wallet.prototype.getOutputPaths=function(){var _ref59=_asyncToGenerator(regeneratorRuntime.mark(function _callee52(tx){var paths,hashes,_iterator8,_isArray8,_i8,_ref60,hash,path;return regeneratorRuntime.wrap(function(_context52){for(;;)switch(_context52.prev=_context52.next){case 0:paths=[],hashes=tx.getOutputHashes("hex"),_iterator8=hashes,_isArray8=Array.isArray(_iterator8),_i8=0,_iterator8=_isArray8?_iterator8:_iterator8[Symbol.iterator]();case 3:if(!_isArray8){_context52.next=9;break}if(!(_i8>=_iterator8.length)){_context52.next=6;break}return _context52.abrupt("break",20);case 6:_ref60=_iterator8[_i8++],_context52.next=13;break;case 9:if(!(_i8=_iterator8.next()).done){_context52.next=12;break}return _context52.abrupt("break",20);case 12:_ref60=_i8.value;case 13:return hash=_ref60,_context52.next=16,this.getPath(hash);case 16:(path=_context52.sent)&&paths.push(path);case 18:_context52.next=3;break;case 20:return _context52.abrupt("return",paths);case 21:case"end":return _context52.stop()}},_callee52,this)}));return function(_x79){return _ref59.apply(this,arguments)}}(),Wallet.prototype.setLookahead=function(){var _ref61=_asyncToGenerator(regeneratorRuntime.mark(function _callee53(acct,lookahead){var unlock;return regeneratorRuntime.wrap(function(_context53){for(;;)switch(_context53.prev=_context53.next){case 0:return _context53.next=2,this.writeLock.lock();case 2:return unlock=_context53.sent,_context53.prev=3,_context53.abrupt("return",this._setLookahead(acct,lookahead));case 5:return _context53.prev=5,unlock(),_context53.finish(5);case 8:case"end":return _context53.stop()}},_callee53,this,[[3,,5,8]])}));return function(_x80,_x81){return _ref61.apply(this,arguments)}}(),Wallet.prototype._setLookahead=function(){var _ref62=_asyncToGenerator(regeneratorRuntime.mark(function _callee54(acct,lookahead){var account,b;return regeneratorRuntime.wrap(function(_context54){for(;;)switch(_context54.prev=_context54.next){case 0:return _context54.next=2,this.getAccount(acct);case 2:if(account=_context54.sent){_context54.next=5;break}throw new Error("Account not found.");case 5:return b=this.db.batch(),_context54.next=8,account.setLookahead(b,lookahead);case 8:return _context54.next=10,b.write();case 10:case"end":return _context54.stop()}},_callee54,this)}));return function(_x82,_x83){return _ref62.apply(this,arguments)}}(),Wallet.prototype.syncOutputDepth=function(){var _ref63=_asyncToGenerator(regeneratorRuntime.mark(function _callee55(tx){var map,_iterator9,_isArray9,_i9,_ref64,hash,path,derived,b,_iterator10,_isArray10,_i10,_ref66,_ref65,acct,paths,receive,change,nested,_iterator11,_isArray11,_i11,_ref67,_path,account,ring;return regeneratorRuntime.wrap(function(_context55){for(;;)switch(_context55.prev=_context55.next){case 0:map=new Map,_iterator9=tx.getOutputHashes("hex"),_isArray9=Array.isArray(_iterator9),_i9=0,_iterator9=_isArray9?_iterator9:_iterator9[Symbol.iterator]();case 2:if(!_isArray9){_context55.next=8;break}if(!(_i9>=_iterator9.length)){_context55.next=5;break}return _context55.abrupt("break",24);case 5:_ref64=_iterator9[_i9++],_context55.next=12;break;case 8:if(!(_i9=_iterator9.next()).done){_context55.next=11;break}return _context55.abrupt("break",24);case 11:_ref64=_i9.value;case 12:return hash=_ref64,_context55.next=15,this.readPath(hash);case 15:if(path=_context55.sent){_context55.next=18;break}return _context55.abrupt("continue",22);case 18:if(-1!==path.index){_context55.next=20;break}return _context55.abrupt("continue",22);case 20:map.has(path.account)||map.set(path.account,[]),map.get(path.account).push(path);case 22:_context55.next=2;break;case 24:derived=[],b=this.db.batch(),_iterator10=map,_isArray10=Array.isArray(_iterator10),_i10=0,_iterator10=_isArray10?_iterator10:_iterator10[Symbol.iterator]();case 27:if(!_isArray10){_context55.next=33;break}if(!(_i10>=_iterator10.length)){_context55.next=30;break}return _context55.abrupt("break",79);case 30:_ref66=_iterator10[_i10++],_context55.next=37;break;case 33:if(!(_i10=_iterator10.next()).done){_context55.next=36;break}return _context55.abrupt("break",79);case 36:_ref66=_i10.value;case 37:acct=(_ref65=_ref66)[0],paths=_ref65[1],receive=-1,change=-1,nested=-1,_iterator11=paths,_isArray11=Array.isArray(_iterator11),_i11=0,_iterator11=_isArray11?_iterator11:_iterator11[Symbol.iterator]();case 44:if(!_isArray11){_context55.next=50;break}if(!(_i11>=_iterator11.length)){_context55.next=47;break}return _context55.abrupt("break",66);case 47:_ref67=_iterator11[_i11++],_context55.next=54;break;case 50:if(!(_i11=_iterator11.next()).done){_context55.next=53;break}return _context55.abrupt("break",66);case 53:_ref67=_i11.value;case 54:_path=_ref67,_context55.t0=_path.branch,_context55.next=0===_context55.t0?58:1===_context55.t0?60:2===_context55.t0?62:64;break;case 58:return _path.index>receive&&(receive=_path.index),_context55.abrupt("break",64);case 60:return _path.index>change&&(change=_path.index),_context55.abrupt("break",64);case 62:return _path.index>nested&&(nested=_path.index),_context55.abrupt("break",64);case 64:_context55.next=44;break;case 66:return receive+=2,change+=2,nested+=2,_context55.next=71,this.getAccount(acct);case 71:return account=_context55.sent,assert(account),_context55.next=75,account.syncDepth(b,receive,change,nested);case 75:(ring=_context55.sent)&&derived.push(ring);case 77:_context55.next=27;break;case 79:return _context55.next=81,b.write();case 81:return _context55.abrupt("return",derived);case 82:case"end":return _context55.stop()}},_callee55,this)}));return function(_x84){return _ref63.apply(this,arguments)}}(),Wallet.prototype.template=function(){var _ref68=_asyncToGenerator(regeneratorRuntime.mark(function _callee56(mtx){var rings;return regeneratorRuntime.wrap(function(_context56){for(;;)switch(_context56.prev=_context56.next){case 0:return _context56.next=2,this.deriveInputs(mtx);case 2:return rings=_context56.sent,_context56.abrupt("return",mtx.template(rings));case 4:case"end":return _context56.stop()}},_callee56,this)}));return function(_x85){return _ref68.apply(this,arguments)}}(),Wallet.prototype.sign=function(){var _ref69=_asyncToGenerator(regeneratorRuntime.mark(function _callee57(mtx,passphrase){var rings;return regeneratorRuntime.wrap(function(_context57){for(;;)switch(_context57.prev=_context57.next){case 0:if(!this.watchOnly){_context57.next=2;break}throw new Error("Cannot sign from a watch-only wallet.");case 2:return _context57.next=4,this.unlock(passphrase);case 4:return _context57.next=6,this.deriveInputs(mtx);case 6:return rings=_context57.sent,_context57.abrupt("return",mtx.signAsync(rings,Script.hashType.ALL,this.wdb.workers));case 8:case"end":return _context57.stop()}},_callee57,this)}));return function(_x86,_x87){return _ref69.apply(this,arguments)}}(),Wallet.prototype.getCoinView=function(tx){return this.txdb.getCoinView(tx)},Wallet.prototype.getSpentView=function(tx){return this.txdb.getSpentView(tx)},Wallet.prototype.toDetails=function(wtx){return this.txdb.toDetails(wtx)},Wallet.prototype.getDetails=function(hash){return this.txdb.getDetails(hash)},Wallet.prototype.getCoin=function(hash,index){return this.txdb.getCoin(hash,index)},Wallet.prototype.getTX=function(hash){return this.txdb.getTX(hash)},Wallet.prototype.getBlocks=function(){return this.txdb.getBlocks()},Wallet.prototype.getBlock=function(height){return this.txdb.getBlock(height)},Wallet.prototype.add=function(){var _ref70=_asyncToGenerator(regeneratorRuntime.mark(function _callee58(tx,block){var unlock;return regeneratorRuntime.wrap(function(_context58){for(;;)switch(_context58.prev=_context58.next){case 0:return _context58.next=2,this.writeLock.lock();case 2:return unlock=_context58.sent,_context58.prev=3,_context58.next=6,this._add(tx,block);case 6:return _context58.abrupt("return",_context58.sent);case 7:return _context58.prev=7,unlock(),_context58.finish(7);case 10:case"end":return _context58.stop()}},_callee58,this,[[3,,7,10]])}));return function(_x88,_x89){return _ref70.apply(this,arguments)}}(),Wallet.prototype._add=function(){var _ref71=_asyncToGenerator(regeneratorRuntime.mark(function _callee59(tx,block){var details,derived;return regeneratorRuntime.wrap(function(_context59){for(;;)switch(_context59.prev=_context59.next){case 0:return _context59.next=2,this.txdb.add(tx,block);case 2:if(!(details=_context59.sent)){_context59.next=8;break}return _context59.next=6,this.syncOutputDepth(tx);case 6:(derived=_context59.sent).length>0&&(this.wdb.emit("address",this,derived),this.emit("address",derived));case 8:return _context59.abrupt("return",details);case 9:case"end":return _context59.stop()}},_callee59,this)}));return function(_x90,_x91){return _ref71.apply(this,arguments)}}(),Wallet.prototype.revert=function(){var _ref72=_asyncToGenerator(regeneratorRuntime.mark(function _callee60(height){var unlock;return regeneratorRuntime.wrap(function(_context60){for(;;)switch(_context60.prev=_context60.next){case 0:return _context60.next=2,this.writeLock.lock();case 2:return unlock=_context60.sent,_context60.prev=3,_context60.next=6,this.txdb.revert(height);case 6:return _context60.abrupt("return",_context60.sent);case 7:return _context60.prev=7,unlock(),_context60.finish(7);case 10:case"end":return _context60.stop()}},_callee60,this,[[3,,7,10]])}));return function(_x92){return _ref72.apply(this,arguments)}}(),Wallet.prototype.remove=function(){var _ref73=_asyncToGenerator(regeneratorRuntime.mark(function _callee61(hash){var unlock;return regeneratorRuntime.wrap(function(_context61){for(;;)switch(_context61.prev=_context61.next){case 0:return _context61.next=2,this.writeLock.lock();case 2:return unlock=_context61.sent,_context61.prev=3,_context61.next=6,this.txdb.remove(hash);case 6:return _context61.abrupt("return",_context61.sent);case 7:return _context61.prev=7,unlock(),_context61.finish(7);case 10:case"end":return _context61.stop()}},_callee61,this,[[3,,7,10]])}));return function(_x93){return _ref73.apply(this,arguments)}}(),Wallet.prototype.zap=function(){var _ref74=_asyncToGenerator(regeneratorRuntime.mark(function _callee62(acct,age){var unlock;return regeneratorRuntime.wrap(function(_context62){for(;;)switch(_context62.prev=_context62.next){case 0:return _context62.next=2,this.writeLock.lock();case 2:return unlock=_context62.sent,_context62.prev=3,_context62.next=6,this._zap(acct,age);case 6:return _context62.abrupt("return",_context62.sent);case 7:return _context62.prev=7,unlock(),_context62.finish(7);case 10:case"end":return _context62.stop()}},_callee62,this,[[3,,7,10]])}));return function(_x94,_x95){return _ref74.apply(this,arguments)}}(),Wallet.prototype._zap=function(){var _ref75=_asyncToGenerator(regeneratorRuntime.mark(function _callee63(acct,age){var account;return regeneratorRuntime.wrap(function(_context63){for(;;)switch(_context63.prev=_context63.next){case 0:return _context63.next=2,this.ensureIndex(acct);case 2:return account=_context63.sent,_context63.abrupt("return",this.txdb.zap(account,age));case 4:case"end":return _context63.stop()}},_callee63,this)}));return function(_x96,_x97){return _ref75.apply(this,arguments)}}(),Wallet.prototype.abandon=function(){var _ref76=_asyncToGenerator(regeneratorRuntime.mark(function _callee64(hash){var unlock;return regeneratorRuntime.wrap(function(_context64){for(;;)switch(_context64.prev=_context64.next){case 0:return _context64.next=2,this.writeLock.lock();case 2:return unlock=_context64.sent,_context64.prev=3,_context64.next=6,this._abandon(hash);case 6:return _context64.abrupt("return",_context64.sent);case 7:return _context64.prev=7,unlock(),_context64.finish(7);case 10:case"end":return _context64.stop()}},_callee64,this,[[3,,7,10]])}));return function(_x98){return _ref76.apply(this,arguments)}}(),Wallet.prototype._abandon=function(hash){return this.txdb.abandon(hash)},Wallet.prototype.lockCoin=function(coin){return this.txdb.lockCoin(coin)},Wallet.prototype.unlockCoin=function(coin){return this.txdb.unlockCoin(coin)},Wallet.prototype.isLocked=function(coin){return this.txdb.isLocked(coin)},Wallet.prototype.getLocked=function(){return this.txdb.getLocked()},Wallet.prototype.getHistory=function(){var _ref77=_asyncToGenerator(regeneratorRuntime.mark(function _callee65(acct){var account;return regeneratorRuntime.wrap(function(_context65){for(;;)switch(_context65.prev=_context65.next){case 0:return _context65.next=2,this.ensureIndex(acct);case 2:return account=_context65.sent,_context65.abrupt("return",this.txdb.getHistory(account));case 4:case"end":return _context65.stop()}},_callee65,this)}));return function(_x99){return _ref77.apply(this,arguments)}}(),Wallet.prototype.getCoins=function(){var _ref78=_asyncToGenerator(regeneratorRuntime.mark(function _callee66(acct){var account;return regeneratorRuntime.wrap(function(_context66){for(;;)switch(_context66.prev=_context66.next){case 0:return _context66.next=2,this.ensureIndex(acct);case 2:return account=_context66.sent,_context66.abrupt("return",this.txdb.getCoins(account));case 4:case"end":return _context66.stop()}},_callee66,this)}));return function(_x100){return _ref78.apply(this,arguments)}}(),Wallet.prototype.getCredits=function(){var _ref79=_asyncToGenerator(regeneratorRuntime.mark(function _callee67(acct){var account;return regeneratorRuntime.wrap(function(_context67){for(;;)switch(_context67.prev=_context67.next){case 0:return _context67.next=2,this.ensureIndex(acct);case 2:return account=_context67.sent,_context67.abrupt("return",this.txdb.getCredits(account));case 4:case"end":return _context67.stop()}},_callee67,this)}));return function(_x101){return _ref79.apply(this,arguments)}}(),Wallet.prototype.getSmartCoins=function(){var _ref80=_asyncToGenerator(regeneratorRuntime.mark(function _callee68(acct){var credits,coins,_iterator12,_isArray12,_i12,_ref81,credit,coin;return regeneratorRuntime.wrap(function(_context68){for(;;)switch(_context68.prev=_context68.next){case 0:return _context68.next=2,this.getCredits(acct);case 2:credits=_context68.sent,coins=[],_iterator12=credits,_isArray12=Array.isArray(_iterator12),_i12=0,_iterator12=_isArray12?_iterator12:_iterator12[Symbol.iterator]();case 5:if(!_isArray12){_context68.next=11;break}if(!(_i12>=_iterator12.length)){_context68.next=8;break}return _context68.abrupt("break",29);case 8:_ref81=_iterator12[_i12++],_context68.next=15;break;case 11:if(!(_i12=_iterator12.next()).done){_context68.next=14;break}return _context68.abrupt("break",29);case 14:_ref81=_i12.value;case 15:if(coin=(credit=_ref81).coin,!credit.spent){_context68.next=19;break}return _context68.abrupt("continue",27);case 19:if(!this.txdb.isLocked(coin)){_context68.next=21;break}return _context68.abrupt("continue",27);case 21:if(-1===coin.height){_context68.next=24;break}return coins.push(coin),_context68.abrupt("continue",27);case 24:if(credit.own){_context68.next=26;break}return _context68.abrupt("continue",27);case 26:coins.push(coin);case 27:_context68.next=5;break;case 29:return _context68.abrupt("return",coins);case 30:case"end":return _context68.stop()}},_callee68,this)}));return function(_x102){return _ref80.apply(this,arguments)}}(),Wallet.prototype.getPending=function(){var _ref82=_asyncToGenerator(regeneratorRuntime.mark(function _callee69(acct){var account;return regeneratorRuntime.wrap(function(_context69){for(;;)switch(_context69.prev=_context69.next){case 0:return _context69.next=2,this.ensureIndex(acct);case 2:return account=_context69.sent,_context69.abrupt("return",this.txdb.getPending(account));case 4:case"end":return _context69.stop()}},_callee69,this)}));return function(_x103){return _ref82.apply(this,arguments)}}(),Wallet.prototype.getBalance=function(){var _ref83=_asyncToGenerator(regeneratorRuntime.mark(function _callee70(acct){var account;return regeneratorRuntime.wrap(function(_context70){for(;;)switch(_context70.prev=_context70.next){case 0:return _context70.next=2,this.ensureIndex(acct);case 2:return account=_context70.sent,_context70.abrupt("return",this.txdb.getBalance(account));case 4:case"end":return _context70.stop()}},_callee70,this)}));return function(_x104){return _ref83.apply(this,arguments)}}(),Wallet.prototype.getRange=function(){var _ref84=_asyncToGenerator(regeneratorRuntime.mark(function _callee71(acct,options){var account;return regeneratorRuntime.wrap(function(_context71){for(;;)switch(_context71.prev=_context71.next){case 0:return _context71.next=2,this.ensureIndex(acct);case 2:return account=_context71.sent,_context71.abrupt("return",this.txdb.getRange(account,options));case 4:case"end":return _context71.stop()}},_callee71,this)}));return function(_x105,_x106){return _ref84.apply(this,arguments)}}(),Wallet.prototype.getLast=function(){var _ref85=_asyncToGenerator(regeneratorRuntime.mark(function _callee72(acct,limit){var account;return regeneratorRuntime.wrap(function(_context72){for(;;)switch(_context72.prev=_context72.next){case 0:return _context72.next=2,this.ensureIndex(acct);case 2:return account=_context72.sent,_context72.abrupt("return",this.txdb.getLast(account,limit));case 4:case"end":return _context72.stop()}},_callee72,this)}));return function(_x107,_x108){return _ref85.apply(this,arguments)}}(),Wallet.prototype.accountKey=function(){var _ref86=_asyncToGenerator(regeneratorRuntime.mark(function _callee73(){var account,acct=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return regeneratorRuntime.wrap(function(_context73){for(;;)switch(_context73.prev=_context73.next){case 0:return _context73.next=2,this.getAccount(acct);case 2:if(account=_context73.sent){_context73.next=5;break}throw new Error("Account not found.");case 5:return _context73.abrupt("return",account.accountKey);case 6:case"end":return _context73.stop()}},_callee73,this)}));return function(){return _ref86.apply(this,arguments)}}(),Wallet.prototype.receiveDepth=function(){var _ref87=_asyncToGenerator(regeneratorRuntime.mark(function _callee74(){var account,acct=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return regeneratorRuntime.wrap(function(_context74){for(;;)switch(_context74.prev=_context74.next){case 0:return _context74.next=2,this.getAccount(acct);case 2:if(account=_context74.sent){_context74.next=5;break}throw new Error("Account not found.");case 5:return _context74.abrupt("return",account.receiveDepth);case 6:case"end":return _context74.stop()}},_callee74,this)}));return function(){return _ref87.apply(this,arguments)}}(),Wallet.prototype.changeDepth=function(){var _ref88=_asyncToGenerator(regeneratorRuntime.mark(function _callee75(){var account,acct=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return regeneratorRuntime.wrap(function(_context75){for(;;)switch(_context75.prev=_context75.next){case 0:return _context75.next=2,this.getAccount(acct);case 2:if(account=_context75.sent){_context75.next=5;break}throw new Error("Account not found.");case 5:return _context75.abrupt("return",account.changeDepth);case 6:case"end":return _context75.stop()}},_callee75,this)}));return function(){return _ref88.apply(this,arguments)}}(),Wallet.prototype.nestedDepth=function(){var _ref89=_asyncToGenerator(regeneratorRuntime.mark(function _callee76(){var account,acct=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return regeneratorRuntime.wrap(function(_context76){for(;;)switch(_context76.prev=_context76.next){case 0:return _context76.next=2,this.getAccount(acct);case 2:if(account=_context76.sent){_context76.next=5;break}throw new Error("Account not found.");case 5:return _context76.abrupt("return",account.nestedDepth);case 6:case"end":return _context76.stop()}},_callee76,this)}));return function(){return _ref89.apply(this,arguments)}}(),Wallet.prototype.receiveAddress=function(){var _ref90=_asyncToGenerator(regeneratorRuntime.mark(function _callee77(){var account,acct=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return regeneratorRuntime.wrap(function(_context77){for(;;)switch(_context77.prev=_context77.next){case 0:return _context77.next=2,this.getAccount(acct);case 2:if(account=_context77.sent){_context77.next=5;break}throw new Error("Account not found.");case 5:return _context77.abrupt("return",account.receiveAddress());case 6:case"end":return _context77.stop()}},_callee77,this)}));return function(){return _ref90.apply(this,arguments)}}(),Wallet.prototype.changeAddress=function(){var _ref91=_asyncToGenerator(regeneratorRuntime.mark(function _callee78(){var account,acct=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return regeneratorRuntime.wrap(function(_context78){for(;;)switch(_context78.prev=_context78.next){case 0:return _context78.next=2,this.getAccount(acct);case 2:if(account=_context78.sent){_context78.next=5;break}throw new Error("Account not found.");case 5:return _context78.abrupt("return",account.changeAddress());case 6:case"end":return _context78.stop()}},_callee78,this)}));return function(){return _ref91.apply(this,arguments)}}(),Wallet.prototype.nestedAddress=function(){var _ref92=_asyncToGenerator(regeneratorRuntime.mark(function _callee79(){var account,acct=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return regeneratorRuntime.wrap(function(_context79){for(;;)switch(_context79.prev=_context79.next){case 0:return _context79.next=2,this.getAccount(acct);case 2:if(account=_context79.sent){_context79.next=5;break}throw new Error("Account not found.");case 5:return _context79.abrupt("return",account.nestedAddress());case 6:case"end":return _context79.stop()}},_callee79,this)}));return function(){return _ref92.apply(this,arguments)}}(),Wallet.prototype.receiveKey=function(){var _ref93=_asyncToGenerator(regeneratorRuntime.mark(function _callee80(){var account,acct=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return regeneratorRuntime.wrap(function(_context80){for(;;)switch(_context80.prev=_context80.next){case 0:return _context80.next=2,this.getAccount(acct);case 2:if(account=_context80.sent){_context80.next=5;break}throw new Error("Account not found.");case 5:return _context80.abrupt("return",account.receiveKey());case 6:case"end":return _context80.stop()}},_callee80,this)}));return function(){return _ref93.apply(this,arguments)}}(),Wallet.prototype.changeKey=function(){var _ref94=_asyncToGenerator(regeneratorRuntime.mark(function _callee81(){var account,acct=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return regeneratorRuntime.wrap(function(_context81){for(;;)switch(_context81.prev=_context81.next){case 0:return _context81.next=2,this.getAccount(acct);case 2:if(account=_context81.sent){_context81.next=5;break}throw new Error("Account not found.");case 5:return _context81.abrupt("return",account.changeKey());case 6:case"end":return _context81.stop()}},_callee81,this)}));return function(){return _ref94.apply(this,arguments)}}(),Wallet.prototype.nestedKey=function(){var _ref95=_asyncToGenerator(regeneratorRuntime.mark(function _callee82(){var account,acct=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return regeneratorRuntime.wrap(function(_context82){for(;;)switch(_context82.prev=_context82.next){case 0:return _context82.next=2,this.getAccount(acct);case 2:if(account=_context82.sent){_context82.next=5;break}throw new Error("Account not found.");case 5:return _context82.abrupt("return",account.nestedKey());case 6:case"end":return _context82.stop()}},_callee82,this)}));return function(){return _ref95.apply(this,arguments)}}(),Wallet.prototype.inspect=function(){return{wid:this.wid,id:this.id,network:this.network.type,accountDepth:this.accountDepth,token:this.token.toString("hex"),tokenDepth:this.tokenDepth,master:this.master}},Wallet.prototype.toJSON=function(unsafe,balance){return{network:this.network.type,wid:this.wid,id:this.id,watchOnly:this.watchOnly,accountDepth:this.accountDepth,token:this.token.toString("hex"),tokenDepth:this.tokenDepth,master:this.master.toJSON(this.network,unsafe),balance:balance?balance.toJSON(!0):null}},Wallet.prototype.getSize=function(){var size=0;return size+=41,size+=this.master.getSize()},Wallet.prototype.toRaw=function(){var size=this.getSize(),bw=bio.write(size),flags=0;return this.watchOnly&&(flags|=1),bw.writeU8(flags),bw.writeU32(this.accountDepth),bw.writeBytes(this.token),bw.writeU32(this.tokenDepth),this.master.toWriter(bw),bw.render()},Wallet.prototype.fromRaw=function(data){var br=bio.read(data),flags=br.readU8();return this.watchOnly=0!=(1&flags),this.accountDepth=br.readU32(),this.token=br.readBytes(32),this.tokenDepth=br.readU32(),this.master.fromReader(br),this},Wallet.fromRaw=function(wdb,data){return new this(wdb).fromRaw(data)},Wallet.isWallet=function(obj){return obj instanceof Wallet},Wallet}(EventEmitter);module.exports=Wallet}).call(this,{isBuffer:require("../../node_modules/is-buffer/index.js")})},{"../../node_modules/is-buffer/index.js":353,"../hd/hd":18,"../primitives/address":69,"../primitives/mtx":79,"../primitives/output":81,"../protocol/consensus":84,"../protocol/policy":89,"../script/script":95,"./account":107,"./common":109,"./masterkey":113,"./path":117,"./txdb":121,"./walletkey":124,assert:146,"bcrypto/lib/cleanse":158,"bcrypto/lib/hash160":159,"bcrypto/lib/hash256":160,bmutex:214,bstring:265,bufio:270,events:334}],123:[function(require,module,exports){(function(Buffer){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),path=require("path"),EventEmitter=require("events"),bio=require("bufio"),BloomFilter=require("bfilter").BloomFilter,_require2=require("bmutex"),Lock=_require2.Lock,MapLock=_require2.MapLock,bdb=require("bdb"),Logger=require("blgr"),ccmp=require("bcrypto/lib/ccmp"),aes=require("bcrypto/lib/aes"),util=require("../utils/util"),Network=require("../protocol/network"),Path=require("./path"),common=require("./common"),Wallet=require("./wallet"),Account=require("./account"),Outpoint=require("../primitives/outpoint"),layouts=require("./layout"),records=require("./records"),NullClient=require("./nullclient"),layout=layouts.wdb,tlayout=layouts.txdb,ChainState=records.ChainState,BlockMeta=records.BlockMeta,TXRecord=records.TXRecord,MapRecord=records.MapRecord,WalletDB=function(_EventEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(WalletDB,_EventEmitter);function WalletDB(options){_classCallCheck(this,WalletDB);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return _this.options=new WalletOptions(options),_this.network=_this.options.network,_this.logger=_this.options.logger.context("wallet"),_this.workers=_this.options.workers,_this.client=_this.options.client||new NullClient(_this),_this.feeRate=_this.options.feeRate,_this.db=bdb.create(_this.options),_this.primary=null,_this.state=new ChainState,_this.height=0,_this.wallets=new Map,_this.depth=0,_this.rescanning=!1,_this.filterSent=!1,_this.readLock=new MapLock,_this.writeLock=new Lock,_this.txLock=new Lock,_this.filter=new BloomFilter,_this.init(),_this}return WalletDB.prototype.init=function(){var items=3e6,flag=-1;this.options.spv&&(items=2e4,flag=BloomFilter.flags.ALL),this.filter=BloomFilter.fromRate(items,.001,flag),this._bind()},WalletDB.prototype._bind=function(){var _this2=this;this.client.on("error",function(err){_this2.emit("error",err)}),this.client.on("connect",_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,_context.next=3,_this2.syncNode();case 3:_context.next=8;break;case 5:_context.prev=5,_context.t0=_context.catch(0),_this2.emit("error",_context.t0);case 8:case"end":return _context.stop()}},_callee,_this2,[[0,5]])}))),this.client.on("disconnect",_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:_this2.filterSent=!1;case 1:case"end":return _context2.stop()}},_callee2,_this2)}))),this.client.bind("block connect",function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(entry,txs){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.prev=0,_context3.next=3,_this2.addBlock(entry,txs);case 3:_context3.next=8;break;case 5:_context3.prev=5,_context3.t0=_context3.catch(0),_this2.emit("error",_context3.t0);case 8:case"end":return _context3.stop()}},_callee3,_this2,[[0,5]])}));return function(_x,_x2){return _ref3.apply(this,arguments)}}()),this.client.bind("block disconnect",function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(entry){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.prev=0,_context4.next=3,_this2.removeBlock(entry);case 3:_context4.next=8;break;case 5:_context4.prev=5,_context4.t0=_context4.catch(0),_this2.emit("error",_context4.t0);case 8:case"end":return _context4.stop()}},_callee4,_this2,[[0,5]])}));return function(_x3){return _ref4.apply(this,arguments)}}()),this.client.hook("block rescan",function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(entry,txs){return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.prev=0,_context5.next=3,_this2.rescanBlock(entry,txs);case 3:_context5.next=8;break;case 5:_context5.prev=5,_context5.t0=_context5.catch(0),_this2.emit("error",_context5.t0);case 8:case"end":return _context5.stop()}},_callee5,_this2,[[0,5]])}));return function(_x4,_x5){return _ref5.apply(this,arguments)}}()),this.client.bind("tx",function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(tx){return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.prev=0,_context6.next=3,_this2.addTX(tx);case 3:_context6.next=8;break;case 5:_context6.prev=5,_context6.t0=_context6.catch(0),_this2.emit("error",_context6.t0);case 8:case"end":return _context6.stop()}},_callee6,_this2,[[0,5]])}));return function(_x6){return _ref6.apply(this,arguments)}}()),this.client.bind("chain reset",function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(tip){return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.prev=0,_context7.next=3,_this2.resetChain(tip);case 3:_context7.next=8;break;case 5:_context7.prev=5,_context7.t0=_context7.catch(0),_this2.emit("error",_context7.t0);case 8:case"end":return _context7.stop()}},_callee7,_this2,[[0,5]])}));return function(_x7){return _ref7.apply(this,arguments)}}())},WalletDB.prototype.open=function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(){var wallet,addr;return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return _context8.next=2,this.db.open();case 2:return _context8.next=4,this.db.verify(layout.V.build(),"wallet",7);case 4:return _context8.next=6,this.verifyNetwork();case 6:return _context8.next=8,this.getDepth();case 8:if(this.depth=_context8.sent,!this.options.wipeNoReally){_context8.next=12;break}return _context8.next=12,this.wipe();case 12:return _context8.next=14,this.watch();case 14:return _context8.next=16,this.connect();case 16:return this.logger.info("WalletDB loaded (depth=%d, height=%d, start=%d).",this.depth,this.state.height,this.state.startHeight),_context8.next=19,this.ensure({id:"primary"});case 19:return wallet=_context8.sent,_context8.next=22,wallet.receiveAddress();case 22:addr=_context8.sent,this.logger.info("Loaded primary wallet (id=%s, wid=%d, address=%s)",wallet.id,wallet.wid,addr.toString(this.network)),this.primary=wallet;case 25:case"end":return _context8.stop()}},_callee8,this)}));return function(){return _ref8.apply(this,arguments)}}(),WalletDB.prototype.verifyNetwork=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(){var raw,b;return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return _context9.next=2,this.db.get(layout.O.build());case 2:if(raw=_context9.sent){_context9.next=7;break}return(b=this.db.batch()).put(layout.O.build(),fromU32(this.network.magic)),_context9.abrupt("return",b.write());case 7:if(raw.readUInt32LE(0,!0)===this.network.magic){_context9.next=10;break}throw new Error("Network mismatch for WalletDB.");case 10:return _context9.abrupt("return",void 0);case 11:case"end":return _context9.stop()}},_callee9,this)}));return function(){return _ref9.apply(this,arguments)}}(),WalletDB.prototype.close=function(){var _ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(){var _iterator,_isArray,_i,_ref11,wallet;return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return _context10.next=2,this.disconnect();case 2:_iterator=this.wallets.values(),_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();case 3:if(!_isArray){_context10.next=9;break}if(!(_i>=_iterator.length)){_context10.next=6;break}return _context10.abrupt("break",19);case 6:_ref11=_iterator[_i++],_context10.next=13;break;case 9:if(!(_i=_iterator.next()).done){_context10.next=12;break}return _context10.abrupt("break",19);case 12:_ref11=_i.value;case 13:return wallet=_ref11,_context10.next=16,wallet.destroy();case 16:this.unregister(wallet);case 17:_context10.next=3;break;case 19:return _context10.abrupt("return",this.db.close());case 20:case"end":return _context10.stop()}},_callee10,this)}));return function(){return _ref10.apply(this,arguments)}}(),WalletDB.prototype.watch=function(){var _ref12=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(){var piter,hashes,oiter,outpoints,_this3=this;return regeneratorRuntime.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:return piter=this.db.iterator({gte:layout.p.min(),lte:layout.p.max()}),hashes=0,_context11.next=4,piter.each(function(key){var data=layout.p.parse(key);_this3.filter.add(data,"hex"),hashes+=1});case 4:return this.logger.info("Added %d hashes to WalletDB filter.",hashes),oiter=this.db.iterator({gte:layout.o.min(),lte:layout.o.max()}),outpoints=0,_context11.next=9,oiter.each(function(key){var _layout$o$parse=layout.o.parse(key),hash=_layout$o$parse[0],index=_layout$o$parse[1],data=new Outpoint(hash,index).toRaw();_this3.filter.add(data),outpoints+=1});case 9:this.logger.info("Added %d outpoints to WalletDB filter.",outpoints);case 10:case"end":return _context11.stop()}},_callee11,this)}));return function(){return _ref12.apply(this,arguments)}}(),WalletDB.prototype.connect=function(){var _ref13=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(){return regeneratorRuntime.wrap(function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:return _context12.abrupt("return",this.client.open());case 1:case"end":return _context12.stop()}},_callee12,this)}));return function(){return _ref13.apply(this,arguments)}}(),WalletDB.prototype.disconnect=function(){var _ref14=_asyncToGenerator(regeneratorRuntime.mark(function _callee13(){return regeneratorRuntime.wrap(function(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:return _context13.abrupt("return",this.client.close());case 1:case"end":return _context13.stop()}},_callee13,this)}));return function(){return _ref14.apply(this,arguments)}}(),WalletDB.prototype.syncNode=function(){var _ref15=_asyncToGenerator(regeneratorRuntime.mark(function _callee14(){var unlock;return regeneratorRuntime.wrap(function(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:return _context14.next=2,this.txLock.lock();case 2:return unlock=_context14.sent,_context14.prev=3,this.logger.info("Resyncing from server..."),_context14.next=7,this.syncState();case 7:return _context14.next=9,this.syncFilter();case 9:return _context14.next=11,this.syncChain();case 11:return _context14.next=13,this.resend();case 13:return _context14.prev=13,unlock(),_context14.finish(13);case 16:case"end":return _context14.stop()}},_callee14,this,[[3,,13,16]])}));return function(){return _ref15.apply(this,arguments)}}(),WalletDB.prototype.syncState=function(){var _ref16=_asyncToGenerator(regeneratorRuntime.mark(function _callee15(){var cache,b,hashes,tip,height,hash,meta,state;return regeneratorRuntime.wrap(function(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:return _context15.next=2,this.getState();case 2:if(!(cache=_context15.sent)){_context15.next=11;break}return _context15.next=6,this.getBlock(0);case 6:if(_context15.sent){_context15.next=8;break}return _context15.abrupt("return",this.migrateState(cache));case 8:return this.state=cache,this.height=cache.height,_context15.abrupt("return",void 0);case 11:return this.logger.info("Initializing database state from server."),b=this.db.batch(),_context15.next=15,this.client.getHashes();case 15:for(hashes=_context15.sent,tip=null,height=0;height<hashes.length;height++)hash=hashes[height],meta=new BlockMeta(hash,height),b.put(layout.h.build(height),meta.toHash()),tip=meta;return assert(tip),(state=this.state.clone()).startHeight=tip.height,state.startHash=tip.hash,state.height=tip.height,state.marked=!1,b.put(layout.R.build(),state.toRaw()),_context15.next=27,b.write();case 27:return this.state=state,this.height=state.height,_context15.abrupt("return",void 0);case 30:case"end":return _context15.stop()}},_callee15,this)}));return function(){return _ref16.apply(this,arguments)}}(),WalletDB.prototype.migrateState=function(){var _ref17=_asyncToGenerator(regeneratorRuntime.mark(function _callee16(state){var b,hashes,height,hash,meta;return regeneratorRuntime.wrap(function(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:return b=this.db.batch(),this.logger.info("Migrating to new sync state."),_context16.next=4,this.client.getHashes(0,state.height);case 4:for(hashes=_context16.sent,height=0;height<hashes.length;height++)hash=hashes[height],meta=new BlockMeta(hash,height),b.put(layout.h.build(height),meta.toHash());return _context16.next=8,b.write();case 8:this.state=state,this.height=state.height;case 10:case"end":return _context16.stop()}},_callee16,this)}));return function(_x8){return _ref17.apply(this,arguments)}}(),WalletDB.prototype.syncChain=function(){var _ref18=_asyncToGenerator(regeneratorRuntime.mark(function _callee17(){var height,tip;return regeneratorRuntime.wrap(function(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:height=this.state.height,this.logger.info("Syncing state from height %d.",height);case 2:return _context17.next=4,this.getBlock(height);case 4:return tip=_context17.sent,assert(tip),_context17.next=8,this.client.getEntry(tip.hash);case 8:if(!_context17.sent){_context17.next=10;break}return _context17.abrupt("break",14);case 10:assert(0!==height),height-=1;case 12:_context17.next=2;break;case 14:return _context17.abrupt("return",this.scan(height));case 15:case"end":return _context17.stop()}},_callee17,this)}));return function(){return _ref18.apply(this,arguments)}}(),WalletDB.prototype.scan=function(){var _ref19=_asyncToGenerator(regeneratorRuntime.mark(function _callee18(height){var tip;return regeneratorRuntime.wrap(function(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:return null==height&&(height=this.state.startHeight),assert(height>>>0===height,"WDB: Must pass in a height."),_context18.next=4,this.rollback(height);case 4:return this.logger.info("WalletDB is scanning %d blocks.",this.state.height-height+1),_context18.next=7,this.getTip();case 7:return tip=_context18.sent,_context18.prev=8,this.rescanning=!0,_context18.next=12,this.client.rescan(tip.hash);case 12:return _context18.prev=12,this.rescanning=!1,_context18.finish(12);case 15:case"end":return _context18.stop()}},_callee18,this,[[8,,12,15]])}));return function(_x9){return _ref19.apply(this,arguments)}}(),WalletDB.prototype.rescan=function(){var _ref20=_asyncToGenerator(regeneratorRuntime.mark(function _callee19(height){var unlock;return regeneratorRuntime.wrap(function(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:return _context19.next=2,this.txLock.lock();case 2:return unlock=_context19.sent,_context19.prev=3,_context19.next=6,this._rescan(height);case 6:return _context19.abrupt("return",_context19.sent);case 7:return _context19.prev=7,unlock(),_context19.finish(7);case 10:case"end":return _context19.stop()}},_callee19,this,[[3,,7,10]])}));return function(_x10){return _ref20.apply(this,arguments)}}(),WalletDB.prototype._rescan=function(){var _ref21=_asyncToGenerator(regeneratorRuntime.mark(function _callee20(height){return regeneratorRuntime.wrap(function(_context20){for(;;)switch(_context20.prev=_context20.next){case 0:return _context20.abrupt("return",this.scan(height));case 1:case"end":return _context20.stop()}},_callee20,this)}));return function(_x11){return _ref21.apply(this,arguments)}}(),WalletDB.prototype.send=function(){var _ref22=_asyncToGenerator(regeneratorRuntime.mark(function _callee21(tx){return regeneratorRuntime.wrap(function(_context21){for(;;)switch(_context21.prev=_context21.next){case 0:return _context21.abrupt("return",this.client.send(tx));case 1:case"end":return _context21.stop()}},_callee21,this)}));return function(_x12){return _ref22.apply(this,arguments)}}(),WalletDB.prototype.estimateFee=function(){var _ref23=_asyncToGenerator(regeneratorRuntime.mark(function _callee22(blocks){var rate;return regeneratorRuntime.wrap(function(_context22){for(;;)switch(_context22.prev=_context22.next){case 0:if(!(this.feeRate>0)){_context22.next=2;break}return _context22.abrupt("return",this.feeRate);case 2:return _context22.next=4,this.client.estimateFee(blocks);case 4:if(!((rate=_context22.sent)<this.network.feeRate)){_context22.next=7;break}return _context22.abrupt("return",this.network.feeRate);case 7:if(!(rate>this.network.maxFeeRate)){_context22.next=9;break}return _context22.abrupt("return",this.network.maxFeeRate);case 9:return _context22.abrupt("return",rate);case 10:case"end":return _context22.stop()}},_callee22,this)}));return function(_x13){return _ref23.apply(this,arguments)}}(),WalletDB.prototype.syncFilter=function(){return this.logger.info("Sending filter to server (%dmb).",this.filter.size/8/(1<<20)),this.filterSent=!0,this.client.setFilter(this.filter)},WalletDB.prototype.addFilter=function(data){if(this.filterSent)return this.client.addFilter(data)},WalletDB.prototype.resetFilter=function(){if(this.filterSent)return this.client.resetFilter()},WalletDB.prototype.backup=function(path){return this.db.backup(path)},WalletDB.prototype.wipe=function(){var _ref24=_asyncToGenerator(regeneratorRuntime.mark(function _callee23(){var iter,b,total;return regeneratorRuntime.wrap(function(_context23){for(;;)switch(_context23.prev=_context23.next){case 0:return this.logger.warning("Wiping WalletDB TXDB..."),this.logger.warning("I hope you know what you're doing."),iter=this.db.iterator(),b=this.db.batch(),total=0,_context23.next=7,iter.each(function(key){switch(key[0]){case 98:case 99:case 101:case 116:case 111:case 104:case 82:b.del(key),total+=1}});case 7:return this.logger.warning("Wiped %d txdb records.",total),_context23.abrupt("return",b.write());case 9:case"end":return _context23.stop()}},_callee23,this)}));return function(){return _ref24.apply(this,arguments)}}(),WalletDB.prototype.getDepth=function(){var _ref25=_asyncToGenerator(regeneratorRuntime.mark(function _callee24(){var raw;return regeneratorRuntime.wrap(function(_context24){for(;;)switch(_context24.prev=_context24.next){case 0:return _context24.next=2,this.db.get(layout.D.build());case 2:if(raw=_context24.sent){_context24.next=5;break}return _context24.abrupt("return",0);case 5:return _context24.abrupt("return",raw.readUInt32LE(0,!0));case 6:case"end":return _context24.stop()}},_callee24,this)}));return function(){return _ref25.apply(this,arguments)}}(),WalletDB.prototype.testFilter=function(data){return this.filter.test(data,"hex")},WalletDB.prototype.addHash=function(hash){return this.filter.add(hash,"hex"),this.addFilter(hash)},WalletDB.prototype.addOutpoint=function(hash,index){var outpoint=new Outpoint(hash,index);this.filter.add(outpoint.toRaw())},WalletDB.prototype.dump=function(){return this.db.dump()},WalletDB.prototype.register=function(wallet){assert(!this.wallets.has(wallet.wid)),this.wallets.set(wallet.wid,wallet)},WalletDB.prototype.unregister=function(wallet){assert(this.wallets.has(wallet.wid)),this.wallets.delete(wallet.wid)},WalletDB.prototype.ensureWID=function(){var _ref26=_asyncToGenerator(regeneratorRuntime.mark(function _callee25(id){return regeneratorRuntime.wrap(function(_context25){for(;;)switch(_context25.prev=_context25.next){case 0:if("number"!=typeof id){_context25.next=6;break}return _context25.next=3,this.db.has(layout.W.build(id));case 3:if(_context25.sent){_context25.next=5;break}return _context25.abrupt("return",-1);case 5:return _context25.abrupt("return",id);case 6:return _context25.abrupt("return",this.getWID(id));case 7:case"end":return _context25.stop()}},_callee25,this)}));return function(_x14){return _ref26.apply(this,arguments)}}(),WalletDB.prototype.getWID=function(){var _ref27=_asyncToGenerator(regeneratorRuntime.mark(function _callee26(id){var data;return regeneratorRuntime.wrap(function(_context26){for(;;)switch(_context26.prev=_context26.next){case 0:return _context26.next=2,this.db.get(layout.l.build(id));case 2:if(data=_context26.sent){_context26.next=5;break}return _context26.abrupt("return",-1);case 5:return assert(4===data.length),_context26.abrupt("return",data.readUInt32LE(0,!0));case 7:case"end":return _context26.stop()}},_callee26,this)}));return function(_x15){return _ref27.apply(this,arguments)}}(),WalletDB.prototype.getID=function(){var _ref28=_asyncToGenerator(regeneratorRuntime.mark(function _callee27(wid){var data;return regeneratorRuntime.wrap(function(_context27){for(;;)switch(_context27.prev=_context27.next){case 0:return _context27.next=2,this.db.get(layout.W.build(wid));case 2:if(data=_context27.sent){_context27.next=5;break}return _context27.abrupt("return",null);case 5:return _context27.abrupt("return",toString(data));case 6:case"end":return _context27.stop()}},_callee27,this)}));return function(_x16){return _ref28.apply(this,arguments)}}(),WalletDB.prototype.get=function(){var _ref29=_asyncToGenerator(regeneratorRuntime.mark(function _callee28(id){var wid,unlock;return regeneratorRuntime.wrap(function(_context28){for(;;)switch(_context28.prev=_context28.next){case 0:return _context28.next=2,this.ensureWID(id);case 2:if(-1!==(wid=_context28.sent)){_context28.next=5;break}return _context28.abrupt("return",null);case 5:return _context28.next=7,this.readLock.lock(wid);case 7:return unlock=_context28.sent,_context28.prev=8,_context28.next=11,this._get(wid);case 11:return _context28.abrupt("return",_context28.sent);case 12:return _context28.prev=12,unlock(),_context28.finish(12);case 15:case"end":return _context28.stop()}},_callee28,this,[[8,,12,15]])}));return function(_x17){return _ref29.apply(this,arguments)}}(),WalletDB.prototype._get=function(){var _ref30=_asyncToGenerator(regeneratorRuntime.mark(function _callee29(wid){var cache,id,data,wallet;return regeneratorRuntime.wrap(function(_context29){for(;;)switch(_context29.prev=_context29.next){case 0:if(!(cache=this.wallets.get(wid))){_context29.next=3;break}return _context29.abrupt("return",cache);case 3:return _context29.next=5,this.getID(wid);case 5:if(id=_context29.sent){_context29.next=8;break}return _context29.abrupt("return",null);case 8:return _context29.next=10,this.db.get(layout.w.build(wid));case 10:return data=_context29.sent,assert(data),(wallet=Wallet.fromRaw(this,data)).wid=wid,wallet.id=id,_context29.next=17,wallet.open();case 17:return this.register(wallet),_context29.abrupt("return",wallet);case 19:case"end":return _context29.stop()}},_callee29,this)}));return function(_x18){return _ref30.apply(this,arguments)}}(),WalletDB.prototype.save=function(b,wallet){var wid=wallet.wid,id=wallet.id;b.put(layout.w.build(wid),wallet.toRaw()),b.put(layout.W.build(wid),fromString(id)),b.put(layout.l.build(id),fromU32(wid))},WalletDB.prototype.increment=function(b,wid){b.put(layout.D.build(),fromU32(wid+1))},WalletDB.prototype.rename=function(){var _ref31=_asyncToGenerator(regeneratorRuntime.mark(function _callee30(wallet,id){var unlock;return regeneratorRuntime.wrap(function(_context30){for(;;)switch(_context30.prev=_context30.next){case 0:return _context30.next=2,this.writeLock.lock();case 2:return unlock=_context30.sent,_context30.prev=3,_context30.next=6,this._rename(wallet,id);case 6:return _context30.abrupt("return",_context30.sent);case 7:return _context30.prev=7,unlock(),_context30.finish(7);case 10:case"end":return _context30.stop()}},_callee30,this,[[3,,7,10]])}));return function(_x19,_x20){return _ref31.apply(this,arguments)}}(),WalletDB.prototype._rename=function(){var _ref32=_asyncToGenerator(regeneratorRuntime.mark(function _callee31(wallet,id){var b;return regeneratorRuntime.wrap(function(_context31){for(;;)switch(_context31.prev=_context31.next){case 0:if(common.isName(id)){_context31.next=2;break}throw new Error("WDB: Bad wallet ID.");case 2:return _context31.next=4,this.has(id);case 4:if(!_context31.sent){_context31.next=6;break}throw new Error("WDB: ID not available.");case 6:return(b=this.db.batch()).put(layout.W.build(wallet.wid),fromString(id)),b.del(layout.l.build(wallet.id)),b.put(layout.l.build(id),fromU32(wallet.wid)),_context31.next=12,b.write();case 12:wallet.id=id;case 13:case"end":return _context31.stop()}},_callee31,this)}));return function(_x21,_x22){return _ref32.apply(this,arguments)}}(),WalletDB.prototype.renameAccount=function(b,account,name){var wid=account.wid,index=account.accountIndex;b.del(layout.i.build(wid,account.name)),b.put(layout.i.build(wid,name),fromU32(index)),b.put(layout.n.build(wid,index),fromString(name)),account.name=name},WalletDB.prototype.remove=function(){var _ref33=_asyncToGenerator(regeneratorRuntime.mark(function _callee32(id){var wid,unlock1,unlock2,unlock3;return regeneratorRuntime.wrap(function(_context32){for(;;)switch(_context32.prev=_context32.next){case 0:return _context32.next=2,this.ensureWID(id);case 2:if(-1!==(wid=_context32.sent)){_context32.next=5;break}return _context32.abrupt("return",!1);case 5:return _context32.next=7,this.readLock.lock(wid);case 7:return unlock1=_context32.sent,_context32.next=10,this.writeLock.lock();case 10:return unlock2=_context32.sent,_context32.next=13,this.txLock.lock();case 13:return unlock3=_context32.sent,_context32.prev=14,_context32.next=17,this._remove(wid);case 17:return _context32.abrupt("return",_context32.sent);case 18:return _context32.prev=18,unlock3(),unlock2(),unlock1(),_context32.finish(18);case 23:case"end":return _context32.stop()}},_callee32,this,[[14,,18,23]])}));return function(_x23){return _ref33.apply(this,arguments)}}(),WalletDB.prototype._remove=function(){var _ref34=_asyncToGenerator(regeneratorRuntime.mark(function _callee33(wid){var id,b,piter,removeRange,bucket,biter,siter,uiter,wallet,_this4=this;return regeneratorRuntime.wrap(function(_context33){for(;;)switch(_context33.prev=_context33.next){case 0:return _context33.next=2,this.getID(wid);case 2:if(id=_context33.sent){_context33.next=5;break}return _context33.abrupt("return",!1);case 5:if("primary"!==id){_context33.next=7;break}throw new Error("Cannot remove primary wallet.");case 7:return(b=this.db.batch()).del(layout.w.build(wid)),b.del(layout.W.build(wid)),b.del(layout.l.build(id)),piter=this.db.iterator({gte:layout.P.min(wid),lte:layout.P.max(wid)}),_context33.next=14,piter.each(function(key,value){var hash=layout.P.parse(key)[1];return b.del(key),_this4.removePathMap(b,hash,wid)});case 14:return removeRange=function(opt){return _this4.db.iterator(opt).each(function(key){return b.del(key)})},_context33.next=17,removeRange({gte:layout.r.min(wid),lte:layout.r.max(wid)});case 17:return _context33.next=19,removeRange({gte:layout.a.min(wid),lte:layout.a.max(wid)});case 19:return _context33.next=21,removeRange({gte:layout.i.min(wid),lte:layout.i.max(wid)});case 21:return _context33.next=23,removeRange({gte:layout.n.min(wid),lte:layout.n.max(wid)});case 23:return _context33.next=25,removeRange({gt:layout.t.build(wid),lt:layout.t.build(wid+1)});case 25:return bucket=this.db.bucket(layout.t.build(wid)),biter=bucket.iterator({gte:tlayout.b.min(),lte:tlayout.b.max()}),_context33.next=29,biter.each(function(key,value){var height=tlayout.b.parse(key);return _this4.removeBlockMap(b,height,wid)});case 29:return siter=bucket.iterator({gte:tlayout.s.min(),lte:tlayout.s.max(),keys:!0}),_context33.next=32,siter.each(function(key,value){var _tlayout$s$parse=tlayout.s.parse(key),hash=_tlayout$s$parse[0],index=_tlayout$s$parse[1];return _this4.removeOutpointMap(b,hash,index,wid)});case 32:return uiter=bucket.iterator({gte:tlayout.p.min(),lte:tlayout.p.max(),keys:!0}),_context33.next=35,uiter.each(function(key,value){var hash=tlayout.p.parse(key);return _this4.removeTXMap(b,hash,wid)});case 35:if(!(wallet=this.wallets.get(wid))){_context33.next=40;break}return _context33.next=39,wallet.destroy();case 39:this.unregister(wallet);case 40:return _context33.next=42,b.write();case 42:return _context33.abrupt("return",!0);case 43:case"end":return _context33.stop()}},_callee33,this)}));return function(_x24){return _ref34.apply(this,arguments)}}(),WalletDB.prototype.auth=function(){var _ref35=_asyncToGenerator(regeneratorRuntime.mark(function _callee34(id,token){var wallet;return regeneratorRuntime.wrap(function(_context34){for(;;)switch(_context34.prev=_context34.next){case 0:return _context34.next=2,this.get(id);case 2:if(wallet=_context34.sent){_context34.next=5;break}return _context34.abrupt("return",null);case 5:if(ccmp(token,wallet.token)){_context34.next=7;break}throw new Error("WDB: Authentication error.");case 7:return _context34.abrupt("return",wallet);case 8:case"end":return _context34.stop()}},_callee34,this)}));return function(_x25,_x26){return _ref35.apply(this,arguments)}}(),WalletDB.prototype.create=function(){var _ref36=_asyncToGenerator(regeneratorRuntime.mark(function _callee35(options){var unlock;return regeneratorRuntime.wrap(function(_context35){for(;;)switch(_context35.prev=_context35.next){case 0:return _context35.next=2,this.writeLock.lock();case 2:return unlock=_context35.sent,options||(options={}),_context35.prev=4,_context35.next=7,this._create(options);case 7:return _context35.abrupt("return",_context35.sent);case 8:return _context35.prev=8,unlock(),_context35.finish(8);case 11:case"end":return _context35.stop()}},_callee35,this,[[4,,8,11]])}));return function(_x27){return _ref36.apply(this,arguments)}}(),WalletDB.prototype._create=function(){var _ref37=_asyncToGenerator(regeneratorRuntime.mark(function _callee36(options){var wallet;return regeneratorRuntime.wrap(function(_context36){for(;;)switch(_context36.prev=_context36.next){case 0:if(!options.id){_context36.next=5;break}return _context36.next=3,this.has(options.id);case 3:if(!_context36.sent){_context36.next=5;break}throw new Error("WDB: Wallet already exists.");case 5:return(wallet=Wallet.fromOptions(this,options)).wid=this.depth,_context36.next=9,wallet.init(options,options.passphrase);case 9:return this.depth+=1,this.register(wallet),this.logger.info("Created wallet %s in WalletDB.",wallet.id),_context36.abrupt("return",wallet);case 13:case"end":return _context36.stop()}},_callee36,this)}));return function(_x28){return _ref37.apply(this,arguments)}}(),WalletDB.prototype.has=function(){var _ref38=_asyncToGenerator(regeneratorRuntime.mark(function _callee37(id){var wid;return regeneratorRuntime.wrap(function(_context37){for(;;)switch(_context37.prev=_context37.next){case 0:return _context37.next=2,this.ensureWID(id);case 2:return wid=_context37.sent,_context37.abrupt("return",-1!==wid);case 4:case"end":return _context37.stop()}},_callee37,this)}));return function(_x29){return _ref38.apply(this,arguments)}}(),WalletDB.prototype.ensure=function(){var _ref39=_asyncToGenerator(regeneratorRuntime.mark(function _callee38(options){var wallet;return regeneratorRuntime.wrap(function(_context38){for(;;)switch(_context38.prev=_context38.next){case 0:if(!options.id){_context38.next=6;break}return _context38.next=3,this.get(options.id);case 3:if(!(wallet=_context38.sent)){_context38.next=6;break}return _context38.abrupt("return",wallet);case 6:return _context38.abrupt("return",this.create(options));case 7:case"end":return _context38.stop()}},_callee38,this)}));return function(_x30){return _ref39.apply(this,arguments)}}(),WalletDB.prototype.getAccount=function(){var _ref40=_asyncToGenerator(regeneratorRuntime.mark(function _callee39(wid,index){var name,data,account;return regeneratorRuntime.wrap(function(_context39){for(;;)switch(_context39.prev=_context39.next){case 0:return _context39.next=2,this.getAccountName(wid,index);case 2:if(name=_context39.sent){_context39.next=5;break}return _context39.abrupt("return",null);case 5:return _context39.next=7,this.db.get(layout.a.build(wid,index));case 7:return data=_context39.sent,assert(data),(account=Account.fromRaw(this,data)).accountIndex=index,account.name=name,_context39.abrupt("return",account);case 13:case"end":return _context39.stop()}},_callee39,this)}));return function(_x31,_x32){return _ref40.apply(this,arguments)}}(),WalletDB.prototype.getAccounts=function(){var _ref41=_asyncToGenerator(regeneratorRuntime.mark(function _callee40(wid){return regeneratorRuntime.wrap(function(_context40){for(;;)switch(_context40.prev=_context40.next){case 0:return _context40.abrupt("return",this.db.values({gte:layout.n.min(wid),lte:layout.n.max(wid),parse:toString}));case 1:case"end":return _context40.stop()}},_callee40,this)}));return function(_x33){return _ref41.apply(this,arguments)}}(),WalletDB.prototype.getAccountIndex=function(){var _ref42=_asyncToGenerator(regeneratorRuntime.mark(function _callee41(wid,name){var index;return regeneratorRuntime.wrap(function(_context41){for(;;)switch(_context41.prev=_context41.next){case 0:return _context41.next=2,this.db.get(layout.i.build(wid,name));case 2:if(index=_context41.sent){_context41.next=5;break}return _context41.abrupt("return",-1);case 5:return _context41.abrupt("return",index.readUInt32LE(0,!0));case 6:case"end":return _context41.stop()}},_callee41,this)}));return function(_x34,_x35){return _ref42.apply(this,arguments)}}(),WalletDB.prototype.getAccountName=function(){var _ref43=_asyncToGenerator(regeneratorRuntime.mark(function _callee42(wid,index){var name;return regeneratorRuntime.wrap(function(_context42){for(;;)switch(_context42.prev=_context42.next){case 0:return _context42.next=2,this.db.get(layout.n.build(wid,index));case 2:if(name=_context42.sent){_context42.next=5;break}return _context42.abrupt("return",null);case 5:return _context42.abrupt("return",toString(name));case 6:case"end":return _context42.stop()}},_callee42,this)}));return function(_x36,_x37){return _ref43.apply(this,arguments)}}(),WalletDB.prototype.saveAccount=function(b,account){var wid=account.wid,index=account.accountIndex,name=account.name;b.put(layout.a.build(wid,index),account.toRaw()),b.put(layout.i.build(wid,name),fromU32(index)),b.put(layout.n.build(wid,index),fromString(name))},WalletDB.prototype.hasAccount=function(){var _ref44=_asyncToGenerator(regeneratorRuntime.mark(function _callee43(wid,index){return regeneratorRuntime.wrap(function(_context43){for(;;)switch(_context43.prev=_context43.next){case 0:return _context43.abrupt("return",this.db.has(layout.a.build(wid,index)));case 1:case"end":return _context43.stop()}},_callee43,this)}));return function(_x38,_x39){return _ref44.apply(this,arguments)}}(),WalletDB.prototype.saveKey=function(){var _ref45=_asyncToGenerator(regeneratorRuntime.mark(function _callee44(b,wid,ring){return regeneratorRuntime.wrap(function(_context44){for(;;)switch(_context44.prev=_context44.next){case 0:return _context44.abrupt("return",this.savePath(b,wid,ring.toPath()));case 1:case"end":return _context44.stop()}},_callee44,this)}));return function(_x40,_x41,_x42){return _ref45.apply(this,arguments)}}(),WalletDB.prototype.savePath=function(){var _ref46=_asyncToGenerator(regeneratorRuntime.mark(function _callee45(b,wid,path){return regeneratorRuntime.wrap(function(_context45){for(;;)switch(_context45.prev=_context45.next){case 0:return _context45.next=2,this.addPathMap(b,path.hash,wid);case 2:b.put(layout.P.build(wid,path.hash),path.toRaw()),b.put(layout.r.build(wid,path.account,path.hash),null);case 4:case"end":return _context45.stop()}},_callee45,this)}));return function(_x43,_x44,_x45){return _ref46.apply(this,arguments)}}(),WalletDB.prototype.getPath=function(){var _ref47=_asyncToGenerator(regeneratorRuntime.mark(function _callee46(wid,hash){var path;return regeneratorRuntime.wrap(function(_context46){for(;;)switch(_context46.prev=_context46.next){case 0:return _context46.next=2,this.readPath(wid,hash);case 2:if(path=_context46.sent){_context46.next=5;break}return _context46.abrupt("return",null);case 5:return _context46.next=7,this.getAccountName(wid,path.account);case 7:return path.name=_context46.sent,assert(path.name),_context46.abrupt("return",path);case 10:case"end":return _context46.stop()}},_callee46,this)}));return function(_x46,_x47){return _ref47.apply(this,arguments)}}(),WalletDB.prototype.readPath=function(){var _ref48=_asyncToGenerator(regeneratorRuntime.mark(function _callee47(wid,hash){var data,path;return regeneratorRuntime.wrap(function(_context47){for(;;)switch(_context47.prev=_context47.next){case 0:return _context47.next=2,this.db.get(layout.P.build(wid,hash));case 2:if(data=_context47.sent){_context47.next=5;break}return _context47.abrupt("return",null);case 5:return(path=Path.fromRaw(data)).hash=hash,_context47.abrupt("return",path);case 8:case"end":return _context47.stop()}},_callee47,this)}));return function(_x48,_x49){return _ref48.apply(this,arguments)}}(),WalletDB.prototype.hasPath=function(){var _ref49=_asyncToGenerator(regeneratorRuntime.mark(function _callee48(wid,hash){return regeneratorRuntime.wrap(function(_context48){for(;;)switch(_context48.prev=_context48.next){case 0:return _context48.abrupt("return",this.db.has(layout.P.build(wid,hash)));case 1:case"end":return _context48.stop()}},_callee48,this)}));return function(_x50,_x51){return _ref49.apply(this,arguments)}}(),WalletDB.prototype.getHashes=function(){var _ref50=_asyncToGenerator(regeneratorRuntime.mark(function _callee49(){return regeneratorRuntime.wrap(function(_context49){for(;;)switch(_context49.prev=_context49.next){case 0:return _context49.abrupt("return",this.db.keys({gte:layout.p.min(),lte:layout.p.max(),parse:function(key){return layout.p.parse(key)}}));case 1:case"end":return _context49.stop()}},_callee49,this)}));return function(){return _ref50.apply(this,arguments)}}(),WalletDB.prototype.getOutpoints=function(){var _ref51=_asyncToGenerator(regeneratorRuntime.mark(function _callee50(){return regeneratorRuntime.wrap(function(_context50){for(;;)switch(_context50.prev=_context50.next){case 0:return _context50.abrupt("return",this.db.keys({gte:layout.o.min(),lte:layout.o.max(),parse:function(key){var _layout$o$parse2=layout.o.parse(key),hash=_layout$o$parse2[0],index=_layout$o$parse2[1];return new Outpoint(hash,index)}}));case 1:case"end":return _context50.stop()}},_callee50,this)}));return function(){return _ref51.apply(this,arguments)}}(),WalletDB.prototype.getWalletHashes=function(){var _ref52=_asyncToGenerator(regeneratorRuntime.mark(function _callee51(wid){return regeneratorRuntime.wrap(function(_context51){for(;;)switch(_context51.prev=_context51.next){case 0:return _context51.abrupt("return",this.db.keys({gte:layout.P.min(wid),lte:layout.P.max(wid),parse:function(key){return layout.P.parse(key)[1]}}));case 1:case"end":return _context51.stop()}},_callee51,this)}));return function(_x52){return _ref52.apply(this,arguments)}}(),WalletDB.prototype.getAccountHashes=function(){var _ref53=_asyncToGenerator(regeneratorRuntime.mark(function _callee52(wid,account){return regeneratorRuntime.wrap(function(_context52){for(;;)switch(_context52.prev=_context52.next){case 0:return _context52.abrupt("return",this.db.keys({gte:layout.r.min(wid,account),lte:layout.r.max(wid,account),parse:function(key){return layout.r.parse(key)[2]}}));case 1:case"end":return _context52.stop()}},_callee52,this)}));return function(_x53,_x54){return _ref53.apply(this,arguments)}}(),WalletDB.prototype.getWalletPaths=function(){var _ref54=_asyncToGenerator(regeneratorRuntime.mark(function _callee53(wid){var items,paths,_iterator2,_isArray2,_i2,_ref56,_ref55,key,value,_layout$P$parse2,hash,_path;return regeneratorRuntime.wrap(function(_context53){for(;;)switch(_context53.prev=_context53.next){case 0:return _context53.next=2,this.db.range({gte:layout.P.min(wid),lte:layout.P.min(wid)});case 2:items=_context53.sent,paths=[],_iterator2=items,_isArray2=Array.isArray(_iterator2),_i2=0,_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();case 5:if(!_isArray2){_context53.next=11;break}if(!(_i2>=_iterator2.length)){_context53.next=8;break}return _context53.abrupt("break",28);case 8:_ref56=_iterator2[_i2++],_context53.next=15;break;case 11:if(!(_i2=_iterator2.next()).done){_context53.next=14;break}return _context53.abrupt("break",28);case 14:_ref56=_i2.value;case 15:return key=(_ref55=_ref56).key,value=_ref55.value,_layout$P$parse2=layout.P.parse(key),hash=_layout$P$parse2[1],(_path=Path.fromRaw(value)).hash=hash,_context53.next=23,this.getAccountName(wid,_path.account);case 23:_path.name=_context53.sent,assert(_path.name),paths.push(_path);case 26:_context53.next=5;break;case 28:return _context53.abrupt("return",paths);case 29:case"end":return _context53.stop()}},_callee53,this)}));return function(_x55){return _ref54.apply(this,arguments)}}(),WalletDB.prototype.getWallets=function(){var _ref57=_asyncToGenerator(regeneratorRuntime.mark(function _callee54(){return regeneratorRuntime.wrap(function(_context54){for(;;)switch(_context54.prev=_context54.next){case 0:return _context54.abrupt("return",this.db.values({gte:layout.W.min(),lte:layout.W.max(),parse:toString}));case 1:case"end":return _context54.stop()}},_callee54,this)}));return function(){return _ref57.apply(this,arguments)}}(),WalletDB.prototype.encryptKeys=function(){var _ref58=_asyncToGenerator(regeneratorRuntime.mark(function _callee55(b,wid,key){var iter;return regeneratorRuntime.wrap(function(_context55){for(;;)switch(_context55.prev=_context55.next){case 0:return iter=this.db.iterator({gte:layout.P.min(wid),lte:layout.P.max(wid),values:!0}),_context55.next=3,iter.each(function(k,value){var hash=layout.P.parse(k)[1],path=Path.fromRaw(value);if(path.data){assert(!path.encrypted);var iv=Buffer.from(hash,"hex").slice(0,16);path.data=aes.encipher(path.data,key,iv),path.encrypted=!0,b.put(k,path.toRaw())}});case 3:case"end":return _context55.stop()}},_callee55,this)}));return function(_x56,_x57,_x58){return _ref58.apply(this,arguments)}}(),WalletDB.prototype.decryptKeys=function(){var _ref59=_asyncToGenerator(regeneratorRuntime.mark(function _callee56(b,wid,key){var iter;return regeneratorRuntime.wrap(function(_context56){for(;;)switch(_context56.prev=_context56.next){case 0:return iter=this.db.iterator({gte:layout.P.min(wid),lte:layout.P.max(wid),values:!0}),_context56.next=3,iter.each(function(k,value){var hash=layout.P.parse(k)[1],path=Path.fromRaw(value);if(path.data){assert(path.encrypted);var iv=Buffer.from(hash,"hex").slice(0,16);path.data=aes.decipher(path.data,key,iv),path.encrypted=!1,b.put(k,path.toRaw())}});case 3:case"end":return _context56.stop()}},_callee56,this)}));return function(_x59,_x60,_x61){return _ref59.apply(this,arguments)}}(),WalletDB.prototype.resend=function(){var _ref60=_asyncToGenerator(regeneratorRuntime.mark(function _callee57(){var wids,_iterator3,_isArray3,_i3,_ref61,wid;return regeneratorRuntime.wrap(function(_context57){for(;;)switch(_context57.prev=_context57.next){case 0:return _context57.next=2,this.db.keys({gte:layout.w.min(),lte:layout.w.max(),parse:function(key){return layout.w.parse(key)}});case 2:wids=_context57.sent,this.logger.info("Resending from %d wallets.",wids.length),_iterator3=wids,_isArray3=Array.isArray(_iterator3),_i3=0,_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();case 5:if(!_isArray3){_context57.next=11;break}if(!(_i3>=_iterator3.length)){_context57.next=8;break}return _context57.abrupt("break",20);case 8:_ref61=_iterator3[_i3++],_context57.next=15;break;case 11:if(!(_i3=_iterator3.next()).done){_context57.next=14;break}return _context57.abrupt("break",20);case 14:_ref61=_i3.value;case 15:return wid=_ref61,_context57.next=18,this.resendPending(wid);case 18:_context57.next=5;break;case 20:case"end":return _context57.stop()}},_callee57,this)}));return function(){return _ref60.apply(this,arguments)}}(),WalletDB.prototype.resendPending=function(){var _ref62=_asyncToGenerator(regeneratorRuntime.mark(function _callee58(wid){var prefix,b,hashes,txs,_iterator4,_isArray4,_i4,_ref63,hash,data,wtx,_iterator5,_isArray5,_i5,_ref64,tx;return regeneratorRuntime.wrap(function(_context58){for(;;)switch(_context58.prev=_context58.next){case 0:return prefix=layout.t.build(wid),b=this.db.bucket(prefix),_context58.next=4,b.keys({gte:tlayout.p.min(),lte:tlayout.p.max(),parse:function(key){return tlayout.p.parse(key)}});case 4:if(0!==(hashes=_context58.sent).length){_context58.next=7;break}return _context58.abrupt("return");case 7:this.logger.info("Rebroadcasting %d transactions for %d.",hashes.length,wid),txs=[],_iterator4=hashes,_isArray4=Array.isArray(_iterator4),_i4=0,_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();case 10:if(!_isArray4){_context58.next=16;break}if(!(_i4>=_iterator4.length)){_context58.next=13;break}return _context58.abrupt("break",32);case 13:_ref63=_iterator4[_i4++],_context58.next=20;break;case 16:if(!(_i4=_iterator4.next()).done){_context58.next=19;break}return _context58.abrupt("break",32);case 19:_ref63=_i4.value;case 20:return hash=_ref63,_context58.next=23,b.get(tlayout.t.build(hash));case 23:if(data=_context58.sent){_context58.next=26;break}return _context58.abrupt("continue",30);case 26:if(!(wtx=TXRecord.fromRaw(data)).tx.isCoinbase()){_context58.next=29;break}return _context58.abrupt("continue",30);case 29:txs.push(wtx.tx);case 30:_context58.next=10;break;case 32:_iterator5=common.sortDeps(txs),_isArray5=Array.isArray(_iterator5),_i5=0,_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();case 33:if(!_isArray5){_context58.next=39;break}if(!(_i5>=_iterator5.length)){_context58.next=36;break}return _context58.abrupt("break",48);case 36:_ref64=_iterator5[_i5++],_context58.next=43;break;case 39:if(!(_i5=_iterator5.next()).done){_context58.next=42;break}return _context58.abrupt("break",48);case 42:_ref64=_i5.value;case 43:return tx=_ref64,_context58.next=46,this.send(tx);case 46:_context58.next=33;break;case 48:case"end":return _context58.stop()}},_callee58,this)}));return function(_x62){return _ref62.apply(this,arguments)}}(),WalletDB.prototype.getWalletsByTX=function(){var _ref65=_asyncToGenerator(regeneratorRuntime.mark(function _callee59(tx){var wids,_iterator6,_isArray6,_i6,_ref67,prevout,hash,index,map,_iterator7,_isArray7,_i7,_ref68,wid,hashes,_iterator8,_isArray8,_i8,_ref69,_hash,_map,_iterator9,_isArray9,_i9,_ref70,_wid;return regeneratorRuntime.wrap(function(_context59){for(;;)switch(_context59.prev=_context59.next){case 0:if(wids=new Set,tx.isCoinbase()){_context59.next=40;break}_iterator6=tx.inputs,_isArray6=Array.isArray(_iterator6),_i6=0,_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();case 3:if(!_isArray6){_context59.next=9;break}if(!(_i6>=_iterator6.length)){_context59.next=6;break}return _context59.abrupt("break",40);case 6:_ref67=_iterator6[_i6++],_context59.next=13;break;case 9:if(!(_i6=_iterator6.next()).done){_context59.next=12;break}return _context59.abrupt("break",40);case 12:_ref67=_i6.value;case 13:if(prevout=_ref67.prevout,hash=prevout.hash,index=prevout.index,this.testFilter(prevout.toRaw())){_context59.next=18;break}return _context59.abrupt("continue",38);case 18:return _context59.next=20,this.getOutpointMap(hash,index);case 20:if(map=_context59.sent){_context59.next=23;break}return _context59.abrupt("continue",38);case 23:_iterator7=map.wids,_isArray7=Array.isArray(_iterator7),_i7=0,_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();case 24:if(!_isArray7){_context59.next=30;break}if(!(_i7>=_iterator7.length)){_context59.next=27;break}return _context59.abrupt("break",38);case 27:_ref68=_iterator7[_i7++],_context59.next=34;break;case 30:if(!(_i7=_iterator7.next()).done){_context59.next=33;break}return _context59.abrupt("break",38);case 33:_ref68=_i7.value;case 34:wid=_ref68,wids.add(wid);case 36:_context59.next=24;break;case 38:_context59.next=3;break;case 40:hashes=tx.getOutputHashes("hex"),_iterator8=hashes,_isArray8=Array.isArray(_iterator8),_i8=0,_iterator8=_isArray8?_iterator8:_iterator8[Symbol.iterator]();case 42:if(!_isArray8){_context59.next=48;break}if(!(_i8>=_iterator8.length)){_context59.next=45;break}return _context59.abrupt("break",77);case 45:_ref69=_iterator8[_i8++],_context59.next=52;break;case 48:if(!(_i8=_iterator8.next()).done){_context59.next=51;break}return _context59.abrupt("break",77);case 51:_ref69=_i8.value;case 52:if(_hash=_ref69,this.testFilter(_hash)){_context59.next=55;break}return _context59.abrupt("continue",75);case 55:return _context59.next=57,this.getPathMap(_hash);case 57:if(_map=_context59.sent){_context59.next=60;break}return _context59.abrupt("continue",75);case 60:_iterator9=_map.wids,_isArray9=Array.isArray(_iterator9),_i9=0,_iterator9=_isArray9?_iterator9:_iterator9[Symbol.iterator]();case 61:if(!_isArray9){_context59.next=67;break}if(!(_i9>=_iterator9.length)){_context59.next=64;break}return _context59.abrupt("break",75);case 64:_ref70=_iterator9[_i9++],_context59.next=71;break;case 67:if(!(_i9=_iterator9.next()).done){_context59.next=70;break}return _context59.abrupt("break",75);case 70:_ref70=_i9.value;case 71:_wid=_ref70,wids.add(_wid);case 73:_context59.next=61;break;case 75:_context59.next=42;break;case 77:if(0!==wids.size){_context59.next=79;break}return _context59.abrupt("return",null);case 79:return _context59.abrupt("return",wids);case 80:case"end":return _context59.stop()}},_callee59,this)}));return function(_x63){return _ref65.apply(this,arguments)}}(),WalletDB.prototype.getState=function(){var _ref71=_asyncToGenerator(regeneratorRuntime.mark(function _callee60(){var data;return regeneratorRuntime.wrap(function(_context60){for(;;)switch(_context60.prev=_context60.next){case 0:return _context60.next=2,this.db.get(layout.R.build());case 2:if(data=_context60.sent){_context60.next=5;break}return _context60.abrupt("return",null);case 5:return _context60.abrupt("return",ChainState.fromRaw(data));case 6:case"end":return _context60.stop()}},_callee60,this)}));return function(){return _ref71.apply(this,arguments)}}(),WalletDB.prototype.setTip=function(){var _ref72=_asyncToGenerator(regeneratorRuntime.mark(function _callee61(tip){var b,state;return regeneratorRuntime.wrap(function(_context61){for(;;)switch(_context61.prev=_context61.next){case 0:if(b=this.db.batch(),state=this.state.clone(),tip.height<state.height)for(;state.height!==tip.height;)b.del(layout.h.build(state.height)),state.height-=1;else tip.height>state.height&&(assert(tip.height===state.height+1,"Bad chain sync."),state.height+=1);return tip.height<state.startHeight&&(state.startHeight=tip.height,state.startHash=tip.hash,state.marked=!1),b.put(layout.h.build(tip.height),tip.toHash()),b.put(layout.R.build(),state.toRaw()),_context61.next=8,b.write();case 8:this.state=state,this.height=state.height;case 10:case"end":return _context61.stop()}},_callee61,this)}));return function(_x64){return _ref72.apply(this,arguments)}}(),WalletDB.prototype.markState=function(){var _ref73=_asyncToGenerator(regeneratorRuntime.mark(function _callee62(block){var state,b;return regeneratorRuntime.wrap(function(_context62){for(;;)switch(_context62.prev=_context62.next){case 0:return(state=this.state.clone()).startHeight=block.height,state.startHash=block.hash,state.marked=!0,(b=this.db.batch()).put(layout.R.build(),state.toRaw()),_context62.next=8,b.write();case 8:this.state=state,this.height=state.height;case 10:case"end":return _context62.stop()}},_callee62,this)}));return function(_x65){return _ref73.apply(this,arguments)}}(),WalletDB.prototype.getMap=function(){var _ref74=_asyncToGenerator(regeneratorRuntime.mark(function _callee63(key){var data;return regeneratorRuntime.wrap(function(_context63){for(;;)switch(_context63.prev=_context63.next){case 0:return _context63.next=2,this.db.get(key);case 2:if(data=_context63.sent){_context63.next=5;break}return _context63.abrupt("return",null);case 5:return _context63.abrupt("return",MapRecord.fromRaw(data));case 6:case"end":return _context63.stop()}},_callee63,this)}));return function(_x66){return _ref74.apply(this,arguments)}}(),WalletDB.prototype.addMap=function(){var _ref75=_asyncToGenerator(regeneratorRuntime.mark(function _callee64(b,key,wid){var data,map,len,bw;return regeneratorRuntime.wrap(function(_context64){for(;;)switch(_context64.prev=_context64.next){case 0:return _context64.next=2,this.db.get(key);case 2:if(data=_context64.sent){_context64.next=8;break}return(map=new MapRecord).add(wid),b.put(key,map.toRaw()),_context64.abrupt("return");case 8:assert(data.length>=4),len=data.readUInt32LE(0,!0),(bw=bio.write(data.length+4)).writeU32(len+1),bw.copy(data,4,data.length),bw.writeU32(wid),b.put(key,bw.render());case 15:case"end":return _context64.stop()}},_callee64,this)}));return function(_x67,_x68,_x69){return _ref75.apply(this,arguments)}}(),WalletDB.prototype.removeMap=function(){var _ref76=_asyncToGenerator(regeneratorRuntime.mark(function _callee65(b,key,wid){var map;return regeneratorRuntime.wrap(function(_context65){for(;;)switch(_context65.prev=_context65.next){case 0:return _context65.next=2,this.getMap(key);case 2:if(map=_context65.sent){_context65.next=5;break}return _context65.abrupt("return");case 5:if(map.remove(wid)){_context65.next=7;break}return _context65.abrupt("return");case 7:if(0!==map.size){_context65.next=10;break}return b.del(key),_context65.abrupt("return");case 10:b.put(key,map.toRaw());case 11:case"end":return _context65.stop()}},_callee65,this)}));return function(_x70,_x71,_x72){return _ref76.apply(this,arguments)}}(),WalletDB.prototype.getPathMap=function(){var _ref77=_asyncToGenerator(regeneratorRuntime.mark(function _callee66(hash){return regeneratorRuntime.wrap(function(_context66){for(;;)switch(_context66.prev=_context66.next){case 0:return _context66.abrupt("return",this.getMap(layout.p.build(hash)));case 1:case"end":return _context66.stop()}},_callee66,this)}));return function(_x73){return _ref77.apply(this,arguments)}}(),WalletDB.prototype.addPathMap=function(){var _ref78=_asyncToGenerator(regeneratorRuntime.mark(function _callee67(b,hash,wid){return regeneratorRuntime.wrap(function(_context67){for(;;)switch(_context67.prev=_context67.next){case 0:return _context67.next=2,this.addHash(hash);case 2:return _context67.abrupt("return",this.addMap(b,layout.p.build(hash),wid));case 3:case"end":return _context67.stop()}},_callee67,this)}));return function(_x74,_x75,_x76){return _ref78.apply(this,arguments)}}(),WalletDB.prototype.removePathMap=function(){var _ref79=_asyncToGenerator(regeneratorRuntime.mark(function _callee68(b,hash,wid){return regeneratorRuntime.wrap(function(_context68){for(;;)switch(_context68.prev=_context68.next){case 0:return _context68.abrupt("return",this.removeMap(b,layout.p.build(hash),wid));case 1:case"end":return _context68.stop()}},_callee68,this)}));return function(_x77,_x78,_x79){return _ref79.apply(this,arguments)}}(),WalletDB.prototype.getBlockMap=function(){var _ref80=_asyncToGenerator(regeneratorRuntime.mark(function _callee69(height){return regeneratorRuntime.wrap(function(_context69){for(;;)switch(_context69.prev=_context69.next){case 0:return _context69.abrupt("return",this.getMap(layout.b.build(height)));case 1:case"end":return _context69.stop()}},_callee69,this)}));return function(_x80){return _ref80.apply(this,arguments)}}(),WalletDB.prototype.addBlockMap=function(){var _ref81=_asyncToGenerator(regeneratorRuntime.mark(function _callee70(b,height,wid){return regeneratorRuntime.wrap(function(_context70){for(;;)switch(_context70.prev=_context70.next){case 0:return _context70.abrupt("return",this.addMap(b,layout.b.build(height),wid));case 1:case"end":return _context70.stop()}},_callee70,this)}));return function(_x81,_x82,_x83){return _ref81.apply(this,arguments)}}(),WalletDB.prototype.removeBlockMap=function(){var _ref82=_asyncToGenerator(regeneratorRuntime.mark(function _callee71(b,height,wid){return regeneratorRuntime.wrap(function(_context71){for(;;)switch(_context71.prev=_context71.next){case 0:return _context71.abrupt("return",this.removeMap(b,layout.b.build(height),wid));case 1:case"end":return _context71.stop()}},_callee71,this)}));return function(_x84,_x85,_x86){return _ref82.apply(this,arguments)}}(),WalletDB.prototype.getTXMap=function(){var _ref83=_asyncToGenerator(regeneratorRuntime.mark(function _callee72(hash){return regeneratorRuntime.wrap(function(_context72){for(;;)switch(_context72.prev=_context72.next){case 0:return _context72.abrupt("return",this.getMap(layout.T.build(hash)));case 1:case"end":return _context72.stop()}},_callee72,this)}));return function(_x87){return _ref83.apply(this,arguments)}}(),WalletDB.prototype.addTXMap=function(){var _ref84=_asyncToGenerator(regeneratorRuntime.mark(function _callee73(b,hash,wid){return regeneratorRuntime.wrap(function(_context73){for(;;)switch(_context73.prev=_context73.next){case 0:return _context73.abrupt("return",this.addMap(b,layout.T.build(hash),wid));case 1:case"end":return _context73.stop()}},_callee73,this)}));return function(_x88,_x89,_x90){return _ref84.apply(this,arguments)}}(),WalletDB.prototype.removeTXMap=function(){var _ref85=_asyncToGenerator(regeneratorRuntime.mark(function _callee74(b,hash,wid){return regeneratorRuntime.wrap(function(_context74){for(;;)switch(_context74.prev=_context74.next){case 0:return _context74.abrupt("return",this.removeMap(b,layout.T.build(hash),wid));case 1:case"end":return _context74.stop()}},_callee74,this)}));return function(_x91,_x92,_x93){return _ref85.apply(this,arguments)}}(),WalletDB.prototype.getOutpointMap=function(){var _ref86=_asyncToGenerator(regeneratorRuntime.mark(function _callee75(hash,index){return regeneratorRuntime.wrap(function(_context75){for(;;)switch(_context75.prev=_context75.next){case 0:return _context75.abrupt("return",this.getMap(layout.o.build(hash,index)));case 1:case"end":return _context75.stop()}},_callee75,this)}));return function(_x94,_x95){return _ref86.apply(this,arguments)}}(),WalletDB.prototype.addOutpointMap=function(){var _ref87=_asyncToGenerator(regeneratorRuntime.mark(function _callee76(b,hash,index,wid){return regeneratorRuntime.wrap(function(_context76){for(;;)switch(_context76.prev=_context76.next){case 0:return _context76.next=2,this.addOutpoint(hash,index);case 2:return _context76.abrupt("return",this.addMap(b,layout.o.build(hash,index),wid));case 3:case"end":return _context76.stop()}},_callee76,this)}));return function(_x96,_x97,_x98,_x99){return _ref87.apply(this,arguments)}}(),WalletDB.prototype.removeOutpointMap=function(){var _ref88=_asyncToGenerator(regeneratorRuntime.mark(function _callee77(b,hash,index,wid){return regeneratorRuntime.wrap(function(_context77){for(;;)switch(_context77.prev=_context77.next){case 0:return _context77.abrupt("return",this.removeMap(b,layout.o.build(hash,index),wid));case 1:case"end":return _context77.stop()}},_callee77,this)}));return function(_x100,_x101,_x102,_x103){return _ref88.apply(this,arguments)}}(),WalletDB.prototype.getBlock=function(){var _ref89=_asyncToGenerator(regeneratorRuntime.mark(function _callee78(height){var data,block;return regeneratorRuntime.wrap(function(_context78){for(;;)switch(_context78.prev=_context78.next){case 0:return _context78.next=2,this.db.get(layout.h.build(height));case 2:if(data=_context78.sent){_context78.next=5;break}return _context78.abrupt("return",null);case 5:return(block=new BlockMeta).hash=data.toString("hex"),block.height=height,_context78.abrupt("return",block);case 9:case"end":return _context78.stop()}},_callee78,this)}));return function(_x104){return _ref89.apply(this,arguments)}}(),WalletDB.prototype.getTip=function(){var _ref90=_asyncToGenerator(regeneratorRuntime.mark(function _callee79(){var tip;return regeneratorRuntime.wrap(function(_context79){for(;;)switch(_context79.prev=_context79.next){case 0:return _context79.next=2,this.getBlock(this.state.height);case 2:if(tip=_context79.sent){_context79.next=5;break}throw new Error("WDB: Tip not found!");case 5:return _context79.abrupt("return",tip);case 6:case"end":return _context79.stop()}},_callee79,this)}));return function(){return _ref90.apply(this,arguments)}}(),WalletDB.prototype.rollback=function(){var _ref91=_asyncToGenerator(regeneratorRuntime.mark(function _callee80(height){var tip;return regeneratorRuntime.wrap(function(_context80){for(;;)switch(_context80.prev=_context80.next){case 0:if(!(height>this.state.height)){_context80.next=2;break}throw new Error("WDB: Cannot rollback to the future.");case 2:if(height!==this.state.height){_context80.next=5;break}return this.logger.info("Rolled back to same height (%d).",height),_context80.abrupt("return");case 5:return this.logger.info("Rolling back %d WalletDB blocks to height %d.",this.state.height-height,height),_context80.next=8,this.getBlock(height);case 8:return tip=_context80.sent,assert(tip),_context80.next=12,this.revert(tip.height);case 12:return _context80.next=14,this.setTip(tip);case 14:case"end":return _context80.stop()}},_callee80,this)}));return function(_x105){return _ref91.apply(this,arguments)}}(),WalletDB.prototype.revert=function(){var _ref92=_asyncToGenerator(regeneratorRuntime.mark(function _callee82(target){var iter,total,_this5=this;return regeneratorRuntime.wrap(function(_context82){for(;;)switch(_context82.prev=_context82.next){case 0:return iter=this.db.iterator({gte:layout.b.build(target+1),lte:layout.b.max(),reverse:!0,values:!0}),total=0,_context82.next=4,iter.each(function(){var _ref93=_asyncToGenerator(regeneratorRuntime.mark(function _callee81(key,value){var height,block,_iterator10,_isArray10,_i10,_ref94,wid,wallet;return regeneratorRuntime.wrap(function(_context81){for(;;)switch(_context81.prev=_context81.next){case 0:height=layout.b.parse(key),block=MapRecord.fromRaw(value),_iterator10=block.wids,_isArray10=Array.isArray(_iterator10),_i10=0,_iterator10=_isArray10?_iterator10:_iterator10[Symbol.iterator]();case 3:if(!_isArray10){_context81.next=9;break}if(!(_i10>=_iterator10.length)){_context81.next=6;break}return _context81.abrupt("break",23);case 6:_ref94=_iterator10[_i10++],_context81.next=13;break;case 9:if(!(_i10=_iterator10.next()).done){_context81.next=12;break}return _context81.abrupt("break",23);case 12:_ref94=_i10.value;case 13:return wid=_ref94,_context81.next=16,_this5.get(wid);case 16:return wallet=_context81.sent,assert(wallet),_context81.next=20,wallet.revert(height);case 20:total+=_context81.sent;case 21:_context81.next=3;break;case 23:case"end":return _context81.stop()}},_callee81,_this5)}));return function(_x107,_x108){return _ref93.apply(this,arguments)}}());case 4:this.logger.info("Rolled back %d WalletDB transactions.",total);case 5:case"end":return _context82.stop()}},_callee82,this)}));return function(_x106){return _ref92.apply(this,arguments)}}(),WalletDB.prototype.addBlock=function(){var _ref95=_asyncToGenerator(regeneratorRuntime.mark(function _callee83(entry,txs){var unlock;return regeneratorRuntime.wrap(function(_context83){for(;;)switch(_context83.prev=_context83.next){case 0:return _context83.next=2,this.txLock.lock();case 2:return unlock=_context83.sent,_context83.prev=3,_context83.next=6,this._addBlock(entry,txs);case 6:return _context83.abrupt("return",_context83.sent);case 7:return _context83.prev=7,unlock(),_context83.finish(7);case 10:case"end":return _context83.stop()}},_callee83,this,[[3,,7,10]])}));return function(_x109,_x110){return _ref95.apply(this,arguments)}}(),WalletDB.prototype._addBlock=function(){var _ref96=_asyncToGenerator(regeneratorRuntime.mark(function _callee84(entry,txs){var tip,total,_iterator11,_isArray11,_i11,_ref97,tx;return regeneratorRuntime.wrap(function(_context84){for(;;)switch(_context84.prev=_context84.next){case 0:if(!((tip=BlockMeta.fromEntry(entry)).height<this.state.height)){_context84.next=4;break}return this.logger.warning("WalletDB is connecting low blocks (%d).",tip.height),_context84.abrupt("return",0);case 4:if(tip.height>=this.network.block.slowHeight&&this.logger.debug("Adding block: %d.",tip.height),tip.height!==this.state.height){_context84.next=9;break}this.logger.warning("Already saw WalletDB block (%d).",tip.height),_context84.next=13;break;case 9:if(tip.height===this.state.height+1){_context84.next=13;break}return _context84.next=12,this.scan(this.state.height);case 12:return _context84.abrupt("return",0);case 13:return _context84.next=15,this.setTip(tip);case 15:if(!this.options.checkpoints||this.state.marked){_context84.next=18;break}if(!(tip.height<=this.network.lastCheckpoint)){_context84.next=18;break}return _context84.abrupt("return",0);case 18:total=0,_iterator11=txs,_isArray11=Array.isArray(_iterator11),_i11=0,_iterator11=_isArray11?_iterator11:_iterator11[Symbol.iterator]();case 20:if(!_isArray11){_context84.next=26;break}if(!(_i11>=_iterator11.length)){_context84.next=23;break}return _context84.abrupt("break",37);case 23:_ref97=_iterator11[_i11++],_context84.next=30;break;case 26:if(!(_i11=_iterator11.next()).done){_context84.next=29;break}return _context84.abrupt("break",37);case 29:_ref97=_i11.value;case 30:return tx=_ref97,_context84.next=33,this._addTX(tx,tip);case 33:if(!_context84.sent){_context84.next=35;break}total+=1;case 35:_context84.next=20;break;case 37:return total>0&&this.logger.info("Connected WalletDB block %s (tx=%d).",util.revHex(tip.hash),total),_context84.abrupt("return",total);case 39:case"end":return _context84.stop()}},_callee84,this)}));return function(_x111,_x112){return _ref96.apply(this,arguments)}}(),WalletDB.prototype.removeBlock=function(){var _ref98=_asyncToGenerator(regeneratorRuntime.mark(function _callee85(entry){var unlock;return regeneratorRuntime.wrap(function(_context85){for(;;)switch(_context85.prev=_context85.next){case 0:return _context85.next=2,this.txLock.lock();case 2:return unlock=_context85.sent,_context85.prev=3,_context85.next=6,this._removeBlock(entry);case 6:return _context85.abrupt("return",_context85.sent);case 7:return _context85.prev=7,unlock(),_context85.finish(7);case 10:case"end":return _context85.stop()}},_callee85,this,[[3,,7,10]])}));return function(_x113){return _ref98.apply(this,arguments)}}(),WalletDB.prototype._removeBlock=function(){var _ref99=_asyncToGenerator(regeneratorRuntime.mark(function _callee86(entry){var tip,prev,map,total,_iterator12,_isArray12,_i12,_ref100,wid,wallet;return regeneratorRuntime.wrap(function(_context86){for(;;)switch(_context86.prev=_context86.next){case 0:if(0!==(tip=BlockMeta.fromEntry(entry)).height){_context86.next=3;break}throw new Error("WDB: Bad disconnection (genesis block).");case 3:if(!(tip.height>this.state.height)){_context86.next=6;break}return this.logger.warning("WalletDB is disconnecting high blocks (%d).",tip.height),_context86.abrupt("return",0);case 6:if(tip.height===this.state.height){_context86.next=8;break}throw new Error("WDB: Bad disconnection (height mismatch).");case 8:return _context86.next=10,this.getBlock(tip.height-1);case 10:return prev=_context86.sent,assert(prev),_context86.next=14,this.getBlockMap(tip.height);case 14:if(map=_context86.sent){_context86.next=19;break}return _context86.next=18,this.setTip(prev);case 18:return _context86.abrupt("return",0);case 19:total=0,_iterator12=map.wids,_isArray12=Array.isArray(_iterator12),_i12=0,_iterator12=_isArray12?_iterator12:_iterator12[Symbol.iterator]();case 21:if(!_isArray12){_context86.next=27;break}if(!(_i12>=_iterator12.length)){_context86.next=24;break}return _context86.abrupt("break",41);case 24:_ref100=_iterator12[_i12++],_context86.next=31;break;case 27:if(!(_i12=_iterator12.next()).done){_context86.next=30;break}return _context86.abrupt("break",41);case 30:_ref100=_i12.value;case 31:return wid=_ref100,_context86.next=34,this.get(wid);case 34:return wallet=_context86.sent,assert(wallet),_context86.next=38,wallet.revert(tip.height);case 38:total+=_context86.sent;case 39:_context86.next=21;break;case 41:return _context86.next=43,this.setTip(prev);case 43:return this.logger.warning("Disconnected wallet block %s (tx=%d).",util.revHex(tip.hash),total),_context86.abrupt("return",total);case 45:case"end":return _context86.stop()}},_callee86,this)}));return function(_x114){return _ref99.apply(this,arguments)}}(),WalletDB.prototype.rescanBlock=function(){var _ref101=_asyncToGenerator(regeneratorRuntime.mark(function _callee87(entry,txs){return regeneratorRuntime.wrap(function(_context87){for(;;)switch(_context87.prev=_context87.next){case 0:if(this.rescanning){_context87.next=3;break}return this.logger.warning("Unsolicited rescan block: %d.",entry.height),_context87.abrupt("return");case 3:if(!(entry.height>this.state.height+1)){_context87.next=6;break}return this.logger.warning("Rescan block too high: %d.",entry.height),_context87.abrupt("return");case 6:return _context87.prev=6,_context87.next=9,this._addBlock(entry,txs);case 9:_context87.next=15;break;case 11:throw _context87.prev=11,_context87.t0=_context87.catch(6),this.emit("error",_context87.t0),_context87.t0;case 15:case"end":return _context87.stop()}},_callee87,this,[[6,11]])}));return function(_x115,_x116){return _ref101.apply(this,arguments)}}(),WalletDB.prototype.addTX=function(){var _ref102=_asyncToGenerator(regeneratorRuntime.mark(function _callee88(tx){var unlock;return regeneratorRuntime.wrap(function(_context88){for(;;)switch(_context88.prev=_context88.next){case 0:return _context88.next=2,this.txLock.lock();case 2:return unlock=_context88.sent,_context88.prev=3,_context88.next=6,this._addTX(tx);case 6:return _context88.abrupt("return",_context88.sent);case 7:return _context88.prev=7,unlock(),_context88.finish(7);case 10:case"end":return _context88.stop()}},_callee88,this,[[3,,7,10]])}));return function(_x117){return _ref102.apply(this,arguments)}}(),WalletDB.prototype._addTX=function(){var _ref103=_asyncToGenerator(regeneratorRuntime.mark(function _callee89(tx,block){var wids,result,_iterator13,_isArray13,_i13,_ref104,wid,wallet;return regeneratorRuntime.wrap(function(_context89){for(;;)switch(_context89.prev=_context89.next){case 0:return _context89.next=2,this.getWalletsByTX(tx);case 2:if(wids=_context89.sent,assert(!tx.mutable,"WDB: Cannot add mutable TX."),wids){_context89.next=6;break}return _context89.abrupt("return",null);case 6:if(!block||this.state.marked){_context89.next=9;break}return _context89.next=9,this.markState(block);case 9:this.logger.info("Incoming transaction for %d wallets in WalletDB (%s).",wids.size,tx.txid()),result=!1,_iterator13=wids,_isArray13=Array.isArray(_iterator13),_i13=0,_iterator13=_isArray13?_iterator13:_iterator13[Symbol.iterator]();case 12:if(!_isArray13){_context89.next=18;break}if(!(_i13>=_iterator13.length)){_context89.next=15;break}return _context89.abrupt("break",34);case 15:_ref104=_iterator13[_i13++],_context89.next=22;break;case 18:if(!(_i13=_iterator13.next()).done){_context89.next=21;break}return _context89.abrupt("break",34);case 21:_ref104=_i13.value;case 22:return wid=_ref104,_context89.next=25,this.get(wid);case 25:return wallet=_context89.sent,assert(wallet),_context89.next=29,wallet.add(tx,block);case 29:if(!_context89.sent){_context89.next=32;break}this.logger.info("Added transaction to wallet in WalletDB: %s (%d).",wallet.id,wid),result=!0;case 32:_context89.next=12;break;case 34:if(result){_context89.next=36;break}return _context89.abrupt("return",null);case 36:return _context89.abrupt("return",wids);case 37:case"end":return _context89.stop()}},_callee89,this)}));return function(_x118,_x119){return _ref103.apply(this,arguments)}}(),WalletDB.prototype.resetChain=function(){var _ref105=_asyncToGenerator(regeneratorRuntime.mark(function _callee90(entry){var unlock;return regeneratorRuntime.wrap(function(_context90){for(;;)switch(_context90.prev=_context90.next){case 0:return _context90.next=2,this.txLock.lock();case 2:return unlock=_context90.sent,_context90.prev=3,_context90.next=6,this._resetChain(entry);case 6:return _context90.abrupt("return",_context90.sent);case 7:return _context90.prev=7,unlock(),_context90.finish(7);case 10:case"end":return _context90.stop()}},_callee90,this,[[3,,7,10]])}));return function(_x120){return _ref105.apply(this,arguments)}}(),WalletDB.prototype._resetChain=function(){var _ref106=_asyncToGenerator(regeneratorRuntime.mark(function _callee91(entry){return regeneratorRuntime.wrap(function(_context91){for(;;)switch(_context91.prev=_context91.next){case 0:if(!(entry.height>this.state.height)){_context91.next=2;break}throw new Error("WDB: Bad reset height.");case 2:return _context91.abrupt("return",this.rollback(entry.height));case 3:case"end":return _context91.stop()}},_callee91,this)}));return function(_x121){return _ref106.apply(this,arguments)}}(),WalletDB}(EventEmitter),WalletOptions=function(){function WalletOptions(options){_classCallCheck(this,WalletOptions),this.network=Network.primary,this.logger=Logger.global,this.workers=null,this.client=null,this.feeRate=0,this.prefix=null,this.location=null,this.memory=!0,this.maxFiles=64,this.cacheSize=16<<20,this.compression=!0,this.spv=!1,this.witness=!1,this.checkpoints=!1,this.wipeNoReally=!1,options&&this.fromOptions(options)}return WalletOptions.prototype.fromOptions=function(options){return null!=options.network&&(this.network=Network.get(options.network)),null!=options.logger&&(assert("object"===_typeof(options.logger)),this.logger=options.logger),null!=options.workers&&(assert("object"===_typeof(options.workers)),this.workers=options.workers),null!=options.client&&(assert("object"===_typeof(options.client)),this.client=options.client),null!=options.feeRate&&(assert(options.feeRate>>>0===options.feeRate),this.feeRate=options.feeRate),null!=options.prefix&&(assert("string"==typeof options.prefix),this.prefix=options.prefix,this.location=path.join(this.prefix,"wallet")),null!=options.location&&(assert("string"==typeof options.location),this.location=options.location),null!=options.memory&&(assert("boolean"==typeof options.memory),this.memory=options.memory),null!=options.maxFiles&&(assert(options.maxFiles>>>0===options.maxFiles),this.maxFiles=options.maxFiles),null!=options.cacheSize&&(assert(Number.isSafeInteger(options.cacheSize)&&options.cacheSize>=0),this.cacheSize=options.cacheSize),null!=options.compression&&(assert("boolean"==typeof options.compression),this.compression=options.compression),null!=options.spv&&(assert("boolean"==typeof options.spv),this.spv=options.spv),null!=options.witness&&(assert("boolean"==typeof options.witness),this.witness=options.witness),null!=options.checkpoints&&(assert("boolean"==typeof options.checkpoints),this.checkpoints=options.checkpoints),null!=options.wipeNoReally&&(assert("boolean"==typeof options.wipeNoReally),this.wipeNoReally=options.wipeNoReally),this},WalletOptions.fromOptions=function(options){return(new this).fromOptions(options)},WalletOptions}();function fromU32(num){var data=Buffer.allocUnsafe(4);return data.writeUInt32LE(num,0,!0),data}function fromString(str){var buf=Buffer.alloc(1+str.length);return buf[0]=str.length,buf.write(str,1,str.length,"ascii"),buf}function toString(buf){return assert(buf.length>0),assert(buf[0]===buf.length-1),buf.toString("ascii",1,buf.length)}module.exports=WalletDB}).call(this,require("buffer").Buffer)},{"../primitives/outpoint":80,"../protocol/network":87,"../utils/util":106,"./account":107,"./common":109,"./layout":112,"./nullclient":116,"./path":117,"./records":119,"./wallet":122,assert:146,"bcrypto/lib/aes":155,"bcrypto/lib/ccmp":156,bdb:191,bfilter:203,blgr:211,bmutex:214,buffer:269,bufio:270,events:334,path:367}],124:[function(require,module,exports){"use strict";var Address=require("../primitives/address"),KeyRing=require("../primitives/keyring"),Path=require("./path"),WalletKey=function(_KeyRing){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(WalletKey,_KeyRing);function WalletKey(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,WalletKey);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_KeyRing.call(this,options));return _this.keyType=Path.types.HD,_this.name=null,_this.account=-1,_this.branch=-1,_this.index=-1,_this}return WalletKey.prototype.toJSON=function(network){return{name:this.name,account:this.account,branch:this.branch,index:this.index,witness:this.witness,nested:this.nested,publicKey:this.publicKey.toString("hex"),script:this.script?this.script.toRaw().toString("hex"):null,program:this.witness?this.getProgram().toRaw().toString("hex"):null,type:Address.typesByVal[this.getType()].toLowerCase(),address:this.getAddress("string",network)}},WalletKey.prototype.fromHD=function(account,key,branch,index){return this.keyType=Path.types.HD,this.name=account.name,this.account=account.accountIndex,this.branch=branch,this.index=index,this.witness=account.witness,this.nested=2===branch,key.privateKey?this.fromPrivate(key.privateKey):this.fromPublic(key.publicKey)},WalletKey.fromHD=function(account,key,branch,index){return(new this).fromHD(account,key,branch,index)},WalletKey.prototype.fromImport=function(account,data){return this.keyType=Path.types.KEY,this.name=account.name,this.account=account.accountIndex,this.witness=account.witness,this.fromRaw(data)},WalletKey.fromImport=function(account,data){return(new this).fromImport(account,data)},WalletKey.prototype.fromRing=function(account,ring){return this.keyType=Path.types.KEY,this.name=account.name,this.account=account.accountIndex,this.witness=account.witness,this.fromOptions(ring)},WalletKey.fromRing=function(account,ring){return(new this).fromRing(account,ring)},WalletKey.prototype.toPath=function(){var path=new Path;switch(path.name=this.name,path.account=this.account,this.keyType){case Path.types.HD:path.branch=this.branch,path.index=this.index;break;case Path.types.KEY:path.data=this.toRaw()}return path.keyType=this.keyType,path.version=this.getVersion(),path.type=this.getType(),path.hash=this.getHash("hex"),path},WalletKey.isWalletKey=function(obj){return obj instanceof WalletKey},WalletKey}(KeyRing);module.exports=WalletKey},{"../primitives/address":69,"../primitives/keyring":76,"./path":117}],125:[function(require,module,exports){(function(global,Buffer){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var assert=require("assert"),Child=function(_EventEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Child,_EventEmitter);function Child(file){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Child);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return _this.init(file),_this}return Child.hasSupport=function(){return"function"==typeof global.postMessage},Child.prototype.init=function(file){var _this2=this;this.child=new global.Worker(file),this.child.onerror=function(event){_this2.emit("error",new Error("Child error.")),_this2.emit("exit",1,null)},this.child.onmessage=function(event){var data=void 0;"string"==typeof event.data?(data=Buffer.from(event.data,"hex"),assert(data.length===event.data.length/2)):(assert(event.data&&"object"===_typeof(event.data)),assert(event.data.data&&"number"==typeof event.data.data.length),(data=event.data.data).__proto__=Buffer.prototype),_this2.emit("data",data)}},Child.prototype.write=function(data){return 2===this.child.postMessage.length?(data.__proto__=Uint8Array.prototype,this.child.postMessage({data:data},[data])):this.child.postMessage(data.toString("hex")),!0},Child.prototype.destroy=function(){this.child.terminate(),this.emit("exit",143,"SIGTERM")},Child}(require("events"));module.exports=Child}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},require("buffer").Buffer)},{assert:146,buffer:269,events:334}],126:[function(require,module,exports){"use strict";var bio=require("bufio"),Framer=function(){function Framer(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Framer)}return Framer.prototype.packet=function(payload){var size=10+payload.getSize(),bw=bio.write(size);bw.writeU32(payload.id),bw.writeU8(payload.cmd),bw.seek(4),payload.toWriter(bw),bw.writeU8(10);var msg=bw.render();return msg.writeUInt32LE(msg.length-10,5,!0),msg},Framer}();module.exports=Framer},{bufio:270}],127:[function(require,module,exports){"use strict";exports.Framer=require("./framer"),exports.jobs=require("./jobs"),exports.packets=require("./packets"),exports.Parser=require("./parser"),exports.WorkerPool=require("./workerpool")},{"./framer":126,"./jobs":128,"./packets":129,"./parser":130,"./workerpool":131}],128:[function(require,module,exports){"use strict";var secp256k1=require("bcrypto/lib/secp256k1"),derive=require("bcrypto/lib/scrypt").derive,hashcash=require("../mining/mine"),packets=require("./packets"),jobs=exports;jobs.execute=function(p){try{return jobs.handle(p)}catch(e){return new packets.ErrorResultPacket(e)}},jobs.handle=function(p){switch(p.cmd){case packets.types.CHECK:return jobs.check(p.tx,p.view,p.flags);case packets.types.CHECKINPUT:return jobs.checkInput(p.tx,p.index,p.coin,p.flags);case packets.types.SIGN:return jobs.sign(p.tx,p.rings,p.type);case packets.types.SIGNINPUT:return jobs.signInput(p.tx,p.index,p.coin,p.ring,p.type);case packets.types.ECVERIFY:return jobs.ecVerify(p.msg,p.sig,p.key);case packets.types.ECSIGN:return jobs.ecSign(p.msg,p.key);case packets.types.MINE:return jobs.mine(p.data,p.target,p.min,p.max);case packets.types.SCRYPT:return jobs.scrypt(p.passwd,p.salt,p.N,p.r,p.p,p.len);default:throw new Error('Unknown command: "'+p.cmd+'".')}},jobs.check=function(tx,view,flags){try{tx.check(view,flags)}catch(err){if("ScriptError"===err.type)return new packets.CheckResultPacket(err);throw err}return new packets.CheckResultPacket},jobs.checkInput=function(tx,index,coin,flags){try{tx.checkInput(index,coin,flags)}catch(err){if("ScriptError"===err.type)return new packets.CheckInputResultPacket(err);throw err}return new packets.CheckInputResultPacket},jobs.sign=function(tx,ring,type){var total=tx.sign(ring,type);return packets.SignResultPacket.fromTX(tx,total)},jobs.signInput=function(tx,index,coin,ring,type){var result=tx.signInput(tx,index,coin,ring,type);return packets.SignInputResultPacket.fromTX(tx,index,result)},jobs.ecVerify=function(msg,sig,key){var result=secp256k1.verify(msg,sig,key);return new packets.ECVerifyResultPacket(result)},jobs.ecSign=function(msg,key){var sig=secp256k1.sign(msg,key);return new packets.ECSignResultPacket(sig)},jobs.mine=function(data,target,min,max){var nonce=hashcash(data,target,min,max);return new packets.MineResultPacket(nonce)},jobs.scrypt=function(passwd,salt,N,r,p,len){var key=derive(passwd,salt,N,r,p,len);return new packets.ScryptResultPacket(key)}},{"../mining/mine":43,"./packets":129,"bcrypto/lib/scrypt":182,"bcrypto/lib/secp256k1":184}],129:[function(require,module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),bio=require("bufio"),Script=require("../script/script"),Output=require("../primitives/output"),MTX=require("../primitives/mtx"),TX=require("../primitives/tx"),KeyRing=require("../primitives/keyring"),CoinView=require("../coins/coinview"),ScriptError=require("../script/scripterror"),encoding=bio.encoding,packetTypes={ENV:0,EVENT:1,LOG:2,ERROR:3,ERRORRESULT:4,CHECK:5,CHECKRESULT:6,SIGN:7,SIGNRESULT:8,CHECKINPUT:9,CHECKINPUTRESULT:10,SIGNINPUT:11,SIGNINPUTRESULT:12,ECVERIFY:13,ECVERIFYRESULT:14,ECSIGN:15,ECSIGNRESULT:16,MINE:17,MINERESULT:18,SCRYPT:19,SCRYPTRESULT:20},Packet=function(){function Packet(){_classCallCheck(this,Packet),this.id=++Packet.id>>>0,this.cmd=-1}return Packet.prototype.getSize=function(){throw new Error("Abstract method.")},Packet.prototype.toWriter=function(){throw new Error("Abstract method.")},Packet.prototype.fromRaw=function(){throw new Error("Abstract method.")},Packet.fromRaw=function(){throw new Error("Abstract method.")},Packet}();Packet.id=0;var EnvPacket=function(_Packet){_inherits(EnvPacket,_Packet);function EnvPacket(env){_classCallCheck(this,EnvPacket);var _this=_possibleConstructorReturn(this,_Packet.call(this));return _this.cmd=packetTypes.ENV,_this.env=env||{},_this.json=JSON.stringify(_this.env),_this}return EnvPacket.prototype.getSize=function(){return encoding.sizeVarString(this.json,"utf8")},EnvPacket.prototype.toWriter=function(bw){return bw.writeVarString(this.json,"utf8"),bw},EnvPacket.prototype.fromRaw=function(data){var br=bio.read(data,!0);return this.json=br.readVarString("utf8"),this.env=JSON.parse(this.json),this},EnvPacket.fromRaw=function(data){return(new EnvPacket).fromRaw(data)},EnvPacket}(Packet),EventPacket=function(_Packet2){_inherits(EventPacket,_Packet2);function EventPacket(items){_classCallCheck(this,EventPacket);var _this2=_possibleConstructorReturn(this,_Packet2.call(this));return _this2.cmd=packetTypes.EVENT,_this2.items=items||[],_this2.json=JSON.stringify(_this2.items),_this2}return EventPacket.prototype.getSize=function(){return encoding.sizeVarString(this.json,"utf8")},EventPacket.prototype.toWriter=function(bw){return bw.writeVarString(this.json,"utf8"),bw},EventPacket.prototype.fromRaw=function(data){var br=bio.read(data,!0);return this.json=br.readVarString("utf8"),this.items=JSON.parse(this.json),this},EventPacket.fromRaw=function(data){return(new EventPacket).fromRaw(data)},EventPacket}(Packet),LogPacket=function(_Packet3){_inherits(LogPacket,_Packet3);function LogPacket(text){_classCallCheck(this,LogPacket);var _this3=_possibleConstructorReturn(this,_Packet3.call(this));return _this3.cmd=packetTypes.LOG,_this3.text=text||"",_this3}return LogPacket.prototype.getSize=function(){return encoding.sizeVarString(this.text,"utf8")},LogPacket.prototype.toWriter=function(bw){return bw.writeVarString(this.text,"utf8"),bw},LogPacket.prototype.fromRaw=function(data){var br=bio.read(data,!0);return this.text=br.readVarString("utf8"),this},LogPacket.fromRaw=function(data){return(new LogPacket).fromRaw(data)},LogPacket}(Packet),ErrorPacket=function(_Packet4){_inherits(ErrorPacket,_Packet4);function ErrorPacket(error){_classCallCheck(this,ErrorPacket);var _this4=_possibleConstructorReturn(this,_Packet4.call(this));return _this4.cmd=packetTypes.ERROR,_this4.error=error||new Error,_this4}return ErrorPacket.prototype.getSize=function(){var err=this.error,size=0;switch(size+=encoding.sizeVarString(stringify(err.message),"utf8"),size+=encoding.sizeVarString(stringify(err.stack),"utf8"),size+=encoding.sizeVarString(stringify(err.type),"utf8"),_typeof(err.code)){case"number":size+=1,size+=4;break;case"string":size+=1,size+=encoding.sizeVarString(err.code,"utf8");break;default:size+=1}return size},ErrorPacket.prototype.toWriter=function(bw){var err=this.error;switch(bw.writeVarString(stringify(err.message),"utf8"),bw.writeVarString(stringify(err.stack),"utf8"),bw.writeVarString(stringify(err.type),"utf8"),_typeof(err.code)){case"number":bw.writeU8(2),bw.writeI32(err.code);break;case"string":bw.writeU8(1),bw.writeVarString(err.code,"utf8");break;default:bw.writeU8(0)}return bw},ErrorPacket.prototype.fromRaw=function(data){var br=bio.read(data,!0),err=this.error;switch(err.message=br.readVarString("utf8"),err.stack=br.readVarString("utf8"),err.type=br.readVarString("utf8"),br.readU8()){case 2:err.code=br.readI32();break;case 1:err.code=br.readVarString("utf8");break;default:err.code=null}return this},ErrorPacket.fromRaw=function(data){return(new ErrorPacket).fromRaw(data)},ErrorPacket}(Packet),ErrorResultPacket=function(_ErrorPacket){_inherits(ErrorResultPacket,_ErrorPacket);function ErrorResultPacket(error){_classCallCheck(this,ErrorResultPacket);var _this5=_possibleConstructorReturn(this,_ErrorPacket.call(this,error));return _this5.cmd=packetTypes.ERRORRESULT,_this5}return ErrorResultPacket.fromRaw=function(data){return(new ErrorResultPacket).fromRaw(data)},ErrorResultPacket}(ErrorPacket),CheckPacket=function(_Packet5){_inherits(CheckPacket,_Packet5);function CheckPacket(tx,view,flags){_classCallCheck(this,CheckPacket);var _this6=_possibleConstructorReturn(this,_Packet5.call(this));return _this6.cmd=packetTypes.CHECK,_this6.tx=tx||null,_this6.view=view||null,_this6.flags=null!=flags?flags:null,_this6}return CheckPacket.prototype.getSize=function(){return this.tx.getSize()+this.view.getSize(this.tx)+4},CheckPacket.prototype.toWriter=function(bw){return this.tx.toWriter(bw),this.view.toWriter(bw,this.tx),bw.writeI32(null!=this.flags?this.flags:-1),bw},CheckPacket.prototype.fromRaw=function(data){var br=bio.read(data,!0);return this.tx=TX.fromReader(br),this.view=CoinView.fromReader(br,this.tx),this.flags=br.readI32(),-1===this.flags&&(this.flags=null),this},CheckPacket.fromRaw=function(data){return(new CheckPacket).fromRaw(data)},CheckPacket}(Packet),CheckResultPacket=function(_Packet6){_inherits(CheckResultPacket,_Packet6);function CheckResultPacket(error){_classCallCheck(this,CheckResultPacket);var _this7=_possibleConstructorReturn(this,_Packet6.call(this));return _this7.cmd=packetTypes.CHECKRESULT,_this7.error=error||null,_this7}return CheckResultPacket.prototype.getSize=function(){var err=this.error,size=0;return err?(size+=1,size+=encoding.sizeVarString(stringify(err.message),"utf8"),size+=encoding.sizeVarString(stringify(err.stack),"utf8"),size+=encoding.sizeVarString(stringify(err.code),"utf8"),size+=1,size+=4):size+=1},CheckResultPacket.prototype.toWriter=function(bw){var err=this.error;return err?(bw.writeU8(1),bw.writeVarString(stringify(err.message),"utf8"),bw.writeVarString(stringify(err.stack),"utf8"),bw.writeVarString(stringify(err.code),"utf8"),bw.writeU8(-1===err.op?255:err.op),bw.writeU32(-1===err.ip?4294967295:err.ip),bw):(bw.writeU8(0),bw)},CheckResultPacket.prototype.fromRaw=function(data){var br=bio.read(data,!0);if(0===br.readU8())return this;var err=new ScriptError("");return err.message=br.readVarString("utf8"),err.stack=br.readVarString("utf8"),err.code=br.readVarString("utf8"),err.op=br.readU8(),err.ip=br.readU32(),255===err.op&&(err.op=-1),4294967295===err.ip&&(err.ip=-1),this.error=err,this},CheckResultPacket.fromRaw=function(data){return(new CheckResultPacket).fromRaw(data)},CheckResultPacket}(Packet),SignPacket=function(_Packet7){_inherits(SignPacket,_Packet7);function SignPacket(tx,rings,type){_classCallCheck(this,SignPacket);var _this8=_possibleConstructorReturn(this,_Packet7.call(this));return _this8.cmd=packetTypes.SIGN,_this8.tx=tx||null,_this8.rings=rings||[],_this8.type=null!=type?type:1,_this8}return SignPacket.prototype.getSize=function(){var size=0;size+=this.tx.getSize(),size+=this.tx.view.getSize(this.tx),size+=encoding.sizeVarint(this.rings.length);var _iterator=this.rings,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}size+=_ref.getSize()}return size+=1},SignPacket.prototype.toWriter=function(bw){this.tx.toWriter(bw),this.tx.view.toWriter(bw,this.tx),bw.writeVarint(this.rings.length);var _iterator2=this.rings,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref2=_i2.value}_ref2.toWriter(bw)}return bw.writeU8(this.type),bw},SignPacket.prototype.fromRaw=function(data){var br=bio.read(data,!0);this.tx=MTX.fromReader(br),this.tx.view.fromReader(br,this.tx);for(var count=br.readVarint(),i=0;i<count;i++){var ring=KeyRing.fromReader(br);this.rings.push(ring)}return this.type=br.readU8(),this},SignPacket.fromRaw=function(data){return(new SignPacket).fromRaw(data)},SignPacket}(Packet),SignResultPacket=function(_Packet8){_inherits(SignResultPacket,_Packet8);function SignResultPacket(total,script){_classCallCheck(this,SignResultPacket);var _this9=_possibleConstructorReturn(this,_Packet8.call(this));return _this9.cmd=packetTypes.SIGNRESULT,_this9.total=total||0,_this9.script=script||[],_this9}return SignResultPacket.prototype.fromTX=function(tx,total){this.total=total;var _iterator3=tx.inputs,_isArray3=Array.isArray(_iterator3),_i3=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref3;if(_isArray3){if(_i3>=_iterator3.length)break;_ref3=_iterator3[_i3++]}else{if((_i3=_iterator3.next()).done)break;_ref3=_i3.value}var input=_ref3;this.script.push(input.script)}return this},SignResultPacket.fromTX=function(tx,total){return(new SignResultPacket).fromTX(tx,total)},SignResultPacket.prototype.getSize=function(){var size=0;size+=encoding.sizeVarint(this.total),size+=encoding.sizeVarint(this.script.length);for(var i=0;i<this.script.length;i++){size+=this.script[i].getVarSize()}return size},SignResultPacket.prototype.toWriter=function(bw){assert(this.script.length===this.size),bw.writeVarint(this.total),bw.writeVarint(this.script.length);for(var i=0;i<this.script.length;i++)this.script[i].toWriter(bw);return bw},SignResultPacket.prototype.inject=function(tx){assert(this.script.length===tx.inputs.length);for(var i=0;i<tx.inputs.length;i++){tx.inputs[i].script=this.script[i]}},SignResultPacket.prototype.fromRaw=function(data){var br=bio.read(data,!0);this.total=br.readVarint();for(var count=br.readVarint(),i=0;i<count;i++)this.script.push(Script.fromReader(br));return this},SignResultPacket.fromRaw=function(data){return(new SignResultPacket).fromRaw(data)},SignResultPacket}(Packet),CheckInputPacket=function(_Packet9){_inherits(CheckInputPacket,_Packet9);function CheckInputPacket(tx,index,coin,flags){_classCallCheck(this,CheckInputPacket);var _this10=_possibleConstructorReturn(this,_Packet9.call(this));return _this10.cmd=packetTypes.CHECKINPUT,_this10.tx=tx||null,_this10.index=index,_this10.coin=coin||null,_this10.flags=null!=flags?flags:null,_this10}return CheckInputPacket.prototype.getSize=function(){var size=0;return size+=this.tx.getSize(),size+=encoding.sizeVarint(this.index),size+=encoding.sizeVarint(this.coin.value),size+=this.coin.script.getVarSize(),size+=4},CheckInputPacket.prototype.toWriter=function(bw){return this.tx.toWriter(bw),bw.writeVarint(this.index),bw.writeVarint(this.coin.value),this.coin.script.toWriter(bw),bw.writeI32(null!=this.flags?this.flags:-1),bw},CheckInputPacket.prototype.fromRaw=function(data){var br=bio.read(data,!0);return this.tx=TX.fromReader(br),this.index=br.readVarint(),this.coin=new Output,this.coin.value=br.readVarint(),this.coin.script.fromReader(br),this.flags=br.readI32(),-1===this.flags&&(this.flags=null),this},CheckInputPacket.fromRaw=function(data){return(new CheckInputPacket).fromRaw(data)},CheckInputPacket}(Packet),CheckInputResultPacket=function(_CheckResultPacket){_inherits(CheckInputResultPacket,_CheckResultPacket);function CheckInputResultPacket(error){_classCallCheck(this,CheckInputResultPacket);var _this11=_possibleConstructorReturn(this,_CheckResultPacket.call(this,error));return _this11.cmd=packetTypes.CHECKINPUTRESULT,_this11}return CheckInputResultPacket.fromRaw=function(data){return(new CheckInputResultPacket).fromRaw(data)},CheckInputResultPacket}(CheckResultPacket),SignInputPacket=function(_Packet10){_inherits(SignInputPacket,_Packet10);function SignInputPacket(tx,index,coin,ring,type){_classCallCheck(this,SignInputPacket);var _this12=_possibleConstructorReturn(this,_Packet10.call(this));return _this12.cmd=packetTypes.SIGNINPUT,_this12.tx=tx||null,_this12.index=index,_this12.coin=coin||null,_this12.ring=ring||null,_this12.type=null!=type?type:1,_this12}return SignInputPacket.prototype.getSize=function(){var size=0;return size+=this.tx.getSize(),size+=encoding.sizeVarint(this.index),size+=encoding.sizeVarint(this.coin.value),size+=this.coin.script.getVarSize(),size+=this.ring.getSize(),size+=1},SignInputPacket.prototype.toWriter=function(bw){return this.tx.toWriter(bw),bw.writeVarint(this.index),bw.writeVarint(this.coin.value),this.coin.script.toWriter(bw),this.ring.toWriter(bw),bw.writeU8(this.type),bw},SignInputPacket.prototype.fromRaw=function(data){var br=bio.read(data,!0);return this.tx=MTX.fromReader(br),this.index=br.readVarint(),this.coin=new Output,this.coin.value=br.readVarint(),this.coin.script.fromReader(br),this.ring=KeyRing.fromReader(br),this.type=br.readU8(),this},SignInputPacket.fromRaw=function(data){return(new SignInputPacket).fromRaw(data)},SignInputPacket}(Packet),SignInputResultPacket=function(_Packet11){_inherits(SignInputResultPacket,_Packet11);function SignInputResultPacket(value,script){_classCallCheck(this,SignInputResultPacket);var _this13=_possibleConstructorReturn(this,_Packet11.call(this));return _this13.cmd=packetTypes.SIGNINPUTRESULT,_this13.value=value||!1,_this13.script=script||null,_this13}return SignInputResultPacket.prototype.fromTX=function(tx,i,value){var input=tx.inputs[i];return assert(input),this.value=value,this.script=input.script,this},SignInputResultPacket.fromTX=function(tx,i,value){return(new SignInputResultPacket).fromTX(tx,i,value)},SignInputResultPacket.prototype.getSize=function(){return 1+this.script.getVarSize()},SignInputResultPacket.prototype.toWriter=function(bw){return bw.writeU8(this.value?1:0),this.script.toWriter(bw),bw},SignInputResultPacket.prototype.inject=function(tx,i){var input=tx.inputs[i];assert(input),input.script=this.script},SignInputResultPacket.prototype.fromRaw=function(data){var br=bio.read(data,!0);return this.value=1===br.readU8(),this.script=Script.fromReader(br),this},SignInputResultPacket.fromRaw=function(data){return(new SignInputResultPacket).fromRaw(data)},SignInputResultPacket}(Packet),ECVerifyPacket=function(_Packet12){_inherits(ECVerifyPacket,_Packet12);function ECVerifyPacket(msg,sig,key){_classCallCheck(this,ECVerifyPacket);var _this14=_possibleConstructorReturn(this,_Packet12.call(this));return _this14.cmd=packetTypes.ECVERIFY,_this14.msg=msg||null,_this14.sig=sig||null,_this14.key=key||null,_this14}return ECVerifyPacket.prototype.getSize=function(){var size=0;return size+=encoding.sizeVarBytes(this.msg),size+=encoding.sizeVarBytes(this.sig),size+=encoding.sizeVarBytes(this.key)},ECVerifyPacket.prototype.toWriter=function(bw){return bw.writeVarBytes(this.msg),bw.writeVarBytes(this.sig),bw.writeVarBytes(this.key),bw},ECVerifyPacket.prototype.fromRaw=function(data){var br=bio.read(data,!0);return this.msg=br.readVarBytes(),this.sig=br.readVarBytes(),this.key=br.readVarBytes(),this},ECVerifyPacket.fromRaw=function(data){return(new ECVerifyPacket).fromRaw(data)},ECVerifyPacket}(Packet),ECVerifyResultPacket=function(_Packet13){_inherits(ECVerifyResultPacket,_Packet13);function ECVerifyResultPacket(value){_classCallCheck(this,ECVerifyResultPacket);var _this15=_possibleConstructorReturn(this,_Packet13.call(this));return _this15.cmd=packetTypes.ECVERIFYRESULT,_this15.value=value,_this15}return ECVerifyResultPacket.prototype.getSize=function(){return 1},ECVerifyResultPacket.prototype.toWriter=function(bw){return bw.writeU8(this.value?1:0),bw},ECVerifyResultPacket.prototype.fromRaw=function(data){var br=bio.read(data,!0);return this.value=1===br.readU8(),this},ECVerifyResultPacket.fromRaw=function(data){return(new ECVerifyResultPacket).fromRaw(data)},ECVerifyResultPacket}(Packet),ECSignPacket=function(_Packet14){_inherits(ECSignPacket,_Packet14);function ECSignPacket(msg,key){_classCallCheck(this,ECSignPacket);var _this16=_possibleConstructorReturn(this,_Packet14.call(this));return _this16.cmd=packetTypes.ECSIGN,_this16.msg=msg||null,_this16.key=key||null,_this16}return ECSignPacket.prototype.getSize=function(){var size=0;return size+=encoding.sizeVarBytes(this.msg),size+=encoding.sizeVarBytes(this.key)},ECSignPacket.prototype.toWriter=function(bw){return bw.writeVarBytes(this.msg),bw.writeVarBytes(this.key),bw},ECSignPacket.prototype.fromRaw=function(data){var br=bio.read(data,!0);return this.msg=br.readVarBytes(),this.key=br.readVarBytes(),this},ECSignPacket.fromRaw=function(data){return(new ECSignPacket).fromRaw(data)},ECSignPacket}(Packet),ECSignResultPacket=function(_Packet15){_inherits(ECSignResultPacket,_Packet15);function ECSignResultPacket(sig){_classCallCheck(this,ECSignResultPacket);var _this17=_possibleConstructorReturn(this,_Packet15.call(this));return _this17.cmd=packetTypes.ECSIGNRESULT,_this17.sig=sig,_this17}return ECSignResultPacket.prototype.getSize=function(){return encoding.sizeVarBytes(this.sig)},ECSignResultPacket.prototype.toWriter=function(bw){return bw.writeVarBytes(this.sig),bw},ECSignResultPacket.prototype.fromRaw=function(data){var br=bio.read(data,!0);return this.sig=br.readVarBytes(),this},ECSignResultPacket.fromRaw=function(data){return(new ECSignResultPacket).fromRaw(data)},ECSignResultPacket}(Packet),MinePacket=function(_Packet16){_inherits(MinePacket,_Packet16);function MinePacket(data,target,min,max){_classCallCheck(this,MinePacket);var _this18=_possibleConstructorReturn(this,_Packet16.call(this));return _this18.cmd=packetTypes.MINE,_this18.data=data||null,_this18.target=target||null,_this18.min=null!=min?min:-1,_this18.max=null!=max?max:-1,_this18}return MinePacket.prototype.getSize=function(){return 120},MinePacket.prototype.toWriter=function(bw){return bw.writeBytes(this.data),bw.writeBytes(this.target),bw.writeU32(this.min),bw.writeU32(this.max),bw},MinePacket.prototype.fromRaw=function(data){var br=bio.read(data,!0);return this.data=br.readBytes(80),this.target=br.readBytes(32),this.min=br.readU32(),this.max=br.readU32(),this},MinePacket.fromRaw=function(data){return(new MinePacket).fromRaw(data)},MinePacket}(Packet),MineResultPacket=function(_Packet17){_inherits(MineResultPacket,_Packet17);function MineResultPacket(nonce){_classCallCheck(this,MineResultPacket);var _this19=_possibleConstructorReturn(this,_Packet17.call(this));return _this19.cmd=packetTypes.MINERESULT,_this19.nonce=null!=nonce?nonce:-1,_this19}return MineResultPacket.prototype.getSize=function(){return 5},MineResultPacket.prototype.toWriter=function(bw){return bw.writeU8(-1!==this.nonce?1:0),bw.writeU32(this.nonce),bw},MineResultPacket.prototype.fromRaw=function(data){var br=bio.read(data,!0);return this.nonce=-1,1===br.readU8()&&(this.nonce=br.readU32()),this},MineResultPacket.fromRaw=function(data){return(new MineResultPacket).fromRaw(data)},MineResultPacket}(Packet),ScryptPacket=function(_Packet18){_inherits(ScryptPacket,_Packet18);function ScryptPacket(passwd,salt,N,r,p,len){_classCallCheck(this,ScryptPacket);var _this20=_possibleConstructorReturn(this,_Packet18.call(this));return _this20.cmd=packetTypes.SCRYPT,_this20.passwd=passwd||null,_this20.salt=salt||null,_this20.N=null!=N?N:-1,_this20.r=null!=r?r:-1,_this20.p=null!=p?p:-1,_this20.len=null!=len?len:-1,_this20}return ScryptPacket.prototype.getSize=function(){var size=0;return size+=encoding.sizeVarBytes(this.passwd),size+=encoding.sizeVarBytes(this.salt),size+=16},ScryptPacket.prototype.toWriter=function(bw){return bw.writeVarBytes(this.passwd),bw.writeVarBytes(this.salt),bw.writeU32(this.N),bw.writeU32(this.r),bw.writeU32(this.p),bw.writeU32(this.len),bw},ScryptPacket.prototype.fromRaw=function(data){var br=bio.read(data,!0);return this.passwd=br.readVarBytes(),this.salt=br.readVarBytes(),this.N=br.readU32(),this.r=br.readU32(),this.p=br.readU32(),this.len=br.readU32(),this},ScryptPacket.fromRaw=function(data){return(new ScryptPacket).fromRaw(data)},ScryptPacket}(Packet),ScryptResultPacket=function(_Packet19){_inherits(ScryptResultPacket,_Packet19);function ScryptResultPacket(key){_classCallCheck(this,ScryptResultPacket);var _this21=_possibleConstructorReturn(this,_Packet19.call(this));return _this21.cmd=packetTypes.SCRYPTRESULT,_this21.key=key||null,_this21}return ScryptResultPacket.prototype.getSize=function(){return encoding.sizeVarBytes(this.key)},ScryptResultPacket.prototype.toWriter=function(bw){return bw.writeVarBytes(this.key),bw},ScryptResultPacket.prototype.fromRaw=function(data){var br=bio.read(data,!0);return this.key=br.readVarBytes(),this},ScryptResultPacket.fromRaw=function(data){return(new ScryptResultPacket).fromRaw(data)},ScryptResultPacket}(Packet);function stringify(value){return"string"!=typeof value?"":value}exports.types=packetTypes,exports.EnvPacket=EnvPacket,exports.EventPacket=EventPacket,exports.LogPacket=LogPacket,exports.ErrorPacket=ErrorPacket,exports.ErrorResultPacket=ErrorResultPacket,exports.CheckPacket=CheckPacket,exports.CheckResultPacket=CheckResultPacket,exports.SignPacket=SignPacket,exports.SignResultPacket=SignResultPacket,exports.CheckInputPacket=CheckInputPacket,exports.CheckInputResultPacket=CheckInputResultPacket,exports.SignInputPacket=SignInputPacket,exports.SignInputResultPacket=SignInputResultPacket,exports.ECVerifyPacket=ECVerifyPacket,exports.ECVerifyResultPacket=ECVerifyResultPacket,exports.ECSignPacket=ECSignPacket,exports.ECSignResultPacket=ECSignResultPacket,exports.MinePacket=MinePacket,exports.MineResultPacket=MineResultPacket,exports.ScryptPacket=ScryptPacket,exports.ScryptResultPacket=ScryptResultPacket},{"../coins/coinview":13,"../primitives/keyring":76,"../primitives/mtx":79,"../primitives/output":81,"../primitives/tx":82,"../script/script":95,"../script/scripterror":96,assert:146,bufio:270}],130:[function(require,module,exports){(function(Buffer){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),EventEmitter=require("events"),packets=require("./packets"),Parser=function(_EventEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Parser,_EventEmitter);function Parser(){_classCallCheck(this,Parser);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return _this.waiting=9,_this.header=null,_this.pending=[],_this.total=0,_this}return Parser.prototype.feed=function(data){for(this.total+=data.length,this.pending.push(data);this.total>=this.waiting;){var chunk=this.read(this.waiting);this.parse(chunk)}},Parser.prototype.read=function(size){if(assert(this.total>=size,"Reading too much."),0===size)return Buffer.alloc(0);var pending=this.pending[0];if(pending.length>size){var _chunk=pending.slice(0,size);return this.pending[0]=pending.slice(size),this.total-=_chunk.length,_chunk}if(pending.length===size){var _chunk2=this.pending.shift();return this.total-=_chunk2.length,_chunk2}for(var chunk=Buffer.allocUnsafe(size),off=0;off<chunk.length;){var _pending=this.pending[0],len=_pending.copy(chunk,off);len===_pending.length?this.pending.shift():this.pending[0]=_pending.slice(len),off+=len}return assert.strictEqual(off,chunk.length),this.total-=chunk.length,chunk},Parser.prototype.parse=function(data){var header=this.header;if(!header){try{header=this.parseHeader(data)}catch(e){return void this.emit("error",e)}return this.header=header,void(this.waiting=header.size+1)}this.waiting=9,this.header=null;var packet=void 0;try{packet=this.parsePacket(header,data)}catch(e){return void this.emit("error",e)}10===data[data.length-1]?(packet.id=header.id,this.emit("packet",packet)):this.emit("error",new Error("No trailing newline."))},Parser.prototype.parseHeader=function(data){var id=data.readUInt32LE(0,!0),cmd=data.readUInt8(4,!0),size=data.readUInt32LE(5,!0);return new Header(id,cmd,size)},Parser.prototype.parsePacket=function(header,data){switch(header.cmd){case packets.types.ENV:return packets.EnvPacket.fromRaw(data);case packets.types.EVENT:return packets.EventPacket.fromRaw(data);case packets.types.LOG:return packets.LogPacket.fromRaw(data);case packets.types.ERROR:return packets.ErrorPacket.fromRaw(data);case packets.types.ERRORRESULT:return packets.ErrorResultPacket.fromRaw(data);case packets.types.CHECK:return packets.CheckPacket.fromRaw(data);case packets.types.CHECKRESULT:return packets.CheckResultPacket.fromRaw(data);case packets.types.SIGN:return packets.SignPacket.fromRaw(data);case packets.types.SIGNRESULT:return packets.SignResultPacket.fromRaw(data);case packets.types.CHECKINPUT:return packets.CheckInputPacket.fromRaw(data);case packets.types.CHECKINPUTRESULT:return packets.CheckInputResultPacket.fromRaw(data);case packets.types.SIGNINPUT:return packets.SignInputPacket.fromRaw(data);case packets.types.SIGNINPUTRESULT:return packets.SignInputResultPacket.fromRaw(data);case packets.types.ECVERIFY:return packets.ECVerifyPacket.fromRaw(data);case packets.types.ECVERIFYRESULT:return packets.ECVerifyResultPacket.fromRaw(data);case packets.types.ECSIGN:return packets.ECSignPacket.fromRaw(data);case packets.types.ECSIGNRESULT:return packets.ECSignResultPacket.fromRaw(data);case packets.types.MINE:return packets.MinePacket.fromRaw(data);case packets.types.MINERESULT:return packets.MineResultPacket.fromRaw(data);case packets.types.SCRYPT:return packets.ScryptPacket.fromRaw(data);case packets.types.SCRYPTRESULT:return packets.ScryptResultPacket.fromRaw(data);default:throw new Error("Unknown packet.")}},Parser}(EventEmitter),Header=function Header(id,cmd,size){_classCallCheck(this,Header),this.id=id,this.cmd=cmd,this.size=size};module.exports=Parser}).call(this,require("buffer").Buffer)},{"./packets":129,assert:146,buffer:269,events:334}],131:[function(require,module,exports){(function(process){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var assert=require("assert"),EventEmitter=require("events"),os=require("os"),Network=require("../protocol/network"),Child=require("./child"),jobs=require("./jobs"),Parser=require("./parser"),Framer=require("./framer"),packets=require("./packets"),WorkerPool=function(_EventEmitter){_inherits(WorkerPool,_EventEmitter);function WorkerPool(options){_classCallCheck(this,WorkerPool);var _this=_possibleConstructorReturn(this,_EventEmitter.call(this));return _this.enabled=!1,_this.size=Math.max(2,os.cpus().length),_this.timeout=12e4,_this.file=process.env.BCOIN_WORKER_FILE||"worker.js",_this.children=new Map,_this.uid=0,_this.set(options),_this}return WorkerPool.prototype.set=function(options){options&&(null!=options.enabled&&(assert("boolean"==typeof options.enabled),this.enabled=options.enabled),null!=options.size&&(assert(options.size>>>0===options.size),assert(options.size>0),this.size=options.size),null!=options.timeout&&(assert(Number.isSafeInteger(options.timeout)),assert(options.timeout>=-1),this.timeout=options.timeout),null!=options.file&&(assert("string"==typeof options.file),this.file=options.file))},WorkerPool.prototype.open=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:case 1:case"end":return _context.stop()}},_callee,this)}));return function(){return _ref.apply(this,arguments)}}(),WorkerPool.prototype.close=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:this.destroy();case 1:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref2.apply(this,arguments)}}(),WorkerPool.prototype.spawn=function(id){var _this2=this,child=new Worker(this.file);return child.id=id,child.on("error",function(err){_this2.emit("error",err,child)}),child.on("exit",function(code){_this2.emit("exit",code,child),_this2.children.get(id)===child&&_this2.children.delete(id)}),child.on("event",function(items){_this2.emit("event",items,child),_this2.emit.apply(_this2,items)}),child.on("log",function(text){_this2.emit("log",text,child)}),this.emit("spawn",child),child},WorkerPool.prototype.alloc=function(){var id=this.uid++%this.size;return this.children.has(id)||this.children.set(id,this.spawn(id)),this.children.get(id)},WorkerPool.prototype.sendEvent=function(){var result=!0,_iterator=this.children.values(),_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref3;if(_isArray){if(_i>=_iterator.length)break;_ref3=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref3=_i.value}var child=_ref3;child.sendEvent.apply(child,arguments)||(result=!1)}return result},WorkerPool.prototype.destroy=function(){var _iterator2=this.children.values(),_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref4;if(_isArray2){if(_i2>=_iterator2.length)break;_ref4=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref4=_i2.value}_ref4.destroy()}},WorkerPool.prototype.execute=function(packet,timeout){if(!this.enabled||!Child.hasSupport())return new Promise(function(resolve,reject){setImmediate(function(){var result=void 0;try{result=jobs.handle(packet)}catch(e){return void reject(e)}resolve(result)})});timeout||(timeout=this.timeout);return this.alloc().execute(packet,timeout)},WorkerPool.prototype.check=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(tx,view,flags){var packet,result;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return packet=new packets.CheckPacket(tx,view,flags),_context3.next=3,this.execute(packet,-1);case 3:if(!(result=_context3.sent).error){_context3.next=6;break}throw result.error;case 6:return _context3.abrupt("return",null);case 7:case"end":return _context3.stop()}},_callee3,this)}));return function(_x,_x2,_x3){return _ref5.apply(this,arguments)}}(),WorkerPool.prototype.sign=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(tx,ring,type){var rings,packet,result;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return rings=ring,Array.isArray(rings)||(rings=[rings]),packet=new packets.SignPacket(tx,rings,type),_context4.next=5,this.execute(packet,-1);case 5:return(result=_context4.sent).inject(tx),_context4.abrupt("return",result.total);case 8:case"end":return _context4.stop()}},_callee4,this)}));return function(_x4,_x5,_x6){return _ref6.apply(this,arguments)}}(),WorkerPool.prototype.checkInput=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(tx,index,coin,flags){var packet,result;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return packet=new packets.CheckInputPacket(tx,index,coin,flags),_context5.next=3,this.execute(packet,-1);case 3:if(!(result=_context5.sent).error){_context5.next=6;break}throw result.error;case 6:return _context5.abrupt("return",null);case 7:case"end":return _context5.stop()}},_callee5,this)}));return function(_x7,_x8,_x9,_x10){return _ref7.apply(this,arguments)}}(),WorkerPool.prototype.signInput=function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(tx,index,coin,ring,type){var packet,result;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return packet=new packets.SignInputPacket(tx,index,coin,ring,type),_context6.next=3,this.execute(packet,-1);case 3:return(result=_context6.sent).inject(tx),_context6.abrupt("return",result.value);case 6:case"end":return _context6.stop()}},_callee6,this)}));return function(_x11,_x12,_x13,_x14,_x15){return _ref8.apply(this,arguments)}}(),WorkerPool.prototype.ecVerify=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(msg,sig,key){var packet,result;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return packet=new packets.ECVerifyPacket(msg,sig,key),_context7.next=3,this.execute(packet,-1);case 3:return result=_context7.sent,_context7.abrupt("return",result.value);case 5:case"end":return _context7.stop()}},_callee7,this)}));return function(_x16,_x17,_x18){return _ref9.apply(this,arguments)}}(),WorkerPool.prototype.ecSign=function(){var _ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(msg,key){var packet,result;return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return packet=new packets.ECSignPacket(msg,key),_context8.next=3,this.execute(packet,-1);case 3:return result=_context8.sent,_context8.abrupt("return",result.sig);case 5:case"end":return _context8.stop()}},_callee8,this)}));return function(_x19,_x20){return _ref10.apply(this,arguments)}}(),WorkerPool.prototype.mine=function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(data,target,min,max){var packet,result;return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return packet=new packets.MinePacket(data,target,min,max),_context9.next=3,this.execute(packet,-1);case 3:return result=_context9.sent,_context9.abrupt("return",result.nonce);case 5:case"end":return _context9.stop()}},_callee9,this)}));return function(_x21,_x22,_x23,_x24){return _ref11.apply(this,arguments)}}(),WorkerPool.prototype.scrypt=function(){var _ref12=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(passwd,salt,N,r,p,len){var packet,result;return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return packet=new packets.ScryptPacket(passwd,salt,N,r,p,len),_context10.next=3,this.execute(packet,-1);case 3:return result=_context10.sent,_context10.abrupt("return",result.key);case 5:case"end":return _context10.stop()}},_callee10,this)}));return function(_x25,_x26,_x27,_x28,_x29,_x30){return _ref12.apply(this,arguments)}}(),WorkerPool}(EventEmitter),Worker=function(_EventEmitter2){_inherits(Worker,_EventEmitter2);function Worker(file){_classCallCheck(this,Worker);var _this3=_possibleConstructorReturn(this,_EventEmitter2.call(this));return _this3.id=-1,_this3.framer=new Framer,_this3.parser=new Parser,_this3.pending=new Map,_this3.child=new Child(file),_this3.init(),_this3}return Worker.prototype.init=function(){var _this4=this;this.child.on("data",function(data){_this4.parser.feed(data)}),this.child.on("exit",function(code,signal){_this4.emit("exit",code,signal)}),this.child.on("error",function(err){_this4.emit("error",err)}),this.parser.on("error",function(err){_this4.emit("error",err)}),this.parser.on("packet",function(packet){_this4.emit("packet",packet)}),this.listen()},Worker.prototype.listen=function(){var _this5=this;this.on("exit",function(code,signal){_this5.killJobs()}),this.on("error",function(err){_this5.killJobs()}),this.on("packet",function(packet){try{_this5.handlePacket(packet)}catch(e){_this5.emit("error",e)}}),this.sendEnv({BCOIN_WORKER_NETWORK:Network.type,BCOIN_WORKER_ISTTY:process.stdout&&process.stdout.isTTY?"1":"0"})},Worker.prototype.handlePacket=function(packet){switch(packet.cmd){case packets.types.EVENT:this.emit("event",packet.items),this.emit.apply(this,packet.items);break;case packets.types.LOG:this.emit("log",packet.text);break;case packets.types.ERROR:this.emit("error",packet.error);break;case packets.types.ERRORRESULT:this.rejectJob(packet.id,packet.error);break;default:this.resolveJob(packet.id,packet)}},Worker.prototype.write=function(data){return this.child.write(data)},Worker.prototype.send=function(packet){return this.write(this.framer.packet(packet))},Worker.prototype.sendEnv=function(env){return this.send(new packets.EnvPacket(env))},Worker.prototype.sendEvent=function(){for(var _len=arguments.length,items=Array(_len),_key=0;_key<_len;_key++)items[_key]=arguments[_key];return this.send(new packets.EventPacket(items))},Worker.prototype.destroy=function(){return this.child.destroy()},Worker.prototype.execute=function(packet,timeout){var _this6=this;return new Promise(function(resolve,reject){_this6._execute(packet,timeout,resolve,reject)})},Worker.prototype._execute=function(packet,timeout,resolve,reject){var job=new PendingJob(this,packet.id,resolve,reject);assert(!this.pending.has(packet.id),"ID overflow."),this.pending.set(packet.id,job),job.start(timeout),this.send(packet)},Worker.prototype.resolveJob=function(id,result){var job=this.pending.get(id);if(!job)throw new Error("Job "+id+" is not in progress.");job.resolve(result)},Worker.prototype.rejectJob=function(id,err){var job=this.pending.get(id);if(!job)throw new Error("Job "+id+" is not in progress.");job.reject(err)},Worker.prototype.killJobs=function(){var _iterator3=this.pending.values(),_isArray3=Array.isArray(_iterator3),_i3=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref13;if(_isArray3){if(_i3>=_iterator3.length)break;_ref13=_iterator3[_i3++]}else{if((_i3=_iterator3.next()).done)break;_ref13=_i3.value}_ref13.destroy()}},Worker}(EventEmitter),PendingJob=function(){function PendingJob(worker,id,resolve,reject){_classCallCheck(this,PendingJob),this.worker=worker,this.id=id,this.job={resolve:resolve,reject:reject},this.timer=null}return PendingJob.prototype.start=function(timeout){var _this7=this;!timeout||timeout<=0||(this.timer=setTimeout(function(){_this7.reject(new Error("Worker timed out."))},timeout))},PendingJob.prototype.destroy=function(){this.reject(new Error("Job was destroyed."))},PendingJob.prototype.cleanup=function(){var job=this.job;return assert(job,"Already finished."),this.job=null,null!=this.timer&&(clearTimeout(this.timer),this.timer=null),assert(this.worker.pending.has(this.id)),this.worker.pending.delete(this.id),job},PendingJob.prototype.resolve=function(result){this.cleanup().resolve(result)},PendingJob.prototype.reject=function(err){this.cleanup().reject(err)},PendingJob}();module.exports=WorkerPool}).call(this,require("_process"))},{"../protocol/network":87,"./child":125,"./framer":126,"./jobs":128,"./packets":129,"./parser":130,_process:374,assert:146,events:334,os:361}],132:[function(require,module,exports){var asn1=exports;asn1.bignum=require("bn.js"),asn1.define=require("./asn1/api").define,asn1.base=require("./asn1/base"),asn1.constants=require("./asn1/constants"),asn1.decoders=require("./asn1/decoders"),asn1.encoders=require("./asn1/encoders")},{"./asn1/api":133,"./asn1/base":135,"./asn1/constants":139,"./asn1/decoders":141,"./asn1/encoders":144,"bn.js":217}],133:[function(require,module,exports){var asn1=require("../asn1"),inherits=require("inherits");exports.define=function(name,body){return new Entity(name,body)};function Entity(name,body){this.name=name,this.body=body,this.decoders={},this.encoders={}}Entity.prototype._createNamed=function(base){var named;try{named=require("vm").runInThisContext("(function "+this.name+"(entity) {\n  this._initNamed(entity);\n})")}catch(e){named=function(entity){this._initNamed(entity)}}return inherits(named,base),named.prototype._initNamed=function(entity){base.call(this,entity)},new named(this)},Entity.prototype._getDecoder=function(enc){return enc=enc||"der",this.decoders.hasOwnProperty(enc)||(this.decoders[enc]=this._createNamed(asn1.decoders[enc])),this.decoders[enc]},Entity.prototype.decode=function(data,enc,options){return this._getDecoder(enc).decode(data,options)},Entity.prototype._getEncoder=function(enc){return enc=enc||"der",this.encoders.hasOwnProperty(enc)||(this.encoders[enc]=this._createNamed(asn1.encoders[enc])),this.encoders[enc]},Entity.prototype.encode=function(data,enc,reporter){return this._getEncoder(enc).encode(data,reporter)}},{"../asn1":132,inherits:352,vm:429}],134:[function(require,module,exports){var inherits=require("inherits"),Reporter=require("../base").Reporter,Buffer=require("buffer").Buffer;function DecoderBuffer(base,options){Reporter.call(this,options),Buffer.isBuffer(base)?(this.base=base,this.offset=0,this.length=base.length):this.error("Input not Buffer")}inherits(DecoderBuffer,Reporter),exports.DecoderBuffer=DecoderBuffer,DecoderBuffer.prototype.save=function(){return{offset:this.offset,reporter:Reporter.prototype.save.call(this)}},DecoderBuffer.prototype.restore=function(save){var res=new DecoderBuffer(this.base);return res.offset=save.offset,res.length=this.offset,this.offset=save.offset,Reporter.prototype.restore.call(this,save.reporter),res},DecoderBuffer.prototype.isEmpty=function(){return this.offset===this.length},DecoderBuffer.prototype.readUInt8=function(fail){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(fail||"DecoderBuffer overrun")},DecoderBuffer.prototype.skip=function(bytes,fail){if(!(this.offset+bytes<=this.length))return this.error(fail||"DecoderBuffer overrun");var res=new DecoderBuffer(this.base);return res._reporterState=this._reporterState,res.offset=this.offset,res.length=this.offset+bytes,this.offset+=bytes,res},DecoderBuffer.prototype.raw=function(save){return this.base.slice(save?save.offset:this.offset,this.length)};function EncoderBuffer(value,reporter){if(Array.isArray(value))this.length=0,this.value=value.map(function(item){return item instanceof EncoderBuffer||(item=new EncoderBuffer(item,reporter)),this.length+=item.length,item},this);else if("number"==typeof value){if(!(0<=value&&value<=255))return reporter.error("non-byte EncoderBuffer value");this.value=value,this.length=1}else if("string"==typeof value)this.value=value,this.length=Buffer.byteLength(value);else{if(!Buffer.isBuffer(value))return reporter.error("Unsupported type: "+typeof value);this.value=value,this.length=value.length}}exports.EncoderBuffer=EncoderBuffer,EncoderBuffer.prototype.join=function(out,offset){return out||(out=new Buffer(this.length)),offset||(offset=0),0===this.length?out:(Array.isArray(this.value)?this.value.forEach(function(item){item.join(out,offset),offset+=item.length}):("number"==typeof this.value?out[offset]=this.value:"string"==typeof this.value?out.write(this.value,offset):Buffer.isBuffer(this.value)&&this.value.copy(out,offset),offset+=this.length),out)}},{"../base":135,buffer:269,inherits:352}],135:[function(require,module,exports){var base=exports;base.Reporter=require("./reporter").Reporter,base.DecoderBuffer=require("./buffer").DecoderBuffer,base.EncoderBuffer=require("./buffer").EncoderBuffer,base.Node=require("./node")},{"./buffer":134,"./node":136,"./reporter":137}],136:[function(require,module,exports){var Reporter=require("../base").Reporter,EncoderBuffer=require("../base").EncoderBuffer,DecoderBuffer=require("../base").DecoderBuffer,assert=require("minimalistic-assert"),tags=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"],methods=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(tags);function Node(enc,parent){var state={};this._baseState=state,state.enc=enc,state.parent=parent||null,state.children=null,state.tag=null,state.args=null,state.reverseArgs=null,state.choice=null,state.optional=!1,state.any=!1,state.obj=!1,state.use=null,state.useDecoder=null,state.key=null,state.default=null,state.explicit=null,state.implicit=null,state.contains=null,state.parent||(state.children=[],this._wrap())}module.exports=Node;var stateProps=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];Node.prototype.clone=function(){var state=this._baseState,cstate={};stateProps.forEach(function(prop){cstate[prop]=state[prop]});var res=new this.constructor(cstate.parent);return res._baseState=cstate,res},Node.prototype._wrap=function(){var state=this._baseState;methods.forEach(function(method){this[method]=function(){var clone=new this.constructor(this);return state.children.push(clone),clone[method].apply(clone,arguments)}},this)},Node.prototype._init=function(body){var state=this._baseState;assert(null===state.parent),body.call(this),state.children=state.children.filter(function(child){return child._baseState.parent===this},this),assert.equal(state.children.length,1,"Root node can have only one child")},Node.prototype._useArgs=function(args){var state=this._baseState,children=args.filter(function(arg){return arg instanceof this.constructor},this);args=args.filter(function(arg){return!(arg instanceof this.constructor)},this),0!==children.length&&(assert(null===state.children),state.children=children,children.forEach(function(child){child._baseState.parent=this},this)),0!==args.length&&(assert(null===state.args),state.args=args,state.reverseArgs=args.map(function(arg){if("object"!=typeof arg||arg.constructor!==Object)return arg;var res={};return Object.keys(arg).forEach(function(key){key==(0|key)&&(key|=0);var value=arg[key];res[value]=key}),res}))},["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"].forEach(function(method){Node.prototype[method]=function(){var state=this._baseState;throw new Error(method+" not implemented for encoding: "+state.enc)}}),tags.forEach(function(tag){Node.prototype[tag]=function(){var state=this._baseState,args=Array.prototype.slice.call(arguments);return assert(null===state.tag),state.tag=tag,this._useArgs(args),this}}),Node.prototype.use=function(item){assert(item);var state=this._baseState;return assert(null===state.use),state.use=item,this},Node.prototype.optional=function(){return this._baseState.optional=!0,this},Node.prototype.def=function(val){var state=this._baseState;return assert(null===state.default),state.default=val,state.optional=!0,this},Node.prototype.explicit=function(num){var state=this._baseState;return assert(null===state.explicit&&null===state.implicit),state.explicit=num,this},Node.prototype.implicit=function(num){var state=this._baseState;return assert(null===state.explicit&&null===state.implicit),state.implicit=num,this},Node.prototype.obj=function(){var state=this._baseState,args=Array.prototype.slice.call(arguments);return state.obj=!0,0!==args.length&&this._useArgs(args),this},Node.prototype.key=function(newKey){var state=this._baseState;return assert(null===state.key),state.key=newKey,this},Node.prototype.any=function(){return this._baseState.any=!0,this},Node.prototype.choice=function(obj){var state=this._baseState;return assert(null===state.choice),state.choice=obj,this._useArgs(Object.keys(obj).map(function(key){return obj[key]})),this},Node.prototype.contains=function(item){var state=this._baseState;return assert(null===state.use),state.contains=item,this},Node.prototype._decode=function(input,options){var state=this._baseState;if(null===state.parent)return input.wrapResult(state.children[0]._decode(input,options));var result=state.default,present=!0,prevKey=null;if(null!==state.key&&(prevKey=input.enterKey(state.key)),state.optional){var tag=null;if(null!==state.explicit?tag=state.explicit:null!==state.implicit?tag=state.implicit:null!==state.tag&&(tag=state.tag),null!==tag||state.any){if(present=this._peekTag(input,tag,state.any),input.isError(present))return present}else{var save=input.save();try{null===state.choice?this._decodeGeneric(state.tag,input,options):this._decodeChoice(input,options),present=!0}catch(e){present=!1}input.restore(save)}}var prevObj;if(state.obj&&present&&(prevObj=input.enterObject()),present){if(null!==state.explicit){var explicit=this._decodeTag(input,state.explicit);if(input.isError(explicit))return explicit;input=explicit}var start=input.offset;if(null===state.use&&null===state.choice){if(state.any)save=input.save();var body=this._decodeTag(input,null!==state.implicit?state.implicit:state.tag,state.any);if(input.isError(body))return body;state.any?result=input.raw(save):input=body}if(options&&options.track&&null!==state.tag&&options.track(input.path(),start,input.length,"tagged"),options&&options.track&&null!==state.tag&&options.track(input.path(),input.offset,input.length,"content"),result=state.any?result:null===state.choice?this._decodeGeneric(state.tag,input,options):this._decodeChoice(input,options),input.isError(result))return result;if(state.any||null!==state.choice||null===state.children||state.children.forEach(function(child){child._decode(input,options)}),state.contains&&("octstr"===state.tag||"bitstr"===state.tag)){var data=new DecoderBuffer(result);result=this._getUse(state.contains,input._reporterState.obj)._decode(data,options)}}return state.obj&&present&&(result=input.leaveObject(prevObj)),null===state.key||null===result&&!0!==present?null!==prevKey&&input.exitKey(prevKey):input.leaveKey(prevKey,state.key,result),result},Node.prototype._decodeGeneric=function(tag,input,options){var state=this._baseState;return"seq"===tag||"set"===tag?null:"seqof"===tag||"setof"===tag?this._decodeList(input,tag,state.args[0],options):/str$/.test(tag)?this._decodeStr(input,tag,options):"objid"===tag&&state.args?this._decodeObjid(input,state.args[0],state.args[1],options):"objid"===tag?this._decodeObjid(input,null,null,options):"gentime"===tag||"utctime"===tag?this._decodeTime(input,tag,options):"null_"===tag?this._decodeNull(input,options):"bool"===tag?this._decodeBool(input,options):"objDesc"===tag?this._decodeStr(input,tag,options):"int"===tag||"enum"===tag?this._decodeInt(input,state.args&&state.args[0],options):null!==state.use?this._getUse(state.use,input._reporterState.obj)._decode(input,options):input.error("unknown tag: "+tag)},Node.prototype._getUse=function(entity,obj){var state=this._baseState;return state.useDecoder=this._use(entity,obj),assert(null===state.useDecoder._baseState.parent),state.useDecoder=state.useDecoder._baseState.children[0],state.implicit!==state.useDecoder._baseState.implicit&&(state.useDecoder=state.useDecoder.clone(),state.useDecoder._baseState.implicit=state.implicit),state.useDecoder},Node.prototype._decodeChoice=function(input,options){var state=this._baseState,result=null,match=!1;return Object.keys(state.choice).some(function(key){var save=input.save(),node=state.choice[key];try{var value=node._decode(input,options);if(input.isError(value))return!1;result={type:key,value:value},match=!0}catch(e){return input.restore(save),!1}return!0},this),match?result:input.error("Choice not matched")},Node.prototype._createEncoderBuffer=function(data){return new EncoderBuffer(data,this.reporter)},Node.prototype._encode=function(data,reporter,parent){var state=this._baseState;if(null===state.default||state.default!==data){var result=this._encodeValue(data,reporter,parent);if(void 0!==result&&!this._skipDefault(result,reporter,parent))return result}},Node.prototype._encodeValue=function(data,reporter,parent){var state=this._baseState;if(null===state.parent)return state.children[0]._encode(data,reporter||new Reporter);var result=null;if(this.reporter=reporter,state.optional&&void 0===data){if(null===state.default)return;data=state.default}var content=null,primitive=!1;if(state.any)result=this._createEncoderBuffer(data);else if(state.choice)result=this._encodeChoice(data,reporter);else if(state.contains)content=this._getUse(state.contains,parent)._encode(data,reporter),primitive=!0;else if(state.children)content=state.children.map(function(child){if("null_"===child._baseState.tag)return child._encode(null,reporter,data);if(null===child._baseState.key)return reporter.error("Child should have a key");var prevKey=reporter.enterKey(child._baseState.key);if("object"!=typeof data)return reporter.error("Child expected, but input is not object");var res=child._encode(data[child._baseState.key],reporter,data);return reporter.leaveKey(prevKey),res},this).filter(function(child){return child}),content=this._createEncoderBuffer(content);else if("seqof"===state.tag||"setof"===state.tag){if(!state.args||1!==state.args.length)return reporter.error("Too many args for : "+state.tag);if(!Array.isArray(data))return reporter.error("seqof/setof, but data is not Array");var child=this.clone();child._baseState.implicit=null,content=this._createEncoderBuffer(data.map(function(item){var state=this._baseState;return this._getUse(state.args[0],data)._encode(item,reporter)},child))}else null!==state.use?result=this._getUse(state.use,parent)._encode(data,reporter):(content=this._encodePrimitive(state.tag,data),primitive=!0);if(!state.any&&null===state.choice){var tag=null!==state.implicit?state.implicit:state.tag,cls=null===state.implicit?"universal":"context";null===tag?null===state.use&&reporter.error("Tag could be omitted only for .use()"):null===state.use&&(result=this._encodeComposite(tag,primitive,cls,content))}return null!==state.explicit&&(result=this._encodeComposite(state.explicit,!1,"context",result)),result},Node.prototype._encodeChoice=function(data,reporter){var state=this._baseState,node=state.choice[data.type];return node||assert(!1,data.type+" not found in "+JSON.stringify(Object.keys(state.choice))),node._encode(data.value,reporter)},Node.prototype._encodePrimitive=function(tag,data){var state=this._baseState;if(/str$/.test(tag))return this._encodeStr(data,tag);if("objid"===tag&&state.args)return this._encodeObjid(data,state.reverseArgs[0],state.args[1]);if("objid"===tag)return this._encodeObjid(data,null,null);if("gentime"===tag||"utctime"===tag)return this._encodeTime(data,tag);if("null_"===tag)return this._encodeNull();if("int"===tag||"enum"===tag)return this._encodeInt(data,state.args&&state.reverseArgs[0]);if("bool"===tag)return this._encodeBool(data);if("objDesc"===tag)return this._encodeStr(data,tag);throw new Error("Unsupported tag: "+tag)},Node.prototype._isNumstr=function(str){return/^[0-9 ]*$/.test(str)},Node.prototype._isPrintstr=function(str){return/^[A-Za-z0-9 '\(\)\+,\-\.\/:=\?]*$/.test(str)}},{"../base":135,"minimalistic-assert":358}],137:[function(require,module,exports){var inherits=require("inherits");function Reporter(options){this._reporterState={obj:null,path:[],options:options||{},errors:[]}}exports.Reporter=Reporter,Reporter.prototype.isError=function(obj){return obj instanceof ReporterError},Reporter.prototype.save=function(){var state=this._reporterState;return{obj:state.obj,pathLen:state.path.length}},Reporter.prototype.restore=function(data){var state=this._reporterState;state.obj=data.obj,state.path=state.path.slice(0,data.pathLen)},Reporter.prototype.enterKey=function(key){return this._reporterState.path.push(key)},Reporter.prototype.exitKey=function(index){var state=this._reporterState;state.path=state.path.slice(0,index-1)},Reporter.prototype.leaveKey=function(index,key,value){var state=this._reporterState;this.exitKey(index),null!==state.obj&&(state.obj[key]=value)},Reporter.prototype.path=function(){return this._reporterState.path.join("/")},Reporter.prototype.enterObject=function(){var state=this._reporterState,prev=state.obj;return state.obj={},prev},Reporter.prototype.leaveObject=function(prev){var state=this._reporterState,now=state.obj;return state.obj=prev,now},Reporter.prototype.error=function(msg){var err,state=this._reporterState,inherited=msg instanceof ReporterError;if(err=inherited?msg:new ReporterError(state.path.map(function(elem){return"["+JSON.stringify(elem)+"]"}).join(""),msg.message||msg,msg.stack),!state.options.partial)throw err;return inherited||state.errors.push(err),err},Reporter.prototype.wrapResult=function(result){var state=this._reporterState;return state.options.partial?{result:this.isError(result)?null:result,errors:state.errors}:result};function ReporterError(path,msg){this.path=path,this.rethrow(msg)}inherits(ReporterError,Error),ReporterError.prototype.rethrow=function(msg){if(this.message=msg+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,ReporterError),!this.stack)try{throw new Error(this.message)}catch(e){this.stack=e.stack}return this}},{inherits:352}],138:[function(require,module,exports){var constants=require("../constants");exports.tagClass={0:"universal",1:"application",2:"context",3:"private"},exports.tagClassByName=constants._reverse(exports.tagClass),exports.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"},exports.tagByName=constants._reverse(exports.tag)},{"../constants":139}],139:[function(require,module,exports){var constants=exports;constants._reverse=function(map){var res={};return Object.keys(map).forEach(function(key){(0|key)==key&&(key|=0);var value=map[key];res[value]=key}),res},constants.der=require("./der")},{"./der":138}],140:[function(require,module,exports){var inherits=require("inherits"),asn1=require("../../asn1"),base=asn1.base,bignum=asn1.bignum,der=asn1.constants.der;function DERDecoder(entity){this.enc="der",this.name=entity.name,this.entity=entity,this.tree=new DERNode,this.tree._init(entity.body)}module.exports=DERDecoder,DERDecoder.prototype.decode=function(data,options){return data instanceof base.DecoderBuffer||(data=new base.DecoderBuffer(data,options)),this.tree._decode(data,options)};function DERNode(parent){base.Node.call(this,"der",parent)}inherits(DERNode,base.Node),DERNode.prototype._peekTag=function(buffer,tag,any){if(buffer.isEmpty())return!1;var state=buffer.save(),decodedTag=derDecodeTag(buffer,'Failed to peek tag: "'+tag+'"');return buffer.isError(decodedTag)?decodedTag:(buffer.restore(state),decodedTag.tag===tag||decodedTag.tagStr===tag||decodedTag.tagStr+"of"===tag||any)},DERNode.prototype._decodeTag=function(buffer,tag,any){var decodedTag=derDecodeTag(buffer,'Failed to decode tag of "'+tag+'"');if(buffer.isError(decodedTag))return decodedTag;var len=derDecodeLen(buffer,decodedTag.primitive,'Failed to get length of "'+tag+'"');if(buffer.isError(len))return len;if(!any&&decodedTag.tag!==tag&&decodedTag.tagStr!==tag&&decodedTag.tagStr+"of"!==tag)return buffer.error('Failed to match tag: "'+tag+'"');if(decodedTag.primitive||null!==len)return buffer.skip(len,'Failed to match body of: "'+tag+'"');var state=buffer.save(),res=this._skipUntilEnd(buffer,'Failed to skip indefinite length body: "'+this.tag+'"');return buffer.isError(res)?res:(len=buffer.offset-state.offset,buffer.restore(state),buffer.skip(len,'Failed to match body of: "'+tag+'"'))},DERNode.prototype._skipUntilEnd=function(buffer,fail){for(;;){var tag=derDecodeTag(buffer,fail);if(buffer.isError(tag))return tag;var len=derDecodeLen(buffer,tag.primitive,fail);if(buffer.isError(len))return len;var res;if(res=tag.primitive||null!==len?buffer.skip(len):this._skipUntilEnd(buffer,fail),buffer.isError(res))return res;if("end"===tag.tagStr)break}},DERNode.prototype._decodeList=function(buffer,tag,decoder,options){for(var result=[];!buffer.isEmpty();){var possibleEnd=this._peekTag(buffer,"end");if(buffer.isError(possibleEnd))return possibleEnd;var res=decoder.decode(buffer,"der",options);if(buffer.isError(res)&&possibleEnd)break;result.push(res)}return result},DERNode.prototype._decodeStr=function(buffer,tag){if("bitstr"===tag){var unused=buffer.readUInt8();return buffer.isError(unused)?unused:{unused:unused,data:buffer.raw()}}if("bmpstr"===tag){var raw=buffer.raw();if(raw.length%2==1)return buffer.error("Decoding of string type: bmpstr length mismatch");for(var str="",i=0;i<raw.length/2;i++)str+=String.fromCharCode(raw.readUInt16BE(2*i));return str}if("numstr"===tag){var numstr=buffer.raw().toString("ascii");return this._isNumstr(numstr)?numstr:buffer.error("Decoding of string type: numstr unsupported characters")}if("octstr"===tag)return buffer.raw();if("objDesc"===tag)return buffer.raw();if("printstr"===tag){var printstr=buffer.raw().toString("ascii");return this._isPrintstr(printstr)?printstr:buffer.error("Decoding of string type: printstr unsupported characters")}return/str$/.test(tag)?buffer.raw().toString():buffer.error("Decoding of string type: "+tag+" unsupported")},DERNode.prototype._decodeObjid=function(buffer,values,relative){for(var result,identifiers=[],ident=0;!buffer.isEmpty();){var subident=buffer.readUInt8();ident<<=7,ident|=127&subident,0==(128&subident)&&(identifiers.push(ident),ident=0)}128&subident&&identifiers.push(ident);var first=identifiers[0]/40|0,second=identifiers[0]%40;if(result=relative?identifiers:[first,second].concat(identifiers.slice(1)),values){var tmp=values[result.join(" ")];void 0===tmp&&(tmp=values[result.join(".")]),void 0!==tmp&&(result=tmp)}return result},DERNode.prototype._decodeTime=function(buffer,tag){var str=buffer.raw().toString();if("gentime"===tag)var year=0|str.slice(0,4),mon=0|str.slice(4,6),day=0|str.slice(6,8),hour=0|str.slice(8,10),min=0|str.slice(10,12),sec=0|str.slice(12,14);else{if("utctime"!==tag)return buffer.error("Decoding "+tag+" time is not supported yet");year=0|str.slice(0,2),mon=0|str.slice(2,4),day=0|str.slice(4,6),hour=0|str.slice(6,8),min=0|str.slice(8,10),sec=0|str.slice(10,12);year=year<70?2e3+year:1900+year}return Date.UTC(year,mon-1,day,hour,min,sec,0)},DERNode.prototype._decodeNull=function(buffer){return null},DERNode.prototype._decodeBool=function(buffer){var res=buffer.readUInt8();return buffer.isError(res)?res:0!==res},DERNode.prototype._decodeInt=function(buffer,values){var raw=buffer.raw(),res=new bignum(raw);return values&&(res=values[res.toString(10)]||res),res},DERNode.prototype._use=function(entity,obj){return"function"==typeof entity&&(entity=entity(obj)),entity._getDecoder("der").tree};function derDecodeTag(buf,fail){var tag=buf.readUInt8(fail);if(buf.isError(tag))return tag;var cls=der.tagClass[tag>>6],primitive=0==(32&tag);if(31==(31&tag)){var oct=tag;for(tag=0;128==(128&oct);){if(oct=buf.readUInt8(fail),buf.isError(oct))return oct;tag<<=7,tag|=127&oct}}else tag&=31;return{cls:cls,primitive:primitive,tag:tag,tagStr:der.tag[tag]}}function derDecodeLen(buf,primitive,fail){var len=buf.readUInt8(fail);if(buf.isError(len))return len;if(!primitive&&128===len)return null;if(0==(128&len))return len;var num=127&len;if(num>4)return buf.error("length octect is too long");len=0;for(var i=0;i<num;i++){len<<=8;var j=buf.readUInt8(fail);if(buf.isError(j))return j;len|=j}return len}},{"../../asn1":132,inherits:352}],141:[function(require,module,exports){var decoders=exports;decoders.der=require("./der"),decoders.pem=require("./pem")},{"./der":140,"./pem":142}],142:[function(require,module,exports){var inherits=require("inherits"),Buffer=require("buffer").Buffer,DERDecoder=require("./der");function PEMDecoder(entity){DERDecoder.call(this,entity),this.enc="pem"}inherits(PEMDecoder,DERDecoder),module.exports=PEMDecoder,PEMDecoder.prototype.decode=function(data,options){for(var lines=data.toString().split(/[\r\n]+/g),label=options.label.toUpperCase(),re=/^-----(BEGIN|END) ([^-]+)-----$/,start=-1,end=-1,i=0;i<lines.length;i++){var match=lines[i].match(re);if(null!==match&&match[2]===label){if(-1!==start){if("END"!==match[1])break;end=i;break}if("BEGIN"!==match[1])break;start=i}}if(-1===start||-1===end)throw new Error("PEM section not found for: "+label);var base64=lines.slice(start+1,end).join("");base64.replace(/[^a-z0-9\+\/=]+/gi,"");var input=new Buffer(base64,"base64");return DERDecoder.prototype.decode.call(this,input,options)}},{"./der":140,buffer:269,inherits:352}],143:[function(require,module,exports){var inherits=require("inherits"),Buffer=require("buffer").Buffer,asn1=require("../../asn1"),base=asn1.base,der=asn1.constants.der;function DEREncoder(entity){this.enc="der",this.name=entity.name,this.entity=entity,this.tree=new DERNode,this.tree._init(entity.body)}module.exports=DEREncoder,DEREncoder.prototype.encode=function(data,reporter){return this.tree._encode(data,reporter).join()};function DERNode(parent){base.Node.call(this,"der",parent)}inherits(DERNode,base.Node),DERNode.prototype._encodeComposite=function(tag,primitive,cls,content){var encodedTag=function(tag,primitive,cls,reporter){var res;"seqof"===tag?tag="seq":"setof"===tag&&(tag="set");if(der.tagByName.hasOwnProperty(tag))res=der.tagByName[tag];else{if("number"!=typeof tag||(0|tag)!==tag)return reporter.error("Unknown tag: "+tag);res=tag}if(res>=31)return reporter.error("Multi-octet tag encoding unsupported");primitive||(res|=32);return res|=der.tagClassByName[cls||"universal"]<<6}(tag,primitive,cls,this.reporter);if(content.length<128){return(header=new Buffer(2))[0]=encodedTag,header[1]=content.length,this._createEncoderBuffer([header,content])}for(var lenOctets=1,i=content.length;i>=256;i>>=8)lenOctets++;var header;(header=new Buffer(2+lenOctets))[0]=encodedTag,header[1]=128|lenOctets;i=1+lenOctets;for(var j=content.length;j>0;i--,j>>=8)header[i]=255&j;return this._createEncoderBuffer([header,content])},DERNode.prototype._encodeStr=function(str,tag){if("bitstr"===tag)return this._createEncoderBuffer([0|str.unused,str.data]);if("bmpstr"===tag){for(var buf=new Buffer(2*str.length),i=0;i<str.length;i++)buf.writeUInt16BE(str.charCodeAt(i),2*i);return this._createEncoderBuffer(buf)}return"numstr"===tag?this._isNumstr(str)?this._createEncoderBuffer(str):this.reporter.error("Encoding of string type: numstr supports only digits and space"):"printstr"===tag?this._isPrintstr(str)?this._createEncoderBuffer(str):this.reporter.error("Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark"):/str$/.test(tag)?this._createEncoderBuffer(str):"objDesc"===tag?this._createEncoderBuffer(str):this.reporter.error("Encoding of string type: "+tag+" unsupported")},DERNode.prototype._encodeObjid=function(id,values,relative){if("string"==typeof id){if(!values)return this.reporter.error("string objid given, but no values map found");if(!values.hasOwnProperty(id))return this.reporter.error("objid not found in values map");id=values[id].split(/[\s\.]+/g);for(var i=0;i<id.length;i++)id[i]|=0}else if(Array.isArray(id)){id=id.slice();for(i=0;i<id.length;i++)id[i]|=0}if(!Array.isArray(id))return this.reporter.error("objid() should be either array or string, got: "+JSON.stringify(id));if(!relative){if(id[1]>=40)return this.reporter.error("Second objid identifier OOB");id.splice(0,2,40*id[0]+id[1])}var size=0;for(i=0;i<id.length;i++){var ident=id[i];for(size++;ident>=128;ident>>=7)size++}var objid=new Buffer(size),offset=objid.length-1;for(i=id.length-1;i>=0;i--){ident=id[i];for(objid[offset--]=127&ident;(ident>>=7)>0;)objid[offset--]=128|127&ident}return this._createEncoderBuffer(objid)};function two(num){return num<10?"0"+num:num}DERNode.prototype._encodeTime=function(time,tag){var str,date=new Date(time);return"gentime"===tag?str=[two(date.getFullYear()),two(date.getUTCMonth()+1),two(date.getUTCDate()),two(date.getUTCHours()),two(date.getUTCMinutes()),two(date.getUTCSeconds()),"Z"].join(""):"utctime"===tag?str=[two(date.getFullYear()%100),two(date.getUTCMonth()+1),two(date.getUTCDate()),two(date.getUTCHours()),two(date.getUTCMinutes()),two(date.getUTCSeconds()),"Z"].join(""):this.reporter.error("Encoding "+tag+" time is not supported yet"),this._encodeStr(str,"octstr")},DERNode.prototype._encodeNull=function(){return this._createEncoderBuffer("")},DERNode.prototype._encodeInt=function(num,values){if("string"==typeof num){if(!values)return this.reporter.error("String int or enum given, but no values map");if(!values.hasOwnProperty(num))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(num));num=values[num]}if("number"!=typeof num&&!Buffer.isBuffer(num)){var numArray=num.toArray();!num.sign&&128&numArray[0]&&numArray.unshift(0),num=new Buffer(numArray)}if(Buffer.isBuffer(num)){var size=num.length;0===num.length&&size++;var out=new Buffer(size);return num.copy(out),0===num.length&&(out[0]=0),this._createEncoderBuffer(out)}if(num<128)return this._createEncoderBuffer(num);if(num<256)return this._createEncoderBuffer([0,num]);size=1;for(var i=num;i>=256;i>>=8)size++;for(i=(out=new Array(size)).length-1;i>=0;i--)out[i]=255&num,num>>=8;return 128&out[0]&&out.unshift(0),this._createEncoderBuffer(new Buffer(out))},DERNode.prototype._encodeBool=function(value){return this._createEncoderBuffer(value?255:0)},DERNode.prototype._use=function(entity,obj){return"function"==typeof entity&&(entity=entity(obj)),entity._getEncoder("der").tree},DERNode.prototype._skipDefault=function(dataBuffer,reporter,parent){var i,state=this._baseState;if(null===state.default)return!1;var data=dataBuffer.join();if(void 0===state.defaultBuffer&&(state.defaultBuffer=this._encodeValue(state.default,reporter,parent).join()),data.length!==state.defaultBuffer.length)return!1;for(i=0;i<data.length;i++)if(data[i]!==state.defaultBuffer[i])return!1;return!0}},{"../../asn1":132,buffer:269,inherits:352}],144:[function(require,module,exports){var encoders=exports;encoders.der=require("./der"),encoders.pem=require("./pem")},{"./der":143,"./pem":145}],145:[function(require,module,exports){var inherits=require("inherits"),DEREncoder=require("./der");function PEMEncoder(entity){DEREncoder.call(this,entity),this.enc="pem"}inherits(PEMEncoder,DEREncoder),module.exports=PEMEncoder,PEMEncoder.prototype.encode=function(data,options){for(var p=DEREncoder.prototype.encode.call(this,data).toString("base64"),out=["-----BEGIN "+options.label+"-----"],i=0;i<p.length;i+=64)out.push(p.slice(i,i+64));return out.push("-----END "+options.label+"-----"),out.join("\n")}},{"./der":143,inherits:352}],146:[function(require,module,exports){(function(global){"use strict";function compare(a,b){if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0}function isBuffer(b){return global.Buffer&&"function"==typeof global.Buffer.isBuffer?global.Buffer.isBuffer(b):!(null==b||!b._isBuffer)}var util=require("util/"),hasOwn=Object.prototype.hasOwnProperty,pSlice=Array.prototype.slice,functionsHaveNames="foo"===function(){}.name;function pToString(obj){return Object.prototype.toString.call(obj)}function isView(arrbuf){return!isBuffer(arrbuf)&&("function"==typeof global.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(arrbuf):!!arrbuf&&(arrbuf instanceof DataView||!!(arrbuf.buffer&&arrbuf.buffer instanceof ArrayBuffer))))}var assert=module.exports=ok,regex=/\s*function\s+([^\(\s]*)\s*/;function getName(func){if(util.isFunction(func)){if(functionsHaveNames)return func.name;var match=func.toString().match(regex);return match&&match[1]}}assert.AssertionError=function(options){this.name="AssertionError",this.actual=options.actual,this.expected=options.expected,this.operator=options.operator,options.message?(this.message=options.message,this.generatedMessage=!1):(this.message=(self=this,truncate(inspect(self.actual),128)+" "+self.operator+" "+truncate(inspect(self.expected),128)),this.generatedMessage=!0);var self,stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace)Error.captureStackTrace(this,stackStartFunction);else{var err=new Error;if(err.stack){var out=err.stack,fn_name=getName(stackStartFunction),idx=out.indexOf("\n"+fn_name);if(idx>=0){var next_line=out.indexOf("\n",idx+1);out=out.substring(next_line+1)}this.stack=out}}},util.inherits(assert.AssertionError,Error);function truncate(s,n){return"string"==typeof s?s.length<n?s:s.slice(0,n):s}function inspect(something){if(functionsHaveNames||!util.isFunction(something))return util.inspect(something);var rawname=getName(something);return"[Function"+(rawname?": "+rawname:"")+"]"}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}assert.fail=fail;function ok(value,message){value||fail(value,!0,message,"==",assert.ok)}assert.ok=ok,assert.equal=function(actual,expected,message){actual!=expected&&fail(actual,expected,message,"==",assert.equal)},assert.notEqual=function(actual,expected,message){actual==expected&&fail(actual,expected,message,"!=",assert.notEqual)},assert.deepEqual=function(actual,expected,message){_deepEqual(actual,expected,!1)||fail(actual,expected,message,"deepEqual",assert.deepEqual)},assert.deepStrictEqual=function(actual,expected,message){_deepEqual(actual,expected,!0)||fail(actual,expected,message,"deepStrictEqual",assert.deepStrictEqual)};function _deepEqual(actual,expected,strict,memos){if(actual===expected)return!0;if(isBuffer(actual)&&isBuffer(expected))return 0===compare(actual,expected);if(util.isDate(actual)&&util.isDate(expected))return actual.getTime()===expected.getTime();if(util.isRegExp(actual)&&util.isRegExp(expected))return actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase;if(null!==actual&&"object"==typeof actual||null!==expected&&"object"==typeof expected){if(isView(actual)&&isView(expected)&&pToString(actual)===pToString(expected)&&!(actual instanceof Float32Array||actual instanceof Float64Array))return 0===compare(new Uint8Array(actual.buffer),new Uint8Array(expected.buffer));if(isBuffer(actual)!==isBuffer(expected))return!1;var actualIndex=(memos=memos||{actual:[],expected:[]}).actual.indexOf(actual);return-1!==actualIndex&&actualIndex===memos.expected.indexOf(expected)||(memos.actual.push(actual),memos.expected.push(expected),function(a,b,strict,actualVisitedObjects){if(null===a||void 0===a||null===b||void 0===b)return!1;if(util.isPrimitive(a)||util.isPrimitive(b))return a===b;if(strict&&Object.getPrototypeOf(a)!==Object.getPrototypeOf(b))return!1;var aIsArgs=isArguments(a),bIsArgs=isArguments(b);if(aIsArgs&&!bIsArgs||!aIsArgs&&bIsArgs)return!1;if(aIsArgs)return a=pSlice.call(a),b=pSlice.call(b),_deepEqual(a,b,strict);var key,i,ka=objectKeys(a),kb=objectKeys(b);if(ka.length!==kb.length)return!1;for(ka.sort(),kb.sort(),i=ka.length-1;i>=0;i--)if(ka[i]!==kb[i])return!1;for(i=ka.length-1;i>=0;i--)if(key=ka[i],!_deepEqual(a[key],b[key],strict,actualVisitedObjects))return!1;return!0}(actual,expected,strict,memos))}return strict?actual===expected:actual==expected}function isArguments(object){return"[object Arguments]"==Object.prototype.toString.call(object)}assert.notDeepEqual=function(actual,expected,message){_deepEqual(actual,expected,!1)&&fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)},assert.notDeepStrictEqual=function notDeepStrictEqual(actual,expected,message){_deepEqual(actual,expected,!0)&&fail(actual,expected,message,"notDeepStrictEqual",notDeepStrictEqual)};assert.strictEqual=function(actual,expected,message){actual!==expected&&fail(actual,expected,message,"===",assert.strictEqual)},assert.notStrictEqual=function(actual,expected,message){actual===expected&&fail(actual,expected,message,"!==",assert.notStrictEqual)};function expectedException(actual,expected){if(!actual||!expected)return!1;if("[object RegExp]"==Object.prototype.toString.call(expected))return expected.test(actual);try{if(actual instanceof expected)return!0}catch(e){}return!Error.isPrototypeOf(expected)&&!0===expected.call({},actual)}function _throws(shouldThrow,block,expected,message){var actual;if("function"!=typeof block)throw new TypeError('"block" argument must be a function');"string"==typeof expected&&(message=expected,expected=null),actual=function(block){var error;try{block()}catch(e){error=e}return error}(block),message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:"."),shouldThrow&&!actual&&fail(actual,expected,"Missing expected exception"+message);var userProvidedMessage="string"==typeof message,isUnwantedException=!shouldThrow&&util.isError(actual),isUnexpectedException=!shouldThrow&&actual&&!expected;if((isUnwantedException&&userProvidedMessage&&expectedException(actual,expected)||isUnexpectedException)&&fail(actual,expected,"Got unwanted exception"+message),shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual)throw actual}assert.throws=function(block,error,message){_throws(!0,block,error,message)},assert.doesNotThrow=function(block,error,message){_throws(!1,block,error,message)},assert.ifError=function(err){if(err)throw err};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)hasOwn.call(obj,key)&&keys.push(key);return keys}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"util/":428}],147:[function(require,module,exports){"use strict";exports.byteLength=function(b64){return 3*b64.length/4-placeHoldersCount(b64)},exports.toByteArray=function(b64){var i,l,tmp,placeHolders,arr,len=b64.length;placeHolders=placeHoldersCount(b64),arr=new Arr(3*len/4-placeHolders),l=placeHolders>0?len-4:len;var L=0;for(i=0;i<l;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[L++]=tmp>>16&255,arr[L++]=tmp>>8&255,arr[L++]=255&tmp;2===placeHolders?(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[L++]=255&tmp):1===placeHolders&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[L++]=tmp>>8&255,arr[L++]=255&tmp);return arr},exports.fromByteArray=function(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,output="",parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(encodeChunk(uint8,i,i+16383>len2?len2:i+16383));1===extraBytes?(tmp=uint8[len-1],output+=lookup[tmp>>2],output+=lookup[tmp<<4&63],output+="=="):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],output+=lookup[tmp>>10],output+=lookup[tmp>>4&63],output+=lookup[tmp<<2&63],output+="=");return parts.push(output),parts.join("")};for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63;function placeHoldersCount(b64){var len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===b64[len-2]?2:"="===b64[len-1]?1:0}function encodeChunk(uint8,start,end){for(var tmp,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output.push(lookup[(num=tmp)>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]);var num;return output.join("")}},{}],148:[function(require,module,exports){"use strict";module.exports=require("./config")},{"./config":149}],149:[function(require,module,exports){(function(process,global,Buffer){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var assert=require("assert"),Path=require("path"),os=require("os"),fs=require("./fs"),HOME=os.homedir?os.homedir():"/",Config=function(){function Config(module,options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Config),assert("string"==typeof module),assert(module.length>0),this.module=module,this.prefix=Path.join(HOME,"."+module),this.suffix=null,this.fallback=null,this.alias=Object.create(null),this.options=Object.create(null),this.data=Object.create(null),this.env=Object.create(null),this.args=Object.create(null),this.argv=[],this.pass=[],this.query=Object.create(null),this.hash=Object.create(null),options&&this.init(options)}return Config.prototype.init=function(options){if(assert(options&&"object"===(void 0===options?"undefined":_typeof(options))),null!=options.suffix&&(assert("string"==typeof options.suffix),this.suffix=options.suffix),null!=options.fallback&&(assert("string"==typeof options.fallback),this.fallback=options.fallback),options.alias){assert("object"===_typeof(options.alias));var _iterator=Object.keys(options.alias),_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var key=_ref,value=options.alias[key];assert("string"==typeof value),this.alias[key]=value}}},Config.prototype.inject=function(options){var _iterator2=Object.keys(options),_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref2=_i2.value}var key=_ref2,value=options[key];switch(key){case"hash":case"query":case"env":case"argv":case"config":continue}this.set(key,value)}},Config.prototype.load=function(options){options.hash&&this.parseHash(options.hash),options.query&&this.parseQuery(options.query),options.env&&this.parseEnv(options.env),options.argv&&this.parseArg(options.argv),this.prefix=this.getPrefix()},Config.prototype.open=function(file){if(!fs.unsupported){var path=this.getFile(file),text=void 0;try{text=fs.readFileSync(path,"utf8")}catch(e){if("ENOENT"===e.code)return;throw e}this.parseConfig(text),this.prefix=this.getPrefix()}},Config.prototype.filter=function(name){assert("string"==typeof name);var child=new Config(this.module);return child.prefix=this.prefix,child.suffix=this.suffix,child.fallback=this.fallback,child.argv=this.argv,child.pass=this.pass,_filter(name,this.env,child.env),_filter(name,this.args,child.args),_filter(name,this.query,child.query),_filter(name,this.hash,child.hash),child},Config.prototype.set=function(key,value){assert("string"==typeof key,"Key must be a string."),null!=value&&(key=(key=key.replace(/-/g,"")).toLowerCase(),this.options[key]=value)},Config.prototype.has=function(key){return"number"==typeof key?(assert(key>=0,"Index must be positive."),!(key>=this.argv.length)):(assert("string"==typeof key,"Key must be a string."),key=(key=key.replace(/-/g,"")).toLowerCase(),null!=this.hash[key]||(null!=this.query[key]||(null!=this.args[key]||(null!=this.env[key]||(null!=this.data[key]||null!=this.options[key])))))},Config.prototype.get=function(key,fallback){if(void 0===fallback&&(fallback=null),Array.isArray(key)){var _iterator3=key,_isArray3=Array.isArray(_iterator3),_i3=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref3;if(_isArray3){if(_i3>=_iterator3.length)break;_ref3=_iterator3[_i3++]}else{if((_i3=_iterator3.next()).done)break;_ref3=_i3.value}var _key=_ref3,value=this.get(_key);if(null!==value)return value}return fallback}return"number"==typeof key?(assert(key>=0,"Index must be positive."),key>=this.argv.length?fallback:null!=this.argv[key]?this.argv[key]:fallback):(assert("string"==typeof key,"Key must be a string."),key=(key=key.replace(/-/g,"")).toLowerCase(),null!=this.hash[key]?this.hash[key]:null!=this.query[key]?this.query[key]:null!=this.args[key]?this.args[key]:null!=this.env[key]?this.env[key]:null!=this.data[key]?this.data[key]:null!=this.options[key]?this.options[key]:fallback)},Config.prototype.typeOf=function(key){var value=this.get(key);return null===value?"null":void 0===value?"undefined":_typeof(value)},Config.prototype.str=function(key,fallback){var value=this.get(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if("string"!=typeof value)throw new Error(fmt(key)+" must be a string.");return value},Config.prototype.int=function(key,fallback){var value=this.get(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if("string"!=typeof value){if("number"!=typeof value)throw new Error(fmt(key)+" must be an int.");if(!Number.isSafeInteger(value))throw new Error(fmt(key)+" must be an int.");return value}if(!/^\-?\d+$/.test(value))throw new Error(fmt(key)+" must be an int.");var num=parseInt(value,10);if(!Number.isSafeInteger(num))throw new Error(fmt(key)+" must be an int.");return num},Config.prototype.uint=function(key,fallback){var value=this.int(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if(value<0)throw new Error(fmt(key)+" must be a uint.");return value},Config.prototype.float=function(key,fallback){var value=this.get(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if("string"!=typeof value){if("number"!=typeof value)throw new Error(fmt(key)+" must be a float.");if(!isFinite(value))throw new Error(fmt(key)+" must be a float.");return value}if(!/^\-?\d*(?:\.\d*)?$/.test(value))throw new Error(fmt(key)+" must be a float.");if(!/\d/.test(value))throw new Error(fmt(key)+" must be a float.");var num=parseFloat(value);if(!isFinite(num))throw new Error(fmt(key)+" must be a float.");return num},Config.prototype.ufloat=function(key,fallback){var value=this.float(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if(value<0)throw new Error(fmt(key)+" must be a positive float.");return value},Config.prototype.fixed=function(key,exp,fallback){var value=this.float(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;try{return function(num,exp){assert("number"==typeof num&&isFinite(num)),assert(Number.isSafeInteger(exp));var str=num.toFixed(exp),sign=1;str.length>0&&"-"===str[0]&&(str=str.substring(1),sign=-1);var hi=str,lo="0",index=str.indexOf(".");-1!==index&&(hi=str.substring(0,index),lo=str.substring(index+1));hi=hi.replace(/^0+/,""),lo=lo.replace(/0+$/,""),assert(hi.length<=16-exp,"Fixed number string exceeds 2^53-1."),assert(lo.length<=exp,"Too many decimal places in fixed number string."),0===hi.length&&(hi="0");for(;lo.length<exp;)lo+="0";0===lo.length&&(lo="0");assert(/^\d+$/.test(hi)&&/^\d+$/.test(lo),"Non-numeric characters in fixed number string."),hi=parseInt(hi,10),lo=parseInt(lo,10);var mult=Math.pow(10,exp),maxLo=Number.MAX_SAFE_INTEGER%mult,maxHi=(Number.MAX_SAFE_INTEGER-maxLo)/mult;return assert(hi<maxHi||hi===maxHi&&lo<=maxLo,"Fixed number string exceeds 2^53-1."),sign*(hi*mult+lo)}(value,exp||0)}catch(e){throw new Error(fmt(key)+" must be a fixed number.")}},Config.prototype.ufixed=function(key,exp,fallback){var value=this.fixed(key,exp);if(void 0===fallback&&(fallback=null),null===value)return fallback;if(value<0)throw new Error(fmt(key)+" must be a positive fixed number.");return value},Config.prototype.bool=function(key,fallback){var value=this.get(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if("number"==typeof value){if(1===value)return!0;if(0===value)return!1}if("string"!=typeof value){if("boolean"!=typeof value)throw new Error(fmt(key)+" must be a boolean.");return value}if("true"===value||"1"===value)return!0;if("false"===value||"0"===value)return!1;throw new Error(fmt(key)+" must be a boolean.")},Config.prototype.buf=function(key,fallback,enc){var value=this.get(key);if(enc||(enc="hex"),void 0===fallback&&(fallback=null),null===value)return fallback;if("string"!=typeof value){if(!Buffer.isBuffer(value))throw new Error(fmt(key)+" must be a buffer.");return value}var data=Buffer.from(value,enc);if(data.length!==Buffer.byteLength(value,enc))throw new Error(fmt(key)+" must be a "+enc+" string.");return data},Config.prototype.array=function(key,fallback){var value=this.get(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if("string"!=typeof value){if(!Array.isArray(value))throw new Error(fmt(key)+" must be an array.");return value}var result=[],_iterator4=value.trim().split(/\s*,\s*/),_isArray4=Array.isArray(_iterator4),_i4=0;for(_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();;){var _ref4;if(_isArray4){if(_i4>=_iterator4.length)break;_ref4=_iterator4[_i4++]}else{if((_i4=_iterator4.next()).done)break;_ref4=_i4.value}var part=_ref4;0!==part.length&&result.push(part)}return result},Config.prototype.obj=function(key,fallback){var value=this.get(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if("object"!==(void 0===value?"undefined":_typeof(value))||Array.isArray(value))throw new Error(fmt(key)+" must be an object.");return value},Config.prototype.func=function(key,fallback){var value=this.get(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if("function"!=typeof value)throw new Error(fmt(key)+" must be a function.");return value},Config.prototype.path=function(key,fallback){var value=this.str(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if(0===value.length)return fallback;switch(value[0]){case"~":value=Path.join(HOME,value.substring(1));break;case"@":value=Path.join(this.prefix,value.substring(1))}return Path.normalize(value)},Config.prototype.mb=function(key,fallback){var value=this.uint(key);return void 0===fallback&&(fallback=null),null===value?fallback:1024*value*1024},Config.prototype.getSuffix=function(){if(!this.suffix)throw new Error("No suffix presented.");var suffix=this.str(this.suffix,this.fallback);return assert(isAlpha(suffix),"Bad suffix."),suffix},Config.prototype.getPrefix=function(){var prefix=this.str("prefix");if(prefix?"~"===prefix[0]&&(prefix=Path.join(HOME,prefix.substring(1))):prefix=Path.join(HOME,"."+this.module),this.suffix){var suffix=this.str(this.suffix);suffix&&(assert(isAlpha(suffix),"Bad suffix."),this.fallback&&suffix!==this.fallback&&(prefix=Path.join(prefix,suffix)))}return Path.normalize(prefix)},Config.prototype.getFile=function(file){var name=this.str("config");return name||Path.join(this.prefix,file)},Config.prototype.location=function(file){return Path.join(this.prefix,file)},Config.prototype.parseConfig=function(text){assert("string"==typeof text,"Config must be text."),65279===text.charCodeAt(0)&&(text=text.substring(1));var num=0,_iterator5=(text=(text=(text=text.replace(/\r\n/g,"\n")).replace(/\r/g,"\n")).replace(/\\\n/g,"")).split("\n"),_isArray5=Array.isArray(_iterator5),_i5=0;for(_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();;){var _ref5;if(_isArray5){if(_i5>=_iterator5.length)break;_ref5=_iterator5[_i5++]}else{if((_i5=_iterator5.next()).done)break;_ref5=_i5.value}var line=_ref5.trim();if(num+=1,0!==line.length&&"#"!==line[0]){var index=line.indexOf(":");if(-1===index)throw new Error("Expected ':' on line "+num+': "'+line+'".');var key=line.substring(0,index).trim();if(!isLowerKey(key=key.replace(/\-/g,"")))throw new Error("Invalid option on line "+num+": "+key+".");var value=line.substring(index+1).trim();if(0!==value.length){var alias=this.alias[key];alias&&(key=alias),this.data[key]=value}}}},Config.prototype.parseArg=function(argv){argv&&"object"===(void 0===argv?"undefined":_typeof(argv))||(argv=process.argv),assert(Array.isArray(argv));for(var last=null,pass=!1,i=2;i<argv.length;i++){var arg=argv[i];if(assert("string"==typeof arg),"--"!==arg)if(pass)this.pass.push(arg);else if(0!==arg.length)if(0!==arg.indexOf("--"))if("-"!==arg[0]){var value=arg;0!==value.length?last?(this.args[last]=value,last=null):this.argv.push(value):last=null}else{last=null;for(var j=1;j<arg.length;j++){var _key2=arg[j];if((_key2<"a"||_key2>"z")&&(_key2<"A"||_key2>"Z")&&(_key2<"0"||_key2>"9")&&"?"!==_key2)throw new Error("Invalid argument: -"+_key2+".");var _alias=this.alias[_key2];_alias&&(_key2=_alias),this.args[_key2]="true",last=_key2}}else{var index=arg.indexOf("="),key=null,_value=null,empty=!1;if(-1!==index?(key=arg.substring(2,index),_value=arg.substring(index+1),last=null,empty=!1):(key=arg.substring(2),_value="true",last=null,empty=!0),!isLowerKey(key=key.replace(/\-/g,"")))throw new Error("Invalid argument: --"+key+".");if(0===_value.length)continue;if(key.length>1){var alias=this.alias[key];alias&&(key=alias)}this.args[key]=_value,empty&&(last=key)}else last=null;else pass=!0}},Config.prototype.parseEnv=function(env){var prefix=this.module;prefix=(prefix=prefix.toUpperCase()).replace(/-/g,"_"),prefix+="_",env&&"object"===(void 0===env?"undefined":_typeof(env))||(env=process.env),assert(env&&"object"===(void 0===env?"undefined":_typeof(env)));var _iterator6=Object.keys(env),_isArray6=Array.isArray(_iterator6),_i6=0;for(_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();;){var _ref6;if(_isArray6){if(_i6>=_iterator6.length)break;_ref6=_iterator6[_i6++]}else{if((_i6=_iterator6.next()).done)break;_ref6=_i6.value}var key=_ref6,value=env[key];if(assert("string"==typeof value),0===key.indexOf(prefix)&&isUpperKey(key=(key=key.substring(prefix.length)).replace(/_/g,""))&&0!==value.length){if((key=key.toLowerCase()).length>1){var alias=this.alias[key];alias&&(key=alias)}this.env[key]=value}}},Config.prototype.parseQuery=function(query){if("string"!=typeof query){if(!global.location)return{};if("string"!=typeof(query=global.location.search))return{}}return this.parseForm(query,"?",this.query)},Config.prototype.parseHash=function(hash){if("string"!=typeof hash){if(!global.location)return{};if("string"!=typeof(hash=global.location.hash))return{}}return this.parseForm(hash,"#",this.hash)},Config.prototype.parseForm=function(query,ch,map){if(assert("string"==typeof query),0!==query.length){query[0]===ch&&(query=query.substring(1));var _iterator7=query.split("&"),_isArray7=Array.isArray(_iterator7),_i7=0;for(_iterator7=_isArray7?_iterator7:_iterator7[Symbol.iterator]();;){var _ref7;if(_isArray7){if(_i7>=_iterator7.length)break;_ref7=_iterator7[_i7++]}else{if((_i7=_iterator7.next()).done)break;_ref7=_i7.value}var pair=_ref7,index=pair.indexOf("="),key=void 0,value=void 0;if(-1!==index?(key=pair.substring(0,index),value=pair.substring(index+1)):(key=pair,value="true"),isLowerKey(key=(key=unescape(key)).replace(/\-/g,""))&&0!==(value=unescape(value)).length){var alias=this.alias[key];alias&&(key=alias),map[key]=value}}}},Config}();function fmt(key){return Array.isArray(key)&&(key=key[0]),"number"==typeof key?"Argument #"+key:key}function unescape(str){try{str=(str=decodeURIComponent(str)).replace(/\+/g," ")}catch(e){}return str=str.replace(/\0/g,"")}function isAlpha(str){return/^[a-z0-9_\-]+$/i.test(str)}function isKey(key){return/^[a-zA-Z0-9]+$/.test(key)}function isLowerKey(key){return!!isKey(key)&&!/[A-Z]/.test(key)}function isUpperKey(key){return!!isKey(key)&&!/[a-z]/.test(key)}function _filter(name,a,b){var _iterator8=Object.keys(a),_isArray8=Array.isArray(_iterator8),_i8=0;for(_iterator8=_isArray8?_iterator8:_iterator8[Symbol.iterator]();;){var _ref8;if(_isArray8){if(_i8>=_iterator8.length)break;_ref8=_iterator8[_i8++]}else{if((_i8=_iterator8.next()).done)break;_ref8=_i8.value}var key=_ref8;if(key.length>name.length&&0===key.indexOf(name)){b[key.substring(name.length)]=a[key]}}}module.exports=Config}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},require("buffer").Buffer)},{"./fs":150,_process:374,assert:146,buffer:269,os:361,path:367}],150:[function(require,module,exports){"use strict";exports.unsupported=!0},{}],151:[function(require,module,exports){"use strict";exports.NodeClient=require("./node"),exports.WalletClient=require("./wallet")},{"./node":152,"./wallet":153}],152:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),NodeClient=function(_Client){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(NodeClient,_Client);function NodeClient(options){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,NodeClient),function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Client.call(this,options))}return NodeClient.prototype.auth=function(){var fn,_ref=(fn=regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,this.call("auth",this.password);case 2:return _context.next=4,this.watchChain();case 4:return _context.next=6,this.watchMempool();case 6:case"end":return _context.stop()}},_callee,this)}),function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})});return function(){return _ref.apply(this,arguments)}}(),NodeClient.prototype.execute=function(name,params){return _Client.prototype.execute.call(this,"/",name,params)},NodeClient.prototype.getMempool=function(){return this.get("/mempool")},NodeClient.prototype.getInfo=function(){return this.get("/")},NodeClient.prototype.getCoinsByAddress=function(address){return assert("string"==typeof address),this.get("/coin/address/"+address)},NodeClient.prototype.getCoinsByAddresses=function(addresses){return assert(Array.isArray(addresses)),this.post("/coin/address",{addresses:addresses})},NodeClient.prototype.getCoin=function(hash,index){return assert("string"==typeof hash),assert(index>>>0===index),this.get("/coin/"+hash+"/"+index)},NodeClient.prototype.getTXByAddress=function(address){return assert("string"==typeof address),this.get("/tx/address/"+address)},NodeClient.prototype.getTXByAddresses=function(addresses){return assert(Array.isArray(addresses)),this.post("/tx/address",{addresses:addresses})},NodeClient.prototype.getTX=function(hash){return assert("string"==typeof hash),this.get("/tx/"+hash)},NodeClient.prototype.getBlock=function(block){return assert("string"==typeof block||"number"==typeof block),this.get("/block/"+block)},NodeClient.prototype.broadcast=function(tx){return assert("string"==typeof tx),this.post("/broadcast",{tx:tx})},NodeClient.prototype.reset=function(height){return this.post("/reset",{height:height})},NodeClient.prototype.watchChain=function(){return this.call("watch chain")},NodeClient.prototype.watchMempool=function(){return this.call("watch mempool")},NodeClient.prototype.getTip=function(){return this.call("get tip")},NodeClient.prototype.getEntry=function(block){return this.call("get entry",block)},NodeClient.prototype.getHashes=function(start,end){return this.call("get hashes",start,end)},NodeClient.prototype.send=function(tx){return assert(Buffer.isBuffer(tx)),this.call("send",tx)},NodeClient.prototype.setFilter=function(filter){return assert(Buffer.isBuffer(filter)),this.call("set filter",filter)},NodeClient.prototype.addFilter=function(chunks){return Array.isArray(chunks)||(chunks=[chunks]),this.call("add filter",chunks)},NodeClient.prototype.resetFilter=function(){return this.call("reset filter")},NodeClient.prototype.estimateFee=function(blocks){return assert(null==blocks||"number"==typeof blocks),this.call("estimate fee",blocks)},NodeClient.prototype.rescan=function(start){return null==start&&(start=0),assert("number"==typeof start||"string"==typeof start),this.call("rescan",start)},NodeClient}(require("bcurl").Client);module.exports=NodeClient}).call(this,{isBuffer:require("../../is-buffer/index.js")})},{"../../is-buffer/index.js":353,assert:146,bcurl:189}],153:[function(require,module,exports){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var assert=require("assert"),EventEmitter=require("events"),WalletClient=function(_Client){_inherits(WalletClient,_Client);function WalletClient(options){_classCallCheck(this,WalletClient);var _this=_possibleConstructorReturn(this,_Client.call(this,options));return _this.wallets=new Map,_this}return WalletClient.prototype.init=function(){var _this2=this;this.bind("tx",function(id,details){_this2.dispatch(id,"tx",details)}),this.bind("confirmed",function(id,details){_this2.dispatch(id,"confirmed",details)}),this.bind("unconfirmed",function(id,details){_this2.dispatch(id,"unconfirmed",details)}),this.bind("conflict",function(id,details){_this2.dispatch(id,"conflict",details)}),this.bind("updated",function(id,details){_this2.dispatch(id,"updated",details)}),this.bind("address",function(id,receive){_this2.dispatch(id,"address",receive)}),this.bind("balance",function(id,balance){_this2.dispatch(id,"balance",balance)})},WalletClient.prototype.dispatch=function(id,event){for(var wallet=this.wallets.get(id),_len=arguments.length,args=Array(_len>2?_len-2:0),_key=2;_key<_len;_key++)args[_key-2]=arguments[_key];wallet&&wallet.emit.apply(wallet,[event].concat(args))},WalletClient.prototype.open=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,_Client.prototype.open.call(this);case 2:this.init();case 3:case"end":return _context.stop()}},_callee,this)}));return function(){return _ref.apply(this,arguments)}}(),WalletClient.prototype.close=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,_Client.prototype.close.call(this);case 2:this.wallets=new Map;case 3:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref2.apply(this,arguments)}}(),WalletClient.prototype.auth=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,this.call("auth",this.password);case 2:case"end":return _context3.stop()}},_callee3,this)}));return function(){return _ref3.apply(this,arguments)}}(),WalletClient.prototype.execute=function(name,params){return _Client.prototype.execute.call(this,"/",name,params)},WalletClient.prototype.wallet=function(id,token){return new Wallet(this,id,token)},WalletClient.prototype.all=function(token){return this.call("join","*",token)},WalletClient.prototype.none=function(){return this.call("leave","*")},WalletClient.prototype.join=function(id,token){return this.call("join",id,token)},WalletClient.prototype.leave=function(id){return this.call("leave",id)},WalletClient.prototype.rescan=function(height){return this.post("/rescan",{height:height})},WalletClient.prototype.resend=function(){return this.post("/resend")},WalletClient.prototype.backup=function(path){return this.post("/backup",{path:path})},WalletClient.prototype.getWallets=function(){return this.get("/wallet")},WalletClient.prototype.createWallet=function(id,options){return this.put("/wallet/"+id,options)},WalletClient.prototype.getHistory=function(id,account){return this.get("/wallet/"+id+"/tx/history",{account:account})},WalletClient.prototype.getCoins=function(id,account){return this.get("/wallet/"+id+"/coin",{account:account})},WalletClient.prototype.getPending=function(id,account){return this.get("/wallet/"+id+"/tx/unconfirmed",{account:account})},WalletClient.prototype.getBalance=function(id,account){return this.get("/wallet/"+id+"/balance",{account:account})},WalletClient.prototype.getLast=function(id,account,limit){return this.get("/wallet/"+id+"/tx/last",{account:account,limit:limit})},WalletClient.prototype.getRange=function(id,account,options){return this.get("/wallet/"+id+"/tx/range",{account:account,start:options.start,end:options.end,limit:options.limit,reverse:options.reverse})},WalletClient.prototype.getTX=function(id,hash){return this.get("/wallet/"+id+"/tx/"+hash)},WalletClient.prototype.getBlocks=function(id){return this.get("/wallet/"+id+"/block")},WalletClient.prototype.getBlock=function(id,height){return this.get("/wallet/"+id+"/block/"+height)},WalletClient.prototype.getCoin=function(id,hash,index){return this.get("/wallet/"+id+"/coin/"+hash+"/"+index)},WalletClient.prototype.zap=function(id,account,age){return this.post("/wallet/"+id+"/zap",{account:account,age:age})},WalletClient.prototype.createTX=function(id,options){return this.post("/wallet/"+id+"/create",options)},WalletClient.prototype.send=function(id,options){return this.post("/wallet/"+id+"/send",options)},WalletClient.prototype.sign=function(id,options){return this.post("/wallet/"+id+"/sign",options)},WalletClient.prototype.getInfo=function(id){return this.get("/wallet/"+id)},WalletClient.prototype.getAccounts=function(id){return this.get("/wallet/"+id+"/account")},WalletClient.prototype.getMaster=function(id){return this.get("/wallet/"+id+"/master")},WalletClient.prototype.getAccount=function(id,account){return this.get("/wallet/"+id+"/account/"+account)},WalletClient.prototype.createAccount=function(id,name,options){return this.put("/wallet/"+id+"/account/"+name,options)},WalletClient.prototype.createAddress=function(id,account){return this.post("/wallet/"+id+"/address",{account:account})},WalletClient.prototype.createChange=function(id,account){return this.post("/wallet/"+id+"/change",{account:account})},WalletClient.prototype.createNested=function(id,account){return this.post("/wallet/"+id+"/nested",{account:account})},WalletClient.prototype.setPassphrase=function(id,passphrase,old){return this.post("/wallet/"+id+"/passphrase",{passphrase:passphrase,old:old})},WalletClient.prototype.retoken=function(id,passphrase){return this.post("/wallet/"+id+"/retoken",{passphrase:passphrase})},WalletClient.prototype.importPrivate=function(id,account,privateKey,passphrase){return this.post("/wallet/"+id+"/import",{account:account,privateKey:privateKey,passphrase:passphrase})},WalletClient.prototype.importPublic=function(id,account,publicKey){return this.post("/wallet/"+id+"/import",{account:account,publicKey:publicKey})},WalletClient.prototype.importAddress=function(id,account,address){return this.post("/wallet/"+id+"/import",{account:account,address:address})},WalletClient.prototype.lockCoin=function(id,hash,index){return this.put("/wallet/"+id+"/locked/"+hash+"/"+index)},WalletClient.prototype.unlockCoin=function(id,hash,index){return this.del("/wallet/"+id+"/locked/"+hash+"/"+index)},WalletClient.prototype.getLocked=function(id){return this.get("/wallet/"+id+"/locked")},WalletClient.prototype.lock=function(id){return this.post("/wallet/"+id+"/lock")},WalletClient.prototype.unlock=function(id,passphrase,timeout){return this.post("/wallet/"+id+"/unlock",{passphrase:passphrase,timeout:timeout})},WalletClient.prototype.getKey=function(id,address){return this.get("/wallet/"+id+"/key/"+address)},WalletClient.prototype.getWIF=function(id,address,passphrase){return this.get("/wallet/"+id+"/wif/"+address,{passphrase:passphrase})},WalletClient.prototype.addSharedKey=function(id,account,accountKey){return this.put("/wallet/"+id+"/shared-key",{account:account,accountKey:accountKey})},WalletClient.prototype.removeSharedKey=function(id,account,accountKey){return this.del("/wallet/"+id+"/shared-key",{account:account,accountKey:accountKey})},WalletClient.prototype.resendWallet=function(id){return this.post("/wallet/"+id+"/resend")},WalletClient}(require("bcurl").Client),Wallet=function(_EventEmitter){_inherits(Wallet,_EventEmitter);function Wallet(parent,id,token){_classCallCheck(this,Wallet);var _this3=_possibleConstructorReturn(this,_EventEmitter.call(this));return _this3.parent=parent,_this3.client=parent.clone(),_this3.client.token=token,_this3.id=id,_this3.token=token,_this3}return Wallet.prototype.open=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,this.parent.join(this.id,this.token);case 2:this.parent.wallets.set(this.id,this);case 3:case"end":return _context4.stop()}},_callee4,this)}));return function(){return _ref4.apply(this,arguments)}}(),Wallet.prototype.close=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,this.parent.leave(this.id);case 2:this.parent.wallets.delete(this.id);case 3:case"end":return _context5.stop()}},_callee5,this)}));return function(){return _ref5.apply(this,arguments)}}(),Wallet.prototype.getHistory=function(account){return this.client.getHistory(this.id,account)},Wallet.prototype.getCoins=function(account){return this.client.getCoins(this.id,account)},Wallet.prototype.getPending=function(account){return this.client.getPending(this.id,account)},Wallet.prototype.getBalance=function(account){return this.client.getBalance(this.id,account)},Wallet.prototype.getLast=function(account,limit){return this.client.getLast(this.id,account,limit)},Wallet.prototype.getRange=function(account,options){return this.client.getRange(this.id,account,options)},Wallet.prototype.getTX=function(hash){return this.client.getTX(this.id,hash)},Wallet.prototype.getBlocks=function(){return this.client.getBlocks(this.id)},Wallet.prototype.getBlock=function(height){return this.client.getBlock(this.id,height)},Wallet.prototype.getCoin=function(hash,index){return this.client.getCoin(this.id,hash,index)},Wallet.prototype.zap=function(account,age){return this.client.zap(this.id,account,age)},Wallet.prototype.createTX=function(options){return this.client.createTX(this.id,options)},Wallet.prototype.send=function(options){return this.client.send(this.id,options)},Wallet.prototype.sign=function(options){return this.client.sign(this.id,options)},Wallet.prototype.getInfo=function(){return this.client.getInfo(this.id)},Wallet.prototype.getAccounts=function(){return this.client.getAccounts(this.id)},Wallet.prototype.getMaster=function(){return this.client.getMaster(this.id)},Wallet.prototype.getAccount=function(account){return this.client.getAccount(this.id,account)},Wallet.prototype.createAccount=function(name,options){return this.client.createAccount(this.id,name,options)},Wallet.prototype.createAddress=function(account){return this.client.createAddress(this.id,account)},Wallet.prototype.createChange=function(account){return this.client.createChange(this.id,account)},Wallet.prototype.createNested=function(account){return this.client.createNested(this.id,account)},Wallet.prototype.setPassphrase=function(passphrase,old){return this.client.setPassphrase(this.id,passphrase,old)},Wallet.prototype.retoken=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(passphrase){var result;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=2,this.client.retoken(this.id,passphrase);case 2:return result=_context6.sent,assert(result),assert("string"==typeof result.token),this.token=result.token,_context6.abrupt("return",result);case 7:case"end":return _context6.stop()}},_callee6,this)}));return function(_x){return _ref6.apply(this,arguments)}}(),Wallet.prototype.importPrivate=function(account,privateKey,passphrase){return this.client.importPrivate(this.id,account,privateKey,passphrase)},Wallet.prototype.importPublic=function(account,publicKey){return this.client.importPublic(this.id,account,publicKey)},Wallet.prototype.importAddress=function(account,address){return this.client.importAddress(this.id,account,address)},Wallet.prototype.lockCoin=function(hash,index){return this.client.lockCoin(this.id,hash,index)},Wallet.prototype.unlockCoin=function(hash,index){return this.client.unlockCoin(this.id,hash,index)},Wallet.prototype.getLocked=function(){return this.client.getLocked(this.id)},Wallet.prototype.lock=function(){return this.client.lock(this.id)},Wallet.prototype.unlock=function(passphrase,timeout){return this.client.unlock(this.id,passphrase,timeout)},Wallet.prototype.getKey=function(address){return this.client.getKey(this.id,address)},Wallet.prototype.getWIF=function(address,passphrase){return this.client.getWIF(this.id,address,passphrase)},Wallet.prototype.addSharedKey=function(account,accountKey){return this.client.addSharedKey(this.id,account,accountKey)},Wallet.prototype.removeSharedKey=function(account,accountKey){return this.client.removeSharedKey(this.id,account,accountKey)},Wallet.prototype.resend=function(){return this.client.resendWallet(this.id)},Wallet}(EventEmitter);module.exports=WalletClient},{assert:146,bcurl:189,events:334}],154:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),ChaCha20=require("./chacha20"),Poly1305=require("./poly1305"),AEAD=function(){function AEAD(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AEAD),this.chacha20=new ChaCha20,this.poly1305=new Poly1305,this.aadLen=0,this.cipherLen=0,this.polyKey=null}return AEAD.prototype.init=function(key,iv){var polyKey=Buffer.allocUnsafe(32);polyKey.fill(0),this.chacha20.init(key,iv),this.chacha20.encrypt(polyKey),this.poly1305.init(polyKey),this.chacha20.encrypt(Buffer.allocUnsafe(32)),assert(1===this.chacha20.getCounter()),this.polyKey=polyKey,this.aadLen=0,this.cipherLen=0},AEAD.prototype.aad=function(data){assert(0===this.cipherLen,"Cannot update aad."),this.poly1305.update(data),this.aadLen+=data.length},AEAD.prototype.encrypt=function(data){return 0===this.cipherLen&&this.pad16(this.aadLen),this.chacha20.encrypt(data),this.poly1305.update(data),this.cipherLen+=data.length,data},AEAD.prototype.decrypt=function(data){return 0===this.cipherLen&&this.pad16(this.aadLen),this.cipherLen+=data.length,this.poly1305.update(data),this.chacha20.encrypt(data),data},AEAD.prototype.auth=function(data){return 0===this.cipherLen&&this.pad16(this.aadLen),this.cipherLen+=data.length,this.poly1305.update(data),data},AEAD.prototype.final=function(){var len=Buffer.allocUnsafe(16),lo=void 0,hi=void 0;return lo=this.aadLen%4294967296,hi=(this.aadLen-lo)/4294967296,len.writeUInt32LE(lo,0,!0),len.writeUInt32LE(hi,4,!0),lo=this.cipherLen%4294967296,hi=(this.cipherLen-lo)/4294967296,len.writeUInt32LE(lo,8,!0),len.writeUInt32LE(hi,12,!0),0===this.cipherLen&&this.pad16(this.aadLen),this.pad16(this.cipherLen),this.poly1305.update(len),this.poly1305.final()},AEAD.prototype.pad16=function(size){if(0!==(size%=16)){var pad=Buffer.allocUnsafe(16-size);pad.fill(0),this.poly1305.update(pad)}},AEAD}();module.exports=AEAD}).call(this,require("buffer").Buffer)},{"./chacha20":157,"./poly1305":179,assert:146,buffer:269}],155:[function(require,module,exports){"use strict";module.exports=require("./js/aes")},{"./js/aes":163}],156:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert");module.exports=function(a,b){if(assert(Buffer.isBuffer(a)),assert(Buffer.isBuffer(b)),0===b.length)return 0===a.length;for(var res=a.length^b.length,i=0;i<a.length;i++)res|=a[i]^b[i%b.length];return 0===res}}).call(this,{isBuffer:require("../../is-buffer/index.js")})},{"../../is-buffer/index.js":353,assert:146}],157:[function(require,module,exports){"use strict";module.exports=require("./js/chacha20")},{"./js/chacha20":164}],158:[function(require,module,exports){"use strict";module.exports=require("./js/cleanse")},{"./js/cleanse":165}],159:[function(require,module,exports){"use strict";module.exports=require("./js/hash160")},{"./js/hash160":166}],160:[function(require,module,exports){"use strict";module.exports=require("./js/hash256")},{"./js/hash256":167}],161:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert");exports.extract=function(alg,ikm,key){return assert(alg&&"string"==typeof alg.name),assert(Buffer.isBuffer(ikm)),assert(Buffer.isBuffer(key)),alg.mac(ikm,key)},exports.expand=function(alg,prk,info,len){assert(alg&&"string"==typeof alg.name),assert(Buffer.isBuffer(prk)),assert(Buffer.isBuffer(info)),assert(len>>>0===len);var size=alg.digest(Buffer.alloc(0)).length,blocks=Math.ceil(len/size);if(blocks>255)throw new Error("Too many blocks.");var okm=Buffer.allocUnsafe(len);if(0===blocks)return okm;var buf=Buffer.allocUnsafe(size+info.length+1);info.copy(buf,size),buf[buf.length-1]=1;var out=alg.mac(buf.slice(size),prk);out.copy(okm,0);for(var i=1;i<blocks;i++)out.copy(buf,0),buf[buf.length-1]+=1,(out=alg.mac(buf,prk)).copy(okm,i*size);return okm}}).call(this,require("buffer").Buffer)},{assert:146,buffer:269}],162:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),HMAC=function(){function HMAC(Hash,size){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HMAC),assert("function"==typeof Hash),assert(size>>>0===size),this.hash=Hash,this.size=size,this.inner=new Hash,this.outer=new Hash}return HMAC.prototype.init=function(key){assert(Buffer.isBuffer(key)),key.length>this.size&&(key=this.hash.digest(key),assert(key.length<=this.size));for(var pad=Buffer.allocUnsafe(this.size),i=0;i<key.length;i++)pad[i]=54^key[i];for(var _i=key.length;_i<pad.length;_i++)pad[_i]=54;this.inner.init(),this.inner.update(pad);for(var _i2=0;_i2<key.length;_i2++)pad[_i2]=92^key[_i2];for(var _i3=key.length;_i3<pad.length;_i3++)pad[_i3]=92;return this.outer.init(),this.outer.update(pad),this},HMAC.prototype.update=function(data){return this.inner.update(data),this},HMAC.prototype.final=function(){return this.outer.update(this.inner.final()),this.outer.final()},HMAC}();module.exports=HMAC}).call(this,require("buffer").Buffer)},{assert:146,buffer:269}],163:[function(require,module,exports){(function(Buffer){"use strict";function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),DUMMY=Buffer.alloc(0),TE0=new Uint32Array([3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986]),TE1=new Uint32Array([2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766]),TE2=new Uint32Array([1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126]),TE3=new Uint32Array([1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436]),TD0=new Uint32Array([1374988112,2118214995,437757123,975658646,1001089995,530400753,2902087851,1273168787,540080725,2910219766,2295101073,4110568485,1340463100,3307916247,641025152,3043140495,3736164937,632953703,1172967064,1576976609,3274667266,2169303058,2370213795,1809054150,59727847,361929877,3211623147,2505202138,3569255213,1484005843,1239443753,2395588676,1975683434,4102977912,2572697195,666464733,3202437046,4035489047,3374361702,2110667444,1675577880,3843699074,2538681184,1649639237,2976151520,3144396420,4269907996,4178062228,1883793496,2403728665,2497604743,1383856311,2876494627,1917518562,3810496343,1716890410,3001755655,800440835,2261089178,3543599269,807962610,599762354,33778362,3977675356,2328828971,2809771154,4077384432,1315562145,1708848333,101039829,3509871135,3299278474,875451293,2733856160,92987698,2767645557,193195065,1080094634,1584504582,3178106961,1042385657,2531067453,3711829422,1306967366,2438237621,1908694277,67556463,1615861247,429456164,3602770327,2302690252,1742315127,2968011453,126454664,3877198648,2043211483,2709260871,2084704233,4169408201,0,159417987,841739592,504459436,1817866830,4245618683,260388950,1034867998,908933415,168810852,1750902305,2606453969,607530554,202008497,2472011535,3035535058,463180190,2160117071,1641816226,1517767529,470948374,3801332234,3231722213,1008918595,303765277,235474187,4069246893,766945465,337553864,1475418501,2943682380,4003061179,2743034109,4144047775,1551037884,1147550661,1543208500,2336434550,3408119516,3069049960,3102011747,3610369226,1113818384,328671808,2227573024,2236228733,3535486456,2935566865,3341394285,496906059,3702665459,226906860,2009195472,733156972,2842737049,294930682,1206477858,2835123396,2700099354,1451044056,573804783,2269728455,3644379585,2362090238,2564033334,2801107407,2776292904,3669462566,1068351396,742039012,1350078989,1784663195,1417561698,4136440770,2430122216,775550814,2193862645,2673705150,1775276924,1876241833,3475313331,3366754619,270040487,3902563182,3678124923,3441850377,1851332852,3969562369,2203032232,3868552805,2868897406,566021896,4011190502,3135740889,1248802510,3936291284,699432150,832877231,708780849,3332740144,899835584,1951317047,4236429990,3767586992,866637845,4043610186,1106041591,2144161806,395441711,1984812685,1139781709,3433712980,3835036895,2664543715,1282050075,3240894392,1181045119,2640243204,25965917,4203181171,4211818798,3009879386,2463879762,3910161971,1842759443,2597806476,933301370,1509430414,3943906441,3467192302,3076639029,3776767469,2051518780,2631065433,1441952575,404016761,1942435775,1408749034,1610459739,3745345300,2017778566,3400528769,3110650942,941896748,3265478751,371049330,3168937228,675039627,4279080257,967311729,135050206,3635733660,1683407248,2076935265,3576870512,1215061108,3501741890]),TD1=new Uint32Array([1347548327,1400783205,3273267108,2520393566,3409685355,4045380933,2880240216,2471224067,1428173050,4138563181,2441661558,636813900,4233094615,3620022987,2149987652,2411029155,1239331162,1730525723,2554718734,3781033664,46346101,310463728,2743944855,3328955385,3875770207,2501218972,3955191162,3667219033,768917123,3545789473,692707433,1150208456,1786102409,2029293177,1805211710,3710368113,3065962831,401639597,1724457132,3028143674,409198410,2196052529,1620529459,1164071807,3769721975,2226875310,486441376,2499348523,1483753576,428819965,2274680428,3075636216,598438867,3799141122,1474502543,711349675,129166120,53458370,2592523643,2782082824,4063242375,2988687269,3120694122,1559041666,730517276,2460449204,4042459122,2706270690,3446004468,3573941694,533804130,2328143614,2637442643,2695033685,839224033,1973745387,957055980,2856345839,106852767,1371368976,4181598602,1033297158,2933734917,1179510461,3046200461,91341917,1862534868,4284502037,605657339,2547432937,3431546947,2003294622,3182487618,2282195339,954669403,3682191598,1201765386,3917234703,3388507166,0,2198438022,1211247597,2887651696,1315723890,4227665663,1443857720,507358933,657861945,1678381017,560487590,3516619604,975451694,2970356327,261314535,3535072918,2652609425,1333838021,2724322336,1767536459,370938394,182621114,3854606378,1128014560,487725847,185469197,2918353863,3106780840,3356761769,2237133081,1286567175,3152976349,4255350624,2683765030,3160175349,3309594171,878443390,1988838185,3704300486,1756818940,1673061617,3403100636,272786309,1075025698,545572369,2105887268,4174560061,296679730,1841768865,1260232239,4091327024,3960309330,3497509347,1814803222,2578018489,4195456072,575138148,3299409036,446754879,3629546796,4011996048,3347532110,3252238545,4270639778,915985419,3483825537,681933534,651868046,2755636671,3828103837,223377554,2607439820,1649704518,3270937875,3901806776,1580087799,4118987695,3198115200,2087309459,2842678573,3016697106,1003007129,2802849917,1860738147,2077965243,164439672,4100872472,32283319,2827177882,1709610350,2125135846,136428751,3874428392,3652904859,3460984630,3572145929,3593056380,2939266226,824852259,818324884,3224740454,930369212,2801566410,2967507152,355706840,1257309336,4148292826,243256656,790073846,2373340630,1296297904,1422699085,3756299780,3818836405,457992840,3099667487,2135319889,77422314,1560382517,1945798516,788204353,1521706781,1385356242,870912086,325965383,2358957921,2050466060,2388260884,2313884476,4006521127,901210569,3990953189,1014646705,1503449823,1062597235,2031621326,3212035895,3931371469,1533017514,350174575,2256028891,2177544179,1052338372,741876788,1606591296,1914052035,213705253,2334669897,1107234197,1899603969,3725069491,2631447780,2422494913,1635502980,1893020342,1950903388,1120974935]),TD2=new Uint32Array([2807058932,1699970625,2764249623,1586903591,1808481195,1173430173,1487645946,59984867,4199882800,1844882806,1989249228,1277555970,3623636965,3419915562,1149249077,2744104290,1514790577,459744698,244860394,3235995134,1963115311,4027744588,2544078150,4190530515,1608975247,2627016082,2062270317,1507497298,2200818878,567498868,1764313568,3359936201,2305455554,2037970062,1047239e3,1910319033,1337376481,2904027272,2892417312,984907214,1243112415,830661914,861968209,2135253587,2011214180,2927934315,2686254721,731183368,1750626376,4246310725,1820824798,4172763771,3542330227,48394827,2404901663,2871682645,671593195,3254988725,2073724613,145085239,2280796200,2779915199,1790575107,2187128086,472615631,3029510009,4075877127,3802222185,4107101658,3201631749,1646252340,4270507174,1402811438,1436590835,3778151818,3950355702,3963161475,4020912224,2667994737,273792366,2331590177,104699613,95345982,3175501286,2377486676,1560637892,3564045318,369057872,4213447064,3919042237,1137477952,2658625497,1119727848,2340947849,1530455833,4007360968,172466556,266959938,516552836,0,2256734592,3980931627,1890328081,1917742170,4294704398,945164165,3575528878,958871085,3647212047,2787207260,1423022939,775562294,1739656202,3876557655,2530391278,2443058075,3310321856,547512796,1265195639,437656594,3121275539,719700128,3762502690,387781147,218828297,3350065803,2830708150,2848461854,428169201,122466165,3720081049,1627235199,648017665,4122762354,1002783846,2117360635,695634755,3336358691,4234721005,4049844452,3704280881,2232435299,574624663,287343814,612205898,1039717051,840019705,2708326185,793451934,821288114,1391201670,3822090177,376187827,3113855344,1224348052,1679968233,2361698556,1058709744,752375421,2431590963,1321699145,3519142200,2734591178,188127444,2177869557,3727205754,2384911031,3215212461,2648976442,2450346104,3432737375,1180849278,331544205,3102249176,4150144569,2952102595,2159976285,2474404304,766078933,313773861,2570832044,2108100632,1668212892,3145456443,2013908262,418672217,3070356634,2594734927,1852171925,3867060991,3473416636,3907448597,2614737639,919489135,164948639,2094410160,2997825956,590424639,2486224549,1723872674,3157750862,3399941250,3501252752,3625268135,2555048196,3673637356,1343127501,4130281361,3599595085,2957853679,1297403050,81781910,3051593425,2283490410,532201772,1367295589,3926170974,895287692,1953757831,1093597963,492483431,3528626907,1446242576,1192455638,1636604631,209336225,344873464,1015671571,669961897,3375740769,3857572124,2973530695,3747192018,1933530610,3464042516,935293895,3454686199,2858115069,1863638845,3683022916,4085369519,3292445032,875313188,1080017571,3279033885,621591778,1233856572,2504130317,24197544,3017672716,3835484340,3247465558,2220981195,3060847922,1551124588,1463996600]),TD3=new Uint32Array([4104605777,1097159550,396673818,660510266,2875968315,2638606623,4200115116,3808662347,821712160,1986918061,3430322568,38544885,3856137295,718002117,893681702,1654886325,2975484382,3122358053,3926825029,4274053469,796197571,1290801793,1184342925,3556361835,2405426947,2459735317,1836772287,1381620373,3196267988,1948373848,3764988233,3385345166,3263785589,2390325492,1480485785,3111247143,3780097726,2293045232,548169417,3459953789,3746175075,439452389,1362321559,1400849762,1685577905,1806599355,2174754046,137073913,1214797936,1174215055,3731654548,2079897426,1943217067,1258480242,529487843,1437280870,3945269170,3049390895,3313212038,923313619,679998e3,3215307299,57326082,377642221,3474729866,2041877159,133361907,1776460110,3673476453,96392454,878845905,2801699524,777231668,4082475170,2330014213,4142626212,2213296395,1626319424,1906247262,1846563261,562755902,3708173718,1040559837,3871163981,1418573201,3294430577,114585348,1343618912,2566595609,3186202582,1078185097,3651041127,3896688048,2307622919,425408743,3371096953,2081048481,1108339068,2216610296,0,2156299017,736970802,292596766,1517440620,251657213,2235061775,2933202493,758720310,265905162,1554391400,1532285339,908999204,174567692,1474760595,4002861748,2610011675,3234156416,3693126241,2001430874,303699484,2478443234,2687165888,585122620,454499602,151849742,2345119218,3064510765,514443284,4044981591,1963412655,2581445614,2137062819,19308535,1928707164,1715193156,4219352155,1126790795,600235211,3992742070,3841024952,836553431,1669664834,2535604243,3323011204,1243905413,3141400786,4180808110,698445255,2653899549,2989552604,2253581325,3252932727,3004591147,1891211689,2487810577,3915653703,4237083816,4030667424,2100090966,865136418,1229899655,953270745,3399679628,3557504664,4118925222,2061379749,3079546586,2915017791,983426092,2022837584,1607244650,2118541908,2366882550,3635996816,972512814,3283088770,1568718495,3499326569,3576539503,621982671,2895723464,410887952,2623762152,1002142683,645401037,1494807662,2595684844,1335535747,2507040230,4293295786,3167684641,367585007,3885750714,1865862730,2668221674,2960971305,2763173681,1059270954,2777952454,2724642869,1320957812,2194319100,2429595872,2815956275,77089521,3973773121,3444575871,2448830231,1305906550,4021308739,2857194700,2516901860,3518358430,1787304780,740276417,1699839814,1592394909,2352307457,2272556026,188821243,1729977011,3687994002,274084841,3594982253,3613494426,2701949495,4162096729,322734571,2837966542,1640576439,484830689,1202797690,3537852828,4067639125,349075736,3342319475,4157467219,4255800159,1030690015,1155237496,2951971274,1757691577,607398968,2738905026,499347990,3794078908,1011452712,227885567,2818666809,213114376,3034881240,1455525988,3414450555,850817237,1817998408,3092726480]),TD4=new Uint8Array([82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125]),RCON=new Uint32Array([16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648,452984832,905969664]),AES=function(){function AES(){var bits=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256;_classCallCheck(this,AES),assert(bits>>>0===bits),this.bits=bits,this.rounds=function(bits){switch(bits){case 128:return 10;case 192:return 12;case 256:return 14;default:throw new Error("Bad key size.")}}(bits)}return AES.prototype.encryptKey=function(ukey){assert(Buffer.isBuffer(ukey),"Key must be a buffer"),assert(ukey.length===this.bits/8,"Invalid key size.");var key=new Uint32Array(60);key[0]=readU32(ukey,0),key[1]=readU32(ukey,4),key[2]=readU32(ukey,8),key[3]=readU32(ukey,12);var p=0,i=0,t=void 0;if(128===this.bits){for(;;){var tmp=key[p+3];if(t=key[p],t^=4278190080&TE2[tmp>>>16&255],t^=16711680&TE3[tmp>>>8&255],t^=65280&TE0[tmp>>>0&255],t^=255&TE1[tmp>>>24&255],t^=RCON[i],key[p+4]=t,key[p+5]=key[p+1]^key[p+4],key[p+6]=key[p+2]^key[p+5],key[p+7]=key[p+3]^key[p+6],10===(i+=1))break;p+=4}return key}if(key[p+4]=readU32(ukey,16),key[p+5]=readU32(ukey,20),192===this.bits){for(;;){var _tmp=key[p+5];if(t=key[p],t^=4278190080&TE2[_tmp>>>16&255],t^=16711680&TE3[_tmp>>>8&255],t^=65280&TE0[_tmp>>>0&255],t^=255&TE1[_tmp>>>24&255],t^=RCON[i],key[p+6]=t,key[p+7]=key[p+1]^key[p+6],key[p+8]=key[p+2]^key[p+7],key[p+9]=key[p+3]^key[p+8],8===(i+=1))break;key[p+10]=key[p+4]^key[p+9],key[p+11]=key[p+5]^key[p+10],p+=6}return key}if(key[p+6]=readU32(ukey,24),key[p+7]=readU32(ukey,28),256===this.bits){for(;;){var _tmp2=key[p+7];if(t=key[p],t^=4278190080&TE2[_tmp2>>>16&255],t^=16711680&TE3[_tmp2>>>8&255],t^=65280&TE0[_tmp2>>>0&255],t^=255&TE1[_tmp2>>>24&255],t^=RCON[i],key[p+8]=t,key[p+9]=key[p+1]^key[p+8],key[p+10]=key[p+2]^key[p+9],key[p+11]=key[p+3]^key[p+10],7===(i+=1))break;_tmp2=key[p+11],t=key[p+4],t^=4278190080&TE2[_tmp2>>>24&255],t^=16711680&TE3[_tmp2>>>16&255],t^=65280&TE0[_tmp2>>>8&255],t^=255&TE1[_tmp2>>>0&255],key[p+12]=t,key[p+13]=key[p+5]^key[p+12],key[p+14]=key[p+6]^key[p+13],key[p+15]=key[p+7]^key[p+14],p+=8}return key}throw new Error("Bad key size.")},AES.prototype.decryptKey=function(ukey){for(var key=this.encryptKey(ukey),p=0,i=0,j=4*this.rounds;i<j;i+=4,j-=4){var tmp=key[p+i+0];key[p+i+0]=key[p+j+0],key[p+j+0]=tmp,tmp=key[p+i+1],key[p+i+1]=key[p+j+1],key[p+j+1]=tmp,tmp=key[p+i+2],key[p+i+2]=key[p+j+2],key[p+j+2]=tmp,tmp=key[p+i+3],key[p+i+3]=key[p+j+3],key[p+j+3]=tmp}for(var _i=1;_i<this.rounds;_i++){var t0=void 0,t1=void 0,t2=void 0,t3=void 0;t0=TD0[255&TE1[key[(p+=4)+0]>>>24&255]],t0^=TD1[255&TE1[key[p+0]>>>16&255]],t0^=TD2[255&TE1[key[p+0]>>>8&255]],t0^=TD3[255&TE1[key[p+0]>>>0&255]],t1=TD0[255&TE1[key[p+1]>>>24&255]],t1^=TD1[255&TE1[key[p+1]>>>16&255]],t1^=TD2[255&TE1[key[p+1]>>>8&255]],t1^=TD3[255&TE1[key[p+1]>>>0&255]],t2=TD0[255&TE1[key[p+2]>>>24&255]],t2^=TD1[255&TE1[key[p+2]>>>16&255]],t2^=TD2[255&TE1[key[p+2]>>>8&255]],t2^=TD3[255&TE1[key[p+2]>>>0&255]],t3=TD0[255&TE1[key[p+3]>>>24&255]],t3^=TD1[255&TE1[key[p+3]>>>16&255]],t3^=TD2[255&TE1[key[p+3]>>>8&255]],t3^=TD3[255&TE1[key[p+3]>>>0&255]],key[p+0]=t0,key[p+1]=t1,key[p+2]=t2,key[p+3]=t3}return key},AES.prototype.encryptBlock=function(key,input,ipos,output,opos){for(var s0=readU32(input,ipos+0)^key[0],s1=readU32(input,ipos+4)^key[1],s2=readU32(input,ipos+8)^key[2],s3=readU32(input,ipos+12)^key[3],r=this.rounds>>>1,p=0,t0=void 0,t1=void 0,t2=void 0,t3=void 0;t0=TE0[s0>>>24&255],t0^=TE1[s1>>>16&255],t0^=TE2[s2>>>8&255],t0^=TE3[s3>>>0&255],t0^=key[p+4],t1=TE0[s1>>>24&255],t1^=TE1[s2>>>16&255],t1^=TE2[s3>>>8&255],t1^=TE3[s0>>>0&255],t1^=key[p+5],t2=TE0[s2>>>24&255],t2^=TE1[s3>>>16&255],t2^=TE2[s0>>>8&255],t2^=TE3[s1>>>0&255],t2^=key[p+6],t3=TE0[s3>>>24&255],t3^=TE1[s0>>>16&255],t3^=TE2[s1>>>8&255],t3^=TE3[s2>>>0&255],t3^=key[p+7],p+=8,0!==(r-=1);)s0=TE0[t0>>>24&255],s0^=TE1[t1>>>16&255],s0^=TE2[t2>>>8&255],s0^=TE3[t3>>>0&255],s0^=key[p+0],s1=TE0[t1>>>24&255],s1^=TE1[t2>>>16&255],s1^=TE2[t3>>>8&255],s1^=TE3[t0>>>0&255],s1^=key[p+1],s2=TE0[t2>>>24&255],s2^=TE1[t3>>>16&255],s2^=TE2[t0>>>8&255],s2^=TE3[t1>>>0&255],s2^=key[p+2],s3=TE0[t3>>>24&255],s3^=TE1[t0>>>16&255],s3^=TE2[t1>>>8&255],s3^=TE3[t2>>>0&255],s3^=key[p+3];s0=4278190080&TE2[t0>>>24&255],s0^=16711680&TE3[t1>>>16&255],s0^=65280&TE0[t2>>>8&255],s0^=255&TE1[t3>>>0&255],s0^=key[p+0],s1=4278190080&TE2[t1>>>24&255],s1^=16711680&TE3[t2>>>16&255],s1^=65280&TE0[t3>>>8&255],s1^=255&TE1[t0>>>0&255],s1^=key[p+1],s2=4278190080&TE2[t2>>>24&255],s2^=16711680&TE3[t3>>>16&255],s2^=65280&TE0[t0>>>8&255],s2^=255&TE1[t1>>>0&255],s2^=key[p+2],s3=4278190080&TE2[t3>>>24&255],s3^=16711680&TE3[t0>>>16&255],s3^=65280&TE0[t1>>>8&255],s3^=255&TE1[t2>>>0&255],s3^=key[p+3],writeU32(output,s0,opos+0),writeU32(output,s1,opos+4),writeU32(output,s2,opos+8),writeU32(output,s3,opos+12)},AES.prototype.decryptBlock=function(key,input,ipos,output,opos){for(var s0=readU32(input,ipos+0)^key[0],s1=readU32(input,ipos+4)^key[1],s2=readU32(input,ipos+8)^key[2],s3=readU32(input,ipos+12)^key[3],r=this.rounds>>>1,p=0,t0=void 0,t1=void 0,t2=void 0,t3=void 0;t0=TD0[s0>>>24&255],t0^=TD1[s3>>>16&255],t0^=TD2[s2>>>8&255],t0^=TD3[s1>>>0&255],t0^=key[p+4],t1=TD0[s1>>>24&255],t1^=TD1[s0>>>16&255],t1^=TD2[s3>>>8&255],t1^=TD3[s2>>>0&255],t1^=key[p+5],t2=TD0[s2>>>24&255],t2^=TD1[s1>>>16&255],t2^=TD2[s0>>>8&255],t2^=TD3[s3>>>0&255],t2^=key[p+6],t3=TD0[s3>>>24&255],t3^=TD1[s2>>>16&255],t3^=TD2[s1>>>8&255],t3^=TD3[s0>>>0&255],t3^=key[p+7],p+=8,0!==(r-=1);)s0=TD0[t0>>>24&255],s0^=TD1[t3>>>16&255],s0^=TD2[t2>>>8&255],s0^=TD3[t1>>>0&255],s0^=key[p+0],s1=TD0[t1>>>24&255],s1^=TD1[t0>>>16&255],s1^=TD2[t3>>>8&255],s1^=TD3[t2>>>0&255],s1^=key[p+1],s2=TD0[t2>>>24&255],s2^=TD1[t1>>>16&255],s2^=TD2[t0>>>8&255],s2^=TD3[t3>>>0&255],s2^=key[p+2],s3=TD0[t3>>>24&255],s3^=TD1[t2>>>16&255],s3^=TD2[t1>>>8&255],s3^=TD3[t0>>>0&255],s3^=key[p+3];s0=TD4[t0>>>24&255]<<24,s0^=TD4[t3>>>16&255]<<16,s0^=TD4[t2>>>8&255]<<8,s0^=TD4[t1>>>0&255]<<0,s0^=key[p+0],s1=TD4[t1>>>24&255]<<24,s1^=TD4[t0>>>16&255]<<16,s1^=TD4[t3>>>8&255]<<8,s1^=TD4[t2>>>0&255]<<0,s1^=key[p+1],s2=TD4[t2>>>24&255]<<24,s2^=TD4[t1>>>16&255]<<16,s2^=TD4[t0>>>8&255]<<8,s2^=TD4[t3>>>0&255]<<0,s2^=key[p+2],s3=TD4[t3>>>24&255]<<24,s3^=TD4[t2>>>16&255]<<16,s3^=TD4[t1>>>8&255]<<8,s3^=TD4[t0>>>0&255]<<0,s3^=key[p+3],writeU32(output,s0,opos+0),writeU32(output,s1,opos+4),writeU32(output,s2,opos+8),writeU32(output,s3,opos+12)},AES}(),AESCipher=function(_AES){_inherits(AESCipher,_AES);function AESCipher(){var bits=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256,chain=arguments.length>1&&void 0!==arguments[1]&&arguments[1];_classCallCheck(this,AESCipher);var _this=_possibleConstructorReturn(this,_AES.call(this,bits));return _this.chain=chain,_this.key=null,_this.prev=null,_this.block=Buffer.allocUnsafe(16),_this.ppos=0,_this.bpos=0,_this}return AESCipher.prototype.init=function(key,iv){return assert(Buffer.isBuffer(key)),assert(!this.chain||Buffer.isBuffer(iv)&&16===iv.length),this.key=this.encryptKey(key),this.prev=iv,this.ppos=0,this.bpos=0,this},AESCipher.prototype.update=function(input){assert(Buffer.isBuffer(input)),assert(this.key,"Context already finalized.");var bpos=this.bpos,ilen=input.length,olen=ilen-ilen%16,ipos=0,opos=0;if(this.bpos=(this.bpos+ilen)%16,bpos>0){var want=16-bpos;if(want>ilen&&(want=ilen),input.copy(this.block,bpos,ipos,ipos+want),ilen-=want,ipos+=want,(bpos+=want)<16)return DUMMY;olen+=16}var output=Buffer.allocUnsafe(olen);for(ipos&&(this.encrypt(this.block,0,output,opos),opos+=16);ilen>=16;)this.encrypt(input,ipos,output,opos),opos+=16,ipos+=16,ilen-=16;return ilen>0&&input.copy(this.block,0,ipos,ipos+ilen),output},AESCipher.prototype.final=function(){assert(this.key,"Context already finalized.");var left=16-this.bpos,block=Buffer.from(this.block);block.fill(left,this.bpos,16),this.encrypt(block,0,block,0);for(var i=0;i<60;i++)this.key[i]=0;for(var _i2=0;_i2<16;_i2++)this.block[_i2]=0;return this.key=null,this.prev=null,block},AESCipher.prototype.encrypt=function(input,ipos,output,opos){if(this.chain){for(var i=0;i<16;i++)output[opos+i]=input[ipos+i]^this.prev[this.ppos+i];this.encryptBlock(this.key,output,opos,output,opos),this.prev=output,this.ppos=opos}else this.encryptBlock(this.key,input,ipos,output,opos)},AESCipher.encrypt=function(data,key,iv){var ctx=new AESCipher(arguments.length>3&&void 0!==arguments[3]?arguments[3]:256,arguments.length>4&&void 0!==arguments[4]&&arguments[4]).init(key,iv);return concat(ctx.update(data),ctx.final())},AESCipher}(AES),AESDecipher=function(_AES2){_inherits(AESDecipher,_AES2);function AESDecipher(){var bits=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256,chain=arguments.length>1&&void 0!==arguments[1]&&arguments[1];_classCallCheck(this,AESDecipher);var _this2=_possibleConstructorReturn(this,_AES2.call(this,bits));return _this2.chain=chain,_this2.key=null,_this2.last=null,_this2.prev=null,_this2.block=Buffer.allocUnsafe(16),_this2.ppos=0,_this2.bpos=0,_this2}return AESDecipher.prototype.init=function(key,iv){return assert(Buffer.isBuffer(key)),assert(!this.chain||Buffer.isBuffer(iv)&&16===iv.length),this.key=this.decryptKey(key),this.prev=iv,this.ppos=0,this.bpos=0,this},AESDecipher.prototype.update=function(input){assert(Buffer.isBuffer(input)),assert(this.key,"Context already finalized.");var bpos=this.bpos,ilen=input.length,olen=ilen-ilen%16,ipos=0,opos=0;if(this.bpos=(this.bpos+ilen)%16,bpos>0){var want=16-bpos;if(want>ilen&&(want=ilen),input.copy(this.block,bpos,ipos,ipos+want),ilen-=want,ipos+=want,(bpos+=want)<16)return DUMMY;olen+=16}var output=Buffer.allocUnsafe(olen);for(ipos&&(this.decrypt(this.block,0,output,opos),opos+=16);ilen>=16;)this.decrypt(input,ipos,output,opos),opos+=16,ipos+=16,ilen-=16;return ilen>0&&input.copy(this.block,0,ipos,ipos+ilen),this.last=output,output.slice(0,olen-16)},AESDecipher.prototype.final=function(){assert(this.key,"Context already finalized.");for(var i=0;i<16;i++)this.block[i]=0;for(var _i3=0;_i3<60;_i3++)this.key[_i3]=0;if(this.key=null,this.prev=null,!this.last)throw new Error("Bad decrypt (no data).");var block=this.last;if(this.last=null,0!==this.bpos)throw new Error("Bad decrypt (trailing bytes).");var start=block.length-16,end=block.length,left=block[end-1];if(0===left||left>16)throw new Error("Bad decrypt (padding).");for(var _i4=0;_i4<left;_i4++)if(block[end-=1]!==left)throw new Error("Bad decrypt (padding).");return block.slice(start,end)},AESDecipher.prototype.decrypt=function(input,ipos,output,opos){if(this.chain){this.decryptBlock(this.key,input,ipos,output,opos);for(var i=0;i<16;i++)output[opos+i]=output[opos+i]^this.prev[this.ppos+i];this.prev=input,this.ppos=ipos}else this.decryptBlock(this.key,input,ipos,output,opos)},AESDecipher.decrypt=function(data,key,iv){var ctx=new AESDecipher(arguments.length>3&&void 0!==arguments[3]?arguments[3]:256,arguments.length>4&&void 0!==arguments[4]&&arguments[4]).init(key,iv);return concat(ctx.update(data),ctx.final())},AESDecipher}(AES);exports.encipher=function(data,key,iv){return AESCipher.encrypt(data,key,iv,256,!0)},exports.decipher=function(data,key,iv){return AESDecipher.decrypt(data,key,iv,256,!0)};function readU32(data,i){return data[i+0]<<24^data[i+1]<<16^data[i+2]<<8^data[i+3]}function writeU32(data,value,i){data[i+0]=value>>>24&255,data[i+1]=value>>>16&255,data[i+2]=value>>>8&255,data[i+3]=255&value}function concat(a,b){var data=Buffer.allocUnsafe(a.length+b.length);return a.copy(data,0),b.copy(data,a.length),data}}).call(this,require("buffer").Buffer)},{assert:146,buffer:269}],164:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),BIG_ENDIAN=0===new Int8Array(new Int16Array([1]).buffer)[0],ChaCha20=function(){function ChaCha20(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ChaCha20),this.state=new Uint32Array(16),this.stream=new Uint32Array(16),this.bytes=new Uint8Array(this.stream.buffer),BIG_ENDIAN&&(this.bytes=Buffer.allocUnsafe(64)),this.pos=0,this.ivSize=0}return ChaCha20.prototype.init=function(key,iv,counter){key&&this.initKey(key),iv&&this.initIV(iv,counter)},ChaCha20.prototype.initKey=function(key){this.state[0]=1634760805,this.state[1]=857760878,this.state[2]=2036477234,this.state[3]=1797285236,this.state[4]=key.readUInt32LE(0,!0),this.state[5]=key.readUInt32LE(4,!0),this.state[6]=key.readUInt32LE(8,!0),this.state[7]=key.readUInt32LE(12,!0),this.state[8]=key.readUInt32LE(16,!0),this.state[9]=key.readUInt32LE(20,!0),this.state[10]=key.readUInt32LE(24,!0),this.state[11]=key.readUInt32LE(28,!0),this.state[12]=0,this.pos=4294967295},ChaCha20.prototype.initIV=function(iv,counter){8===iv.length?(this.state[13]=0,this.state[14]=iv.readUInt32LE(0,!0),this.state[15]=iv.readUInt32LE(4,!0)):12===iv.length?(this.state[13]=iv.readUInt32LE(0,!0),this.state[14]=iv.readUInt32LE(4,!0),this.state[15]=iv.readUInt32LE(8,!0)):assert(!1,"Bad iv size."),this.ivSize=8*iv.length,this.setCounter(counter)},ChaCha20.prototype.encrypt=function(data){for(var i=0;i<data.length;i++){if(this.pos>=64){for(var j=0;j<16;j++)this.stream[j]=this.state[j];for(var _j=0;_j<10;_j++)qround(this.stream,0,4,8,12),qround(this.stream,1,5,9,13),qround(this.stream,2,6,10,14),qround(this.stream,3,7,11,15),qround(this.stream,0,5,10,15),qround(this.stream,1,6,11,12),qround(this.stream,2,7,8,13),qround(this.stream,3,4,9,14);for(var _j2=0;_j2<16;_j2++)this.stream[_j2]+=this.state[_j2],BIG_ENDIAN&&this.bytes.writeUInt32LE(this.stream[_j2],4*_j2,!0);this.state[12]+=1,0===this.state[12]&&64===this.ivSize&&(this.state[13]+=1),this.pos=0}data[i]^=this.bytes[this.pos++]}return data},ChaCha20.prototype.setCounter=function(counter){counter||(counter=0);var lo=counter%4294967296,hi=(counter-lo)/4294967296;this.state[12]=lo,64===this.ivSize&&(this.state[13]=hi)},ChaCha20.prototype.getCounter=function(){var lo=this.state[12],hi=this.state[13];return 64===this.ivSize?4294967296*hi+lo:lo},ChaCha20}();function qround(x,a,b,c,d){x[a]+=x[b],x[d]=rotl32(x[d]^x[a],16),x[c]+=x[d],x[b]=rotl32(x[b]^x[c],12),x[a]+=x[b],x[d]=rotl32(x[d]^x[a],8),x[c]+=x[d],x[b]=rotl32(x[b]^x[c],7)}function rotl32(w,b){return w<<b|w>>>32-b}module.exports=ChaCha20}).call(this,require("buffer").Buffer)},{assert:146,buffer:269}],165:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),counter=0;module.exports=function(data){assert(Buffer.isBuffer(data));for(var ctr=counter,i=0;i<data.length;i++)data[i]=255&ctr,ctr+=i;counter=ctr>>>0}}).call(this,{isBuffer:require("../../../is-buffer/index.js")})},{"../../../is-buffer/index.js":353,assert:146}],166:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),SHA256=require("./sha256"),RIPEMD160=require("./ripemd160"),HMAC=require("../hmac"),rmd=new RIPEMD160,ctx=null,Hash160=function(){function Hash160(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Hash160),this.ctx=new SHA256}return Hash160.prototype.init=function(){return this.ctx.init(),this},Hash160.prototype.update=function(data){return this.ctx.update(data),this},Hash160.prototype.final=function(){var out=Buffer.allocUnsafe(32);return this.ctx._final(out),rmd.init(),rmd.update(out),rmd._final(out),out.slice(0,20)},Hash160.hash=function(){return new Hash160},Hash160.hmac=function(){return new HMAC(Hash160,64)},Hash160.digest=function(data){return ctx.init().update(data).final()},Hash160.root=function(left,right){return assert(Buffer.isBuffer(left)&&20===left.length),assert(Buffer.isBuffer(right)&&20===right.length),ctx.init().update(left).update(right).final()},Hash160.mac=function(data,key){return this.hmac().init(key).update(data).final()},Hash160}();ctx=new Hash160,module.exports=Hash160}).call(this,require("buffer").Buffer)},{"../hmac":162,"./ripemd160":171,"./sha256":174,assert:146,buffer:269}],167:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),SHA256=require("./sha256"),HMAC=require("../hmac"),ctx=null,Hash256=function(){function Hash256(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Hash256),this.ctx=new SHA256}return Hash256.prototype.init=function(){return this.ctx.init(),this},Hash256.prototype.update=function(data){return this.ctx.update(data),this},Hash256.prototype.final=function(){var out=Buffer.allocUnsafe(32);return this.ctx._final(out),this.ctx.init(),this.ctx.update(out),this.ctx._final(out),out},Hash256.hash=function(){return new Hash256},Hash256.hmac=function(){return new HMAC(Hash256,64)},Hash256.digest=function(data){return ctx.init().update(data).final()},Hash256.root=function(left,right){return assert(Buffer.isBuffer(left)&&32===left.length),assert(Buffer.isBuffer(right)&&32===right.length),ctx.init().update(left).update(right).final()},Hash256.mac=function(data,key){return this.hmac().init(key).update(data).final()},Hash256}();ctx=new Hash256,module.exports=Hash256}).call(this,require("buffer").Buffer)},{"../hmac":162,"./sha256":174,assert:146,buffer:269}],168:[function(require,module,exports){(function(global,Buffer){"use strict";var assert=require("assert"),subtle=(global.crypto||global.msCrypto||{}).subtle||{};exports.derive=function(alg,key,salt,iter,len){assert(alg&&"string"==typeof alg.name),assert(Buffer.isBuffer(key)),assert(Buffer.isBuffer(salt)),assert(iter>>>0===iter),assert(len>>>0===len);var size=alg.digest(Buffer.alloc(0)).length,blocks=Math.ceil(len/size),out=Buffer.allocUnsafe(len),buf=Buffer.allocUnsafe(salt.length+4),block=Buffer.allocUnsafe(size),pos=0;salt.copy(buf,0);for(var i=0;i<blocks;i++){buf.writeUInt32BE(i+1,salt.length,!0);var mac=alg.mac(buf,key);mac.copy(block,0);for(var j=1;j<iter;j++){mac=alg.mac(mac,key);for(var k=0;k<size;k++)block[k]^=mac[k]}block.copy(out,pos),pos+=size}return out},exports.deriveAsync=function(){var fn,_ref=(fn=regeneratorRuntime.mark(function _callee(alg,key,salt,iter,len){var algo,use,hash,options,imported,data;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(assert(alg&&"string"==typeof alg.name),assert(Buffer.isBuffer(key)),assert(Buffer.isBuffer(salt)),assert(iter>>>0===iter),assert(len>>>0===len),algo={name:"PBKDF2"},use=["deriveBits"],hash=getHash(alg),subtle.importKey&&subtle.deriveBits&&hash){_context.next=10;break}return _context.abrupt("return",exports.derive(alg,key,salt,iter,len));case 10:return options={name:"PBKDF2",salt:salt,iterations:iter,hash:hash},_context.next=13,subtle.importKey("raw",key,algo,!1,use);case 13:return imported=_context.sent,_context.next=16,subtle.deriveBits(options,imported,8*len);case 16:return data=_context.sent,_context.abrupt("return",Buffer.from(data));case 18:case"end":return _context.stop()}},_callee,this)}),function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})});return function(_x,_x2,_x3,_x4,_x5){return _ref.apply(this,arguments)}}();function getHash(alg){switch(alg.name.toLowerCase()){case"sha1":return"SHA-1";case"sha256":return"SHA-256";case"sha384":return"SHA-384";case"sha512":return"SHA-512";default:return null}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},require("buffer").Buffer)},{assert:146,buffer:269}],169:[function(require,module,exports){(function(Buffer){"use strict";var Poly1305=function(){function Poly1305(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Poly1305),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.fin=0,this.leftover=0,this.buffer=Buffer.allocUnsafe(16)}return Poly1305.prototype.init=function(key){var t0=key.readUInt16LE(0,!0),t1=key.readUInt16LE(2,!0),t2=key.readUInt16LE(4,!0),t3=key.readUInt16LE(6,!0),t4=key.readUInt16LE(8,!0),t5=key.readUInt16LE(10,!0),t6=key.readUInt16LE(12,!0),t7=key.readUInt16LE(14,!0);this.r[0]=8191&t0,this.r[1]=8191&(t0>>>13|t1<<3),this.r[2]=7939&(t1>>>10|t2<<6),this.r[3]=8191&(t2>>>7|t3<<9),this.r[4]=255&(t3>>>4|t4<<12),this.r[5]=t4>>>1&8190,this.r[6]=8191&(t4>>>14|t5<<2),this.r[7]=8065&(t5>>>11|t6<<5),this.r[8]=8191&(t6>>>8|t7<<8),this.r[9]=t7>>>5&127;for(var i=0;i<10;i++)this.h[i]=0;for(var _i=0;_i<8;_i++)this.pad[_i]=key.readUInt16LE(16+2*_i,!0);this.leftover=0,this.fin=0},Poly1305.prototype.blocks=function(data,bytes,m){for(var hibit=this.fin?0:2048,d=new Uint32Array(10);bytes>=16;){var t0=data.readUInt16LE(m+0,!0),t1=data.readUInt16LE(m+2,!0),t2=data.readUInt16LE(m+4,!0),t3=data.readUInt16LE(m+6,!0),t4=data.readUInt16LE(m+8,!0),t5=data.readUInt16LE(m+10,!0),t6=data.readUInt16LE(m+12,!0),t7=data.readUInt16LE(m+14,!0);this.h[0]+=8191&t0,this.h[1]+=8191&(t0>>>13|t1<<3),this.h[2]+=8191&(t1>>>10|t2<<6),this.h[3]+=8191&(t2>>>7|t3<<9),this.h[4]+=8191&(t3>>>4|t4<<12),this.h[5]+=t4>>>1&8191,this.h[6]+=8191&(t4>>>14|t5<<2),this.h[7]+=8191&(t5>>>11|t6<<5),this.h[8]+=8191&(t6>>>8|t7<<8),this.h[9]+=t7>>>5|hibit;for(var c=0,i=0;i<10;i++){d[i]=c;for(var j=0;j<10;j++){var a=this.h[j];a*=j<=i?this.r[i-j]:5*this.r[i+10-j],d[i]+=a,4===j&&(c=d[i]>>>13,d[i]&=8191)}c+=d[i]>>>13,d[i]&=8191}c=(c<<2)+c,c+=d[0],d[0]=8191&c,c>>>=13,d[1]+=c;for(var _i2=0;_i2<10;_i2++)this.h[_i2]=d[_i2];m+=16,bytes-=16}},Poly1305.prototype.update=function(data){var bytes=data.length,m=0;if(this.leftover){var want=16-this.leftover;want>bytes&&(want=bytes);for(var i=0;i<want;i++)this.buffer[this.leftover+i]=data[m+i];if(bytes-=want,m+=want,this.leftover+=want,this.leftover<16)return;this.blocks(this.buffer,16,0),this.leftover=0}if(bytes>=16){var _want=-16&bytes;this.blocks(data,_want,m),m+=_want,bytes-=_want}if(bytes){for(var _i3=0;_i3<bytes;_i3++)this.buffer[this.leftover+_i3]=data[m+_i3];this.leftover+=bytes}},Poly1305.prototype.final=function(){var mac=Buffer.allocUnsafe(16),g=new Uint16Array(10);if(this.leftover){var i=this.leftover;for(this.buffer[i++]=1;i<16;i++)this.buffer[i]=0;this.fin=1,this.blocks(this.buffer,16,0)}var c=this.h[1]>>>13;this.h[1]&=8191;for(var _i4=2;_i4<10;_i4++)this.h[_i4]+=c,c=this.h[_i4]>>>13,this.h[_i4]&=8191;this.h[0]+=5*c,c=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=c,c=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=c,g[0]=this.h[0]+5,c=g[0]>>>13,g[0]&=8191;for(var _i5=1;_i5<10;_i5++)g[_i5]=this.h[_i5]+c,c=g[_i5]>>>13,g[_i5]&=8191;for(var mask=(1^c)-1,_i6=0;_i6<10;_i6++)g[_i6]&=mask;mask=~mask;for(var _i7=0;_i7<10;_i7++)this.h[_i7]=this.h[_i7]&mask|g[_i7];this.h[0]=65535&(this.h[0]|this.h[1]<<13),this.h[1]=65535&(this.h[1]>>>3|this.h[2]<<10),this.h[2]=65535&(this.h[2]>>>6|this.h[3]<<7),this.h[3]=65535&(this.h[3]>>>9|this.h[4]<<4),this.h[4]=65535&(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14),this.h[5]=65535&(this.h[6]>>>2|this.h[7]<<11),this.h[6]=65535&(this.h[7]>>>5|this.h[8]<<8),this.h[7]=65535&(this.h[8]>>>8|this.h[9]<<5);var f=this.h[0]+this.pad[0];this.h[0]=f;for(var _i8=1;_i8<8;_i8++)f=this.h[_i8]+this.pad[_i8]+(f>>>16),this.h[_i8]=f;for(var _i9=0;_i9<8;_i9++)mac.writeUInt16LE(this.h[_i9],2*_i9,!0);for(var _i10=0;_i10<10;_i10++)this.h[_i10]=0;for(var _i11=0;_i11<10;_i11++)this.r[_i11]=0;for(var _i12=0;_i12<8;_i12++)this.pad[_i12]=0;return mac},Poly1305.auth=function(msg,key){var poly=new Poly1305;return poly.init(key),poly.update(msg),poly.final()},Poly1305.verify=function(mac1,mac2){for(var dif=0,i=0;i<16;i++)dif|=mac1[i]^mac2[i];return 0!=(1&(dif=dif-1>>>31))},Poly1305}();module.exports=Poly1305}).call(this,require("buffer").Buffer)},{buffer:269}],170:[function(require,module,exports){(function(global,Buffer){"use strict";var assert=require("assert"),crypto=global.crypto||global.msCrypto||{};exports.randomBytes=function(size){assert(size>>>0===size);var data=new Uint8Array(size);return crypto.getRandomValues(data),Buffer.from(data.buffer)},crypto.getRandomValues||(exports.randomBytes=function(size){assert(size>>>0===size);for(var data=Buffer.allocUnsafe(size),i=0;i<data.length;i++)data[i]=Math.floor(256*Math.random());return data}),exports.randomInt=function(){return exports.randomBytes(4).readUInt32LE(0,!0)},exports.randomRange=function(min,max){assert("number"==typeof min),assert("number"==typeof max);var num=exports.randomInt();return Math.floor(num/4294967296*(max-min)+min)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},require("buffer").Buffer)},{assert:146,buffer:269}],171:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),HMAC=require("../hmac"),FINALIZED=-1,DESC=Buffer.alloc(8,0),PADDING=Buffer.alloc(64,0);PADDING[0]=128;var r=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],rh=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],s=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],sh=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],ctx=null,RIPEMD160=function(){function RIPEMD160(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,RIPEMD160),this.state=new Uint32Array(5),this.msg=new Uint32Array(16),this.block=Buffer.allocUnsafe(64),this.size=FINALIZED}return RIPEMD160.prototype.init=function(){return this.state[0]=1732584193,this.state[1]=4023233417,this.state[2]=2562383102,this.state[3]=271733878,this.state[4]=3285377520,this.size=0,this},RIPEMD160.prototype.update=function(data){return assert(Buffer.isBuffer(data)),this._update(data,data.length),this},RIPEMD160.prototype.final=function(){return this._final(Buffer.allocUnsafe(20))},RIPEMD160.prototype._update=function(data,len){assert(this.size!==FINALIZED,"Context already finalized.");var pos=63&this.size,off=0;if(this.size+=len,pos>0){var want=64-pos;if(want>len&&(want=len),data.copy(this.block,pos,off,off+want),len-=want,off+=want,(pos+=want)<64)return;this.transform(this.block,0)}for(;len>=64;)this.transform(data,off),off+=64,len-=64;len>0&&data.copy(this.block,0,off,off+len)},RIPEMD160.prototype._final=function(out){assert(this.size!==FINALIZED,"Context already finalized.");var pos=this.size%64,len=8*this.size;writeU32(DESC,len,0),writeU32(DESC,len*(1/4294967296),4),this._update(PADDING,1+(119-pos)%64),this._update(DESC,8);for(var i=0;i<5;i++)writeU32(out,this.state[i],4*i),this.state[i]=0;for(var _i=0;_i<16;_i++)this.msg[_i]=0;for(var _i2=0;_i2<64;_i2++)this.block[_i2]=0;return this.size=FINALIZED,out},RIPEMD160.prototype.transform=function(chunk,pos){for(var W=this.msg,A=this.state[0],B=this.state[1],C=this.state[2],D=this.state[3],E=this.state[4],Ah=A,Bh=B,Ch=C,Dh=D,Eh=E,i=0;i<16;i++)W[i]=(buf=chunk,offset=pos+4*i,16777216*(255&buf[offset+3])+((255&buf[offset+2])<<16|(255&buf[offset+1])<<8|255&buf[offset]));for(var buf,offset,j=0;j<80;j++){var a=A+f(j,B,C,D)+W[r[j]]+K(j),b=rotl32(a,s[j]),_T=b+E;A=E,E=D,D=rotl32(C,10),C=B,B=_T,_T=(b=rotl32(a=Ah+f(79-j,Bh,Ch,Dh)+W[rh[j]]+Kh(j),sh[j]))+Eh,Ah=Eh,Eh=Dh,Dh=rotl32(Ch,10),Ch=Bh,Bh=_T}var T=this.state[1]+C+Dh;this.state[1]=this.state[2]+D+Eh,this.state[2]=this.state[3]+E+Ah,this.state[3]=this.state[4]+A+Bh,this.state[4]=this.state[0]+B+Ch,this.state[0]=T},RIPEMD160.hash=function(){return new RIPEMD160},RIPEMD160.hmac=function(){return new HMAC(RIPEMD160,64)},RIPEMD160.digest=function(data){return ctx.init().update(data).final()},RIPEMD160.root=function(left,right){return assert(Buffer.isBuffer(left)&&20===left.length),assert(Buffer.isBuffer(right)&&20===right.length),ctx.init().update(left).update(right).final()},RIPEMD160.mac=function(data,key){return RIPEMD160.hmac().init(key).update(data).final()},RIPEMD160}();ctx=new RIPEMD160;function rotl32(w,b){return w<<b|w>>>32-b}function f(j,x,y,z){return j<=15?x^y^z:j<=31?x&y|~x&z:j<=47?(x|~y)^z:j<=63?x&z|y&~z:x^(y|~z)}function K(j){return j<=15?0:j<=31?1518500249:j<=47?1859775393:j<=63?2400959708:2840853838}function Kh(j){return j<=15?1352829926:j<=31?1548603684:j<=47?1836072691:j<=63?2053994217:0}function writeU32(buf,value,offset){buf[offset+3]=value>>>24,buf[offset+2]=value>>16&255,buf[offset+1]=value>>8&255,buf[offset]=255&value}module.exports=RIPEMD160}).call(this,require("buffer").Buffer)},{"../hmac":162,assert:146,buffer:269}],172:[function(require,module,exports){(function(Buffer){"use strict";var deriveAsync=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(passwd,salt,N,r,p,len){var XY,V,B,i;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(assert(Buffer.isBuffer(passwd)),assert(Buffer.isBuffer(salt)),assert(N>>>0===N),assert(r>>>0===r),assert(p>>>0===p),assert(len>>>0===len),!(r*p>=1<<30)){_context.next=8;break}throw new Error("EFBIG");case 8:if(0==(N&N-1)&&0!==N){_context.next=10;break}throw new Error("EINVAL");case 10:if(!(N>4294967295)){_context.next=12;break}throw new Error("EINVAL");case 12:return XY=Buffer.allocUnsafe(256*r),V=Buffer.allocUnsafe(128*r*N),_context.next=16,pbkdf2.deriveAsync(SHA256,passwd,salt,1,128*p*r);case 16:B=_context.sent,i=0;case 18:if(!(i<p)){_context.next=24;break}return _context.next=21,smixAsync(B,128*i*r,r,N,V,XY);case 21:i++,_context.next=18;break;case 24:return _context.next=26,pbkdf2.deriveAsync(SHA256,passwd,B,1,len);case 26:return _context.abrupt("return",_context.sent);case 27:case"end":return _context.stop()}},_callee,this)}));return function(_x,_x2,_x3,_x4,_x5,_x6){return _ref.apply(this,arguments)}}(),smixAsync=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(B,Bo,r,N,V,XY){var X,Y,i,_i8,j;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:Y=XY,blkcpy(X=XY,B,0,Bo,128*r),i=0;case 4:if(!(i<N)){_context2.next=12;break}return blkcpy(V,X,i*(128*r),0,128*r),blockmix_salsa8(X,Y,128*r,r),_context2.next=9,wait();case 9:i++,_context2.next=4;break;case 12:_i8=0;case 13:if(!(_i8<N)){_context2.next=22;break}return j=integerify(X,r)&N-1,blkxor(X,V,0,j*(128*r),128*r),blockmix_salsa8(X,Y,128*r,r),_context2.next=19,wait();case 19:_i8++,_context2.next=13;break;case 22:blkcpy(B,X,Bo,0,128*r);case 23:case"end":return _context2.stop()}},_callee2,this)}));return function(_x7,_x8,_x9,_x10,_x11,_x12){return _ref2.apply(this,arguments)}}();function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}var assert=require("assert"),pbkdf2=require("../pbkdf2"),SHA256=require("../sha256"),B32=new Uint32Array(16),X=new Uint32Array(16);function salsa20_8(B){for(var i=0;i<16;i++)B32[i]=B.readUInt32LE(4*i,!0);for(var _i=0;_i<16;_i++)X[_i]=B32[_i];for(var _i2=0;_i2<8;_i2+=2)X[4]^=R(X[0]+X[12],7),X[8]^=R(X[4]+X[0],9),X[12]^=R(X[8]+X[4],13),X[0]^=R(X[12]+X[8],18),X[9]^=R(X[5]+X[1],7),X[13]^=R(X[9]+X[5],9),X[1]^=R(X[13]+X[9],13),X[5]^=R(X[1]+X[13],18),X[14]^=R(X[10]+X[6],7),X[2]^=R(X[14]+X[10],9),X[6]^=R(X[2]+X[14],13),X[10]^=R(X[6]+X[2],18),X[3]^=R(X[15]+X[11],7),X[7]^=R(X[3]+X[15],9),X[11]^=R(X[7]+X[3],13),X[15]^=R(X[11]+X[7],18),X[1]^=R(X[0]+X[3],7),X[2]^=R(X[1]+X[0],9),X[3]^=R(X[2]+X[1],13),X[0]^=R(X[3]+X[2],18),X[6]^=R(X[5]+X[4],7),X[7]^=R(X[6]+X[5],9),X[4]^=R(X[7]+X[6],13),X[5]^=R(X[4]+X[7],18),X[11]^=R(X[10]+X[9],7),X[8]^=R(X[11]+X[10],9),X[9]^=R(X[8]+X[11],13),X[10]^=R(X[9]+X[8],18),X[12]^=R(X[15]+X[14],7),X[13]^=R(X[12]+X[15],9),X[14]^=R(X[13]+X[12],13),X[15]^=R(X[14]+X[13],18);for(var _i3=0;_i3<16;_i3++)B32[_i3]+=X[_i3];for(var _i4=0;_i4<16;_i4++)B.writeUInt32LE(B32[_i4],4*_i4,!0)}function R(a,b){return a<<b|a>>>32-b}function blockmix_salsa8(B,Y,Yo,r){var X=Buffer.allocUnsafe(64);blkcpy(X,B,0,64*(2*r-1),64);for(var i=0;i<2*r;i++)blkxor(X,B,0,64*i,64),salsa20_8(X),blkcpy(Y,X,Yo+64*i,0,64);for(var _i5=0;_i5<r;_i5++)blkcpy(B,Y,64*_i5,Yo+2*_i5*64,64);for(var _i6=0;_i6<r;_i6++)blkcpy(B,Y,64*(_i6+r),Yo+64*(2*_i6+1),64)}function integerify(B,r){return B.readUInt32LE(64*(2*r-1),!0)}function smix(B,Bo,r,N,V,XY){var X=XY,Y=XY;blkcpy(X,B,0,Bo,128*r);for(var i=0;i<N;i++)blkcpy(V,X,i*(128*r),0,128*r),blockmix_salsa8(X,Y,128*r,r);for(var _i7=0;_i7<N;_i7++){blkxor(X,V,0,(integerify(X,r)&N-1)*(128*r),128*r),blockmix_salsa8(X,Y,128*r,r)}blkcpy(B,X,Bo,0,128*r)}function blkcpy(dest,src,s1,s2,len){src.copy(dest,s1,s2,s2+len)}function blkxor(dest,src,s1,s2,len){for(var i=0;i<len;i++)dest[s1+i]^=src[s2+i]}function wait(){return new Promise(function(r){return setImmediate(r)})}exports.derive=function(passwd,salt,N,r,p,len){if(assert(Buffer.isBuffer(passwd)),assert(Buffer.isBuffer(salt)),assert(N>>>0===N),assert(r>>>0===r),assert(p>>>0===p),assert(len>>>0===len),r*p>=1<<30)throw new Error("EFBIG");if(0!=(N&N-1)||0===N)throw new Error("EINVAL");if(N>4294967295)throw new Error("EINVAL");for(var XY=Buffer.allocUnsafe(256*r),V=Buffer.allocUnsafe(128*r*N),B=pbkdf2.derive(SHA256,passwd,salt,1,128*p*r),i=0;i<p;i++)smix(B,128*i*r,r,N,V,XY);return pbkdf2.derive(SHA256,passwd,B,1,len)},exports.deriveAsync=deriveAsync}).call(this,require("buffer").Buffer)},{"../pbkdf2":178,"../sha256":186,assert:146,buffer:269}],173:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),HMAC=require("../hmac"),FINALIZED=-1,DESC=Buffer.alloc(8,0),PADDING=Buffer.alloc(64,0);PADDING[0]=128;var K=new Uint32Array([1518500249,1859775393,2400959708,3395469782]),ctx=null,SHA1=function(){function SHA1(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SHA1),this.state=new Uint32Array(5),this.msg=new Uint32Array(80),this.block=Buffer.allocUnsafe(64),this.size=FINALIZED}return SHA1.prototype.init=function(){return this.state[0]=1732584193,this.state[1]=4023233417,this.state[2]=2562383102,this.state[3]=271733878,this.state[4]=3285377520,this.size=0,this},SHA1.prototype.update=function(data){return assert(Buffer.isBuffer(data)),this._update(data,data.length),this},SHA1.prototype.final=function(){return this._final(Buffer.allocUnsafe(20))},SHA1.prototype._update=function(data,len){assert(this.size!==FINALIZED,"Context already finalized.");var pos=63&this.size,off=0;if(this.size+=len,pos>0){var want=64-pos;if(want>len&&(want=len),data.copy(this.block,pos,off,off+want),len-=want,off+=want,(pos+=want)<64)return;this.transform(this.block,0)}for(;len>=64;)this.transform(data,off),off+=64,len-=64;len>0&&data.copy(this.block,0,off,off+len)},SHA1.prototype._final=function(out){assert(this.size!==FINALIZED,"Context already finalized.");var pos=this.size%64,len=8*this.size;writeU32(DESC,len*(1/4294967296),0),writeU32(DESC,len,4),this._update(PADDING,1+(119-pos)%64),this._update(DESC,8);for(var i=0;i<5;i++)writeU32(out,this.state[i],4*i),this.state[i]=0;for(var _i=0;_i<80;_i++)this.msg[_i]=0;for(var _i2=0;_i2<64;_i2++)this.block[_i2]=0;return this.size=FINALIZED,out},SHA1.prototype.transform=function(chunk,pos){for(var W=this.msg,a=this.state[0],b=this.state[1],c=this.state[2],d=this.state[3],e=this.state[4],i=0;i<16;i++)W[i]=(buf=chunk,offset=pos+4*i,16777216*(255&buf[offset])+((255&buf[offset+1])<<16|(255&buf[offset+2])<<8|255&buf[offset+3]));for(var buf,offset;i<80;i++)W[i]=rotl32(W[i-3]^W[i-8]^W[i-14]^W[i-16],1);for(i=0;i<80;i++){var s=i/20|0,t=rotl32(a,5);t+=ft_1(s,b,c,d),t+=e,t+=W[i],t+=K[s],e=d,d=c,c=rotl32(b,30),b=a,a=t}this.state[0]+=a,this.state[1]+=b,this.state[2]+=c,this.state[3]+=d,this.state[4]+=e},SHA1.hash=function(){return new SHA1},SHA1.hmac=function(){return new HMAC(SHA1,64)},SHA1.digest=function(data){return ctx.init().update(data).final()},SHA1.root=function(left,right){return assert(Buffer.isBuffer(left)&&20===left.length),assert(Buffer.isBuffer(right)&&20===right.length),ctx.init().update(left).update(right).final()},SHA1.mac=function(data,key){return SHA1.hmac().init(key).update(data).final()},SHA1}();ctx=new SHA1;function rotl32(w,b){return w<<b|w>>>32-b}function ft_1(s,x,y,z){return 0===s?function(x,y,z){return x&y^~x&z}(x,y,z):1===s||3===s?function(x,y,z){return x^y^z}(x,y,z):2===s?function(x,y,z){return x&y^x&z^y&z}(x,y,z):0}function writeU32(buf,value,offset){buf[offset]=value>>>24,buf[offset+1]=value>>16&255,buf[offset+2]=value>>8&255,buf[offset+3]=255&value}module.exports=SHA1}).call(this,require("buffer").Buffer)},{"../hmac":162,assert:146,buffer:269}],174:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),HMAC=require("../hmac"),FINALIZED=-1,DESC=Buffer.alloc(8,0),PADDING=Buffer.alloc(64,0);PADDING[0]=128;var K=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ctx=null,SHA256=function(){function SHA256(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SHA256),this.state=new Uint32Array(8),this.msg=new Uint32Array(64),this.block=Buffer.allocUnsafe(64),this.size=FINALIZED}return SHA256.prototype.init=function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.size=0,this},SHA256.prototype.update=function(data){return assert(Buffer.isBuffer(data)),this._update(data,data.length),this},SHA256.prototype.final=function(){return this._final(Buffer.allocUnsafe(32))},SHA256.prototype._update=function(data,len){assert(this.size!==FINALIZED,"Context already finalized.");var pos=63&this.size,off=0;if(this.size+=len,pos>0){var want=64-pos;if(want>len&&(want=len),data.copy(this.block,pos,off,off+want),len-=want,off+=want,(pos+=want)<64)return;this.transform(this.block,0)}for(;len>=64;)this.transform(data,off),off+=64,len-=64;len>0&&data.copy(this.block,0,off,off+len)},SHA256.prototype._final=function(out){assert(this.size!==FINALIZED,"Context already finalized.");var pos=this.size%64,len=8*this.size;writeU32(DESC,len*(1/4294967296),0),writeU32(DESC,len,4),this._update(PADDING,1+(119-pos)%64),this._update(DESC,8);for(var i=0;i<8;i++)writeU32(out,this.state[i],4*i),this.state[i]=0;for(var _i=0;_i<64;_i++)this.msg[_i]=0;for(var _i2=0;_i2<64;_i2++)this.block[_i2]=0;return this.size=FINALIZED,out},SHA256.prototype.transform=function(chunk,pos){for(var W=this.msg,a=this.state[0],b=this.state[1],c=this.state[2],d=this.state[3],e=this.state[4],f=this.state[5],g=this.state[6],h=this.state[7],i=0;i<16;i++)W[i]=(buf=chunk,offset=pos+4*i,16777216*(255&buf[offset])+((255&buf[offset+1])<<16|(255&buf[offset+2])<<8|255&buf[offset+3]));for(var buf,offset;i<64;i++)W[i]=(x=W[i-2],((x>>>17|x<<15)^(x>>>19|x<<13)^x>>>10)+W[i-7]+sigma0(W[i-15])+W[i-16]);var x;for(i=0;i<64;i++){var t1=h+Sigma1(e);t1+=Ch(e,f,g),t1+=K[i]+W[i];var t2=Sigma0(a);t2+=Maj(a,b,c),h=g,g=f,f=e,e=d+t1,d=c,c=b,b=a,a=t1+t2}this.state[0]+=a,this.state[1]+=b,this.state[2]+=c,this.state[3]+=d,this.state[4]+=e,this.state[5]+=f,this.state[6]+=g,this.state[7]+=h},SHA256.hash=function(){return new SHA256},SHA256.hmac=function(){return new HMAC(SHA256,64)},SHA256.digest=function(data){return ctx.init().update(data).final()},SHA256.root=function(left,right){return assert(Buffer.isBuffer(left)&&32===left.length),assert(Buffer.isBuffer(right)&&32===right.length),ctx.init().update(left).update(right).final()},SHA256.mac=function(data,key){return SHA256.hmac().init(key).update(data).final()},SHA256}();ctx=new SHA256;function Sigma0(x){return(x>>>2|x<<30)^(x>>>13|x<<19)^(x>>>22|x<<10)}function Sigma1(x){return(x>>>6|x<<26)^(x>>>11|x<<21)^(x>>>25|x<<7)}function sigma0(x){return(x>>>7|x<<25)^(x>>>18|x<<14)^x>>>3}function Ch(x,y,z){return z^x&(y^z)}function Maj(x,y,z){return x&y|z&(x|y)}function writeU32(buf,value,offset){buf[offset]=value>>>24,buf[offset+1]=value>>16&255,buf[offset+2]=value>>8&255,buf[offset+3]=255&value}module.exports=SHA256}).call(this,require("buffer").Buffer)},{"../hmac":162,assert:146,buffer:269}],175:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),HMAC=require("../hmac"),FINALIZED=-1,DESC=Buffer.alloc(16,0),PADDING=Buffer.alloc(128,0);PADDING[0]=128;var K=new Uint32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]),ctx=null,SHA512=function(){function SHA512(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SHA512),this.state=new Uint32Array(16),this.msg=new Uint32Array(160),this.block=Buffer.allocUnsafe(128),this.size=FINALIZED}return SHA512.prototype.init=function(){return this.state[0]=1779033703,this.state[1]=4089235720,this.state[2]=3144134277,this.state[3]=2227873595,this.state[4]=1013904242,this.state[5]=4271175723,this.state[6]=2773480762,this.state[7]=1595750129,this.state[8]=1359893119,this.state[9]=2917565137,this.state[10]=2600822924,this.state[11]=725511199,this.state[12]=528734635,this.state[13]=4215389547,this.state[14]=1541459225,this.state[15]=327033209,this.size=0,this},SHA512.prototype.update=function(data){return assert(Buffer.isBuffer(data)),this._update(data,data.length),this},SHA512.prototype.final=function(){return this._final(Buffer.allocUnsafe(64))},SHA512.prototype._update=function(data,len){assert(this.size!==FINALIZED,"Context already finalized.");var pos=127&this.size,off=0;if(this.size+=len,pos>0){var want=128-pos;if(want>len&&(want=len),data.copy(this.block,pos,off,off+want),len-=want,off+=want,(pos+=want)<128)return;this.transform(this.block,0)}for(;len>=128;)this.transform(data,off),off+=128,len-=128;len>0&&data.copy(this.block,0,off,off+len)},SHA512.prototype._final=function(out){assert(this.size!==FINALIZED,"Context already finalized.");var pos=this.size%128,len=8*this.size;writeU32(DESC,len*(1/4294967296),8),writeU32(DESC,len,12),this._update(PADDING,1+(239-pos)%128),this._update(DESC,16);for(var i=0;i<16;i++)writeU32(out,this.state[i],4*i),this.state[i]=0;for(var _i=0;_i<160;_i++)this.msg[_i]=0;for(var _i2=0;_i2<128;_i2++)this.block[_i2]=0;return this.size=FINALIZED,out},SHA512.prototype.prepare=function(chunk,pos){for(var W=this.msg,i=0;i<32;i++)W[i]=(buf=chunk,offset=pos+4*i,16777216*(255&buf[offset])+((255&buf[offset+1])<<16|(255&buf[offset+2])<<8|255&buf[offset+3]));for(var buf,offset;i<160;i+=2){var c0_hi=g1_512_hi(W[i-4],W[i-3]),c0_lo=g1_512_lo(W[i-4],W[i-3]),c1_hi=W[i-14],c1_lo=W[i-13],c2_hi=g0_512_hi(W[i-30],W[i-29]),c2_lo=g0_512_lo(W[i-30],W[i-29]),c3_hi=W[i-32],c3_lo=W[i-31];W[i]=sum64_4_hi(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo),W[i+1]=sum64_4_lo(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo)}},SHA512.prototype.transform=function(chunk,pos){var W=this.msg;this.prepare(chunk,pos);for(var ah=this.state[0],al=this.state[1],bh=this.state[2],bl=this.state[3],ch=this.state[4],cl=this.state[5],dh=this.state[6],dl=this.state[7],eh=this.state[8],el=this.state[9],fh=this.state[10],fl=this.state[11],gh=this.state[12],gl=this.state[13],hh=this.state[14],hl=this.state[15],i=0;i<W.length;i+=2){var c0_hi=hh,c0_lo=hl,c1_hi=s1_512_hi(eh,el),c1_lo=s1_512_lo(eh,el),c2_hi=ch64_hi(eh,el,fh,fl,gh),c2_lo=ch64_lo(eh,el,fh,fl,gh,gl),c3_hi=K[i],c3_lo=K[i+1],c4_hi=W[i],c4_lo=W[i+1],T1_hi=sum64_5_hi(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo,c4_hi,c4_lo),T1_lo=sum64_5_lo(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo,c4_hi,c4_lo),T2_hi=sum64_hi(c0_hi=s0_512_hi(ah,al),c0_lo=s0_512_lo(ah,al),c1_hi=maj64_hi(ah,al,bh,bl,ch),c1_lo=maj64_lo(ah,al,bh,bl,ch,cl)),T2_lo=sum64_lo(c0_hi,c0_lo,c1_hi,c1_lo);hh=gh,hl=gl,gh=fh,gl=fl,fh=eh,fl=el,eh=sum64_hi(dh,dl,T1_hi,T1_lo),el=sum64_lo(dl,dl,T1_hi,T1_lo),dh=ch,dl=cl,ch=bh,cl=bl,bh=ah,bl=al,ah=sum64_hi(T1_hi,T1_lo,T2_hi,T2_lo),al=sum64_lo(T1_hi,T1_lo,T2_hi,T2_lo)}sum64(this.state,0,ah,al),sum64(this.state,2,bh,bl),sum64(this.state,4,ch,cl),sum64(this.state,6,dh,dl),sum64(this.state,8,eh,el),sum64(this.state,10,fh,fl),sum64(this.state,12,gh,gl),sum64(this.state,14,hh,hl)},SHA512.hash=function(){return new SHA512},SHA512.hmac=function(){return new HMAC(SHA512,128)},SHA512.digest=function(data){return ctx.init().update(data).final()},SHA512.root=function(left,right){return assert(Buffer.isBuffer(left)&&64===left.length),assert(Buffer.isBuffer(right)&&64===right.length),ctx.init().update(left).update(right).final()},SHA512.mac=function(data,key){return SHA512.hmac().init(key).update(data).final()},SHA512}();ctx=new SHA512;function sum64(buf,pos,ah,al){var bh=buf[pos],lo=al+buf[pos+1]>>>0,hi=(lo<al?1:0)+ah+bh;buf[pos]=hi>>>0,buf[pos+1]=lo}function sum64_hi(ah,al,bh,bl){return(al+bl>>>0<al?1:0)+ah+bh>>>0}function sum64_lo(ah,al,bh,bl){return al+bl>>>0}function sum64_4_hi(ah,al,bh,bl,ch,cl,dh,dl){var carry=0,lo=al;carry+=(lo=lo+bl>>>0)<al?1:0,carry+=(lo=lo+cl>>>0)<cl?1:0;return ah+bh+ch+dh+(carry+=(lo=lo+dl>>>0)<dl?1:0)>>>0}function sum64_4_lo(ah,al,bh,bl,ch,cl,dh,dl){return al+bl+cl+dl>>>0}function sum64_5_hi(ah,al,bh,bl,ch,cl,dh,dl,eh,el){var carry=0,lo=al;carry+=(lo=lo+bl>>>0)<al?1:0,carry+=(lo=lo+cl>>>0)<cl?1:0,carry+=(lo=lo+dl>>>0)<dl?1:0;return ah+bh+ch+dh+eh+(carry+=(lo=lo+el>>>0)<el?1:0)>>>0}function sum64_5_lo(ah,al,bh,bl,ch,cl,dh,dl,eh,el){return al+bl+cl+dl+el>>>0}function rotr64_hi(ah,al,num){return(al<<32-num|ah>>>num)>>>0}function rotr64_lo(ah,al,num){return(ah<<32-num|al>>>num)>>>0}function shr64_hi(ah,al,num){return ah>>>num}function shr64_lo(ah,al,num){return(ah<<32-num|al>>>num)>>>0}function ch64_hi(xh,xl,yh,yl,zh){var r=xh&yh^~xh&zh;return r<0&&(r+=4294967296),r}function ch64_lo(xh,xl,yh,yl,zh,zl){var r=xl&yl^~xl&zl;return r<0&&(r+=4294967296),r}function maj64_hi(xh,xl,yh,yl,zh){var r=xh&yh^xh&zh^yh&zh;return r<0&&(r+=4294967296),r}function maj64_lo(xh,xl,yh,yl,zh,zl){var r=xl&yl^xl&zl^yl&zl;return r<0&&(r+=4294967296),r}function s0_512_hi(xh,xl){var r=rotr64_hi(xh,xl,28)^rotr64_hi(xl,xh,2)^rotr64_hi(xl,xh,7);return r<0&&(r+=4294967296),r}function s0_512_lo(xh,xl){var r=rotr64_lo(xh,xl,28)^rotr64_lo(xl,xh,2)^rotr64_lo(xl,xh,7);return r<0&&(r+=4294967296),r}function s1_512_hi(xh,xl){var r=rotr64_hi(xh,xl,14)^rotr64_hi(xh,xl,18)^rotr64_hi(xl,xh,9);return r<0&&(r+=4294967296),r}function s1_512_lo(xh,xl){var r=rotr64_lo(xh,xl,14)^rotr64_lo(xh,xl,18)^rotr64_lo(xl,xh,9);return r<0&&(r+=4294967296),r}function g0_512_hi(xh,xl){var r=rotr64_hi(xh,xl,1)^rotr64_hi(xh,xl,8)^shr64_hi(xh,0,7);return r<0&&(r+=4294967296),r}function g0_512_lo(xh,xl){var r=rotr64_lo(xh,xl,1)^rotr64_lo(xh,xl,8)^shr64_lo(xh,xl,7);return r<0&&(r+=4294967296),r}function g1_512_hi(xh,xl){var r=rotr64_hi(xh,xl,19)^rotr64_hi(xl,xh,29)^shr64_hi(xh,0,6);return r<0&&(r+=4294967296),r}function g1_512_lo(xh,xl){var r=rotr64_lo(xh,xl,19)^rotr64_lo(xl,xh,29)^shr64_lo(xh,xl,6);return r<0&&(r+=4294967296),r}function writeU32(buf,value,offset){buf[offset]=value>>>24,buf[offset+1]=value>>16&255,buf[offset+2]=value>>8&255,buf[offset+3]=255&value}module.exports=SHA512}).call(this,require("buffer").Buffer)},{"../hmac":162,assert:146,buffer:269}],176:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),HI=1/4294967296;function _siphash(data,key){assert(Buffer.isBuffer(data)),assert(Buffer.isBuffer(key)&&key.length>=16);for(var blocks=data.length>>>3,c0=new U64(1936682341,1886610805),c1=new U64(1685025377,1852075885),c2=new U64(1819895653,1852142177),c3=new U64(1952801890,2037671283),f0=new U64(data.length<<24,0),f1=new U64(0,255),k0=U64.fromRaw(key,0),k1=U64.fromRaw(key,8),v0=c0.ixor(k0),v1=c1.ixor(k1),v2=c2.ixor(k0),v3=c3.ixor(k1),p=0,i=0;i<blocks;i++){var d=U64.fromRaw(data,p);p+=8,v3.ixor(d),sipround(v0,v1,v2,v3),sipround(v0,v1,v2,v3),v0.ixor(d)}switch(7&data.length){case 7:f0.hi|=data[p+6]<<16;case 6:f0.hi|=data[p+5]<<8;case 5:f0.hi|=data[p+4];case 4:f0.lo|=data[p+3]<<24;case 3:f0.lo|=data[p+2]<<16;case 2:f0.lo|=data[p+1]<<8;case 1:f0.lo|=data[p]}return v3.ixor(f0),sipround(v0,v1,v2,v3),sipround(v0,v1,v2,v3),v0.ixor(f0),v2.ixor(f1),sipround(v0,v1,v2,v3),sipround(v0,v1,v2,v3),sipround(v0,v1,v2,v3),sipround(v0,v1,v2,v3),v0.ixor(v1),v0.ixor(v2),v0.ixor(v3),[v0.hi,v0.lo]}function _siphash64(hi,lo,key){assert("number"==typeof hi),assert("number"==typeof lo),assert(Buffer.isBuffer(key)&&key.length>=16);var c0=new U64(1936682341,1886610805),c1=new U64(1685025377,1852075885),c2=new U64(1819895653,1852142177),c3=new U64(1952801890,2037671283),f0=new U64(hi,lo),f1=new U64(0,255),k0=U64.fromRaw(key,0),k1=U64.fromRaw(key,8),v0=c0.ixor(k0),v1=c1.ixor(k1),v2=c2.ixor(k0),v3=c3.ixor(k1);return v3.ixor(f0),sipround(v0,v1,v2,v3),sipround(v0,v1,v2,v3),v0.ixor(f0),v2.ixor(f1),sipround(v0,v1,v2,v3),sipround(v0,v1,v2,v3),sipround(v0,v1,v2,v3),sipround(v0,v1,v2,v3),v0.ixor(v1),v0.ixor(v2),v0.ixor(v3),[v0.hi,v0.lo]}function _siphash64k256(hi,lo,key){assert("number"==typeof hi),assert("number"==typeof lo),assert(Buffer.isBuffer(key)&&key.length>=32);var f0=new U64(hi,lo),f1=new U64(0,255),v0=U64.fromRaw(key,0),v1=U64.fromRaw(key,8),v2=U64.fromRaw(key,16),v3=U64.fromRaw(key,24);return v3.ixor(f0),sipround(v0,v1,v2,v3),sipround(v0,v1,v2,v3),v0.ixor(f0),v2.ixor(f1),sipround(v0,v1,v2,v3),sipround(v0,v1,v2,v3),sipround(v0,v1,v2,v3),sipround(v0,v1,v2,v3),v0.ixor(v1),v0.ixor(v2),v0.ixor(v3),[v0.hi,v0.lo]}function siphash(data,key){return _siphash(data,key)}var U64=function(){function U64(hi,lo){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,U64),this.hi=0|hi,this.lo=0|lo}return U64.prototype.iadd=function(b){var a=this,lo=a.lo+b.lo|0,s=lo>>31,as=a.lo>>31,bs=b.lo>>31,c=1&(as&bs|~s&(as^bs)),hi=(a.hi+b.hi|0)+c;return a.hi=0|hi,a.lo=lo,a},U64.prototype.ixor=function(b){return this.hi^=b.hi,this.lo^=b.lo,this},U64.prototype.irotl=function(bits){var ahi=this.hi,alo=this.lo,bhi=this.hi,blo=this.lo;return bits<32?(ahi<<=bits,ahi|=alo>>>32-bits,alo<<=bits):(ahi=alo<<bits-32,alo=0),(bits=64-bits)<32?(blo>>>=bits,blo|=bhi<<32-bits,bhi>>>=bits):(blo=bhi>>>bits-32,bhi=0),this.hi=ahi|bhi,this.lo=alo|blo,this},U64.fromRaw=function(data,off){var lo=data.readUInt32LE(off,!0);return new U64(data.readUInt32LE(off+4,!0),lo)},U64}();function sipround(v0,v1,v2,v3){v0.iadd(v1),v1.irotl(13),v1.ixor(v0),v0.irotl(32),v2.iadd(v3),v3.irotl(16),v3.ixor(v2),v0.iadd(v3),v3.irotl(21),v3.ixor(v0),v2.iadd(v1),v1.irotl(17),v1.ixor(v2),v2.irotl(32)}function mul64(alo,blo){var a16=alo>>>16,a00=65535&alo,b16=blo>>>16,b00=65535&blo,c48=0,c32=0,c16=0,c00=0;c16+=(c00+=a00*b00)>>>16,c32+=(c16+=a16*b00)>>>16,c16&=65535,c48+=(c32+=(c16+=a00*b16)>>>16)>>>16,c32&=65535,c48+=(c32+=a16*b16)>>>16,c48+=(c32&=65535)>>>16;return{hi:(c48&=65535)<<16|c32,lo:(c16&=65535)<<16|(c00&=65535)}}exports.siphash=siphash,exports.siphash256=siphash,exports.siphash32=function(num,key){return _siphash64(0,num,key)[1]},exports.siphash64=function(hi,lo,key){return _siphash64(hi,lo,key)},exports.siphash32k256=function(num,key){return _siphash64k256(0,num,key)[1]},exports.siphash64k256=function(hi,lo,key){return _siphash64k256(hi,lo,key)},exports.sipmod=function(data,key,mhi,mlo){var _siphash2=_siphash(data,key);return function(ahi,alo,bhi,blo){var axbhi=mul64(ahi,bhi),axbmid=mul64(ahi,blo),bxamid=mul64(bhi,alo),axblo=mul64(alo,blo),c=(axbmid.lo>>>0)+(bxamid.lo>>>0)+(axblo.hi>>>0),m=(axbmid.hi>>>0)+(bxamid.hi>>>0)+(c*HI>>>0),mhi=m*HI|0,mlo=0|m,_sum=function(ahi,alo,bhi,blo){var lo=alo+blo|0,as=alo>>31,bs=blo>>31;return{hi:(ahi+bhi|0)+(1&(as&bs|~(lo>>31)&(as^bs)))|0,lo:lo}}(axbhi.hi,axbhi.lo,mhi,mlo),hi=_sum.hi,lo=_sum.lo;return[hi,lo]}(_siphash2[0],_siphash2[1],mhi,mlo)}}).call(this,{isBuffer:require("../../../is-buffer/index.js")})},{"../../../is-buffer/index.js":353,assert:146}],177:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),ZERO_HASH=Buffer.alloc(0,0);exports.createTree=function(alg,leaves){assert(alg&&"function"==typeof alg.root),assert(Array.isArray(leaves));var nodes=leaves,size=leaves.length,malleated=!1,i=0;if(0===size)return nodes.push(ZERO_HASH),[nodes,malleated];for(;size>1;){for(var j=0;j<size;j+=2){var k=Math.min(j+1,size-1),left=nodes[i+j],right=nodes[i+k];k===j+1&&k+1===size&&left.equals(right)&&(malleated=!0);var hash=alg.root(left,right);nodes.push(hash)}i+=size,size+=1,size>>>=1}return[nodes,malleated]},exports.createRoot=function(alg,leaves){assert(alg&&"function"==typeof alg.root),assert(Array.isArray(leaves));var _exports$createTree=exports.createTree(alg,leaves),nodes=_exports$createTree[0],malleated=_exports$createTree[1];return[nodes[nodes.length-1],malleated]},exports.createBranch=function(alg,index,leaves){assert(alg&&"function"==typeof alg.root),assert(index>>>0===index),assert(Array.isArray(leaves));for(var size=leaves.length,nodes=exports.createTree(alg,leaves)[0],branch=[],i=0;size>1;){var j=Math.min(1^index,size-1);branch.push(nodes[i+j]),index>>>=1,i+=size,size+=1,size>>>=1}return branch},exports.deriveRoot=function(alg,hash,branch,index){assert(alg&&"function"==typeof alg.root),assert(Buffer.isBuffer(hash)),assert(Array.isArray(branch)),assert(index>>>0===index);var root=hash,_iterator=branch,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var _hash=_ref;root=1&index?alg.root(_hash,root):alg.root(root,_hash),index>>>=1}return root}}).call(this,require("buffer").Buffer)},{assert:146,buffer:269}],178:[function(require,module,exports){"use strict";module.exports=require("./js/pbkdf2")},{"./js/pbkdf2":168}],179:[function(require,module,exports){"use strict";module.exports=require("./js/poly1305")},{"./js/poly1305":169}],180:[function(require,module,exports){"use strict";module.exports=require("./js/random")},{"./js/random":170}],181:[function(require,module,exports){"use strict";module.exports=require("./js/ripemd160")},{"./js/ripemd160":171}],182:[function(require,module,exports){"use strict";module.exports=require("./js/scrypt")},{"./js/scrypt":172}],183:[function(require,module,exports){"use strict";module.exports=require("secp256k1/js")},{"secp256k1/js":402}],184:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),secp256k1=require("./secp256k1-backend"),random=require("./random"),ec=exports,ZERO_S=Buffer.from("0000000000000000000000000000000000000000000000000000000000000000","hex"),HALF_ORDER=Buffer.from("7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a0","hex");ec.generatePrivateKey=function(){var priv=void 0;do{priv=random.randomBytes(32)}while(!secp256k1.privateKeyVerify(priv));return priv},ec.publicKeyCreate=function(priv,compress){return assert(Buffer.isBuffer(priv)),secp256k1.publicKeyCreate(priv,compress)},ec.publicKeyConvert=function(key,compress){return secp256k1.publicKeyConvert(key,compress)},ec.privateKeyTweakAdd=function(privateKey,tweak){return secp256k1.privateKeyTweakAdd(privateKey,tweak)},ec.publicKeyTweakAdd=function(publicKey,tweak,compress){return secp256k1.publicKeyTweakAdd(publicKey,tweak,compress)},ec.ecdh=function(pub,priv){return secp256k1.ecdhUnsafe(pub,priv,!0).slice(1,33)},ec.recover=function(msg,sig,j,compress){j||(j=0);try{sig=secp256k1.signatureImport(sig)}catch(e){return null}var key=void 0;try{key=secp256k1.recover(msg,sig,j,compress)}catch(e){return null}return key},ec.verify=function(msg,sig,key){if(assert(Buffer.isBuffer(msg)),assert(Buffer.isBuffer(sig)),assert(Buffer.isBuffer(key)),0===sig.length)return!1;if(0===key.length)return!1;try{return sig=secp256k1.signatureImportLax(sig),sig=secp256k1.signatureNormalize(sig),secp256k1.verify(msg,sig,key)}catch(e){return!1}},ec.publicKeyVerify=function(key){return secp256k1.publicKeyVerify(key)},ec.privateKeyVerify=function(key){return secp256k1.privateKeyVerify(key)},ec.sign=function(msg,key){assert(Buffer.isBuffer(msg)),assert(Buffer.isBuffer(key));var sig=secp256k1.sign(msg,key);return sig=secp256k1.signatureNormalize(sig.signature),secp256k1.signatureExport(sig)},ec.fromDER=function(sig){return assert(Buffer.isBuffer(sig)),secp256k1.signatureImport(sig)},ec.toDER=function(sig){return assert(Buffer.isBuffer(sig)),secp256k1.signatureExport(sig)},ec.isLowS=function(sig){var s=void 0;try{s=secp256k1.signatureImport(sig).slice(32,64)}catch(e){return!1}return!s.equals(ZERO_S)&&!(s.compare(HALF_ORDER)>0)}}).call(this,require("buffer").Buffer)},{"./random":180,"./secp256k1-backend":183,assert:146,buffer:269}],185:[function(require,module,exports){"use strict";module.exports=require("./js/sha1")},{"./js/sha1":173}],186:[function(require,module,exports){"use strict";module.exports=require("./js/sha256")},{"./js/sha256":174}],187:[function(require,module,exports){"use strict";module.exports=require("./js/sha512")},{"./js/sha512":175}],188:[function(require,module,exports){"use strict";module.exports=require("./js/siphash")},{"./js/siphash":176}],189:[function(require,module,exports){"use strict";var Client=require("./client");exports.Client=Client,exports.client=function(options){return new Client(options)}},{"./client":190}],190:[function(require,module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var assert=require("assert"),EventEmitter=require("events"),URL=require("url"),bsock=require("bsock"),brq=require("brq"),Client=function(_EventEmitter){_inherits(Client,_EventEmitter);function Client(options){_classCallCheck(this,Client);var _this=_possibleConstructorReturn(this,_EventEmitter.call(this)),opt=new ClientOptions(options);return _this.ssl=opt.ssl,_this.host=opt.host,_this.port=opt.port,_this.path=opt.path,_this.username=opt.username,_this.password=opt.password,_this.id=opt.id,_this.token=opt.token,_this.sequence=0,_this.opened=!1,_this.socket=bsock.socket(),_this}return Client.prototype.clone=function(){var copy=new this.constructor;return copy.ssl=this.ssl,copy.host=this.host,copy.port=this.port,copy.path=this.path,copy.username=this.username,copy.password=this.password,copy.id=this.id,copy.token=this.token,copy.sequence=this.sequence,copy.opened=this.opened,copy.socket=this.socket,copy},Client.prototype.open=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var port,host,ssl,_this2=this;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:port=this.port,host=this.host,ssl=this.ssl,assert(!this.opened,"Already opened."),this.opened=!0,this.socket.on("connect",_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,_context.next=3,_this2.auth();case 3:_context.next=8;break;case 5:_context.prev=5,_context.t0=_context.catch(0),_this2.emit("error",_context.t0);case 8:_this2.emit("connect");case 9:case"end":return _context.stop()}},_callee,_this2,[[0,5]])}))),this.socket.on("error",function(err){_this2.emit("error",err)}),this.socket.on("disconnect",function(){_this2.emit("disconnect")}),this.socket.connect(port,host,ssl);case 7:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref.apply(this,arguments)}}(),Client.prototype.close=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:assert(this.opened,"Not opened."),this.opened=!1,this.socket.destroy(),this.socket=bsock.socket();case 4:case"end":return _context3.stop()}},_callee3,this)}));return function(){return _ref3.apply(this,arguments)}}(),Client.prototype.auth=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:case"end":return _context4.stop()}},_callee4,this)}));return function(){return _ref4.apply(this,arguments)}}(),Client.prototype.hook=function(){var _socket;return(_socket=this.socket).hook.apply(_socket,arguments)},Client.prototype.call=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){var _socket2,_args5=arguments;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.abrupt("return",(_socket2=this.socket).call.apply(_socket2,_args5));case 1:case"end":return _context5.stop()}},_callee5,this)}));return function(){return _ref5.apply(this,arguments)}}(),Client.prototype.bind=function(){var _socket3;return(_socket3=this.socket).bind.apply(_socket3,arguments)},Client.prototype.fire=function(){var _socket4;return(_socket4=this.socket).fire.apply(_socket4,arguments)},Client.prototype.request=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(method,endpoint,params){var query,res,json,error,err;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return assert("string"==typeof method),assert("string"==typeof endpoint),query=null,null==params&&(params={}),assert(params&&"object"===(void 0===params?"undefined":_typeof(params))),this.token&&(params.token=this.token),"GET"===method&&(query=params,params=null),_context6.next=9,brq({method:method,ssl:this.ssl,host:this.host,port:this.port,path:this.path+endpoint,username:this.username,password:this.password,query:query,pool:!0,json:params});case 9:if(404!==(res=_context6.sent).statusCode){_context6.next=12;break}return _context6.abrupt("return",null);case 12:if(401!==res.statusCode){_context6.next=14;break}throw new Error("Unauthorized (bad API key).");case 14:if("json"===res.type){_context6.next=16;break}throw new Error("Bad response (wrong content-type).");case 16:if(json=res.json()){_context6.next=19;break}throw new Error("Bad response (no body).");case 19:if(!json.error){_context6.next=25;break}throw error=json.error,(err=new Error(error.message)).type=String(error.type),err.code=error.code,err;case 25:if(200===res.statusCode){_context6.next=27;break}throw new Error("Status code: "+res.statusCode+".");case 27:return _context6.abrupt("return",json);case 28:case"end":return _context6.stop()}},_callee6,this)}));return function(_x,_x2,_x3){return _ref6.apply(this,arguments)}}(),Client.prototype.get=function(endpoint,params){return this.request("GET",endpoint,params)},Client.prototype.post=function(endpoint,params){return this.request("POST",endpoint,params)},Client.prototype.put=function(endpoint,params){return this.request("PUT",endpoint,params)},Client.prototype.del=function(endpoint,params){return this.request("DELETE",endpoint,params)},Client.prototype.execute=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(endpoint,method,params){var res,json,_json$error,message,code;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return assert("string"==typeof endpoint),assert("string"==typeof method),null==params&&(params=null),this.sequence+=1,_context7.next=6,brq({method:"POST",ssl:this.ssl,host:this.host,port:this.port,path:this.path+endpoint,username:this.username,password:this.password,pool:!0,query:this.token?{token:this.token}:void 0,json:{method:method,params:params,id:this.sequence}});case 6:if(401!==(res=_context7.sent).statusCode){_context7.next=9;break}throw new RPCError("Unauthorized (bad API key).",-1);case 9:if("json"===res.type){_context7.next=11;break}throw new Error("Bad response (wrong content-type).");case 11:if(json=res.json()){_context7.next=14;break}throw new Error("No body for JSON-RPC response.");case 14:if(!json.error){_context7.next=17;break}throw _json$error=json.error,message=_json$error.message,code=_json$error.code,new RPCError(message,code);case 17:if(200===res.statusCode){_context7.next=19;break}throw new Error("Status code: "+res.statusCode+".");case 19:return _context7.abrupt("return",json.result);case 20:case"end":return _context7.stop()}},_callee7,this)}));return function(_x4,_x5,_x6){return _ref7.apply(this,arguments)}}(),Client}(EventEmitter),ClientOptions=function(){function ClientOptions(options){_classCallCheck(this,ClientOptions),this.ssl=!1,this.host="localhost",this.port=80,this.path="/",this.username=null,this.password=null,this.id=null,this.token=null,options&&this.fromOptions(options)}return ClientOptions.prototype.fromOptions=function(options){if("string"==typeof options&&(options={url:options}),assert(options&&"object"===(void 0===options?"undefined":_typeof(options))),null!=options.ssl&&(assert("boolean"==typeof options.ssl),this.ssl=options.ssl,this.port=443),null!=options.host&&(assert("string"==typeof options.host),this.host=options.host),null!=options.port&&(assert((65535&options.port)===options.port),assert(0!==options.port),this.port=options.port),null!=options.path&&(assert("string"==typeof options.path),this.path=options.path),null!=options.apiKey&&(assert("string"==typeof options.apiKey),this.password=options.apiKey),null!=options.key&&(assert("string"==typeof options.key),this.password=options.key),null!=options.username&&(assert("string"==typeof options.username),this.username=options.username),null!=options.password&&(assert("string"==typeof options.password),this.password=options.password),null!=options.url){assert("string"==typeof options.url);var url=options.url;-1===url.indexOf("://")&&(url="http://"+url);var data=URL.parse(url);if("http:"!==data.protocol&&"https:"!==data.protocol)throw new Error("Malformed URL.");if(!data.hostname)throw new Error("Malformed URL.");if("https:"===data.protocol&&(this.ssl=!0,this.port=443),this.host=data.hostname,data.port){var port=parseInt(data.port,10);assert((65535&port)===port),assert(0!==port),this.port=port}if(this.path=data.pathname,data.auth){var parts=data.auth.split(":");this.username=parts.shift(),this.password=parts.join(":")}}return null!=options.id&&(assert("string"==typeof options.id),this.id=options.id),null!=options.token&&(assert("string"==typeof options.token),this.token=options.token),this},ClientOptions}(),RPCError=function(_Error){_inherits(RPCError,_Error);function RPCError(msg,code){_classCallCheck(this,RPCError);var _this3=_possibleConstructorReturn(this,_Error.call(this));return _this3.type="RPCError",_this3.message=String(msg),_this3.code=code>>>0,Error.captureStackTrace&&Error.captureStackTrace(_this3,RPCError),_this3}return RPCError}(Error);module.exports=Client},{assert:146,brq:248,bsock:253,events:334,url:423}],191:[function(require,module,exports){"use strict";var DB=require("./db"),Key=require("./key"),MemDB=require("./memdb"),Level=require("./level");exports.DB=DB,exports.Key=Key,exports.create=function(options){var _ref=options||{},memory=_ref.memory,location=_ref.location;return memory?new DB(MemDB,"memory",options):new DB(Level,location,options)},exports.key=function(id,args){return new Key(id,args)}},{"./db":192,"./key":193,"./level":194,"./memdb":195}],192:[function(require,module,exports){(function(Buffer){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),LOW=Buffer.alloc(1,0),HIGH=Buffer.alloc(255,255),DB=function(){function DB(backend,location,options){_classCallCheck(this,DB),assert("function"==typeof backend,"Backend is required."),assert("string"==typeof location,"Filename is required."),this.options=new DBOptions(options),this.backend=backend,this.location=location,this.loading=!1,this.closing=!1,this.loaded=!1,this.binding=null,this.leveldown=!1,this.init()}return DB.prototype.init=function(){var db=new(0,this.backend)(this.location);db.binding&&"function"==typeof db.binding.approximateSize?(this.binding=db.binding,this.leveldown=!0):this.binding=db},DB.prototype.open=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!this.loaded){_context.next=2;break}throw new Error("Database is already open.");case 2:return assert(!this.loading),assert(!this.closing),_context.prev=4,this.loading=!0,_context.next=8,this.load();case 8:return _context.prev=8,this.loading=!1,_context.finish(8);case 11:this.loaded=!0;case 12:case"end":return _context.stop()}},_callee,this,[[4,,8,11]])}));return function(){return _ref.apply(this,arguments)}}(),DB.prototype.close=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(this.loaded){_context2.next=2;break}throw new Error("Database is already closed.");case 2:return assert(!this.loading),assert(!this.closing),_context2.prev=4,this.loaded=!1,this.closing=!0,_context2.next=9,this.unload();case 9:_context2.next=15;break;case 11:throw _context2.prev=11,_context2.t0=_context2.catch(4),this.loaded=!0,_context2.t0;case 15:return _context2.prev=15,this.closing=!1,_context2.finish(15);case 18:case"end":return _context2.stop()}},_callee2,this,[[4,11,15,18]])}));return function(){return _ref2.apply(this,arguments)}}(),DB.prototype.load=function(){var _this=this;return new Promise(function(resolve,reject){_this.binding.open(_this.options,wrap(resolve,reject))})},DB.prototype.unload=function(){var _this2=this;return new Promise(function(resolve,reject){_this2.binding.close(wrap(resolve,reject))})},DB.prototype.destroy=function(){var _this3=this;return new Promise(function(resolve,reject){_this3.loaded||_this3.closing?reject(new Error("Cannot destroy open database.")):_this3.backend.destroy?_this3.backend.destroy(_this3.location,wrap(resolve,reject)):reject(new Error("Cannot destroy (method not available)."))})},DB.prototype.repair=function(){var _this4=this;return new Promise(function(resolve,reject){_this4.loaded||_this4.closing?reject(new Error("Cannot repair open database.")):_this4.backend.repair?_this4.backend.repair(_this4.location,wrap(resolve,reject)):reject(new Error("Cannot repair (method not available)."))})},DB.prototype.backup=function(path){var _this5=this;return this.binding.backup?new Promise(function(resolve,reject){_this5.loaded?_this5.binding.backup(path,wrap(resolve,reject)):reject(new Error("Database is closed."))}):this.clone(path)},DB.prototype.bucket=function(prefix){return new Bucket(this,prefix)},DB.prototype.root=function(){return this},DB.prototype.child=function(prefix){return this.bucket(prefix)},DB.prototype.wrap=function(obj){return obj.root()},DB.prototype.get=function(key){var _this6=this;return new Promise(function(resolve,reject){_this6.loaded?Buffer.isBuffer(key)?_this6.binding.get(key,function(err,result){if(err)return function(err){return!!err&&(err.notFound||"NotFoundError"===err.type||/not\s*found/i.test(err.message))}(err)?void resolve(null):void reject(err);resolve(result)}):reject(new Error("Key must be a buffer.")):reject(new Error("Database is closed."))})},DB.prototype.put=function(key,value){var _this7=this;return null==value&&(value=LOW),new Promise(function(resolve,reject){_this7.loaded?Buffer.isBuffer(key)&&Buffer.isBuffer(value)?_this7.binding.put(key,value,wrap(resolve,reject)):reject(new Error("Key and value must be buffers.")):reject(new Error("Database is closed."))})},DB.prototype.del=function(key){var _this8=this;return new Promise(function(resolve,reject){_this8.loaded?Buffer.isBuffer(key)?_this8.binding.del(key,wrap(resolve,reject)):reject(new Error("Key must be a buffer.")):reject(new Error("Database is closed."))})},DB.prototype.batch=function(){if(!this.loaded)throw new Error("Database is closed.");return new Batch(this.binding.batch())},DB.prototype.iterator=function(options){if(!this.loaded)throw new Error("Database is closed.");return new Iterator(this,options)},DB.prototype.getProperty=function(name){if(!this.loaded)throw new Error("Database is closed.");return this.binding.getProperty?this.binding.getProperty(name):""},DB.prototype.approximateSize=function(start,end){var _this9=this;return null==start&&(start=LOW),null==end&&(end=HIGH),new Promise(function(resolve,reject){_this9.loaded?_this9.binding.approximateSize?Buffer.isBuffer(start)&&Buffer.isBuffer(end)?_this9.binding.approximateSize(start,end,wrap(resolve,reject)):reject(new Error("Start and end must be buffers.")):reject(new Error("Cannot get size.")):reject(new Error("Database is closed."))})},DB.prototype.compactRange=function(start,end){var _this10=this;return null==start&&(start=LOW),null==end&&(end=HIGH),new Promise(function(resolve,reject){_this10.loaded?_this10.binding.compactRange?Buffer.isBuffer(start)&&Buffer.isBuffer(end)?_this10.binding.compactRange(start,end,wrap(resolve,reject)):reject(new Error("Start and end must be buffers.")):resolve():reject(new Error("Database is closed."))})},DB.prototype.has=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(key){var value;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,this.get(key);case 2:return value=_context3.sent,_context3.abrupt("return",null!=value);case 4:case"end":return _context3.stop()}},_callee3,this)}));return function(_x){return _ref3.apply(this,arguments)}}(),DB.prototype.range=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(options){var iter;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return null==options&&(options={}),iter=this.iterator({gt:options.gt,lt:options.lt,gte:options.gte,lte:options.lte,keys:!0,values:!0}),_context4.abrupt("return",iter.range(options.parse));case 3:case"end":return _context4.stop()}},_callee4,this)}));return function(_x2){return _ref4.apply(this,arguments)}}(),DB.prototype.keys=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(options){var iter;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return null==options&&(options={}),iter=this.iterator({gt:options.gt,lt:options.lt,gte:options.gte,lte:options.lte,keys:!0,values:!1}),_context5.abrupt("return",iter.keys(options.parse));case 3:case"end":return _context5.stop()}},_callee5,this)}));return function(_x3){return _ref5.apply(this,arguments)}}(),DB.prototype.values=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(options){var iter;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return null==options&&(options={}),iter=this.iterator({gt:options.gt,lt:options.lt,gte:options.gte,lte:options.lte,keys:!1,values:!0}),_context6.abrupt("return",iter.values(options.parse));case 3:case"end":return _context6.stop()}},_callee6,this)}));return function(_x4){return _ref6.apply(this,arguments)}}(),DB.prototype.dump=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(){var records,items,_iterator,_isArray,_i,_ref8,item,key,value;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return records=Object.create(null),_context7.next=3,this.range();case 3:items=_context7.sent,_iterator=items,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();case 5:if(!_isArray){_context7.next=11;break}if(!(_i>=_iterator.length)){_context7.next=8;break}return _context7.abrupt("break",21);case 8:_ref8=_iterator[_i++],_context7.next=15;break;case 11:if(!(_i=_iterator.next()).done){_context7.next=14;break}return _context7.abrupt("break",21);case 14:_ref8=_i.value;case 15:key=(item=_ref8).key.toString("hex"),value=item.value.toString("hex"),records[key]=value;case 19:_context7.next=5;break;case 21:return _context7.abrupt("return",records);case 22:case"end":return _context7.stop()}},_callee7,this)}));return function(){return _ref7.apply(this,arguments)}}(),DB.prototype.verify=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(key,name,version){var data,value,batch;return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return assert("string"==typeof name),assert(version>>>0===version),_context8.next=4,this.get(key);case 4:if(data=_context8.sent){_context8.next=14;break}return(value=Buffer.allocUnsafe(name.length+4)).write(name,0,"ascii"),value.writeUInt32LE(version,name.length,!0),(batch=this.batch()).put(key,value),_context8.next=13,batch.write();case 13:return _context8.abrupt("return");case 14:if(data.length===name.length+4){_context8.next=16;break}throw new Error(versionError(name));case 16:if(data.toString("ascii",0,name.length)===name){_context8.next=18;break}throw new Error(versionError(name));case 18:if(data.readUInt32LE(name.length,!0)===version){_context8.next=21;break}throw new Error(versionError(name));case 21:case"end":return _context8.stop()}},_callee8,this)}));return function(_x5,_x6,_x7){return _ref9.apply(this,arguments)}}(),DB.prototype.clone=function(){var _ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(path){var options,tmp;return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:if(this.loaded){_context9.next=2;break}throw new Error("Database is closed.");case 2:return(options=new DBOptions(this.options)).createIfMissing=!0,options.errorIfExists=!0,tmp=new DB(this.backend,path,options),_context9.next=8,tmp.open();case 8:return _context9.prev=8,_context9.next=11,this.cloneTo(tmp);case 11:return _context9.prev=11,_context9.next=14,tmp.close();case 14:return _context9.finish(11);case 15:case"end":return _context9.stop()}},_callee9,this,[[8,,11,15]])}));return function(_x8){return _ref10.apply(this,arguments)}}(),DB.prototype.cloneTo=function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(db){var hwm,iter,batch,total,_this11=this;return regeneratorRuntime.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:return hwm=256<<20,iter=this.iterator({keys:!0,values:!0}),batch=db.batch(),total=0,_context11.next=6,iter.each(function(){var _ref12=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(key,value){return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:if(batch.put(key,value),total+=key.length+80,!((total+=value.length+80)>=hwm)){_context10.next=8;break}return total=0,_context10.next=7,batch.write();case 7:batch=db.batch();case 8:case"end":return _context10.stop()}},_callee10,_this11)}));return function(_x10,_x11){return _ref12.apply(this,arguments)}}());case 6:return _context11.abrupt("return",batch.write());case 7:case"end":return _context11.stop()}},_callee11,this)}));return function(_x9){return _ref11.apply(this,arguments)}}(),DB}(),Batch=function(){function Batch(binding,prefix){_classCallCheck(this,Batch),this.binding=binding,this.prefix=prefix||null}return Batch.prototype.bucket=function(prefix){return new Batch(this.binding,prefix)},Batch.prototype.root=function(){return this.bucket(null)},Batch.prototype.child=function(prefix){return this.bucket(concat(this.prefix,prefix))},Batch.prototype.wrap=function(obj){return obj.bucket(this.prefix)},Batch.prototype.put=function(key,value){return null==value&&(value=LOW),assert(Buffer.isBuffer(value),"Value must be a buffer."),this.binding.put(concat(this.prefix,key),value),this},Batch.prototype.del=function(key){return this.binding.del(concat(this.prefix,key)),this},Batch.prototype.write=function(){var _this12=this;return new Promise(function(resolve,reject){_this12.binding.write(wrap(resolve,reject))})},Batch.prototype.clear=function(){return this.binding.clear(),this},Batch}(),Bucket=function(){function Bucket(db,prefix){_classCallCheck(this,Bucket),this.db=db,assert(null==prefix||Buffer.isBuffer(prefix),"Prefix must be a buffer."),this.prefix=prefix||null}return Bucket.prototype.bucket=function(prefix){return new Bucket(this.db,prefix)},Bucket.prototype.root=function(){return this.bucket(null)},Bucket.prototype.child=function(prefix){return this.bucket(concat(this.prefix,prefix))},Bucket.prototype.wrap=function(obj){return obj.bucket(this.prefix)},Bucket.prototype.batch=function(){return new Batch(this.db.binding.batch(),this.prefix)},Bucket.prototype.has=function(key){return this.db.has(concat(this.prefix,key))},Bucket.prototype.get=function(key){return this.db.get(concat(this.prefix,key))},Bucket.prototype.iterator=function(options){return new Iterator(this.db,options,this.prefix)},Bucket.prototype.range=function(){var _ref13=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(options){var iter;return regeneratorRuntime.wrap(function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:return null==options&&(options={}),iter=this.iterator({gt:options.gt,lt:options.lt,gte:options.gte,lte:options.lte,keys:!0,values:!0}),_context12.abrupt("return",iter.range(options.parse));case 3:case"end":return _context12.stop()}},_callee12,this)}));return function(_x12){return _ref13.apply(this,arguments)}}(),Bucket.prototype.keys=function(){var _ref14=_asyncToGenerator(regeneratorRuntime.mark(function _callee13(options){var iter;return regeneratorRuntime.wrap(function(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:return null==options&&(options={}),iter=this.iterator({gt:options.gt,lt:options.lt,gte:options.gte,lte:options.lte,keys:!0,values:!1}),_context13.abrupt("return",iter.keys(options.parse));case 3:case"end":return _context13.stop()}},_callee13,this)}));return function(_x13){return _ref14.apply(this,arguments)}}(),Bucket.prototype.values=function(){var _ref15=_asyncToGenerator(regeneratorRuntime.mark(function _callee14(options){var iter;return regeneratorRuntime.wrap(function(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:return null==options&&(options={}),iter=this.iterator({gt:options.gt,lt:options.lt,gte:options.gte,lte:options.lte,keys:!1,values:!0}),_context14.abrupt("return",iter.values(options.parse));case 3:case"end":return _context14.stop()}},_callee14,this)}));return function(_x14){return _ref15.apply(this,arguments)}}(),Bucket}(),Iterator=function(){function Iterator(db,options,prefix){_classCallCheck(this,Iterator),this.db=db,this.options=options||null,this.prefix=prefix||null,this.binding=null,this.cache=[],this.finished=!1,this.key=null,this.value=null}return Iterator.prototype.start=function(){if(!this.binding){var options=new IteratorOptions(this.options);null!=this.prefix&&(assert(Buffer.isBuffer(this.prefix)),null!=options.gte&&(options.gte=concat(this.prefix,options.gte)),null!=options.lte&&(options.lte=concat(this.prefix,options.lte)),null!=options.gt&&(options.gt=concat(this.prefix,options.gt)),null!=options.lt&&(options.lt=concat(this.prefix,options.lt)),null==options.gt&&null==options.gte&&(options.gt=this.prefix),null==options.lt&&null==options.lte&&(options.lt=function(key){if(0===key.length)return null;for(var out=Buffer.from(key),i=out.length-1;i>=0;i--){if(255!==out[i]){out[i]+=1;break}out[i]=0}return-1===i?null:out}(this.prefix))),this.binding=this.db.binding.iterator(options)}},Iterator.prototype.bucket=function(prefix){return assert(!this.binding),new Iterator(this.db,this.options,prefix)},Iterator.prototype.root=function(){return this.bucket(null)},Iterator.prototype.child=function(prefix){return this.bucket(concat(this.prefix,prefix))},Iterator.prototype.wrap=function(obj){return obj.bucket(this.prefix)},Iterator.prototype.cleanup=function(){this.cache=[],this.finished=!0,this.key=null,this.value=null},Iterator.prototype.each=function(){var _ref16=_asyncToGenerator(regeneratorRuntime.mark(function _callee15(cb){var key,value,result;return regeneratorRuntime.wrap(function(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:assert("function"==typeof cb);case 1:if(this.finished){_context15.next=27;break}return _context15.next=4,this.read();case 4:if(!(this.cache.length>0)){_context15.next=25;break}if(key=slice(this.prefix,this.cache.pop()),value=this.cache.pop(),result=null,_context15.prev=8,!((result=cb(key,value))instanceof Promise)){_context15.next=14;break}return _context15.next=13,result;case 13:result=_context15.sent;case 14:_context15.next=21;break;case 16:return _context15.prev=16,_context15.t0=_context15.catch(8),_context15.next=20,this.end();case 20:throw _context15.t0;case 21:if(!1!==result){_context15.next=23;break}return _context15.abrupt("return",this.end());case 23:_context15.next=4;break;case 25:_context15.next=1;break;case 27:return _context15.abrupt("return",this.end());case 28:case"end":return _context15.stop()}},_callee15,this,[[8,16]])}));return function(_x15){return _ref16.apply(this,arguments)}}(),Iterator.prototype.next=function(){var _ref17=_asyncToGenerator(regeneratorRuntime.mark(function _callee16(){return regeneratorRuntime.wrap(function(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:if(this.finished){_context16.next=4;break}if(0!==this.cache.length){_context16.next=4;break}return _context16.next=4,this.read();case 4:if(!(this.cache.length>0)){_context16.next=8;break}return this.key=slice(this.prefix,this.cache.pop()),this.value=this.cache.pop(),_context16.abrupt("return",!0);case 8:return assert(this.finished),this.cleanup(),_context16.abrupt("return",!1);case 11:case"end":return _context16.stop()}},_callee16,this)}));return function(){return _ref17.apply(this,arguments)}}(),Iterator.prototype._read=function(callback){this.db.leveldown?this.binding.next(callback):this.binding.next(function(err,key,value){err?callback(err):void 0!==key||void 0!==value?callback(null,[value,key],!1):callback(null,[],!0)})},Iterator.prototype.read=function(){var _this13=this;return new Promise(function(resolve,reject){if(!_this13.binding)try{_this13.start()}catch(e){return void reject(e)}_this13._read(function(err,cache,finished){if(err)return _this13.cleanup(),void _this13.binding.end(function(){return reject(err)});_this13.cache=cache,_this13.finished=finished,resolve()})})},Iterator.prototype.seek=function(key){return assert(Buffer.isBuffer(key),"Key must be a buffer."),this.start(),this.binding.seek(key),this},Iterator.prototype.end=function(){var _this14=this;return new Promise(function(resolve,reject){if(!_this14.binding)try{_this14.start()}catch(e){return void reject(e)}_this14.cleanup(),_this14.binding.end(wrap(resolve,reject))})},Iterator.prototype.range=function(){var _ref18=_asyncToGenerator(regeneratorRuntime.mark(function _callee17(parse){var items;return regeneratorRuntime.wrap(function(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:return assert(!parse||"function"==typeof parse),items=[],_context17.next=4,this.each(function(key,value){if(parse){var item=parse(key,value);item&&items.push(item)}else items.push(new IteratorItem(key,value))});case 4:return _context17.abrupt("return",items);case 5:case"end":return _context17.stop()}},_callee17,this)}));return function(_x16){return _ref18.apply(this,arguments)}}(),Iterator.prototype.keys=function(){var _ref19=_asyncToGenerator(regeneratorRuntime.mark(function _callee18(parse){var items;return regeneratorRuntime.wrap(function(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:return assert(!parse||"function"==typeof parse),items=[],_context18.next=4,this.each(function(key,value){parse&&(key=parse(key)),items.push(key)});case 4:return _context18.abrupt("return",items);case 5:case"end":return _context18.stop()}},_callee18,this)}));return function(_x17){return _ref19.apply(this,arguments)}}(),Iterator.prototype.values=function(){var _ref20=_asyncToGenerator(regeneratorRuntime.mark(function _callee19(parse){var items;return regeneratorRuntime.wrap(function(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:return assert(!parse||"function"==typeof parse),items=[],_context19.next=4,this.each(function(key,value){parse&&(value=parse(value)),items.push(value)});case 4:return _context19.abrupt("return",items);case 5:case"end":return _context19.stop()}},_callee19,this)}));return function(_x18){return _ref20.apply(this,arguments)}}(),Iterator}(),IteratorItem=function IteratorItem(key,value){_classCallCheck(this,IteratorItem),this.key=key,this.value=value},DBOptions=function(){function DBOptions(options){_classCallCheck(this,DBOptions),this.createIfMissing=!0,this.errorIfExists=!1,this.compression=!0,this.cacheSize=8<<20,this.writeBufferSize=4<<20,this.maxOpenFiles=64,this.maxFileSize=2<<20,this.paranoidChecks=!1,this.memory=!1,this.sync=!1,this.mapSize=274877906944,this.writeMap=!1,this.noSubdir=!0,options&&this.fromOptions(options)}return DBOptions.prototype.fromOptions=function(options){return assert(options,"Options are required."),null!=options.createIfMissing&&(assert("boolean"==typeof options.createIfMissing,"`createIfMissing` must be a boolean."),this.createIfMissing=options.createIfMissing),null!=options.errorIfExists&&(assert("boolean"==typeof options.errorIfExists,"`errorIfExists` must be a boolean."),this.errorIfExists=options.errorIfExists),null!=options.compression&&(assert("boolean"==typeof options.compression,"`compression` must be a boolean."),this.compression=options.compression),null!=options.cacheSize&&(assert("number"==typeof options.cacheSize,"`cacheSize` must be a number."),assert(options.cacheSize>=0),this.cacheSize=Math.floor(options.cacheSize/2),this.writeBufferSize=Math.floor(options.cacheSize/4)),null!=options.maxFiles&&(assert("number"==typeof options.maxFiles,"`maxFiles` must be a number."),assert(options.maxFiles>=0),this.maxOpenFiles=options.maxFiles),null!=options.maxFileSize&&(assert("number"==typeof options.maxFileSize,"`maxFileSize` must be a number."),assert(options.maxFileSize>=0),this.maxFileSize=options.maxFileSize),null!=options.paranoidChecks&&(assert("boolean"==typeof options.paranoidChecks,"`paranoidChecks` must be a boolean."),this.paranoidChecks=options.paranoidChecks),null!=options.memory&&(assert("boolean"==typeof options.memory,"`memory` must be a boolean."),this.memory=options.memory),null!=options.sync&&(assert("boolean"==typeof options.sync,"`sync` must be a boolean."),this.sync=options.sync),null!=options.mapSize&&(assert("number"==typeof options.mapSize,"`mapSize` must be a number."),assert(options.mapSize>=0),this.mapSize=options.mapSize),null!=options.writeMap&&(assert("boolean"==typeof options.writeMap,"`writeMap` must be a boolean."),this.writeMap=options.writeMap),null!=options.noSubdir&&(assert("boolean"==typeof options.noSubdir,"`noSubdir` must be a boolean."),this.noSubdir=options.noSubdir),this},DBOptions}(),IteratorOptions=function(){function IteratorOptions(options){_classCallCheck(this,IteratorOptions),this.gte=null,this.lte=null,this.gt=null,this.lt=null,this.keys=!0,this.values=!1,this.fillCache=!1,this.keyAsBuffer=!0,this.valueAsBuffer=!0,this.reverse=!1,this.highWaterMark=16384,options&&this.fromOptions(options)}return IteratorOptions.prototype.fromOptions=function(options){if(assert(options,"Options are required."),null!=options.gte&&(assert(Buffer.isBuffer(options.gte),"`gte` must be a buffer."),this.gte=options.gte),null!=options.lte&&(assert(Buffer.isBuffer(options.lte),"`lte` must be a buffer."),this.lte=options.lte),null!=options.gt&&(assert(Buffer.isBuffer(options.gt),"`gt` must be a buffer."),this.gt=options.gt),null!=options.lt&&(assert(Buffer.isBuffer(options.lt),"`lt` must be a buffer."),this.lt=options.lt),null!=options.keys&&(assert("boolean"==typeof options.keys),this.keys=options.keys),null!=options.values&&(assert("boolean"==typeof options.values),this.values=options.values),null!=options.fillCache&&(assert("boolean"==typeof options.fillCache),this.fillCache=options.fillCache),null!=options.reverse&&(assert("boolean"==typeof options.reverse),this.reverse=options.reverse),null!=options.limit&&(assert("number"==typeof options.limit),assert(options.limit>=0),this.limit=options.limit),!this.keys&&!this.values)throw new Error("Keys and/or values must be chosen.");return this},IteratorOptions}();function wrap(resolve,reject){return function(err,result){err?reject(err):resolve(result)}}function slice(prefix,key){return null==key?key:(assert(Buffer.isBuffer(key),"Key must be a buffer."),0===key.length?key:null==prefix?key:(assert(Buffer.isBuffer(prefix)),assert(key.length>=prefix.length),key.slice(prefix.length)))}function concat(prefix,key){if(assert(Buffer.isBuffer(key),"Key must be a buffer."),null==prefix)return key;assert(Buffer.isBuffer(prefix));var data=Buffer.allocUnsafe(prefix.length+key.length);return prefix.copy(data,0),key.copy(data,prefix.length),data}function versionError(name){return'Database version mismatch for database: "'+name+'". Please run a data migration before opening.'}module.exports=DB}).call(this,require("buffer").Buffer)},{assert:146,buffer:269}],193:[function(require,module,exports){(function(Buffer){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),keyCache=Object.create(null),BUFFER_MIN=Buffer.alloc(0),BUFFER_MAX=Buffer.alloc(255,255),types={char:{min:"\0",max:"",dynamic:!1,size:function(v){return 1},read:function(k,o){return assertLen(o+1<=k.length),String.fromCharCode(k[o])},write:function(k,v,o){return assertType("string"==typeof v),assertType(1===v.length),assertLen(o+1<=k.length),k[o]=v.charCodeAt(0),1}},uint8:{min:0,max:255,dynamic:!1,size:function(v){return 1},read:function(k,o){return assertLen(o+1<=k.length),k[o]},write:function(k,v,o){return assertType((255&v)===v),assertLen(o+1<=k.length),k[o]=v,1}},uint16:{min:0,max:65535,dynamic:!1,size:function(v){return 2},read:function(k,o){return assertLen(o+2<=k.length),k.readUInt16BE(o,!0)},write:function(k,v,o){return assertType((65535&v)===v),assertLen(o+2<=k.length),k.writeUInt16BE(v,o,!0),2}},uint32:{min:0,max:4294967295,dynamic:!1,size:function(v){return 4},read:function(k,o){return assertLen(o+4<=k.length),k.readUInt32BE(o,!0)},write:function(k,v,o){return assertType(v>>>0===v),assertLen(o+4<=k.length),k.writeUInt32BE(v,o,!0),4}},buffer:{min:BUFFER_MIN,max:BUFFER_MAX,dynamic:!0,size:function(v){return assertType(Buffer.isBuffer(v)),sizeString(v,null)},read:function(k,o){return function(k,o){return assertLen(o+1<=k.length),assertLen(o+1+k[o]<=k.length),k.slice(o+1,o+1+k[o])}(k,o)},write:function(k,v,o){return assertType(Buffer.isBuffer(v)),writeString(k,v,o,null)}},hex:{min:BUFFER_MIN,max:BUFFER_MAX,dynamic:!0,size:function(v){return sizeString(v,"hex")},read:function(k,o){return readString(k,o,"hex")},write:function(k,v,o){return writeString(k,v,o,"hex")}},ascii:{min:BUFFER_MIN,max:BUFFER_MAX,dynamic:!0,size:function(v){return sizeString(v,"ascii")},read:function(k,o){return readString(k,o,"ascii")},write:function(k,v,o){return writeString(k,v,o,"ascii")}},utf8:{min:BUFFER_MIN,max:BUFFER_MAX,dynamic:!0,size:function(v){return sizeString(v,"utf8")},read:function(k,o){return readString(k,o,"utf8")},write:function(k,v,o){return writeString(k,v,o,"utf8")}},hash160:{min:Buffer.alloc(20,0),max:Buffer.alloc(20,255),dynamic:!1,size:function(v){return 20},read:function(k,o){return assertLen(o+20<=k.length),k.toString("hex",o,o+20)},write:function(k,v,o){return assertType(20===writeHex(k,v,o)),20}},hash256:{min:Buffer.alloc(32,0),max:Buffer.alloc(32,255),dynamic:!1,size:function(v){return 32},read:function(k,o){return assertLen(o+32<=k.length),k.toString("hex",o,o+32)},write:function(k,v,o){return assertType(32===writeHex(k,v,o)),32}},hash:{min:Buffer.alloc(20,0),max:Buffer.alloc(32,255),dynamic:!0,size:function(v){return 1+sizeHex(v)},read:function(k,o){return assertLen(o+1<=k.length),assertLen(20===k[o]||32===k[o]),assertLen(o+1+k[o]<=k.length),k.toString("hex",o+1,o+1+k[o])},write:function(k,v,o){var size=sizeHex(v);return assertType(20===size||32===size),assertLen(o+1<=k.length),k[o]=size,assertType(writeHex(k,v,o+1)===size),1+size}}},BaseKey=function(){function BaseKey(){var ops=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];_classCallCheck(this,BaseKey),assert(Array.isArray(ops)),this.ops=[],this.size=0,this.index=-1,this.init(ops)}return BaseKey.create=function(ops){var hash=ops?ops.join(":"):"",cache=keyCache[hash];if(cache)return cache;var key=new BaseKey(ops);return keyCache[hash]=key,key},BaseKey.prototype.init=function(ops){for(var i=0;i<ops.length;i++){var name=ops[i];if(assert("string"==typeof name),!types.hasOwnProperty(name))throw new Error("Invalid type name: "+name+".");var op=types[name];op.dynamic?-1===this.index&&(this.index=i):this.size+=op.size(),this.ops.push(op)}},BaseKey.prototype.getSize=function(args){assert(args.length===this.ops.length);var size=1+this.size;if(-1===this.index)return size;for(var i=this.index;i<args.length;i++){var op=this.ops[i],arg=args[i];op.dynamic&&(size+=op.size(arg))}return size},BaseKey.prototype.build=function(id,args){if(assert(Array.isArray(args)),args.length!==this.ops.length)throw new Error("Wrong number of arguments passed to key.");var size=this.getSize(args),key=Buffer.allocUnsafe(size);key[0]=id;for(var offset=1,i=0;i<this.ops.length;i++){var op=this.ops[i],arg=args[i];offset+=op.write(key,arg,offset)}return key},BaseKey.prototype.parse=function(id,key){if(assert(Buffer.isBuffer(key)),0===this.ops.length)return key;if(0===key.length||key[0]!==id)throw new Error("Key prefix mismatch.");var args=[],offset=1,_iterator=this.ops,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var op=_ref,arg=op.read(key,offset);offset+=op.size(arg),args.push(arg)}return 1===args.length?args[0]:args},BaseKey.prototype.min=function(id,args){for(var i=args.length;i<this.ops.length;i++){var op=this.ops[i];args.push(op.min)}return this.build(id,args)},BaseKey.prototype.max=function(id,args){for(var i=args.length;i<this.ops.length;i++){var op=this.ops[i];args.push(op.max)}return this.build(id,args)},BaseKey.prototype.root=function(id){var key=Buffer.allocUnsafe(1);return key[0]=id,key},BaseKey}(),Key=function(){function Key(id){var ops=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];_classCallCheck(this,Key),assert(Array.isArray(ops)),this.id=function(id){"string"==typeof id&&(assert(1===id.length),id=id.charCodeAt(0));return assert((255&id)===id),assert(255!==id),id}(id),this.base=BaseKey.create(ops)}return Key.prototype.build=function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return this.base.build(this.id,args)},Key.prototype.parse=function(key){return this.base.parse(this.id,key)},Key.prototype.min=function(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];return this.base.min(this.id,args)},Key.prototype.max=function(){for(var _len3=arguments.length,args=Array(_len3),_key3=0;_key3<_len3;_key3++)args[_key3]=arguments[_key3];return this.base.max(this.id,args)},Key.prototype.root=function(){return this.base.root(this.id)},Key}();function sizeHex(data){return Buffer.isBuffer(data)?data.length:(assert("string"==typeof data),data.length>>>1)}function writeHex(data,str,off){return Buffer.isBuffer(str)?str.copy(data,off):(assert("string"==typeof str),data.write(str,off,"hex"))}function sizeString(v,enc){return Buffer.isBuffer(v)?1+v.length:(assertType("string"==typeof v),1+Buffer.byteLength(v,enc))}function readString(k,o,enc){return assertLen(o+1<=k.length),assertLen(o+1+k[o]<=k.length),k.toString(enc,o+1,o+1+k[o])}function writeString(k,v,o,enc){if(Buffer.isBuffer(v))return assertLen(v.length<=255),assertLen(o+1<=k.length),k[o]=v.length,assertLen(v.copy(k,o+1)===v.length),1+v.length;assertType("string"==typeof v);var size=Buffer.byteLength(v,enc);return assertType(size<=255),assertLen(o+1<=k.length),k[o]=size,size>0&&assertType(k.write(v,o+1,enc)===size),1+size}function assertLen(ok){if(!ok){var err=new Error("Invalid length for database key.");throw Error.captureStackTrace&&Error.captureStackTrace(err,assertLen),err}}function assertType(ok){if(!ok){var err=new TypeError("Invalid type for database key.");throw Error.captureStackTrace&&Error.captureStackTrace(err,assertType),err}}module.exports=Key}).call(this,require("buffer").Buffer)},{assert:146,buffer:269}],194:[function(require,module,exports){(function(global,Buffer){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),IDB=global.indexedDB||global.webkitIndexedDB||global.mozIndexedDB||global.shimIndexedDB,KeyRange=global.IDBKeyRange||global.webkitIDBKeyRange||global.mozIDBKeyRange,flags_READ_ONLY="readonly",flags_READ_WRITE="readwrite",flags_NEXT="next",flags_PREV="prev",Level=function(){function Level(location){_classCallCheck(this,Level),assert("string"==typeof location),this.options={},this.version=1,this.name="bdb-"+location,this.location=location,this.db=null,this.store=null}return Level.prototype.transaction=function(flag){return this.db.transaction([this.location],flag)},Level.prototype.open=function(options,callback){var _this=this;callback||(callback=options,options=null),options||(options={}),this.options=options;var req=IDB.open(this.name,this.version);return req.onerror=createErrback(callback),req.onsuccess=function(event){if(_this.db)callback();else if(_this.db=event.target.result,"string"!=typeof _this.db.version)if(_this.db.objectStoreNames.contains(_this.location)){var tx=_this.transaction(flags_READ_ONLY);_this.store=tx.objectStore(_this.location),callback()}else callback(new Error("Could not create object store."));else callback(new Error("IndexedDB is out of date."))},req.onupgradeneeded=function(event){_this.db=event.target.result,_this.db.objectStoreNames.contains(_this.location)?_this.store=event.target.transaction.objectStore(_this.location):_this.store=_this.db.createObjectStore(_this.location,{autoIncrement:!1})},this},Level.prototype.close=function(callback){return this.db.close(),callback(),this},Level.prototype.put=function(key,value,callback){var errback=createErrback(callback),tx=this.transaction(flags_READ_WRITE),success=!1;tx.oncomplete=function(){success?callback():callback(new Error("Operation failed."))},tx.onabort=errback,tx.onerror=errback;var req=tx.objectStore(this.location).put(value,toHex(key));return req.onsuccess=function(event){success=!0},req.onerror=errback,this},Level.prototype.get=function(key,options,callback){callback||(callback=options,options=null),options||(options={});var errback=createErrback(callback),tx=this.transaction(flags_READ_ONLY),success=!1,result=null;tx.oncomplete=function(){if(success){if(void 0===result){var err=new Error("IDB_NOTFOUND: Key not found.");return err.notFound=!0,err.type="NotFoundError",void callback(err)}result&&!Buffer.isBuffer(result)&&result.buffer&&(result=Buffer.from(result.buffer)),!1===options.asBuffer&&(result=result.toString("utf8")),callback(null,result)}else callback(new Error("Operation failed."))},tx.onabort=errback,tx.onerror=errback;var req=tx.objectStore(this.location).get(toHex(key));return req.onsuccess=function(event){success=!0,result=event.target.result},req.onerror=errback,this},Level.prototype.del=function(key,callback){var errback=createErrback(callback),tx=this.transaction(flags_READ_WRITE),success=!1;tx.oncomplete=function(){success?callback():callback(new Error("Operation failed."))},tx.onabort=errback,tx.onerror=errback;var req=tx.objectStore(this.location).delete(toHex(key));return req.onsuccess=function(event){success=!0},req.onerror=errback,this},Level.prototype.batch=function(ops,options,callback){callback||(callback=options,options=null);var b=new Batch(this,options);return ops?(b.ops=ops,void b.write(callback)):b},Level.prototype.iterator=function(options){return new Iterator(this,options)},Level.destroy=function(location,callback){if(IDB.deleteDatabase){var req=IDB.deleteDatabase("bdb-"+location);req.onsuccess=function(){return callback()},req.onerror=createErrback(callback)}else callback(new Error("Destroy not supported."))},Level}(),Batch=function(){function Batch(db,options){_classCallCheck(this,Batch),this.db=db,this.options=options||{},this.ops=[],this.written=!1}return Batch.prototype.put=function(key,value){return assert(!this.written,"Already written."),this.ops.push(new BatchOp("put",key,value)),this},Batch.prototype.del=function(key){return assert(!this.written,"Already written."),this.ops.push(new BatchOp("del",key)),this},Batch.prototype.write=function(callback){if(this.written)return callback(new Error("Already written.")),this;var errback=createErrback(callback),tx=this.db.transaction(flags_READ_WRITE),count=this.ops.length,called=!1,success=!1;tx.oncomplete=function(){success?callback():callback(new Error("Operation failed."))},tx.onabort=errback,tx.onerror=errback;var onSuccess=function(){0!==(count-=1)||called||(called=!0,success=!0)},onError=function(event){tx.abort(),called||(called=!0,errback(event))},_iterator=this.ops,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref2;if(_isArray){if(_i>=_iterator.length)break;_ref2=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref2=_i.value}var _ref=_ref2,type=_ref.type,key=_ref.key,value=_ref.value,store=tx.objectStore(this.db.location);switch(type){case"put":var req=store.put(value,toHex(key));req.onsuccess=onSuccess,req.onerror=onError;break;case"del":var _req=store.delete(toHex(key));_req.onsuccess=onSuccess,_req.onerror=onError;break;default:return callback(new Error("Bad op type.")),this}}return this},Batch.prototype.clear=function(){return assert(!this.written,"Already written."),this.ops=[],this},Batch}(),BatchOp=function BatchOp(type,key,value){_classCallCheck(this,BatchOp),this.type=type,this.key=key,this.value=value},Iterator=function(){function Iterator(db,options){_classCallCheck(this,Iterator),this.db=db,this.options=new IteratorOptions(options),this.cursor=null,this.error=null,this.started=!1,this.ended=!1,this.callback=null}return Iterator.prototype.seek=function(key){throw new Error("Not implemented.")},Iterator.prototype.next=function(callback){if(this.ended)callback(new Error("Iterator already ended."));else if(this.callback)callback(new Error("Callback already pending."));else if(this.error)callback(this.error);else{if(!this.started)return this.callback=callback,void this.start();assert(this.cursor),this.callback=callback,this.cursor.continue(),this.cursor=null}},Iterator.prototype.end=function(callback){this.ended?callback(new Error("Iterator already ended.")):(this.ended=!0,callback())},Iterator.prototype.start=function(){var _this2=this;if(!this.started){var options=this.options,tx=this.db.transaction(flags_READ_ONLY),store=tx.objectStore(this.db.location),success=!1,total=0;tx.oncomplete=function(){success||_this2.error||(_this2.error=new Error("Iterator ended early.")),_this2.error?_this2.respond(_this2.error):_this2.respond(null,void 0,void 0)};var onError=function(event){_this2.error=wrapError(event),_this2.respond(_this2.error)};tx.onabort=onError,tx.onerror=onError;var start=toHex(options.start),end=toHex(options.end),range=null;range=start&&end?KeyRange.bound(start,end,options.gt,options.lt):start?KeyRange.lowerBound(start,options.gt):end?KeyRange.upperBound(end,options.lt):KeyRange.lowerBound("\0",!0);var direction=options.reverse?flags_PREV:flags_NEXT,req=store.openCursor(range,direction);req.onerror=onError,req.onsuccess=function(event){var cursor=event.target.result;if(_this2.error)_this2.respond(_this2.error);else if(cursor){if(-1!==options.limit){if(total>=options.limit)return void(success=!0);total+=1}var key=Buffer.from(cursor.key,"hex"),value=cursor.value;value&&!Buffer.isBuffer(value)&&value.buffer&&(value=Buffer.from(value.buffer)),options.keyAsBuffer||(key=key.toString("utf8")),options.valueAsBuffer||(value=value.toString("utf8")),_this2.cursor=cursor,_this2.respond(null,key,value)}else success=!0},this.started=!0}},Iterator.prototype.respond=function(err,key,value){if(this.callback){var cb=this.callback;this.callback=null,cb(err,key,value)}},Iterator}(),IteratorOptions=function(){function IteratorOptions(options){_classCallCheck(this,IteratorOptions),this.keys=!0,this.values=!0,this.start=null,this.end=null,this.gt=!1,this.lt=!1,this.keyAsBuffer=!0,this.valueAsBuffer=!0,this.reverse=!1,this.limit=-1,options&&this.fromOptions(options)}return IteratorOptions.prototype.fromOptions=function(options){return null!=options.keys&&(assert("boolean"==typeof options.keys),this.keys=options.keys),null!=options.values&&(assert("boolean"==typeof options.values),this.values=options.values),null!=options.start&&(this.start=options.start),null!=options.end&&(this.end=options.end),null!=options.gte&&(this.start=options.gte),null!=options.lte&&(this.end=options.lte),null!=options.gt&&(this.gt=!0,this.start=options.gt),null!=options.lt&&(this.lt=!0,this.end=options.lt),null!=this.start&&("string"==typeof this.start&&(this.start=Buffer.from(this.start,"utf8")),assert(Buffer.isBuffer(this.start),"`start` must be a Buffer.")),null!=this.end&&("string"==typeof this.end&&(this.end=Buffer.from(this.end,"utf8")),assert(Buffer.isBuffer(this.end),"`end` must be a Buffer.")),null!=options.keyAsBuffer&&(assert("boolean"==typeof options.keyAsBuffer),this.keyAsBuffer=options.keyAsBuffer),null!=options.valueAsBuffer&&(assert("boolean"==typeof options.valueAsBuffer),this.valueAsBuffer=options.valueAsBuffer),null!=options.reverse&&(assert("boolean"==typeof options.reverse),this.reverse=options.reverse),null!=options.limit&&(assert("number"==typeof options.limit),this.limit=options.limit),this},IteratorOptions}();function toHex(key){return null==key?key:("string"==typeof key&&(key=Buffer.from(key,"utf8")),assert(Buffer.isBuffer(key)),key.toString("hex"))}function wrapError(event){if(!event)return new Error("Unknown IndexedDB error (no event).");if(event instanceof Error)return event;var target=event.target;if(!target)return new Error("Unknown IndexedDB error (no target).");if(target.error){var error=target.error;return error instanceof Error?error:"VersionError"===error.name?new Error("IndexedDB version error."):new Error(String(error))}return null!=target.errorCode?12===target.errorCode?new Error("IndexedDB version error."):new Error("IndexedDB error: "+target.errorCode+"."):new Error("Unknown IndexedDB error (no error).")}function createErrback(callback){return function(event){return callback(wrapError(event))}}module.exports=Level}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},require("buffer").Buffer)},{assert:146,buffer:269}],195:[function(require,module,exports){(function(Buffer){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),RBT=require("./rbt"),DUMMY=Buffer.alloc(0),MemDB=function(){function MemDB(location){_classCallCheck(this,MemDB),this.location=location||"memory",this.options={},this.tree=new RBT(cmp,!0)}return MemDB.prototype.search=function(key){"string"==typeof key&&(key=Buffer.from(key,"utf8")),assert(Buffer.isBuffer(key),"Key must be a Buffer.");var node=this.tree.search(key);if(node)return node.value},MemDB.prototype.insert=function(key,value){return"string"==typeof key&&(key=Buffer.from(key,"utf8")),"string"==typeof value&&(value=Buffer.from(value,"utf8")),null==value&&(value=DUMMY),assert(Buffer.isBuffer(key),"Key must be a Buffer."),assert(Buffer.isBuffer(value),"Value must be a Buffer."),null!=this.tree.insert(key,value)},MemDB.prototype.remove=function(key){return"string"==typeof key&&(key=Buffer.from(key,"utf8")),assert(Buffer.isBuffer(key),"Key must be a Buffer."),null!=this.tree.remove(key)},MemDB.prototype.range=function(min,max){return"string"==typeof min&&(min=Buffer.from(min,"utf8")),"string"==typeof max&&(max=Buffer.from(max,"utf8")),assert(!min||Buffer.isBuffer(min),"Key must be a Buffer."),assert(!max||Buffer.isBuffer(max),"Key must be a Buffer."),this.tree.range(min,max)},MemDB.prototype.open=function(options,callback){callback||(callback=options,options=null),options||(options={}),this.options=options,setImmediate(callback)},MemDB.prototype.close=function(callback){setImmediate(callback)},MemDB.prototype.get=function(key,options,callback){callback||(callback=options,options=null),options||(options={});var value=this.search(key);if(!value){var err=new Error("MEMDB_NOTFOUND: Key not found.");return err.notFound=!0,err.type="NotFoundError",void setImmediate(function(){return callback(err)})}!1===options.asBuffer&&(value=value.toString("utf8")),setImmediate(function(){return callback(null,value)})},MemDB.prototype.put=function(key,value,options,callback){callback||(callback=options,options=null),this.insert(key,value),setImmediate(callback)},MemDB.prototype.del=function(key,options,callback){callback||(callback=options,options=null),this.remove(key),setImmediate(callback)},MemDB.prototype.batch=function(ops,options,callback){callback||(callback=options,options=null);var b=new Batch(this,options);return ops?(b.ops=ops,void b.write(callback)):b},MemDB.prototype.iterator=function(options){return new Iterator(this,options)},MemDB.prototype.getProperty=function(name){return""},MemDB.prototype.approximateSize=function(start,end,callback){var size=0,_iterator=this.range(start,end),_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var item=_ref;size+=item.key.length,size+=item.value.length}setImmediate(function(){return callback(null,size)})},MemDB.destroy=function(location,callback){setImmediate(callback)},MemDB.repair=function(location,callback){setImmediate(callback)},MemDB}(),Batch=function(){function Batch(db,options){_classCallCheck(this,Batch),this.options=options||{},this.ops=[],this.db=db,this.written=!1}return Batch.prototype.put=function(key,value){return assert(!this.written,"Already written."),this.ops.push(new BatchOp("put",key,value)),this},Batch.prototype.del=function(key){return assert(!this.written,"Already written."),this.ops.push(new BatchOp("del",key)),this},Batch.prototype.write=function(callback){if(this.written)return setImmediate(function(){return callback(new Error("Already written."))}),this;var _iterator2=this.ops,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref2=_i2.value}var op=_ref2;switch(op.type){case"put":this.db.insert(op.key,op.value);break;case"del":this.db.remove(op.key);break;default:return setImmediate(function(){return callback(new Error("Bad op."))}),this}}return this.ops=[],this.written=!0,setImmediate(callback),this},Batch.prototype.clear=function(){return assert(!this.written,"Already written."),this.ops=[],this},Batch}(),BatchOp=function BatchOp(type,key,value){_classCallCheck(this,BatchOp),this.type=type,this.key=key,this.value=value},Iterator=function(){function Iterator(db,options){_classCallCheck(this,Iterator),this.db=db,this.options=new IteratorOptions(options),this.iter=null,this.ended=!1,this.total=0,this.init()}return Iterator.prototype.init=function(){var snapshot=this.db.tree.snapshot(),iter=this.db.tree.iterator(snapshot);this.options.reverse?this.options.end?(iter.seekMax(this.options.end),this.options.lt&&iter.valid()&&0===iter.compare(this.options.end)&&iter.prev()):iter.seekLast():this.options.start?(iter.seekMin(this.options.start),this.options.gt&&iter.valid()&&0===iter.compare(this.options.start)&&iter.next()):iter.seekFirst(),this.iter=iter},Iterator.prototype.next=function(callback){var options=this.options,iter=this.iter;if(this.iter){var result=void 0;if(options.reverse?(result=iter.prev())&&options.start&&(options.gt?iter.compare(options.start)<=0&&(result=!1):iter.compare(options.start)<0&&(result=!1)):(result=iter.next())&&options.end&&(options.lt?iter.compare(options.end)>=0&&(result=!1):iter.compare(options.end)>0&&(result=!1)),!result)return this.iter=null,void setImmediate(callback);if(-1!==options.limit){if(this.total>=options.limit)return this.iter=null,void setImmediate(callback);this.total+=1}var key=iter.key,value=iter.value;options.keys||(key=DUMMY),options.values||(value=DUMMY),options.keyAsBuffer||(key=key.toString("utf8")),options.valueAsBuffer||(value=value.toString("utf8")),setImmediate(function(){return callback(null,key,value)})}else setImmediate(function(){return callback(new Error("Cannot call next."))})},Iterator.prototype.seek=function(key){assert(this.iter,"Already ended."),"string"==typeof key&&(key=Buffer.from(key,"utf8")),assert(Buffer.isBuffer(key),"Key must be a Buffer."),this.options.reverse?this.iter.seekMax(key):this.iter.seekMin(key)},Iterator.prototype.end=function(callback){this.ended?setImmediate(function(){return callback(new Error("Already ended."))}):(this.ended=!0,this.iter=null,setImmediate(callback))},Iterator}(),IteratorOptions=function(){function IteratorOptions(options){_classCallCheck(this,IteratorOptions),this.keys=!0,this.values=!0,this.start=null,this.end=null,this.gt=!1,this.lt=!1,this.keyAsBuffer=!0,this.valueAsBuffer=!0,this.reverse=!1,this.limit=-1,options&&this.fromOptions(options)}return IteratorOptions.prototype.fromOptions=function(options){return null!=options.keys&&(assert("boolean"==typeof options.keys),this.keys=options.keys),null!=options.values&&(assert("boolean"==typeof options.values),this.values=options.values),null!=options.start&&(this.start=options.start),null!=options.end&&(this.end=options.end),null!=options.gte&&(this.start=options.gte),null!=options.lte&&(this.end=options.lte),null!=options.gt&&(this.gt=!0,this.start=options.gt),null!=options.lt&&(this.lt=!0,this.end=options.lt),null!=this.start&&("string"==typeof this.start&&(this.start=Buffer.from(this.start,"utf8")),assert(Buffer.isBuffer(this.start),"`start` must be a Buffer.")),null!=this.end&&("string"==typeof this.end&&(this.end=Buffer.from(this.end,"utf8")),assert(Buffer.isBuffer(this.end),"`end` must be a Buffer.")),null!=options.keyAsBuffer&&(assert("boolean"==typeof options.keyAsBuffer),this.keyAsBuffer=options.keyAsBuffer),null!=options.valueAsBuffer&&(assert("boolean"==typeof options.valueAsBuffer),this.valueAsBuffer=options.valueAsBuffer),null!=options.reverse&&(assert("boolean"==typeof options.reverse),this.reverse=options.reverse),null!=options.limit&&(assert("number"==typeof options.limit),this.limit=options.limit),this},IteratorOptions}();function cmp(a,b){return a.compare(b)}module.exports=MemDB}).call(this,require("buffer").Buffer)},{"./rbt":196,assert:146,buffer:269}],196:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),RED=0,BLACK=1,SENTINEL=null,RBT=function(){function RBT(compare,unique){_classCallCheck(this,RBT),assert("function"==typeof compare),this.root=SENTINEL,this.compare=compare,this.unique=unique||!1}return RBT.prototype.reset=function(){this.root=SENTINEL},RBT.prototype.search=function(key){for(var current=this.root;!current.isNull();){var cmp=this.compare(key,current.key);if(0===cmp)return current;current=cmp<0?current.left:current.right}return null},RBT.prototype.insert=function(key,value){for(var current=this.root,left=!1,parent=void 0;!current.isNull();){var cmp=this.compare(key,current.key);if(this.unique&&0===cmp)return current.key=key,current.value=value,current;parent=current,cmp<0?(left=!0,current=current.left):(left=!1,current=current.right)}var node=new RBTNode(key,value);return parent?(node.parent=parent,left?parent.left=node:parent.right=node,this.insertFixup(node),node):(this.root=node,this.insertFixup(node),node)},RBT.prototype.insertFixup=function(x){for(x.color=RED;x!==this.root&&x.parent.color===RED;)if(x.parent===x.parent.parent.left){var y=x.parent.parent.right;y.isNull()||y.color!==RED?(x===x.parent.right&&(x=x.parent,this.rotl(x)),x.parent.color=BLACK,x.parent.parent.color=RED,this.rotr(x.parent.parent)):(x.parent.color=BLACK,y.color=BLACK,x.parent.parent.color=RED,x=x.parent.parent)}else{var _y=x.parent.parent.left;_y.isNull()||_y.color!==RED?(x===x.parent.left&&(x=x.parent,this.rotr(x)),x.parent.color=BLACK,x.parent.parent.color=RED,this.rotl(x.parent.parent)):(x.parent.color=BLACK,_y.color=BLACK,x.parent.parent.color=RED,x=x.parent.parent)}this.root.color=BLACK},RBT.prototype.remove=function(key){for(var current=this.root;!current.isNull();){var cmp=this.compare(key,current.key);if(0===cmp)return this.removeNode(current),current;current=cmp<0?current.left:current.right}return null},RBT.prototype.removeNode=function(z){var y=z;z.left.isNull()||z.right.isNull()||(y=this.successor(z));var x=y.left.isNull()?y.right:y.left;x.parent=y.parent,y.parent.isNull()?this.root=x:y===y.parent.left?y.parent.left=x:y.parent.right=x,y!==z&&(z.key=y.key,z.value=y.value),y.color===BLACK&&this.removeFixup(x)},RBT.prototype.removeFixup=function(x){for(;x!==this.root&&x.color===BLACK;)if(x===x.parent.left){var w=x.parent.right;w.color===RED&&(w.color=BLACK,x.parent.color=RED,this.rotl(x.parent),w=x.parent.right),w.left.color===BLACK&&w.right.color===BLACK?(w.color=RED,x=x.parent):(w.right.color===BLACK&&(w.left.color=BLACK,w.color=RED,this.rotr(w),w=x.parent.right),w.color=x.parent.color,x.parent.color=BLACK,w.right.color=BLACK,this.rotl(x.parent),x=this.root)}else{var _w=x.parent.left;_w.color===RED&&(_w.color=BLACK,x.parent.color=RED,this.rotr(x.parent),_w=x.parent.left),_w.right.color===BLACK&&_w.left.color===BLACK?(_w.color=RED,x=x.parent):(_w.left.color===BLACK&&(_w.right.color=BLACK,_w.color=RED,this.rotl(_w),_w=x.parent.left),_w.color=x.parent.color,x.parent.color=BLACK,_w.left.color=BLACK,this.rotr(x.parent),x=this.root)}x.color=BLACK},RBT.prototype.rotl=function(x){var y=x.right;x.right=y.left,y.left.isNull()||(y.left.parent=x),y.parent=x.parent,x.parent.isNull()?this.root=y:x===x.parent.left?x.parent.left=y:x.parent.right=y,y.left=x,x.parent=y},RBT.prototype.rotr=function(x){var y=x.left;x.left=y.right,y.right.isNull()||(y.right.parent=x),y.parent=x.parent,x.parent.isNull()?this.root=y:x===x.parent.right?x.parent.right=y:x.parent.left=y,y.right=x,x.parent=y},RBT.prototype.min=function(z){if(z.isNull())return z;for(;!z.left.isNull();)z=z.left;return z},RBT.prototype.max=function(z){if(z.isNull())return z;for(;!z.right.isNull();)z=z.right;return z},RBT.prototype.successor=function(x){if(!x.right.isNull()){for(x=x.right;!x.left.isNull();)x=x.left;return x}for(var y=x.parent;!y.isNull()&&x===y.right;)x=y,y=y.parent;return y},RBT.prototype.predecessor=function(x){if(!x.left.isNull()){for(x=x.left;!x.right.isNull();)x=x.right;return x}for(var y=x.parent;!y.isNull()&&x===y.left;)x=y,y=y.parent;return y},RBT.prototype.clone=function(){if(this.root.isNull())return SENTINEL;for(var stack=[],current=this.root,left=!0,parent=void 0,snapshot=void 0;;)if(current.isNull()){if(0===stack.length)break;parent=current=stack.pop(),left=!1,current=current.right}else{var copy=current.clone();parent&&(copy.parent=parent),left?parent?parent.left=copy:snapshot=copy:parent?parent.right=copy:snapshot=copy,stack.push(copy),parent=copy,left=!0,current=current.left}return assert(snapshot),snapshot},RBT.prototype.snapshot=function(){if(this.root.isNull())return SENTINEL;var node=this.root.clone();return copyLeft(node,node.left),copyRight(node,node.right),node},RBT.prototype.iterator=function(snapshot){return new RBTIterator(this,snapshot||this.root)},RBT.prototype.range=function(min,max){var iter=this.iterator(),items=[];for(min?iter.seekMin(min):iter.seekFirst();iter.next()&&!(max&&iter.compare(max)>0);)items.push(iter.data());return items},RBT}(),RBTIterator=function(){function RBTIterator(tree,snapshot){_classCallCheck(this,RBTIterator),this.tree=tree,this.root=snapshot,this.current=snapshot,this.key=null,this.value=null}return RBTIterator.prototype.compare=function(key){return assert(null!=this.key,"No key."),this.tree.compare(this.key,key)},RBTIterator.prototype.valid=function(){return!this.current.isNull()},RBTIterator.prototype.reset=function(){this.current=this.root,this.key=null,this.value=null},RBTIterator.prototype.seekFirst=function(){this.current=this.tree.min(this.root),this.key=this.current.key,this.value=this.current.value},RBTIterator.prototype.seekLast=function(){this.current=this.tree.max(this.root),this.key=this.current.key,this.value=this.current.value},RBTIterator.prototype.seek=function(key){return this.seekMin(key)},RBTIterator.prototype.seekMin=function(key){assert(null!=key,"No key passed to seek.");for(var root=this.current,current=SENTINEL;!root.isNull();){var cmp=this.tree.compare(root.key,key);if(0===cmp){current=root;break}cmp>0?(current=root,root=root.left):root=root.right}this.current=current,this.key=current.key,this.value=current.value},RBTIterator.prototype.seekMax=function(key){assert(null!=key,"No key passed to seek.");for(var root=this.current,current=SENTINEL;!root.isNull();){var cmp=this.tree.compare(root.key,key);if(0===cmp){current=root;break}cmp<0?(current=root,root=root.right):root=root.left}this.current=current,this.key=current.key,this.value=current.value},RBTIterator.prototype.prev=function(){return this.current.isNull()?(this.key=null,this.value=null,!1):(this.key=this.current.key,this.value=this.current.value,this.current=this.tree.predecessor(this.current),!0)},RBTIterator.prototype.next=function(){return this.current.isNull()?(this.key=null,this.value=null,!1):(this.key=this.current.key,this.value=this.current.value,this.current=this.tree.successor(this.current),!0)},RBTIterator.prototype.data=function(){return assert(null!=this.key,"No data available."),new RBTData(this.key,this.value)},RBTIterator}(),RBTNode=function(){function RBTNode(key,value){_classCallCheck(this,RBTNode),this.key=key,this.value=value,this.color=RED,this.parent=SENTINEL,this.left=SENTINEL,this.right=SENTINEL}return RBTNode.prototype.clone=function(){var node=new RBTNode(this.key,this.value);return node.color=this.color,node.parent=this.parent,node.left=this.left,node.right=this.right,node},RBTNode.prototype.copy=function(){return new RBTData(this.key,this.value)},RBTNode.prototype.inspect=function(){return{key:this.key,value:this.value,color:this.color===RED?"red":"black",left:this.left,right:this.right}},RBTNode.prototype.isNull=function(){return!1},RBTNode}(),RBTSentinel=function(){function RBTSentinel(){_classCallCheck(this,RBTSentinel),this.key=null,this.value=null,this.color=BLACK,this.parent=null,this.left=null,this.right=null}return RBTSentinel.prototype.inspect=function(){return"NIL"},RBTSentinel.prototype.isNull=function(){return!0},RBTSentinel}(),RBTData=function RBTData(key,value){_classCallCheck(this,RBTData),this.key=key,this.value=value};SENTINEL=new RBTSentinel;function copyLeft(parent,node){node.isNull()||(parent.left=node.clone(),parent.left.parent=parent,copyLeft(parent.left,node.left),copyRight(parent.left,node.right))}function copyRight(parent,node){node.isNull()||(parent.right=node.clone(),parent.right.parent=parent,copyLeft(parent.right,node.left),copyRight(parent.right,node.right))}module.exports=RBT},{assert:146}],197:[function(require,module,exports){"use strict";module.exports=require("./dns")},{"./dns":198}],198:[function(require,module,exports){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}exports.unsupported=!0,exports.Resolver=function Resolver(){throw function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Resolver),new Error("DNS resolver not available.")},exports.resolve=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(host,record,timeout){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:throw new Error("DNS not supported.");case 1:case"end":return _context.stop()}},_callee,this)}));return function(_x,_x2,_x3){return _ref.apply(this,arguments)}}(),exports.reverse=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(addr,timeout){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:throw new Error("DNS not supported.");case 1:case"end":return _context2.stop()}},_callee2,this)}));return function(_x4,_x5){return _ref2.apply(this,arguments)}}(),exports.lookup=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(host,family,timeout){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:throw new Error("DNS not supported.");case 1:case"end":return _context3.stop()}},_callee3,this)}));return function(_x6,_x7,_x8){return _ref3.apply(this,arguments)}}(),exports.lookupService=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(addr,port,timeout){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:throw new Error("DNS not supported.");case 1:case"end":return _context4.stop()}},_callee4,this)}));return function(_x9,_x10,_x11){return _ref4.apply(this,arguments)}}(),exports.getIPv4=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(timeout){return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:throw new Error("DNS not supported.");case 1:case"end":return _context5.stop()}},_callee5,this)}));return function(_x12){return _ref5.apply(this,arguments)}}(),exports.getIPv6=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(timeout){return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:throw new Error("DNS not supported.");case 1:case"end":return _context6.stop()}},_callee6,this)}));return function(_x13){return _ref6.apply(this,arguments)}}()},{}],199:[function(require,module,exports){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),AsyncEmitter=function(){function AsyncEmitter(){_classCallCheck(this,AsyncEmitter),this._events=Object.create(null)}return AsyncEmitter.prototype.addListener=function(type,handler){return this._push(type,handler,!1)},AsyncEmitter.prototype.on=function(type,handler){return this.addListener(type,handler)},AsyncEmitter.prototype.once=function(type,handler){return this._push(type,handler,!0)},AsyncEmitter.prototype.prependListener=function(type,handler){return this._unshift(type,handler,!1)},AsyncEmitter.prototype.prependOnceListener=function(type,handler){return this._unshift(type,handler,!0)},AsyncEmitter.prototype._push=function(type,handler,once){assert("string"==typeof type,"`type` must be a string."),this._events[type]||(this._events[type]=[]),this.emit("newListener",type,handler),this._events[type].push(new Listener(handler,once))},AsyncEmitter.prototype._unshift=function(type,handler,once){assert("string"==typeof type,"`type` must be a string."),this._events[type]||(this._events[type]=[]),this.emit("newListener",type,handler),this._events[type].unshift(new Listener(handler,once))},AsyncEmitter.prototype.removeListener=function(type,handler){assert("string"==typeof type,"`type` must be a string.");var listeners=this._events[type];if(listeners){for(var index=-1,i=0;i<listeners.length;i++){if(listeners[i].handler===handler){index=i;break}}-1!==index&&(splice(listeners,index),0===listeners.length&&delete this._events[type],this.emit("removeListener",type,handler))}},AsyncEmitter.prototype.setMaxListeners=function(max){assert("number"==typeof max,"`max` must be a number."),assert(max>=0,"`max` must be non-negative."),assert(Number.isSafeInteger(max),"`max` must be an integer.")},AsyncEmitter.prototype.removeAllListeners=function(type){0!==arguments.length?(assert("string"==typeof type,"`type` must be a string."),delete this._events[type]):this._events=Object.create(null)},AsyncEmitter.prototype.listeners=function(type){assert("string"==typeof type,"`type` must be a string.");var listeners=this._events[type];if(!listeners)return[];var result=[],_iterator=listeners,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref2;if(_isArray){if(_i>=_iterator.length)break;_ref2=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref2=_i.value}var handler=_ref2.handler;result.push(handler)}return result},AsyncEmitter.prototype.listenerCount=function(type){assert("string"==typeof type,"`type` must be a string.");var listeners=this._events[type];return listeners?listeners.length:0},AsyncEmitter.prototype.eventNames=function(){return Object.keys(this._events)},AsyncEmitter.prototype.emit=function(type){try{this._emit.apply(this,arguments)}catch(e){if("error"===type)throw e;this._emit("error",e)}},AsyncEmitter.prototype._emit=function(type){assert("string"==typeof type,"`type` must be a string.");var listeners=this._events[type];if(listeners){assert(listeners.length>0);for(var args=null,i=0;i<listeners.length;i++){var listener=listeners[i],handler=listener.handler;switch(listener.once&&(splice(listeners,i),0===listeners.length&&delete this._events[type],i-=1),arguments.length){case 1:handler();break;case 2:handler(arguments[1]);break;case 3:handler(arguments[1],arguments[2]);break;case 4:handler(arguments[1],arguments[2],arguments[3]);break;default:if(!args){args=new Array(arguments.length-1);for(var j=1;j<arguments.length;j++)args[j-1]=arguments[j]}handler.apply(null,args)}}}else if("error"===type){var msg=arguments[1];if(msg instanceof Error)throw msg;var err=new Error('Uncaught, unspecified "error" event. ('+msg+")");throw err.context=msg,err}},AsyncEmitter.prototype.emitAsync=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee(type){var _args=arguments;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,_context.next=3,this._emitAsync.apply(this,_args);case 3:_context.next=11;break;case 5:if(_context.prev=5,_context.t0=_context.catch(0),"error"!==type){_context.next=9;break}throw _context.t0;case 9:return _context.next=11,this._emitAsync("error",_context.t0);case 11:case"end":return _context.stop()}},_callee,this,[[0,5]])}));return function(_x){return _ref3.apply(this,arguments)}}(),AsyncEmitter.prototype._emitAsync=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(type){var listeners,msg,err,args,i,listener,handler,j,_args2=arguments;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(assert("string"==typeof type,"`type` must be a string."),listeners=this._events[type]){_context2.next=11;break}if("error"!==type){_context2.next=10;break}if(!((msg=_args2[1])instanceof Error)){_context2.next=7;break}throw msg;case 7:throw(err=new Error('Uncaught, unspecified "error" event. ('+msg+")")).context=msg,err;case 10:return _context2.abrupt("return");case 11:assert(listeners.length>0),args=null,i=0;case 14:if(!(i<listeners.length)){_context2.next=40;break}listener=listeners[i],handler=listener.handler,listener.once&&(splice(listeners,i),0===listeners.length&&delete this._events[type],i-=1),_context2.t0=_args2.length,_context2.next=1===_context2.t0?21:2===_context2.t0?24:3===_context2.t0?27:4===_context2.t0?30:33;break;case 21:return _context2.next=23,handler();case 23:return _context2.abrupt("break",37);case 24:return _context2.next=26,handler(_args2[1]);case 26:return _context2.abrupt("break",37);case 27:return _context2.next=29,handler(_args2[1],_args2[2]);case 29:return _context2.abrupt("break",37);case 30:return _context2.next=32,handler(_args2[1],_args2[2],_args2[3]);case 32:return _context2.abrupt("break",37);case 33:if(!args)for(args=new Array(_args2.length-1),j=1;j<_args2.length;j++)args[j-1]=_args2[j];return _context2.next=36,handler.apply(null,args);case 36:return _context2.abrupt("break",37);case 37:i++,_context2.next=14;break;case 40:case"end":return _context2.stop()}},_callee2,this)}));return function(_x2){return _ref4.apply(this,arguments)}}(),AsyncEmitter}(),Listener=function Listener(handler,once){_classCallCheck(this,Listener),assert("function"==typeof handler,"`handler` must be a function."),assert("boolean"==typeof once,"`once` must be a function."),this.handler=handler,this.once=once};function splice(list,i){if(0!==i){for(var k=i+1;k<list.length;)list[i++]=list[k++];list.pop()}else list.shift()}module.exports=AsyncEmitter},{assert:146}],200:[function(require,module,exports){"use strict";module.exports=require("./asyncemitter")},{"./asyncemitter":199}],201:[function(require,module,exports){"use strict";module.exports=require("./fs")},{"./fs":202}],202:[function(require,module,exports){"use strict";var noop=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:case"end":return _context3.stop()}},_callee3,this)}));return function(){return _ref3.apply(this,arguments)}}();function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function makeEnoent(syscall,path){"string"!=typeof path&&(path="/");var err=new Error("ENOENT: no such file or directory, "+syscall+" '"+path+"'");return err.errno=-2,err.code="ENOENT",err.syscall=syscall,err.path=path,Error.captureStackTrace&&Error.captureStackTrace(err,makeEnoent),err}function makeEbadf(syscall){var err=new Error("EBADF: bad file descriptor, "+syscall);return err.errno=-9,err.code="EBADF",err.syscall=syscall,err.path="/",Error.captureStackTrace&&Error.captureStackTrace(err,makeEbadf),err}function enoent(syscall){var _this=this;return function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(path){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:throw makeEnoent(syscall,path);case 1:case"end":return _context.stop()}},_callee,_this)}));return function(_x){return _ref.apply(this,arguments)}}()}function enoentSync(syscall){return function(path){throw makeEnoent(syscall,path)}}function ebadf(syscall){var _this2=this;return _asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:throw makeEbadf(syscall);case 1:case"end":return _context2.stop()}},_callee2,_this2)}))}function ebadfSync(syscall){return function(){throw makeEbadf(syscall)}}function noopSync(){}var readStream={emit:noopSync,on:function(event,handler){"error"===event&&handler(makeEnoent("stat"))},once:function(event,handler){"error"===event&&handler(makeEnoent("stat"))},addListener:function(event,handler){"error"===event&&handler(makeEnoent("stat"))},removeListener:noopSync,removeAllListeners:noopSync,listeners:function(){return[]},listenerCount:function(){return 0},readable:!0,writable:!1,write:noopSync,end:noopSync,close:noopSync,destroy:noopSync},writeStream={emit:noopSync,on:noopSync,once:noopSync,addListener:noopSync,removeListener:noopSync,removeAllListeners:noopSync,listeners:function(){return[]},listenerCount:function(){return 0},readable:!1,writable:!0,write:noopSync,end:noopSync,close:noopSync,destroy:noopSync};exports.unsupported=!0,exports.access=enoent("stat"),exports.accessSync=enoentSync("stat"),exports.appendFile=enoent("open"),exports.appendFileSync=enoentSync("open"),exports.chmod=noop,exports.chmodSync=noopSync,exports.chown=noop,exports.chownSync=noopSync,exports.close=ebadf("close"),exports.closeSync=ebadfSync("close"),exports.constants={O_RDONLY:0,O_WRONLY:1,O_RDWR:2,S_IFMT:61440,S_IFREG:32768,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960,S_IFSOCK:49152,O_CREAT:64,O_EXCL:128,O_NOCTTY:256,O_TRUNC:512,O_APPEND:1024,O_DIRECTORY:65536,O_NOATIME:262144,O_NOFOLLOW:131072,O_SYNC:1052672,O_DSYNC:4096,O_DIRECT:16384,O_NONBLOCK:2048,S_IRWXU:448,S_IRUSR:256,S_IWUSR:128,S_IXUSR:64,S_IRWXG:56,S_IRGRP:32,S_IWGRP:16,S_IXGRP:8,S_IRWXO:7,S_IROTH:4,S_IWOTH:2,S_IXOTH:1,F_OK:0,R_OK:4,W_OK:2,X_OK:1,UV_FS_COPYFILE_EXCL:1,COPYFILE_EXCL:1},exports.createReadStream=function(){return readStream},exports.createWriteStream=function(){return writeStream},exports.fchmod=ebadf("fchmod"),exports.fchmodSync=ebadfSync("fchmod"),exports.fchown=ebadf("fchown"),exports.fchownSync=ebadfSync("fchown"),exports.fdatasync=ebadf("fdatasync"),exports.fdatasyncSync=ebadfSync("fdatasync"),exports.fstat=ebadf("fstat"),exports.fstatSync=ebadfSync("fstat"),exports.fsync=ebadf("fsync"),exports.fsyncSync=ebadfSync("fsync"),exports.ftruncate=ebadf("ftruncate"),exports.ftruncateSync=ebadfSync("ftruncate"),exports.futimes=ebadf("futimes"),exports.futimesSync=ebadfSync("futimes"),exports.lchmod=noop,exports.lchmodSync=noopSync,exports.lchown=noop,exports.lchownSync=noopSync,exports.link=noop,exports.linkSync=noopSync,exports.lstat=enoent("lstat"),exports.lstatSync=enoentSync("lstat"),exports.mkdir=noop,exports.mkdirSync=noopSync,exports.mkdtemp=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.abrupt("return","/tmp/"+Math.random().toString(36));case 1:case"end":return _context4.stop()}},_callee4,void 0)})),exports.mkdtempSync=function(){return"/tmp/"+Math.random().toString(36)},exports.open=enoent("open"),exports.openSync=enoentSync("open"),exports.read=ebadf("read"),exports.readSync=ebadfSync("read"),exports.readdir=enoent("readdir"),exports.readdirSync=enoentSync("readdir"),exports.readFile=enoent("open"),exports.readFileSync=enoentSync("open"),exports.readlink=enoent("readlink"),exports.readlinkSync=enoentSync("readlink"),exports.realpath=enoent("stat"),exports.realpathSync=enoentSync("stat"),exports.rename=noop,exports.renameSync=noopSync,exports.rmdir=noop,exports.rmdirSync=noopSync,exports.stat=enoent("stat"),exports.statSync=enoentSync("stat"),exports.symlink=noop,exports.symlinkSync=noopSync,exports.truncate=noop,exports.truncateSync=noopSync,exports.unlink=noop,exports.unlinkSync=noopSync,exports.unwatchFile=noopSync,exports.utimes=noop,exports.utimesSync=noopSync,exports.watch=function(){return readStream},exports.watchFile=noopSync,exports.write=ebadf("write"),exports.writeSync=ebadfSync("write"),exports.writeFile=noop,exports.writeFileSync=noopSync,exports.exists=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.abrupt("return",!1);case 1:case"end":return _context5.stop()}},_callee5,void 0)})),exports.existsSync=function(){return!1},exports.rimraf=noop,exports.rimrafSync=noopSync,exports.mkdirp=noop,exports.mkdirpSync=noopSync},{}],203:[function(require,module,exports){"use strict";var murmur3=require("./murmur3"),BloomFilter=require("./bloom"),RollingFilter=require("./rolling");exports.murmur3=murmur3,exports.BloomFilter=BloomFilter,exports.RollingFilter=RollingFilter},{"./bloom":204,"./murmur3":205,"./rolling":206}],204:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),bio=require("bufio"),murmur3=require("./murmur3"),encoding=bio.encoding,DUMMY=Buffer.alloc(0),BloomFilter=function(){function BloomFilter(size,n,tweak,update){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BloomFilter),this.filter=DUMMY,this.size=0,this.n=0,this.tweak=0,this.update=BloomFilter.flags.NONE,null!=size&&this.fromOptions(size,n,tweak,update)}return BloomFilter.prototype.fromOptions=function(size,n,tweak,update){assert("number"==typeof size,"`size` must be a number."),assert(size>0,"`size` must be greater than zero."),assert(Number.isSafeInteger(size),"`size` must be an integer."),size-=size%8;var filter=Buffer.allocUnsafe(size/8);return filter.fill(0),null!=tweak&&-1!==tweak||(tweak=4294967296*Math.random()>>>0),null!=update&&-1!==update||(update=BloomFilter.flags.NONE),"string"==typeof update&&(update=BloomFilter.flags[update.toUpperCase()],assert(null!=update,"Unknown update flag.")),assert(size>0,"`size` must be greater than zero."),assert(n>0,"`n` must be greater than zero."),assert(Number.isSafeInteger(n),"`n` must be an integer."),assert("number"==typeof tweak,"`tweak` must be a number."),assert(Number.isSafeInteger(tweak),"`tweak` must be an integer."),assert(BloomFilter.flagsByVal[update],"Unknown update flag."),this.filter=filter,this.size=size,this.n=n,this.tweak=tweak,this.update=update,this},BloomFilter.fromOptions=function(size,n,tweak,update){return(new this).fromOptions(size,n,tweak,update)},BloomFilter.prototype.hash=function(val,n){return murmur3.tweak(val,n,this.tweak)%this.size},BloomFilter.prototype.reset=function(){this.filter.fill(0)},BloomFilter.prototype.add=function(val,enc){val=toBuffer(val,enc);for(var i=0;i<this.n;i++){var index=this.hash(val,i);this.filter[index>>>3]|=1<<(7&index)}},BloomFilter.prototype.test=function(val,enc){val=toBuffer(val,enc);for(var i=0;i<this.n;i++){var index=this.hash(val,i);if(0==(this.filter[index>>>3]&1<<(7&index)))return!1}return!0},BloomFilter.prototype.added=function(val,enc){val=toBuffer(val,enc);for(var ret=!1,i=0;i<this.n;i++){var index=this.hash(val,i);ret||0!=(this.filter[index>>>3]&1<<(7&index))||(ret=!0),this.filter[index>>>3]|=1<<(7&index)}return ret},BloomFilter.fromRate=function(items,rate,update){assert("number"==typeof items,"`items` must be a number."),assert(items>0,"`items` must be greater than zero."),assert(Number.isSafeInteger(items),"`items` must be an integer."),assert("number"==typeof rate,"`rate` must be a number."),assert(rate>=0&&rate<=1,"`rate` must be between 0.0 and 1.0.");var bits=-2.0813689810056077*items*Math.log(rate)|0,size=Math.max(8,bits);-1!==update&&assert(size<=8*BloomFilter.MAX_BLOOM_FILTER_SIZE,"Bloom filter size violates policy limits!");var n=Math.max(1,size/items*.6931471805599453|0);return-1!==update&&assert(n<=BloomFilter.MAX_HASH_FUNCS,"Bloom filter size violates policy limits!"),new this(size,n,-1,update)},BloomFilter.prototype.isWithinConstraints=function(){return!(this.size>8*BloomFilter.MAX_BLOOM_FILTER_SIZE)&&!(this.n>BloomFilter.MAX_HASH_FUNCS)},BloomFilter.prototype.getSize=function(){return encoding.sizeVarBytes(this.filter)+9},BloomFilter.prototype.toWriter=function(bw){return bw.writeVarBytes(this.filter),bw.writeU32(this.n),bw.writeU32(this.tweak),bw.writeU8(this.update),bw},BloomFilter.prototype.toRaw=function(){var size=this.getSize();return this.toWriter(bio.write(size)).render()},BloomFilter.prototype.fromReader=function(br){return this.filter=br.readVarBytes(),this.size=8*this.filter.length,this.n=br.readU32(),this.tweak=br.readU32(),this.update=br.readU8(),assert(null!=BloomFilter.flagsByVal[this.update],"Unknown update flag."),this},BloomFilter.prototype.fromRaw=function(data){return this.fromReader(bio.read(data))},BloomFilter.fromReader=function(br){return(new this).fromReader(br)},BloomFilter.fromRaw=function(data,enc){return"string"==typeof data&&(data=Buffer.from(data,enc)),(new this).fromRaw(data)},BloomFilter}();BloomFilter.MAX_BLOOM_FILTER_SIZE=36e3,BloomFilter.MAX_HASH_FUNCS=50,BloomFilter.flags={NONE:0,ALL:1,PUBKEY_ONLY:2},BloomFilter.flagsByVal={0:"NONE",1:"ALL",2:"PUBKEY_ONLY"};var POOL20=Buffer.allocUnsafe(20),POOL32=Buffer.allocUnsafe(32);function toBuffer(val,enc){return"string"!=typeof val?val:"hex"!==enc?Buffer.from(val,enc):40===val.length?(POOL20.write(val,0,20,"hex"),POOL20):64===val.length?(POOL32.write(val,0,32,"hex"),POOL32):Buffer.from(val,"hex")}module.exports=BloomFilter}).call(this,require("buffer").Buffer)},{"./murmur3":205,assert:146,buffer:269,bufio:270}],205:[function(require,module,exports){"use strict";function sum(data,seed){for(var tail=data.length-data.length%4,c1=3432918353,c2=461845907,h1=seed,i=0;i<tail;i+=4){var _k=data[i+3]<<24|data[i+2]<<16|data[i+1]<<8|data[i];h1=sum32(mul32(h1=rotl32(h1^=_k=mul32(_k=rotl32(_k=mul32(_k,c1),15),c2),13),5),3864292196)}var k1=0;switch(3&data.length){case 3:k1^=data[tail+2]<<16;case 2:k1^=data[tail+1]<<8;case 1:h1^=k1=mul32(k1=rotl32(k1=mul32(k1^=data[tail+0],c1),15),c2)}return h1^=data.length,h1=mul32(h1^=h1>>>16,2246822507),h1=mul32(h1^=h1>>>13,3266489909),(h1^=h1>>>16)<0&&(h1+=4294967296),h1}function mul32(a,b){var alo=65535&a,blo=65535&b,lo=alo*blo,hi=(a>>>16)*blo+(b>>>16)*alo&65535,r=(hi+=lo>>>16)<<16|(lo&=65535);return r<0&&(r+=4294967296),r}function sum32(a,b){var r=a+b&4294967295;return r<0&&(r+=4294967296),r}function rotl32(w,b){return w<<b|w>>>32-b}exports.sum=sum,exports.tweak=function(data,n,_tweak){return sum(data,sum32(mul32(n,4221880213),_tweak))}},{}],206:[function(require,module,exports){(function(Buffer){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),murmur3=require("./murmur3"),DUMMY=Buffer.alloc(0),RollingFilter=function(){function RollingFilter(items,rate){_classCallCheck(this,RollingFilter),this.entries=0,this.generation=1,this.n=0,this.limit=0,this.size=0,this.items=0,this.tweak=0,this.filter=DUMMY,null!=items&&this.fromRate(items,rate)}return RollingFilter.prototype.fromRate=function(items,rate){assert("number"==typeof items,"`items` must be a number."),assert(items>0,"`items` must be greater than zero."),assert(Number.isSafeInteger(items),"`items` must be an integer."),assert("number"==typeof rate,"`rate` must be a number."),assert(rate>=0&&rate<=1,"`rate` must be between 0.0 and 1.0.");var logRate=Math.log(rate),n=Math.max(1,Math.min(Math.round(logRate/Math.log(.5)),50)),limit=(items+1)/2|0,size=-1*n*(3*limit)/Math.log(1-Math.exp(logRate/n));items=(((size=Math.ceil(size))+63)/64|0)<<1,items>>>=0,items=Math.max(1,items);var tweak=4294967296*Math.random()>>>0,filter=Buffer.allocUnsafe(8*items);return filter.fill(0),this.n=n,this.limit=limit,this.size=size,this.items=items,this.tweak=tweak,this.filter=filter,this},RollingFilter.fromRate=function(items,rate){return(new this).fromRate(items,rate)},RollingFilter.prototype.hash=function(val,n){return murmur3.tweak(val,n,this.tweak)},RollingFilter.prototype.reset=function(){0!==this.entries&&(this.entries=0,this.generation=1,this.filter.fill(0))},RollingFilter.prototype.add=function(val,enc){if(val=toBuffer(val,enc),this.entries===this.limit){this.entries=0,this.generation+=1,4===this.generation&&(this.generation=1);for(var m1=4294967295*(1&this.generation),m2=4294967295*(this.generation>>>1),i=0;i<this.items;i+=2){var pos1=8*i,pos2=8*(i+1),v1=read(this.filter,pos1),v2=read(this.filter,pos2),mhi=v1.hi^m1|v2.hi^m2,mlo=v1.lo^m1|v2.lo^m2;v1.hi&=mhi,v1.lo&=mlo,v2.hi&=mhi,v2.lo&=mlo,write(this.filter,v1,pos1),write(this.filter,v2,pos2)}}this.entries+=1;for(var _i=0;_i<this.n;_i++){var hash=this.hash(val,_i),bits=63&hash,pos=(hash>>>6)%this.items,_pos=8*(-2&pos),_pos2=8*(1|pos),bit=bits%8,oct=(bits-bit)/8;this.filter[_pos+oct]&=~(1<<bit),this.filter[_pos+oct]|=(1&this.generation)<<bit,this.filter[_pos2+oct]&=~(1<<bit),this.filter[_pos2+oct]|=this.generation>>>1<<bit}},RollingFilter.prototype.test=function(val,enc){if(0===this.entries)return!1;val=toBuffer(val,enc);for(var i=0;i<this.n;i++){var hash=this.hash(val,i),bits=63&hash,pos=(hash>>>6)%this.items,pos1=8*(-2&pos),pos2=8*(1|pos),bit=bits%8,oct=(bits-bit)/8;if(0==(this.filter[pos1+oct]>>>bit&1|this.filter[pos2+oct]>>>bit&1))return!1}return!0},RollingFilter.prototype.added=function(val,enc){return val=toBuffer(val,enc),!this.test(val)&&(this.add(val),!0)},RollingFilter}(),U64=function U64(hi,lo){_classCallCheck(this,U64),this.hi=hi,this.lo=lo};function read(data,off){var hi=data.readUInt32LE(off+4,!0),lo=data.readUInt32LE(off,!0);return new U64(hi,lo)}function write(data,value,off){data.writeUInt32LE(value.hi,off+4,!0),data.writeUInt32LE(value.lo,off,!0)}var POOL20=Buffer.allocUnsafe(20),POOL32=Buffer.allocUnsafe(32);function toBuffer(val,enc){return"string"!=typeof val?val:"hex"!==enc?Buffer.from(val,enc):40===val.length?(POOL20.write(val,0,20,"hex"),POOL20):64===val.length?(POOL32.write(val,0,32,"hex"),POOL32):Buffer.from(val,"hex")}module.exports=RollingFilter}).call(this,require("buffer").Buffer)},{"./murmur3":205,assert:146,buffer:269}],207:[function(require,module,exports){(function(Buffer){"use strict";for(var assert=require("assert"),base32="abcdefghijklmnopqrstuvwxyz234567",padding=[0,6,4,3,1],unbase32={},i=0;i<base32.length;i++)unbase32[base32[i]]=i;exports.encode=function(data){assert(Buffer.isBuffer(data));for(var str="",mode=0,left=0,_i=0;_i<data.length;_i++){var ch=data[_i];switch(mode){case 0:str+=base32[ch>>>3],left=(7&ch)<<2,mode=1;break;case 1:str+=base32[left|ch>>>6],str+=base32[ch>>>1&31],left=(1&ch)<<4,mode=2;break;case 2:str+=base32[left|ch>>>4],left=(15&ch)<<1,mode=3;break;case 3:str+=base32[left|ch>>>7],str+=base32[ch>>>2&31],left=(3&ch)<<3,mode=4;break;case 4:str+=base32[left|ch>>>5],str+=base32[31&ch],mode=0}}if(mode>0){str+=base32[left];for(var _i2=0;_i2<padding[mode];_i2++)str+="="}return str},exports.decode=function(str){assert("string"==typeof str);var data=Buffer.allocUnsafe(5*str.length/8|0),mode=0,left=0,j=0,i=void 0;for(i=0;i<str.length;i++){var ch=unbase32[str[i]];if(null==ch)break;switch(mode){case 0:left=ch,mode=1;break;case 1:data[j++]=left<<3|ch>>>2,left=3&ch,mode=2;break;case 2:left=left<<5|ch,mode=3;break;case 3:data[j++]=left<<1|ch>>>4,left=15&ch,mode=4;break;case 4:data[j++]=left<<4|ch>>>1,left=1&ch,mode=5;break;case 5:left=left<<5|ch,mode=6;break;case 6:data[j++]=left<<2|ch>>>3,left=7&ch,mode=7;break;case 7:data[j++]=left<<5|ch,mode=0}}switch(mode){case 0:break;case 1:case 3:case 6:throw new Error("Invalid base32 string.");case 2:if(left>0)throw new Error("Invalid padding.");if("======"!==str.slice(i,i+6))throw new Error("Invalid base32 character.");if(null!=unbase32[str[i+6]])throw new Error("Invalid padding.");break;case 4:if(left>0)throw new Error("Invalid padding.");if("===="!==str.slice(i,i+4))throw new Error("Invalid base32 character.");if(null!=unbase32[str[i+4]])throw new Error("Invalid padding.");break;case 5:if(left>0)throw new Error("Invalid padding.");if("==="!==str.slice(i,i+3))throw new Error("Invalid base32 character.");if(null!=unbase32[str[i+3]])throw new Error("Invalid padding.");break;case 7:if(left>0)throw new Error("Invalid padding.");if("="!==str[i])throw new Error("Invalid base32 character.");if(null!=unbase32[str[i+1]])throw new Error("Invalid padding.")}return data.slice(0,j)}}).call(this,require("buffer").Buffer)},{assert:146,buffer:269}],208:[function(require,module,exports){"use strict";module.exports=require("./ip")},{"./ip":209}],209:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),os=require("os"),base32=require("./base32"),IP=exports,ZERO_IP=Buffer.from("00000000000000000000000000000000","hex"),LOCAL_IP=Buffer.from("00000000000000000000000000000001","hex"),RFC6052=Buffer.from("0064ff9b0000000000000000","hex"),RFC4862=Buffer.from("fe80000000000000","hex"),RFC6145=Buffer.from("0000000000000000ffff0000","hex"),TOR_ONION=Buffer.from("fd87d87eeb43","hex"),SHIFTED=Buffer.from("00000000000000ffff","hex"),IPV4_REGEX=/^(\d{1,3}\.){3}\d{1,3}$/,IPV6_REGEX=/^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i;IP.ZERO_IP=ZERO_IP,IP.types={DNS:-1,IPV4:4,IPV6:6,ONION:10,TEREDO:11},IP.fromHostname=function(addr,fallback){assert("string"==typeof addr),assert(addr.length>0,"Bad address.");var host=void 0,port=void 0;if("["===addr[0])if("]"===addr[addr.length-1])host=addr.slice(1,-1),port=null;else{var parts=(addr=addr.slice(1)).split("]:");assert(2===parts.length,"Bad IPv6 address."),host=parts[0],port=parts[1]}else{var _parts=addr.split(":");switch(_parts.length){case 2:host=_parts[0],port=_parts[1];break;case 1:host=_parts[0],port=null;break;default:assert(IP.isV6String(addr),"Bad IPv6 address."),host=addr,port=null}}assert(host.length>0,"Bad host."),null!=port?(assert(port.length<=5,"Bad port."),assert(/^\d+$/.test(port),"Bad port."),port=parseInt(port,10),assert(port<=65535)):port=fallback||0;var type=IP.getStringType(host),raw=void 0;type!==IP.types.DNS&&(raw=IP.toBuffer(host),host=IP.toString(raw));var hostname=void 0;return hostname=type===IP.types.IPV6?"["+host+"]:"+port:host+":"+port,new Address(host,port,type,hostname,raw)},IP.toHostname=function(host,port){assert("string"==typeof host),assert(host.length>0),assert("number"==typeof port),assert(port>=0&&port<=65535),assert(!/[\[\]]/.test(host),"Bad host.");var type=IP.getStringType(host);return-1!==host.indexOf(":")&&assert(type===IP.types.IPV6,"Bad host."),type!==IP.types.DNS&&(host=IP.normalize(host)),type===IP.types.IPV6?"["+host+"]:"+port:host+":"+port},IP.getStringType=function(str){return IP.isV4String(str)?IP.types.IPV4:IP.isV6String(str)?IP.types.IPV6:IP.isOnionString(str)?IP.types.ONION:IP.types.DNS},IP.isV4String=function(str){return assert("string"==typeof str),!(str.length<7)&&(!(str.length>15)&&IPV4_REGEX.test(str))},IP.isV6String=function(str){return assert("string"==typeof str),!(str.length<2)&&(!(str.length>39)&&IPV6_REGEX.test(str))},IP.isOnionString=function(str){return assert("string"==typeof str),!(str.length<7)&&".onion"===str.slice(-6)},IP.isMapped=function(raw){return assert(Buffer.isBuffer(raw)),assert(16===raw.length),0===raw[0]&&0===raw[1]&&0===raw[2]&&0===raw[3]&&0===raw[4]&&0===raw[5]&&0===raw[6]&&0===raw[7]&&0===raw[8]&&0===raw[9]&&255===raw[10]&&255===raw[11]},IP.toBuffer=function(str){assert("string"==typeof str);var raw=Buffer.allocUnsafe(16);if(IP.isV4String(str))return raw.fill(0,0,10),raw[10]=255,raw[11]=255,IP.parseV4(str,raw,12);if(IP.isOnionString(str)){TOR_ONION.copy(raw,0);var data=base32.decode(str.slice(0,-6));return assert(10===data.length,"Invalid onion address."),data.copy(raw,6),raw}return IP.parseV6(str,raw,0)},IP.parseV4=function(str,raw,offset){assert(str.length<=15);var parts=str.split(".");assert(4===parts.length);var _iterator=parts,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var part=_ref;assert(part.length>0),assert(part.length<=3);var ch=parseInt(part,10);assert((255&ch)===ch),raw[offset++]=ch}return raw},IP.parseV6=function(str,raw,offset){assert(str.length<=320);var parts=str.split(":"),missing=8-parts.length;assert(parts.length>=2,"Not an IPv6 address.");var _iterator2=parts,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref2=_i2.value}var word=_ref2;IP.isV4String(word)&&(missing-=1)}for(var start=offset,colon=!1,i=0;i<parts.length;i++){var part=parts[i];if(0!==part.length)if(IP.isV4String(part))IP.parseV4(part,raw,offset),offset+=4;else{assert(part.length<=4);var _word=parseInt(part,16);assert((65535&_word)===_word,"Non-number in IPv6 address."),raw[offset++]=_word>>8&255,raw[offset++]=255&_word}else{for(assert(!colon,"Overuse of double colon in IPv6 address."),colon=!0,missing+=1;i+1<parts.length;){if(0!==parts[i+1].length)break;missing+=1,i+=1}for(;missing>0;)raw[offset++]=0,raw[offset++]=0,missing-=1}}return assert(0===missing,"IPv6 address has missing sections."),assert.strictEqual(offset,start+16),raw},IP.toString=function(raw){if(assert(Buffer.isBuffer(raw)),4===raw.length){var host="";return host+=raw[0],host+="."+raw[1],host+="."+raw[2],host+="."+raw[3]}if(16===raw.length){if(IP.isMapped(raw)){var _host2="";return _host2+=raw[12],_host2+="."+raw[13],_host2+="."+raw[14],_host2+="."+raw[15]}if(IP.isOnion(raw)){return base32.encode(raw.slice(6))+".onion"}var _host="";_host+=raw.readUInt16BE(0,!0).toString(16);for(var i=2;i<16;i+=2)_host+=":",_host+=raw.readUInt16BE(i,!0).toString(16);return _host=(_host=_host.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3")).replace(/:{3,4}/,"::")}throw new Error("Invalid IP address: "+raw.toString("hex")+".")},IP.normalize=function(str){return IP.toString(IP.toBuffer(str))},IP.isIPv4=function(raw){return IP.isMapped(raw)},IP.isIPv6=function(raw){return!IP.isMapped(raw)&&!IP.isOnion(raw)},IP.getType=function(raw){if(IP.isIPv4(raw))return IP.types.IPV4;if(IP.isIPv6(raw))return IP.types.IPV6;if(IP.isOnion(raw))return IP.types.ONION;throw new Error("Unknown type.")},IP.getNetwork=function(raw){return IP.isRFC4380(raw)?IP.types.TEREDO:IP.getType(raw)},IP.isNull=function(raw){return IP.isIPv4(raw)?0===raw[12]&&0===raw[13]&&0===raw[14]&&0===raw[15]:IP.isEqual(raw,ZERO_IP)},IP.isBroadcast=function(raw){return!!IP.isIPv4(raw)&&(255===raw[12]&&255===raw[13]&&255===raw[14]&&255===raw[15])},IP.isRFC1918=function(raw){return!!IP.isIPv4(raw)&&(10===raw[12]||(192===raw[12]&&168===raw[13]||172===raw[12]&&raw[13]>=16&&raw[13]<=31))},IP.isRFC2544=function(raw){return!!IP.isIPv4(raw)&&(198===raw[12]&&(18===raw[13]||19===raw[13])||169===raw[12]&&254===raw[13])},IP.isRFC3927=function(raw){return!!IP.isIPv4(raw)&&(169===raw[12]&&254===raw[13])},IP.isRFC6598=function(raw){return!!IP.isIPv4(raw)&&(100===raw[12]&&raw[13]>=64&&raw[13]<=127)},IP.isRFC5737=function(raw){return!!IP.isIPv4(raw)&&(192===raw[12]&&0===raw[13]&&2===raw[14]||(198===raw[12]&&51===raw[13]&&100===raw[14]||203===raw[12]&&0===raw[13]&&113===raw[14]))},IP.isRFC3849=function(raw){return 32===raw[0]&&1===raw[1]&&13===raw[2]&&184===raw[3]},IP.isRFC3964=function(raw){return 32===raw[0]&&2===raw[1]},IP.isRFC6052=function(raw){return IP.hasPrefix(raw,RFC6052)},IP.isRFC4380=function(raw){return 32===raw[0]&&1===raw[1]&&0===raw[2]&&0===raw[3]},IP.isRFC4862=function(raw){return IP.hasPrefix(raw,RFC4862)},IP.isRFC4193=function(raw){return 252==(254&raw[0])},IP.isRFC6145=function(raw){return IP.hasPrefix(raw,RFC6145)},IP.isRFC4843=function(raw){return 32===raw[0]&&1===raw[1]&&0===raw[2]&&16==(240&raw[3])},IP.isOnion=function(raw){return IP.hasPrefix(raw,TOR_ONION)},IP.isLocal=function(raw){return IP.isIPv4(raw)?127===raw[12]&&0===raw[13]:!!IP.isEqual(raw,LOCAL_IP)},IP.isMulticast=function(raw){return IP.isIPv4(raw)?224==(240&raw[12]):255===raw[0]},IP.isValid=function(raw){return!IP.hasPrefix(raw,SHIFTED)&&(!IP.isNull(raw)&&(!IP.isBroadcast(raw)&&!IP.isRFC3849(raw)))},IP.isRoutable=function(raw){return!!IP.isValid(raw)&&(!IP.isRFC1918(raw)&&(!IP.isRFC2544(raw)&&(!IP.isRFC3927(raw)&&(!IP.isRFC4862(raw)&&(!IP.isRFC6598(raw)&&(!IP.isRFC5737(raw)&&(!(IP.isRFC4193(raw)&&!IP.isOnion(raw))&&(!IP.isRFC4843(raw)&&!IP.isLocal(raw)))))))))},IP.getReachability=function(src,dest){if(!IP.isRoutable(src))return 0;var srcNet=IP.getNetwork(src),destNet=IP.getNetwork(dest),types=IP.types;switch(destNet){case types.IPV4:switch(srcNet){case types.IPV4:return 4;default:return 1}break;case types.IPV6:switch(srcNet){case types.TEREDO:return 2;case types.IPV4:return 4;case types.IPV6:return IP.isRFC3964(src)||IP.isRFC6052(src)||IP.isRFC6145(src)?3:5;default:return 1}break;case types.ONION:switch(srcNet){case types.IPV4:return 4;case types.ONION:return 6;default:return 1}break;case types.TEREDO:switch(srcNet){case types.TEREDO:return 2;case types.IPV6:return 3;case types.IPV4:return 4;default:return 1}break;default:switch(srcNet){case types.TEREDO:return 2;case types.IPV6:return 3;case types.IPV4:return 4;case types.ONION:return 6;default:return 1}}},IP.hasPrefix=function(raw,prefix){assert(Buffer.isBuffer(raw)),assert(Buffer.isBuffer(prefix)),assert(raw.length>=prefix.length);for(var i=0;i<prefix.length;i++)if(raw[i]!==prefix[i])return!1;return!0},IP.isEqual=function(a,b){return assert(16===a.length),assert(16===b.length),a.equals(b)},IP.getInterfaces=function(name,family){var interfaces=os.networkInterfaces(),result=[],_iterator3=Object.keys(interfaces),_isArray3=Array.isArray(_iterator3),_i3=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref3;if(_isArray3){if(_i3>=_iterator3.length)break;_ref3=_iterator3[_i3++]}else{if((_i3=_iterator3.next()).done)break;_ref3=_i3.value}var _iterator4=interfaces[_ref3],_isArray4=Array.isArray(_iterator4),_i4=0;for(_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();;){var _ref4;if(_isArray4){if(_i4>=_iterator4.length)break;_ref4=_iterator4[_i4++]}else{if((_i4=_iterator4.next()).done)break;_ref4=_i4.value}var details=_ref4,type=details.family.toLowerCase();if((!family||type===family)&&!details.internal){var raw=void 0;try{raw=IP.toBuffer(details.address)}catch(e){continue}if(!IP.isNull(raw)&&!IP.isLocal(raw)){if("public"===name){if(!IP.isRoutable(raw))continue}else if("private"===name&&IP.isRoutable(raw))continue;result.push(IP.toString(raw))}}}}return result},IP.getPrivate=function(family){return IP.getInterfaces("private",family)},IP.getPublic=function(family){return IP.getInterfaces("public",family)};var Address=function Address(host,port,type,hostname,raw){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Address),this.host=host||"0.0.0.0",this.port=port||0,this.type=type||IP.types.IPV4,this.hostname=hostname||"0.0.0.0:0",this.raw=raw||ZERO_IP}}).call(this,require("buffer").Buffer)},{"./base32":207,assert:146,buffer:269,os:361}],210:[function(require,module,exports){var Buffer=require("safe-buffer").Buffer;module.exports={check:function(buffer){if(buffer.length<8)return!1;if(buffer.length>72)return!1;if(48!==buffer[0])return!1;if(buffer[1]!==buffer.length-2)return!1;if(2!==buffer[2])return!1;var lenR=buffer[3];if(0===lenR)return!1;if(5+lenR>=buffer.length)return!1;if(2!==buffer[4+lenR])return!1;var lenS=buffer[5+lenR];return!(0===lenS||6+lenR+lenS!==buffer.length||128&buffer[4]||lenR>1&&0===buffer[4]&&!(128&buffer[5])||128&buffer[lenR+6]||lenS>1&&0===buffer[lenR+6]&&!(128&buffer[lenR+7]))},decode:function(buffer){if(buffer.length<8)throw new Error("DER sequence length is too short");if(buffer.length>72)throw new Error("DER sequence length is too long");if(48!==buffer[0])throw new Error("Expected DER sequence");if(buffer[1]!==buffer.length-2)throw new Error("DER sequence length is invalid");if(2!==buffer[2])throw new Error("Expected DER integer");var lenR=buffer[3];if(0===lenR)throw new Error("R length is zero");if(5+lenR>=buffer.length)throw new Error("R length is too long");if(2!==buffer[4+lenR])throw new Error("Expected DER integer (2)");var lenS=buffer[5+lenR];if(0===lenS)throw new Error("S length is zero");if(6+lenR+lenS!==buffer.length)throw new Error("S length is invalid");if(128&buffer[4])throw new Error("R value is negative");if(lenR>1&&0===buffer[4]&&!(128&buffer[5]))throw new Error("R value excessively padded");if(128&buffer[lenR+6])throw new Error("S value is negative");if(lenS>1&&0===buffer[lenR+6]&&!(128&buffer[lenR+7]))throw new Error("S value excessively padded");return{r:buffer.slice(4,4+lenR),s:buffer.slice(6+lenR)}},encode:function(r,s){var lenR=r.length,lenS=s.length;if(0===lenR)throw new Error("R length is zero");if(0===lenS)throw new Error("S length is zero");if(lenR>33)throw new Error("R length is too long");if(lenS>33)throw new Error("S length is too long");if(128&r[0])throw new Error("R value is negative");if(128&s[0])throw new Error("S value is negative");if(lenR>1&&0===r[0]&&!(128&r[1]))throw new Error("R value excessively padded");if(lenS>1&&0===s[0]&&!(128&s[1]))throw new Error("S value excessively padded");var signature=Buffer.allocUnsafe(6+lenR+lenS);return signature[0]=48,signature[1]=signature.length-2,signature[2]=2,signature[3]=r.length,r.copy(signature,4),signature[4+lenR]=2,signature[5+lenR]=s.length,s.copy(signature,6+lenR),signature}}},{"safe-buffer":401}],211:[function(require,module,exports){"use strict";module.exports=require("./logger")},{"./logger":213}],212:[function(require,module,exports){arguments[4][150][0].apply(exports,arguments)},{dup:150}],213:[function(require,module,exports){(function(process,Buffer){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),_require=require("util"),format=_require.format,inspect=_require.inspect,fs=require("./fs"),inspectOptions={showHidden:!1,depth:20,colors:!1,customInspect:!0,showProxy:!1,maxArrayLength:1/0,breakLength:60},Logger=function(){function Logger(options){_classCallCheck(this,Logger),this.level=Logger.levels.NONE,this.colors=Logger.HAS_TTY,this.console=!0,this.shrink=!0,this.closed=!0,this.closing=!1,this.filename=null,this.stream=null,this.contexts=Object.create(null),options&&this.set(options)}return Logger.prototype.set=function(options){assert(options),assert(this.closed),"string"!=typeof options?(null!=options.level&&(assert("string"==typeof options.level),this.setLevel(options.level)),null!=options.colors&&Logger.HAS_TTY&&(assert("boolean"==typeof options.colors),this.colors=options.colors),null!=options.console&&(assert("boolean"==typeof options.console),this.console=options.console),null!=options.shrink&&(assert("boolean"==typeof options.shrink),this.shrink=options.shrink),null!=options.filename&&(assert("string"==typeof options.filename,"Bad file."),this.filename=options.filename)):this.setLevel(options)},Logger.prototype.open=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(this.filename){_context.next=3;break}return this.closed=!1,_context.abrupt("return");case 3:if(!this.stream){_context.next=6;break}return this.closed=!1,_context.abrupt("return");case 6:if(!fs.unsupported){_context.next=9;break}return this.closed=!1,_context.abrupt("return");case 9:if(!this.shrink){_context.next=12;break}return _context.next=12,this.truncate();case 12:return _context.next=14,openStream(this.filename);case 14:this.stream=_context.sent,this.stream.once("error",this.handleError.bind(this)),this.closed=!1;case 17:case"end":return _context.stop()}},_callee,this)}));return function(){return _ref.apply(this,arguments)}}(),Logger.prototype.close=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(null!=this.timer&&(clearTimeout(this.timer),this.timer=null),!fs.unsupported){_context2.next=5;break}return this.closed=!0,this.stream=null,_context2.abrupt("return");case 5:if(!this.stream){_context2.next=14;break}return _context2.prev=6,this.closing=!0,_context2.next=10,closeStream(this.stream);case 10:return _context2.prev=10,this.closing=!1,_context2.finish(10);case 13:this.stream=null;case 14:this.closed=!0;case 15:case"end":return _context2.stop()}},_callee2,this,[[6,,10,13]])}));return function(){return _ref2.apply(this,arguments)}}(),Logger.prototype.truncate=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var stat,maxSize,fd,data;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(this.filename){_context3.next=2;break}return _context3.abrupt("return");case 2:if(!fs.unsupported){_context3.next=4;break}return _context3.abrupt("return");case 4:return assert(!this.stream),stat=void 0,_context3.prev=6,_context3.next=9,fs.stat(this.filename);case 9:stat=_context3.sent,_context3.next=17;break;case 12:if(_context3.prev=12,_context3.t0=_context3.catch(6),"ENOENT"!==_context3.t0.code){_context3.next=16;break}return _context3.abrupt("return");case 16:throw _context3.t0;case 17:if(maxSize=Logger.MAX_FILE_SIZE,!(stat.size<=maxSize+maxSize/10)){_context3.next=20;break}return _context3.abrupt("return");case 20:return this.debug("Truncating log file to %dmb.",mb(maxSize)),_context3.next=23,fs.open(this.filename,"r+");case 23:return fd=_context3.sent,data=Buffer.allocUnsafe(maxSize),_context3.next=27,fs.read(fd,data,0,maxSize,stat.size-maxSize);case 27:return _context3.next=29,fs.ftruncate(fd,maxSize);case 29:return _context3.next=31,fs.write(fd,data,0,maxSize,0);case 31:return _context3.next=33,fs.close(fd);case 33:case"end":return _context3.stop()}},_callee3,this,[[6,12]])}));return function(){return _ref3.apply(this,arguments)}}(),Logger.prototype.handleError=function(err){try{this.stream.close()}catch(e){}this.stream=null,this.retry()},Logger.prototype.reopen=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){var _this=this;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(!this.stream){_context4.next=2;break}return _context4.abrupt("return");case 2:if(!this.closed){_context4.next=4;break}return _context4.abrupt("return");case 4:if(!fs.unsupported){_context4.next=6;break}return _context4.abrupt("return");case 6:return _context4.prev=6,_context4.next=9,openStream(this.filename);case 9:this.stream=_context4.sent,_context4.next=16;break;case 12:return _context4.prev=12,_context4.t0=_context4.catch(6),this.retry(),_context4.abrupt("return");case 16:this.stream.once("error",function(e){return _this.handleError(e)});case 17:case"end":return _context4.stop()}},_callee4,this,[[6,12]])}));return function(){return _ref4.apply(this,arguments)}}(),Logger.prototype.retry=function(){var _this2=this;null==this.timer&&(this.timer=setTimeout(function(){_this2.timer=null,_this2.reopen()},1e4))},Logger.prototype.setFile=function(filename){assert("string"==typeof filename),assert(!this.stream,"Log stream has already been created."),this.filename=filename},Logger.prototype.setLevel=function(name){var level=Logger.levels[name.toUpperCase()];assert(null!=level,"Invalid log level."),this.level=level},Logger.prototype.fmt=function(args,colors){if(args.length>0){var obj=args[0];if(obj&&"object"===(void 0===obj?"undefined":_typeof(obj)))return inspectOptions.colors=colors,inspect(obj,inspectOptions)}return format.apply(void 0,args)},Logger.prototype.error=function(){if(!(this.level<Logger.levels.ERROR)){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];var err=args[0];err instanceof Error?this.logError(Logger.levels.ERROR,null,err):this.log(Logger.levels.ERROR,null,args)}},Logger.prototype.warning=function(){if(!(this.level<Logger.levels.WARNING)){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];var err=args[0];err instanceof Error?this.logError(Logger.levels.WARNING,null,err):this.log(Logger.levels.WARNING,null,args)}},Logger.prototype.info=function(){if(!(this.level<Logger.levels.INFO)){for(var _len3=arguments.length,args=Array(_len3),_key3=0;_key3<_len3;_key3++)args[_key3]=arguments[_key3];var err=args[0];err instanceof Error?this.logError(Logger.levels.INFO,null,err):this.log(Logger.levels.INFO,null,args)}},Logger.prototype.debug=function(){if(!(this.level<Logger.levels.DEBUG)){for(var _len4=arguments.length,args=Array(_len4),_key4=0;_key4<_len4;_key4++)args[_key4]=arguments[_key4];var err=args[0];err instanceof Error?this.logError(Logger.levels.DEBUG,null,err):this.log(Logger.levels.DEBUG,null,args)}},Logger.prototype.spam=function(){if(!(this.level<Logger.levels.SPAM)){for(var _len5=arguments.length,args=Array(_len5),_key5=0;_key5<_len5;_key5++)args[_key5]=arguments[_key5];var err=args[0];err instanceof Error?this.logError(Logger.levels.SPAM,null,err):this.log(Logger.levels.SPAM,null,args)}},Logger.prototype.log=function(level,module,args){this.closed||this.level<level||(this.writeConsole(level,module,args),this.writeStream(level,module,args))},Logger.prototype.context=function(module){var ctx=this.contexts[module];return ctx||(ctx=new LoggerContext(this,module),this.contexts[module]=ctx),ctx},Logger.prototype.writeConsole=function(level,module,args){var name=Logger.levelsByVal[level];if(assert(name,"Invalid log level."),!this.console)return!1;if(!process.stdout){var _msg="["+name+"] ";if(module&&(_msg+="("+module+") "),args.length>0){var obj=args[0];if(obj&&"object"===(void 0===obj?"undefined":_typeof(obj)))return level===Logger.levels.ERROR?console.error(_msg,obj):console.log(_msg,obj)}return _msg+=this.fmt(args,!1),level===Logger.levels.ERROR?console.error(_msg):console.log(_msg),!0}var msg=void 0;if(this.colors){var color=Logger.styles[level];assert(color),msg="["+color+"m["+name+"][m "}else msg="["+name+"] ";return module&&(msg+="("+module+") "),msg+=this.fmt(args,this.colors),msg+="\n",level===Logger.levels.ERROR?process.stderr.write(msg):process.stdout.write(msg)},Logger.prototype.writeStream=function(level,module,args){var name=Logger.prefixByVal[level];if(assert(name,"Invalid log level."),this.stream&&!this.closing){var msg="["+name+":"+((new Date).toISOString().slice(0,-5)+"Z")+"] ";module&&(msg+="("+module+") "),msg+=this.fmt(args,!1),msg+="\n",this.stream.write(msg)}},Logger.prototype.logError=function(level,module,err){if(!this.closed){fs.unsupported&&this.console&&level<=Logger.levels.WARNING&&console.error(err);var msg=String(err.message).replace(/^ *Error: */,"");level!==Logger.levels.ERROR&&(msg="Error: "+msg),this.log(level,module,[msg]),level<=Logger.levels.WARNING&&this.stream&&this.stream.write(err.stack+"\n")}},Logger.prototype.memoryUsage=function(){if(!process.memoryUsage)return{total:0,jsHeap:0,jsHeapTotal:0,nativeHeap:0,external:0};var mem=process.memoryUsage();return{total:mb(mem.rss),jsHeap:mb(mem.heapUsed),jsHeapTotal:mb(mem.heapTotal),nativeHeap:mb(mem.rss-mem.heapTotal),external:mb(mem.external)}},Logger.prototype.memory=function(module){var mem=this.memoryUsage();this.log(Logger.levels.DEBUG,module,["Memory: rss=%dmb, js-heap=%d/%dmb native-heap=%dmb",mem.total,mem.jsHeap,mem.jsHeapTotal,mem.nativeHeap])},Logger}(),LoggerContext=function(){function LoggerContext(logger,module){_classCallCheck(this,LoggerContext),assert("string"==typeof module),this.logger=logger,this.module=module}return LoggerContext.prototype.open=function(){return this.logger.open()},LoggerContext.prototype.close=function(){return this.logger.close()},LoggerContext.prototype.setFile=function(filename){this.logger.setFile(filename)},LoggerContext.prototype.setLevel=function(name){this.logger.setLevel(name)},LoggerContext.prototype.error=function(){if(!(this.logger.level<Logger.levels.ERROR)){for(var _len6=arguments.length,args=Array(_len6),_key6=0;_key6<_len6;_key6++)args[_key6]=arguments[_key6];var err=args[0];err instanceof Error?this.logError(Logger.levels.ERROR,err):this.log(Logger.levels.ERROR,args)}},LoggerContext.prototype.warning=function(){if(!(this.logger.level<Logger.levels.WARNING)){for(var _len7=arguments.length,args=Array(_len7),_key7=0;_key7<_len7;_key7++)args[_key7]=arguments[_key7];var err=args[0];err instanceof Error?this.logError(Logger.levels.WARNING,err):this.log(Logger.levels.WARNING,args)}},LoggerContext.prototype.info=function(){if(!(this.logger.level<Logger.levels.INFO)){for(var _len8=arguments.length,args=Array(_len8),_key8=0;_key8<_len8;_key8++)args[_key8]=arguments[_key8];var err=args[0];err instanceof Error?this.logError(Logger.levels.INFO,err):this.log(Logger.levels.INFO,args)}},LoggerContext.prototype.debug=function(){if(!(this.logger.level<Logger.levels.DEBUG)){for(var _len9=arguments.length,args=Array(_len9),_key9=0;_key9<_len9;_key9++)args[_key9]=arguments[_key9];var err=args[0];err instanceof Error?this.logError(Logger.levels.DEBUG,err):this.log(Logger.levels.DEBUG,args)}},LoggerContext.prototype.spam=function(){if(!(this.logger.level<Logger.levels.SPAM)){for(var _len10=arguments.length,args=Array(_len10),_key10=0;_key10<_len10;_key10++)args[_key10]=arguments[_key10];var err=args[0];err instanceof Error?this.logError(Logger.levels.SPAM,err):this.log(Logger.levels.SPAM,args)}},LoggerContext.prototype.log=function(level,args){this.logger.log(level,this.module,args)},LoggerContext.prototype.context=function(module){return new LoggerContext(this.logger,module)},LoggerContext.prototype.logError=function(level,err){this.logger.logError(level,this.module,err)},LoggerContext.prototype.memoryUsage=function(){return this.logger.memoryUsage()},LoggerContext.prototype.memory=function(){this.logger.memory(this.module)},LoggerContext}();Logger.HAS_TTY=Boolean(process.stdout&&process.stdout.isTTY),Logger.MAX_FILE_SIZE=20<<20,Logger.levels={NONE:0,ERROR:1,WARNING:2,INFO:3,DEBUG:4,SPAM:5},Logger.levelsByVal=["none","error","warning","info","debug","spam"],Logger.prefixByVal=["N","E","W","I","D","S"],Logger.styles=["0","1;31","1;33","94","90","90"],Logger.global=new Logger;function mb(num){return Math.floor(num/(1<<20))}function openStream(filename){return new Promise(function(resolve,reject){var stream=fs.createWriteStream(filename,{flags:"a"}),cleanup=function(){stream.removeListener("error",onError),stream.removeListener("open",onOpen)},onError=function(err){try{stream.close()}catch(e){}cleanup(),reject(err)},onOpen=function(){cleanup(),resolve(stream)};stream.once("error",onError),stream.once("open",onOpen)})}function closeStream(stream){return new Promise(function(resolve,reject){var cleanup=function(){stream.removeListener("error",onError),stream.removeListener("close",onClose)},onError=function(err){cleanup(),reject(err)},onClose=function(){cleanup(),resolve(stream)};stream.removeAllListeners("error"),stream.removeAllListeners("close"),stream.once("error",onError),stream.once("close",onClose),stream.close()})}module.exports=Logger}).call(this,require("_process"),require("buffer").Buffer)},{"./fs":212,_process:374,assert:146,buffer:269,util:428}],214:[function(require,module,exports){"use strict";exports.Lock=require("./lock"),exports.MapLock=require("./maplock")},{"./lock":215,"./maplock":216}],215:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),Lock=function(){function Lock(){var named=arguments.length>0&&void 0!==arguments[0]&&arguments[0];_classCallCheck(this,Lock),this.named=!0===named,this.jobs=[],this.busy=!1,this.destroyed=!1,this.map=new Map,this.current=null,this.unlocker=this.unlock.bind(this)}return Lock.create=function(named){var lock=new Lock(named);return function(arg1,arg2){return lock.lock(arg1,arg2)}},Lock.prototype.has=function(name){return assert(this.named,"Must use named jobs."),this.current===name||this.pending(name)},Lock.prototype.pending=function(name){assert(this.named,"Must use named jobs.");var count=this.map.get(name);return null!=count&&count>0},Lock.prototype.lock=function(arg1,arg2){var _this=this,name=void 0,force=void 0;if(this.named?(name=arg1||null,force=arg2||!1):(name=null,force=arg1||!1),this.destroyed)return Promise.reject(new Error("Lock is destroyed."));if(force)return assert(this.busy),Promise.resolve(nop);if(this.busy){if(name){var count=this.map.get(name)||0;this.map.set(name,count+1)}return new Promise(function(resolve,reject){_this.jobs.push(new Job(resolve,reject,name))})}return this.busy=!0,this.current=name,Promise.resolve(this.unlocker)},Lock.prototype.unlock=function(){if(assert(this.destroyed||this.busy),this.busy=!1,this.current=null,0!==this.jobs.length){assert(!this.destroyed);var job=this.jobs.shift();if(job.name){var count=this.map.get(job.name);assert(count>0),0==--count?this.map.delete(job.name):this.map.set(job.name,count)}this.busy=!0,this.current=job.name,job.resolve(this.unlocker)}},Lock.prototype.destroy=function(){assert(!this.destroyed,"Lock is already destroyed."),this.destroyed=!0;var jobs=this.jobs;this.busy=!1,this.jobs=[],this.map.clear(),this.current=null;var _iterator=jobs,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}_ref.reject(new Error("Lock was destroyed."))}},Lock}(),Job=function Job(resolve,reject,name){_classCallCheck(this,Job),this.resolve=resolve,this.reject=reject,this.name=name||null};function nop(){}module.exports=Lock},{assert:146}],216:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),MapLock=function(){function MapLock(){_classCallCheck(this,MapLock),this.jobs=new Map,this.busy=new Set,this.destroyed=!1}return MapLock.create=function(){var lock=new MapLock;return function(key,force){return lock.lock(key,force)}},MapLock.prototype.has=function(name){return this.busy.has(name)},MapLock.prototype.pending=function(name){return this.jobs.has(name)},MapLock.prototype.lock=function(key){var _this=this,force=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.destroyed?Promise.reject(new Error("Lock is destroyed.")):null==key?Promise.resolve(nop):force?(assert(this.busy.has(key)),Promise.resolve(nop)):this.busy.has(key)?new Promise(function(resolve,reject){_this.jobs.has(key)||_this.jobs.set(key,[]),_this.jobs.get(key).push(new Job(resolve,reject))}):(this.busy.add(key),Promise.resolve(this.unlock(key)))},MapLock.prototype.unlock=function(key){var self=this;return function unlocker(){var jobs=self.jobs.get(key);if(assert(self.destroyed||self.busy.has(key)),self.busy.delete(key),jobs){assert(!self.destroyed);var job=jobs.shift();assert(job),0===jobs.length&&self.jobs.delete(key),self.busy.add(key),job.resolve(unlocker)}}},MapLock.prototype.destroy=function(){assert(!this.destroyed,"Lock is already destroyed.");var map=this.jobs;this.destroyed=!0,this.jobs=new Map,this.busy=new Map;var _iterator=map.values(),_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var _iterator2=_ref,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref2=_i2.value}_ref2.reject(new Error("Lock was destroyed."))}}},MapLock}(),Job=function Job(resolve,reject){_classCallCheck(this,Job),this.resolve=resolve,this.reject=reject};function nop(){}module.exports=MapLock},{assert:146}],217:[function(require,module,exports){!function(module,exports){"use strict";function assert(val,msg){if(!val)throw new Error(msg||"Assertion failed")}function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}function BN(number,base,endian){if(BN.isBN(number))return number;this.negative=0,this.words=null,this.length=0,this.red=null,null!==number&&("le"!==base&&"be"!==base||(endian=base,base=10),this._init(number||0,base||10,endian||"be"))}"object"==typeof module?module.exports=BN:exports.BN=BN,BN.BN=BN,BN.wordSize=26;var Buffer;try{Buffer=require("buffer").Buffer}catch(e){}BN.isBN=function(num){return num instanceof BN||null!==num&&"object"==typeof num&&num.constructor.wordSize===BN.wordSize&&Array.isArray(num.words)},BN.max=function(left,right){return left.cmp(right)>0?left:right},BN.min=function(left,right){return left.cmp(right)<0?left:right},BN.prototype._init=function(number,base,endian){if("number"==typeof number)return this._initNumber(number,base,endian);if("object"==typeof number)return this._initArray(number,base,endian);"hex"===base&&(base=16),assert(base===(0|base)&&base>=2&&base<=36);var start=0;"-"===(number=number.toString().replace(/\s+/g,""))[0]&&start++,16===base?this._parseHex(number,start):this._parseBase(number,base,start),"-"===number[0]&&(this.negative=1),this.strip(),"le"===endian&&this._initArray(this.toArray(),base,endian)},BN.prototype._initNumber=function(number,base,endian){number<0&&(this.negative=1,number=-number),number<67108864?(this.words=[67108863&number],this.length=1):number<4503599627370496?(this.words=[67108863&number,number/67108864&67108863],this.length=2):(assert(number<9007199254740992),this.words=[67108863&number,number/67108864&67108863,1],this.length=3),"le"===endian&&this._initArray(this.toArray(),base,endian)},BN.prototype._initArray=function(number,base,endian){if(assert("number"==typeof number.length),number.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(number.length/3),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var j,w,off=0;if("be"===endian)for(i=number.length-1,j=0;i>=0;i-=3)w=number[i]|number[i-1]<<8|number[i-2]<<16,this.words[j]|=w<<off&67108863,this.words[j+1]=w>>>26-off&67108863,(off+=24)>=26&&(off-=26,j++);else if("le"===endian)for(i=0,j=0;i<number.length;i+=3)w=number[i]|number[i+1]<<8|number[i+2]<<16,this.words[j]|=w<<off&67108863,this.words[j+1]=w>>>26-off&67108863,(off+=24)>=26&&(off-=26,j++);return this.strip()};function parseHex(str,start,end){for(var r=0,len=Math.min(str.length,end),i=start;i<len;i++){var c=str.charCodeAt(i)-48;r<<=4,r|=c>=49&&c<=54?c-49+10:c>=17&&c<=22?c-17+10:15&c}return r}BN.prototype._parseHex=function(number,start){this.length=Math.ceil((number.length-start)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var j,w,off=0;for(i=number.length-6,j=0;i>=start;i-=6)w=parseHex(number,i,i+6),this.words[j]|=w<<off&67108863,this.words[j+1]|=w>>>26-off&4194303,(off+=24)>=26&&(off-=26,j++);i+6!==start&&(w=parseHex(number,start,i+6),this.words[j]|=w<<off&67108863,this.words[j+1]|=w>>>26-off&4194303),this.strip()};function parseBase(str,start,end,mul){for(var r=0,len=Math.min(str.length,end),i=start;i<len;i++){var c=str.charCodeAt(i)-48;r*=mul,r+=c>=49?c-49+10:c>=17?c-17+10:c}return r}BN.prototype._parseBase=function(number,base,start){this.words=[0],this.length=1;for(var limbLen=0,limbPow=1;limbPow<=67108863;limbPow*=base)limbLen++;limbLen--,limbPow=limbPow/base|0;for(var total=number.length-start,mod=total%limbLen,end=Math.min(total,total-mod)+start,word=0,i=start;i<end;i+=limbLen)word=parseBase(number,i,i+limbLen,base),this.imuln(limbPow),this.words[0]+word<67108864?this.words[0]+=word:this._iaddn(word);if(0!==mod){var pow=1;for(word=parseBase(number,i,number.length,base),i=0;i<mod;i++)pow*=base;this.imuln(pow),this.words[0]+word<67108864?this.words[0]+=word:this._iaddn(word)}},BN.prototype.copy=function(dest){dest.words=new Array(this.length);for(var i=0;i<this.length;i++)dest.words[i]=this.words[i];dest.length=this.length,dest.negative=this.negative,dest.red=this.red},BN.prototype.clone=function(){var r=new BN(null);return this.copy(r),r},BN.prototype._expand=function(size){for(;this.length<size;)this.words[this.length++]=0;return this},BN.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},BN.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},BN.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var zeros=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],groupSizes=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],groupBases=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];BN.prototype.toString=function(base,padding){base=base||10,padding=0|padding||1;var out;if(16===base||"hex"===base){out="";for(var off=0,carry=0,i=0;i<this.length;i++){var w=this.words[i],word=(16777215&(w<<off|carry)).toString(16);out=0!==(carry=w>>>24-off&16777215)||i!==this.length-1?zeros[6-word.length]+word+out:word+out,(off+=2)>=26&&(off-=26,i--)}for(0!==carry&&(out=carry.toString(16)+out);out.length%padding!=0;)out="0"+out;return 0!==this.negative&&(out="-"+out),out}if(base===(0|base)&&base>=2&&base<=36){var groupSize=groupSizes[base],groupBase=groupBases[base];out="";var c=this.clone();for(c.negative=0;!c.isZero();){var r=c.modn(groupBase).toString(base);out=(c=c.idivn(groupBase)).isZero()?r+out:zeros[groupSize-r.length]+r+out}for(this.isZero()&&(out="0"+out);out.length%padding!=0;)out="0"+out;return 0!==this.negative&&(out="-"+out),out}assert(!1,"Base should be between 2 and 36")},BN.prototype.toNumber=function(){var ret=this.words[0];return 2===this.length?ret+=67108864*this.words[1]:3===this.length&&1===this.words[2]?ret+=4503599627370496+67108864*this.words[1]:this.length>2&&assert(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-ret:ret},BN.prototype.toJSON=function(){return this.toString(16)},BN.prototype.toBuffer=function(endian,length){return assert(void 0!==Buffer),this.toArrayLike(Buffer,endian,length)},BN.prototype.toArray=function(endian,length){return this.toArrayLike(Array,endian,length)},BN.prototype.toArrayLike=function(ArrayType,endian,length){var byteLength=this.byteLength(),reqLength=length||Math.max(1,byteLength);assert(byteLength<=reqLength,"byte array longer than desired length"),assert(reqLength>0,"Requested array length <= 0"),this.strip();var b,i,littleEndian="le"===endian,res=new ArrayType(reqLength),q=this.clone();if(littleEndian){for(i=0;!q.isZero();i++)b=q.andln(255),q.iushrn(8),res[i]=b;for(;i<reqLength;i++)res[i]=0}else{for(i=0;i<reqLength-byteLength;i++)res[i]=0;for(i=0;!q.isZero();i++)b=q.andln(255),q.iushrn(8),res[reqLength-i-1]=b}return res},Math.clz32?BN.prototype._countBits=function(w){return 32-Math.clz32(w)}:BN.prototype._countBits=function(w){var t=w,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},BN.prototype._zeroBits=function(w){if(0===w)return 26;var t=w,r=0;return 0==(8191&t)&&(r+=13,t>>>=13),0==(127&t)&&(r+=7,t>>>=7),0==(15&t)&&(r+=4,t>>>=4),0==(3&t)&&(r+=2,t>>>=2),0==(1&t)&&r++,r},BN.prototype.bitLength=function(){var w=this.words[this.length-1],hi=this._countBits(w);return 26*(this.length-1)+hi};BN.prototype.zeroBits=function(){if(this.isZero())return 0;for(var r=0,i=0;i<this.length;i++){var b=this._zeroBits(this.words[i]);if(r+=b,26!==b)break}return r},BN.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},BN.prototype.toTwos=function(width){return 0!==this.negative?this.abs().inotn(width).iaddn(1):this.clone()},BN.prototype.fromTwos=function(width){return this.testn(width-1)?this.notn(width).iaddn(1).ineg():this.clone()},BN.prototype.isNeg=function(){return 0!==this.negative},BN.prototype.neg=function(){return this.clone().ineg()},BN.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},BN.prototype.iuor=function(num){for(;this.length<num.length;)this.words[this.length++]=0;for(var i=0;i<num.length;i++)this.words[i]=this.words[i]|num.words[i];return this.strip()},BN.prototype.ior=function(num){return assert(0==(this.negative|num.negative)),this.iuor(num)},BN.prototype.or=function(num){return this.length>num.length?this.clone().ior(num):num.clone().ior(this)},BN.prototype.uor=function(num){return this.length>num.length?this.clone().iuor(num):num.clone().iuor(this)},BN.prototype.iuand=function(num){var b;b=this.length>num.length?num:this;for(var i=0;i<b.length;i++)this.words[i]=this.words[i]&num.words[i];return this.length=b.length,this.strip()},BN.prototype.iand=function(num){return assert(0==(this.negative|num.negative)),this.iuand(num)},BN.prototype.and=function(num){return this.length>num.length?this.clone().iand(num):num.clone().iand(this)},BN.prototype.uand=function(num){return this.length>num.length?this.clone().iuand(num):num.clone().iuand(this)},BN.prototype.iuxor=function(num){var a,b;this.length>num.length?(a=this,b=num):(a=num,b=this);for(var i=0;i<b.length;i++)this.words[i]=a.words[i]^b.words[i];if(this!==a)for(;i<a.length;i++)this.words[i]=a.words[i];return this.length=a.length,this.strip()},BN.prototype.ixor=function(num){return assert(0==(this.negative|num.negative)),this.iuxor(num)},BN.prototype.xor=function(num){return this.length>num.length?this.clone().ixor(num):num.clone().ixor(this)},BN.prototype.uxor=function(num){return this.length>num.length?this.clone().iuxor(num):num.clone().iuxor(this)},BN.prototype.inotn=function(width){assert("number"==typeof width&&width>=0);var bytesNeeded=0|Math.ceil(width/26),bitsLeft=width%26;this._expand(bytesNeeded),bitsLeft>0&&bytesNeeded--;for(var i=0;i<bytesNeeded;i++)this.words[i]=67108863&~this.words[i];return bitsLeft>0&&(this.words[i]=~this.words[i]&67108863>>26-bitsLeft),this.strip()},BN.prototype.notn=function(width){return this.clone().inotn(width)},BN.prototype.setn=function(bit,val){assert("number"==typeof bit&&bit>=0);var off=bit/26|0,wbit=bit%26;return this._expand(off+1),this.words[off]=val?this.words[off]|1<<wbit:this.words[off]&~(1<<wbit),this.strip()},BN.prototype.iadd=function(num){var r;if(0!==this.negative&&0===num.negative)return this.negative=0,r=this.isub(num),this.negative^=1,this._normSign();if(0===this.negative&&0!==num.negative)return num.negative=0,r=this.isub(num),num.negative=1,r._normSign();var a,b;this.length>num.length?(a=this,b=num):(a=num,b=this);for(var carry=0,i=0;i<b.length;i++)r=(0|a.words[i])+(0|b.words[i])+carry,this.words[i]=67108863&r,carry=r>>>26;for(;0!==carry&&i<a.length;i++)r=(0|a.words[i])+carry,this.words[i]=67108863&r,carry=r>>>26;if(this.length=a.length,0!==carry)this.words[this.length]=carry,this.length++;else if(a!==this)for(;i<a.length;i++)this.words[i]=a.words[i];return this},BN.prototype.add=function(num){var res;return 0!==num.negative&&0===this.negative?(num.negative=0,res=this.sub(num),num.negative^=1,res):0===num.negative&&0!==this.negative?(this.negative=0,res=num.sub(this),this.negative=1,res):this.length>num.length?this.clone().iadd(num):num.clone().iadd(this)},BN.prototype.isub=function(num){if(0!==num.negative){num.negative=0;var r=this.iadd(num);return num.negative=1,r._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(num),this.negative=1,this._normSign();var cmp=this.cmp(num);if(0===cmp)return this.negative=0,this.length=1,this.words[0]=0,this;var a,b;cmp>0?(a=this,b=num):(a=num,b=this);for(var carry=0,i=0;i<b.length;i++)carry=(r=(0|a.words[i])-(0|b.words[i])+carry)>>26,this.words[i]=67108863&r;for(;0!==carry&&i<a.length;i++)carry=(r=(0|a.words[i])+carry)>>26,this.words[i]=67108863&r;if(0===carry&&i<a.length&&a!==this)for(;i<a.length;i++)this.words[i]=a.words[i];return this.length=Math.max(this.length,i),a!==this&&(this.negative=1),this.strip()},BN.prototype.sub=function(num){return this.clone().isub(num)};function smallMulTo(self,num,out){out.negative=num.negative^self.negative;var len=self.length+num.length|0;out.length=len,len=len-1|0;var a=0|self.words[0],b=0|num.words[0],r=a*b,lo=67108863&r,carry=r/67108864|0;out.words[0]=lo;for(var k=1;k<len;k++){for(var ncarry=carry>>>26,rword=67108863&carry,maxJ=Math.min(k,num.length-1),j=Math.max(0,k-self.length+1);j<=maxJ;j++){var i=k-j|0;ncarry+=(r=(a=0|self.words[i])*(b=0|num.words[j])+rword)/67108864|0,rword=67108863&r}out.words[k]=0|rword,carry=0|ncarry}return 0!==carry?out.words[k]=0|carry:out.length--,out.strip()}var comb10MulTo=function(self,num,out){var lo,mid,hi,a=self.words,b=num.words,o=out.words,c=0,a0=0|a[0],al0=8191&a0,ah0=a0>>>13,a1=0|a[1],al1=8191&a1,ah1=a1>>>13,a2=0|a[2],al2=8191&a2,ah2=a2>>>13,a3=0|a[3],al3=8191&a3,ah3=a3>>>13,a4=0|a[4],al4=8191&a4,ah4=a4>>>13,a5=0|a[5],al5=8191&a5,ah5=a5>>>13,a6=0|a[6],al6=8191&a6,ah6=a6>>>13,a7=0|a[7],al7=8191&a7,ah7=a7>>>13,a8=0|a[8],al8=8191&a8,ah8=a8>>>13,a9=0|a[9],al9=8191&a9,ah9=a9>>>13,b0=0|b[0],bl0=8191&b0,bh0=b0>>>13,b1=0|b[1],bl1=8191&b1,bh1=b1>>>13,b2=0|b[2],bl2=8191&b2,bh2=b2>>>13,b3=0|b[3],bl3=8191&b3,bh3=b3>>>13,b4=0|b[4],bl4=8191&b4,bh4=b4>>>13,b5=0|b[5],bl5=8191&b5,bh5=b5>>>13,b6=0|b[6],bl6=8191&b6,bh6=b6>>>13,b7=0|b[7],bl7=8191&b7,bh7=b7>>>13,b8=0|b[8],bl8=8191&b8,bh8=b8>>>13,b9=0|b[9],bl9=8191&b9,bh9=b9>>>13;out.negative=self.negative^num.negative,out.length=19;var w0=(c+(lo=Math.imul(al0,bl0))|0)+((8191&(mid=(mid=Math.imul(al0,bh0))+Math.imul(ah0,bl0)|0))<<13)|0;c=((hi=Math.imul(ah0,bh0))+(mid>>>13)|0)+(w0>>>26)|0,w0&=67108863,lo=Math.imul(al1,bl0),mid=(mid=Math.imul(al1,bh0))+Math.imul(ah1,bl0)|0,hi=Math.imul(ah1,bh0);var w1=(c+(lo=lo+Math.imul(al0,bl1)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al0,bh1)|0)+Math.imul(ah0,bl1)|0))<<13)|0;c=((hi=hi+Math.imul(ah0,bh1)|0)+(mid>>>13)|0)+(w1>>>26)|0,w1&=67108863,lo=Math.imul(al2,bl0),mid=(mid=Math.imul(al2,bh0))+Math.imul(ah2,bl0)|0,hi=Math.imul(ah2,bh0),lo=lo+Math.imul(al1,bl1)|0,mid=(mid=mid+Math.imul(al1,bh1)|0)+Math.imul(ah1,bl1)|0,hi=hi+Math.imul(ah1,bh1)|0;var w2=(c+(lo=lo+Math.imul(al0,bl2)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al0,bh2)|0)+Math.imul(ah0,bl2)|0))<<13)|0;c=((hi=hi+Math.imul(ah0,bh2)|0)+(mid>>>13)|0)+(w2>>>26)|0,w2&=67108863,lo=Math.imul(al3,bl0),mid=(mid=Math.imul(al3,bh0))+Math.imul(ah3,bl0)|0,hi=Math.imul(ah3,bh0),lo=lo+Math.imul(al2,bl1)|0,mid=(mid=mid+Math.imul(al2,bh1)|0)+Math.imul(ah2,bl1)|0,hi=hi+Math.imul(ah2,bh1)|0,lo=lo+Math.imul(al1,bl2)|0,mid=(mid=mid+Math.imul(al1,bh2)|0)+Math.imul(ah1,bl2)|0,hi=hi+Math.imul(ah1,bh2)|0;var w3=(c+(lo=lo+Math.imul(al0,bl3)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al0,bh3)|0)+Math.imul(ah0,bl3)|0))<<13)|0;c=((hi=hi+Math.imul(ah0,bh3)|0)+(mid>>>13)|0)+(w3>>>26)|0,w3&=67108863,lo=Math.imul(al4,bl0),mid=(mid=Math.imul(al4,bh0))+Math.imul(ah4,bl0)|0,hi=Math.imul(ah4,bh0),lo=lo+Math.imul(al3,bl1)|0,mid=(mid=mid+Math.imul(al3,bh1)|0)+Math.imul(ah3,bl1)|0,hi=hi+Math.imul(ah3,bh1)|0,lo=lo+Math.imul(al2,bl2)|0,mid=(mid=mid+Math.imul(al2,bh2)|0)+Math.imul(ah2,bl2)|0,hi=hi+Math.imul(ah2,bh2)|0,lo=lo+Math.imul(al1,bl3)|0,mid=(mid=mid+Math.imul(al1,bh3)|0)+Math.imul(ah1,bl3)|0,hi=hi+Math.imul(ah1,bh3)|0;var w4=(c+(lo=lo+Math.imul(al0,bl4)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al0,bh4)|0)+Math.imul(ah0,bl4)|0))<<13)|0;c=((hi=hi+Math.imul(ah0,bh4)|0)+(mid>>>13)|0)+(w4>>>26)|0,w4&=67108863,lo=Math.imul(al5,bl0),mid=(mid=Math.imul(al5,bh0))+Math.imul(ah5,bl0)|0,hi=Math.imul(ah5,bh0),lo=lo+Math.imul(al4,bl1)|0,mid=(mid=mid+Math.imul(al4,bh1)|0)+Math.imul(ah4,bl1)|0,hi=hi+Math.imul(ah4,bh1)|0,lo=lo+Math.imul(al3,bl2)|0,mid=(mid=mid+Math.imul(al3,bh2)|0)+Math.imul(ah3,bl2)|0,hi=hi+Math.imul(ah3,bh2)|0,lo=lo+Math.imul(al2,bl3)|0,mid=(mid=mid+Math.imul(al2,bh3)|0)+Math.imul(ah2,bl3)|0,hi=hi+Math.imul(ah2,bh3)|0,lo=lo+Math.imul(al1,bl4)|0,mid=(mid=mid+Math.imul(al1,bh4)|0)+Math.imul(ah1,bl4)|0,hi=hi+Math.imul(ah1,bh4)|0;var w5=(c+(lo=lo+Math.imul(al0,bl5)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al0,bh5)|0)+Math.imul(ah0,bl5)|0))<<13)|0;c=((hi=hi+Math.imul(ah0,bh5)|0)+(mid>>>13)|0)+(w5>>>26)|0,w5&=67108863,lo=Math.imul(al6,bl0),mid=(mid=Math.imul(al6,bh0))+Math.imul(ah6,bl0)|0,hi=Math.imul(ah6,bh0),lo=lo+Math.imul(al5,bl1)|0,mid=(mid=mid+Math.imul(al5,bh1)|0)+Math.imul(ah5,bl1)|0,hi=hi+Math.imul(ah5,bh1)|0,lo=lo+Math.imul(al4,bl2)|0,mid=(mid=mid+Math.imul(al4,bh2)|0)+Math.imul(ah4,bl2)|0,hi=hi+Math.imul(ah4,bh2)|0,lo=lo+Math.imul(al3,bl3)|0,mid=(mid=mid+Math.imul(al3,bh3)|0)+Math.imul(ah3,bl3)|0,hi=hi+Math.imul(ah3,bh3)|0,lo=lo+Math.imul(al2,bl4)|0,mid=(mid=mid+Math.imul(al2,bh4)|0)+Math.imul(ah2,bl4)|0,hi=hi+Math.imul(ah2,bh4)|0,lo=lo+Math.imul(al1,bl5)|0,mid=(mid=mid+Math.imul(al1,bh5)|0)+Math.imul(ah1,bl5)|0,hi=hi+Math.imul(ah1,bh5)|0;var w6=(c+(lo=lo+Math.imul(al0,bl6)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al0,bh6)|0)+Math.imul(ah0,bl6)|0))<<13)|0;c=((hi=hi+Math.imul(ah0,bh6)|0)+(mid>>>13)|0)+(w6>>>26)|0,w6&=67108863,lo=Math.imul(al7,bl0),mid=(mid=Math.imul(al7,bh0))+Math.imul(ah7,bl0)|0,hi=Math.imul(ah7,bh0),lo=lo+Math.imul(al6,bl1)|0,mid=(mid=mid+Math.imul(al6,bh1)|0)+Math.imul(ah6,bl1)|0,hi=hi+Math.imul(ah6,bh1)|0,lo=lo+Math.imul(al5,bl2)|0,mid=(mid=mid+Math.imul(al5,bh2)|0)+Math.imul(ah5,bl2)|0,hi=hi+Math.imul(ah5,bh2)|0,lo=lo+Math.imul(al4,bl3)|0,mid=(mid=mid+Math.imul(al4,bh3)|0)+Math.imul(ah4,bl3)|0,hi=hi+Math.imul(ah4,bh3)|0,lo=lo+Math.imul(al3,bl4)|0,mid=(mid=mid+Math.imul(al3,bh4)|0)+Math.imul(ah3,bl4)|0,hi=hi+Math.imul(ah3,bh4)|0,lo=lo+Math.imul(al2,bl5)|0,mid=(mid=mid+Math.imul(al2,bh5)|0)+Math.imul(ah2,bl5)|0,hi=hi+Math.imul(ah2,bh5)|0,lo=lo+Math.imul(al1,bl6)|0,mid=(mid=mid+Math.imul(al1,bh6)|0)+Math.imul(ah1,bl6)|0,hi=hi+Math.imul(ah1,bh6)|0;var w7=(c+(lo=lo+Math.imul(al0,bl7)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al0,bh7)|0)+Math.imul(ah0,bl7)|0))<<13)|0;c=((hi=hi+Math.imul(ah0,bh7)|0)+(mid>>>13)|0)+(w7>>>26)|0,w7&=67108863,lo=Math.imul(al8,bl0),mid=(mid=Math.imul(al8,bh0))+Math.imul(ah8,bl0)|0,hi=Math.imul(ah8,bh0),lo=lo+Math.imul(al7,bl1)|0,mid=(mid=mid+Math.imul(al7,bh1)|0)+Math.imul(ah7,bl1)|0,hi=hi+Math.imul(ah7,bh1)|0,lo=lo+Math.imul(al6,bl2)|0,mid=(mid=mid+Math.imul(al6,bh2)|0)+Math.imul(ah6,bl2)|0,hi=hi+Math.imul(ah6,bh2)|0,lo=lo+Math.imul(al5,bl3)|0,mid=(mid=mid+Math.imul(al5,bh3)|0)+Math.imul(ah5,bl3)|0,hi=hi+Math.imul(ah5,bh3)|0,lo=lo+Math.imul(al4,bl4)|0,mid=(mid=mid+Math.imul(al4,bh4)|0)+Math.imul(ah4,bl4)|0,hi=hi+Math.imul(ah4,bh4)|0,lo=lo+Math.imul(al3,bl5)|0,mid=(mid=mid+Math.imul(al3,bh5)|0)+Math.imul(ah3,bl5)|0,hi=hi+Math.imul(ah3,bh5)|0,lo=lo+Math.imul(al2,bl6)|0,mid=(mid=mid+Math.imul(al2,bh6)|0)+Math.imul(ah2,bl6)|0,hi=hi+Math.imul(ah2,bh6)|0,lo=lo+Math.imul(al1,bl7)|0,mid=(mid=mid+Math.imul(al1,bh7)|0)+Math.imul(ah1,bl7)|0,hi=hi+Math.imul(ah1,bh7)|0;var w8=(c+(lo=lo+Math.imul(al0,bl8)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al0,bh8)|0)+Math.imul(ah0,bl8)|0))<<13)|0;c=((hi=hi+Math.imul(ah0,bh8)|0)+(mid>>>13)|0)+(w8>>>26)|0,w8&=67108863,lo=Math.imul(al9,bl0),mid=(mid=Math.imul(al9,bh0))+Math.imul(ah9,bl0)|0,hi=Math.imul(ah9,bh0),lo=lo+Math.imul(al8,bl1)|0,mid=(mid=mid+Math.imul(al8,bh1)|0)+Math.imul(ah8,bl1)|0,hi=hi+Math.imul(ah8,bh1)|0,lo=lo+Math.imul(al7,bl2)|0,mid=(mid=mid+Math.imul(al7,bh2)|0)+Math.imul(ah7,bl2)|0,hi=hi+Math.imul(ah7,bh2)|0,lo=lo+Math.imul(al6,bl3)|0,mid=(mid=mid+Math.imul(al6,bh3)|0)+Math.imul(ah6,bl3)|0,hi=hi+Math.imul(ah6,bh3)|0,lo=lo+Math.imul(al5,bl4)|0,mid=(mid=mid+Math.imul(al5,bh4)|0)+Math.imul(ah5,bl4)|0,hi=hi+Math.imul(ah5,bh4)|0,lo=lo+Math.imul(al4,bl5)|0,mid=(mid=mid+Math.imul(al4,bh5)|0)+Math.imul(ah4,bl5)|0,hi=hi+Math.imul(ah4,bh5)|0,lo=lo+Math.imul(al3,bl6)|0,mid=(mid=mid+Math.imul(al3,bh6)|0)+Math.imul(ah3,bl6)|0,hi=hi+Math.imul(ah3,bh6)|0,lo=lo+Math.imul(al2,bl7)|0,mid=(mid=mid+Math.imul(al2,bh7)|0)+Math.imul(ah2,bl7)|0,hi=hi+Math.imul(ah2,bh7)|0,lo=lo+Math.imul(al1,bl8)|0,mid=(mid=mid+Math.imul(al1,bh8)|0)+Math.imul(ah1,bl8)|0,hi=hi+Math.imul(ah1,bh8)|0;var w9=(c+(lo=lo+Math.imul(al0,bl9)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al0,bh9)|0)+Math.imul(ah0,bl9)|0))<<13)|0;c=((hi=hi+Math.imul(ah0,bh9)|0)+(mid>>>13)|0)+(w9>>>26)|0,w9&=67108863,lo=Math.imul(al9,bl1),mid=(mid=Math.imul(al9,bh1))+Math.imul(ah9,bl1)|0,hi=Math.imul(ah9,bh1),lo=lo+Math.imul(al8,bl2)|0,mid=(mid=mid+Math.imul(al8,bh2)|0)+Math.imul(ah8,bl2)|0,hi=hi+Math.imul(ah8,bh2)|0,lo=lo+Math.imul(al7,bl3)|0,mid=(mid=mid+Math.imul(al7,bh3)|0)+Math.imul(ah7,bl3)|0,hi=hi+Math.imul(ah7,bh3)|0,lo=lo+Math.imul(al6,bl4)|0,mid=(mid=mid+Math.imul(al6,bh4)|0)+Math.imul(ah6,bl4)|0,hi=hi+Math.imul(ah6,bh4)|0,lo=lo+Math.imul(al5,bl5)|0,mid=(mid=mid+Math.imul(al5,bh5)|0)+Math.imul(ah5,bl5)|0,hi=hi+Math.imul(ah5,bh5)|0,lo=lo+Math.imul(al4,bl6)|0,mid=(mid=mid+Math.imul(al4,bh6)|0)+Math.imul(ah4,bl6)|0,hi=hi+Math.imul(ah4,bh6)|0,lo=lo+Math.imul(al3,bl7)|0,mid=(mid=mid+Math.imul(al3,bh7)|0)+Math.imul(ah3,bl7)|0,hi=hi+Math.imul(ah3,bh7)|0,lo=lo+Math.imul(al2,bl8)|0,mid=(mid=mid+Math.imul(al2,bh8)|0)+Math.imul(ah2,bl8)|0,hi=hi+Math.imul(ah2,bh8)|0;var w10=(c+(lo=lo+Math.imul(al1,bl9)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al1,bh9)|0)+Math.imul(ah1,bl9)|0))<<13)|0;c=((hi=hi+Math.imul(ah1,bh9)|0)+(mid>>>13)|0)+(w10>>>26)|0,w10&=67108863,lo=Math.imul(al9,bl2),mid=(mid=Math.imul(al9,bh2))+Math.imul(ah9,bl2)|0,hi=Math.imul(ah9,bh2),lo=lo+Math.imul(al8,bl3)|0,mid=(mid=mid+Math.imul(al8,bh3)|0)+Math.imul(ah8,bl3)|0,hi=hi+Math.imul(ah8,bh3)|0,lo=lo+Math.imul(al7,bl4)|0,mid=(mid=mid+Math.imul(al7,bh4)|0)+Math.imul(ah7,bl4)|0,hi=hi+Math.imul(ah7,bh4)|0,lo=lo+Math.imul(al6,bl5)|0,mid=(mid=mid+Math.imul(al6,bh5)|0)+Math.imul(ah6,bl5)|0,hi=hi+Math.imul(ah6,bh5)|0,lo=lo+Math.imul(al5,bl6)|0,mid=(mid=mid+Math.imul(al5,bh6)|0)+Math.imul(ah5,bl6)|0,hi=hi+Math.imul(ah5,bh6)|0,lo=lo+Math.imul(al4,bl7)|0,mid=(mid=mid+Math.imul(al4,bh7)|0)+Math.imul(ah4,bl7)|0,hi=hi+Math.imul(ah4,bh7)|0,lo=lo+Math.imul(al3,bl8)|0,mid=(mid=mid+Math.imul(al3,bh8)|0)+Math.imul(ah3,bl8)|0,hi=hi+Math.imul(ah3,bh8)|0;var w11=(c+(lo=lo+Math.imul(al2,bl9)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al2,bh9)|0)+Math.imul(ah2,bl9)|0))<<13)|0;c=((hi=hi+Math.imul(ah2,bh9)|0)+(mid>>>13)|0)+(w11>>>26)|0,w11&=67108863,lo=Math.imul(al9,bl3),mid=(mid=Math.imul(al9,bh3))+Math.imul(ah9,bl3)|0,hi=Math.imul(ah9,bh3),lo=lo+Math.imul(al8,bl4)|0,mid=(mid=mid+Math.imul(al8,bh4)|0)+Math.imul(ah8,bl4)|0,hi=hi+Math.imul(ah8,bh4)|0,lo=lo+Math.imul(al7,bl5)|0,mid=(mid=mid+Math.imul(al7,bh5)|0)+Math.imul(ah7,bl5)|0,hi=hi+Math.imul(ah7,bh5)|0,lo=lo+Math.imul(al6,bl6)|0,mid=(mid=mid+Math.imul(al6,bh6)|0)+Math.imul(ah6,bl6)|0,hi=hi+Math.imul(ah6,bh6)|0,lo=lo+Math.imul(al5,bl7)|0,mid=(mid=mid+Math.imul(al5,bh7)|0)+Math.imul(ah5,bl7)|0,hi=hi+Math.imul(ah5,bh7)|0,lo=lo+Math.imul(al4,bl8)|0,mid=(mid=mid+Math.imul(al4,bh8)|0)+Math.imul(ah4,bl8)|0,hi=hi+Math.imul(ah4,bh8)|0;var w12=(c+(lo=lo+Math.imul(al3,bl9)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al3,bh9)|0)+Math.imul(ah3,bl9)|0))<<13)|0;c=((hi=hi+Math.imul(ah3,bh9)|0)+(mid>>>13)|0)+(w12>>>26)|0,w12&=67108863,lo=Math.imul(al9,bl4),mid=(mid=Math.imul(al9,bh4))+Math.imul(ah9,bl4)|0,hi=Math.imul(ah9,bh4),lo=lo+Math.imul(al8,bl5)|0,mid=(mid=mid+Math.imul(al8,bh5)|0)+Math.imul(ah8,bl5)|0,hi=hi+Math.imul(ah8,bh5)|0,lo=lo+Math.imul(al7,bl6)|0,mid=(mid=mid+Math.imul(al7,bh6)|0)+Math.imul(ah7,bl6)|0,hi=hi+Math.imul(ah7,bh6)|0,lo=lo+Math.imul(al6,bl7)|0,mid=(mid=mid+Math.imul(al6,bh7)|0)+Math.imul(ah6,bl7)|0,hi=hi+Math.imul(ah6,bh7)|0,lo=lo+Math.imul(al5,bl8)|0,mid=(mid=mid+Math.imul(al5,bh8)|0)+Math.imul(ah5,bl8)|0,hi=hi+Math.imul(ah5,bh8)|0;var w13=(c+(lo=lo+Math.imul(al4,bl9)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al4,bh9)|0)+Math.imul(ah4,bl9)|0))<<13)|0;c=((hi=hi+Math.imul(ah4,bh9)|0)+(mid>>>13)|0)+(w13>>>26)|0,w13&=67108863,lo=Math.imul(al9,bl5),mid=(mid=Math.imul(al9,bh5))+Math.imul(ah9,bl5)|0,hi=Math.imul(ah9,bh5),lo=lo+Math.imul(al8,bl6)|0,mid=(mid=mid+Math.imul(al8,bh6)|0)+Math.imul(ah8,bl6)|0,hi=hi+Math.imul(ah8,bh6)|0,lo=lo+Math.imul(al7,bl7)|0,mid=(mid=mid+Math.imul(al7,bh7)|0)+Math.imul(ah7,bl7)|0,hi=hi+Math.imul(ah7,bh7)|0,lo=lo+Math.imul(al6,bl8)|0,mid=(mid=mid+Math.imul(al6,bh8)|0)+Math.imul(ah6,bl8)|0,hi=hi+Math.imul(ah6,bh8)|0;var w14=(c+(lo=lo+Math.imul(al5,bl9)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al5,bh9)|0)+Math.imul(ah5,bl9)|0))<<13)|0;c=((hi=hi+Math.imul(ah5,bh9)|0)+(mid>>>13)|0)+(w14>>>26)|0,w14&=67108863,lo=Math.imul(al9,bl6),mid=(mid=Math.imul(al9,bh6))+Math.imul(ah9,bl6)|0,hi=Math.imul(ah9,bh6),lo=lo+Math.imul(al8,bl7)|0,mid=(mid=mid+Math.imul(al8,bh7)|0)+Math.imul(ah8,bl7)|0,hi=hi+Math.imul(ah8,bh7)|0,lo=lo+Math.imul(al7,bl8)|0,mid=(mid=mid+Math.imul(al7,bh8)|0)+Math.imul(ah7,bl8)|0,hi=hi+Math.imul(ah7,bh8)|0;var w15=(c+(lo=lo+Math.imul(al6,bl9)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al6,bh9)|0)+Math.imul(ah6,bl9)|0))<<13)|0;c=((hi=hi+Math.imul(ah6,bh9)|0)+(mid>>>13)|0)+(w15>>>26)|0,w15&=67108863,lo=Math.imul(al9,bl7),mid=(mid=Math.imul(al9,bh7))+Math.imul(ah9,bl7)|0,hi=Math.imul(ah9,bh7),lo=lo+Math.imul(al8,bl8)|0,mid=(mid=mid+Math.imul(al8,bh8)|0)+Math.imul(ah8,bl8)|0,hi=hi+Math.imul(ah8,bh8)|0;var w16=(c+(lo=lo+Math.imul(al7,bl9)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al7,bh9)|0)+Math.imul(ah7,bl9)|0))<<13)|0;c=((hi=hi+Math.imul(ah7,bh9)|0)+(mid>>>13)|0)+(w16>>>26)|0,w16&=67108863,lo=Math.imul(al9,bl8),mid=(mid=Math.imul(al9,bh8))+Math.imul(ah9,bl8)|0,hi=Math.imul(ah9,bh8);var w17=(c+(lo=lo+Math.imul(al8,bl9)|0)|0)+((8191&(mid=(mid=mid+Math.imul(al8,bh9)|0)+Math.imul(ah8,bl9)|0))<<13)|0;c=((hi=hi+Math.imul(ah8,bh9)|0)+(mid>>>13)|0)+(w17>>>26)|0,w17&=67108863;var w18=(c+(lo=Math.imul(al9,bl9))|0)+((8191&(mid=(mid=Math.imul(al9,bh9))+Math.imul(ah9,bl9)|0))<<13)|0;return c=((hi=Math.imul(ah9,bh9))+(mid>>>13)|0)+(w18>>>26)|0,w18&=67108863,o[0]=w0,o[1]=w1,o[2]=w2,o[3]=w3,o[4]=w4,o[5]=w5,o[6]=w6,o[7]=w7,o[8]=w8,o[9]=w9,o[10]=w10,o[11]=w11,o[12]=w12,o[13]=w13,o[14]=w14,o[15]=w15,o[16]=w16,o[17]=w17,o[18]=w18,0!==c&&(o[19]=c,out.length++),out};Math.imul||(comb10MulTo=smallMulTo);function jumboMulTo(self,num,out){return(new FFTM).mulp(self,num,out)}BN.prototype.mulTo=function(num,out){var len=this.length+num.length;return 10===this.length&&10===num.length?comb10MulTo(this,num,out):len<63?smallMulTo(this,num,out):len<1024?function(self,num,out){out.negative=num.negative^self.negative,out.length=self.length+num.length;for(var carry=0,hncarry=0,k=0;k<out.length-1;k++){var ncarry=hncarry;hncarry=0;for(var rword=67108863&carry,maxJ=Math.min(k,num.length-1),j=Math.max(0,k-self.length+1);j<=maxJ;j++){var i=k-j,r=(0|self.words[i])*(0|num.words[j]),lo=67108863&r;rword=67108863&(lo=lo+rword|0),hncarry+=(ncarry=(ncarry=ncarry+(r/67108864|0)|0)+(lo>>>26)|0)>>>26,ncarry&=67108863}out.words[k]=rword,carry=ncarry,ncarry=hncarry}return 0!==carry?out.words[k]=carry:out.length--,out.strip()}(this,num,out):jumboMulTo(this,num,out)};function FFTM(x,y){this.x=x,this.y=y}FFTM.prototype.makeRBT=function(N){for(var t=new Array(N),l=BN.prototype._countBits(N)-1,i=0;i<N;i++)t[i]=this.revBin(i,l,N);return t},FFTM.prototype.revBin=function(x,l,N){if(0===x||x===N-1)return x;for(var rb=0,i=0;i<l;i++)rb|=(1&x)<<l-i-1,x>>=1;return rb},FFTM.prototype.permute=function(rbt,rws,iws,rtws,itws,N){for(var i=0;i<N;i++)rtws[i]=rws[rbt[i]],itws[i]=iws[rbt[i]]},FFTM.prototype.transform=function(rws,iws,rtws,itws,N,rbt){this.permute(rbt,rws,iws,rtws,itws,N);for(var s=1;s<N;s<<=1)for(var l=s<<1,rtwdf=Math.cos(2*Math.PI/l),itwdf=Math.sin(2*Math.PI/l),p=0;p<N;p+=l)for(var rtwdf_=rtwdf,itwdf_=itwdf,j=0;j<s;j++){var re=rtws[p+j],ie=itws[p+j],ro=rtws[p+j+s],io=itws[p+j+s],rx=rtwdf_*ro-itwdf_*io;io=rtwdf_*io+itwdf_*ro,ro=rx,rtws[p+j]=re+ro,itws[p+j]=ie+io,rtws[p+j+s]=re-ro,itws[p+j+s]=ie-io,j!==l&&(rx=rtwdf*rtwdf_-itwdf*itwdf_,itwdf_=rtwdf*itwdf_+itwdf*rtwdf_,rtwdf_=rx)}},FFTM.prototype.guessLen13b=function(n,m){var N=1|Math.max(m,n),odd=1&N,i=0;for(N=N/2|0;N;N>>>=1)i++;return 1<<i+1+odd},FFTM.prototype.conjugate=function(rws,iws,N){if(!(N<=1))for(var i=0;i<N/2;i++){var t=rws[i];rws[i]=rws[N-i-1],rws[N-i-1]=t,t=iws[i],iws[i]=-iws[N-i-1],iws[N-i-1]=-t}},FFTM.prototype.normalize13b=function(ws,N){for(var carry=0,i=0;i<N/2;i++){var w=8192*Math.round(ws[2*i+1]/N)+Math.round(ws[2*i]/N)+carry;ws[i]=67108863&w,carry=w<67108864?0:w/67108864|0}return ws},FFTM.prototype.convert13b=function(ws,len,rws,N){for(var carry=0,i=0;i<len;i++)carry+=0|ws[i],rws[2*i]=8191&carry,carry>>>=13,rws[2*i+1]=8191&carry,carry>>>=13;for(i=2*len;i<N;++i)rws[i]=0;assert(0===carry),assert(0==(-8192&carry))},FFTM.prototype.stub=function(N){for(var ph=new Array(N),i=0;i<N;i++)ph[i]=0;return ph},FFTM.prototype.mulp=function(x,y,out){var N=2*this.guessLen13b(x.length,y.length),rbt=this.makeRBT(N),_=this.stub(N),rws=new Array(N),rwst=new Array(N),iwst=new Array(N),nrws=new Array(N),nrwst=new Array(N),niwst=new Array(N),rmws=out.words;rmws.length=N,this.convert13b(x.words,x.length,rws,N),this.convert13b(y.words,y.length,nrws,N),this.transform(rws,_,rwst,iwst,N,rbt),this.transform(nrws,_,nrwst,niwst,N,rbt);for(var i=0;i<N;i++){var rx=rwst[i]*nrwst[i]-iwst[i]*niwst[i];iwst[i]=rwst[i]*niwst[i]+iwst[i]*nrwst[i],rwst[i]=rx}return this.conjugate(rwst,iwst,N),this.transform(rwst,iwst,rmws,_,N,rbt),this.conjugate(rmws,_,N),this.normalize13b(rmws,N),out.negative=x.negative^y.negative,out.length=x.length+y.length,out.strip()},BN.prototype.mul=function(num){var out=new BN(null);return out.words=new Array(this.length+num.length),this.mulTo(num,out)},BN.prototype.mulf=function(num){var out=new BN(null);return out.words=new Array(this.length+num.length),jumboMulTo(this,num,out)},BN.prototype.imul=function(num){return this.clone().mulTo(num,this)},BN.prototype.imuln=function(num){assert("number"==typeof num),assert(num<67108864);for(var carry=0,i=0;i<this.length;i++){var w=(0|this.words[i])*num,lo=(67108863&w)+(67108863&carry);carry>>=26,carry+=w/67108864|0,carry+=lo>>>26,this.words[i]=67108863&lo}return 0!==carry&&(this.words[i]=carry,this.length++),this},BN.prototype.muln=function(num){return this.clone().imuln(num)},BN.prototype.sqr=function(){return this.mul(this)},BN.prototype.isqr=function(){return this.imul(this.clone())},BN.prototype.pow=function(num){var w=function(num){for(var w=new Array(num.bitLength()),bit=0;bit<w.length;bit++){var off=bit/26|0,wbit=bit%26;w[bit]=(num.words[off]&1<<wbit)>>>wbit}return w}(num);if(0===w.length)return new BN(1);for(var res=this,i=0;i<w.length&&0===w[i];i++,res=res.sqr());if(++i<w.length)for(var q=res.sqr();i<w.length;i++,q=q.sqr())0!==w[i]&&(res=res.mul(q));return res},BN.prototype.iushln=function(bits){assert("number"==typeof bits&&bits>=0);var i,r=bits%26,s=(bits-r)/26,carryMask=67108863>>>26-r<<26-r;if(0!==r){var carry=0;for(i=0;i<this.length;i++){var newCarry=this.words[i]&carryMask,c=(0|this.words[i])-newCarry<<r;this.words[i]=c|carry,carry=newCarry>>>26-r}carry&&(this.words[i]=carry,this.length++)}if(0!==s){for(i=this.length-1;i>=0;i--)this.words[i+s]=this.words[i];for(i=0;i<s;i++)this.words[i]=0;this.length+=s}return this.strip()},BN.prototype.ishln=function(bits){return assert(0===this.negative),this.iushln(bits)},BN.prototype.iushrn=function(bits,hint,extended){assert("number"==typeof bits&&bits>=0);var h;h=hint?(hint-hint%26)/26:0;var r=bits%26,s=Math.min((bits-r)/26,this.length),mask=67108863^67108863>>>r<<r,maskedWords=extended;if(h-=s,h=Math.max(0,h),maskedWords){for(var i=0;i<s;i++)maskedWords.words[i]=this.words[i];maskedWords.length=s}if(0===s);else if(this.length>s)for(this.length-=s,i=0;i<this.length;i++)this.words[i]=this.words[i+s];else this.words[0]=0,this.length=1;var carry=0;for(i=this.length-1;i>=0&&(0!==carry||i>=h);i--){var word=0|this.words[i];this.words[i]=carry<<26-r|word>>>r,carry=word&mask}return maskedWords&&0!==carry&&(maskedWords.words[maskedWords.length++]=carry),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},BN.prototype.ishrn=function(bits,hint,extended){return assert(0===this.negative),this.iushrn(bits,hint,extended)},BN.prototype.shln=function(bits){return this.clone().ishln(bits)},BN.prototype.ushln=function(bits){return this.clone().iushln(bits)},BN.prototype.shrn=function(bits){return this.clone().ishrn(bits)},BN.prototype.ushrn=function(bits){return this.clone().iushrn(bits)},BN.prototype.testn=function(bit){assert("number"==typeof bit&&bit>=0);var r=bit%26,s=(bit-r)/26,q=1<<r;if(this.length<=s)return!1;return!!(this.words[s]&q)},BN.prototype.imaskn=function(bits){assert("number"==typeof bits&&bits>=0);var r=bits%26,s=(bits-r)/26;if(assert(0===this.negative,"imaskn works only with positive numbers"),this.length<=s)return this;if(0!==r&&s++,this.length=Math.min(s,this.length),0!==r){var mask=67108863^67108863>>>r<<r;this.words[this.length-1]&=mask}return this.strip()},BN.prototype.maskn=function(bits){return this.clone().imaskn(bits)},BN.prototype.iaddn=function(num){return assert("number"==typeof num),assert(num<67108864),num<0?this.isubn(-num):0!==this.negative?1===this.length&&(0|this.words[0])<num?(this.words[0]=num-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(num),this.negative=1,this):this._iaddn(num)},BN.prototype._iaddn=function(num){this.words[0]+=num;for(var i=0;i<this.length&&this.words[i]>=67108864;i++)this.words[i]-=67108864,i===this.length-1?this.words[i+1]=1:this.words[i+1]++;return this.length=Math.max(this.length,i+1),this},BN.prototype.isubn=function(num){if(assert("number"==typeof num),assert(num<67108864),num<0)return this.iaddn(-num);if(0!==this.negative)return this.negative=0,this.iaddn(num),this.negative=1,this;if(this.words[0]-=num,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var i=0;i<this.length&&this.words[i]<0;i++)this.words[i]+=67108864,this.words[i+1]-=1;return this.strip()},BN.prototype.addn=function(num){return this.clone().iaddn(num)},BN.prototype.subn=function(num){return this.clone().isubn(num)},BN.prototype.iabs=function(){return this.negative=0,this},BN.prototype.abs=function(){return this.clone().iabs()},BN.prototype._ishlnsubmul=function(num,mul,shift){var i,len=num.length+shift;this._expand(len);var w,carry=0;for(i=0;i<num.length;i++){w=(0|this.words[i+shift])+carry;var right=(0|num.words[i])*mul;carry=((w-=67108863&right)>>26)-(right/67108864|0),this.words[i+shift]=67108863&w}for(;i<this.length-shift;i++)carry=(w=(0|this.words[i+shift])+carry)>>26,this.words[i+shift]=67108863&w;if(0===carry)return this.strip();for(assert(-1===carry),carry=0,i=0;i<this.length;i++)carry=(w=-(0|this.words[i])+carry)>>26,this.words[i]=67108863&w;return this.negative=1,this.strip()},BN.prototype._wordDiv=function(num,mode){var shift=this.length-num.length,a=this.clone(),b=num,bhi=0|b.words[b.length-1];0!==(shift=26-this._countBits(bhi))&&(b=b.ushln(shift),a.iushln(shift),bhi=0|b.words[b.length-1]);var q,m=a.length-b.length;if("mod"!==mode){(q=new BN(null)).length=m+1,q.words=new Array(q.length);for(var i=0;i<q.length;i++)q.words[i]=0}var diff=a.clone()._ishlnsubmul(b,1,m);0===diff.negative&&(a=diff,q&&(q.words[m]=1));for(var j=m-1;j>=0;j--){var qj=67108864*(0|a.words[b.length+j])+(0|a.words[b.length+j-1]);for(qj=Math.min(qj/bhi|0,67108863),a._ishlnsubmul(b,qj,j);0!==a.negative;)qj--,a.negative=0,a._ishlnsubmul(b,1,j),a.isZero()||(a.negative^=1);q&&(q.words[j]=qj)}return q&&q.strip(),a.strip(),"div"!==mode&&0!==shift&&a.iushrn(shift),{div:q||null,mod:a}},BN.prototype.divmod=function(num,mode,positive){if(assert(!num.isZero()),this.isZero())return{div:new BN(0),mod:new BN(0)};var div,mod,res;return 0!==this.negative&&0===num.negative?(res=this.neg().divmod(num,mode),"mod"!==mode&&(div=res.div.neg()),"div"!==mode&&(mod=res.mod.neg(),positive&&0!==mod.negative&&mod.iadd(num)),{div:div,mod:mod}):0===this.negative&&0!==num.negative?(res=this.divmod(num.neg(),mode),"mod"!==mode&&(div=res.div.neg()),{div:div,mod:res.mod}):0!=(this.negative&num.negative)?(res=this.neg().divmod(num.neg(),mode),"div"!==mode&&(mod=res.mod.neg(),positive&&0!==mod.negative&&mod.isub(num)),{div:res.div,mod:mod}):num.length>this.length||this.cmp(num)<0?{div:new BN(0),mod:this}:1===num.length?"div"===mode?{div:this.divn(num.words[0]),mod:null}:"mod"===mode?{div:null,mod:new BN(this.modn(num.words[0]))}:{div:this.divn(num.words[0]),mod:new BN(this.modn(num.words[0]))}:this._wordDiv(num,mode)},BN.prototype.div=function(num){return this.divmod(num,"div",!1).div},BN.prototype.mod=function(num){return this.divmod(num,"mod",!1).mod},BN.prototype.umod=function(num){return this.divmod(num,"mod",!0).mod},BN.prototype.divRound=function(num){var dm=this.divmod(num);if(dm.mod.isZero())return dm.div;var mod=0!==dm.div.negative?dm.mod.isub(num):dm.mod,half=num.ushrn(1),r2=num.andln(1),cmp=mod.cmp(half);return cmp<0||1===r2&&0===cmp?dm.div:0!==dm.div.negative?dm.div.isubn(1):dm.div.iaddn(1)},BN.prototype.modn=function(num){assert(num<=67108863);for(var p=(1<<26)%num,acc=0,i=this.length-1;i>=0;i--)acc=(p*acc+(0|this.words[i]))%num;return acc},BN.prototype.idivn=function(num){assert(num<=67108863);for(var carry=0,i=this.length-1;i>=0;i--){var w=(0|this.words[i])+67108864*carry;this.words[i]=w/num|0,carry=w%num}return this.strip()},BN.prototype.divn=function(num){return this.clone().idivn(num)},BN.prototype.egcd=function(p){assert(0===p.negative),assert(!p.isZero());var x=this,y=p.clone();x=0!==x.negative?x.umod(p):x.clone();for(var A=new BN(1),B=new BN(0),C=new BN(0),D=new BN(1),g=0;x.isEven()&&y.isEven();)x.iushrn(1),y.iushrn(1),++g;for(var yp=y.clone(),xp=x.clone();!x.isZero();){for(var i=0,im=1;0==(x.words[0]&im)&&i<26;++i,im<<=1);if(i>0)for(x.iushrn(i);i-- >0;)(A.isOdd()||B.isOdd())&&(A.iadd(yp),B.isub(xp)),A.iushrn(1),B.iushrn(1);for(var j=0,jm=1;0==(y.words[0]&jm)&&j<26;++j,jm<<=1);if(j>0)for(y.iushrn(j);j-- >0;)(C.isOdd()||D.isOdd())&&(C.iadd(yp),D.isub(xp)),C.iushrn(1),D.iushrn(1);x.cmp(y)>=0?(x.isub(y),A.isub(C),B.isub(D)):(y.isub(x),C.isub(A),D.isub(B))}return{a:C,b:D,gcd:y.iushln(g)}},BN.prototype._invmp=function(p){assert(0===p.negative),assert(!p.isZero());var a=this,b=p.clone();a=0!==a.negative?a.umod(p):a.clone();for(var x1=new BN(1),x2=new BN(0),delta=b.clone();a.cmpn(1)>0&&b.cmpn(1)>0;){for(var i=0,im=1;0==(a.words[0]&im)&&i<26;++i,im<<=1);if(i>0)for(a.iushrn(i);i-- >0;)x1.isOdd()&&x1.iadd(delta),x1.iushrn(1);for(var j=0,jm=1;0==(b.words[0]&jm)&&j<26;++j,jm<<=1);if(j>0)for(b.iushrn(j);j-- >0;)x2.isOdd()&&x2.iadd(delta),x2.iushrn(1);a.cmp(b)>=0?(a.isub(b),x1.isub(x2)):(b.isub(a),x2.isub(x1))}var res;return(res=0===a.cmpn(1)?x1:x2).cmpn(0)<0&&res.iadd(p),res},BN.prototype.gcd=function(num){if(this.isZero())return num.abs();if(num.isZero())return this.abs();var a=this.clone(),b=num.clone();a.negative=0,b.negative=0;for(var shift=0;a.isEven()&&b.isEven();shift++)a.iushrn(1),b.iushrn(1);for(;;){for(;a.isEven();)a.iushrn(1);for(;b.isEven();)b.iushrn(1);var r=a.cmp(b);if(r<0){var t=a;a=b,b=t}else if(0===r||0===b.cmpn(1))break;a.isub(b)}return b.iushln(shift)},BN.prototype.invm=function(num){return this.egcd(num).a.umod(num)},BN.prototype.isEven=function(){return 0==(1&this.words[0])},BN.prototype.isOdd=function(){return 1==(1&this.words[0])},BN.prototype.andln=function(num){return this.words[0]&num},BN.prototype.bincn=function(bit){assert("number"==typeof bit);var r=bit%26,s=(bit-r)/26,q=1<<r;if(this.length<=s)return this._expand(s+1),this.words[s]|=q,this;for(var carry=q,i=s;0!==carry&&i<this.length;i++){var w=0|this.words[i];carry=(w+=carry)>>>26,w&=67108863,this.words[i]=w}return 0!==carry&&(this.words[i]=carry,this.length++),this},BN.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},BN.prototype.cmpn=function(num){var negative=num<0;if(0!==this.negative&&!negative)return-1;if(0===this.negative&&negative)return 1;this.strip();var res;if(this.length>1)res=1;else{negative&&(num=-num),assert(num<=67108863,"Number is too big");var w=0|this.words[0];res=w===num?0:w<num?-1:1}return 0!==this.negative?0|-res:res},BN.prototype.cmp=function(num){if(0!==this.negative&&0===num.negative)return-1;if(0===this.negative&&0!==num.negative)return 1;var res=this.ucmp(num);return 0!==this.negative?0|-res:res},BN.prototype.ucmp=function(num){if(this.length>num.length)return 1;if(this.length<num.length)return-1;for(var res=0,i=this.length-1;i>=0;i--){var a=0|this.words[i],b=0|num.words[i];if(a!==b){a<b?res=-1:a>b&&(res=1);break}}return res},BN.prototype.gtn=function(num){return 1===this.cmpn(num)},BN.prototype.gt=function(num){return 1===this.cmp(num)},BN.prototype.gten=function(num){return this.cmpn(num)>=0},BN.prototype.gte=function(num){return this.cmp(num)>=0},BN.prototype.ltn=function(num){return-1===this.cmpn(num)},BN.prototype.lt=function(num){return-1===this.cmp(num)},BN.prototype.lten=function(num){return this.cmpn(num)<=0},BN.prototype.lte=function(num){return this.cmp(num)<=0},BN.prototype.eqn=function(num){return 0===this.cmpn(num)},BN.prototype.eq=function(num){return 0===this.cmp(num)},BN.red=function(num){return new Red(num)},BN.prototype.toRed=function(ctx){return assert(!this.red,"Already a number in reduction context"),assert(0===this.negative,"red works only with positives"),ctx.convertTo(this)._forceRed(ctx)},BN.prototype.fromRed=function(){return assert(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},BN.prototype._forceRed=function(ctx){return this.red=ctx,this},BN.prototype.forceRed=function(ctx){return assert(!this.red,"Already a number in reduction context"),this._forceRed(ctx)},BN.prototype.redAdd=function(num){return assert(this.red,"redAdd works only with red numbers"),this.red.add(this,num)},BN.prototype.redIAdd=function(num){return assert(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,num)},BN.prototype.redSub=function(num){return assert(this.red,"redSub works only with red numbers"),this.red.sub(this,num)},BN.prototype.redISub=function(num){return assert(this.red,"redISub works only with red numbers"),this.red.isub(this,num)},BN.prototype.redShl=function(num){return assert(this.red,"redShl works only with red numbers"),this.red.shl(this,num)},BN.prototype.redMul=function(num){return assert(this.red,"redMul works only with red numbers"),this.red._verify2(this,num),this.red.mul(this,num)},BN.prototype.redIMul=function(num){return assert(this.red,"redMul works only with red numbers"),this.red._verify2(this,num),this.red.imul(this,num)},BN.prototype.redSqr=function(){return assert(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},BN.prototype.redISqr=function(){return assert(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},BN.prototype.redSqrt=function(){return assert(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},BN.prototype.redInvm=function(){return assert(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},BN.prototype.redNeg=function(){return assert(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},BN.prototype.redPow=function(num){return assert(this.red&&!num.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,num)};var primes={k256:null,p224:null,p192:null,p25519:null};function MPrime(name,p){this.name=name,this.p=new BN(p,16),this.n=this.p.bitLength(),this.k=new BN(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}MPrime.prototype._tmp=function(){var tmp=new BN(null);return tmp.words=new Array(Math.ceil(this.n/13)),tmp},MPrime.prototype.ireduce=function(num){var rlen,r=num;do{this.split(r,this.tmp),rlen=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(rlen>this.n);var cmp=rlen<this.n?-1:r.ucmp(this.p);return 0===cmp?(r.words[0]=0,r.length=1):cmp>0?r.isub(this.p):r.strip(),r},MPrime.prototype.split=function(input,out){input.iushrn(this.n,0,out)},MPrime.prototype.imulK=function(num){return num.imul(this.k)};function K256(){MPrime.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}inherits(K256,MPrime),K256.prototype.split=function(input,output){for(var outLen=Math.min(input.length,9),i=0;i<outLen;i++)output.words[i]=input.words[i];if(output.length=outLen,input.length<=9)return input.words[0]=0,void(input.length=1);var prev=input.words[9];for(output.words[output.length++]=4194303&prev,i=10;i<input.length;i++){var next=0|input.words[i];input.words[i-10]=(4194303&next)<<4|prev>>>22,prev=next}prev>>>=22,input.words[i-10]=prev,0===prev&&input.length>10?input.length-=10:input.length-=9},K256.prototype.imulK=function(num){num.words[num.length]=0,num.words[num.length+1]=0,num.length+=2;for(var lo=0,i=0;i<num.length;i++){var w=0|num.words[i];lo+=977*w,num.words[i]=67108863&lo,lo=64*w+(lo/67108864|0)}return 0===num.words[num.length-1]&&(num.length--,0===num.words[num.length-1]&&num.length--),num};function P224(){MPrime.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}inherits(P224,MPrime);function P192(){MPrime.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}inherits(P192,MPrime);function P25519(){MPrime.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}inherits(P25519,MPrime),P25519.prototype.imulK=function(num){for(var carry=0,i=0;i<num.length;i++){var hi=19*(0|num.words[i])+carry,lo=67108863&hi;hi>>>=26,num.words[i]=lo,carry=hi}return 0!==carry&&(num.words[num.length++]=carry),num},BN._prime=function(name){if(primes[name])return primes[name];var prime;if("k256"===name)prime=new K256;else if("p224"===name)prime=new P224;else if("p192"===name)prime=new P192;else{if("p25519"!==name)throw new Error("Unknown prime "+name);prime=new P25519}return primes[name]=prime,prime};function Red(m){if("string"==typeof m){var prime=BN._prime(m);this.m=prime.p,this.prime=prime}else assert(m.gtn(1),"modulus must be greater than 1"),this.m=m,this.prime=null}Red.prototype._verify1=function(a){assert(0===a.negative,"red works only with positives"),assert(a.red,"red works only with red numbers")},Red.prototype._verify2=function(a,b){assert(0==(a.negative|b.negative),"red works only with positives"),assert(a.red&&a.red===b.red,"red works only with red numbers")},Red.prototype.imod=function(a){return this.prime?this.prime.ireduce(a)._forceRed(this):a.umod(this.m)._forceRed(this)},Red.prototype.neg=function(a){return a.isZero()?a.clone():this.m.sub(a)._forceRed(this)},Red.prototype.add=function(a,b){this._verify2(a,b);var res=a.add(b);return res.cmp(this.m)>=0&&res.isub(this.m),res._forceRed(this)},Red.prototype.iadd=function(a,b){this._verify2(a,b);var res=a.iadd(b);return res.cmp(this.m)>=0&&res.isub(this.m),res},Red.prototype.sub=function(a,b){this._verify2(a,b);var res=a.sub(b);return res.cmpn(0)<0&&res.iadd(this.m),res._forceRed(this)},Red.prototype.isub=function(a,b){this._verify2(a,b);var res=a.isub(b);return res.cmpn(0)<0&&res.iadd(this.m),res},Red.prototype.shl=function(a,num){return this._verify1(a),this.imod(a.ushln(num))},Red.prototype.imul=function(a,b){return this._verify2(a,b),this.imod(a.imul(b))},Red.prototype.mul=function(a,b){return this._verify2(a,b),this.imod(a.mul(b))},Red.prototype.isqr=function(a){return this.imul(a,a.clone())},Red.prototype.sqr=function(a){return this.mul(a,a)},Red.prototype.sqrt=function(a){if(a.isZero())return a.clone();var mod3=this.m.andln(3);if(assert(mod3%2==1),3===mod3){var pow=this.m.add(new BN(1)).iushrn(2);return this.pow(a,pow)}for(var q=this.m.subn(1),s=0;!q.isZero()&&0===q.andln(1);)s++,q.iushrn(1);assert(!q.isZero());var one=new BN(1).toRed(this),nOne=one.redNeg(),lpow=this.m.subn(1).iushrn(1),z=this.m.bitLength();for(z=new BN(2*z*z).toRed(this);0!==this.pow(z,lpow).cmp(nOne);)z.redIAdd(nOne);for(var c=this.pow(z,q),r=this.pow(a,q.addn(1).iushrn(1)),t=this.pow(a,q),m=s;0!==t.cmp(one);){for(var tmp=t,i=0;0!==tmp.cmp(one);i++)tmp=tmp.redSqr();assert(i<m);var b=this.pow(c,new BN(1).iushln(m-i-1));r=r.redMul(b),c=b.redSqr(),t=t.redMul(c),m=i}return r},Red.prototype.invm=function(a){var inv=a._invmp(this.m);return 0!==inv.negative?(inv.negative=0,this.imod(inv).redNeg()):this.imod(inv)},Red.prototype.pow=function(a,num){if(num.isZero())return new BN(1).toRed(this);if(0===num.cmpn(1))return a.clone();var wnd=new Array(16);wnd[0]=new BN(1).toRed(this),wnd[1]=a;for(var i=2;i<wnd.length;i++)wnd[i]=this.mul(wnd[i-1],a);var res=wnd[0],current=0,currentLen=0,start=num.bitLength()%26;for(0===start&&(start=26),i=num.length-1;i>=0;i--){for(var word=num.words[i],j=start-1;j>=0;j--){var bit=word>>j&1;res!==wnd[0]&&(res=this.sqr(res)),0!==bit||0!==current?(current<<=1,current|=bit,(4===++currentLen||0===i&&0===j)&&(res=this.mul(res,wnd[current]),currentLen=0,current=0)):currentLen=0}start=26}return res},Red.prototype.convertTo=function(num){var r=num.umod(this.m);return r===num?r.clone():r},Red.prototype.convertFrom=function(num){var res=num.clone();return res.red=null,res},BN.mont=function(num){return new Mont(num)};function Mont(m){Red.call(this,m),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new BN(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}inherits(Mont,Red),Mont.prototype.convertTo=function(num){return this.imod(num.ushln(this.shift))},Mont.prototype.convertFrom=function(num){var r=this.imod(num.mul(this.rinv));return r.red=null,r},Mont.prototype.imul=function(a,b){if(a.isZero()||b.isZero())return a.words[0]=0,a.length=1,a;var t=a.imul(b),c=t.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),u=t.isub(c).iushrn(this.shift),res=u;return u.cmp(this.m)>=0?res=u.isub(this.m):u.cmpn(0)<0&&(res=u.iadd(this.m)),res._forceRed(this)},Mont.prototype.mul=function(a,b){if(a.isZero()||b.isZero())return new BN(0)._forceRed(this);var t=a.mul(b),c=t.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),u=t.isub(c).iushrn(this.shift),res=u;return u.cmp(this.m)>=0?res=u.isub(this.m):u.cmpn(0)<0&&(res=u.iadd(this.m)),res._forceRed(this)},Mont.prototype.invm=function(a){return this.imod(a._invmp(this.m).mul(this.r2))._forceRed(this)}}(void 0===module||module,this)},{buffer:219}],218:[function(require,module,exports){var r;module.exports=function(len){return r||(r=new Rand(null)),r.generate(len)};function Rand(rand){this.rand=rand}if(module.exports.Rand=Rand,Rand.prototype.generate=function(len){return this._rand(len)},Rand.prototype._rand=function(n){if(this.rand.getBytes)return this.rand.getBytes(n);for(var res=new Uint8Array(n),i=0;i<res.length;i++)res[i]=this.rand.getByte();return res},"object"==typeof self)self.crypto&&self.crypto.getRandomValues?Rand.prototype._rand=function(n){var arr=new Uint8Array(n);return self.crypto.getRandomValues(arr),arr}:self.msCrypto&&self.msCrypto.getRandomValues?Rand.prototype._rand=function(n){var arr=new Uint8Array(n);return self.msCrypto.getRandomValues(arr),arr}:"object"==typeof window&&(Rand.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var crypto=require("crypto");if("function"!=typeof crypto.randomBytes)throw new Error("Not supported");Rand.prototype._rand=function(n){return crypto.randomBytes(n)}}catch(e){}},{crypto:219}],219:[function(require,module,exports){},{}],220:[function(require,module,exports){var Buffer=require("safe-buffer").Buffer;function asUInt32Array(buf){Buffer.isBuffer(buf)||(buf=Buffer.from(buf));for(var len=buf.length/4|0,out=new Array(len),i=0;i<len;i++)out[i]=buf.readUInt32BE(4*i);return out}function scrubVec(v){for(;0<v.length;v++)v[0]=0}function cryptBlock(M,keySchedule,SUB_MIX,SBOX,nRounds){for(var t0,t1,t2,t3,SUB_MIX0=SUB_MIX[0],SUB_MIX1=SUB_MIX[1],SUB_MIX2=SUB_MIX[2],SUB_MIX3=SUB_MIX[3],s0=M[0]^keySchedule[0],s1=M[1]^keySchedule[1],s2=M[2]^keySchedule[2],s3=M[3]^keySchedule[3],ksRow=4,round=1;round<nRounds;round++)t0=SUB_MIX0[s0>>>24]^SUB_MIX1[s1>>>16&255]^SUB_MIX2[s2>>>8&255]^SUB_MIX3[255&s3]^keySchedule[ksRow++],t1=SUB_MIX0[s1>>>24]^SUB_MIX1[s2>>>16&255]^SUB_MIX2[s3>>>8&255]^SUB_MIX3[255&s0]^keySchedule[ksRow++],t2=SUB_MIX0[s2>>>24]^SUB_MIX1[s3>>>16&255]^SUB_MIX2[s0>>>8&255]^SUB_MIX3[255&s1]^keySchedule[ksRow++],t3=SUB_MIX0[s3>>>24]^SUB_MIX1[s0>>>16&255]^SUB_MIX2[s1>>>8&255]^SUB_MIX3[255&s2]^keySchedule[ksRow++],s0=t0,s1=t1,s2=t2,s3=t3;return t0=(SBOX[s0>>>24]<<24|SBOX[s1>>>16&255]<<16|SBOX[s2>>>8&255]<<8|SBOX[255&s3])^keySchedule[ksRow++],t1=(SBOX[s1>>>24]<<24|SBOX[s2>>>16&255]<<16|SBOX[s3>>>8&255]<<8|SBOX[255&s0])^keySchedule[ksRow++],t2=(SBOX[s2>>>24]<<24|SBOX[s3>>>16&255]<<16|SBOX[s0>>>8&255]<<8|SBOX[255&s1])^keySchedule[ksRow++],t3=(SBOX[s3>>>24]<<24|SBOX[s0>>>16&255]<<16|SBOX[s1>>>8&255]<<8|SBOX[255&s2])^keySchedule[ksRow++],[t0>>>=0,t1>>>=0,t2>>>=0,t3>>>=0]}var RCON=[0,1,2,4,8,16,32,64,128,27,54],G=function(){for(var d=new Array(256),j=0;j<256;j++)d[j]=j<128?j<<1:j<<1^283;for(var SBOX=[],INV_SBOX=[],SUB_MIX=[[],[],[],[]],INV_SUB_MIX=[[],[],[],[]],x=0,xi=0,i=0;i<256;++i){var sx=xi^xi<<1^xi<<2^xi<<3^xi<<4;sx=sx>>>8^255&sx^99,SBOX[x]=sx,INV_SBOX[sx]=x;var x2=d[x],x4=d[x2],x8=d[x4],t=257*d[sx]^16843008*sx;SUB_MIX[0][x]=t<<24|t>>>8,SUB_MIX[1][x]=t<<16|t>>>16,SUB_MIX[2][x]=t<<8|t>>>24,SUB_MIX[3][x]=t,t=16843009*x8^65537*x4^257*x2^16843008*x,INV_SUB_MIX[0][sx]=t<<24|t>>>8,INV_SUB_MIX[1][sx]=t<<16|t>>>16,INV_SUB_MIX[2][sx]=t<<8|t>>>24,INV_SUB_MIX[3][sx]=t,0===x?x=xi=1:(x=x2^d[d[d[x8^x2]]],xi^=d[d[xi]])}return{SBOX:SBOX,INV_SBOX:INV_SBOX,SUB_MIX:SUB_MIX,INV_SUB_MIX:INV_SUB_MIX}}();function AES(key){this._key=asUInt32Array(key),this._reset()}AES.blockSize=16,AES.keySize=32,AES.prototype.blockSize=AES.blockSize,AES.prototype.keySize=AES.keySize,AES.prototype._reset=function(){for(var keyWords=this._key,keySize=keyWords.length,nRounds=keySize+6,ksRows=4*(nRounds+1),keySchedule=[],k=0;k<keySize;k++)keySchedule[k]=keyWords[k];for(k=keySize;k<ksRows;k++){var t=keySchedule[k-1];k%keySize==0?(t=t<<8|t>>>24,t=G.SBOX[t>>>24]<<24|G.SBOX[t>>>16&255]<<16|G.SBOX[t>>>8&255]<<8|G.SBOX[255&t],t^=RCON[k/keySize|0]<<24):keySize>6&&k%keySize==4&&(t=G.SBOX[t>>>24]<<24|G.SBOX[t>>>16&255]<<16|G.SBOX[t>>>8&255]<<8|G.SBOX[255&t]),keySchedule[k]=keySchedule[k-keySize]^t}for(var invKeySchedule=[],ik=0;ik<ksRows;ik++){var ksR=ksRows-ik,tt=keySchedule[ksR-(ik%4?0:4)];invKeySchedule[ik]=ik<4||ksR<=4?tt:G.INV_SUB_MIX[0][G.SBOX[tt>>>24]]^G.INV_SUB_MIX[1][G.SBOX[tt>>>16&255]]^G.INV_SUB_MIX[2][G.SBOX[tt>>>8&255]]^G.INV_SUB_MIX[3][G.SBOX[255&tt]]}this._nRounds=nRounds,this._keySchedule=keySchedule,this._invKeySchedule=invKeySchedule},AES.prototype.encryptBlockRaw=function(M){return cryptBlock(M=asUInt32Array(M),this._keySchedule,G.SUB_MIX,G.SBOX,this._nRounds)},AES.prototype.encryptBlock=function(M){var out=this.encryptBlockRaw(M),buf=Buffer.allocUnsafe(16);return buf.writeUInt32BE(out[0],0),buf.writeUInt32BE(out[1],4),buf.writeUInt32BE(out[2],8),buf.writeUInt32BE(out[3],12),buf},AES.prototype.decryptBlock=function(M){var m1=(M=asUInt32Array(M))[1];M[1]=M[3],M[3]=m1;var out=cryptBlock(M,this._invKeySchedule,G.INV_SUB_MIX,G.INV_SBOX,this._nRounds),buf=Buffer.allocUnsafe(16);return buf.writeUInt32BE(out[0],0),buf.writeUInt32BE(out[3],4),buf.writeUInt32BE(out[2],8),buf.writeUInt32BE(out[1],12),buf},AES.prototype.scrub=function(){scrubVec(this._keySchedule),scrubVec(this._invKeySchedule),scrubVec(this._key)},module.exports.AES=AES},{"safe-buffer":401}],221:[function(require,module,exports){var aes=require("./aes"),Buffer=require("safe-buffer").Buffer,Transform=require("cipher-base"),inherits=require("inherits"),GHASH=require("./ghash"),xor=require("buffer-xor"),incr32=require("./incr32");function StreamCipher(mode,key,iv,decrypt){Transform.call(this);var h=Buffer.alloc(4,0);this._cipher=new aes.AES(key);var ck=this._cipher.encryptBlock(h);this._ghash=new GHASH(ck),iv=function(self,iv,ck){if(12===iv.length)return self._finID=Buffer.concat([iv,Buffer.from([0,0,0,1])]),Buffer.concat([iv,Buffer.from([0,0,0,2])]);var ghash=new GHASH(ck),len=iv.length,toPad=len%16;ghash.update(iv),toPad&&(toPad=16-toPad,ghash.update(Buffer.alloc(toPad,0))),ghash.update(Buffer.alloc(8,0));var ivBits=8*len,tail=Buffer.alloc(8);tail.writeUIntBE(ivBits,0,8),ghash.update(tail),self._finID=ghash.state;var out=Buffer.from(self._finID);return incr32(out),out}(this,iv,ck),this._prev=Buffer.from(iv),this._cache=Buffer.allocUnsafe(0),this._secCache=Buffer.allocUnsafe(0),this._decrypt=decrypt,this._alen=0,this._len=0,this._mode=mode,this._authTag=null,this._called=!1}inherits(StreamCipher,Transform),StreamCipher.prototype._update=function(chunk){if(!this._called&&this._alen){var rump=16-this._alen%16;rump<16&&(rump=Buffer.alloc(rump,0),this._ghash.update(rump))}this._called=!0;var out=this._mode.encrypt(this,chunk);return this._decrypt?this._ghash.update(chunk):this._ghash.update(out),this._len+=chunk.length,out},StreamCipher.prototype._final=function(){if(this._decrypt&&!this._authTag)throw new Error("Unsupported state or unable to authenticate data");var tag=xor(this._ghash.final(8*this._alen,8*this._len),this._cipher.encryptBlock(this._finID));if(this._decrypt&&function(a,b){var out=0;a.length!==b.length&&out++;for(var len=Math.min(a.length,b.length),i=0;i<len;++i)out+=a[i]^b[i];return out}(tag,this._authTag))throw new Error("Unsupported state or unable to authenticate data");this._authTag=tag,this._cipher.scrub()},StreamCipher.prototype.getAuthTag=function(){if(this._decrypt||!Buffer.isBuffer(this._authTag))throw new Error("Attempting to get auth tag in unsupported state");return this._authTag},StreamCipher.prototype.setAuthTag=function(tag){if(!this._decrypt)throw new Error("Attempting to set auth tag in unsupported state");this._authTag=tag},StreamCipher.prototype.setAAD=function(buf){if(this._called)throw new Error("Attempting to set AAD in unsupported state");this._ghash.update(buf),this._alen+=buf.length},module.exports=StreamCipher},{"./aes":220,"./ghash":225,"./incr32":226,"buffer-xor":268,"cipher-base":297,inherits:352,"safe-buffer":401}],222:[function(require,module,exports){var ciphers=require("./encrypter"),deciphers=require("./decrypter"),modes=require("./modes/list.json");exports.createCipher=exports.Cipher=ciphers.createCipher,exports.createCipheriv=exports.Cipheriv=ciphers.createCipheriv,exports.createDecipher=exports.Decipher=deciphers.createDecipher,exports.createDecipheriv=exports.Decipheriv=deciphers.createDecipheriv,exports.listCiphers=exports.getCiphers=function(){return Object.keys(modes)}},{"./decrypter":223,"./encrypter":224,"./modes/list.json":234}],223:[function(require,module,exports){var AuthCipher=require("./authCipher"),Buffer=require("safe-buffer").Buffer,MODES=require("./modes"),StreamCipher=require("./streamCipher"),Transform=require("cipher-base"),aes=require("./aes"),ebtk=require("evp_bytestokey");function Decipher(mode,key,iv){Transform.call(this),this._cache=new Splitter,this._last=void 0,this._cipher=new aes.AES(key),this._prev=Buffer.from(iv),this._mode=mode,this._autopadding=!0}require("inherits")(Decipher,Transform),Decipher.prototype._update=function(data){this._cache.add(data);for(var chunk,thing,out=[];chunk=this._cache.get(this._autopadding);)thing=this._mode.decrypt(this,chunk),out.push(thing);return Buffer.concat(out)},Decipher.prototype._final=function(){var chunk=this._cache.flush();if(this._autopadding)return function(last){var padded=last[15],i=-1;for(;++i<padded;)if(last[i+(16-padded)]!==padded)throw new Error("unable to decrypt data");if(16===padded)return;return last.slice(0,16-padded)}(this._mode.decrypt(this,chunk));if(chunk)throw new Error("data not multiple of block length")},Decipher.prototype.setAutoPadding=function(setTo){return this._autopadding=!!setTo,this};function Splitter(){this.cache=Buffer.allocUnsafe(0)}Splitter.prototype.add=function(data){this.cache=Buffer.concat([this.cache,data])},Splitter.prototype.get=function(autoPadding){var out;if(autoPadding){if(this.cache.length>16)return out=this.cache.slice(0,16),this.cache=this.cache.slice(16),out}else if(this.cache.length>=16)return out=this.cache.slice(0,16),this.cache=this.cache.slice(16),out;return null},Splitter.prototype.flush=function(){if(this.cache.length)return this.cache};function createDecipheriv(suite,password,iv){var config=MODES[suite.toLowerCase()];if(!config)throw new TypeError("invalid suite type");if("string"==typeof iv&&(iv=Buffer.from(iv)),"GCM"!==config.mode&&iv.length!==config.iv)throw new TypeError("invalid iv length "+iv.length);if("string"==typeof password&&(password=Buffer.from(password)),password.length!==config.key/8)throw new TypeError("invalid key length "+password.length);return"stream"===config.type?new StreamCipher(config.module,password,iv,!0):"auth"===config.type?new AuthCipher(config.module,password,iv,!0):new Decipher(config.module,password,iv)}exports.createDecipher=function(suite,password){var config=MODES[suite.toLowerCase()];if(!config)throw new TypeError("invalid suite type");var keys=ebtk(password,!1,config.key,config.iv);return createDecipheriv(suite,keys.key,keys.iv)},exports.createDecipheriv=createDecipheriv},{"./aes":220,"./authCipher":221,"./modes":233,"./streamCipher":236,"cipher-base":297,evp_bytestokey:335,inherits:352,"safe-buffer":401}],224:[function(require,module,exports){var MODES=require("./modes"),AuthCipher=require("./authCipher"),Buffer=require("safe-buffer").Buffer,StreamCipher=require("./streamCipher"),Transform=require("cipher-base"),aes=require("./aes"),ebtk=require("evp_bytestokey");function Cipher(mode,key,iv){Transform.call(this),this._cache=new Splitter,this._cipher=new aes.AES(key),this._prev=Buffer.from(iv),this._mode=mode,this._autopadding=!0}require("inherits")(Cipher,Transform),Cipher.prototype._update=function(data){this._cache.add(data);for(var chunk,thing,out=[];chunk=this._cache.get();)thing=this._mode.encrypt(this,chunk),out.push(thing);return Buffer.concat(out)};var PADDING=Buffer.alloc(16,16);Cipher.prototype._final=function(){var chunk=this._cache.flush();if(this._autopadding)return chunk=this._mode.encrypt(this,chunk),this._cipher.scrub(),chunk;if(!chunk.equals(PADDING))throw this._cipher.scrub(),new Error("data not multiple of block length")},Cipher.prototype.setAutoPadding=function(setTo){return this._autopadding=!!setTo,this};function Splitter(){this.cache=Buffer.allocUnsafe(0)}Splitter.prototype.add=function(data){this.cache=Buffer.concat([this.cache,data])},Splitter.prototype.get=function(){if(this.cache.length>15){var out=this.cache.slice(0,16);return this.cache=this.cache.slice(16),out}return null},Splitter.prototype.flush=function(){for(var len=16-this.cache.length,padBuff=Buffer.allocUnsafe(len),i=-1;++i<len;)padBuff.writeUInt8(len,i);return Buffer.concat([this.cache,padBuff])};function createCipheriv(suite,password,iv){var config=MODES[suite.toLowerCase()];if(!config)throw new TypeError("invalid suite type");if("string"==typeof password&&(password=Buffer.from(password)),password.length!==config.key/8)throw new TypeError("invalid key length "+password.length);if("string"==typeof iv&&(iv=Buffer.from(iv)),"GCM"!==config.mode&&iv.length!==config.iv)throw new TypeError("invalid iv length "+iv.length);return"stream"===config.type?new StreamCipher(config.module,password,iv):"auth"===config.type?new AuthCipher(config.module,password,iv):new Cipher(config.module,password,iv)}exports.createCipheriv=createCipheriv,exports.createCipher=function(suite,password){var config=MODES[suite.toLowerCase()];if(!config)throw new TypeError("invalid suite type");var keys=ebtk(password,!1,config.key,config.iv);return createCipheriv(suite,keys.key,keys.iv)}},{"./aes":220,"./authCipher":221,"./modes":233,"./streamCipher":236,"cipher-base":297,evp_bytestokey:335,inherits:352,"safe-buffer":401}],225:[function(require,module,exports){var Buffer=require("safe-buffer").Buffer,ZEROES=Buffer.alloc(16,0);function fromArray(out){var buf=Buffer.allocUnsafe(16);return buf.writeUInt32BE(out[0]>>>0,0),buf.writeUInt32BE(out[1]>>>0,4),buf.writeUInt32BE(out[2]>>>0,8),buf.writeUInt32BE(out[3]>>>0,12),buf}function GHASH(key){this.h=key,this.state=Buffer.alloc(16,0),this.cache=Buffer.allocUnsafe(0)}GHASH.prototype.ghash=function(block){for(var i=-1;++i<block.length;)this.state[i]^=block[i];this._multiply()},GHASH.prototype._multiply=function(){for(var buf,j,lsbVi,Vi=(buf=this.h,[buf.readUInt32BE(0),buf.readUInt32BE(4),buf.readUInt32BE(8),buf.readUInt32BE(12)]),Zi=[0,0,0,0],i=-1;++i<128;){for(0!=(this.state[~~(i/8)]&1<<7-i%8)&&(Zi[0]^=Vi[0],Zi[1]^=Vi[1],Zi[2]^=Vi[2],Zi[3]^=Vi[3]),lsbVi=0!=(1&Vi[3]),j=3;j>0;j--)Vi[j]=Vi[j]>>>1|(1&Vi[j-1])<<31;Vi[0]=Vi[0]>>>1,lsbVi&&(Vi[0]=Vi[0]^225<<24)}this.state=fromArray(Zi)},GHASH.prototype.update=function(buf){this.cache=Buffer.concat([this.cache,buf]);for(var chunk;this.cache.length>=16;)chunk=this.cache.slice(0,16),this.cache=this.cache.slice(16),this.ghash(chunk)},GHASH.prototype.final=function(abl,bl){return this.cache.length&&this.ghash(Buffer.concat([this.cache,ZEROES],16)),this.ghash(fromArray([0,abl,0,bl])),this.state},module.exports=GHASH},{"safe-buffer":401}],226:[function(require,module,exports){module.exports=function(iv){for(var item,len=iv.length;len--;){if(255!==(item=iv.readUInt8(len))){item++,iv.writeUInt8(item,len);break}iv.writeUInt8(0,len)}}},{}],227:[function(require,module,exports){var xor=require("buffer-xor");exports.encrypt=function(self,block){var data=xor(block,self._prev);return self._prev=self._cipher.encryptBlock(data),self._prev},exports.decrypt=function(self,block){var pad=self._prev;self._prev=block;var out=self._cipher.decryptBlock(block);return xor(out,pad)}},{"buffer-xor":268}],228:[function(require,module,exports){var Buffer=require("safe-buffer").Buffer,xor=require("buffer-xor");function encryptStart(self,data,decrypt){var len=data.length,out=xor(data,self._cache);return self._cache=self._cache.slice(len),self._prev=Buffer.concat([self._prev,decrypt?data:out]),out}exports.encrypt=function(self,data,decrypt){for(var len,out=Buffer.allocUnsafe(0);data.length;){if(0===self._cache.length&&(self._cache=self._cipher.encryptBlock(self._prev),self._prev=Buffer.allocUnsafe(0)),!(self._cache.length<=data.length)){out=Buffer.concat([out,encryptStart(self,data,decrypt)]);break}len=self._cache.length,out=Buffer.concat([out,encryptStart(self,data.slice(0,len),decrypt)]),data=data.slice(len)}return out}},{"buffer-xor":268,"safe-buffer":401}],229:[function(require,module,exports){var Buffer=require("safe-buffer").Buffer;function encryptByte(self,byteParam,decrypt){for(var pad,bit,value,i=-1,out=0;++i<8;)pad=self._cipher.encryptBlock(self._prev),bit=byteParam&1<<7-i?128:0,out+=(128&(value=pad[0]^bit))>>i%8,self._prev=shiftIn(self._prev,decrypt?bit:value);return out}function shiftIn(buffer,value){var len=buffer.length,i=-1,out=Buffer.allocUnsafe(buffer.length);for(buffer=Buffer.concat([buffer,Buffer.from([value])]);++i<len;)out[i]=buffer[i]<<1|buffer[i+1]>>7;return out}exports.encrypt=function(self,chunk,decrypt){for(var len=chunk.length,out=Buffer.allocUnsafe(len),i=-1;++i<len;)out[i]=encryptByte(self,chunk[i],decrypt);return out}},{"safe-buffer":401}],230:[function(require,module,exports){var Buffer=require("safe-buffer").Buffer;function encryptByte(self,byteParam,decrypt){var out=self._cipher.encryptBlock(self._prev)[0]^byteParam;return self._prev=Buffer.concat([self._prev.slice(1),Buffer.from([decrypt?byteParam:out])]),out}exports.encrypt=function(self,chunk,decrypt){for(var len=chunk.length,out=Buffer.allocUnsafe(len),i=-1;++i<len;)out[i]=encryptByte(self,chunk[i],decrypt);return out}},{"safe-buffer":401}],231:[function(require,module,exports){var xor=require("buffer-xor"),Buffer=require("safe-buffer").Buffer,incr32=require("../incr32");function getBlock(self){var out=self._cipher.encryptBlockRaw(self._prev);return incr32(self._prev),out}exports.encrypt=function(self,chunk){var chunkNum=Math.ceil(chunk.length/16),start=self._cache.length;self._cache=Buffer.concat([self._cache,Buffer.allocUnsafe(16*chunkNum)]);for(var i=0;i<chunkNum;i++){var out=getBlock(self),offset=start+16*i;self._cache.writeUInt32BE(out[0],offset+0),self._cache.writeUInt32BE(out[1],offset+4),self._cache.writeUInt32BE(out[2],offset+8),self._cache.writeUInt32BE(out[3],offset+12)}var pad=self._cache.slice(0,chunk.length);return self._cache=self._cache.slice(chunk.length),xor(chunk,pad)}},{"../incr32":226,"buffer-xor":268,"safe-buffer":401}],232:[function(require,module,exports){exports.encrypt=function(self,block){return self._cipher.encryptBlock(block)},exports.decrypt=function(self,block){return self._cipher.decryptBlock(block)}},{}],233:[function(require,module,exports){var modeModules={ECB:require("./ecb"),CBC:require("./cbc"),CFB:require("./cfb"),CFB8:require("./cfb8"),CFB1:require("./cfb1"),OFB:require("./ofb"),CTR:require("./ctr"),GCM:require("./ctr")},modes=require("./list.json");for(var key in modes)modes[key].module=modeModules[modes[key].mode];module.exports=modes},{"./cbc":227,"./cfb":228,"./cfb1":229,"./cfb8":230,"./ctr":231,"./ecb":232,"./list.json":234,"./ofb":235}],234:[function(require,module,exports){module.exports={"aes-128-ecb":{cipher:"AES",key:128,iv:0,mode:"ECB",type:"block"},"aes-192-ecb":{cipher:"AES",key:192,iv:0,mode:"ECB",type:"block"},"aes-256-ecb":{cipher:"AES",key:256,iv:0,mode:"ECB",type:"block"},"aes-128-cbc":{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},"aes-192-cbc":{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},"aes-256-cbc":{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},aes128:{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},aes192:{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},aes256:{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},"aes-128-cfb":{cipher:"AES",key:128,iv:16,mode:"CFB",type:"stream"},"aes-192-cfb":{cipher:"AES",key:192,iv:16,mode:"CFB",type:"stream"},"aes-256-cfb":{cipher:"AES",key:256,iv:16,mode:"CFB",type:"stream"},"aes-128-cfb8":{cipher:"AES",key:128,iv:16,mode:"CFB8",type:"stream"},"aes-192-cfb8":{cipher:"AES",key:192,iv:16,mode:"CFB8",type:"stream"},"aes-256-cfb8":{cipher:"AES",key:256,iv:16,mode:"CFB8",type:"stream"},"aes-128-cfb1":{cipher:"AES",key:128,iv:16,mode:"CFB1",type:"stream"},"aes-192-cfb1":{cipher:"AES",key:192,iv:16,mode:"CFB1",type:"stream"},"aes-256-cfb1":{cipher:"AES",key:256,iv:16,mode:"CFB1",type:"stream"},"aes-128-ofb":{cipher:"AES",key:128,iv:16,mode:"OFB",type:"stream"},"aes-192-ofb":{cipher:"AES",key:192,iv:16,mode:"OFB",type:"stream"},"aes-256-ofb":{cipher:"AES",key:256,iv:16,mode:"OFB",type:"stream"},"aes-128-ctr":{cipher:"AES",key:128,iv:16,mode:"CTR",type:"stream"},"aes-192-ctr":{cipher:"AES",key:192,iv:16,mode:"CTR",type:"stream"},"aes-256-ctr":{cipher:"AES",key:256,iv:16,mode:"CTR",type:"stream"},"aes-128-gcm":{cipher:"AES",key:128,iv:12,mode:"GCM",type:"auth"},"aes-192-gcm":{cipher:"AES",key:192,iv:12,mode:"GCM",type:"auth"},"aes-256-gcm":{cipher:"AES",key:256,iv:12,mode:"GCM",type:"auth"}}},{}],235:[function(require,module,exports){(function(Buffer){var xor=require("buffer-xor");function getBlock(self){return self._prev=self._cipher.encryptBlock(self._prev),self._prev}exports.encrypt=function(self,chunk){for(;self._cache.length<chunk.length;)self._cache=Buffer.concat([self._cache,getBlock(self)]);var pad=self._cache.slice(0,chunk.length);return self._cache=self._cache.slice(chunk.length),xor(chunk,pad)}}).call(this,require("buffer").Buffer)},{buffer:269,"buffer-xor":268}],236:[function(require,module,exports){var aes=require("./aes"),Buffer=require("safe-buffer").Buffer,Transform=require("cipher-base");function StreamCipher(mode,key,iv,decrypt){Transform.call(this),this._cipher=new aes.AES(key),this._prev=Buffer.from(iv),this._cache=Buffer.allocUnsafe(0),this._secCache=Buffer.allocUnsafe(0),this._decrypt=decrypt,this._mode=mode}require("inherits")(StreamCipher,Transform),StreamCipher.prototype._update=function(chunk){return this._mode.encrypt(this,chunk,this._decrypt)},StreamCipher.prototype._final=function(){this._cipher.scrub()},module.exports=StreamCipher},{"./aes":220,"cipher-base":297,inherits:352,"safe-buffer":401}],237:[function(require,module,exports){var ebtk=require("evp_bytestokey"),aes=require("browserify-aes/browser"),DES=require("browserify-des"),desModes=require("browserify-des/modes"),aesModes=require("browserify-aes/modes");function createCipheriv(suite,key,iv){if(suite=suite.toLowerCase(),aesModes[suite])return aes.createCipheriv(suite,key,iv);if(desModes[suite])return new DES({key:key,iv:iv,mode:suite});throw new TypeError("invalid suite type")}function createDecipheriv(suite,key,iv){if(suite=suite.toLowerCase(),aesModes[suite])return aes.createDecipheriv(suite,key,iv);if(desModes[suite])return new DES({key:key,iv:iv,mode:suite,decrypt:!0});throw new TypeError("invalid suite type")}exports.createCipher=exports.Cipher=function(suite,password){var keyLen,ivLen;if(suite=suite.toLowerCase(),aesModes[suite])keyLen=aesModes[suite].key,ivLen=aesModes[suite].iv;else{if(!desModes[suite])throw new TypeError("invalid suite type");keyLen=8*desModes[suite].key,ivLen=desModes[suite].iv}var keys=ebtk(password,!1,keyLen,ivLen);return createCipheriv(suite,keys.key,keys.iv)},exports.createCipheriv=exports.Cipheriv=createCipheriv,exports.createDecipher=exports.Decipher=function(suite,password){var keyLen,ivLen;if(suite=suite.toLowerCase(),aesModes[suite])keyLen=aesModes[suite].key,ivLen=aesModes[suite].iv;else{if(!desModes[suite])throw new TypeError("invalid suite type");keyLen=8*desModes[suite].key,ivLen=desModes[suite].iv}var keys=ebtk(password,!1,keyLen,ivLen);return createDecipheriv(suite,keys.key,keys.iv)},exports.createDecipheriv=exports.Decipheriv=createDecipheriv;exports.listCiphers=exports.getCiphers=function(){return Object.keys(desModes).concat(aes.getCiphers())}},{"browserify-aes/browser":222,"browserify-aes/modes":233,"browserify-des":238,"browserify-des/modes":239,evp_bytestokey:335}],238:[function(require,module,exports){(function(Buffer){var CipherBase=require("cipher-base"),des=require("des.js"),inherits=require("inherits"),modes={"des-ede3-cbc":des.CBC.instantiate(des.EDE),"des-ede3":des.EDE,"des-ede-cbc":des.CBC.instantiate(des.EDE),"des-ede":des.EDE,"des-cbc":des.CBC.instantiate(des.DES),"des-ecb":des.DES};modes.des=modes["des-cbc"],modes.des3=modes["des-ede3-cbc"],module.exports=DES,inherits(DES,CipherBase);function DES(opts){CipherBase.call(this);var type,modeName=opts.mode.toLowerCase(),mode=modes[modeName];type=opts.decrypt?"decrypt":"encrypt";var key=opts.key;"des-ede"!==modeName&&"des-ede-cbc"!==modeName||(key=Buffer.concat([key,key.slice(0,8)]));var iv=opts.iv;this._des=mode.create({key:key,iv:iv,type:type})}DES.prototype._update=function(data){return new Buffer(this._des.update(data))},DES.prototype._final=function(){return new Buffer(this._des.final())}}).call(this,require("buffer").Buffer)},{buffer:269,"cipher-base":297,"des.js":306,inherits:352}],239:[function(require,module,exports){exports["des-ecb"]={key:8,iv:0},exports["des-cbc"]=exports.des={key:8,iv:8},exports["des-ede3-cbc"]=exports.des3={key:24,iv:8},exports["des-ede3"]={key:24,iv:0},exports["des-ede-cbc"]={key:16,iv:8},exports["des-ede"]={key:16,iv:0}},{}],240:[function(require,module,exports){(function(Buffer){var bn=require("bn.js"),randomBytes=require("randombytes");module.exports=crt;function crt(msg,priv){var blinds=function(priv){var r=getr(priv);return{blinder:r.toRed(bn.mont(priv.modulus)).redPow(new bn(priv.publicExponent)).fromRed(),unblinder:r.invm(priv.modulus)}}(priv),len=priv.modulus.byteLength(),blinded=(bn.mont(priv.modulus),new bn(msg).mul(blinds.blinder).umod(priv.modulus)),c1=blinded.toRed(bn.mont(priv.prime1)),c2=blinded.toRed(bn.mont(priv.prime2)),qinv=priv.coefficient,p=priv.prime1,q=priv.prime2,m1=c1.redPow(priv.exponent1),m2=c2.redPow(priv.exponent2);m1=m1.fromRed(),m2=m2.fromRed();var h=m1.isub(m2).imul(qinv).umod(p);return h.imul(q),m2.iadd(h),new Buffer(m2.imul(blinds.unblinder).umod(priv.modulus).toArray(!1,len))}crt.getr=getr;function getr(priv){for(var len=priv.modulus.byteLength(),r=new bn(randomBytes(len));r.cmp(priv.modulus)>=0||!r.umod(priv.prime1)||!r.umod(priv.prime2);)r=new bn(randomBytes(len));return r}}).call(this,require("buffer").Buffer)},{"bn.js":217,buffer:269,randombytes:385}],241:[function(require,module,exports){module.exports=require("./browser/algorithms.json")},{"./browser/algorithms.json":242}],242:[function(require,module,exports){module.exports={sha224WithRSAEncryption:{sign:"rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},"RSA-SHA224":{sign:"ecdsa/rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},sha256WithRSAEncryption:{sign:"rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},"RSA-SHA256":{sign:"ecdsa/rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},sha384WithRSAEncryption:{sign:"rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},"RSA-SHA384":{sign:"ecdsa/rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},sha512WithRSAEncryption:{sign:"rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA512":{sign:"ecdsa/rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA1":{sign:"rsa",hash:"sha1",id:"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{sign:"ecdsa",hash:"sha1",id:""},sha256:{sign:"ecdsa",hash:"sha256",id:""},sha224:{sign:"ecdsa",hash:"sha224",id:""},sha384:{sign:"ecdsa",hash:"sha384",id:""},sha512:{sign:"ecdsa",hash:"sha512",id:""},"DSA-SHA":{sign:"dsa",hash:"sha1",id:""},"DSA-SHA1":{sign:"dsa",hash:"sha1",id:""},DSA:{sign:"dsa",hash:"sha1",id:""},"DSA-WITH-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-WITH-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-WITH-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-WITH-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-RIPEMD160":{sign:"dsa",hash:"rmd160",id:""},ripemd160WithRSA:{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},"RSA-RIPEMD160":{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},md5WithRSAEncryption:{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"},"RSA-MD5":{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"}}},{}],243:[function(require,module,exports){module.exports={"1.3.132.0.10":"secp256k1","1.3.132.0.33":"p224","1.2.840.10045.3.1.1":"p192","1.2.840.10045.3.1.7":"p256","1.3.132.0.34":"p384","1.3.132.0.35":"p521"}},{}],244:[function(require,module,exports){(function(Buffer){var createHash=require("create-hash"),stream=require("stream"),inherits=require("inherits"),sign=require("./sign"),verify=require("./verify"),algorithms=require("./algorithms.json");Object.keys(algorithms).forEach(function(key){algorithms[key].id=new Buffer(algorithms[key].id,"hex"),algorithms[key.toLowerCase()]=algorithms[key]});function Sign(algorithm){stream.Writable.call(this);var data=algorithms[algorithm];if(!data)throw new Error("Unknown message digest");this._hashType=data.hash,this._hash=createHash(data.hash),this._tag=data.id,this._signType=data.sign}inherits(Sign,stream.Writable),Sign.prototype._write=function(data,_,done){this._hash.update(data),done()},Sign.prototype.update=function(data,enc){return"string"==typeof data&&(data=new Buffer(data,enc)),this._hash.update(data),this},Sign.prototype.sign=function(key,enc){this.end();var hash=this._hash.digest(),sig=sign(hash,key,this._hashType,this._signType,this._tag);return enc?sig.toString(enc):sig};function Verify(algorithm){stream.Writable.call(this);var data=algorithms[algorithm];if(!data)throw new Error("Unknown message digest");this._hash=createHash(data.hash),this._tag=data.id,this._signType=data.sign}inherits(Verify,stream.Writable),Verify.prototype._write=function(data,_,done){this._hash.update(data),done()},Verify.prototype.update=function(data,enc){return"string"==typeof data&&(data=new Buffer(data,enc)),this._hash.update(data),this},Verify.prototype.verify=function(key,sig,enc){"string"==typeof sig&&(sig=new Buffer(sig,enc)),this.end();var hash=this._hash.digest();return verify(sig,hash,key,this._signType,this._tag)};function createSign(algorithm){return new Sign(algorithm)}function createVerify(algorithm){return new Verify(algorithm)}module.exports={Sign:createSign,Verify:createVerify,createSign:createSign,createVerify:createVerify}}).call(this,require("buffer").Buffer)},{"./algorithms.json":242,"./sign":245,"./verify":246,buffer:269,"create-hash":300,inherits:352,stream:421}],245:[function(require,module,exports){(function(Buffer){var createHmac=require("create-hmac"),crt=require("browserify-rsa"),EC=require("elliptic").ec,BN=require("bn.js"),parseKeys=require("parse-asn1"),curves=require("./curves.json");function getKey(x,q,hash,algo){if((x=new Buffer(x.toArray())).length<q.byteLength()){var zeros=new Buffer(q.byteLength()-x.length);zeros.fill(0),x=Buffer.concat([zeros,x])}var hlen=hash.length,hbits=function(bits,q){bits=(bits=bits2int(bits,q)).mod(q);var out=new Buffer(bits.toArray());if(out.length<q.byteLength()){var zeros=new Buffer(q.byteLength()-out.length);zeros.fill(0),out=Buffer.concat([zeros,out])}return out}(hash,q),v=new Buffer(hlen);v.fill(1);var k=new Buffer(hlen);return k.fill(0),k=createHmac(algo,k).update(v).update(new Buffer([0])).update(x).update(hbits).digest(),v=createHmac(algo,k).update(v).digest(),{k:k=createHmac(algo,k).update(v).update(new Buffer([1])).update(x).update(hbits).digest(),v:v=createHmac(algo,k).update(v).digest()}}function bits2int(obits,q){var bits=new BN(obits),shift=(obits.length<<3)-q.bitLength();return shift>0&&bits.ishrn(shift),bits}function makeKey(q,kv,algo){var t,k;do{for(t=new Buffer(0);8*t.length<q.bitLength();)kv.v=createHmac(algo,kv.k).update(kv.v).digest(),t=Buffer.concat([t,kv.v]);k=bits2int(t,q),kv.k=createHmac(algo,kv.k).update(kv.v).update(new Buffer([0])).digest(),kv.v=createHmac(algo,kv.k).update(kv.v).digest()}while(-1!==k.cmp(q));return k}function makeR(g,k,p,q){return g.toRed(BN.mont(p)).redPow(k).fromRed().mod(q)}module.exports=function(hash,key,hashType,signType,tag){var priv=parseKeys(key);if(priv.curve){if("ecdsa"!==signType&&"ecdsa/rsa"!==signType)throw new Error("wrong private key type");return function(hash,priv){var curveId=curves[priv.curve.join(".")];if(!curveId)throw new Error("unknown curve "+priv.curve.join("."));var out=new EC(curveId).keyFromPrivate(priv.privateKey).sign(hash);return new Buffer(out.toDER())}(hash,priv)}if("dsa"===priv.type){if("dsa"!==signType)throw new Error("wrong private key type");return function(hash,priv,algo){for(var k,x=priv.params.priv_key,p=priv.params.p,q=priv.params.q,g=priv.params.g,r=new BN(0),H=bits2int(hash,q).mod(q),s=!1,kv=getKey(x,q,hash,algo);!1===s;)k=makeKey(q,kv,algo),r=makeR(g,k,p,q),0===(s=k.invm(q).imul(H.add(x.mul(r))).mod(q)).cmpn(0)&&(s=!1,r=new BN(0));return function(r,s){r=r.toArray(),s=s.toArray(),128&r[0]&&(r=[0].concat(r)),128&s[0]&&(s=[0].concat(s));var res=[48,r.length+s.length+4,2,r.length];return res=res.concat(r,[2,s.length],s),new Buffer(res)}(r,s)}(hash,priv,hashType)}if("rsa"!==signType&&"ecdsa/rsa"!==signType)throw new Error("wrong private key type");hash=Buffer.concat([tag,hash]);for(var len=priv.modulus.byteLength(),pad=[0,1];hash.length+pad.length+1<len;)pad.push(255);pad.push(0);for(var i=-1;++i<hash.length;)pad.push(hash[i]);return crt(pad,priv)},module.exports.getKey=getKey,module.exports.makeKey=makeKey}).call(this,require("buffer").Buffer)},{"./curves.json":243,"bn.js":217,"browserify-rsa":240,buffer:269,"create-hmac":303,elliptic:318,"parse-asn1":366}],246:[function(require,module,exports){(function(Buffer){var BN=require("bn.js"),EC=require("elliptic").ec,parseKeys=require("parse-asn1"),curves=require("./curves.json");function checkValue(b,q){if(b.cmpn(0)<=0)throw new Error("invalid sig");if(b.cmp(q)>=q)throw new Error("invalid sig")}module.exports=function(sig,hash,key,signType,tag){var pub=parseKeys(key);if("ec"===pub.type){if("ecdsa"!==signType&&"ecdsa/rsa"!==signType)throw new Error("wrong public key type");return function(sig,hash,pub){var curveId=curves[pub.data.algorithm.curve.join(".")];if(!curveId)throw new Error("unknown curve "+pub.data.algorithm.curve.join("."));var curve=new EC(curveId),pubkey=pub.data.subjectPrivateKey.data;return curve.verify(hash,sig,pubkey)}(sig,hash,pub)}if("dsa"===pub.type){if("dsa"!==signType)throw new Error("wrong public key type");return function(sig,hash,pub){var p=pub.data.p,q=pub.data.q,g=pub.data.g,y=pub.data.pub_key,unpacked=parseKeys.signature.decode(sig,"der"),s=unpacked.s,r=unpacked.r;checkValue(s,q),checkValue(r,q);var montp=BN.mont(p),w=s.invm(q);return 0===g.toRed(montp).redPow(new BN(hash).mul(w).mod(q)).fromRed().mul(y.toRed(montp).redPow(r.mul(w).mod(q)).fromRed()).mod(p).mod(q).cmp(r)}(sig,hash,pub)}if("rsa"!==signType&&"ecdsa/rsa"!==signType)throw new Error("wrong public key type");hash=Buffer.concat([tag,hash]);for(var len=pub.modulus.byteLength(),pad=[1],padNum=0;hash.length+pad.length+2<len;)pad.push(255),padNum++;pad.push(0);for(var i=-1;++i<hash.length;)pad.push(hash[i]);pad=new Buffer(pad);var red=BN.mont(pub.modulus);sig=(sig=new BN(sig).toRed(red)).redPow(new BN(pub.publicExponent)),sig=new Buffer(sig.fromRed().toArray());var out=padNum<8?1:0;for(len=Math.min(sig.length,pad.length),sig.length!==pad.length&&(out=1),i=-1;++i<len;)out|=sig[i]^pad[i];return 0===out}}).call(this,require("buffer").Buffer)},{"./curves.json":243,"bn.js":217,buffer:269,elliptic:318,"parse-asn1":366}],247:[function(require,module,exports){arguments[4][219][0].apply(exports,arguments)},{dup:219}],248:[function(require,module,exports){"use strict";module.exports=require("./request")},{"./request":250}],249:[function(require,module,exports){"use strict";var assert=require("assert"),types={atom:["application/atom+xml",!0],bin:["application/octet-stream",!1],bmp:["image/bmp",!1],css:["text/css",!0],dat:["application/octet-stream",!1],form:["application/x-www-form-urlencoded",!0],gif:["image/gif",!1],gz:["application/x-gzip",!1],htc:["text/x-component",!0],html:["text/html",!0],ico:["image/x-icon",!1],jpg:["image/jpeg",!1],jpeg:["image/jpeg",!1],js:["application/javascript",!0],json:["application/json",!0],log:["text/plain",!0],manifest:["text/cache-manifest",!1],mathml:["application/mathml+xml",!0],md:["text/plain",!0],mkv:["video/x-matroska",!1],mml:["application/mathml+xml",!0],mp3:["audio/mpeg",!1],mp4:["video/mp4",!1],mpeg:["video/mpeg",!1],mpg:["video/mpeg",!1],oga:["audio/ogg",!1],ogg:["application/ogg",!1],ogv:["video/ogg",!1],otf:["font/otf",!1],pdf:["application/pdf",!1],png:["image/png",!1],rdf:["application/rdf+xml",!0],rss:["application/rss+xml",!0],svg:["image/svg+xml",!1],swf:["application/x-shockwave-flash",!1],tar:["application/x-tar",!1],torrent:["application/x-bittorrent",!1],txt:["text/plain",!0],ttf:["font/ttf",!1],wav:["audio/wav",!1],webm:["video/webm",!1],woff:["font/x-woff",!1],xhtml:["application/xhtml+xml",!0],xbl:["application/xml",!0],xml:["application/xml",!0],xsl:["application/xml",!0],xslt:["application/xslt+xml",!0],zip:["application/zip",!1]},extensions={"application/atom+xml":"atom","application/octet-stream":"bin","image/bmp":"bmp","text/css":"css","application/x-www-form-urlencoded":"form","image/gif":"gif","application/x-gzip":"gz","text/x-component":"htc","text/html":"html","image/x-icon":"ico","image/jpeg":"jpeg","text/javascript":"js","application/javascript":"js","text/x-json":"json","application/json":"json","text/plain":"txt","text/cache-manifest":"manifest","application/mathml+xml":"mml","video/x-matroska":"mkv","audio/x-matroska":"mkv","audio/mpeg":"mp3","audio/mpa":"mp3","video/mp4":"mp4","video/mpeg":"mpg","audio/ogg":"oga","application/ogg":"ogg","video/ogg":"ogv","font/otf":"otf","application/pdf":"pdf","application/x-pdf":"pdf","image/png":"png","application/rdf+xml":"rdf","application/rss+xml":"rss","image/svg+xml":"svg","application/x-shockwave-flash":"swf","application/x-tar":"tar","application/x-bittorrent":"torrent","font/ttf":"ttf","audio/wav":"wav","audio/wave":"wav","video/webm":"webm","audio/webm":"webm","font/x-woff":"woff","application/xhtml+xml":"xhtml","application/xml":"xsl","application/xslt+xml":"xslt","application/zip":"zip"};exports.file=function(path){assert("string"==typeof path);var parts=path.split("/").pop().split(".");if(parts.length<2)return"bin";if(2===parts.length&&""===parts[0])return"txt";var ext=parts[parts.length-1];return types[ext]?ext:"bin"},exports.textual=function(ext){var value=types[ext];return!!value&&value[1]},exports.type=function(ext){if(assert("string"==typeof ext),-1!==ext.indexOf("/"))return ext;var value=types[ext];if(!value)return"application/octet-stream";var name=value[0];return value[1]&&(name+="; charset=utf-8"),name},exports.ext=function(type){if(null==type)return"bin";assert("string"==typeof type);return type=(type=(type=type.split(";")[0]).toLowerCase()).trim(),extensions[type]||"bin"}},{assert:146}],250:[function(require,module,exports){(function(global,Buffer){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_request=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee(options){var opt,response,res,type,length,data,_data;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if("function"==typeof fetch){_context.next=2;break}throw new Error("Fetch API not available.");case 2:return opt=new RequestOptions(options),_context.next=5,fetch(opt.toURL(),opt.toHTTP());case 5:if(response=_context.sent,res=Response.fromFetch(response),type=mime.ext(res.headers["content-type"]),length=res.headers["content-length"],opt.isExpected(type)){_context.next=11;break}throw new Error("Wrong content-type for response.");case 11:if(!opt.isOverflow(length)){_context.next=13;break}throw new Error("Response exceeded limit.");case 13:if(res.type=type,!mime.textual(type)){_context.next=23;break}return _context.next=17,response.text();case 17:if(data=_context.sent,!(opt.limit&&data.length>opt.limit)){_context.next=20;break}throw new Error("Response exceeded limit.");case 20:res.str=data,_context.next=29;break;case 23:return _context.next=25,response.arrayBuffer();case 25:if(_data=_context.sent,!(opt.limit&&_data.length>opt.limit)){_context.next=28;break}throw new Error("Response exceeded limit.");case 28:res.buf=Buffer.from(_data.buffer);case 29:return _context.abrupt("return",res);case 30:case"end":return _context.stop()}},_callee,this)}));return function(_x){return _ref3.apply(this,arguments)}}(),request=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(options){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return"string"==typeof options&&(options={url:options}),options.buffer=!0,_context2.abrupt("return",_request(options));case 3:case"end":return _context2.stop()}},_callee2,this)}));return function(_x2){return _ref4.apply(this,arguments)}}();function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),EventEmitter=require("events"),URL=require("url"),qs=require("querystring"),mime=require("./mime"),fetch=global.fetch,FetchHeaders=global.Headers,RequestOptions=function(){function RequestOptions(options){_classCallCheck(this,RequestOptions),this.method="GET",this.ssl=!1,this.host="localhost",this.port=80,this.path="/",this.query="",this.agent="breq",this.type=null,this.expect=null,this.body=null,this.username="",this.password="",this.limit=10<<20,this.timeout=5e3,this.buffer=!1,this.headers=null,options&&this.fromOptions(options)}return RequestOptions.prototype.fromOptions=function(options){"string"==typeof options&&(options={url:options}),null!=options.method&&(assert("string"==typeof options.method),this.method=options.method.toUpperCase()),null!=options.ssl&&(assert("boolean"==typeof options.ssl),this.ssl=options.ssl,this.port=443),null!=options.host&&(assert("string"==typeof options.host),this.host=options.host),null!=options.port&&(assert((65535&options.port)===options.port),assert(0!==options.port),this.port=options.port),null!=options.path&&(assert("string"==typeof options.path),this.path=options.path),null!=options.query&&("string"==typeof options.query?this.query=options.query:(assert("object"===_typeof(options.query)),this.query=qs.stringify(options.query))),null!=options.username&&(assert("string"==typeof options.username),this.username=options.username),null!=options.password&&(assert("string"==typeof options.password),this.password=options.password),null!=options.uri&&this.navigate(options.uri),null!=options.url&&this.navigate(options.url),null!=options.agent&&(assert("string"==typeof options.agent),this.agent=options.agent),null!=options.json&&(assert("object"===_typeof(options.json)),this.body=Buffer.from(JSON.stringify(options.json),"utf8"),this.type="json"),null!=options.form&&(assert("object"===_typeof(options.form)),this.body=Buffer.from(qs.stringify(options.form),"utf8"),this.type="form"),null!=options.type&&(assert("string"==typeof options.type),this.type=options.type),null!=options.expect&&(assert("string"==typeof options.expect),this.expect=options.expect),null!=options.body&&("string"==typeof options.body?this.body=Buffer.from(options.body,"utf8"):(assert(Buffer.isBuffer(options.body)),this.body=options.body)),null!=options.extra&&(assert(Buffer.isBuffer(options.extra)),this.body?this.body=Buffer.concat([this.body,options.extra]):this.body=options.extra),null!=options.timeout&&(assert("number"==typeof options.timeout),this.timeout=options.timeout),null!=options.limit&&(assert("number"==typeof options.limit),this.limit=options.limit),null!=options.buffer&&(assert("boolean"==typeof options.buffer),this.buffer=options.buffer),null!=options.headers&&(assert("object"===_typeof(options.headers)),this.headers=options.headers)},RequestOptions.prototype.navigate=function(url){assert("string"==typeof url),-1===url.indexOf("://")&&(url="http://"+url);var data=URL.parse(url);if("http:"!==data.protocol&&"https:"!==data.protocol)throw new Error("Malformed URL.");if(!data.hostname)throw new Error("Malformed URL.");if(this.ssl="https:"===data.protocol,this.host=data.hostname,this.port=this.ssl?443:80,null!=data.port){var port=parseInt(data.port,10);assert((65535&port)===port),this.port=port}if(this.path=data.pathname,this.query=data.query,data.auth){var parts=data.auth.split(":");this.username=parts.shift(),this.password=parts.join(":")}},RequestOptions.prototype.isExpected=function(type){return assert("string"==typeof type),!this.expect||this.expect===type},RequestOptions.prototype.isOverflow=function(hdr){if(null==hdr)return!1;if(assert("string"==typeof hdr),!this.buffer)return!1;if(hdr=hdr.trim(),!/^\d+$/.test(hdr))return!1;if(0===(hdr=hdr.replace(/^0+/g,"")).length&&(hdr="0"),hdr.length>15)return!1;var length=parseInt(hdr,10);return!Number.isSafeInteger(length)||length>this.limit},RequestOptions.prototype.getHeaders=function(){var headers=new FetchHeaders;if(headers.append("User-Agent",this.agent),this.type&&headers.append("Content-Type",mime.type(this.type)),this.body&&headers.append("Content-Length",this.body.length.toString(10)),this.username||this.password){var auth=this.username+":"+this.password,data=Buffer.from(auth,"utf8");headers.append("Authorization","Basic "+data.toString("base64"))}return headers},RequestOptions.prototype.toURL=function(){var url="";return this.ssl?url+="https://":url+="http://",-1!==this.host.indexOf(":")?url+="["+this.host+"]":url+=this.host,url+=":"+this.port,url+=this.path,this.query&&(url+="?"+this.query),url},RequestOptions.prototype.toHTTP=function(){return{method:this.method,headers:this.getHeaders(),body:this.body.buffer,mode:"cors",credentials:"include",cache:"no-cache",redirect:"follow",referrer:"no-referrer"}},RequestOptions}(),Response=function(){function Response(){_classCallCheck(this,Response),this.statusCode=0,this.headers=Object.create(null),this.type="bin",this.str="",this.buf=null}return Response.prototype.text=function(){return this.buf?this.buf.toString("utf8"):this.str},Response.prototype.buffer=function(){return this.buf?this.buf:Buffer.from(this.str,"utf8")},Response.prototype.json=function(){var text=this.text().trim();if(0===text.length)return Object.create(null);var body=JSON.parse(text);if(!body||"object"!==(void 0===body?"undefined":_typeof(body)))throw new Error("JSON body is a non-object.");return body},Response.prototype.form=function(){return qs.parse(this.text())},Response.fromFetch=function(response){var res=new Response;res.statusCode=response.status;var _iterator=response.headers.entries(),_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref2;if(_isArray){if(_i>=_iterator.length)break;_ref2=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref2=_i.value}var _ref=_ref2,key=_ref[0],value=_ref[1];res.headers[key.toLowerCase()]=value}return res},Response}();request.stream=function(options){"string"==typeof options&&(options={url:options});var s=new EventEmitter,body=[];return s.write=function(data,enc){return Buffer.isBuffer(data)||(assert("string"==typeof data),data=Buffer.from(data,enc)),body.push(data),!0},s.end=function(){return options.extra=Buffer.concat(body),_request(options).then(function(res){s.emit("headers",res.headers),s.emit("type",res.type),s.emit("response",res),s.emit("data",res.buffer()),s.emit("end"),s.emit("close")}).catch(function(err){s.emit("error",err)}),!0},s},module.exports=request}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},require("buffer").Buffer)},{"./mime":249,assert:146,buffer:269,events:334,querystring:384,url:423}],251:[function(require,module,exports){"use strict";module.exports={Client:window.WebSocket||window.MozWebSocket}},{}],252:[function(require,module,exports){"use strict";module.exports={connect:!0,connect_error:!0,connect_timeout:!0,connecting:!0,disconnect:!0,error:!0,reconnect:!0,reconnect_attempt:!0,reconnect_failed:!0,reconnect_error:!0,reconnecting:!0,ping:!0,pong:!0}},{}],253:[function(require,module,exports){"use strict";var WebSocket=require("./backend"),Server=require("./server"),Socket=require("./socket");exports.WebSocket=WebSocket,exports.Server=Server,exports.server=function(){return new Server},exports.createServer=Server.createServer.bind(Server),exports.attach=Server.attach.bind(Server),exports.Socket=Socket,exports.socket=function(){return new Socket},exports.connect=Socket.connect.bind(Socket)},{"./backend":251,"./server":258,"./socket":259}],254:[function(require,module,exports){"use strict";module.exports={1e3:"NORMAL_CLOSURE",1001:"GOING_AWAY",1002:"PROTOCOL_ERROR",1003:"UNSUPPORTED_DATA",1004:"RESERVED",1005:"NO_STATUS_RECVD",1006:"ABNORMAL_CLOSURE",1007:"INVALID_FRAME_PAYLOAD_DATA",1008:"POLICY_VIOLATION",1009:"MESSAGE_TOO_BIG",1010:"MISSING_EXTENSION",1011:"INTERNAL_ERROR",1012:"SERVICE_RESTART",1013:"TRY_AGAIN_LATER",1014:"BAD_GATEWAY",1015:"TLS_HANDSHAKE"}},{}],255:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),DUMMY=Buffer.alloc(0),types={OPEN:0,CLOSE:1,PING:2,PONG:3,MESSAGE:4,UPGRADE:5,NOOP:6},Frame=function(){function Frame(type,data,binary){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Frame),assert("number"==typeof type),assert(type>>>0===type),assert(type<=types.NOOP),assert("boolean"==typeof binary),binary?(null==data&&(data=DUMMY),assert(Buffer.isBuffer(data))):(null==data&&(data=""),assert("string"==typeof data)),this.type=type,this.data=data,this.binary=binary}return Frame.prototype.toString=function(){var str="";return this.binary?(str+="b",str+=this.type.toString(10),str+=this.data.toString("base64")):(str+=this.type.toString(10),str+=this.data),str},Frame.fromString=function(str){assert("string"==typeof str);var type=str.charCodeAt(0),binary=!1,data=void 0;return 98===type?(assert(str.length>1),type=str.charCodeAt(1),data=Buffer.from(str.substring(2),"base64"),binary=!0):data=str.substring(1),assert((type-=48)>=0&&type<=9),assert(type<=types.NOOP),new this(type,data,binary)},Frame.prototype.size=function(){var len=1;return this.binary?len+=this.data.length:len+=Buffer.byteLength(this.data,"utf8"),len},Frame.prototype.toRaw=function(){var data=Buffer.allocUnsafe(this.size());return data[0]=this.type,this.binary?this.data.copy(data,1):this.data.length>0&&data.write(this.data,1,"utf8"),data},Frame.fromRaw=function(data){assert(Buffer.isBuffer(data)),assert(data.length>0);var type=data[0];return assert(type<=types.NOOP),new this(type,data.slice(1),!0)},Frame}();Frame.types=types,Frame.table=["open","close","ping","pong","message","upgrade","noop"],module.exports=Frame}).call(this,require("buffer").Buffer)},{assert:146,buffer:269}],256:[function(require,module,exports){(function(Buffer){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var assert=require("assert"),types={CONNECT:0,DISCONNECT:1,EVENT:2,ACK:3,ERROR:4,BINARY_EVENT:5,BINARY_ACK:6},Packet=function(){function Packet(type){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Packet),this.type=type||0,this.attachments=0,this.nsp="/",this.id=-1,this.data="",this.buffers=[]}return Packet.prototype.setData=function(data){assert(void 0!==data),assert("number"!=typeof data),assert("function"!=typeof data);var _deconstruct=function(obj){var buffers=[],out=function replace(obj,buffers){if(Buffer.isBuffer(obj)){var out={_placeholder:!0,num:buffers.length};return buffers.push(obj),out}if(Array.isArray(obj)){for(var _out=[],i=0;i<obj.length;i++)_out.push(replace(obj[i],buffers));return _out}if(obj&&"object"===(void 0===obj?"undefined":_typeof(obj))){for(var _out2=Object.create(null),_iterator=Object.keys(obj),_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var key=_ref;_out2[key]=replace(obj[key],buffers)}return _out2}return obj}(obj,buffers);return[JSON.stringify(out),buffers]}(data),str=_deconstruct[0],buffers=_deconstruct[1];if(this.data=str,this.buffers=buffers,this.attachments=buffers.length,this.attachments>0)switch(this.type){case types.EVENT:this.type=types.BINARY_EVENT;break;case types.ACK:this.type=types.BINARY_ACK}return this},Packet.prototype.getData=function(){return 0===this.data.length?null:(str=this.data,buffers=this.buffers,JSON.parse(str,function(key,value){if(null!==(obj=value)&&"object"===(void 0===obj?"undefined":_typeof(obj))&&!0===obj._placeholder&&obj.num>>>0===obj.num)return assert(value.num<buffers.length),buffers[value.num];var obj;return value}));var str,buffers},Packet.prototype.toString=function(){var str=this.type.toString(10);switch(this.type){case types.BINARY_EVENT:case types.BINARY_ACK:str+=this.attachments.toString(10)+"-"}return"/"!==this.nsp&&(str+=this.nsp+","),-1!==this.id&&(str+=this.id.toString(10)),str+=this.data},Packet.fromString=function(str){assert("string"==typeof str),assert(str.length>0);var i=0,type=0,attachments=0,nsp="/",id=-1,data="",_readChar=function(str,i){var ch=str.charCodeAt(i)-48;return ch<0||ch>9?-1:[i+1,ch]}(str,i);switch(i=_readChar[0],type=_readChar[1],assert(-1!==type),assert(type<=types.BINARY_ACK),type){case types.BINARY_EVENT:case types.BINARY_ACK:var _readInt=readInt(str,i);i=_readInt[0],attachments=_readInt[1],assert(-1!==attachments),assert(i<str.length),assert("-"===str[i]),i+=1}if(i<str.length&&"/"===str[i]){var _readTo=function(str,i,ch){for(var j=i;j<str.length&&str[j]!==ch;j++);return assert(j<str.length),[j+1,str.substring(i,j)]}(str,i,",");i=_readTo[0],nsp=_readTo[1]}var _readInt2=readInt(str,i);i=_readInt2[0],id=_readInt2[1],i<str.length&&(data=str.substring(i));var packet=new this;return packet.type=type,packet.attachments=attachments,packet.nsp=nsp,packet.id=id,packet.data=data,packet},Packet}();Packet.types=types;function readInt(str,i){for(var len=0,num=0;i<str.length;i++){var ch=str.charCodeAt(i)-48;if(ch<0||ch>9)break;num*=10,num+=ch,assert((len+=1)<=10)}return assert(num<=4294967295),0===len&&(num=-1),[i,num]}module.exports=Packet}).call(this,{isBuffer:require("../../is-buffer/index.js")})},{"../../is-buffer/index.js":353,assert:146}],257:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),EventEmitter=require("events"),Frame=require("./frame"),Parser=function(_EventEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Parser,_EventEmitter);function Parser(){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Parser),function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this))}return Parser.prototype.error=function(msg){this.emit("error",new Error(msg))},Parser.prototype.feedBinary=function(data){if(assert(Buffer.isBuffer(data)),data.length>1e8)this.error("Frame too large.");else{var frame=void 0;try{frame=Frame.fromRaw(data)}catch(e){return void this.emit("error",e)}this.emit("frame",frame)}},Parser.prototype.feedString=function(data){if(assert("string"==typeof data),Buffer.byteLength(data,"utf8")>1e8)this.error("Frame too large.");else{var frame=void 0;try{frame=Frame.fromString(data)}catch(e){return void this.emit("error",e)}this.emit("frame",frame)}},Parser}(EventEmitter);module.exports=Parser}).call(this,require("buffer").Buffer)},{"./frame":255,assert:146,buffer:269,events:334}],258:[function(require,module,exports){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}var Server=function(_EventEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Server,_EventEmitter);function Server(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Server);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return _this.sockets=new Set,_this.channels=new Map,_this.mounts=[],_this}return Server.prototype.attach=function(){return this},Server.prototype.mount=function(){},Server.prototype.open=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:case"end":return _context.stop()}},_callee,this)}));return function(){return _ref.apply(this,arguments)}}(),Server.prototype.close=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref2.apply(this,arguments)}}(),Server.prototype.join=function(){return!0},Server.prototype.leave=function(){return!0},Server.prototype.channel=function(){return null},Server.prototype.to=function(){},Server.prototype.all=function(){},Server.attach=function(parent,options){return new this(options).attach(parent)},Server.createServer=function(options){return new this(options)},Server}(require("events"));module.exports=Server},{events:334}],259:[function(require,module,exports){(function(Buffer){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),EventEmitter=require("events"),WebSocket=require("./backend").Client,Packet=require("./packet"),Frame=require("./frame"),util=require("./util"),Parser=require("./parser"),codes=require("./codes"),blacklist=require("./blacklist"),Socket=function(_EventEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Socket,_EventEmitter);function Socket(){_classCallCheck(this,Socket);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return _this.server=null,_this.ws=null,_this.protocol="",_this.url="ws://127.0.0.1:80/socket.io/?transport=websocket",_this.ssl=!1,_this.host="127.0.0.1",_this.port=80,_this.inbound=!1,_this.handshake=!1,_this.opened=!1,_this.connected=!1,_this.challenge=!1,_this.destroyed=!1,_this.reconnection=!0,_this.time=0,_this.sequence=0,_this.pingInterval=25e3,_this.pingTimeout=6e4,_this.lastPing=0,_this.parser=new Parser,_this.binary=!1,_this.packet=null,_this.timer=null,_this.jobs=new Map,_this.hooks=new Map,_this.channels=new Set,_this.events=new EventEmitter,_this.buffer=[],_this.admin=!1,_this.auth=!1,_this}return Socket.prototype.accept=function(server,req,socket,ws){assert(!this.ws,"Cannot accept twice."),assert(server),assert(req),assert(socket),assert(socket.remoteAddress),assert(null!=socket.remotePort),assert(ws);var proto="ws",host=socket.remoteAddress,port=socket.remotePort;return socket.encrypted&&(proto="wss"),-1!==host.indexOf(":")&&(host="["+host+"]"),port||(port=0),this.server=server,this.binary=-1===req.url.indexOf("b64=1"),this.url=proto+"://"+host+":"+port+"/socket.io/?transport=websocket",this.ssl="wss"===proto,this.host=socket.remoteAddress,this.port=socket.remotePort,this.inbound=!0,this.ws=ws,this.init(),this},Socket.prototype.connect=function(port,host,ssl,protocols){if(assert(!this.ws,"Cannot connect twice."),"string"==typeof port){protocols=host;var _util$parseURL=util.parseURL(port);port=_util$parseURL[0],host=_util$parseURL[1],ssl=_util$parseURL[2]}var proto="ws";ssl&&(proto="wss"),host||(host="127.0.0.1"),assert("string"==typeof host),assert((65535&port)===port,"Must pass a port."),assert(!ssl||"boolean"==typeof ssl),assert(!protocols||Array.isArray(protocols));var hostname=host;-1!==host.indexOf(":")&&"["!==host[0]&&(hostname="["+host+"]");var url=proto+"://"+hostname+":"+port+"/socket.io/?transport=websocket";return this.binary=!0,this.url=url,this.ssl=ssl,this.host=host,this.port=port,this.inbound=!1,this.ws=new WebSocket(url,protocols),this.init(),this},Socket.prototype.init=function(){var _this2=this;this.protocol=this.ws.protocol,this.time=Date.now(),this.observe(),this.parser.on("error",function(err){_this2.emit("error",err)}),this.parser.on("frame",function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(frame){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,_context.next=3,_this2.handleFrame(frame);case 3:_context.next=8;break;case 5:_context.prev=5,_context.t0=_context.catch(0),_this2.emit("error",_context.t0);case 8:case"end":return _context.stop()}},_callee,_this2,[[0,5]])}));return function(_x){return _ref.apply(this,arguments)}}()),this.start()},Socket.prototype.observe=function(){var _this3=this,ws=this.ws;assert(ws),ws.binaryType="arraybuffer",ws.onopen=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,_this3.onOpen();case 2:case"end":return _context2.stop()}},_callee2,_this3)})),ws.onmessage=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(event){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,_this3.onMessage(event);case 2:case"end":return _context3.stop()}},_callee3,_this3)}));return function(_x2){return _ref3.apply(this,arguments)}}(),ws.onerror=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(event){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,_this3.onError(event);case 2:case"end":return _context4.stop()}},_callee4,_this3)}));return function(_x3){return _ref4.apply(this,arguments)}}(),ws.onclose=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(event){return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,_this3.onClose(event);case 2:case"end":return _context5.stop()}},_callee5,_this3)}));return function(_x4){return _ref5.apply(this,arguments)}}()},Socket.prototype.onOpen=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(){return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(!this.destroyed){_context6.next=2;break}return _context6.abrupt("return");case 2:if(this.inbound){_context6.next=4;break}return _context6.abrupt("return");case 4:return assert(!this.opened),assert(!this.connected),assert(!this.handshake),this.opened=!0,this.handshake=!0,_context6.next=11,this.emitAsync("open");case 11:return this.sendHandshake(),this.connected=!0,_context6.next=15,this.emitAsync("connect");case 15:this.sendConnect();case 16:case"end":return _context6.stop()}},_callee6,this)}));return function(){return _ref6.apply(this,arguments)}}(),Socket.prototype.emitAsync=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(event){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];var handlers,_iterator,_isArray,_i,_ref8,_handler;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:handlers=this.listeners(event),_iterator=handlers,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();case 2:if(!_isArray){_context7.next=8;break}if(!(_i>=_iterator.length)){_context7.next=5;break}return _context7.abrupt("break",23);case 5:_ref8=_iterator[_i++],_context7.next=12;break;case 8:if(!(_i=_iterator.next()).done){_context7.next=11;break}return _context7.abrupt("break",23);case 11:_ref8=_i.value;case 12:return _handler=_ref8,_context7.prev=13,_context7.next=16,_handler.apply(void 0,args);case 16:_context7.next=21;break;case 18:_context7.prev=18,_context7.t0=_context7.catch(13),this.emit("error",_context7.t0);case 21:_context7.next=2;break;case 23:case"end":return _context7.stop()}},_callee7,this,[[13,18]])}));return function(_x5){return _ref7.apply(this,arguments)}}(),Socket.prototype.onMessage=function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(event){var data;return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(!this.destroyed){_context8.next=2;break}return _context8.abrupt("return");case 2:return data=void 0,_context8.prev=3,_context8.next=6,readBinary(event.data);case 6:data=_context8.sent,_context8.next=13;break;case 9:return _context8.prev=9,_context8.t0=_context8.catch(3),this.emit("error",_context8.t0),_context8.abrupt("return");case 13:if("string"!=typeof data){_context8.next=16;break}return this.parser.feedString(data),_context8.abrupt("return");case 16:this.parser.feedBinary(data);case 17:case"end":return _context8.stop()}},_callee8,this,[[3,9]])}));return function(_x6){return _ref9.apply(this,arguments)}}(),Socket.prototype.onError=function(){var _ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(event){return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:if(!this.destroyed){_context9.next=2;break}return _context9.abrupt("return");case 2:if(this.emit("error",new Error(event.message)),!this.inbound){_context9.next=6;break}return this.destroy(),_context9.abrupt("return");case 6:this.close();case 7:case"end":return _context9.stop()}},_callee9,this)}));return function(_x7){return _ref10.apply(this,arguments)}}(),Socket.prototype.onClose=function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(event){var code,reason,err;return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:if(!this.destroyed){_context10.next=2;break}return _context10.abrupt("return");case 2:if(1e3!==event.code&&1001!==event.code){_context10.next=9;break}if(this.connected||this.emit("error",new Error("Could not connect.")),!this.inbound){_context10.next=7;break}return this.destroy(),_context10.abrupt("return");case 7:return this.close(),_context10.abrupt("return");case 9:if(code=codes[event.code]||"UNKNOWN_CODE",reason=event.reason||"Unknown reason",(err=new Error("Websocket Closed: "+reason+" (code="+code+").")).reason=event.reason||"",err.code=event.code||0,this.emit("error",err),!this.inbound){_context10.next=19;break}return this.destroy(),_context10.abrupt("return");case 19:if(this.reconnection){_context10.next=22;break}return this.destroy(),_context10.abrupt("return");case 22:this.close();case 23:case"end":return _context10.stop()}},_callee10,this)}));return function(_x8){return _ref11.apply(this,arguments)}}(),Socket.prototype.close=function(){if(!this.destroyed){this.time=Date.now(),this.packet=null,this.handshake=!1,this.connected=!1,this.challenge=!1,this.sequence=0,this.lastPing=0;var _iterator2=this.jobs,_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref13;if(_isArray2){if(_i2>=_iterator2.length)break;_ref13=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref13=_i2.value}var _ref12=_ref13,id=_ref12[0],job=_ref12[1];this.jobs.delete(id),job.reject(new Error("Job timed out."))}assert(this.ws),this.ws.onopen=function(){},this.ws.onmessage=function(){},this.ws.onerror=function(){},this.ws.onclose=function(){},this.ws.close(),this.emitAsync("disconnect")}},Socket.prototype.error=function(msg){this.destroyed||this.emit("error",new Error(msg))},Socket.prototype.destroy=function(){this.destroyed||(this.close(),this.stop(),this.opened=!1,this.destroyed=!0,this.buffer.length=0,this.emitAsync("close"),this.removeAllListeners(),this.on("error",function(){}))},Socket.prototype.send=function(frame){this.destroyed||(assert(this.ws),frame.binary&&this.binary?this.ws.send(frame.toRaw()):this.ws.send(frame.toString()))},Socket.prototype.reconnect=function(){assert(!this.inbound),this.close(),this.ws=new WebSocket(this.url),this.time=Date.now(),this.observe()},Socket.prototype.start=function(){var _this4=this;assert(this.ws),assert(null==this.timer),this.timer=setInterval(function(){return _this4.stall()},5e3)},Socket.prototype.stop=function(){null!=this.timer&&(clearTimeout(this.timer),this.timer=null)},Socket.prototype.stall=function(){var now=Date.now();assert(this.ws);if(this.connected){var _iterator3=this.jobs,_isArray3=Array.isArray(_iterator3),_i3=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref15;if(_isArray3){if(_i3>=_iterator3.length)break;_ref15=_iterator3[_i3++]}else{if((_i3=_iterator3.next()).done)break;_ref15=_i3.value}var _ref14=_ref15,id=_ref14[0],job=_ref14[1];now-job.time>6e5&&(this.jobs.delete(id),job.reject(new Error("Job timed out.")))}return this.inbound||this.challenge?!this.inbound&&now-this.lastPing>this.pingTimeout?(this.error("Connection is stalling (ping)."),this.inbound?void this.destroy():void this.close()):void 0:(this.challenge=!0,this.lastPing=now,void this.sendPing())}if(now-this.time>1e4)return this.inbound||!this.reconnection?(this.error("Timed out waiting for connection."),void this.destroy()):(this.error("Timed out waiting for connection. Reconnecting..."),void this.reconnect())},Socket.prototype.handleFrame=function(){var _ref16=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(frame){return regeneratorRuntime.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:if(!this.destroyed){_context11.next=2;break}return _context11.abrupt("return",void 0);case 2:_context11.t0=frame.type,_context11.next=_context11.t0===Frame.types.OPEN?5:_context11.t0===Frame.types.CLOSE?6:_context11.t0===Frame.types.PING?7:_context11.t0===Frame.types.PONG?8:_context11.t0===Frame.types.MESSAGE?9:_context11.t0===Frame.types.UPGRADE?10:_context11.t0===Frame.types.NOOP?11:12;break;case 5:return _context11.abrupt("return",this.handleOpen(frame));case 6:return _context11.abrupt("return",this.handleClose(frame));case 7:return _context11.abrupt("return",this.handlePing(frame));case 8:return _context11.abrupt("return",this.handlePong(frame));case 9:return _context11.abrupt("return",this.handleMessage(frame));case 10:return _context11.abrupt("return",this.handleUpgrade(frame));case 11:return _context11.abrupt("return",this.handleNoop(frame));case 12:throw new Error("Unknown frame.");case 13:case"end":return _context11.stop()}},_callee11,this)}));return function(_x9){return _ref16.apply(this,arguments)}}(),Socket.prototype.handleOpen=function(){var _ref17=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(frame){var json,pingInterval,pingTimeout;return regeneratorRuntime.wrap(function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:if(!this.inbound){_context12.next=2;break}throw new Error("Inbound socket sent an open frame.");case 2:if(!frame.binary){_context12.next=4;break}throw new Error("Received a binary open frame.");case 4:if(!this.handshake){_context12.next=6;break}throw new Error("Duplicate open frame.");case 6:if(enforce((json=JSON.parse(frame.data))&&"object"===(void 0===json?"undefined":_typeof(json)),"open","object"),pingInterval=json.pingInterval,pingTimeout=json.pingTimeout,enforce(pingInterval>>>0===pingInterval,"interval","uint32"),enforce(pingTimeout>>>0===pingTimeout,"timeout","uint32"),this.pingInterval=pingInterval,this.pingTimeout=pingTimeout,this.handshake=!0,this.opened){_context12.next=18;break}return this.opened=!0,_context12.next=18,this.emitAsync("open");case 18:case"end":return _context12.stop()}},_callee12,this)}));return function(_x10){return _ref17.apply(this,arguments)}}(),Socket.prototype.handleClose=function(){var _ref18=_asyncToGenerator(regeneratorRuntime.mark(function _callee13(frame){return regeneratorRuntime.wrap(function(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:if(!this.inbound){_context13.next=2;break}throw new Error("Inbound socket sent a close frame.");case 2:this.close();case 3:case"end":return _context13.stop()}},_callee13,this)}));return function(_x11){return _ref18.apply(this,arguments)}}(),Socket.prototype.handlePing=function(){var _ref19=_asyncToGenerator(regeneratorRuntime.mark(function _callee14(){return regeneratorRuntime.wrap(function(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:if(this.inbound){_context14.next=2;break}throw new Error("Outbound socket sent a ping frame.");case 2:this.sendPong();case 3:case"end":return _context14.stop()}},_callee14,this)}));return function(){return _ref19.apply(this,arguments)}}(),Socket.prototype.handlePong=function(){var _ref20=_asyncToGenerator(regeneratorRuntime.mark(function _callee15(){return regeneratorRuntime.wrap(function(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:if(!this.inbound){_context15.next=2;break}throw new Error("Inbound socket sent a pong frame.");case 2:if(this.challenge){_context15.next=6;break}return this.error("Remote node sent bad pong."),this.destroy(),_context15.abrupt("return");case 6:this.challenge=!1;case 7:case"end":return _context15.stop()}},_callee15,this)}));return function(){return _ref20.apply(this,arguments)}}(),Socket.prototype.handleMessage=function(){var _ref21=_asyncToGenerator(regeneratorRuntime.mark(function _callee16(frame){var _packet,packet;return regeneratorRuntime.wrap(function(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:if(!this.packet){_context16.next=9;break}if(_packet=this.packet,frame.binary){_context16.next=4;break}throw new Error("Received non-binary frame as attachment.");case 4:if(_packet.buffers.push(frame.data),_packet.buffers.length!==_packet.attachments){_context16.next=8;break}return this.packet=null,_context16.abrupt("return",this.handlePacket(_packet));case 8:return _context16.abrupt("return",void 0);case 9:if(!frame.binary){_context16.next=11;break}throw new Error("Received binary frame as a message.");case 11:if(!((packet=Packet.fromString(frame.data)).attachments>0)){_context16.next=15;break}return this.packet=packet,_context16.abrupt("return",void 0);case 15:return _context16.abrupt("return",this.handlePacket(packet));case 16:case"end":return _context16.stop()}},_callee16,this)}));return function(_x12){return _ref21.apply(this,arguments)}}(),Socket.prototype.handleUpgrade=function(){var _ref22=_asyncToGenerator(regeneratorRuntime.mark(function _callee17(frame){return regeneratorRuntime.wrap(function(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:if(this.inbound){_context17.next=2;break}throw new Error("Outbound socket sent an upgrade frame.");case 2:throw new Error("Cannot upgrade from websocket.");case 3:case"end":return _context17.stop()}},_callee17,this)}));return function(_x13){return _ref22.apply(this,arguments)}}(),Socket.prototype.handleNoop=function(){var _ref23=_asyncToGenerator(regeneratorRuntime.mark(function _callee18(frame){return regeneratorRuntime.wrap(function(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:case 1:case"end":return _context18.stop()}},_callee18,this)}));return function(_x14){return _ref23.apply(this,arguments)}}(),Socket.prototype.sendFrame=function(type,data,binary){this.send(new Frame(type,data,binary))},Socket.prototype.sendOpen=function(data){this.sendFrame(Frame.types.OPEN,data,!1)},Socket.prototype.sendClose=function(data){this.sendFrame(Frame.types.CLOSE,data,!1)},Socket.prototype.sendPing=function(data){this.sendFrame(Frame.types.PING,data,!1)},Socket.prototype.sendPong=function(data){this.sendFrame(Frame.types.PONG,data,!1)},Socket.prototype.sendMessage=function(data){this.sendFrame(Frame.types.MESSAGE,data,!1)},Socket.prototype.sendBinary=function(data){this.sendFrame(Frame.types.MESSAGE,data,!0)},Socket.prototype.sendHandshake=function(){var handshake=JSON.stringify({sid:"00000000000000000000",upgrades:[],pingInterval:this.pingInterval,pingTimeout:this.pingTimeout});this.sendOpen(handshake)},Socket.prototype.handlePacket=function(){var _ref24=_asyncToGenerator(regeneratorRuntime.mark(function _callee19(packet){var _args19,json,err,result,_err;return regeneratorRuntime.wrap(function(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:if(!this.destroyed){_context19.next=2;break}return _context19.abrupt("return",void 0);case 2:_context19.t0=packet.type,_context19.next=_context19.t0===Packet.types.CONNECT?5:_context19.t0===Packet.types.DISCONNECT?6:_context19.t0===Packet.types.EVENT?7:_context19.t0===Packet.types.BINARY_EVENT?7:_context19.t0===Packet.types.ACK?14:_context19.t0===Packet.types.BINARY_ACK?14:_context19.t0===Packet.types.ERROR?26:29;break;case 5:return _context19.abrupt("return",this.handleConnect());case 6:return _context19.abrupt("return",this.handleDisconnect());case 7:if(_args19=packet.getData(),enforce(Array.isArray(_args19),"args","array"),enforce(_args19.length>0,"args","array"),enforce("string"==typeof _args19[0],"event","string"),-1===packet.id){_context19.next=13;break}return _context19.abrupt("return",this.handleCall(packet.id,_args19));case 13:return _context19.abrupt("return",this.handleEvent(_args19));case 14:if(enforce(-1!==packet.id,"id","uint32"),enforce(null==(json=packet.getData())||Array.isArray(json),"args","array"),err=null,result=null,json&&json.length>0&&(err=json[0]),json&&json.length>1&&(result=json[1]),null==result&&(result=null),!err){_context19.next=25;break}return enforce("object"===(void 0===err?"undefined":_typeof(err)),"error","object"),_context19.abrupt("return",this.handleError(packet.id,err));case 25:return _context19.abrupt("return",this.handleAck(packet.id,result));case 26:return enforce((_err=packet.getData())&&"object"===(void 0===_err?"undefined":_typeof(_err)),"error","object"),_context19.abrupt("return",this.handleError(-1,_err));case 29:throw new Error("Unknown packet.");case 30:case"end":return _context19.stop()}},_callee19,this)}));return function(_x15){return _ref24.apply(this,arguments)}}(),Socket.prototype.handleConnect=function(){var _ref25=_asyncToGenerator(regeneratorRuntime.mark(function _callee20(){var _iterator4,_isArray4,_i4,_ref26,packet;return regeneratorRuntime.wrap(function(_context20){for(;;)switch(_context20.prev=_context20.next){case 0:if(!this.inbound){_context20.next=2;break}throw new Error("Inbound socket sent connect packet.");case 2:return this.connected=!0,_context20.next=5,this.emitAsync("connect");case 5:_iterator4=this.buffer,_isArray4=Array.isArray(_iterator4),_i4=0,_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();case 6:if(!_isArray4){_context20.next=12;break}if(!(_i4>=_iterator4.length)){_context20.next=9;break}return _context20.abrupt("break",20);case 9:_ref26=_iterator4[_i4++],_context20.next=16;break;case 12:if(!(_i4=_iterator4.next()).done){_context20.next=15;break}return _context20.abrupt("break",20);case 15:_ref26=_i4.value;case 16:packet=_ref26,this.sendPacket(packet);case 18:_context20.next=6;break;case 20:this.buffer.length=0;case 21:case"end":return _context20.stop()}},_callee20,this)}));return function(){return _ref25.apply(this,arguments)}}(),Socket.prototype.handleDisconnect=function(){var _ref27=_asyncToGenerator(regeneratorRuntime.mark(function _callee21(){return regeneratorRuntime.wrap(function(_context21){for(;;)switch(_context21.prev=_context21.next){case 0:this.close();case 1:case"end":return _context21.stop()}},_callee21,this)}));return function(){return _ref27.apply(this,arguments)}}(),Socket.prototype.handleEvent=function(){var _ref28=_asyncToGenerator(regeneratorRuntime.mark(function _callee22(args){var _events,event;return regeneratorRuntime.wrap(function(_context22){for(;;)switch(_context22.prev=_context22.next){case 0:if(_context22.prev=0,event=args[0],!blacklist.hasOwnProperty(event)){_context22.next=4;break}throw new Error("Cannot emit blacklisted event: "+event+".");case 4:(_events=this.events).emit.apply(_events,args),_context22.next=11;break;case 7:_context22.prev=7,_context22.t0=_context22.catch(0),this.emit("error",_context22.t0),this.sendError(-1,_context22.t0);case 11:case"end":return _context22.stop()}},_callee22,this,[[0,7]])}));return function(_x16){return _ref28.apply(this,arguments)}}(),Socket.prototype.handleCall=function(){var _ref29=_asyncToGenerator(regeneratorRuntime.mark(function _callee23(id,args){var result,event,_handler2;return regeneratorRuntime.wrap(function(_context23){for(;;)switch(_context23.prev=_context23.next){case 0:if(result=void 0,_context23.prev=1,event=args.shift(),!blacklist.hasOwnProperty(event)){_context23.next=5;break}throw new Error("Cannot emit blacklisted event: "+event+".");case 5:if(_handler2=this.hooks.get(event)){_context23.next=8;break}throw new Error("Call not found: "+event+".");case 8:return _context23.next=10,_handler2.apply(void 0,args);case 10:result=_context23.sent,_context23.next=18;break;case 13:return _context23.prev=13,_context23.t0=_context23.catch(1),this.emit("error",_context23.t0),this.sendError(id,_context23.t0),_context23.abrupt("return");case 18:null==result&&(result=null),this.sendAck(id,result);case 20:case"end":return _context23.stop()}},_callee23,this,[[1,13]])}));return function(_x17,_x18){return _ref29.apply(this,arguments)}}(),Socket.prototype.handleAck=function(){var _ref30=_asyncToGenerator(regeneratorRuntime.mark(function _callee24(id,data){var job;return regeneratorRuntime.wrap(function(_context24){for(;;)switch(_context24.prev=_context24.next){case 0:if(job=this.jobs.get(id)){_context24.next=3;break}throw new Error("Job not found for "+id+".");case 3:this.jobs.delete(id),job.resolve(data);case 5:case"end":return _context24.stop()}},_callee24,this)}));return function(_x19,_x20){return _ref30.apply(this,arguments)}}(),Socket.prototype.handleError=function(){var _ref31=_asyncToGenerator(regeneratorRuntime.mark(function _callee25(id,err){var msg,code,type,_e,job,e;return regeneratorRuntime.wrap(function(_context25){for(;;)switch(_context25.prev=_context25.next){case 0:if(msg=castMsg(err.message),code=castCode(err.code),type=castType(err.type),-1!==id){_context25.next=9;break}return(_e=new Error(msg)).code=code,_e.type=type,this.emit("error",_e),_context25.abrupt("return");case 9:if(job=this.jobs.get(id)){_context25.next=12;break}throw new Error("Job not found for "+id+".");case 12:this.jobs.delete(id),(e=new Error(msg)).code=code,e.type=type,job.reject(e);case 17:case"end":return _context25.stop()}},_callee25,this)}));return function(_x21,_x22){return _ref31.apply(this,arguments)}}(),Socket.prototype.sendPacket=function(packet){this.sendMessage(packet.toString());var _iterator5=packet.buffers,_isArray5=Array.isArray(_iterator5),_i5=0;for(_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();;){var _ref32;if(_isArray5){if(_i5>=_iterator5.length)break;_ref32=_iterator5[_i5++]}else{if((_i5=_iterator5.next()).done)break;_ref32=_i5.value}var data=_ref32;this.sendBinary(data)}},Socket.prototype.sendConnect=function(){this.sendPacket(new Packet(Packet.types.CONNECT))},Socket.prototype.sendDisconnect=function(){this.sendPacket(new Packet(Packet.types.DISCONNECT))},Socket.prototype.sendEvent=function(data){var packet=new Packet;packet.type=Packet.types.EVENT,packet.setData(data),this.connected?this.sendPacket(packet):this.buffer.push(packet)},Socket.prototype.sendCall=function(id,data){var packet=new Packet;packet.type=Packet.types.EVENT,packet.id=id,packet.setData(data),this.connected?this.sendPacket(packet):this.buffer.push(packet)},Socket.prototype.sendAck=function(id,data){var packet=new Packet;packet.type=Packet.types.ACK,packet.id=id,packet.setData([null,data]),this.sendPacket(packet)},Socket.prototype.sendError=function(id,err){var message=castMsg(err.message),code=castCode(err.code),type=castType(err.type);if(-1===id){var _packet2=new Packet;return _packet2.type=Packet.types.ERROR,_packet2.setData({message:message,code:code,type:type}),void this.sendPacket(_packet2)}var packet=new Packet;packet.type=Packet.types.ACK,packet.id=id,packet.setData([{message:message,code:code,type:type}]),this.sendPacket(packet)},Socket.prototype.bind=function(event,handler){enforce("string"==typeof event,"event","string"),enforce("function"==typeof handler,"handler","function"),assert(!blacklist.hasOwnProperty(event),"Blacklisted event."),this.events.on(event,handler)},Socket.prototype.unbind=function(event,handler){enforce("string"==typeof event,"event","string"),enforce("function"==typeof handler,"handler","function"),assert(!blacklist.hasOwnProperty(event),"Blacklisted event."),this.events.removeListener(event,handler)},Socket.prototype.fire=function(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];enforce(args.length>0,"event","string"),enforce("string"==typeof args[0],"event","string"),this.sendEvent(args)},Socket.prototype.hook=function(event,handler){enforce("string"==typeof event,"event","string"),enforce("function"==typeof handler,"handler","function"),assert(!this.hooks.has(event),"Hook already bound."),assert(!blacklist.hasOwnProperty(event),"Blacklisted event."),this.hooks.set(event,handler)},Socket.prototype.unhook=function(event){enforce("string"==typeof event,"event","string"),enforce("function"==typeof handler,"handler","function"),assert(!blacklist.hasOwnProperty(event),"Blacklisted event."),this.hooks.delete(event)},Socket.prototype.call=function(){for(var _this5=this,_len3=arguments.length,args=Array(_len3),_key3=0;_key3<_len3;_key3++)args[_key3]=arguments[_key3];enforce(args.length>0,"event","string"),enforce("string"==typeof args[0],"event","string");var id=this.sequence;return this.sequence+=1,this.sequence>>>=0,assert(!this.jobs.has(id),"ID collision."),this.sendCall(id,args),new Promise(function(resolve,reject){_this5.jobs.set(id,new Job(resolve,reject,Date.now()))})},Socket.prototype.channel=function(name){return this.channels.has(name)},Socket.prototype.join=function(name){return!!this.server&&this.server.join(this,name)},Socket.prototype.leave=function(name){return!!this.server&&this.server.leave(this,name)},Socket.accept=function(server,req,socket,ws){return(new this).accept(server,req,socket,ws)},Socket.connect=function(port,host,ssl,protocols){return(new this).connect(port,host,ssl,protocols)},Socket}(EventEmitter),Job=function Job(resolve,reject,time){_classCallCheck(this,Job),this.resolve=resolve,this.reject=reject,this.time=time};function castCode(code){return null!==code&&"number"!=typeof code&&"string"!=typeof code?null:code}function castMsg(msg){return"string"!=typeof msg?"No message.":msg}function castType(type){return"string"!=typeof type?null:type}function enforce(value,name,type){if(!value){var err=new TypeError("'"+name+"' must be a(n) "+type+".");throw Error.captureStackTrace&&Error.captureStackTrace(err,enforce),err}}function readBinary(data){return new Promise(function(resolve,reject){if("string"!=typeof data)if(data&&"object"===(void 0===data?"undefined":_typeof(data)))if(Buffer.isBuffer(data))resolve(data);else if(data instanceof ArrayBuffer){var result=Buffer.from(data);resolve(result)}else if(data.buffer instanceof ArrayBuffer){var _result=Buffer.from(data.buffer);resolve(_result)}else{if("undefined"!=typeof Blob&&Blob&&data instanceof Blob){var reader=new FileReader;return reader.onloadend=function(){var result=Buffer.from(reader.result);resolve(result)},void reader.readAsArrayBuffer(data)}reject(new Error("Bad data object."))}else reject(new Error("Bad data object."));else resolve(data)})}module.exports=Socket}).call(this,require("buffer").Buffer)},{"./backend":251,"./blacklist":252,"./codes":254,"./frame":255,"./packet":256,"./parser":257,"./util":260,assert:146,buffer:269,events:334}],260:[function(require,module,exports){"use strict";var assert=require("assert"),URL=require("url");exports.parseURL=function(url){-1===url.indexOf("://")&&(url="ws://"+url);var data=URL.parse(url);if("http:"!==data.protocol&&"https:"!==data.protocol&&"ws:"!==data.protocol&&"wss:"!==data.protocol)throw new Error("Invalid protocol for websocket URL.");if(!data.hostname)throw new Error("Malformed URL.");var host=data.hostname,port=80,ssl=!1;return"https:"!==data.protocol&&"wss:"!==data.protocol||(port=443,ssl=!0),data.port&&(port=parseInt(data.port,10),assert((65535&port)===port),assert(0!==port)),[port,host,ssl]}},{assert:146,url:423}],261:[function(require,module,exports){"use strict";module.exports=require("./socks")},{"./socks":262}],262:[function(require,module,exports){"use strict";exports.unsupported=!0,exports.connect=function(proxy,destPort,destHost){throw new Error("SOCKS unsupported.")},exports.resolve=function(){var fn,_ref=(fn=regeneratorRuntime.mark(function _callee(proxy,name){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:throw new Error("SOCKS unsupported.");case 1:case"end":return _context.stop()}},_callee,this)}),function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})});return function(_x,_x2){return _ref.apply(this,arguments)}}()},{}],263:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),TABLE=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,-1,-1,-1,-1,-1,-1,-1,9,10,11,12,13,14,15,16,-1,17,18,19,20,21,-1,22,23,24,25,26,27,28,29,30,31,32,-1,-1,-1,-1,-1,-1,33,34,35,36,37,38,39,40,41,42,43,-1,44,45,46,47,48,49,50,51,52,53,54,55,56,57,-1,-1,-1,-1,-1];exports.encode=function(data){assert(Buffer.isBuffer(data));for(var zeroes=0,i=0;i<data.length&&0===data[i];i++)zeroes+=1;var b58=Buffer.allocUnsafe(1+(138*data.length/100|0));b58.fill(0);for(var length=0;i<data.length;i++){for(var carry=data[i],j=0,k=b58.length-1;k>=0&&!(0===carry&&j>=length);k--,j++)carry+=256*b58[k],b58[k]=carry%58,carry=carry/58|0;assert(0===carry),length=j}for(i=b58.length-length;i<b58.length&&0===b58[i];)i+=1;for(var str="",_j=0;_j<zeroes;_j++)str+="1";for(;i<b58.length;i++)str+="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"[b58[i]];return str},exports.decode=function(str){assert("string"==typeof str);for(var zeroes=0,i=0;i<str.length&&"1"===str[i];i++)zeroes+=1;var b256=Buffer.allocUnsafe(1+(733*str.length/1e3|0));b256.fill(0);for(var length=0;i<str.length;i++){var ch=str.charCodeAt(i),v=65408&ch?-1:TABLE[ch];if(-1===v)throw new Error("Non-base58 character.");for(var carry=v,_j2=0,k=b256.length-1;k>=0&&!(0===carry&&_j2>=length);k--,_j2++)carry+=58*b256[k],b256[k]=carry%256,carry=carry/256|0;assert(0===carry),length=_j2}for(i=0;i<b256.length&&0===b256[i];)i+=1;var out=Buffer.allocUnsafe(zeroes+(b256.length-i)),j=void 0;for(j=0;j<zeroes;j++)out[j]=0;for(;i<b256.length;)out[j++]=b256[i++];return out},exports.test=function(str){if("string"!=typeof str)return!1;for(var i=0;i<str.length;i++){var ch=str.charCodeAt(i);if(65408&ch)return!1;if(-1===TABLE[ch])return!1}return!0}}).call(this,require("buffer").Buffer)},{assert:146,buffer:269}],264:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),POOL65=Buffer.allocUnsafe(65),CHARSET="qpzry9x8gf2tvdw0s3jn54khce6mua7l",TABLE=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,15,-1,10,17,21,20,26,30,7,5,-1,-1,-1,-1,-1,-1,-1,29,-1,24,13,25,9,8,23,-1,18,22,31,27,19,-1,1,0,3,16,11,28,12,14,6,4,2,-1,-1,-1,-1,-1,-1,29,-1,24,13,25,9,8,23,-1,18,22,31,27,19,-1,1,0,3,16,11,28,12,14,6,4,2,-1,-1,-1,-1,-1];function polymod(pre){var b=pre>>>25;return(33554431&pre)<<5^996825010&-(b>>0&1)^642813549&-(b>>1&1)^513874426&-(b>>2&1)^1027748829&-(b>>3&1)^705979059&-(b>>4&1)}function deserialize(str){if(str.length<8||str.length>90)throw new Error("Invalid bech32 string length.");for(var dlen=0;dlen<str.length&&"1"!==str[str.length-1-dlen];)dlen+=1;var hlen=str.length-(1+dlen);if(hlen<1||dlen<6)throw new Error("Invalid bech32 data length.");dlen-=6;for(var data=Buffer.allocUnsafe(dlen),chk=1,lower=!1,upper=!1,hrp="",_i5=0;_i5<hlen;_i5++){var ch=str.charCodeAt(_i5);if(ch<33||ch>126)throw new Error("Invalid bech32 character.");ch>=97&&ch<=122?lower=!0:ch>=65&&ch<=90&&(upper=!0,ch=ch-65+97),hrp+=String.fromCharCode(ch),chk=polymod(chk)^ch>>5}chk=polymod(chk);var i=void 0;for(i=0;i<hlen;i++)chk=polymod(chk)^31&str.charCodeAt(i);for(i+=1;i<str.length;){var _ch3=str.charCodeAt(i),v=65408&_ch3?-1:TABLE[_ch3];if(-1===v)throw new Error("Invalid bech32 character.");_ch3>=97&&_ch3<=122?lower=!0:_ch3>=65&&_ch3<=90&&(upper=!0),chk=polymod(chk)^v,i+6<str.length&&(data[i-(1+hlen)]=v),i+=1}if(lower&&upper)throw new Error("Invalid bech32 casing.");if(1!==chk)throw new Error("Invalid bech32 checksum.");return[hrp,data.slice(0,dlen)]}function convert(data,output,frombits,tobits,pad,off){var maxv=(1<<tobits)-1,acc=0,bits=0,j=0;-1!==pad&&(output[j++]=pad);for(var i=off;i<data.length;i++){var value=data[i];if(value>>frombits!=0)throw new Error("Invalid bech32 bits.");for(acc=acc<<frombits|value,bits+=frombits;bits>=tobits;)bits-=tobits,output[j++]=acc>>>bits&maxv}if(-1!==pad)bits>0&&(output[j++]=acc<<tobits-bits&maxv);else if(bits>=frombits||acc<<tobits-bits&maxv)throw new Error("Invalid bech32 bits.");return output.slice(0,j)}exports.encode=function(hrp,version,hash){if(assert("string"==typeof hrp),assert((255&version)===version),assert(Buffer.isBuffer(hash)),version<0||version>16)throw new Error("Invalid bech32 version.");if(hash.length<2||hash.length>40)throw new Error("Invalid bech32 data length.");return function(hrp,data){var chk=1,i=void 0;for(i=0;i<hrp.length;i++){var ch=hrp.charCodeAt(i);if(65280&ch||ch>>5==0)throw new Error("Invalid bech32 character.");chk=polymod(chk)^ch>>5}if(i+7+data.length>90)throw new Error("Invalid bech32 data length.");chk=polymod(chk);for(var str="",_i=0;_i<hrp.length;_i++){var _ch=hrp.charCodeAt(_i);chk=polymod(chk)^31&_ch,str+=hrp[_i]}str+="1";for(var _i2=0;_i2<data.length;_i2++){var _ch2=data[_i2];if(_ch2>>5!=0)throw new Error("Invalid bech32 value.");chk=polymod(chk)^_ch2,str+=CHARSET[_ch2]}for(var _i3=0;_i3<6;_i3++)chk=polymod(chk);chk^=1;for(var _i4=0;_i4<6;_i4++)str+=CHARSET[chk>>>5*(5-_i4)&31];return str}(hrp,convert(hash,POOL65,8,5,version,0))},exports.decode=function(str){assert("string"==typeof str);var _deserialize=deserialize(str),hrp=_deserialize[0],data=_deserialize[1];if(0===data.length||data.length>65)throw new Error("Invalid bech32 data length.");if(data[0]>16)throw new Error("Invalid bech32 version.");var version=data[0],hash=convert(data,data,5,8,-1,1);if(hash.length<2||hash.length>40)throw new Error("Invalid bech32 data length.");return new function(hrp,version,hash){this.hrp=hrp,this.version=version,this.hash=hash}(hrp,version,hash)},exports.test=function(str){if("string"!=typeof str)return!1;var data=void 0;try{data=deserialize(str)[1]}catch(e){return!1}return!(0===data.length||data.length>65||data[0]>16)}}).call(this,require("buffer").Buffer)},{assert:146,buffer:269}],265:[function(require,module,exports){"use strict";exports.base58=require("./base58"),exports.bech32=require("./bech32")},{"./base58":263,"./bech32":264}],266:[function(require,module,exports){"use strict";module.exports=require("./tcp")},{"./tcp":267}],267:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var EventEmitter=require("events"),Socket=function(_EventEmitter){_inherits(Socket,_EventEmitter);function Socket(){_classCallCheck(this,Socket);var _this=_possibleConstructorReturn(this,_EventEmitter.call(this));return _this.readable=!0,_this.writable=!0,_this.encrypted=!1,_this.bufferSize=0,_this.bytesRead=0,_this.bytesWritten=0,_this.connecting=!1,_this.destroyed=!1,_this.localAddress="127.0.0.1",_this.localPort=0,_this.remoteAddress="127.0.0.1",_this.remoteFamily="IPv4",_this.remotePort=0,_this}return Socket.prototype.address=function(){return{address:"127.0.0.1",family:"IPv4",port:0}},Socket.prototype.connect=function(port,host){throw new Error("Unsupported.")},Socket.prototype.destroy=function(err){return this},Socket.prototype.end=function(data,enc){throw new Error("Unsupported.")},Socket.prototype.pause=function(){return this},Socket.prototype.ref=function(){return this},Socket.prototype.resume=function(){return this},Socket.prototype.setEncoding=function(enc){return this},Socket.prototype.setKeepAlive=function(enable,delay){return this},Socket.prototype.setNoDelay=function(value){return this},Socket.prototype.setTimeout=function(timeout,callback){return this},Socket.prototype.unref=function(){return this},Socket.prototype.write=function(data,enc){throw new Error("Unsupported.")},Socket}(EventEmitter),Server=function(_EventEmitter2){_inherits(Server,_EventEmitter2);function Server(handler){return _classCallCheck(this,Server),_possibleConstructorReturn(this,_EventEmitter2.call(this))}return Server.prototype.address=function(){return{address:"127.0.0.1",family:"IPv4",port:0}},Server.prototype.close=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.abrupt("return");case 1:case"end":return _context.stop()}},_callee,this)}));return function(){return _ref.apply(this,arguments)}}(),Server.prototype.getConnections=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",0);case 1:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref2.apply(this,arguments)}}(),Server.prototype.listen=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.abrupt("return");case 1:case"end":return _context3.stop()}},_callee3,this)}));return function(){return _ref3.apply(this,arguments)}}(),Server.prototype.ref=function(){return this},Server.prototype.unref=function(){return this},_createClass(Server,[{key:"listening",get:function(){return!1},set:function(value){}},{key:"maxConnections",get:function(){},set:function(value){}}]),Server}(EventEmitter);exports.unsupported=!0,exports.Socket=Socket,exports.Server=Server,exports.connect=function(port,host){throw new Error("Unsupported.")},exports.createSocket=exports.connect,exports.createConnection=exports.connect,exports.createServer=function(handler){return new Server(handler)}},{events:334}],268:[function(require,module,exports){(function(Buffer){module.exports=function(a,b){for(var length=Math.min(a.length,b.length),buffer=new Buffer(length),i=0;i<length;++i)buffer[i]=a[i]^b[i];return buffer}}).call(this,require("buffer").Buffer)},{buffer:269}],269:[function(require,module,exports){"use strict";var base64=require("base64-js"),ieee754=require("ieee754");exports.Buffer=Buffer,exports.SlowBuffer=function(length){+length!=length&&(length=0);return Buffer.alloc(+length)},exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;exports.kMaxLength=K_MAX_LENGTH,Buffer.TYPED_ARRAY_SUPPORT=function(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()}catch(e){return!1}}(),Buffer.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function createBuffer(length){if(length>K_MAX_LENGTH)throw new RangeError("Invalid typed array length");var buf=new Uint8Array(length);return buf.__proto__=Buffer.prototype,buf}function Buffer(arg,encodingOrOffset,length){if("number"==typeof arg){if("string"==typeof encodingOrOffset)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192;function from(value,encodingOrOffset,length){if("number"==typeof value)throw new TypeError('"value" argument must not be a number');return isArrayBuffer(value)?function(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset)throw new RangeError("'offset' is out of bounds");if(array.byteLength<byteOffset+(length||0))throw new RangeError("'length' is out of bounds");var buf;buf=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length);return buf.__proto__=Buffer.prototype,buf}(value,encodingOrOffset,length):"string"==typeof value?function(string,encoding){"string"==typeof encoding&&""!==encoding||(encoding="utf8");if(!Buffer.isEncoding(encoding))throw new TypeError('"encoding" must be a valid string encoding');var length=0|byteLength(string,encoding),buf=createBuffer(length),actual=buf.write(string,encoding);actual!==length&&(buf=buf.slice(0,actual));return buf}(value,encodingOrOffset):function(obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length),buf=createBuffer(len);return 0===buf.length?buf:(obj.copy(buf,0,0,len),buf)}if(obj){if(isArrayBufferView(obj)||"length"in obj)return"number"!=typeof obj.length||numberIsNaN(obj.length)?createBuffer(0):fromArrayLike(obj);if("Buffer"===obj.type&&Array.isArray(obj.data))return fromArrayLike(obj.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(value)}Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)},Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array;function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be a number');if(size<0)throw new RangeError('"size" argument must not be negative')}Buffer.alloc=function(size,fill,encoding){return function(size,fill,encoding){return assertSize(size),size<=0?createBuffer(size):void 0!==fill?"string"==typeof encoding?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill):createBuffer(size)}(size,fill,encoding)};function allocUnsafe(size){return assertSize(size),createBuffer(size<0?0:0|checked(size))}Buffer.allocUnsafe=function(size){return allocUnsafe(size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)};function fromArrayLike(array){for(var length=array.length<0?0:0|checked(array.length),buf=createBuffer(length),i=0;i<length;i+=1)buf[i]=255&array[i];return buf}function checked(length){if(length>=K_MAX_LENGTH)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|length}Buffer.isBuffer=function(b){return null!=b&&!0===b._isBuffer},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!Array.isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;++i)length+=list[i].length;var buffer=Buffer.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if(isArrayBufferView(string)||isArrayBuffer(string))return string.byteLength;"string"!=typeof string&&(string=""+string);var len=string.length;if(0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case void 0:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}Buffer.byteLength=byteLength;Buffer.prototype._isBuffer=!0;function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}Buffer.prototype.swap16=function(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function(){var length=this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):function(encoding,start,end){var loweredCase=!1;if((void 0===start||start<0)&&(start=0),start>this.length)return"";if((void 0===end||end>this.length)&&(end=this.length),end<=0)return"";if((end>>>=0)<=(start>>>=0))return"";for(encoding||(encoding="utf8");;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}.apply(this,arguments)},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target))throw new TypeError("Argument must be a Buffer");if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;if(start>=end)return 1;if(start>>>=0,end>>>=0,thisStart>>>=0,thisEnd>>>=0,this===target)return 0;for(var x=thisEnd-thisStart,y=end-start,len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):byteOffset>2147483647?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),numberIsNaN(byteOffset=+byteOffset)&&(byteOffset=dir?0:buffer.length-1),byteOffset<0&&(byteOffset=buffer.length+byteOffset),byteOffset>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,"function"==typeof Uint8Array.prototype.indexOf?dir?Uint8Array.prototype.indexOf.call(buffer,val,byteOffset):Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;indexSize=2,arrLength/=2,valLength/=2,byteOffset/=2}function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1}else for(byteOffset+valLength>arrLength&&(byteOffset=arrLength-valLength),i=byteOffset;i>=0;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length))>remaining&&(length=remaining):length=remaining;var strLen=string.length;if(strLen%2!=0)throw new TypeError("Invalid hex string");length>strLen/2&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(function(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(function(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset>>>=0,isFinite(length)?(length>>>=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&(tempCodePoint=(31&firstByte)<<6|63&secondByte)>127&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)>2047&&(tempCodePoint<55296||tempCodePoint>57343)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)>65535&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return function(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);var res="",i=0;for(;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}(res)}var MAX_ARGUMENTS_LENGTH=4096;function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0),(!end||end<0||end>len)&&(end=len);for(var out="",i=start;i<end;++i)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start,end=void 0===end?len:~~end,start<0?(start+=len)<0&&(start=0):start>len&&(start=len),end<0?(end+=len)<0&&(end=0):end>len&&(end=len),end<start&&(end=start);var newBuf=this.subarray(start,end);return newBuf.__proto__=Buffer.prototype,newBuf};function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val>=(mul*=128)&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return val>=(mul*=128)&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,byteLength>>>=0,!noAssert){checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0)}var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,byteLength>>>=0,!noAssert){checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0)}var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,255,0),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value,offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,127,-128),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24,offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,4),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,8),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&end<start&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var i,len=end-start;if(this===target&&start<targetStart&&targetStart<end)for(i=len-1;i>=0;--i)target[i+targetStart]=this[i+start];else if(len<1e3)for(i=0;i<len;++i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),1===val.length){var code=val.charCodeAt(0);code<256&&(val=code)}if(void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding)}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0);var i;if("number"==typeof val)for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:new Buffer(val,encoding),len=bytes.length;for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function toHex(n){return n<16?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if((codePoint=string.charCodeAt(i))>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function base64ToBytes(str){return base64.toByteArray(function(str){if((str=str.trim().replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str}(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isArrayBuffer(obj){return obj instanceof ArrayBuffer||null!=obj&&null!=obj.constructor&&"ArrayBuffer"===obj.constructor.name&&"number"==typeof obj.byteLength}function isArrayBufferView(obj){return"function"==typeof ArrayBuffer.isView&&ArrayBuffer.isView(obj)}function numberIsNaN(obj){return obj!=obj}},{"base64-js":147,ieee754:350}],270:[function(require,module,exports){"use strict";var encoding=require("./encoding"),EncodingError=require("./error"),BufferReader=require("./reader"),BufferWriter=require("./writer"),StaticWriter=require("./staticwriter"),SizeWriter=require("./sizewriter"),HashWriter=require("./hashwriter");exports.encoding=encoding,exports.EncodingError=EncodingError,exports.BufferReader=BufferReader,exports.BufferWriter=BufferWriter,exports.StaticWriter=StaticWriter,exports.SizeWriter=SizeWriter,exports.HashWriter=HashWriter,exports.read=function(data,zeroCopy){return new BufferReader(data,zeroCopy)},exports.write=function(size){return null!=size?new StaticWriter(size):new BufferWriter},exports.pool=function(size){return StaticWriter.pool(size)},exports.size=function(_size){return new SizeWriter(_size)},exports.hash=function(ctx){return new HashWriter(ctx)}},{"./encoding":271,"./error":272,"./hashwriter":273,"./reader":274,"./sizewriter":275,"./staticwriter":276,"./writer":277}],271:[function(require,module,exports){(function(Buffer){"use strict";var _require=require("n64"),U64=_require.U64,I64=_require.I64,EncodingError=require("./error"),BASE128_MAX=U64.UINT64_MAX.shrn(7),MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER,encoding=exports;encoding.readU64=function(data,off){var hi=data.readUInt32LE(off+4,!0),lo=data.readUInt32LE(off,!0);return enforce(0==(4292870144&hi),off,"Number exceeds 2^53-1"),4294967296*hi+lo},encoding.readU64BE=function(data,off){var hi=data.readUInt32BE(off,!0),lo=data.readUInt32BE(off+4,!0);return enforce(0==(4292870144&hi),off,"Number exceeds 2^53-1"),4294967296*hi+lo},encoding.readI64=function(data,off){var hi=data.readInt32LE(off+4,!0),lo=data.readUInt32LE(off,!0);return enforce(isSafe(hi,lo),"Number exceeds 2^53-1"),4294967296*hi+lo},encoding.readI64BE=function(data,off){var hi=data.readInt32BE(off,!0),lo=data.readUInt32BE(off+4,!0);return enforce(isSafe(hi,lo),"Number exceeds 2^53-1"),4294967296*hi+lo},encoding.writeU64=function(dst,num,off){return write64(dst,num,off,!1)},encoding.writeU64BE=function(dst,num,off){return write64(dst,num,off,!0)},encoding.writeI64=function(dst,num,off){return write64(dst,num,off,!1)},encoding.writeI64BE=function(dst,num,off){return write64(dst,num,off,!0)},encoding.readU64N=function(data,off){return U64.readLE(data,off)},encoding.readU64BEN=function(data,off){return U64.readBE(data,off)},encoding.readI64N=function(data,off){return I64.readLE(data,off)},encoding.readI64BEN=function(data,off){return I64.readBE(data,off)},encoding.writeU64N=function(dst,num,off){return enforce(!num.sign,off,"Signed"),num.writeLE(dst,off)},encoding.writeU64BEN=function(dst,num,off){return enforce(!num.sign,off,"Signed"),num.writeBE(dst,off)},encoding.writeI64N=function(dst,num,off){return enforce(num.sign,off,"Not signed"),num.writeLE(dst,off)},encoding.writeI64BEN=function(dst,num,off){return enforce(num.sign,off,"Not signed"),num.writeBE(dst,off)},encoding.readVarint=function(data,off){var value=void 0,size=void 0;switch(check(off<data.length,off),data[off]){case 255:check(off+(size=9)<=data.length,off),enforce((value=encoding.readU64(data,off+1))>4294967295,off,"Non-canonical varint");break;case 254:check(off+(size=5)<=data.length,off),enforce((value=data.readUInt32LE(off+1,!0))>65535,off,"Non-canonical varint");break;case 253:check(off+(size=3)<=data.length,off),enforce((value=data[off+1]|data[off+2]<<8)>=253,off,"Non-canonical varint");break;default:size=1,value=data[off]}return new Varint(size,value)},encoding.writeVarint=function(dst,num,off){return num<253?(dst[off++]=255&num,off):num<=65535?(dst[off++]=253,dst[off++]=255&num,dst[off++]=num>>8&255,off):num<=4294967295?(dst[off++]=254,dst[off++]=255&num,dst[off++]=num>>8&255,dst[off++]=num>>16&255,dst[off++]=num>>>24,off):(dst[off++]=255,off=encoding.writeU64(dst,num,off))},encoding.sizeVarint=function(num){return num<253?1:num<=65535?3:num<=4294967295?5:9},encoding.readVarintN=function(data,off){if(check(off<data.length,off),255===data[off]){check(off+9<=data.length,off);var _value=encoding.readU64N(data,off+1);return enforce(0!==_value.hi,off,"Non-canonical varint"),new Varint(9,_value)}var _encoding$readVarint=encoding.readVarint(data,off),size=_encoding$readVarint.size,value=_encoding$readVarint.value;return new Varint(size,U64.fromInt(value))},encoding.writeVarintN=function(dst,num,off){return enforce(!num.sign,off,"Signed"),0!==num.hi?(dst[off++]=255,encoding.writeU64N(dst,num,off)):encoding.writeVarint(dst,num.toInt(),off)},encoding.sizeVarintN=function(num){return enforce(!num.sign,0,"Signed"),0!==num.hi?9:encoding.sizeVarint(num.toInt())},encoding.readVarint2=function(data,off){for(var num=0,size=0;;){check(off<data.length,off);var ch=data[off++];if(size+=1,enforce(num<=70368744177663-(127&ch),off,"Number exceeds 2^53-1"),num=128*num+(127&ch),0==(128&ch))break;enforce(num!==MAX_SAFE_INTEGER,off,"Number exceeds 2^53-1"),num+=1}return new Varint(size,num)},encoding.writeVarint2=function(dst,num,off){for(var tmp=[],len=0;tmp[len]=127&num|(len?128:0),!(num<=127);)num=(num-num%128)/128-1,len+=1;check(off+len+1<=dst.length,off);do{dst[off++]=tmp[len]}while(len--);return off},encoding.sizeVarint2=function(num){for(var size=0;size+=1,!(num<=127);)num=(num-num%128)/128-1;return size},encoding.readVarint2N=function(data,off){for(var num=new U64,size=0;;){check(off<data.length,off);var ch=data[off++];if(size+=1,enforce(num.lte(BASE128_MAX),off,"Number exceeds 2^64-1"),num.ishln(7).iorn(127&ch),0==(128&ch))break;enforce(!num.eq(U64.UINT64_MAX),off,"Number exceeds 2^64-1"),num.iaddn(1)}return new Varint(size,num)},encoding.writeVarint2N=function(dst,num,off){if(enforce(!num.sign,off,"Signed"),0===num.hi)return encoding.writeVarint2(dst,num.toInt(),off);num=num.clone();for(var tmp=[],len=0;tmp[len]=num.andln(127)|(len?128:0),!num.lten(127);)num.ishrn(7).isubn(1),len+=1;enforce(off+len+1<=dst.length,off,"Out of bounds write");do{dst[off++]=tmp[len]}while(len--);return off},encoding.sizeVarint2N=function(num){if(enforce(!num.sign,0,"Signed"),0===num.hi)return encoding.sizeVarint2(num.toInt());num=num.clone();for(var size=0;size+=1,!num.lten(127);)num.ishrn(7).isubn(1);return size},encoding.sizeVarBytes=function(data){return encoding.sizeVarint(data.length)+data.length},encoding.sizeVarlen=function(len){return encoding.sizeVarint(len)+len},encoding.sizeVarString=function(str,enc){if("string"!=typeof str)return encoding.sizeVarBytes(str);var len=Buffer.byteLength(str,enc);return encoding.sizeVarint(len)+len};function isSafe(hi,lo){return hi<0&&(hi=~hi,0===lo&&(hi+=1)),0==(4292870144&hi)}function write64(dst,num,off,be){var neg=!1;num<0&&(num=-num,neg=!0);var hi=num*(1/4294967296)|0,lo=0|num;return neg&&(0===lo?hi=1+~hi|0:(hi=~hi,lo=1+~lo)),be?(off=dst.writeInt32BE(hi,off,!0),off=dst.writeInt32BE(lo,off,!0)):(off=dst.writeInt32LE(lo,off,!0),off=dst.writeInt32LE(hi,off,!0)),off}var Varint=function Varint(size,value){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Varint),this.size=size,this.value=value};function check(value,offset){if(!value)throw new EncodingError(offset,"Out of bounds read",check)}function enforce(value,offset,reason){if(!value)throw new EncodingError(offset,reason,enforce)}}).call(this,require("buffer").Buffer)},{"./error":272,buffer:269,n64:360}],272:[function(require,module,exports){"use strict";var EncodingError=function(_Error){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(EncodingError,_Error);function EncodingError(offset,reason,start){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,EncodingError);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Error.call(this));return _this.type="EncodingError",_this.message=reason+" (offset="+offset+").",Error.captureStackTrace&&Error.captureStackTrace(_this,start||EncodingError),_this}return EncodingError}(Error);module.exports=EncodingError},{}],273:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),encoding=require("./encoding"),POOL0=Buffer.allocUnsafe(0),POOL8=Buffer.allocUnsafe(1),POOL16=Buffer.allocUnsafe(2),POOL24=Buffer.allocUnsafe(3),POOL32=Buffer.allocUnsafe(4),POOL40=Buffer.allocUnsafe(5),POOL48=Buffer.allocUnsafe(6),POOL56=Buffer.allocUnsafe(7),POOL64=Buffer.allocUnsafe(8),POOL72=Buffer.allocUnsafe(9),POOL256=Buffer.allocUnsafe(32),poolBySize=[POOL0,POOL8,POOL16,POOL24,POOL32,POOL40,POOL48,POOL56,POOL64,POOL72],HashWriter=function(){function HashWriter(ctx){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HashWriter),assert(ctx),this.ctx=ctx}return HashWriter.prototype.init=function(){var _ctx;return(_ctx=this.ctx).init.apply(_ctx,arguments)},HashWriter.prototype.update=function(data){return this.ctx.update(data)},HashWriter.prototype.final=function(){return this.ctx.digest?this.ctx.digest():this.ctx.final()},HashWriter.prototype.render=function(){return this.final()},HashWriter.prototype.getSize=function(){throw new Error("Not available.")},HashWriter.prototype.seek=function(offset){throw new Error("Not available.")},HashWriter.prototype.destroy=function(){throw new Error("Not available.")},HashWriter.prototype.writeU8=function(value){return POOL8.writeUInt8(value,0,!0),this.ctx.update(POOL8),this},HashWriter.prototype.writeU16=function(value){return POOL16.writeUInt16LE(value,0,!0),this.ctx.update(POOL16),this},HashWriter.prototype.writeU16BE=function(value){return POOL16.writeUInt16BE(value,0,!0),this.ctx.update(POOL16),this},HashWriter.prototype.writeU32=function(value){return POOL32.writeUInt32LE(value,0,!0),this.ctx.update(POOL32),this},HashWriter.prototype.writeU32BE=function(value){return POOL32.writeUInt32BE(value,0,!0),this.ctx.update(POOL32),this},HashWriter.prototype.writeU64=function(value){return encoding.writeU64(POOL64,value,0),this.ctx.update(POOL64),this},HashWriter.prototype.writeU64BE=function(value){return encoding.writeU64BE(POOL64,value,0),this.ctx.update(POOL64),this},HashWriter.prototype.writeU64N=function(value){return encoding.writeU64N(POOL64,value,0),this.ctx.update(POOL64),this},HashWriter.prototype.writeU64BEN=function(value){return encoding.writeU64BEN(POOL64,value,0),this.ctx.update(POOL64),this},HashWriter.prototype.writeI8=function(value){return POOL8.writeInt8(value,0,!0),this.ctx.update(POOL8),this},HashWriter.prototype.writeI16=function(value){return POOL16.writeInt16LE(value,0,!0),this.ctx.update(POOL16),this},HashWriter.prototype.writeI16BE=function(value){return POOL16.writeInt16BE(value,0,!0),this.ctx.update(POOL16),this},HashWriter.prototype.writeI32=function(value){return POOL32.writeInt32LE(value,0,!0),this.ctx.update(POOL32),this},HashWriter.prototype.writeI32BE=function(value){return POOL32.writeInt32BE(value,0,!0),this.ctx.update(POOL32),this},HashWriter.prototype.writeI64=function(value){return encoding.writeI64(POOL64,value,0),this.ctx.update(POOL64),this},HashWriter.prototype.writeI64BE=function(value){return encoding.writeI64BE(POOL64,value,0),this.ctx.update(POOL64),this},HashWriter.prototype.writeI64N=function(value){return encoding.writeI64N(POOL64,value,0),this.ctx.update(POOL64),this},HashWriter.prototype.writeI64BEN=function(value){return encoding.writeI64BEN(POOL64,value,0),this.ctx.update(POOL64),this},HashWriter.prototype.writeFloat=function(value){return POOL32.writeFloatLE(value,0,!0),this.ctx.update(POOL32),this},HashWriter.prototype.writeFloatBE=function(value){return POOL32.writeFloatBE(value,0,!0),this.ctx.update(POOL32),this},HashWriter.prototype.writeDouble=function(value){return POOL64.writeDoubleLE(value,0,!0),this.ctx.update(POOL64),this},HashWriter.prototype.writeDoubleBE=function(value){return POOL64.writeDoubleBE(value,0,!0),this.ctx.update(POOL64),this},HashWriter.prototype.writeVarint=function(value){var size=encoding.sizeVarint(value),pool=poolBySize[size];return encoding.writeVarint(pool,value,0),this.ctx.update(pool),this},HashWriter.prototype.writeVarintN=function(value){var size=encoding.sizeVarintN(value),pool=poolBySize[size];return encoding.writeVarintN(pool,value,0),this.ctx.update(pool),this},HashWriter.prototype.writeVarint2=function(value){var size=encoding.sizeVarint2(value),pool=poolBySize[size];return encoding.writeVarint2(pool,value,0),this.ctx.update(pool),this},HashWriter.prototype.writeVarint2N=function(value){var size=encoding.sizeVarint2N(value),pool=poolBySize[size];return encoding.writeVarint2N(pool,value,0),this.ctx.update(pool),this},HashWriter.prototype.writeBytes=function(value){return this.ctx.update(value),this},HashWriter.prototype.writeVarBytes=function(value){return this.writeVarint(value.length),this.writeBytes(value),this},HashWriter.prototype.copy=function(value,start,end){return this.ctx.update(value.slice(start,end)),this},HashWriter.prototype.writeString=function(value,enc){return 0===value.length?this:("string"==typeof value&&(value=Buffer.from(value,enc)),this.ctx.update(value),this)},HashWriter.prototype.writeHash=function(value){return"string"!=typeof value?(assert(32===value.length),this.writeBytes(value),this):(assert(64===value.length),POOL256.write(value,0,"hex"),this.ctx.update(POOL256),this)},HashWriter.prototype.writeVarString=function(value,enc){if(0===value.length)return this.writeVarint(0),this;var size=Buffer.byteLength(value,enc);return this.writeVarint(size),this.ctx.update(value,enc),this},HashWriter.prototype.writeNullString=function(value,enc){return this.writeString(value,enc),this.writeU8(0),this},HashWriter.prototype.writeChecksum=function(){throw new Error("Not available.")},HashWriter.prototype.fill=function(value,size){if(assert(size>=0),0===size)return this;if(size<=32){var _data=POOL256.slice(0,size);return _data.fill(value),this.ctx.update(_data),this}var data=Buffer.allocUnsafe(size);return data.fill(value),this.ctx.update(data),this},HashWriter}();module.exports=HashWriter}).call(this,require("buffer").Buffer)},{"./encoding":271,assert:146,buffer:269}],274:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),encoding=require("./encoding"),EncodingError=require("./error"),EMPTY=Buffer.alloc(0),BufferReader=function(){function BufferReader(data,zeroCopy){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BufferReader),assert(Buffer.isBuffer(data),"Must pass a Buffer."),this.data=data,this.offset=0,this.zeroCopy=zeroCopy||!1,this.stack=[]}return BufferReader.prototype.assert=function(value){if(!value)throw new EncodingError(this.offset,"Out of bounds read",this.assert)},BufferReader.prototype.enforce=function(value,reason){if(!value)throw new EncodingError(this.offset,reason,this.enforce)},BufferReader.prototype.getSize=function(){return this.data.length},BufferReader.prototype.left=function(){return this.assert(this.offset<=this.data.length),this.data.length-this.offset},BufferReader.prototype.seek=function(off){return this.assert(this.offset+off>=0),this.assert(this.offset+off<=this.data.length),this.offset+=off,off},BufferReader.prototype.start=function(){return this.stack.push(this.offset),this.offset},BufferReader.prototype.end=function(){assert(this.stack.length>0);var start=this.stack.pop();return this.offset-start},BufferReader.prototype.endData=function(zeroCopy){assert(this.stack.length>0);var start=this.stack.pop(),end=this.offset,size=end-start,data=this.data;if(size===data.length)return data;if(this.zeroCopy||zeroCopy)return data.slice(start,end);var ret=Buffer.allocUnsafe(size);return data.copy(ret,0,start,end),ret},BufferReader.prototype.destroy=function(){this.data=EMPTY,this.offset=0,this.stack.length=0},BufferReader.prototype.readU8=function(){this.assert(this.offset+1<=this.data.length);var ret=this.data[this.offset];return this.offset+=1,ret},BufferReader.prototype.readU16=function(){this.assert(this.offset+2<=this.data.length);var ret=this.data.readUInt16LE(this.offset,!0);return this.offset+=2,ret},BufferReader.prototype.readU16BE=function(){this.assert(this.offset+2<=this.data.length);var ret=this.data.readUInt16BE(this.offset,!0);return this.offset+=2,ret},BufferReader.prototype.readU32=function(){this.assert(this.offset+4<=this.data.length);var ret=this.data.readUInt32LE(this.offset,!0);return this.offset+=4,ret},BufferReader.prototype.readU32BE=function(){this.assert(this.offset+4<=this.data.length);var ret=this.data.readUInt32BE(this.offset,!0);return this.offset+=4,ret},BufferReader.prototype.readU64=function(){this.assert(this.offset+8<=this.data.length);var ret=encoding.readU64(this.data,this.offset);return this.offset+=8,ret},BufferReader.prototype.readU64BE=function(){this.assert(this.offset+8<=this.data.length);var ret=encoding.readU64BE(this.data,this.offset);return this.offset+=8,ret},BufferReader.prototype.readI8=function(){this.assert(this.offset+1<=this.data.length);var ret=this.data.readInt8(this.offset,!0);return this.offset+=1,ret},BufferReader.prototype.readI16=function(){this.assert(this.offset+2<=this.data.length);var ret=this.data.readInt16LE(this.offset,!0);return this.offset+=2,ret},BufferReader.prototype.readI16BE=function(){this.assert(this.offset+2<=this.data.length);var ret=this.data.readInt16BE(this.offset,!0);return this.offset+=2,ret},BufferReader.prototype.readI32=function(){this.assert(this.offset+4<=this.data.length);var ret=this.data.readInt32LE(this.offset,!0);return this.offset+=4,ret},BufferReader.prototype.readI32BE=function(){this.assert(this.offset+4<=this.data.length);var ret=this.data.readInt32BE(this.offset,!0);return this.offset+=4,ret},BufferReader.prototype.readI64=function(){this.assert(this.offset+8<=this.data.length);var ret=encoding.readI64(this.data,this.offset);return this.offset+=8,ret},BufferReader.prototype.readI64BE=function(){this.assert(this.offset+8<=this.data.length);var ret=encoding.readI64BE(this.data,this.offset);return this.offset+=8,ret},BufferReader.prototype.readU64N=function(){this.assert(this.offset+8<=this.data.length);var ret=encoding.readU64N(this.data,this.offset);return this.offset+=8,ret},BufferReader.prototype.readU64BEN=function(){this.assert(this.offset+8<=this.data.length);var ret=encoding.readU64BEN(this.data,this.offset);return this.offset+=8,ret},BufferReader.prototype.readI64N=function(){this.assert(this.offset+8<=this.data.length);var ret=encoding.readI64N(this.data,this.offset);return this.offset+=8,ret},BufferReader.prototype.readI64BEN=function(){this.assert(this.offset+8<=this.data.length);var ret=encoding.readI64BEN(this.data,this.offset);return this.offset+=8,ret},BufferReader.prototype.readFloat=function(){this.assert(this.offset+4<=this.data.length);var ret=this.data.readFloatLE(this.offset,!0);return this.offset+=4,ret},BufferReader.prototype.readFloatBE=function(){this.assert(this.offset+4<=this.data.length);var ret=this.data.readFloatBE(this.offset,!0);return this.offset+=4,ret},BufferReader.prototype.readDouble=function(){this.assert(this.offset+8<=this.data.length);var ret=this.data.readDoubleLE(this.offset,!0);return this.offset+=8,ret},BufferReader.prototype.readDoubleBE=function(){this.assert(this.offset+8<=this.data.length);var ret=this.data.readDoubleBE(this.offset,!0);return this.offset+=8,ret},BufferReader.prototype.readVarint=function(){var _encoding$readVarint=encoding.readVarint(this.data,this.offset),size=_encoding$readVarint.size,value=_encoding$readVarint.value;return this.offset+=size,value},BufferReader.prototype.readVarintN=function(){var _encoding$readVarintN=encoding.readVarintN(this.data,this.offset),size=_encoding$readVarintN.size,value=_encoding$readVarintN.value;return this.offset+=size,value},BufferReader.prototype.readVarint2=function(){var _encoding$readVarint2=encoding.readVarint2(this.data,this.offset),size=_encoding$readVarint2.size,value=_encoding$readVarint2.value;return this.offset+=size,value},BufferReader.prototype.readVarint2N=function(){var _encoding$readVarint3=encoding.readVarint2N(this.data,this.offset),size=_encoding$readVarint3.size,value=_encoding$readVarint3.value;return this.offset+=size,value},BufferReader.prototype.readBytes=function(size,zeroCopy){assert(size>=0),this.assert(this.offset+size<=this.data.length);var ret=void 0;return this.zeroCopy||zeroCopy?ret=this.data.slice(this.offset,this.offset+size):(ret=Buffer.allocUnsafe(size),this.data.copy(ret,0,this.offset,this.offset+size)),this.offset+=size,ret},BufferReader.prototype.readVarBytes=function(zeroCopy){return this.readBytes(this.readVarint(),zeroCopy)},BufferReader.prototype.readString=function(enc,size){assert(size>=0),this.assert(this.offset+size<=this.data.length);var ret=this.data.toString(enc,this.offset,this.offset+size);return this.offset+=size,ret},BufferReader.prototype.readHash=function(enc){return enc?this.readString(enc,32):this.readBytes(32)},BufferReader.prototype.readVarString=function(enc,limit){var size=this.readVarint();return this.enforce(!limit||size<=limit,"String exceeds limit."),this.readString(enc,size)},BufferReader.prototype.readNullString=function(enc){this.assert(this.offset+1<=this.data.length);for(var i=this.offset;i<this.data.length&&0!==this.data[i];i++);this.assert(i!==this.data.length);var ret=this.readString(enc,i-this.offset);return this.offset=i+1,ret},BufferReader.prototype.createChecksum=function(hash){var start=0;this.stack.length>0&&(start=this.stack[this.stack.length-1]);return hash(this.data.slice(start,this.offset)).readUInt32LE(0,!0)},BufferReader.prototype.verifyChecksum=function(hash){var chk=this.createChecksum(hash),checksum=this.readU32();return this.enforce(chk===checksum,"Checksum mismatch."),checksum},BufferReader}();module.exports=BufferReader}).call(this,require("buffer").Buffer)},{"./encoding":271,"./error":272,assert:146,buffer:269}],275:[function(require,module,exports){(function(Buffer){"use strict";var encoding=require("./encoding"),SizeWriter=function(){function SizeWriter(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SizeWriter),this.offset=0}return SizeWriter.prototype.render=function(){var size=this.offset;return this.destroy(),size},SizeWriter.prototype.getSize=function(){return this.offset},SizeWriter.prototype.seek=function(offset){return this.offset+=offset,this},SizeWriter.prototype.destroy=function(){return this.offset=0,this},SizeWriter.prototype.writeU8=function(value){return this.offset+=1,this},SizeWriter.prototype.writeU16=function(value){return this.offset+=2,this},SizeWriter.prototype.writeU16BE=function(value){return this.offset+=2,this},SizeWriter.prototype.writeU32=function(value){return this.offset+=4,this},SizeWriter.prototype.writeU32BE=function(value){return this.offset+=4,this},SizeWriter.prototype.writeU64=function(value){return this.offset+=8,this},SizeWriter.prototype.writeU64BE=function(value){return this.offset+=8,this},SizeWriter.prototype.writeU64N=function(value){return this.offset+=8,this},SizeWriter.prototype.writeU64BEN=function(value){return this.offset+=8,this},SizeWriter.prototype.writeI8=function(value){return this.offset+=1,this},SizeWriter.prototype.writeI16=function(value){return this.offset+=2,this},SizeWriter.prototype.writeI16BE=function(value){return this.offset+=2,this},SizeWriter.prototype.writeI32=function(value){return this.offset+=4,this},SizeWriter.prototype.writeI32BE=function(value){return this.offset+=4,this},SizeWriter.prototype.writeI64=function(value){return this.offset+=8,this},SizeWriter.prototype.writeI64BE=function(value){return this.offset+=8,this},SizeWriter.prototype.writeI64N=function(value){return this.offset+=8,this},SizeWriter.prototype.writeI64BEN=function(value){return this.offset+=8,this},SizeWriter.prototype.writeFloat=function(value){return this.offset+=4,this},SizeWriter.prototype.writeFloatBE=function(value){return this.offset+=4,this},SizeWriter.prototype.writeDouble=function(value){return this.offset+=8,this},SizeWriter.prototype.writeDoubleBE=function(value){return this.offset+=8,this},SizeWriter.prototype.writeVarint=function(value){return this.offset+=encoding.sizeVarint(value),this},SizeWriter.prototype.writeVarintN=function(value){return this.offset+=encoding.sizeVarintN(value),this},SizeWriter.prototype.writeVarint2=function(value){return this.offset+=encoding.sizeVarint2(value),this},SizeWriter.prototype.writeVarint2N=function(value){return this.offset+=encoding.sizeVarint2N(value),this},SizeWriter.prototype.writeBytes=function(value){return this.offset+=value.length,this},SizeWriter.prototype.writeVarBytes=function(value){return this.writeVarint(value.length),this.writeBytes(value),this},SizeWriter.prototype.copy=function(value,start,end){return this.offset+=end-start,this},SizeWriter.prototype.writeString=function(value,enc){return 0===value.length?this:(this.offset+=Buffer.byteLength(value,enc),this)},SizeWriter.prototype.writeHash=function(value){return this.offset+=32,this},SizeWriter.prototype.writeVarString=function(value,enc){if(0===value.length)return this.offset+=1,this;var size=Buffer.byteLength(value,enc);return this.writeVarint(size),this.offset+=size,this},SizeWriter.prototype.writeNullString=function(value,enc){return this.writeString(value,enc),this.writeU8(0),this},SizeWriter.prototype.writeChecksum=function(hash){return this.offset+=4,this},SizeWriter.prototype.fill=function(value,size){return this.offset+=size,this},SizeWriter}();module.exports=SizeWriter}).call(this,require("buffer").Buffer)},{"./encoding":271,buffer:269}],276:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),encoding=require("./encoding"),EMPTY=Buffer.alloc(0),POOL=null,StaticWriter=function(){function StaticWriter(){var size=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,StaticWriter),this.data=size?Buffer.allocUnsafe(size):EMPTY,this.offset=0}return StaticWriter.pool=function(size){if(size<=102400){POOL||(POOL=Buffer.allocUnsafeSlow(102400));var bw=new StaticWriter;return bw.data=POOL.slice(0,size),bw}return new StaticWriter(size)},StaticWriter.prototype.render=function(){var data=this.data;return assert(this.offset===data.length),this.destroy(),data},StaticWriter.prototype.getSize=function(){return this.offset},StaticWriter.prototype.seek=function(offset){return this.offset+=offset,this},StaticWriter.prototype.destroy=function(){return this.data=EMPTY,this.offset=0,this},StaticWriter.prototype.writeU8=function(value){return this.offset=this.data.writeUInt8(value,this.offset,!0),this},StaticWriter.prototype.writeU16=function(value){return this.offset=this.data.writeUInt16LE(value,this.offset,!0),this},StaticWriter.prototype.writeU16BE=function(value){return this.offset=this.data.writeUInt16BE(value,this.offset,!0),this},StaticWriter.prototype.writeU32=function(value){return this.offset=this.data.writeUInt32LE(value,this.offset,!0),this},StaticWriter.prototype.writeU32BE=function(value){return this.offset=this.data.writeUInt32BE(value,this.offset,!0),this},StaticWriter.prototype.writeU64=function(value){return this.offset=encoding.writeU64(this.data,value,this.offset),this},StaticWriter.prototype.writeU64BE=function(value){return this.offset=encoding.writeU64BE(this.data,value,this.offset),this},StaticWriter.prototype.writeU64N=function(value){return this.offset=encoding.writeU64N(this.data,value,this.offset),this},StaticWriter.prototype.writeU64BEN=function(value){return this.offset=encoding.writeU64BEN(this.data,value,this.offset),this},StaticWriter.prototype.writeI8=function(value){return this.offset=this.data.writeInt8(value,this.offset,!0),this},StaticWriter.prototype.writeI16=function(value){return this.offset=this.data.writeInt16LE(value,this.offset,!0),this},StaticWriter.prototype.writeI16BE=function(value){return this.offset=this.data.writeInt16BE(value,this.offset,!0),this},StaticWriter.prototype.writeI32=function(value){return this.offset=this.data.writeInt32LE(value,this.offset,!0),this},StaticWriter.prototype.writeI32BE=function(value){return this.offset=this.data.writeInt32BE(value,this.offset,!0),this},StaticWriter.prototype.writeI64=function(value){return this.offset=encoding.writeI64(this.data,value,this.offset),this},StaticWriter.prototype.writeI64BE=function(value){return this.offset=encoding.writeI64BE(this.data,value,this.offset),this},StaticWriter.prototype.writeI64N=function(value){return this.offset=encoding.writeI64N(this.data,value,this.offset),this},StaticWriter.prototype.writeI64BEN=function(value){return this.offset=encoding.writeI64BEN(this.data,value,this.offset),this},StaticWriter.prototype.writeFloat=function(value){return this.offset=this.data.writeFloatLE(value,this.offset,!0),this},StaticWriter.prototype.writeFloatBE=function(value){return this.offset=this.data.writeFloatBE(value,this.offset,!0),this},StaticWriter.prototype.writeDouble=function(value){return this.offset=this.data.writeDoubleLE(value,this.offset,!0),this},StaticWriter.prototype.writeDoubleBE=function(value){return this.offset=this.data.writeDoubleBE(value,this.offset,!0),this},StaticWriter.prototype.writeVarint=function(value){return this.offset=encoding.writeVarint(this.data,value,this.offset),this},StaticWriter.prototype.writeVarintN=function(value){return this.offset=encoding.writeVarintN(this.data,value,this.offset),this},StaticWriter.prototype.writeVarint2=function(value){return this.offset=encoding.writeVarint2(this.data,value,this.offset),this},StaticWriter.prototype.writeVarint2N=function(value){return this.offset=encoding.writeVarint2N(this.data,value,this.offset),this},StaticWriter.prototype.writeBytes=function(value){return 0===value.length?this:(value.copy(this.data,this.offset),this.offset+=value.length,this)},StaticWriter.prototype.writeVarBytes=function(value){return this.writeVarint(value.length),this.writeBytes(value),this},StaticWriter.prototype.copy=function(value,start,end){var len=end-start;return 0===len?this:(value.copy(this.data,this.offset,start,end),this.offset+=len,this)},StaticWriter.prototype.writeString=function(value,enc){if(0===value.length)return this;var size=Buffer.byteLength(value,enc);return this.data.write(value,this.offset,enc),this.offset+=size,this},StaticWriter.prototype.writeHash=function(value){return"string"!=typeof value?(assert(32===value.length),this.writeBytes(value),this):(assert(64===value.length),this.data.write(value,this.offset,"hex"),this.offset+=32,this)},StaticWriter.prototype.writeVarString=function(value,enc){if(0===value.length)return this.writeVarint(0),this;var size=Buffer.byteLength(value,enc);return this.writeVarint(size),this.data.write(value,this.offset,enc),this.offset+=size,this},StaticWriter.prototype.writeNullString=function(value,enc){return this.writeString(value,enc),this.writeU8(0),this},StaticWriter.prototype.writeChecksum=function(hash){return hash(this.data.slice(0,this.offset)).copy(this.data,this.offset,0,4),this.offset+=4,this},StaticWriter.prototype.fill=function(value,size){return assert(size>=0),0===size?this:(this.data.fill(value,this.offset,this.offset+size),this.offset+=size,this)},StaticWriter}();module.exports=StaticWriter}).call(this,require("buffer").Buffer)},{"./encoding":271,assert:146,buffer:269}],277:[function(require,module,exports){(function(Buffer){"use strict";function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),encoding=require("./encoding"),BufferWriter=function(){function BufferWriter(){_classCallCheck(this,BufferWriter),this.ops=[],this.offset=0}return BufferWriter.prototype.render=function(){var data=Buffer.allocUnsafe(this.offset),off=0,_iterator=this.ops,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var op=_ref;switch(op.type){case 0:off+=op.value;break;case 1:off=data.writeUInt8(op.value,off,!0);break;case 2:off=data.writeUInt16LE(op.value,off,!0);break;case 3:off=data.writeUInt16BE(op.value,off,!0);break;case 4:off=data.writeUInt32LE(op.value,off,!0);break;case 5:off=data.writeUInt32BE(op.value,off,!0);break;case 6:off=encoding.writeU64(data,op.value,off);break;case 7:off=encoding.writeU64BE(data,op.value,off);break;case 8:off=encoding.writeU64N(data,op.value,off);break;case 9:off=encoding.writeU64BEN(data,op.value,off);break;case 10:off=data.writeInt8(op.value,off,!0);break;case 11:off=data.writeInt16LE(op.value,off,!0);break;case 12:off=data.writeInt16BE(op.value,off,!0);break;case 13:off=data.writeInt32LE(op.value,off,!0);break;case 14:off=data.writeInt32BE(op.value,off,!0);break;case 15:off=encoding.writeI64(data,op.value,off);break;case 16:off=encoding.writeI64BE(data,op.value,off);break;case 17:off=encoding.writeI64N(data,op.value,off);break;case 18:off=encoding.writeI64BEN(data,op.value,off);break;case 19:off=data.writeFloatLE(op.value,off,!0);break;case 20:off=data.writeFloatBE(op.value,off,!0);break;case 21:off=data.writeDoubleLE(op.value,off,!0);break;case 22:off=data.writeDoubleBE(op.value,off,!0);break;case 23:off=encoding.writeVarint(data,op.value,off);break;case 24:off=encoding.writeVarintN(data,op.value,off);break;case 25:off=encoding.writeVarint2(data,op.value,off);break;case 26:off=encoding.writeVarint2N(data,op.value,off);break;case 27:off+=op.data.copy(data,off);break;case 28:off+=data.write(op.value,off,op.enc);break;case 29:off+=op.func(data.slice(0,off)).copy(data,off,0,4);break;case 30:data.fill(op.value,off,off+op.size),off+=op.size;break;default:assert(!1,"Bad type.")}}return assert(off===data.length),this.destroy(),data},BufferWriter.prototype.getSize=function(){return this.offset},BufferWriter.prototype.seek=function(offset){return this.offset+=offset,this.ops.push(new NumberOp(0,offset)),this},BufferWriter.prototype.destroy=function(){return this.ops.length=0,this.offset=0,this},BufferWriter.prototype.writeU8=function(value){return this.offset+=1,this.ops.push(new NumberOp(1,value)),this},BufferWriter.prototype.writeU16=function(value){return this.offset+=2,this.ops.push(new NumberOp(2,value)),this},BufferWriter.prototype.writeU16BE=function(value){return this.offset+=2,this.ops.push(new NumberOp(3,value)),this},BufferWriter.prototype.writeU32=function(value){return this.offset+=4,this.ops.push(new NumberOp(4,value)),this},BufferWriter.prototype.writeU32BE=function(value){return this.offset+=4,this.ops.push(new NumberOp(5,value)),this},BufferWriter.prototype.writeU64=function(value){return this.offset+=8,this.ops.push(new NumberOp(6,value)),this},BufferWriter.prototype.writeU64BE=function(value){return this.offset+=8,this.ops.push(new NumberOp(7,value)),this},BufferWriter.prototype.writeU64N=function(value){return this.offset+=8,this.ops.push(new NumberOp(8,value)),this},BufferWriter.prototype.writeU64BEN=function(value){return this.offset+=8,this.ops.push(new NumberOp(9,value)),this},BufferWriter.prototype.writeI8=function(value){return this.offset+=1,this.ops.push(new NumberOp(10,value)),this},BufferWriter.prototype.writeI16=function(value){return this.offset+=2,this.ops.push(new NumberOp(11,value)),this},BufferWriter.prototype.writeI16BE=function(value){return this.offset+=2,this.ops.push(new NumberOp(12,value)),this},BufferWriter.prototype.writeI32=function(value){return this.offset+=4,this.ops.push(new NumberOp(13,value)),this},BufferWriter.prototype.writeI32BE=function(value){return this.offset+=4,this.ops.push(new NumberOp(14,value)),this},BufferWriter.prototype.writeI64=function(value){return this.offset+=8,this.ops.push(new NumberOp(15,value)),this},BufferWriter.prototype.writeI64BE=function(value){return this.offset+=8,this.ops.push(new NumberOp(16,value)),this},BufferWriter.prototype.writeI64N=function(value){return this.offset+=8,this.ops.push(new NumberOp(17,value)),this},BufferWriter.prototype.writeI64BEN=function(value){return this.offset+=8,this.ops.push(new NumberOp(18,value)),this},BufferWriter.prototype.writeFloat=function(value){return this.offset+=4,this.ops.push(new NumberOp(19,value)),this},BufferWriter.prototype.writeFloatBE=function(value){return this.offset+=4,this.ops.push(new NumberOp(20,value)),this},BufferWriter.prototype.writeDouble=function(value){return this.offset+=8,this.ops.push(new NumberOp(21,value)),this},BufferWriter.prototype.writeDoubleBE=function(value){return this.offset+=8,this.ops.push(new NumberOp(22,value)),this},BufferWriter.prototype.writeVarint=function(value){return this.offset+=encoding.sizeVarint(value),this.ops.push(new NumberOp(23,value)),this},BufferWriter.prototype.writeVarintN=function(value){return this.offset+=encoding.sizeVarintN(value),this.ops.push(new NumberOp(24,value)),this},BufferWriter.prototype.writeVarint2=function(value){return this.offset+=encoding.sizeVarint2(value),this.ops.push(new NumberOp(25,value)),this},BufferWriter.prototype.writeVarint2N=function(value){return this.offset+=encoding.sizeVarint2N(value),this.ops.push(new NumberOp(26,value)),this},BufferWriter.prototype.writeBytes=function(value){return 0===value.length?this:(this.offset+=value.length,this.ops.push(new BufferOp(27,value)),this)},BufferWriter.prototype.writeVarBytes=function(value){return this.offset+=encoding.sizeVarint(value.length),this.ops.push(new NumberOp(23,value.length)),0===value.length?this:(this.offset+=value.length,this.ops.push(new BufferOp(27,value)),this)},BufferWriter.prototype.copy=function(value,start,end){return assert(end>=start),value=value.slice(start,end),this.writeBytes(value),this},BufferWriter.prototype.writeString=function(value,enc){return 0===value.length?this:(this.offset+=Buffer.byteLength(value,enc),this.ops.push(new StringOp(28,value,enc)),this)},BufferWriter.prototype.writeHash=function(value){return"string"!=typeof value?(assert(32===value.length),this.writeBytes(value),this):(assert(64===value.length),this.writeString(value,"hex"),this)},BufferWriter.prototype.writeVarString=function(value,enc){if(0===value.length)return this.ops.push(new NumberOp(23,0)),this;var size=Buffer.byteLength(value,enc);return this.offset+=encoding.sizeVarint(size),this.offset+=size,this.ops.push(new NumberOp(23,size)),this.ops.push(new StringOp(28,value,enc)),this},BufferWriter.prototype.writeNullString=function(value,enc){return this.writeString(value,enc),this.writeU8(0),this},BufferWriter.prototype.writeChecksum=function(hash){return this.offset+=4,this.ops.push(new FunctionOp(29,hash)),this},BufferWriter.prototype.fill=function(value,size){return assert(size>=0),0===size?this:(this.offset+=size,this.ops.push(new FillOp(30,value,size)),this)},BufferWriter}(),WriteOp=function WriteOp(type){_classCallCheck(this,WriteOp),this.type=type},NumberOp=function(_WriteOp){_inherits(NumberOp,_WriteOp);function NumberOp(type,value){_classCallCheck(this,NumberOp);var _this=_possibleConstructorReturn(this,_WriteOp.call(this,type));return _this.value=value,_this}return NumberOp}(WriteOp),BufferOp=function(_WriteOp2){_inherits(BufferOp,_WriteOp2);function BufferOp(type,data){_classCallCheck(this,BufferOp);var _this2=_possibleConstructorReturn(this,_WriteOp2.call(this,type));return _this2.data=data,_this2}return BufferOp}(WriteOp),StringOp=function(_WriteOp3){_inherits(StringOp,_WriteOp3);function StringOp(type,value,enc){_classCallCheck(this,StringOp);var _this3=_possibleConstructorReturn(this,_WriteOp3.call(this,type));return _this3.value=value,_this3.enc=enc,_this3}return StringOp}(WriteOp),FunctionOp=function(_WriteOp4){_inherits(FunctionOp,_WriteOp4);function FunctionOp(type,func){_classCallCheck(this,FunctionOp);var _this4=_possibleConstructorReturn(this,_WriteOp4.call(this,type));return _this4.func=func,_this4}return FunctionOp}(WriteOp),FillOp=function(_WriteOp5){_inherits(FillOp,_WriteOp5);function FillOp(type,value,size){_classCallCheck(this,FillOp);var _this5=_possibleConstructorReturn(this,_WriteOp5.call(this,type));return _this5.value=value,_this5.size=size,_this5}return FillOp}(WriteOp);module.exports=BufferWriter}).call(this,require("buffer").Buffer)},{"./encoding":271,assert:146,buffer:269}],278:[function(require,module,exports){"use strict";module.exports=require("./upnp")},{"./upnp":279}],279:[function(require,module,exports){"use strict";var UPNP=function(){function UPNP(host,port,gateway){throw function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,UPNP),new Error("UPNP not supported.")}return UPNP.discover=function(){var fn,_ref=(fn=regeneratorRuntime.mark(function _callee(host,port,gateway,targets){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:throw new Error("UPNP not supported.");case 1:case"end":return _context.stop()}},_callee,this)}),function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})});return function(_x,_x2,_x3,_x4){return _ref.apply(this,arguments)}}(),UPNP}();UPNP.unsupported=!0,module.exports=UPNP},{}],280:[function(require,module,exports){"use strict";module.exports=require("./validator")},{"./validator":281}],281:[function(require,module,exports){(function(Buffer){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var assert=require("assert"),Validator=function(){function Validator(map,loose){if(_classCallCheck(this,Validator),!map||"object"!==(void 0===map?"undefined":_typeof(map)))throw new ValidationError("map","object");this.map=map,this.loose=loose||!1}return Validator.multi=function(maps,loose){return new MultiValidator(maps,loose)},Validator.fromRequest=function(req){var query=new Validator(req.query,!0),params=new Validator(req.params,!0),body=new Validator(req.body,!1);return new MultiValidator([query,params,body])},Validator.prototype.child=function(key){return new this.constructor(this.get(key))},Validator.prototype.has=function(key){return null!=this.get(key)},Validator.prototype.get=function(key,fallback){if(void 0===fallback&&(fallback=null),Array.isArray(key)){var _iterator=key,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var _key=_ref,_value=this.get(_key);if(null!==_value)return _value}return fallback}assert("string"==typeof key||"number"==typeof key,"Key must be a string or number.");var value=this.map[key];return null!=value?value:fallback},Validator.prototype.typeOf=function(key){var value=this.get(key);return null==value?"null":void 0===value?"undefined":_typeof(value)},Validator.prototype.str=function(key,fallback){var value=this.get(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if("string"!=typeof value)throw new ValidationError(key,"number");return value},Validator.prototype.int=function(key,fallback){var value=this.get(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if("string"!=typeof value){if("number"!=typeof value)throw new ValidationError(key,"int");if(!Number.isSafeInteger(value))throw new ValidationError(key,"int");return value}if(!this.loose)throw new ValidationError(key,"int");if(!/^\-?\d+$/.test(value))throw new ValidationError(key,"int");var num=parseInt(value,10);if(!Number.isSafeInteger(num))throw new ValidationError(key,"int");return num},Validator.prototype.uint=function(key,fallback){var value=this.int(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if(value<0)throw new ValidationError(key,"uint");return value},Validator.prototype.float=function(key,fallback){var value=this.get(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if("string"!=typeof value){if("number"!=typeof value)throw new ValidationError(key,"float");if(!isFinite(value))throw new ValidationError(key,"float");return value}if(!this.loose)throw new ValidationError(key,"float");if(!/^\-?\d*(?:\.\d*)?$/.test(value))throw new ValidationError(key,"float");if(!/\d/.test(value))throw new ValidationError(key,"float");var num=parseFloat(value);if(!isFinite(num))throw new ValidationError(key,"float");return num},Validator.prototype.ufloat=function(key,fallback){var value=this.float(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if(value<0)throw new ValidationError(key,"positive float");return value},Validator.prototype.fixed=function(key,exp,fallback){var value=this.float(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;try{return function(num,exp){assert("number"==typeof num&&isFinite(num)),assert(Number.isSafeInteger(exp));var str=num.toFixed(exp),sign=1;str.length>0&&"-"===str[0]&&(str=str.substring(1),sign=-1);var hi=str,lo="0",index=str.indexOf(".");-1!==index&&(hi=str.substring(0,index),lo=str.substring(index+1));hi=hi.replace(/^0+/,""),lo=lo.replace(/0+$/,""),assert(hi.length<=16-exp,"Fixed number string exceeds 2^53-1."),assert(lo.length<=exp,"Too many decimal places in fixed number string."),0===hi.length&&(hi="0");for(;lo.length<exp;)lo+="0";0===lo.length&&(lo="0");assert(/^\d+$/.test(hi)&&/^\d+$/.test(lo),"Non-numeric characters in fixed number string."),hi=parseInt(hi,10),lo=parseInt(lo,10);var mult=Math.pow(10,exp),maxLo=Number.MAX_SAFE_INTEGER%mult,maxHi=(Number.MAX_SAFE_INTEGER-maxLo)/mult;return assert(hi<maxHi||hi===maxHi&&lo<=maxLo,"Fixed number string exceeds 2^53-1."),sign*(hi*mult+lo)}(value,exp||0)}catch(e){throw new ValidationError(key,"fixed number")}},Validator.prototype.ufixed=function(key,exp,fallback){var value=this.fixed(key,exp);if(void 0===fallback&&(fallback=null),null===value)return fallback;if(value<0)throw new ValidationError(key,"positive fixed number");return value},Validator.prototype.i8=function(key,fallback){var value=this.int(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if(value<-128||value>127)throw new ValidationError(key,"i8");return value},Validator.prototype.i16=function(key,fallback){var value=this.int(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if(value<-32768||value>32767)throw new ValidationError(key,"i16");return value},Validator.prototype.i32=function(key,fallback){var value=this.int(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if((0|value)!==value)throw new ValidationError(key,"int32");return value},Validator.prototype.i64=function(key,fallback){return this.int(key,fallback)},Validator.prototype.u8=function(key,fallback){var value=this.uint(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if((255&value)!==value)throw new ValidationError(key,"uint8");return value},Validator.prototype.u16=function(key,fallback){var value=this.uint(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if((65535&value)!==value)throw new ValidationError(key,"uint16");return value},Validator.prototype.u32=function(key,fallback){var value=this.uint(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if(value>>>0!==value)throw new ValidationError(key,"uint32");return value},Validator.prototype.u64=function(key,fallback){return this.uint(key,fallback)},Validator.prototype.hash=function(key,fallback){var value=this.get(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if("string"!=typeof value){if(!Buffer.isBuffer(value))throw new ValidationError(key,"hash");if(32!==value.length)throw new ValidationError(key,"hash");return value.toString("hex")}if(64!==value.length)throw new ValidationError(key,"hex string");if(!/^[0-9a-f]+$/i.test(value))throw new ValidationError(key,"hex string");return value.toLowerCase()},Validator.prototype.uinthash=function(key,fallback){var value=this.get(key);return null==fallback&&(fallback=null),null==value?fallback:Buffer.isBuffer(value)?this.hash(key,fallback):"string"!=typeof value||this.loose&&64!==value.length?this.uint(key,fallback):this.hash(key,fallback)},Validator.prototype.rhash=function(key,fallback){var value=this.get(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if("string"!=typeof value){if(!Buffer.isBuffer(value))throw new ValidationError(key,"hash");if(32!==value.length)throw new ValidationError(key,"hash");return value.toString("hex")}if(64!==value.length)throw new ValidationError(key,"hex string");if(!/^[0-9a-f]+$/i.test(value))throw new ValidationError(key,"hex string");for(var out="",i=0;i<value.length;i+=2)out=value.slice(i,i+2)+out;return out.toLowerCase()},Validator.prototype.uintrhash=function(key,fallback){var value=this.get(key);return null==fallback&&(fallback=null),null==value?fallback:Buffer.isBuffer(value)?this.rhash(key,fallback):"string"!=typeof value||this.loose&&64!==value.length?this.uint(key,fallback):this.rhash(key,fallback)},Validator.prototype.bool=function(key,fallback){var value=this.get(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if("number"==typeof value){if(1===value)return!0;if(0===value)return!1}if("string"!=typeof value){if("boolean"!=typeof value)throw new ValidationError(key,"boolean");return value}if(!this.loose)throw new ValidationError(key,"hash");if("true"===value||"1"===value)return!0;if("false"===value||"0"===value)return!1;throw new ValidationError(key,"boolean")},Validator.prototype.buf=function(key,fallback,enc){var value=this.get(key);if(enc||(enc="hex"),void 0===fallback&&(fallback=null),null===value)return fallback;if("string"!=typeof value){if(!Buffer.isBuffer(value))throw new ValidationError(key,"buffer");return value}var data=Buffer.from(value,enc);if(data.length!==Buffer.byteLength(value,enc))throw new ValidationError(key,enc+" string");return data},Validator.prototype.array=function(key,fallback){var value=this.get(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if("string"!=typeof value){if(!Array.isArray(value))throw new ValidationError(key,"array");return value}if(!this.loose)throw new ValidationError(key,"array");var result=[],_iterator2=value.trim().split(/\s*,\s*/),_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref2=_i2.value}var part=_ref2;0!==part.length&&result.push(part)}return result},Validator.prototype.obj=function(key,fallback){var value=this.get(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if("object"!==(void 0===value?"undefined":_typeof(value))||Array.isArray(value))throw new ValidationError(key,"object");return value},Validator.prototype.func=function(key,fallback){var value=this.get(key);if(void 0===fallback&&(fallback=null),null===value)return fallback;if("function"!=typeof value)throw new ValidationError(key,"function");return value},Validator}(),SENTINEL=new Validator(Object.create(null)),MultiValidator=function(){function MultiValidator(maps,loose){_classCallCheck(this,MultiValidator),this.maps=[],this.init(maps,loose)}return MultiValidator.prototype.init=function(maps,loose){assert(Array.isArray(maps)),assert(maps.length>0);var _iterator3=maps,_isArray3=Array.isArray(_iterator3),_i3=0;for(_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref3;if(_isArray3){if(_i3>=_iterator3.length)break;_ref3=_iterator3[_i3++]}else{if((_i3=_iterator3.next()).done)break;_ref3=_i3.value}var map=_ref3;map instanceof Validator?this.maps.push(map):(assert(map&&"object"===(void 0===map?"undefined":_typeof(map))),this.maps.push(new Validator(map,loose)))}},MultiValidator.prototype.find=function(key){var _iterator4=this.maps,_isArray4=Array.isArray(_iterator4),_i4=0;for(_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();;){var _ref4;if(_isArray4){if(_i4>=_iterator4.length)break;_ref4=_iterator4[_i4++]}else{if((_i4=_iterator4.next()).done)break;_ref4=_i4.value}var map=_ref4;if(map.has(key))return map}return SENTINEL},MultiValidator.prototype.child=function(key){return this.find(key).child(key)},MultiValidator.prototype.has=function(key){return this.find(key).has(key)},MultiValidator.prototype.get=function(key,fallback){return this.find(key).get(key,fallback)},MultiValidator.prototype.typeOf=function(key){return this.find(key).typeOf(key)},MultiValidator.prototype.str=function(key,fallback){return this.find(key).str(key,fallback)},MultiValidator.prototype.int=function(key,fallback){return this.find(key).int(key,fallback)},MultiValidator.prototype.uint=function(key,fallback){return this.find(key).uint(key,fallback)},MultiValidator.prototype.float=function(key,fallback){return this.find(key).float(key,fallback)},MultiValidator.prototype.ufloat=function(key,fallback){return this.find(key).ufloat(key,fallback)},MultiValidator.prototype.fixed=function(key,exp,fallback){return this.find(key).fixed(key,exp,fallback)},MultiValidator.prototype.ufixed=function(key,exp,fallback){return this.find(key).ufixed(key,exp,fallback)},MultiValidator.prototype.i8=function(key,fallback){return this.find(key).i8(key,fallback)},MultiValidator.prototype.i16=function(key,fallback){return this.find(key).i16(key,fallback)},MultiValidator.prototype.i32=function(key,fallback){return this.find(key).i32(key,fallback)},MultiValidator.prototype.i64=function(key,fallback){return this.find(key).i64(key,fallback)},MultiValidator.prototype.u8=function(key,fallback){return this.find(key).u8(key,fallback)},MultiValidator.prototype.u16=function(key,fallback){return this.find(key).u16(key,fallback)},MultiValidator.prototype.u32=function(key,fallback){return this.find(key).u32(key,fallback)},MultiValidator.prototype.u64=function(key,fallback){return this.find(key).u64(key,fallback)},MultiValidator.prototype.hash=function(key,fallback){return this.find(key).hash(key,fallback)},MultiValidator.prototype.uinthash=function(key,fallback){return this.find(key).uinthash(key,fallback)},MultiValidator.prototype.rhash=function(key,fallback){return this.find(key).rhash(key,fallback)},MultiValidator.prototype.uintrhash=function(key,fallback){return this.find(key).uintrhash(key,fallback)},MultiValidator.prototype.bool=function(key,fallback){return this.find(key).bool(key,fallback)},MultiValidator.prototype.buf=function(key,fallback,enc){return this.find(key).buf(key,fallback,enc)},MultiValidator.prototype.array=function(key,fallback){return this.find(key).array(key,fallback)},MultiValidator.prototype.obj=function(key,fallback){return this.find(key).obj(key,fallback)},MultiValidator.prototype.func=function(key,fallback){return this.find(key).func(key,fallback)},MultiValidator}();var ValidationError=function(_Error){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(ValidationError,_Error);function ValidationError(key,type){_classCallCheck(this,ValidationError);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Error.call(this));return _this.type="ValidationError",_this.message=function(key){return Array.isArray(key)&&(key=key[0]),"number"==typeof key?"Param #"+key:key}(key)+" must be a "+type+".",Error.captureStackTrace&&Error.captureStackTrace(_this,ValidationError),_this}return ValidationError}(Error);module.exports=Validator}).call(this,require("buffer").Buffer)},{assert:146,buffer:269}],282:[function(require,module,exports){"use strict";var Server=require("./server"),Router=require("./router"),_require=require("./rpc"),RPC=_require.RPC,RPCError=_require.RPCError,errors=_require.errors,middleware=require("./middleware");exports.Server=Server,exports.createServer=function(options){return new Server(options)},exports.server=function(options){return new Server(options)},exports.Router=Router,exports.router=function(){return new Router},exports.RPC=RPC,exports.rpc=function(){return new RPC},exports.RPCError=RPCError,exports.errors=errors,exports.middleware=middleware},{"./middleware":289,"./router":293,"./rpc":294,"./server":295}],283:[function(require,module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var assert=require("assert"),Hook=function(){function Hook(path,handler){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Hook),assert("string"==typeof path),assert("function"==typeof handler||"object"===(void 0===handler?"undefined":_typeof(handler))),assert(null!==handler),this.path=path,this.handler=handler,this.arity=0,"function"==typeof handler&&(this.arity=handler.length)}return Hook.prototype.isPrefix=function(pathname){return"/"===this.path||(pathname.startsWith?pathname.startsWith(this.path):0===pathname.indexOf(this.path))},Hook}();module.exports=Hook},{assert:146}],284:[function(require,module,exports){(function(Buffer){"use strict";var assert=require("assert"),isAscii=require("../util").isAscii,crypto=null;function fail(res,realm){res.setStatus(401),res.setHeader("WWW-Authenticate",'Basic realm="'+realm+'"'),res.end()}function sha256(data){return crypto||(crypto=require("crypto")),crypto.createHash("sha256").update(data).digest()}function ccmp(a,b){if(0===b.length)return 0===a.length;for(var res=a.length^b.length,i=0;i<a.length;i++)res|=a[i]^b[i%b.length];return 0===res}module.exports=function(options){var _this=this;assert(options,"Basic auth requires options.");var hash=options.hash||sha256;assert("function"==typeof hash);var userHash=null,passHash=null,realm="server";return null!=options.username&&(assert("string"==typeof options.username),assert(options.username.length<=255,"Username too long."),assert(isAscii(options.username),"Username must be ASCII."),userHash=hash(Buffer.from(options.username,"ascii"))),assert("string"==typeof options.password),assert(options.password.length<=255,"Password too long."),assert(isAscii(options.password),"Password must be ASCII."),passHash=hash(Buffer.from(options.password,"ascii")),null!=options.realm&&(assert("string"==typeof options.realm),realm=options.realm),function(){var fn,_ref=(fn=regeneratorRuntime.mark(function _callee(req,res){var hdr,parts,type,credentials,auth,items,username,password,user,pass;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(hdr=req.headers.authorization){_context.next=4;break}return fail(res,realm),_context.abrupt("return");case 4:if(!(hdr.length>690)){_context.next=7;break}return fail(res,realm),_context.abrupt("return");case 7:if(2===(parts=hdr.split(" ")).length){_context.next=11;break}return fail(res,realm),_context.abrupt("return");case 11:if(type=parts[0],credentials=parts[1],"Basic"===type){_context.next=15;break}return fail(res,realm),_context.abrupt("return");case 15:if(str=credentials,auth=Buffer.from(str,"base64").toString("ascii"),items=auth.split(":"),username=items.shift(),password=items.join(":"),user=Buffer.from(username,"ascii"),pass=Buffer.from(password,"ascii"),!userHash){_context.next=28;break}if(!(user.length>255)){_context.next=25;break}return fail(res,realm),_context.abrupt("return");case 25:if(ccmp(hash(user),userHash)){_context.next=28;break}return fail(res,realm),_context.abrupt("return");case 28:if(!(pass.length>255)){_context.next=31;break}return fail(res,realm),_context.abrupt("return");case 31:if(ccmp(hash(pass),passHash)){_context.next=34;break}return fail(res,realm),_context.abrupt("return");case 34:req.username=username;case 35:case"end":return _context.stop()}var str},_callee,_this)}),function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})});return function(_x,_x2){return _ref.apply(this,arguments)}}()}}).call(this,require("buffer").Buffer)},{"../util":296,assert:146,buffer:269,crypto:305}],285:[function(require,module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},parseBody=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(req,options){var type,data,body,_data;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if("GET"!==req.method){_context2.next=2;break}return _context2.abrupt("return",Object.create(null));case 2:type=options.type||req.type,_context2.t0=type,_context2.next="json"===_context2.t0?6:"form"===_context2.t0?15:21;break;case 6:return _context2.next=8,readBody(req,options);case 8:if(data=_context2.sent){_context2.next=11;break}return _context2.abrupt("return",Object.create(null));case 11:if((body=JSON.parse(data))&&"object"===(void 0===body?"undefined":_typeof(body))){_context2.next=14;break}throw new Error("JSON body must be an object.");case 14:return _context2.abrupt("return",body);case 15:return _context2.next=17,readBody(req,options);case 17:if(_data=_context2.sent){_context2.next=20;break}return _context2.abrupt("return",Object.create(null));case 20:return _context2.abrupt("return",parseForm(_data,options.keyLimit));case 21:return _context2.abrupt("return",Object.create(null));case 22:case"end":return _context2.stop()}},_callee2,this)}));return function(_x3,_x4){return _ref2.apply(this,arguments)}}();function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}var assert=require("assert"),StringDecoder=require("string_decoder").StringDecoder,parseForm=require("../util").parseForm;function readBody(req,options){return new Promise(function(resolve,reject){return function(req,options,resolve,reject){var decode=new StringDecoder("utf8"),hasData=!1,total=0,body="",timer=null,cleanup=function(){req.removeListener("data",onData),req.removeListener("error",onError),req.removeListener("end",onEnd),null!=timer&&(timer=null,clearTimeout(timer))},onData=function(data){total+=data.length,hasData=!0,total>options.bodyLimit?reject(new Error("Request body overflow.")):body+=decode.write(data)},onError=function(err){cleanup(),reject(err)},onEnd=function(){cleanup(),resolve(hasData?body:null)};timer=setTimeout(function(){cleanup(),reject(new Error("Request body timed out."))},options.timeout),req.on("data",onData),req.on("error",onError),req.on("end",onEnd)}(req,options,resolve,reject)})}var BodyParserOptions=function(){function BodyParserOptions(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BodyParserOptions),this.keyLimit=100,this.bodyLimit=20<<20,this.type=null,this.timeout=1e4,options&&this.fromOptions(options)}return BodyParserOptions.prototype.fromOptions=function(options){return assert(options),null!=options.keyLimit&&(assert("number"==typeof options.keyLimit),this.keyLimit=options.keyLimit),null!=options.bodyLimit&&(assert("number"==typeof options.bodyLimit),this.bodyLimit=options.bodyLimit),null!=options.type&&(assert("string"==typeof options.type),this.type=options.type),this},BodyParserOptions}();module.exports=function(options){var _this=this,opt=new BodyParserOptions(options);return function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(req,res){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!req.hasBody){_context.next=2;break}return _context.abrupt("return");case 2:return _context.prev=2,req.resume(),_context.next=6,parseBody(req,opt);case 6:req.body=_context.sent;case 7:return _context.prev=7,req.pause(),_context.finish(7);case 10:req.hasBody=!0;case 11:case"end":return _context.stop()}},_callee,_this,[[2,,7,10]])}));return function(_x,_x2){return _ref.apply(this,arguments)}}()}},{"../util":296,assert:146,string_decoder:422}],286:[function(require,module,exports){"use strict";function parseCookies(hdr){var parts=hdr.split(/; */),cookies=Object.create(null),_iterator=parts,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref2;if(_isArray){if(_i>=_iterator.length)break;_ref2=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref2=_i.value}var part=_ref2,index=part.indexOf("="),key=part,value="";if(-1!==index&&(key=part.substring(0,index),'"'===(value=part.substring(index+1))[0]&&(value=value.slice(1,-1))),key.length>0){try{value=decodeURIComponent(value)}catch(e){}cookies[key]=value}}return cookies}module.exports=function(){var _this=this;return function(){var fn,_ref=(fn=regeneratorRuntime.mark(function _callee(req,res){var hdr;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(hdr=req.headers.cookie){_context.next=3;break}return _context.abrupt("return");case 3:req.cookies=parseCookies(hdr);case 4:case"end":return _context.stop()}},_callee,_this)}),function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})});return function(_x,_x2){return _ref.apply(this,arguments)}}()}},{}],287:[function(require,module,exports){"use strict";module.exports=function(){var _this=this;return function(){var fn,_ref=(fn=regeneratorRuntime.mark(function _callee(req,res){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(res.setHeader("Access-Control-Allow-Origin","*"),res.setHeader("Access-Control-Allow-Credentials","true"),res.setHeader("Access-Control-Allow-Methods","GET,HEAD,PUT,PATCH,POST,DELETE"),res.setHeader("Access-Control-Allow-Headers","Authorization"),"OPTIONS"!==req.method){_context.next=8;break}return res.setStatus(200),res.end(),_context.abrupt("return");case 8:case"end":return _context.stop()}},_callee,_this)}),function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})});return function(_x,_x2){return _ref.apply(this,arguments)}}()}},{}],288:[function(require,module,exports){"use strict";var dir2html=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(parent,title,prefix){var body,list,dirs,files,_iterator,_isArray,_i,_ref3,file,path,_iterator2,_isArray2,_i2,_ref4,name,_iterator3,_isArray3,_i3,_ref5;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return body="",title=escapeHTML(title),prefix=escapeHTML(prefix),body+="<!DOCTYPE html>\n",body+='<html lang="en">\n',body+="  <head>\n",body+="    <title>Index of "+title+"</title>\n",body+='    <meta charset="utf-8">\n',body+="  </head>\n",body+="  <body>\n",body+="    <p>Index of "+title+"</p>\n",body+="    <ul>\n",body+='      <li><a href="'+prefix+'..">../</a></li>\n',_context2.next=15,fsReaddir(parent);case 15:list=_context2.sent,dirs=[],files=[],_iterator=list,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();case 19:if(!_isArray){_context2.next=25;break}if(!(_i>=_iterator.length)){_context2.next=22;break}return _context2.abrupt("break",37);case 22:_ref3=_iterator[_i++],_context2.next=29;break;case 25:if(!(_i=_iterator.next()).done){_context2.next=28;break}return _context2.abrupt("break",37);case 28:_ref3=_i.value;case 29:return file=_ref3,path=Path.join(parent,file),_context2.next=33,fsStat(path);case 33:_context2.sent.isDirectory()?dirs.push(file):files.push(file);case 35:_context2.next=19;break;case 37:_iterator2=dirs.sort(),_isArray2=Array.isArray(_iterator2),_i2=0,_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();case 38:if(!_isArray2){_context2.next=44;break}if(!(_i2>=_iterator2.length)){_context2.next=41;break}return _context2.abrupt("break",54);case 41:_ref4=_iterator2[_i2++],_context2.next=48;break;case 44:if(!(_i2=_iterator2.next()).done){_context2.next=47;break}return _context2.abrupt("break",54);case 47:_ref4=_i2.value;case 48:name=escapeHTML(_ref4),body+='      <li><a href="'+(""+prefix+name)+'">'+name+"/</a></li>\n";case 52:_context2.next=38;break;case 54:_iterator3=files.sort(),_isArray3=Array.isArray(_iterator3),_i3=0,_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();case 55:if(!_isArray3){_context2.next=61;break}if(!(_i3>=_iterator3.length)){_context2.next=58;break}return _context2.abrupt("break",71);case 58:_ref5=_iterator3[_i3++],_context2.next=65;break;case 61:if(!(_i3=_iterator3.next()).done){_context2.next=64;break}return _context2.abrupt("break",71);case 64:_ref5=_i3.value;case 65:name=escapeHTML(_ref5),body+='      <li><a href="'+(""+prefix+name)+'">'+name+"</a></li>\n";case 69:_context2.next=55;break;case 71:return body+="    </ul>\n",body+="  </body>\n",body+="</html>\n",_context2.abrupt("return",body);case 75:case"end":return _context2.stop()}},_callee2,this)}));return function(_x3,_x4,_x5){return _ref2.apply(this,arguments)}}();function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}var assert=require("assert"),fs=require("fs"),Path=require("path");function fsStat(file){return new Promise(function(resolve,reject){fs.stat(file,function(err,result){err?reject(wrapError(err)):resolve(result)})})}function fsReaddir(file){return new Promise(function(resolve,reject){fs.readdir(file,function(err,result){err?reject(wrapError(err)):resolve(result)})})}function wrapError(e){if(!e.code){var err=new Error("Internal server error.");return err.statusCode=500,err}switch(e.code){case"ENOENT":case"ENAMETOOLONG":case"ENOTDIR":case"EISDIR":var _err=new Error("File not found.");return _err.code=e.code,_err.syscall=e.syscall,_err.statusCode=404,_err;case"EACCES":case"EPERM":var _err2=new Error("Cannot access file.");return _err2.code=e.code,_err2.syscall=e.syscall,_err2.statusCode=403,_err2;case"EMFILE":var _err3=new Error("Too many open files.");return _err3.code=e.code,_err3.syscall=e.syscall,_err3.statusCode=500,_err3;default:var _err4=new Error("Cannot access file.");return _err4.code=e.code,_err4.syscall=e.syscall,_err4.statusCode=500,_err4}}function escapeHTML(html){return html.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}module.exports=function(prefix){var _this=this;return assert("string"==typeof prefix),function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(req,res){var file,stat,title,body;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if("GET"===req.method||"HEAD"===req.method){_context.next=2;break}return _context.abrupt("return");case 2:return file=Path.join(prefix,req.pathname),stat=null,_context.prev=4,_context.next=7,fsStat(file);case 7:stat=_context.sent,_context.next=15;break;case 10:if(_context.prev=10,_context.t0=_context.catch(4),"ENOENT"!==_context.t0.code){_context.next=14;break}return _context.abrupt("return");case 14:throw _context.t0;case 15:if(!stat.isDirectory()){_context.next=22;break}return title=req.pathname,_context.next=19,dir2html(file,title,req.prefix());case 19:return body=_context.sent,res.send(200,body,"html"),_context.abrupt("return");case 22:return _context.prev=22,_context.next=25,res.sendFile(file);case 25:_context.next=30;break;case 27:throw _context.prev=27,_context.t1=_context.catch(22),wrapError(_context.t1);case 30:case"end":return _context.stop()}},_callee,_this,[[4,10],[22,27]])}));return function(_x,_x2){return _ref.apply(this,arguments)}}()}},{assert:146,fs:247,path:367}],289:[function(require,module,exports){"use strict";exports.basicAuth=require("./basicauth"),exports.bodyParser=require("./bodyparser"),exports.cookieParser=require("./cookie"),exports.cors=require("./cors"),exports.fileServer=require("./file"),exports.jsonRPC=require("./jsonrpc"),exports.router=require("./router")},{"./basicauth":284,"./bodyparser":285,"./cookie":286,"./cors":287,"./file":288,"./jsonrpc":290,"./router":291}],290:[function(require,module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var assert=require("assert");module.exports=function(rpc){var _this=this;return assert(rpc&&"object"===(void 0===rpc?"undefined":_typeof(rpc))),assert("function"==typeof rpc.call),function(){var fn,_ref=(fn=regeneratorRuntime.mark(function _callee(req,res){var json;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if("POST"===req.method){_context.next=2;break}return _context.abrupt("return");case 2:if("/"===req.pathname){_context.next=4;break}return _context.abrupt("return");case 4:if("string"==typeof req.body.method){_context.next=6;break}return _context.abrupt("return");case 6:return _context.next=8,rpc.call(req.body,req.query);case 8:null==(json=_context.sent)&&(json=null),json=JSON.stringify(json),json+="\n",res.setHeader("X-Long-Polling","/?longpoll=1"),res.send(200,json,"application/json");case 14:case"end":return _context.stop()}},_callee,_this)}),function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})});return function(_x,_x2){return _ref.apply(this,arguments)}}()}},{assert:146}],291:[function(require,module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var assert=require("assert");module.exports=function(routes){var _this=this;return assert(routes&&"object"===(void 0===routes?"undefined":_typeof(routes))),assert("function"==typeof routes.handle),function(){var fn,_ref=(fn=regeneratorRuntime.mark(function _callee(req,res){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.abrupt("return",routes.handle(req,res));case 1:case"end":return _context.stop()}},_callee,_this)}),function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})});return function(_x,_x2){return _ref.apply(this,arguments)}}()}},{assert:146}],292:[function(require,module,exports){"use strict";var assert=require("assert"),Route=function(){function Route(path,handler){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Route),assert("string"==typeof path),assert("function"==typeof handler),assert(2===handler.length||3===handler.length),this.path=path,this.regex=/^\/$/,this.handler=handler,this.arity=handler.length,this.map=[],this.compiled=!1}return Route.prototype.compile=function(){if(!this.compiled&&(this.compiled=!0,"/"!==this.path)){var map=this.map,path=this.path;path=(path=(path=(path=(path=path.replace(/(\/[^\/]+)\?/g,"(?:$1)?")).replace(/\.(?!\+)/g,"\\.")).replace(/\*/g,".*?")).replace(/%/g,"\\")).replace(/:(\w+)/g,function(str,name){return map.push(name),"([^/]+)"}),this.regex=new RegExp("^"+path+"$")}},Route.prototype.match=function(pathname){this.compile();var matches=this.regex.exec(pathname);if(!matches)return null;for(var params=Object.create(null),i=1;i<matches.length;i++){var item=matches[i],key=this.map[i-1];key&&(params[key]=item),params[i-1]=item}return params},Route}();module.exports=Route},{assert:146}],293:[function(require,module,exports){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}var assert=require("assert"),Route=require("./route"),Hook=require("./hook"),Router=function(){function Router(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Router),this._get=[],this._post=[],this._put=[],this._del=[],this.hooks=[]}return Router.prototype._handlers=function(method){switch(assert("string"==typeof method),method.toUpperCase()){case"GET":return this._get;case"POST":return this._post;case"PUT":return this._put;case"DELETE":return this._del;default:return null}},Router.prototype.handle=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(req,res){var routes,err,_iterator,_isArray,_i,_ref2,route,params;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(routes=this._handlers(req.method)){_context.next=3;break}return _context.abrupt("return",!1);case 3:err=null,_iterator=routes,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();case 5:if(!_isArray){_context.next=11;break}if(!(_i>=_iterator.length)){_context.next=8;break}return _context.abrupt("break",46);case 8:_ref2=_iterator[_i++],_context.next=15;break;case 11:if(!(_i=_iterator.next()).done){_context.next=14;break}return _context.abrupt("break",46);case 14:_ref2=_i.value;case 15:if(params=(route=_ref2).match(req.pathname)){_context.next=19;break}return _context.abrupt("continue",44);case 19:if(req.params=params,!err){_context.next=28;break}if(3===route.arity){_context.next=23;break}return _context.abrupt("continue",44);case 23:return _context.next=25,route.handler(err,req,res);case 25:if(!res.sent){_context.next=27;break}return _context.abrupt("return",!0);case 27:return _context.abrupt("continue",44);case 28:if(2===route.arity){_context.next=30;break}return _context.abrupt("continue",44);case 30:return _context.next=32,this._handleHooks(req,res);case 32:if(!_context.sent){_context.next=34;break}return _context.abrupt("return",!0);case 34:return _context.prev=34,_context.next=37,route.handler(req,res);case 37:if(!res.sent){_context.next=39;break}return _context.abrupt("return",!0);case 39:_context.next=44;break;case 41:_context.prev=41,_context.t0=_context.catch(34),err=_context.t0;case 44:_context.next=5;break;case 46:if(!err){_context.next=48;break}throw err;case 48:return _context.abrupt("return",!1);case 49:case"end":return _context.stop()}},_callee,this,[[34,41]])}));return function(_x,_x2){return _ref.apply(this,arguments)}}(),Router.prototype._handleHooks=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(req,res){var err,_iterator2,_isArray2,_i2,_ref4,hook;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:err=null,_iterator2=this.hooks,_isArray2=Array.isArray(_iterator2),_i2=0,_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();case 2:if(!_isArray2){_context2.next=8;break}if(!(_i2>=_iterator2.length)){_context2.next=5;break}return _context2.abrupt("break",37);case 5:_ref4=_iterator2[_i2++],_context2.next=12;break;case 8:if(!(_i2=_iterator2.next()).done){_context2.next=11;break}return _context2.abrupt("break",37);case 11:_ref4=_i2.value;case 12:if((hook=_ref4).isPrefix(req.pathname)){_context2.next=15;break}return _context2.abrupt("continue",35);case 15:if(!err){_context2.next=23;break}if(3===hook.arity){_context2.next=18;break}return _context2.abrupt("continue",35);case 18:return _context2.next=20,hook.handler(err,req,res);case 20:if(!res.sent){_context2.next=22;break}return _context2.abrupt("return",!0);case 22:return _context2.abrupt("continue",35);case 23:if(2===hook.arity){_context2.next=25;break}return _context2.abrupt("continue",35);case 25:return _context2.prev=25,_context2.next=28,hook.handler(req,res);case 28:if(!res.sent){_context2.next=30;break}return _context2.abrupt("return",!0);case 30:_context2.next=35;break;case 32:_context2.prev=32,_context2.t0=_context2.catch(25),err=_context2.t0;case 35:_context2.next=2;break;case 37:if(!err){_context2.next=39;break}throw err;case 39:return _context2.abrupt("return",!1);case 40:case"end":return _context2.stop()}},_callee2,this,[[25,32]])}));return function(_x3,_x4){return _ref3.apply(this,arguments)}}(),Router.prototype.hook=function(path,handler){handler||(handler=path,path="/"),this.hooks.push(new Hook(path,handler))},Router.prototype.get=function(path,handler){this._get.push(new Route(path,handler))},Router.prototype.post=function(path,handler){this._post.push(new Route(path,handler))},Router.prototype.put=function(path,handler){this._put.push(new Route(path,handler))},Router.prototype.del=function(path,handler){this._del.push(new Route(path,handler))},Router}();module.exports=Router},{"./hook":283,"./route":292,assert:146}],294:[function(require,module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var assert=require("assert"),errors={INVALID_REQUEST:-32600,METHOD_NOT_FOUND:-32601,INVALID_PARAMS:-32602,INTERNAL_ERROR:-32603,PARSE_ERROR:-32700},RPC=function(_EventEmitter){_inherits(RPC,_EventEmitter);function RPC(){_classCallCheck(this,RPC);var _this=_possibleConstructorReturn(this,_EventEmitter.call(this));return _this.calls=Object.create(null),_this.mounts=[],_this}return RPC.prototype.getCode=function(err){switch(err.type){case"RPCError":return err.code;default:return errors.INTERNAL_ERROR}},RPC.prototype.handleCall=function(cmd,query){},RPC.prototype.handleError=function(err){},RPC.prototype.call=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(body,query){var cmds,out,array,_iterator,_isArray,_i,_ref2,cmd,result,code;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:cmds=body,out=[],array=!0,query||(query={}),Array.isArray(cmds)||(cmds=[cmds],array=!1),_iterator=cmds,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();case 6:if(!_isArray){_context.next=12;break}if(!(_i>=_iterator.length)){_context.next=9;break}return _context.abrupt("break",50);case 9:_ref2=_iterator[_i++],_context.next=16;break;case 12:if(!(_i=_iterator.next()).done){_context.next=15;break}return _context.abrupt("break",50);case 15:_ref2=_i.value;case 16:if((cmd=_ref2)&&"object"===(void 0===cmd?"undefined":_typeof(cmd))){_context.next=20;break}return out.push({result:null,error:{message:"Invalid request.",code:errors.INVALID_REQUEST},id:null}),_context.abrupt("continue",48);case 20:if(!cmd.id||"object"!==_typeof(cmd.id)){_context.next=23;break}return out.push({result:null,error:{message:"Invalid ID.",code:errors.INVALID_REQUEST},id:null}),_context.abrupt("continue",48);case 23:if(null==cmd.id&&(cmd.id=null),cmd.params||(cmd.params=[]),"string"==typeof cmd.method){_context.next=28;break}return out.push({result:null,error:{message:"Method not found.",code:errors.METHOD_NOT_FOUND},id:cmd.id}),_context.abrupt("continue",48);case 28:if(Array.isArray(cmd.params)){_context.next=31;break}return out.push({result:null,error:{message:"Invalid params.",code:errors.INVALID_PARAMS},id:cmd.id}),_context.abrupt("continue",48);case 31:return this.handleCall(cmd,query),this.emit("call",cmd,query),result=void 0,_context.prev=34,_context.next=37,this.execute(cmd);case 37:result=_context.sent,_context.next=46;break;case 40:return _context.prev=40,_context.t0=_context.catch(34),(code=this.getCode(_context.t0))===errors.INTERNAL_ERROR&&(this.handleError(_context.t0),this.emit("error",_context.t0)),out.push({result:null,error:{message:_context.t0.message,code:code},id:cmd.id}),_context.abrupt("continue",48);case 46:void 0===result&&(result=null),out.push({result:result,error:null,id:cmd.id});case 48:_context.next=6;break;case 50:return array||(out=out[0]),_context.abrupt("return",out);case 52:case"end":return _context.stop()}},_callee,this,[[34,40]])}));return function(_x,_x2){return _ref.apply(this,arguments)}}(),RPC.prototype.execute=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(json,help){var func,_iterator2,_isArray2,_i2,_ref4,mount;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(func=this.calls[json.method]){_context2.next=21;break}_iterator2=this.mounts,_isArray2=Array.isArray(_iterator2),_i2=0,_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();case 3:if(!_isArray2){_context2.next=9;break}if(!(_i2>=_iterator2.length)){_context2.next=6;break}return _context2.abrupt("break",20);case 6:_ref4=_iterator2[_i2++],_context2.next=13;break;case 9:if(!(_i2=_iterator2.next()).done){_context2.next=12;break}return _context2.abrupt("break",20);case 12:_ref4=_i2.value;case 13:if(!(mount=_ref4).calls[json.method]){_context2.next=18;break}return _context2.next=17,mount.execute(json,help);case 17:return _context2.abrupt("return",_context2.sent);case 18:_context2.next=3;break;case 20:throw new RPCError(errors.METHOD_NOT_FOUND,"Method not found: "+json.method+".");case 21:return _context2.abrupt("return",func.call(this,json.params,help));case 22:case"end":return _context2.stop()}},_callee2,this)}));return function(_x3,_x4){return _ref3.apply(this,arguments)}}(),RPC.prototype.add=function(name,func,ctx){assert("function"==typeof func,"Handler must be a function."),assert(!this.calls[name],"Duplicate RPC call."),ctx&&(func=func.bind(ctx)),this.calls[name]=func},RPC.prototype.mount=function(rpc){assert(rpc,"RPC must be an object."),assert("function"==typeof rpc.execute,"Execute must be a method."),this.mounts.push(rpc)},RPC.prototype.attach=function(rpc){assert(rpc,"RPC must be an object."),assert("function"==typeof rpc.execute,"Execute must be a method."),rpc.mount(this)},RPC}(require("events")),RPCError=function(_Error){_inherits(RPCError,_Error);function RPCError(code,msg){_classCallCheck(this,RPCError);var _this2=_possibleConstructorReturn(this,_Error.call(this));return assert("number"==typeof code),assert("string"==typeof msg),_this2.type="RPCError",_this2.message=msg,_this2.code=code,Error.captureStackTrace&&Error.captureStackTrace(_this2,RPCError),_this2}return RPCError}(Error);RPC.RPC=RPC,RPC.errors=errors,RPC.RPCError=RPCError,module.exports=RPC},{assert:146,events:334}],295:[function(require,module,exports){"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}var EventEmitter=require("events"),RPC=require("./rpc"),Server=function(_EventEmitter){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Server,_EventEmitter);function Server(options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Server);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return _this.options=options,_this.config={},_this.server=new EventEmitter,_this.io=new EventEmitter,_this.rpc=new RPC,_this}return Server.prototype.open=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:this.emit("listening",this.address());case 1:case"end":return _context.stop()}},_callee,this)}));return function(){return _ref.apply(this,arguments)}}(),Server.prototype.close=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref2.apply(this,arguments)}}(),Server.prototype.error=function(){},Server.prototype.mount=function(){},Server.prototype.use=function(){},Server.prototype.hook=function(){},Server.prototype.get=function(){},Server.prototype.post=function(){},Server.prototype.put=function(){},Server.prototype.del=function(){},Server.prototype.channel=function(){return null},Server.prototype.join=function(){},Server.prototype.leave=function(){},Server.prototype.to=function(){},Server.prototype.all=function(){},Server.prototype.execute=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:case"end":return _context3.stop()}},_callee3,this)}));return function(){return _ref3.apply(this,arguments)}}(),Server.prototype.add=function(){},Server.prototype.address=function(){return{address:"localhost",port:80}},Server.prototype.router=function(){var _this2=this;return _asyncToGenerator(regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:case"end":return _context4.stop()}},_callee4,_this2)}))},Server.prototype.cors=function(){var _this3=this;return _asyncToGenerator(regeneratorRuntime.mark(function _callee5(){return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:case"end":return _context5.stop()}},_callee5,_this3)}))},Server.prototype.basicAuth=function(){var _this4=this;return _asyncToGenerator(regeneratorRuntime.mark(function _callee6(){return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:case"end":return _context6.stop()}},_callee6,_this4)}))},Server.prototype.bodyParser=function(){var _this5=this;return _asyncToGenerator(regeneratorRuntime.mark(function _callee7(){return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:case"end":return _context7.stop()}},_callee7,_this5)}))},Server.prototype.jsonRPC=function(){var _this6=this;return _asyncToGenerator(regeneratorRuntime.mark(function _callee8(){return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:case"end":return _context8.stop()}},_callee8,_this6)}))},Server.prototype.fileServer=function(){var _this7=this;return _asyncToGenerator(regeneratorRuntime.mark(function _callee9(){return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:case"end":return _context9.stop()}},_callee9,_this7)}))},Server.prototype.cookieParser=function(){var _this8=this;return _asyncToGenerator(regeneratorRuntime.mark(function _callee10(){return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:case"end":return _context10.stop()}},_callee10,_this8)}))},Server}(EventEmitter);module.exports=Server},{"./rpc":294,events:334}],296:[function(require,module,exports){"use strict";var assert=require("assert"),URL=require("url"),Path=require("path");exports.parseURL=function(uri){assert("string"==typeof uri),-1===uri.indexOf("://")&&(uri="http://localhost/"+uri);var data=URL.parse(uri),pathname=data.pathname,trailing=!1;pathname?("/"!==(pathname=pathname.replace(/\/{2,}/g,"/"))[0]&&(pathname="/"+pathname),pathname.length>1&&"/"===pathname[pathname.length-1]&&(pathname=pathname.slice(0,-1),trailing=!0),pathname=pathname.replace(/%2f/gi,""),pathname=unescape(pathname)):pathname="/",pathname=(pathname=(pathname=Path.normalize(pathname)).replace(/[^ -~]+/g,"")).replace(/\\+/,""),assert(pathname.length>0),assert("/"===pathname[0]),pathname.length>1&&assert("/"!==pathname[pathname.length-1]);var path=pathname;"/"===path[0]&&(path=path.substring(1)),1===(path=path.split("/")).length&&0===path[0].length&&(path=[]);var url=pathname;data.search&&data.search.length>1&&(assert("?"===data.search[0]),url+=data.search);var query=Object.create(null);return data.query&&(query=exports.parseForm(data.query,100)),{url:url,pathname:pathname,path:path,query:query,trailing:trailing}},exports.parseForm=function(str,limit){assert(limit>>>0===limit);var parts=str.split("&"),data=Object.create(null);if(parts.length>limit)throw new Error("Too many keys in querystring.");var _iterator=parts,_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var pair=_ref,index=pair.indexOf("="),key=void 0,value=void 0;-1===index?(key=pair,value=""):(key=pair.substring(0,index),value=pair.substring(index+1)),0!==(key=unescape(key)).length&&(0!==(value=unescape(value)).length&&(data[key]=value))}return data},exports.unescape=function(str){try{str=(str=decodeURIComponent(str)).replace(/\+/g," ")}catch(e){}return str=str.replace(/\0/g,"")},exports.isAscii=function(str){return"string"==typeof str&&/^[\t\n\r -~]*$/.test(str)}},{assert:146,path:367,url:423}],297:[function(require,module,exports){var Buffer=require("safe-buffer").Buffer,Transform=require("stream").Transform,StringDecoder=require("string_decoder").StringDecoder;function CipherBase(hashMode){Transform.call(this),this.hashMode="string"==typeof hashMode,this.hashMode?this[hashMode]=this._finalOrDigest:this.final=this._finalOrDigest,this._final&&(this.__final=this._final,this._final=null),this._decoder=null,this._encoding=null}require("inherits")(CipherBase,Transform),CipherBase.prototype.update=function(data,inputEnc,outputEnc){"string"==typeof data&&(data=Buffer.from(data,inputEnc));var outData=this._update(data);return this.hashMode?this:(outputEnc&&(outData=this._toString(outData,outputEnc)),outData)},CipherBase.prototype.setAutoPadding=function(){},CipherBase.prototype.getAuthTag=function(){throw new Error("trying to get auth tag in unsupported state")},CipherBase.prototype.setAuthTag=function(){throw new Error("trying to set auth tag in unsupported state")},CipherBase.prototype.setAAD=function(){throw new Error("trying to set aad in unsupported state")},CipherBase.prototype._transform=function(data,_,next){var err;try{this.hashMode?this._update(data):this.push(this._update(data))}catch(e){err=e}finally{next(err)}},CipherBase.prototype._flush=function(done){var err;try{this.push(this.__final())}catch(e){err=e}done(err)},CipherBase.prototype._finalOrDigest=function(outputEnc){var outData=this.__final()||Buffer.alloc(0);return outputEnc&&(outData=this._toString(outData,outputEnc,!0)),outData},CipherBase.prototype._toString=function(value,enc,fin){if(this._decoder||(this._decoder=new StringDecoder(enc),this._encoding=enc),this._encoding!==enc)throw new Error("can't switch encodings");var out=this._decoder.write(value);return fin&&(out+=this._decoder.end()),out},module.exports=CipherBase},{inherits:352,"safe-buffer":401,stream:421,string_decoder:422}],298:[function(require,module,exports){(function(Buffer){exports.isArray=function(arg){return Array.isArray?Array.isArray(arg):"[object Array]"===objectToString(arg)};exports.isBoolean=function(arg){return"boolean"==typeof arg};exports.isNull=function(arg){return null===arg};exports.isNullOrUndefined=function(arg){return null==arg};exports.isNumber=function(arg){return"number"==typeof arg};exports.isString=function(arg){return"string"==typeof arg};exports.isSymbol=function(arg){return"symbol"==typeof arg};exports.isUndefined=function(arg){return void 0===arg};exports.isRegExp=function(re){return"[object RegExp]"===objectToString(re)};exports.isObject=function(arg){return"object"==typeof arg&&null!==arg};exports.isDate=function(d){return"[object Date]"===objectToString(d)};exports.isError=function(e){return"[object Error]"===objectToString(e)||e instanceof Error};exports.isFunction=function(arg){return"function"==typeof arg};exports.isPrimitive=function(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||void 0===arg},exports.isBuffer=Buffer.isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,{isBuffer:require("../../is-buffer/index.js")})},{"../../is-buffer/index.js":353}],299:[function(require,module,exports){(function(Buffer){var elliptic=require("elliptic"),BN=require("bn.js");module.exports=function(curve){return new ECDH(curve)};var aliases={secp256k1:{name:"secp256k1",byteLength:32},secp224r1:{name:"p224",byteLength:28},prime256v1:{name:"p256",byteLength:32},prime192v1:{name:"p192",byteLength:24},ed25519:{name:"ed25519",byteLength:32},secp384r1:{name:"p384",byteLength:48},secp521r1:{name:"p521",byteLength:66}};aliases.p224=aliases.secp224r1,aliases.p256=aliases.secp256r1=aliases.prime256v1,aliases.p192=aliases.secp192r1=aliases.prime192v1,aliases.p384=aliases.secp384r1,aliases.p521=aliases.secp521r1;function ECDH(curve){this.curveType=aliases[curve],this.curveType||(this.curveType={name:curve}),this.curve=new elliptic.ec(this.curveType.name),this.keys=void 0}ECDH.prototype.generateKeys=function(enc,format){return this.keys=this.curve.genKeyPair(),this.getPublicKey(enc,format)},ECDH.prototype.computeSecret=function(other,inenc,enc){inenc=inenc||"utf8",Buffer.isBuffer(other)||(other=new Buffer(other,inenc));return formatReturnValue(this.curve.keyFromPublic(other).getPublic().mul(this.keys.getPrivate()).getX(),enc,this.curveType.byteLength)},ECDH.prototype.getPublicKey=function(enc,format){var key=this.keys.getPublic("compressed"===format,!0);return"hybrid"===format&&(key[key.length-1]%2?key[0]=7:key[0]=6),formatReturnValue(key,enc)},ECDH.prototype.getPrivateKey=function(enc){return formatReturnValue(this.keys.getPrivate(),enc)},ECDH.prototype.setPublicKey=function(pub,enc){return enc=enc||"utf8",Buffer.isBuffer(pub)||(pub=new Buffer(pub,enc)),this.keys._importPublic(pub),this},ECDH.prototype.setPrivateKey=function(priv,enc){enc=enc||"utf8",Buffer.isBuffer(priv)||(priv=new Buffer(priv,enc));var _priv=new BN(priv);return _priv=_priv.toString(16),this.keys._importPrivate(_priv),this};function formatReturnValue(bn,enc,len){Array.isArray(bn)||(bn=bn.toArray());var buf=new Buffer(bn);if(len&&buf.length<len){var zeros=new Buffer(len-buf.length);zeros.fill(0),buf=Buffer.concat([zeros,buf])}return enc?buf.toString(enc):buf}}).call(this,require("buffer").Buffer)},{"bn.js":217,buffer:269,elliptic:318}],300:[function(require,module,exports){(function(Buffer){"use strict";var inherits=require("inherits"),md5=require("./md5"),RIPEMD160=require("ripemd160"),sha=require("sha.js"),Base=require("cipher-base");function HashNoConstructor(hash){Base.call(this,"digest"),this._hash=hash,this.buffers=[]}inherits(HashNoConstructor,Base),HashNoConstructor.prototype._update=function(data){this.buffers.push(data)},HashNoConstructor.prototype._final=function(){var buf=Buffer.concat(this.buffers),r=this._hash(buf);return this.buffers=null,r};function Hash(hash){Base.call(this,"digest"),this._hash=hash}inherits(Hash,Base),Hash.prototype._update=function(data){this._hash.update(data)},Hash.prototype._final=function(){return this._hash.digest()},module.exports=function(alg){return"md5"===(alg=alg.toLowerCase())?new HashNoConstructor(md5):new Hash("rmd160"===alg||"ripemd160"===alg?new RIPEMD160:sha(alg))}}).call(this,require("buffer").Buffer)},{"./md5":302,buffer:269,"cipher-base":297,inherits:352,ripemd160:400,"sha.js":414}],301:[function(require,module,exports){(function(Buffer){"use strict";var intSize=4,zeroBuffer=new Buffer(intSize);zeroBuffer.fill(0);module.exports=function(buf,fn){var arr=fn(function(buf){if(buf.length%intSize!=0){var len=buf.length+(intSize-buf.length%intSize);buf=Buffer.concat([buf,zeroBuffer],len)}for(var arr=new Array(buf.length>>>2),i=0,j=0;i<buf.length;i+=intSize,j++)arr[j]=buf.readInt32LE(i);return arr}(buf),8*buf.length);buf=new Buffer(16);for(var i=0;i<arr.length;i++)buf.writeInt32LE(arr[i],i<<2,!0);return buf}}).call(this,require("buffer").Buffer)},{buffer:269}],302:[function(require,module,exports){"use strict";var makeHash=require("./make-hash");function core_md5(x,len){x[len>>5]|=128<<len%32,x[14+(len+64>>>9<<4)]=len;for(var a=1732584193,b=-271733879,c=-1732584194,d=271733878,i=0;i<x.length;i+=16){var olda=a,oldb=b,oldc=c,oldd=d;b=md5_ii(b=md5_ii(b=md5_ii(b=md5_ii(b=md5_hh(b=md5_hh(b=md5_hh(b=md5_hh(b=md5_gg(b=md5_gg(b=md5_gg(b=md5_gg(b=md5_ff(b=md5_ff(b=md5_ff(b=md5_ff(b,c=md5_ff(c,d=md5_ff(d,a=md5_ff(a,b,c,d,x[i+0],7,-680876936),b,c,x[i+1],12,-389564586),a,b,x[i+2],17,606105819),d,a,x[i+3],22,-1044525330),c=md5_ff(c,d=md5_ff(d,a=md5_ff(a,b,c,d,x[i+4],7,-176418897),b,c,x[i+5],12,1200080426),a,b,x[i+6],17,-1473231341),d,a,x[i+7],22,-45705983),c=md5_ff(c,d=md5_ff(d,a=md5_ff(a,b,c,d,x[i+8],7,1770035416),b,c,x[i+9],12,-1958414417),a,b,x[i+10],17,-42063),d,a,x[i+11],22,-1990404162),c=md5_ff(c,d=md5_ff(d,a=md5_ff(a,b,c,d,x[i+12],7,1804603682),b,c,x[i+13],12,-40341101),a,b,x[i+14],17,-1502002290),d,a,x[i+15],22,1236535329),c=md5_gg(c,d=md5_gg(d,a=md5_gg(a,b,c,d,x[i+1],5,-165796510),b,c,x[i+6],9,-1069501632),a,b,x[i+11],14,643717713),d,a,x[i+0],20,-373897302),c=md5_gg(c,d=md5_gg(d,a=md5_gg(a,b,c,d,x[i+5],5,-701558691),b,c,x[i+10],9,38016083),a,b,x[i+15],14,-660478335),d,a,x[i+4],20,-405537848),c=md5_gg(c,d=md5_gg(d,a=md5_gg(a,b,c,d,x[i+9],5,568446438),b,c,x[i+14],9,-1019803690),a,b,x[i+3],14,-187363961),d,a,x[i+8],20,1163531501),c=md5_gg(c,d=md5_gg(d,a=md5_gg(a,b,c,d,x[i+13],5,-1444681467),b,c,x[i+2],9,-51403784),a,b,x[i+7],14,1735328473),d,a,x[i+12],20,-1926607734),c=md5_hh(c,d=md5_hh(d,a=md5_hh(a,b,c,d,x[i+5],4,-378558),b,c,x[i+8],11,-2022574463),a,b,x[i+11],16,1839030562),d,a,x[i+14],23,-35309556),c=md5_hh(c,d=md5_hh(d,a=md5_hh(a,b,c,d,x[i+1],4,-1530992060),b,c,x[i+4],11,1272893353),a,b,x[i+7],16,-155497632),d,a,x[i+10],23,-1094730640),c=md5_hh(c,d=md5_hh(d,a=md5_hh(a,b,c,d,x[i+13],4,681279174),b,c,x[i+0],11,-358537222),a,b,x[i+3],16,-722521979),d,a,x[i+6],23,76029189),c=md5_hh(c,d=md5_hh(d,a=md5_hh(a,b,c,d,x[i+9],4,-640364487),b,c,x[i+12],11,-421815835),a,b,x[i+15],16,530742520),d,a,x[i+2],23,-995338651),c=md5_ii(c,d=md5_ii(d,a=md5_ii(a,b,c,d,x[i+0],6,-198630844),b,c,x[i+7],10,1126891415),a,b,x[i+14],15,-1416354905),d,a,x[i+5],21,-57434055),c=md5_ii(c,d=md5_ii(d,a=md5_ii(a,b,c,d,x[i+12],6,1700485571),b,c,x[i+3],10,-1894986606),a,b,x[i+10],15,-1051523),d,a,x[i+1],21,-2054922799),c=md5_ii(c,d=md5_ii(d,a=md5_ii(a,b,c,d,x[i+8],6,1873313359),b,c,x[i+15],10,-30611744),a,b,x[i+6],15,-1560198380),d,a,x[i+13],21,1309151649),c=md5_ii(c,d=md5_ii(d,a=md5_ii(a,b,c,d,x[i+4],6,-145523070),b,c,x[i+11],10,-1120210379),a,b,x[i+2],15,718787259),d,a,x[i+9],21,-343485551),a=safe_add(a,olda),b=safe_add(b,oldb),c=safe_add(c,oldc),d=safe_add(d,oldd)}return[a,b,c,d]}function md5_cmn(q,a,b,x,s,t){return safe_add((num=safe_add(safe_add(a,q),safe_add(x,t)))<<(cnt=s)|num>>>32-cnt,b);var num,cnt}function md5_ff(a,b,c,d,x,s,t){return md5_cmn(b&c|~b&d,a,b,x,s,t)}function md5_gg(a,b,c,d,x,s,t){return md5_cmn(b&d|c&~d,a,b,x,s,t)}function md5_hh(a,b,c,d,x,s,t){return md5_cmn(b^c^d,a,b,x,s,t)}function md5_ii(a,b,c,d,x,s,t){return md5_cmn(c^(b|~d),a,b,x,s,t)}function safe_add(x,y){var lsw=(65535&x)+(65535&y);return(x>>16)+(y>>16)+(lsw>>16)<<16|65535&lsw}module.exports=function(buf){return makeHash(buf,core_md5)}},{"./make-hash":301}],303:[function(require,module,exports){"use strict";var inherits=require("inherits"),Legacy=require("./legacy"),Base=require("cipher-base"),Buffer=require("safe-buffer").Buffer,md5=require("create-hash/md5"),RIPEMD160=require("ripemd160"),sha=require("sha.js"),ZEROS=Buffer.alloc(128);function Hmac(alg,key){Base.call(this,"digest"),"string"==typeof key&&(key=Buffer.from(key));var blocksize="sha512"===alg||"sha384"===alg?128:64;if(this._alg=alg,this._key=key,key.length>blocksize){key=("rmd160"===alg?new RIPEMD160:sha(alg)).update(key).digest()}else key.length<blocksize&&(key=Buffer.concat([key,ZEROS],blocksize));for(var ipad=this._ipad=Buffer.allocUnsafe(blocksize),opad=this._opad=Buffer.allocUnsafe(blocksize),i=0;i<blocksize;i++)ipad[i]=54^key[i],opad[i]=92^key[i];this._hash="rmd160"===alg?new RIPEMD160:sha(alg),this._hash.update(ipad)}inherits(Hmac,Base),Hmac.prototype._update=function(data){this._hash.update(data)},Hmac.prototype._final=function(){var h=this._hash.digest();return("rmd160"===this._alg?new RIPEMD160:sha(this._alg)).update(this._opad).update(h).digest()},module.exports=function(alg,key){return"rmd160"===(alg=alg.toLowerCase())||"ripemd160"===alg?new Hmac("rmd160",key):"md5"===alg?new Legacy(md5,key):new Hmac(alg,key)}},{"./legacy":304,"cipher-base":297,"create-hash/md5":302,inherits:352,ripemd160:400,"safe-buffer":401,"sha.js":414}],304:[function(require,module,exports){"use strict";var inherits=require("inherits"),Buffer=require("safe-buffer").Buffer,Base=require("cipher-base"),ZEROS=Buffer.alloc(128),blocksize=64;function Hmac(alg,key){Base.call(this,"digest"),"string"==typeof key&&(key=Buffer.from(key)),this._alg=alg,this._key=key,key.length>blocksize?key=alg(key):key.length<blocksize&&(key=Buffer.concat([key,ZEROS],blocksize));for(var ipad=this._ipad=Buffer.allocUnsafe(blocksize),opad=this._opad=Buffer.allocUnsafe(blocksize),i=0;i<blocksize;i++)ipad[i]=54^key[i],opad[i]=92^key[i];this._hash=[ipad]}inherits(Hmac,Base),Hmac.prototype._update=function(data){this._hash.push(data)},Hmac.prototype._final=function(){var h=this._alg(Buffer.concat(this._hash));return this._alg(Buffer.concat([this._opad,h]))},module.exports=Hmac},{"cipher-base":297,inherits:352,"safe-buffer":401}],305:[function(require,module,exports){"use strict";exports.randomBytes=exports.rng=exports.pseudoRandomBytes=exports.prng=require("randombytes"),exports.createHash=exports.Hash=require("create-hash"),exports.createHmac=exports.Hmac=require("create-hmac");var algos=require("browserify-sign/algos"),algoKeys=Object.keys(algos),hashes=["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(algoKeys);exports.getHashes=function(){return hashes};var p=require("pbkdf2");exports.pbkdf2=p.pbkdf2,exports.pbkdf2Sync=p.pbkdf2Sync;var aes=require("browserify-cipher");exports.Cipher=aes.Cipher,exports.createCipher=aes.createCipher,exports.Cipheriv=aes.Cipheriv,exports.createCipheriv=aes.createCipheriv,exports.Decipher=aes.Decipher,exports.createDecipher=aes.createDecipher,exports.Decipheriv=aes.Decipheriv,exports.createDecipheriv=aes.createDecipheriv,exports.getCiphers=aes.getCiphers,exports.listCiphers=aes.listCiphers;var dh=require("diffie-hellman");exports.DiffieHellmanGroup=dh.DiffieHellmanGroup,exports.createDiffieHellmanGroup=dh.createDiffieHellmanGroup,exports.getDiffieHellman=dh.getDiffieHellman,exports.createDiffieHellman=dh.createDiffieHellman,exports.DiffieHellman=dh.DiffieHellman;var sign=require("browserify-sign");exports.createSign=sign.createSign,exports.Sign=sign.Sign,exports.createVerify=sign.createVerify,exports.Verify=sign.Verify,exports.createECDH=require("create-ecdh");var publicEncrypt=require("public-encrypt");exports.publicEncrypt=publicEncrypt.publicEncrypt,exports.privateEncrypt=publicEncrypt.privateEncrypt,exports.publicDecrypt=publicEncrypt.publicDecrypt,exports.privateDecrypt=publicEncrypt.privateDecrypt;var rf=require("randomfill");exports.randomFill=rf.randomFill,exports.randomFillSync=rf.randomFillSync,exports.createCredentials=function(){throw new Error(["sorry, createCredentials is not implemented yet","we accept pull requests","https://github.com/crypto-browserify/crypto-browserify"].join("\n"))},exports.constants={DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,NPN_ENABLED:1,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_SSLV23_PADDING:2,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6}},{"browserify-cipher":237,"browserify-sign":244,"browserify-sign/algos":241,"create-ecdh":299,"create-hash":300,"create-hmac":303,"diffie-hellman":312,pbkdf2:368,"public-encrypt":375,randombytes:385,randomfill:386}],306:[function(require,module,exports){"use strict";exports.utils=require("./des/utils"),exports.Cipher=require("./des/cipher"),exports.DES=require("./des/des"),exports.CBC=require("./des/cbc"),exports.EDE=require("./des/ede")},{"./des/cbc":307,"./des/cipher":308,"./des/des":309,"./des/ede":310,"./des/utils":311}],307:[function(require,module,exports){"use strict";var assert=require("minimalistic-assert"),inherits=require("inherits"),proto={};exports.instantiate=function(Base){function CBC(options){Base.call(this,options),this._cbcInit()}inherits(CBC,Base);for(var keys=Object.keys(proto),i=0;i<keys.length;i++){var key=keys[i];CBC.prototype[key]=proto[key]}return CBC.create=function(options){return new CBC(options)},CBC},proto._cbcInit=function(){var state=new function(iv){assert.equal(iv.length,8,"Invalid IV length"),this.iv=new Array(8);for(var i=0;i<this.iv.length;i++)this.iv[i]=iv[i]}(this.options.iv);this._cbcState=state},proto._update=function(inp,inOff,out,outOff){var state=this._cbcState,superProto=this.constructor.super_.prototype,iv=state.iv;if("encrypt"===this.type){for(var i=0;i<this.blockSize;i++)iv[i]^=inp[inOff+i];superProto._update.call(this,iv,0,out,outOff);for(i=0;i<this.blockSize;i++)iv[i]=out[outOff+i]}else{superProto._update.call(this,inp,inOff,out,outOff);for(i=0;i<this.blockSize;i++)out[outOff+i]^=iv[i];for(i=0;i<this.blockSize;i++)iv[i]=inp[inOff+i]}}},{inherits:352,"minimalistic-assert":358}],308:[function(require,module,exports){"use strict";var assert=require("minimalistic-assert");function Cipher(options){this.options=options,this.type=this.options.type,this.blockSize=8,this._init(),this.buffer=new Array(this.blockSize),this.bufferOff=0}module.exports=Cipher,Cipher.prototype._init=function(){},Cipher.prototype.update=function(data){return 0===data.length?[]:"decrypt"===this.type?this._updateDecrypt(data):this._updateEncrypt(data)},Cipher.prototype._buffer=function(data,off){for(var min=Math.min(this.buffer.length-this.bufferOff,data.length-off),i=0;i<min;i++)this.buffer[this.bufferOff+i]=data[off+i];return this.bufferOff+=min,min},Cipher.prototype._flushBuffer=function(out,off){return this._update(this.buffer,0,out,off),this.bufferOff=0,this.blockSize},Cipher.prototype._updateEncrypt=function(data){var inputOff=0,outputOff=0,count=(this.bufferOff+data.length)/this.blockSize|0,out=new Array(count*this.blockSize);0!==this.bufferOff&&(inputOff+=this._buffer(data,inputOff),this.bufferOff===this.buffer.length&&(outputOff+=this._flushBuffer(out,outputOff)));for(var max=data.length-(data.length-inputOff)%this.blockSize;inputOff<max;inputOff+=this.blockSize)this._update(data,inputOff,out,outputOff),outputOff+=this.blockSize;for(;inputOff<data.length;inputOff++,this.bufferOff++)this.buffer[this.bufferOff]=data[inputOff];return out},Cipher.prototype._updateDecrypt=function(data){for(var inputOff=0,outputOff=0,count=Math.ceil((this.bufferOff+data.length)/this.blockSize)-1,out=new Array(count*this.blockSize);count>0;count--)inputOff+=this._buffer(data,inputOff),outputOff+=this._flushBuffer(out,outputOff);return inputOff+=this._buffer(data,inputOff),out},Cipher.prototype.final=function(buffer){var first;buffer&&(first=this.update(buffer));var last;return last="encrypt"===this.type?this._finalEncrypt():this._finalDecrypt(),first?first.concat(last):last},Cipher.prototype._pad=function(buffer,off){if(0===off)return!1;for(;off<buffer.length;)buffer[off++]=0;return!0},Cipher.prototype._finalEncrypt=function(){if(!this._pad(this.buffer,this.bufferOff))return[];var out=new Array(this.blockSize);return this._update(this.buffer,0,out,0),out},Cipher.prototype._unpad=function(buffer){return buffer},Cipher.prototype._finalDecrypt=function(){assert.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var out=new Array(this.blockSize);return this._flushBuffer(out,0),this._unpad(out)}},{"minimalistic-assert":358}],309:[function(require,module,exports){"use strict";var assert=require("minimalistic-assert"),inherits=require("inherits"),des=require("../des"),utils=des.utils,Cipher=des.Cipher;function DES(options){Cipher.call(this,options);var state=new function(){this.tmp=new Array(2),this.keys=null};this._desState=state,this.deriveKeys(state,options.key)}inherits(DES,Cipher),module.exports=DES,DES.create=function(options){return new DES(options)};var shiftTable=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];DES.prototype.deriveKeys=function(state,key){state.keys=new Array(32),assert.equal(key.length,this.blockSize,"Invalid key length");var kL=utils.readUInt32BE(key,0),kR=utils.readUInt32BE(key,4);utils.pc1(kL,kR,state.tmp,0),kL=state.tmp[0],kR=state.tmp[1];for(var i=0;i<state.keys.length;i+=2){var shift=shiftTable[i>>>1];kL=utils.r28shl(kL,shift),kR=utils.r28shl(kR,shift),utils.pc2(kL,kR,state.keys,i)}},DES.prototype._update=function(inp,inOff,out,outOff){var state=this._desState,l=utils.readUInt32BE(inp,inOff),r=utils.readUInt32BE(inp,inOff+4);utils.ip(l,r,state.tmp,0),l=state.tmp[0],r=state.tmp[1],"encrypt"===this.type?this._encrypt(state,l,r,state.tmp,0):this._decrypt(state,l,r,state.tmp,0),l=state.tmp[0],r=state.tmp[1],utils.writeUInt32BE(out,l,outOff),utils.writeUInt32BE(out,r,outOff+4)},DES.prototype._pad=function(buffer,off){for(var value=buffer.length-off,i=off;i<buffer.length;i++)buffer[i]=value;return!0},DES.prototype._unpad=function(buffer){for(var pad=buffer[buffer.length-1],i=buffer.length-pad;i<buffer.length;i++)assert.equal(buffer[i],pad);return buffer.slice(0,buffer.length-pad)},DES.prototype._encrypt=function(state,lStart,rStart,out,off){for(var l=lStart,r=rStart,i=0;i<state.keys.length;i+=2){var keyL=state.keys[i],keyR=state.keys[i+1];utils.expand(r,state.tmp,0),keyL^=state.tmp[0],keyR^=state.tmp[1];var s=utils.substitute(keyL,keyR),t=r;r=(l^utils.permute(s))>>>0,l=t}utils.rip(r,l,out,off)},DES.prototype._decrypt=function(state,lStart,rStart,out,off){for(var l=rStart,r=lStart,i=state.keys.length-2;i>=0;i-=2){var keyL=state.keys[i],keyR=state.keys[i+1];utils.expand(l,state.tmp,0),keyL^=state.tmp[0],keyR^=state.tmp[1];var s=utils.substitute(keyL,keyR),t=l;l=(r^utils.permute(s))>>>0,r=t}utils.rip(l,r,out,off)}},{"../des":306,inherits:352,"minimalistic-assert":358}],310:[function(require,module,exports){"use strict";var assert=require("minimalistic-assert"),inherits=require("inherits"),des=require("../des"),Cipher=des.Cipher,DES=des.DES;function EDE(options){Cipher.call(this,options);var state=new function(type,key){assert.equal(key.length,24,"Invalid key length");var k1=key.slice(0,8),k2=key.slice(8,16),k3=key.slice(16,24);this.ciphers="encrypt"===type?[DES.create({type:"encrypt",key:k1}),DES.create({type:"decrypt",key:k2}),DES.create({type:"encrypt",key:k3})]:[DES.create({type:"decrypt",key:k3}),DES.create({type:"encrypt",key:k2}),DES.create({type:"decrypt",key:k1})]}(this.type,this.options.key);this._edeState=state}inherits(EDE,Cipher),module.exports=EDE,EDE.create=function(options){return new EDE(options)},EDE.prototype._update=function(inp,inOff,out,outOff){var state=this._edeState;state.ciphers[0]._update(inp,inOff,out,outOff),state.ciphers[1]._update(out,outOff,out,outOff),state.ciphers[2]._update(out,outOff,out,outOff)},EDE.prototype._pad=DES.prototype._pad,EDE.prototype._unpad=DES.prototype._unpad},{"../des":306,inherits:352,"minimalistic-assert":358}],311:[function(require,module,exports){"use strict";exports.readUInt32BE=function(bytes,off){return(bytes[0+off]<<24|bytes[1+off]<<16|bytes[2+off]<<8|bytes[3+off])>>>0},exports.writeUInt32BE=function(bytes,value,off){bytes[0+off]=value>>>24,bytes[1+off]=value>>>16&255,bytes[2+off]=value>>>8&255,bytes[3+off]=255&value},exports.ip=function(inL,inR,out,off){for(var outL=0,outR=0,i=6;i>=0;i-=2){for(var j=0;j<=24;j+=8)outL<<=1,outL|=inR>>>j+i&1;for(j=0;j<=24;j+=8)outL<<=1,outL|=inL>>>j+i&1}for(i=6;i>=0;i-=2){for(j=1;j<=25;j+=8)outR<<=1,outR|=inR>>>j+i&1;for(j=1;j<=25;j+=8)outR<<=1,outR|=inL>>>j+i&1}out[off+0]=outL>>>0,out[off+1]=outR>>>0},exports.rip=function(inL,inR,out,off){for(var outL=0,outR=0,i=0;i<4;i++)for(var j=24;j>=0;j-=8)outL<<=1,outL|=inR>>>j+i&1,outL<<=1,outL|=inL>>>j+i&1;for(i=4;i<8;i++)for(j=24;j>=0;j-=8)outR<<=1,outR|=inR>>>j+i&1,outR<<=1,outR|=inL>>>j+i&1;out[off+0]=outL>>>0,out[off+1]=outR>>>0},exports.pc1=function(inL,inR,out,off){for(var outL=0,outR=0,i=7;i>=5;i--){for(var j=0;j<=24;j+=8)outL<<=1,outL|=inR>>j+i&1;for(j=0;j<=24;j+=8)outL<<=1,outL|=inL>>j+i&1}for(j=0;j<=24;j+=8)outL<<=1,outL|=inR>>j+i&1;for(i=1;i<=3;i++){for(j=0;j<=24;j+=8)outR<<=1,outR|=inR>>j+i&1;for(j=0;j<=24;j+=8)outR<<=1,outR|=inL>>j+i&1}for(j=0;j<=24;j+=8)outR<<=1,outR|=inL>>j+i&1;out[off+0]=outL>>>0,out[off+1]=outR>>>0},exports.r28shl=function(num,shift){return num<<shift&268435455|num>>>28-shift};var pc2table=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];exports.pc2=function(inL,inR,out,off){for(var outL=0,outR=0,len=pc2table.length>>>1,i=0;i<len;i++)outL<<=1,outL|=inL>>>pc2table[i]&1;for(i=len;i<pc2table.length;i++)outR<<=1,outR|=inR>>>pc2table[i]&1;out[off+0]=outL>>>0,out[off+1]=outR>>>0},exports.expand=function(r,out,off){var outL=0,outR=0;outL=(1&r)<<5|r>>>27;for(var i=23;i>=15;i-=4)outL<<=6,outL|=r>>>i&63;for(i=11;i>=3;i-=4)outR|=r>>>i&63,outR<<=6;outR|=(31&r)<<1|r>>>31,out[off+0]=outL>>>0,out[off+1]=outR>>>0};var sTable=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];exports.substitute=function(inL,inR){for(var out=0,i=0;i<4;i++){out<<=4,out|=sTable[64*i+(inL>>>18-6*i&63)]}for(i=0;i<4;i++){out<<=4,out|=sTable[256+64*i+(inR>>>18-6*i&63)]}return out>>>0};var permuteTable=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];exports.permute=function(num){for(var out=0,i=0;i<permuteTable.length;i++)out<<=1,out|=num>>>permuteTable[i]&1;return out>>>0},exports.padSplit=function(num,size,group){for(var str=num.toString(2);str.length<size;)str="0"+str;for(var out=[],i=0;i<size;i+=group)out.push(str.slice(i,i+group));return out.join(" ")}},{}],312:[function(require,module,exports){(function(Buffer){var generatePrime=require("./lib/generatePrime"),primes=require("./lib/primes.json"),DH=require("./lib/dh");var ENCODINGS={binary:!0,hex:!0,base64:!0};exports.DiffieHellmanGroup=exports.createDiffieHellmanGroup=exports.getDiffieHellman=function(mod){var prime=new Buffer(primes[mod].prime,"hex"),gen=new Buffer(primes[mod].gen,"hex");return new DH(prime,gen)},exports.createDiffieHellman=exports.DiffieHellman=function createDiffieHellman(prime,enc,generator,genc){return Buffer.isBuffer(enc)||void 0===ENCODINGS[enc]?createDiffieHellman(prime,"binary",enc,generator):(enc=enc||"binary",genc=genc||"binary",generator=generator||new Buffer([2]),Buffer.isBuffer(generator)||(generator=new Buffer(generator,genc)),"number"==typeof prime?new DH(generatePrime(prime,generator),generator,!0):(Buffer.isBuffer(prime)||(prime=new Buffer(prime,enc)),new DH(prime,generator,!0)))}}).call(this,require("buffer").Buffer)},{"./lib/dh":313,"./lib/generatePrime":314,"./lib/primes.json":315,buffer:269}],313:[function(require,module,exports){(function(Buffer){var BN=require("bn.js"),millerRabin=new(require("miller-rabin")),TWENTYFOUR=new BN(24),ELEVEN=new BN(11),TEN=new BN(10),THREE=new BN(3),SEVEN=new BN(7),primes=require("./generatePrime"),randomBytes=require("randombytes");module.exports=DH;function setPublicKey(pub,enc){return enc=enc||"utf8",Buffer.isBuffer(pub)||(pub=new Buffer(pub,enc)),this._pub=new BN(pub),this}function setPrivateKey(priv,enc){return enc=enc||"utf8",Buffer.isBuffer(priv)||(priv=new Buffer(priv,enc)),this._priv=new BN(priv),this}var primeCache={};function DH(prime,generator,malleable){this.setGenerator(generator),this.__prime=new BN(prime),this._prime=BN.mont(this.__prime),this._primeLen=prime.length,this._pub=void 0,this._priv=void 0,this._primeCode=void 0,malleable?(this.setPublicKey=setPublicKey,this.setPrivateKey=setPrivateKey):this._primeCode=8}Object.defineProperty(DH.prototype,"verifyError",{enumerable:!0,get:function(){return"number"!=typeof this._primeCode&&(this._primeCode=function(prime,generator){var gen=generator.toString("hex"),hex=[gen,prime.toString(16)].join("_");if(hex in primeCache)return primeCache[hex];var error=0;if(prime.isEven()||!primes.simpleSieve||!primes.fermatTest(prime)||!millerRabin.test(prime))return error+=1,error+="02"===gen||"05"===gen?8:4,primeCache[hex]=error,error;millerRabin.test(prime.shrn(1))||(error+=2);var rem;switch(gen){case"02":prime.mod(TWENTYFOUR).cmp(ELEVEN)&&(error+=8);break;case"05":(rem=prime.mod(TEN)).cmp(THREE)&&rem.cmp(SEVEN)&&(error+=8);break;default:error+=4}return primeCache[hex]=error,error}(this.__prime,this.__gen)),this._primeCode}}),DH.prototype.generateKeys=function(){return this._priv||(this._priv=new BN(randomBytes(this._primeLen))),this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed(),this.getPublicKey()},DH.prototype.computeSecret=function(other){var secret=(other=(other=new BN(other)).toRed(this._prime)).redPow(this._priv).fromRed(),out=new Buffer(secret.toArray()),prime=this.getPrime();if(out.length<prime.length){var front=new Buffer(prime.length-out.length);front.fill(0),out=Buffer.concat([front,out])}return out},DH.prototype.getPublicKey=function(enc){return formatReturnValue(this._pub,enc)},DH.prototype.getPrivateKey=function(enc){return formatReturnValue(this._priv,enc)},DH.prototype.getPrime=function(enc){return formatReturnValue(this.__prime,enc)},DH.prototype.getGenerator=function(enc){return formatReturnValue(this._gen,enc)},DH.prototype.setGenerator=function(gen,enc){return enc=enc||"utf8",Buffer.isBuffer(gen)||(gen=new Buffer(gen,enc)),this.__gen=gen,this._gen=new BN(gen),this};function formatReturnValue(bn,enc){var buf=new Buffer(bn.toArray());return enc?buf.toString(enc):buf}}).call(this,require("buffer").Buffer)},{"./generatePrime":314,"bn.js":217,buffer:269,"miller-rabin":357,randombytes:385}],314:[function(require,module,exports){var randomBytes=require("randombytes");module.exports=findPrime,findPrime.simpleSieve=simpleSieve,findPrime.fermatTest=fermatTest;var BN=require("bn.js"),TWENTYFOUR=new BN(24),millerRabin=new(require("miller-rabin")),ONE=new BN(1),TWO=new BN(2),FIVE=new BN(5),TEN=(new BN(16),new BN(8),new BN(10)),THREE=new BN(3),ELEVEN=(new BN(7),new BN(11)),FOUR=new BN(4),primes=(new BN(12),null);function _getPrimes(){if(null!==primes)return primes;var res=[];res[0]=2;for(var i=1,k=3;k<1048576;k+=2){for(var sqrt=Math.ceil(Math.sqrt(k)),j=0;j<i&&res[j]<=sqrt&&k%res[j]!=0;j++);i!==j&&res[j]<=sqrt||(res[i++]=k)}return primes=res,res}function simpleSieve(p){for(var primes=_getPrimes(),i=0;i<primes.length;i++)if(0===p.modn(primes[i]))return 0===p.cmpn(primes[i]);return!0}function fermatTest(p){var red=BN.mont(p);return 0===TWO.toRed(red).redPow(p.subn(1)).fromRed().cmpn(1)}function findPrime(bits,gen){if(bits<16)return new BN(2===gen||5===gen?[140,123]:[140,39]);gen=new BN(gen);for(var num,n2;;){for(num=new BN(randomBytes(Math.ceil(bits/8)));num.bitLength()>bits;)num.ishrn(1);if(num.isEven()&&num.iadd(ONE),num.testn(1)||num.iadd(TWO),gen.cmp(TWO)){if(!gen.cmp(FIVE))for(;num.mod(TEN).cmp(THREE);)num.iadd(FOUR)}else for(;num.mod(TWENTYFOUR).cmp(ELEVEN);)num.iadd(FOUR);if(simpleSieve(n2=num.shrn(1))&&simpleSieve(num)&&fermatTest(n2)&&fermatTest(num)&&millerRabin.test(n2)&&millerRabin.test(num))return num}}},{"bn.js":217,"miller-rabin":357,randombytes:385}],315:[function(require,module,exports){module.exports={modp1:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},modp2:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},modp5:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},modp14:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},modp15:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},modp16:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},modp17:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},modp18:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"}}},{}],316:[function(require,module,exports){(function(Buffer){"use strict";var createHmac=require("create-hmac"),hashInfo=require("./lib/hash-info.json"),ebuf=new Buffer(0),b0x00=new Buffer([0]),b0x01=new Buffer([1]);function HmacDRBG(algo,entropy,nonce,pers){var info=hashInfo[algo];if(void 0===info)throw new Error("hash "+algo+" is not supported");this._algo=algo,this._securityStrength=info.securityStrength/8,this._outlen=info.outlen/8,this._reseedInterval=281474976710656,this._init(entropy,nonce,pers)}HmacDRBG.prototype._update=function(seed){var kmac=createHmac(this._algo,this._K).update(this._V).update(b0x00);seed&&kmac.update(seed),this._K=kmac.digest(),this._V=createHmac(this._algo,this._K).update(this._V).digest(),seed&&(this._K=createHmac(this._algo,this._K).update(this._V).update(b0x01).update(seed).digest(),this._V=createHmac(this._algo,this._K).update(this._V).digest())},HmacDRBG.prototype._init=function(entropy,nonce,pers){if(entropy.length<this._securityStrength)throw new Error("Not enough entropy");this._K=new Buffer(this._outlen),this._V=new Buffer(this._outlen);for(var i=0;i<this._K.length;++i)this._K[i]=0,this._V[i]=1;this._update(Buffer.concat([entropy,nonce,pers||ebuf])),this._reseed=1},HmacDRBG.prototype.reseed=function(entropy,add){if(entropy.length<this._securityStrength)throw new Error("Not enough entropy");this._update(Buffer.concat([entropy,add||ebuf])),this._reseed=1},HmacDRBG.prototype.generate=function(len,add){if(this._reseed>this._reseedInterval)throw new Error("Reseed is required");add&&0===add.length&&(add=void 0),add&&this._update(add);for(var temp=new Buffer(0);temp.length<len;)this._V=createHmac(this._algo,this._K).update(this._V).digest(),temp=Buffer.concat([temp,this._V]);return this._update(add),this._reseed+=1,temp.slice(0,len)},module.exports=HmacDRBG}).call(this,require("buffer").Buffer)},{"./lib/hash-info.json":317,buffer:269,"create-hmac":303}],317:[function(require,module,exports){module.exports={sha1:{securityStrength:128,outlen:160,seedlen:440},sha224:{securityStrength:192,outlen:224,seedlen:440},sha256:{securityStrength:256,outlen:256,seedlen:440},sha384:{securityStrength:256,outlen:384,seedlen:888},sha512:{securityStrength:256,outlen:512,seedlen:888}}},{}],318:[function(require,module,exports){"use strict";var elliptic=exports;elliptic.version=require("../package.json").version,elliptic.utils=require("./elliptic/utils"),elliptic.rand=require("brorand"),elliptic.curve=require("./elliptic/curve"),elliptic.curves=require("./elliptic/curves"),elliptic.ec=require("./elliptic/ec"),elliptic.eddsa=require("./elliptic/eddsa")},{"../package.json":333,"./elliptic/curve":321,"./elliptic/curves":324,"./elliptic/ec":325,"./elliptic/eddsa":328,"./elliptic/utils":332,brorand:218}],319:[function(require,module,exports){"use strict";var BN=require("bn.js"),utils=require("../../elliptic").utils,getNAF=utils.getNAF,getJSF=utils.getJSF,assert=utils.assert;function BaseCurve(type,conf){this.type=type,this.p=new BN(conf.p,16),this.red=conf.prime?BN.red(conf.prime):BN.mont(this.p),this.zero=new BN(0).toRed(this.red),this.one=new BN(1).toRed(this.red),this.two=new BN(2).toRed(this.red),this.n=conf.n&&new BN(conf.n,16),this.g=conf.g&&this.pointFromJSON(conf.g,conf.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4);var adjustCount=this.n&&this.p.div(this.n);!adjustCount||adjustCount.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}module.exports=BaseCurve,BaseCurve.prototype.point=function(){throw new Error("Not implemented")},BaseCurve.prototype.validate=function(){throw new Error("Not implemented")},BaseCurve.prototype._fixedNafMul=function(p,k){assert(p.precomputed);var doubles=p._getDoubles(),naf=getNAF(k,1),I=(1<<doubles.step+1)-(doubles.step%2==0?2:1);I/=3;for(var repr=[],j=0;j<naf.length;j+=doubles.step){var nafW=0;for(k=j+doubles.step-1;k>=j;k--)nafW=(nafW<<1)+naf[k];repr.push(nafW)}for(var a=this.jpoint(null,null,null),b=this.jpoint(null,null,null),i=I;i>0;i--){for(j=0;j<repr.length;j++){(nafW=repr[j])===i?b=b.mixedAdd(doubles.points[j]):nafW===-i&&(b=b.mixedAdd(doubles.points[j].neg()))}a=a.add(b)}return a.toP()},BaseCurve.prototype._wnafMul=function(p,k){var w=4,nafPoints=p._getNAFPoints(w);w=nafPoints.wnd;for(var wnd=nafPoints.points,naf=getNAF(k,w),acc=this.jpoint(null,null,null),i=naf.length-1;i>=0;i--){for(k=0;i>=0&&0===naf[i];i--)k++;if(i>=0&&k++,acc=acc.dblp(k),i<0)break;var z=naf[i];assert(0!==z),acc="affine"===p.type?z>0?acc.mixedAdd(wnd[z-1>>1]):acc.mixedAdd(wnd[-z-1>>1].neg()):z>0?acc.add(wnd[z-1>>1]):acc.add(wnd[-z-1>>1].neg())}return"affine"===p.type?acc.toP():acc},BaseCurve.prototype._wnafMulAdd=function(defW,points,coeffs,len,jacobianResult){for(var wndWidth=this._wnafT1,wnd=this._wnafT2,naf=this._wnafT3,max=0,i=0;i<len;i++){var nafPoints=(p=points[i])._getNAFPoints(defW);wndWidth[i]=nafPoints.wnd,wnd[i]=nafPoints.points}for(i=len-1;i>=1;i-=2){var a=i-1,b=i;if(1===wndWidth[a]&&1===wndWidth[b]){var comb=[points[a],null,null,points[b]];0===points[a].y.cmp(points[b].y)?(comb[1]=points[a].add(points[b]),comb[2]=points[a].toJ().mixedAdd(points[b].neg())):0===points[a].y.cmp(points[b].y.redNeg())?(comb[1]=points[a].toJ().mixedAdd(points[b]),comb[2]=points[a].add(points[b].neg())):(comb[1]=points[a].toJ().mixedAdd(points[b]),comb[2]=points[a].toJ().mixedAdd(points[b].neg()));var index=[-3,-1,-5,-7,0,7,5,1,3],jsf=getJSF(coeffs[a],coeffs[b]);max=Math.max(jsf[0].length,max),naf[a]=new Array(max),naf[b]=new Array(max);for(var j=0;j<max;j++){var ja=0|jsf[0][j],jb=0|jsf[1][j];naf[a][j]=index[3*(ja+1)+(jb+1)],naf[b][j]=0,wnd[a]=comb}}else naf[a]=getNAF(coeffs[a],wndWidth[a]),naf[b]=getNAF(coeffs[b],wndWidth[b]),max=Math.max(naf[a].length,max),max=Math.max(naf[b].length,max)}var acc=this.jpoint(null,null,null),tmp=this._wnafT4;for(i=max;i>=0;i--){for(var k=0;i>=0;){var zero=!0;for(j=0;j<len;j++)tmp[j]=0|naf[j][i],0!==tmp[j]&&(zero=!1);if(!zero)break;k++,i--}if(i>=0&&k++,acc=acc.dblp(k),i<0)break;for(j=0;j<len;j++){var p,z=tmp[j];0!==z&&(z>0?p=wnd[j][z-1>>1]:z<0&&(p=wnd[j][-z-1>>1].neg()),acc="affine"===p.type?acc.mixedAdd(p):acc.add(p))}}for(i=0;i<len;i++)wnd[i]=null;return jacobianResult?acc:acc.toP()};function BasePoint(curve,type){this.curve=curve,this.type=type,this.precomputed=null}BaseCurve.BasePoint=BasePoint,BasePoint.prototype.eq=function(){throw new Error("Not implemented")},BasePoint.prototype.validate=function(){return this.curve.validate(this)},BaseCurve.prototype.decodePoint=function(bytes,enc){bytes=utils.toArray(bytes,enc);var len=this.p.byteLength();if((4===bytes[0]||6===bytes[0]||7===bytes[0])&&bytes.length-1==2*len){6===bytes[0]?assert(bytes[bytes.length-1]%2==0):7===bytes[0]&&assert(bytes[bytes.length-1]%2==1);return this.point(bytes.slice(1,1+len),bytes.slice(1+len,1+2*len))}if((2===bytes[0]||3===bytes[0])&&bytes.length-1===len)return this.pointFromX(bytes.slice(1,1+len),3===bytes[0]);throw new Error("Unknown point format")},BasePoint.prototype.encodeCompressed=function(enc){return this.encode(enc,!0)},BasePoint.prototype._encode=function(compact){var len=this.curve.p.byteLength(),x=this.getX().toArray("be",len);return compact?[this.getY().isEven()?2:3].concat(x):[4].concat(x,this.getY().toArray("be",len))},BasePoint.prototype.encode=function(enc,compact){return utils.encode(this._encode(compact),enc)},BasePoint.prototype.precompute=function(power){if(this.precomputed)return this;var precomputed={doubles:null,naf:null,beta:null};return precomputed.naf=this._getNAFPoints(8),precomputed.doubles=this._getDoubles(4,power),precomputed.beta=this._getBeta(),this.precomputed=precomputed,this},BasePoint.prototype._hasDoubles=function(k){if(!this.precomputed)return!1;var doubles=this.precomputed.doubles;return!!doubles&&doubles.points.length>=Math.ceil((k.bitLength()+1)/doubles.step)},BasePoint.prototype._getDoubles=function(step,power){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var doubles=[this],acc=this,i=0;i<power;i+=step){for(var j=0;j<step;j++)acc=acc.dbl();doubles.push(acc)}return{step:step,points:doubles}},BasePoint.prototype._getNAFPoints=function(wnd){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var res=[this],max=(1<<wnd)-1,dbl=1===max?null:this.dbl(),i=1;i<max;i++)res[i]=res[i-1].add(dbl);return{wnd:wnd,points:res}},BasePoint.prototype._getBeta=function(){return null},BasePoint.prototype.dblp=function(k){for(var r=this,i=0;i<k;i++)r=r.dbl();return r}},{"../../elliptic":318,"bn.js":217}],320:[function(require,module,exports){"use strict";var curve=require("../curve"),elliptic=require("../../elliptic"),BN=require("bn.js"),inherits=require("inherits"),Base=curve.base,assert=elliptic.utils.assert;function EdwardsCurve(conf){this.twisted=1!=(0|conf.a),this.mOneA=this.twisted&&-1==(0|conf.a),this.extended=this.mOneA,Base.call(this,"edwards",conf),this.a=new BN(conf.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new BN(conf.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new BN(conf.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),assert(!this.twisted||0===this.c.fromRed().cmpn(1)),this.oneC=1==(0|conf.c)}inherits(EdwardsCurve,Base),module.exports=EdwardsCurve,EdwardsCurve.prototype._mulA=function(num){return this.mOneA?num.redNeg():this.a.redMul(num)},EdwardsCurve.prototype._mulC=function(num){return this.oneC?num:this.c.redMul(num)},EdwardsCurve.prototype.jpoint=function(x,y,z,t){return this.point(x,y,z,t)},EdwardsCurve.prototype.pointFromX=function(x,odd){(x=new BN(x,16)).red||(x=x.toRed(this.red));var x2=x.redSqr(),rhs=this.c2.redSub(this.a.redMul(x2)),lhs=this.one.redSub(this.c2.redMul(this.d).redMul(x2)),y2=rhs.redMul(lhs.redInvm()),y=y2.redSqrt();if(0!==y.redSqr().redSub(y2).cmp(this.zero))throw new Error("invalid point");var isOdd=y.fromRed().isOdd();return(odd&&!isOdd||!odd&&isOdd)&&(y=y.redNeg()),this.point(x,y)},EdwardsCurve.prototype.pointFromY=function(y,odd){(y=new BN(y,16)).red||(y=y.toRed(this.red));var y2=y.redSqr(),lhs=y2.redSub(this.one),rhs=y2.redMul(this.d).redAdd(this.one),x2=lhs.redMul(rhs.redInvm());if(0===x2.cmp(this.zero)){if(odd)throw new Error("invalid point");return this.point(this.zero,y)}var x=x2.redSqrt();if(0!==x.redSqr().redSub(x2).cmp(this.zero))throw new Error("invalid point");return x.isOdd()!==odd&&(x=x.redNeg()),this.point(x,y)},EdwardsCurve.prototype.validate=function(point){if(point.isInfinity())return!0;point.normalize();var x2=point.x.redSqr(),y2=point.y.redSqr(),lhs=x2.redMul(this.a).redAdd(y2),rhs=this.c2.redMul(this.one.redAdd(this.d.redMul(x2).redMul(y2)));return 0===lhs.cmp(rhs)};function Point(curve,x,y,z,t){Base.BasePoint.call(this,curve,"projective"),null===x&&null===y&&null===z?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new BN(x,16),this.y=new BN(y,16),this.z=z?new BN(z,16):this.curve.one,this.t=t&&new BN(t,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}inherits(Point,Base.BasePoint),EdwardsCurve.prototype.pointFromJSON=function(obj){return Point.fromJSON(this,obj)},EdwardsCurve.prototype.point=function(x,y,z,t){return new Point(this,x,y,z,t)},Point.fromJSON=function(curve,obj){return new Point(curve,obj[0],obj[1],obj[2])},Point.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},Point.prototype.isInfinity=function(){return 0===this.x.cmpn(0)&&0===this.y.cmp(this.z)},Point.prototype._extDbl=function(){var a=this.x.redSqr(),b=this.y.redSqr(),c=this.z.redSqr();c=c.redIAdd(c);var d=this.curve._mulA(a),e=this.x.redAdd(this.y).redSqr().redISub(a).redISub(b),g=d.redAdd(b),f=g.redSub(c),h=d.redSub(b),nx=e.redMul(f),ny=g.redMul(h),nt=e.redMul(h),nz=f.redMul(g);return this.curve.point(nx,ny,nz,nt)},Point.prototype._projDbl=function(){var nx,ny,nz,b=this.x.redAdd(this.y).redSqr(),c=this.x.redSqr(),d=this.y.redSqr();if(this.curve.twisted){var f=(e=this.curve._mulA(c)).redAdd(d);if(this.zOne)nx=b.redSub(c).redSub(d).redMul(f.redSub(this.curve.two)),ny=f.redMul(e.redSub(d)),nz=f.redSqr().redSub(f).redSub(f);else{var h=this.z.redSqr(),j=f.redSub(h).redISub(h);nx=b.redSub(c).redISub(d).redMul(j),ny=f.redMul(e.redSub(d)),nz=f.redMul(j)}}else{var e=c.redAdd(d);h=this.curve._mulC(this.c.redMul(this.z)).redSqr(),j=e.redSub(h).redSub(h);nx=this.curve._mulC(b.redISub(e)).redMul(j),ny=this.curve._mulC(e).redMul(c.redISub(d)),nz=e.redMul(j)}return this.curve.point(nx,ny,nz)},Point.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},Point.prototype._extAdd=function(p){var a=this.y.redSub(this.x).redMul(p.y.redSub(p.x)),b=this.y.redAdd(this.x).redMul(p.y.redAdd(p.x)),c=this.t.redMul(this.curve.dd).redMul(p.t),d=this.z.redMul(p.z.redAdd(p.z)),e=b.redSub(a),f=d.redSub(c),g=d.redAdd(c),h=b.redAdd(a),nx=e.redMul(f),ny=g.redMul(h),nt=e.redMul(h),nz=f.redMul(g);return this.curve.point(nx,ny,nz,nt)},Point.prototype._projAdd=function(p){var ny,nz,a=this.z.redMul(p.z),b=a.redSqr(),c=this.x.redMul(p.x),d=this.y.redMul(p.y),e=this.curve.d.redMul(c).redMul(d),f=b.redSub(e),g=b.redAdd(e),tmp=this.x.redAdd(this.y).redMul(p.x.redAdd(p.y)).redISub(c).redISub(d),nx=a.redMul(f).redMul(tmp);return this.curve.twisted?(ny=a.redMul(g).redMul(d.redSub(this.curve._mulA(c))),nz=f.redMul(g)):(ny=a.redMul(g).redMul(d.redSub(c)),nz=this.curve._mulC(f).redMul(g)),this.curve.point(nx,ny,nz)},Point.prototype.add=function(p){return this.isInfinity()?p:p.isInfinity()?this:this.curve.extended?this._extAdd(p):this._projAdd(p)},Point.prototype.mul=function(k){return this._hasDoubles(k)?this.curve._fixedNafMul(this,k):this.curve._wnafMul(this,k)},Point.prototype.mulAdd=function(k1,p,k2){return this.curve._wnafMulAdd(1,[this,p],[k1,k2],2,!1)},Point.prototype.jmulAdd=function(k1,p,k2){return this.curve._wnafMulAdd(1,[this,p],[k1,k2],2,!0)},Point.prototype.normalize=function(){if(this.zOne)return this;var zi=this.z.redInvm();return this.x=this.x.redMul(zi),this.y=this.y.redMul(zi),this.t&&(this.t=this.t.redMul(zi)),this.z=this.curve.one,this.zOne=!0,this},Point.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},Point.prototype.getX=function(){return this.normalize(),this.x.fromRed()},Point.prototype.getY=function(){return this.normalize(),this.y.fromRed()},Point.prototype.eq=function(other){return this===other||0===this.getX().cmp(other.getX())&&0===this.getY().cmp(other.getY())},Point.prototype.eqXToP=function(x){var rx=x.toRed(this.curve.red).redMul(this.z);if(0===this.x.cmp(rx))return!0;for(var xc=x.clone(),t=this.curve.redN.redMul(this.z);;){if(xc.iadd(this.curve.n),xc.cmp(this.curve.p)>=0)return!1;if(rx.redIAdd(t),0===this.x.cmp(rx))return!0}return!1},Point.prototype.toP=Point.prototype.normalize,Point.prototype.mixedAdd=Point.prototype.add},{"../../elliptic":318,"../curve":321,"bn.js":217,inherits:352}],321:[function(require,module,exports){"use strict";var curve=exports;curve.base=require("./base"),curve.short=require("./short"),curve.mont=require("./mont"),curve.edwards=require("./edwards")},{"./base":319,"./edwards":320,"./mont":322,"./short":323}],322:[function(require,module,exports){"use strict";var curve=require("../curve"),BN=require("bn.js"),inherits=require("inherits"),Base=curve.base,utils=require("../../elliptic").utils;function MontCurve(conf){Base.call(this,"mont",conf),this.a=new BN(conf.a,16).toRed(this.red),this.b=new BN(conf.b,16).toRed(this.red),this.i4=new BN(4).toRed(this.red).redInvm(),this.two=new BN(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}inherits(MontCurve,Base),module.exports=MontCurve,MontCurve.prototype.validate=function(point){var x=point.normalize().x,x2=x.redSqr(),rhs=x2.redMul(x).redAdd(x2.redMul(this.a)).redAdd(x);return 0===rhs.redSqrt().redSqr().cmp(rhs)};function Point(curve,x,z){Base.BasePoint.call(this,curve,"projective"),null===x&&null===z?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new BN(x,16),this.z=new BN(z,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}inherits(Point,Base.BasePoint),MontCurve.prototype.decodePoint=function(bytes,enc){return this.point(utils.toArray(bytes,enc),1)},MontCurve.prototype.point=function(x,z){return new Point(this,x,z)},MontCurve.prototype.pointFromJSON=function(obj){return Point.fromJSON(this,obj)},Point.prototype.precompute=function(){},Point.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},Point.fromJSON=function(curve,obj){return new Point(curve,obj[0],obj[1]||curve.one)},Point.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},Point.prototype.isInfinity=function(){return 0===this.z.cmpn(0)},Point.prototype.dbl=function(){var aa=this.x.redAdd(this.z).redSqr(),bb=this.x.redSub(this.z).redSqr(),c=aa.redSub(bb),nx=aa.redMul(bb),nz=c.redMul(bb.redAdd(this.curve.a24.redMul(c)));return this.curve.point(nx,nz)},Point.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},Point.prototype.diffAdd=function(p,diff){var a=this.x.redAdd(this.z),b=this.x.redSub(this.z),c=p.x.redAdd(p.z),da=p.x.redSub(p.z).redMul(a),cb=c.redMul(b),nx=diff.z.redMul(da.redAdd(cb).redSqr()),nz=diff.x.redMul(da.redISub(cb).redSqr());return this.curve.point(nx,nz)},Point.prototype.mul=function(k){for(var t=k.clone(),a=this,b=this.curve.point(null,null),bits=[];0!==t.cmpn(0);t.iushrn(1))bits.push(t.andln(1));for(var i=bits.length-1;i>=0;i--)0===bits[i]?(a=a.diffAdd(b,this),b=b.dbl()):(b=a.diffAdd(b,this),a=a.dbl());return b},Point.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},Point.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},Point.prototype.eq=function(other){return 0===this.getX().cmp(other.getX())},Point.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},Point.prototype.getX=function(){return this.normalize(),this.x.fromRed()}},{"../../elliptic":318,"../curve":321,"bn.js":217,inherits:352}],323:[function(require,module,exports){"use strict";var curve=require("../curve"),elliptic=require("../../elliptic"),BN=require("bn.js"),inherits=require("inherits"),Base=curve.base,assert=elliptic.utils.assert;function ShortCurve(conf){Base.call(this,"short",conf),this.a=new BN(conf.a,16).toRed(this.red),this.b=new BN(conf.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=0===this.a.fromRed().cmpn(0),this.threeA=0===this.a.fromRed().sub(this.p).cmpn(-3),this.endo=this._getEndomorphism(conf),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}inherits(ShortCurve,Base),module.exports=ShortCurve,ShortCurve.prototype._getEndomorphism=function(conf){if(this.zeroA&&this.g&&this.n&&1===this.p.modn(3)){var beta,lambda;if(conf.beta)beta=new BN(conf.beta,16).toRed(this.red);else{var betas=this._getEndoRoots(this.p);beta=(beta=betas[0].cmp(betas[1])<0?betas[0]:betas[1]).toRed(this.red)}if(conf.lambda)lambda=new BN(conf.lambda,16);else{var lambdas=this._getEndoRoots(this.n);0===this.g.mul(lambdas[0]).x.cmp(this.g.x.redMul(beta))?lambda=lambdas[0]:(lambda=lambdas[1],assert(0===this.g.mul(lambda).x.cmp(this.g.x.redMul(beta))))}return{beta:beta,lambda:lambda,basis:conf.basis?conf.basis.map(function(vec){return{a:new BN(vec.a,16),b:new BN(vec.b,16)}}):this._getEndoBasis(lambda)}}},ShortCurve.prototype._getEndoRoots=function(num){var red=num===this.p?this.red:BN.mont(num),tinv=new BN(2).toRed(red).redInvm(),ntinv=tinv.redNeg(),s=new BN(3).toRed(red).redNeg().redSqrt().redMul(tinv);return[ntinv.redAdd(s).fromRed(),ntinv.redSub(s).fromRed()]},ShortCurve.prototype._getEndoBasis=function(lambda){for(var a0,b0,a1,b1,a2,b2,prevR,r,x,aprxSqrt=this.n.ushrn(Math.floor(this.n.bitLength()/2)),u=lambda,v=this.n.clone(),x1=new BN(1),y1=new BN(0),x2=new BN(0),y2=new BN(1),i=0;0!==u.cmpn(0);){var q=v.div(u);r=v.sub(q.mul(u)),x=x2.sub(q.mul(x1));var y=y2.sub(q.mul(y1));if(!a1&&r.cmp(aprxSqrt)<0)a0=prevR.neg(),b0=x1,a1=r.neg(),b1=x;else if(a1&&2==++i)break;prevR=r,v=u,u=r,x2=x1,x1=x,y2=y1,y1=y}a2=r.neg(),b2=x;var len1=a1.sqr().add(b1.sqr());return a2.sqr().add(b2.sqr()).cmp(len1)>=0&&(a2=a0,b2=b0),a1.negative&&(a1=a1.neg(),b1=b1.neg()),a2.negative&&(a2=a2.neg(),b2=b2.neg()),[{a:a1,b:b1},{a:a2,b:b2}]},ShortCurve.prototype._endoSplit=function(k){var basis=this.endo.basis,v1=basis[0],v2=basis[1],c1=v2.b.mul(k).divRound(this.n),c2=v1.b.neg().mul(k).divRound(this.n),p1=c1.mul(v1.a),p2=c2.mul(v2.a),q1=c1.mul(v1.b),q2=c2.mul(v2.b);return{k1:k.sub(p1).sub(p2),k2:q1.add(q2).neg()}},ShortCurve.prototype.pointFromX=function(x,odd){(x=new BN(x,16)).red||(x=x.toRed(this.red));var y2=x.redSqr().redMul(x).redIAdd(x.redMul(this.a)).redIAdd(this.b),y=y2.redSqrt();if(0!==y.redSqr().redSub(y2).cmp(this.zero))throw new Error("invalid point");var isOdd=y.fromRed().isOdd();return(odd&&!isOdd||!odd&&isOdd)&&(y=y.redNeg()),this.point(x,y)},ShortCurve.prototype.validate=function(point){if(point.inf)return!0;var x=point.x,y=point.y,ax=this.a.redMul(x),rhs=x.redSqr().redMul(x).redIAdd(ax).redIAdd(this.b);return 0===y.redSqr().redISub(rhs).cmpn(0)},ShortCurve.prototype._endoWnafMulAdd=function(points,coeffs,jacobianResult){for(var npoints=this._endoWnafT1,ncoeffs=this._endoWnafT2,i=0;i<points.length;i++){var split=this._endoSplit(coeffs[i]),p=points[i],beta=p._getBeta();split.k1.negative&&(split.k1.ineg(),p=p.neg(!0)),split.k2.negative&&(split.k2.ineg(),beta=beta.neg(!0)),npoints[2*i]=p,npoints[2*i+1]=beta,ncoeffs[2*i]=split.k1,ncoeffs[2*i+1]=split.k2}for(var res=this._wnafMulAdd(1,npoints,ncoeffs,2*i,jacobianResult),j=0;j<2*i;j++)npoints[j]=null,ncoeffs[j]=null;return res};function Point(curve,x,y,isRed){Base.BasePoint.call(this,curve,"affine"),null===x&&null===y?(this.x=null,this.y=null,this.inf=!0):(this.x=new BN(x,16),this.y=new BN(y,16),isRed&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}inherits(Point,Base.BasePoint),ShortCurve.prototype.point=function(x,y,isRed){return new Point(this,x,y,isRed)},ShortCurve.prototype.pointFromJSON=function(obj,red){return Point.fromJSON(this,obj,red)},Point.prototype._getBeta=function(){if(this.curve.endo){var pre=this.precomputed;if(pre&&pre.beta)return pre.beta;var beta=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(pre){var curve=this.curve,endoMul=function(p){return curve.point(p.x.redMul(curve.endo.beta),p.y)};pre.beta=beta,beta.precomputed={beta:null,naf:pre.naf&&{wnd:pre.naf.wnd,points:pre.naf.points.map(endoMul)},doubles:pre.doubles&&{step:pre.doubles.step,points:pre.doubles.points.map(endoMul)}}}return beta}},Point.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},Point.fromJSON=function(curve,obj,red){"string"==typeof obj&&(obj=JSON.parse(obj));var res=curve.point(obj[0],obj[1],red);if(!obj[2])return res;function obj2point(obj){return curve.point(obj[0],obj[1],red)}var pre=obj[2];return res.precomputed={beta:null,doubles:pre.doubles&&{step:pre.doubles.step,points:[res].concat(pre.doubles.points.map(obj2point))},naf:pre.naf&&{wnd:pre.naf.wnd,points:[res].concat(pre.naf.points.map(obj2point))}},res},Point.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},Point.prototype.isInfinity=function(){return this.inf},Point.prototype.add=function(p){if(this.inf)return p;if(p.inf)return this;if(this.eq(p))return this.dbl();if(this.neg().eq(p))return this.curve.point(null,null);if(0===this.x.cmp(p.x))return this.curve.point(null,null);var c=this.y.redSub(p.y);0!==c.cmpn(0)&&(c=c.redMul(this.x.redSub(p.x).redInvm()));var nx=c.redSqr().redISub(this.x).redISub(p.x),ny=c.redMul(this.x.redSub(nx)).redISub(this.y);return this.curve.point(nx,ny)},Point.prototype.dbl=function(){if(this.inf)return this;var ys1=this.y.redAdd(this.y);if(0===ys1.cmpn(0))return this.curve.point(null,null);var a=this.curve.a,x2=this.x.redSqr(),dyinv=ys1.redInvm(),c=x2.redAdd(x2).redIAdd(x2).redIAdd(a).redMul(dyinv),nx=c.redSqr().redISub(this.x.redAdd(this.x)),ny=c.redMul(this.x.redSub(nx)).redISub(this.y);return this.curve.point(nx,ny)},Point.prototype.getX=function(){return this.x.fromRed()},Point.prototype.getY=function(){return this.y.fromRed()},Point.prototype.mul=function(k){return k=new BN(k,16),this._hasDoubles(k)?this.curve._fixedNafMul(this,k):this.curve.endo?this.curve._endoWnafMulAdd([this],[k]):this.curve._wnafMul(this,k)},Point.prototype.mulAdd=function(k1,p2,k2){var points=[this,p2],coeffs=[k1,k2];return this.curve.endo?this.curve._endoWnafMulAdd(points,coeffs):this.curve._wnafMulAdd(1,points,coeffs,2)},Point.prototype.jmulAdd=function(k1,p2,k2){var points=[this,p2],coeffs=[k1,k2];return this.curve.endo?this.curve._endoWnafMulAdd(points,coeffs,!0):this.curve._wnafMulAdd(1,points,coeffs,2,!0)},Point.prototype.eq=function(p){return this===p||this.inf===p.inf&&(this.inf||0===this.x.cmp(p.x)&&0===this.y.cmp(p.y))},Point.prototype.neg=function(_precompute){if(this.inf)return this;var res=this.curve.point(this.x,this.y.redNeg());if(_precompute&&this.precomputed){var pre=this.precomputed,negate=function(p){return p.neg()};res.precomputed={naf:pre.naf&&{wnd:pre.naf.wnd,points:pre.naf.points.map(negate)},doubles:pre.doubles&&{step:pre.doubles.step,points:pre.doubles.points.map(negate)}}}return res},Point.prototype.toJ=function(){if(this.inf)return this.curve.jpoint(null,null,null);return this.curve.jpoint(this.x,this.y,this.curve.one)};function JPoint(curve,x,y,z){Base.BasePoint.call(this,curve,"jacobian"),null===x&&null===y&&null===z?(this.x=this.curve.one,this.y=this.curve.one,this.z=new BN(0)):(this.x=new BN(x,16),this.y=new BN(y,16),this.z=new BN(z,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}inherits(JPoint,Base.BasePoint),ShortCurve.prototype.jpoint=function(x,y,z){return new JPoint(this,x,y,z)},JPoint.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var zinv=this.z.redInvm(),zinv2=zinv.redSqr(),ax=this.x.redMul(zinv2),ay=this.y.redMul(zinv2).redMul(zinv);return this.curve.point(ax,ay)},JPoint.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},JPoint.prototype.add=function(p){if(this.isInfinity())return p;if(p.isInfinity())return this;var pz2=p.z.redSqr(),z2=this.z.redSqr(),u1=this.x.redMul(pz2),u2=p.x.redMul(z2),s1=this.y.redMul(pz2.redMul(p.z)),s2=p.y.redMul(z2.redMul(this.z)),h=u1.redSub(u2),r=s1.redSub(s2);if(0===h.cmpn(0))return 0!==r.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var h2=h.redSqr(),h3=h2.redMul(h),v=u1.redMul(h2),nx=r.redSqr().redIAdd(h3).redISub(v).redISub(v),ny=r.redMul(v.redISub(nx)).redISub(s1.redMul(h3)),nz=this.z.redMul(p.z).redMul(h);return this.curve.jpoint(nx,ny,nz)},JPoint.prototype.mixedAdd=function(p){if(this.isInfinity())return p.toJ();if(p.isInfinity())return this;var z2=this.z.redSqr(),u1=this.x,u2=p.x.redMul(z2),s1=this.y,s2=p.y.redMul(z2).redMul(this.z),h=u1.redSub(u2),r=s1.redSub(s2);if(0===h.cmpn(0))return 0!==r.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var h2=h.redSqr(),h3=h2.redMul(h),v=u1.redMul(h2),nx=r.redSqr().redIAdd(h3).redISub(v).redISub(v),ny=r.redMul(v.redISub(nx)).redISub(s1.redMul(h3)),nz=this.z.redMul(h);return this.curve.jpoint(nx,ny,nz)},JPoint.prototype.dblp=function(pow){if(0===pow)return this;if(this.isInfinity())return this;if(!pow)return this.dbl();if(this.curve.zeroA||this.curve.threeA){for(var r=this,i=0;i<pow;i++)r=r.dbl();return r}var a=this.curve.a,tinv=this.curve.tinv,jx=this.x,jy=this.y,jz=this.z,jz4=jz.redSqr().redSqr(),jyd=jy.redAdd(jy);for(i=0;i<pow;i++){var jx2=jx.redSqr(),jyd2=jyd.redSqr(),jyd4=jyd2.redSqr(),c=jx2.redAdd(jx2).redIAdd(jx2).redIAdd(a.redMul(jz4)),t1=jx.redMul(jyd2),nx=c.redSqr().redISub(t1.redAdd(t1)),t2=t1.redISub(nx),dny=c.redMul(t2);dny=dny.redIAdd(dny).redISub(jyd4);var nz=jyd.redMul(jz);i+1<pow&&(jz4=jz4.redMul(jyd4)),jx=nx,jz=nz,jyd=dny}return this.curve.jpoint(jx,jyd.redMul(tinv),jz)},JPoint.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},JPoint.prototype._zeroDbl=function(){var nx,ny,nz;if(this.zOne){var xx=this.x.redSqr(),yy=this.y.redSqr(),yyyy=yy.redSqr(),s=this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);s=s.redIAdd(s);var m=xx.redAdd(xx).redIAdd(xx),t=m.redSqr().redISub(s).redISub(s),yyyy8=yyyy.redIAdd(yyyy);yyyy8=(yyyy8=yyyy8.redIAdd(yyyy8)).redIAdd(yyyy8),nx=t,ny=m.redMul(s.redISub(t)).redISub(yyyy8),nz=this.y.redAdd(this.y)}else{var a=this.x.redSqr(),b=this.y.redSqr(),c=b.redSqr(),d=this.x.redAdd(b).redSqr().redISub(a).redISub(c);d=d.redIAdd(d);var e=a.redAdd(a).redIAdd(a),f=e.redSqr(),c8=c.redIAdd(c);c8=(c8=c8.redIAdd(c8)).redIAdd(c8),nx=f.redISub(d).redISub(d),ny=e.redMul(d.redISub(nx)).redISub(c8),nz=(nz=this.y.redMul(this.z)).redIAdd(nz)}return this.curve.jpoint(nx,ny,nz)},JPoint.prototype._threeDbl=function(){var nx,ny,nz;if(this.zOne){var xx=this.x.redSqr(),yy=this.y.redSqr(),yyyy=yy.redSqr(),s=this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);s=s.redIAdd(s);var m=xx.redAdd(xx).redIAdd(xx).redIAdd(this.curve.a),t=m.redSqr().redISub(s).redISub(s);nx=t;var yyyy8=yyyy.redIAdd(yyyy);yyyy8=(yyyy8=yyyy8.redIAdd(yyyy8)).redIAdd(yyyy8),ny=m.redMul(s.redISub(t)).redISub(yyyy8),nz=this.y.redAdd(this.y)}else{var delta=this.z.redSqr(),gamma=this.y.redSqr(),beta=this.x.redMul(gamma),alpha=this.x.redSub(delta).redMul(this.x.redAdd(delta));alpha=alpha.redAdd(alpha).redIAdd(alpha);var beta4=beta.redIAdd(beta),beta8=(beta4=beta4.redIAdd(beta4)).redAdd(beta4);nx=alpha.redSqr().redISub(beta8),nz=this.y.redAdd(this.z).redSqr().redISub(gamma).redISub(delta);var ggamma8=gamma.redSqr();ggamma8=(ggamma8=(ggamma8=ggamma8.redIAdd(ggamma8)).redIAdd(ggamma8)).redIAdd(ggamma8),ny=alpha.redMul(beta4.redISub(nx)).redISub(ggamma8)}return this.curve.jpoint(nx,ny,nz)},JPoint.prototype._dbl=function(){var a=this.curve.a,jx=this.x,jy=this.y,jz=this.z,jz4=jz.redSqr().redSqr(),jx2=jx.redSqr(),jy2=jy.redSqr(),c=jx2.redAdd(jx2).redIAdd(jx2).redIAdd(a.redMul(jz4)),jxd4=jx.redAdd(jx),t1=(jxd4=jxd4.redIAdd(jxd4)).redMul(jy2),nx=c.redSqr().redISub(t1.redAdd(t1)),t2=t1.redISub(nx),jyd8=jy2.redSqr();jyd8=(jyd8=(jyd8=jyd8.redIAdd(jyd8)).redIAdd(jyd8)).redIAdd(jyd8);var ny=c.redMul(t2).redISub(jyd8),nz=jy.redAdd(jy).redMul(jz);return this.curve.jpoint(nx,ny,nz)},JPoint.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var xx=this.x.redSqr(),yy=this.y.redSqr(),zz=this.z.redSqr(),yyyy=yy.redSqr(),m=xx.redAdd(xx).redIAdd(xx),mm=m.redSqr(),e=this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy),ee=(e=(e=(e=e.redIAdd(e)).redAdd(e).redIAdd(e)).redISub(mm)).redSqr(),t=yyyy.redIAdd(yyyy);t=(t=(t=t.redIAdd(t)).redIAdd(t)).redIAdd(t);var u=m.redIAdd(e).redSqr().redISub(mm).redISub(ee).redISub(t),yyu4=yy.redMul(u);yyu4=(yyu4=yyu4.redIAdd(yyu4)).redIAdd(yyu4);var nx=this.x.redMul(ee).redISub(yyu4);nx=(nx=nx.redIAdd(nx)).redIAdd(nx);var ny=this.y.redMul(u.redMul(t.redISub(u)).redISub(e.redMul(ee)));ny=(ny=(ny=ny.redIAdd(ny)).redIAdd(ny)).redIAdd(ny);var nz=this.z.redAdd(e).redSqr().redISub(zz).redISub(ee);return this.curve.jpoint(nx,ny,nz)},JPoint.prototype.mul=function(k,kbase){return k=new BN(k,kbase),this.curve._wnafMul(this,k)},JPoint.prototype.eq=function(p){if("affine"===p.type)return this.eq(p.toJ());if(this===p)return!0;var z2=this.z.redSqr(),pz2=p.z.redSqr();if(0!==this.x.redMul(pz2).redISub(p.x.redMul(z2)).cmpn(0))return!1;var z3=z2.redMul(this.z),pz3=pz2.redMul(p.z);return 0===this.y.redMul(pz3).redISub(p.y.redMul(z3)).cmpn(0)},JPoint.prototype.eqXToP=function(x){var zs=this.z.redSqr(),rx=x.toRed(this.curve.red).redMul(zs);if(0===this.x.cmp(rx))return!0;for(var xc=x.clone(),t=this.curve.redN.redMul(zs);;){if(xc.iadd(this.curve.n),xc.cmp(this.curve.p)>=0)return!1;if(rx.redIAdd(t),0===this.x.cmp(rx))return!0}return!1},JPoint.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},JPoint.prototype.isInfinity=function(){return 0===this.z.cmpn(0)}},{"../../elliptic":318,"../curve":321,"bn.js":217,inherits:352}],324:[function(require,module,exports){"use strict";var curves=exports,hash=require("hash.js"),elliptic=require("../elliptic"),assert=elliptic.utils.assert;function PresetCurve(options){"short"===options.type?this.curve=new elliptic.curve.short(options):"edwards"===options.type?this.curve=new elliptic.curve.edwards(options):this.curve=new elliptic.curve.mont(options),this.g=this.curve.g,this.n=this.curve.n,this.hash=options.hash,assert(this.g.validate(),"Invalid curve"),assert(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}curves.PresetCurve=PresetCurve;function defineCurve(name,options){Object.defineProperty(curves,name,{configurable:!0,enumerable:!0,get:function(){var curve=new PresetCurve(options);return Object.defineProperty(curves,name,{configurable:!0,enumerable:!0,value:curve}),curve}})}defineCurve("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:hash.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),defineCurve("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:hash.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),defineCurve("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:hash.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),defineCurve("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:hash.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),defineCurve("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:hash.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),defineCurve("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:hash.sha256,gRed:!1,g:["9"]}),defineCurve("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:hash.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});var pre;try{pre=require("./precomputed/secp256k1")}catch(e){pre=void 0}defineCurve("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:hash.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",pre]})},{"../elliptic":318,"./precomputed/secp256k1":331,"hash.js":337}],325:[function(require,module,exports){"use strict";var BN=require("bn.js"),HmacDRBG=require("hmac-drbg"),elliptic=require("../../elliptic"),assert=elliptic.utils.assert,KeyPair=require("./key"),Signature=require("./signature");function EC(options){if(!(this instanceof EC))return new EC(options);"string"==typeof options&&(assert(elliptic.curves.hasOwnProperty(options),"Unknown curve "+options),options=elliptic.curves[options]),options instanceof elliptic.curves.PresetCurve&&(options={curve:options}),this.curve=options.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=options.curve.g,this.g.precompute(options.curve.n.bitLength()+1),this.hash=options.hash||options.curve.hash}module.exports=EC,EC.prototype.keyPair=function(options){return new KeyPair(this,options)},EC.prototype.keyFromPrivate=function(priv,enc){return KeyPair.fromPrivate(this,priv,enc)},EC.prototype.keyFromPublic=function(pub,enc){return KeyPair.fromPublic(this,pub,enc)},EC.prototype.genKeyPair=function(options){options||(options={});for(var drbg=new HmacDRBG({hash:this.hash,pers:options.pers,persEnc:options.persEnc||"utf8",entropy:options.entropy||elliptic.rand(this.hash.hmacStrength),entropyEnc:options.entropy&&options.entropyEnc||"utf8",nonce:this.n.toArray()}),bytes=this.n.byteLength(),ns2=this.n.sub(new BN(2));;){var priv=new BN(drbg.generate(bytes));if(!(priv.cmp(ns2)>0))return priv.iaddn(1),this.keyFromPrivate(priv)}},EC.prototype._truncateToN=function(msg,truncOnly){var delta=8*msg.byteLength()-this.n.bitLength();return delta>0&&(msg=msg.ushrn(delta)),!truncOnly&&msg.cmp(this.n)>=0?msg.sub(this.n):msg},EC.prototype.sign=function(msg,key,enc,options){"object"==typeof enc&&(options=enc,enc=null),options||(options={}),key=this.keyFromPrivate(key,enc),msg=this._truncateToN(new BN(msg,16));for(var bytes=this.n.byteLength(),bkey=key.getPrivate().toArray("be",bytes),nonce=msg.toArray("be",bytes),drbg=new HmacDRBG({hash:this.hash,entropy:bkey,nonce:nonce,pers:options.pers,persEnc:options.persEnc||"utf8"}),ns1=this.n.sub(new BN(1)),iter=0;;iter++){var k=options.k?options.k(iter):new BN(drbg.generate(this.n.byteLength()));if(!((k=this._truncateToN(k,!0)).cmpn(1)<=0||k.cmp(ns1)>=0)){var kp=this.g.mul(k);if(!kp.isInfinity()){var kpX=kp.getX(),r=kpX.umod(this.n);if(0!==r.cmpn(0)){var s=k.invm(this.n).mul(r.mul(key.getPrivate()).iadd(msg));if(0!==(s=s.umod(this.n)).cmpn(0)){var recoveryParam=(kp.getY().isOdd()?1:0)|(0!==kpX.cmp(r)?2:0);return options.canonical&&s.cmp(this.nh)>0&&(s=this.n.sub(s),recoveryParam^=1),new Signature({r:r,s:s,recoveryParam:recoveryParam})}}}}}},EC.prototype.verify=function(msg,signature,key,enc){msg=this._truncateToN(new BN(msg,16)),key=this.keyFromPublic(key,enc);var r=(signature=new Signature(signature,"hex")).r,s=signature.s;if(r.cmpn(1)<0||r.cmp(this.n)>=0)return!1;if(s.cmpn(1)<0||s.cmp(this.n)>=0)return!1;var sinv=s.invm(this.n),u1=sinv.mul(msg).umod(this.n),u2=sinv.mul(r).umod(this.n);if(!this.curve._maxwellTrick){return!(p=this.g.mulAdd(u1,key.getPublic(),u2)).isInfinity()&&0===p.getX().umod(this.n).cmp(r)}var p;return!(p=this.g.jmulAdd(u1,key.getPublic(),u2)).isInfinity()&&p.eqXToP(r)},EC.prototype.recoverPubKey=function(msg,signature,j,enc){assert((3&j)===j,"The recovery param is more than two bits"),signature=new Signature(signature,enc);var n=this.n,e=new BN(msg),r=signature.r,s=signature.s,isYOdd=1&j,isSecondKey=j>>1;if(r.cmp(this.curve.p.umod(this.curve.n))>=0&&isSecondKey)throw new Error("Unable to find sencond key candinate");r=isSecondKey?this.curve.pointFromX(r.add(this.curve.n),isYOdd):this.curve.pointFromX(r,isYOdd);var rInv=signature.r.invm(n),s1=n.sub(e).mul(rInv).umod(n),s2=s.mul(rInv).umod(n);return this.g.mulAdd(s1,r,s2)},EC.prototype.getKeyRecoveryParam=function(e,signature,Q,enc){if(null!==(signature=new Signature(signature,enc)).recoveryParam)return signature.recoveryParam;for(var i=0;i<4;i++){var Qprime;try{Qprime=this.recoverPubKey(e,signature,i)}catch(e){continue}if(Qprime.eq(Q))return i}throw new Error("Unable to find valid recovery factor")}},{"../../elliptic":318,"./key":326,"./signature":327,"bn.js":217,"hmac-drbg":349}],326:[function(require,module,exports){"use strict";var BN=require("bn.js"),assert=require("../../elliptic").utils.assert;function KeyPair(ec,options){this.ec=ec,this.priv=null,this.pub=null,options.priv&&this._importPrivate(options.priv,options.privEnc),options.pub&&this._importPublic(options.pub,options.pubEnc)}module.exports=KeyPair,KeyPair.fromPublic=function(ec,pub,enc){return pub instanceof KeyPair?pub:new KeyPair(ec,{pub:pub,pubEnc:enc})},KeyPair.fromPrivate=function(ec,priv,enc){return priv instanceof KeyPair?priv:new KeyPair(ec,{priv:priv,privEnc:enc})},KeyPair.prototype.validate=function(){var pub=this.getPublic();return pub.isInfinity()?{result:!1,reason:"Invalid public key"}:pub.validate()?pub.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},KeyPair.prototype.getPublic=function(compact,enc){return"string"==typeof compact&&(enc=compact,compact=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),enc?this.pub.encode(enc,compact):this.pub},KeyPair.prototype.getPrivate=function(enc){return"hex"===enc?this.priv.toString(16,2):this.priv},KeyPair.prototype._importPrivate=function(key,enc){this.priv=new BN(key,enc||16),this.priv=this.priv.umod(this.ec.curve.n)},KeyPair.prototype._importPublic=function(key,enc){if(key.x||key.y)return"mont"===this.ec.curve.type?assert(key.x,"Need x coordinate"):"short"!==this.ec.curve.type&&"edwards"!==this.ec.curve.type||assert(key.x&&key.y,"Need both x and y coordinate"),void(this.pub=this.ec.curve.point(key.x,key.y));this.pub=this.ec.curve.decodePoint(key,enc)},KeyPair.prototype.derive=function(pub){return pub.mul(this.priv).getX()},KeyPair.prototype.sign=function(msg,enc,options){return this.ec.sign(msg,this,enc,options)},KeyPair.prototype.verify=function(msg,signature){return this.ec.verify(msg,signature,this)},KeyPair.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"}},{"../../elliptic":318,"bn.js":217}],327:[function(require,module,exports){"use strict";var BN=require("bn.js"),utils=require("../../elliptic").utils,assert=utils.assert;function Signature(options,enc){if(options instanceof Signature)return options;this._importDER(options,enc)||(assert(options.r&&options.s,"Signature without r or s"),this.r=new BN(options.r,16),this.s=new BN(options.s,16),void 0===options.recoveryParam?this.recoveryParam=null:this.recoveryParam=options.recoveryParam)}module.exports=Signature;function getLength(buf,p){var initial=buf[p.place++];if(!(128&initial))return initial;for(var octetLen=15&initial,val=0,i=0,off=p.place;i<octetLen;i++,off++)val<<=8,val|=buf[off];return p.place=off,val}function rmPadding(buf){for(var i=0,len=buf.length-1;!buf[i]&&!(128&buf[i+1])&&i<len;)i++;return 0===i?buf:buf.slice(i)}Signature.prototype._importDER=function(data,enc){data=utils.toArray(data,enc);var p=new function(){this.place=0};if(48!==data[p.place++])return!1;if(getLength(data,p)+p.place!==data.length)return!1;if(2!==data[p.place++])return!1;var rlen=getLength(data,p),r=data.slice(p.place,rlen+p.place);if(p.place+=rlen,2!==data[p.place++])return!1;var slen=getLength(data,p);if(data.length!==slen+p.place)return!1;var s=data.slice(p.place,slen+p.place);return 0===r[0]&&128&r[1]&&(r=r.slice(1)),0===s[0]&&128&s[1]&&(s=s.slice(1)),this.r=new BN(r),this.s=new BN(s),this.recoveryParam=null,!0};function constructLength(arr,len){if(len<128)arr.push(len);else{var octets=1+(Math.log(len)/Math.LN2>>>3);for(arr.push(128|octets);--octets;)arr.push(len>>>(octets<<3)&255);arr.push(len)}}Signature.prototype.toDER=function(enc){var r=this.r.toArray(),s=this.s.toArray();for(128&r[0]&&(r=[0].concat(r)),128&s[0]&&(s=[0].concat(s)),r=rmPadding(r),s=rmPadding(s);!(s[0]||128&s[1]);)s=s.slice(1);var arr=[2];constructLength(arr,r.length),(arr=arr.concat(r)).push(2),constructLength(arr,s.length);var backHalf=arr.concat(s),res=[48];return constructLength(res,backHalf.length),res=res.concat(backHalf),utils.encode(res,enc)}},{"../../elliptic":318,"bn.js":217}],328:[function(require,module,exports){"use strict";var hash=require("hash.js"),elliptic=require("../../elliptic"),utils=elliptic.utils,assert=utils.assert,parseBytes=utils.parseBytes,KeyPair=require("./key"),Signature=require("./signature");function EDDSA(curve){if(assert("ed25519"===curve,"only tested with ed25519 so far"),!(this instanceof EDDSA))return new EDDSA(curve);curve=elliptic.curves[curve].curve;this.curve=curve,this.g=curve.g,this.g.precompute(curve.n.bitLength()+1),this.pointClass=curve.point().constructor,this.encodingLength=Math.ceil(curve.n.bitLength()/8),this.hash=hash.sha512}module.exports=EDDSA,EDDSA.prototype.sign=function(message,secret){message=parseBytes(message);var key=this.keyFromSecret(secret),r=this.hashInt(key.messagePrefix(),message),R=this.g.mul(r),Rencoded=this.encodePoint(R),s_=this.hashInt(Rencoded,key.pubBytes(),message).mul(key.priv()),S=r.add(s_).umod(this.curve.n);return this.makeSignature({R:R,S:S,Rencoded:Rencoded})},EDDSA.prototype.verify=function(message,sig,pub){message=parseBytes(message),sig=this.makeSignature(sig);var key=this.keyFromPublic(pub),h=this.hashInt(sig.Rencoded(),key.pubBytes(),message),SG=this.g.mul(sig.S());return sig.R().add(key.pub().mul(h)).eq(SG)},EDDSA.prototype.hashInt=function(){for(var hash=this.hash(),i=0;i<arguments.length;i++)hash.update(arguments[i]);return utils.intFromLE(hash.digest()).umod(this.curve.n)},EDDSA.prototype.keyFromPublic=function(pub){return KeyPair.fromPublic(this,pub)},EDDSA.prototype.keyFromSecret=function(secret){return KeyPair.fromSecret(this,secret)},EDDSA.prototype.makeSignature=function(sig){return sig instanceof Signature?sig:new Signature(this,sig)},EDDSA.prototype.encodePoint=function(point){var enc=point.getY().toArray("le",this.encodingLength);return enc[this.encodingLength-1]|=point.getX().isOdd()?128:0,enc},EDDSA.prototype.decodePoint=function(bytes){var lastIx=(bytes=utils.parseBytes(bytes)).length-1,normed=bytes.slice(0,lastIx).concat(-129&bytes[lastIx]),xIsOdd=0!=(128&bytes[lastIx]),y=utils.intFromLE(normed);return this.curve.pointFromY(y,xIsOdd)},EDDSA.prototype.encodeInt=function(num){return num.toArray("le",this.encodingLength)},EDDSA.prototype.decodeInt=function(bytes){return utils.intFromLE(bytes)},EDDSA.prototype.isPoint=function(val){return val instanceof this.pointClass}},{"../../elliptic":318,"./key":329,"./signature":330,"hash.js":337}],329:[function(require,module,exports){"use strict";var utils=require("../../elliptic").utils,assert=utils.assert,parseBytes=utils.parseBytes,cachedProperty=utils.cachedProperty;function KeyPair(eddsa,params){this.eddsa=eddsa,this._secret=parseBytes(params.secret),eddsa.isPoint(params.pub)?this._pub=params.pub:this._pubBytes=parseBytes(params.pub)}KeyPair.fromPublic=function(eddsa,pub){return pub instanceof KeyPair?pub:new KeyPair(eddsa,{pub:pub})},KeyPair.fromSecret=function(eddsa,secret){return secret instanceof KeyPair?secret:new KeyPair(eddsa,{secret:secret})},KeyPair.prototype.secret=function(){return this._secret},cachedProperty(KeyPair,"pubBytes",function(){return this.eddsa.encodePoint(this.pub())}),cachedProperty(KeyPair,"pub",function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())}),cachedProperty(KeyPair,"privBytes",function(){var eddsa=this.eddsa,hash=this.hash(),lastIx=eddsa.encodingLength-1,a=hash.slice(0,eddsa.encodingLength);return a[0]&=248,a[lastIx]&=127,a[lastIx]|=64,a}),cachedProperty(KeyPair,"priv",function(){return this.eddsa.decodeInt(this.privBytes())}),cachedProperty(KeyPair,"hash",function(){return this.eddsa.hash().update(this.secret()).digest()}),cachedProperty(KeyPair,"messagePrefix",function(){return this.hash().slice(this.eddsa.encodingLength)}),KeyPair.prototype.sign=function(message){return assert(this._secret,"KeyPair can only verify"),this.eddsa.sign(message,this)},KeyPair.prototype.verify=function(message,sig){return this.eddsa.verify(message,sig,this)},KeyPair.prototype.getSecret=function(enc){return assert(this._secret,"KeyPair is public only"),utils.encode(this.secret(),enc)},KeyPair.prototype.getPublic=function(enc){return utils.encode(this.pubBytes(),enc)},module.exports=KeyPair},{"../../elliptic":318}],330:[function(require,module,exports){"use strict";var BN=require("bn.js"),utils=require("../../elliptic").utils,assert=utils.assert,cachedProperty=utils.cachedProperty,parseBytes=utils.parseBytes;function Signature(eddsa,sig){this.eddsa=eddsa,"object"!=typeof sig&&(sig=parseBytes(sig)),Array.isArray(sig)&&(sig={R:sig.slice(0,eddsa.encodingLength),S:sig.slice(eddsa.encodingLength)}),assert(sig.R&&sig.S,"Signature without R or S"),eddsa.isPoint(sig.R)&&(this._R=sig.R),sig.S instanceof BN&&(this._S=sig.S),this._Rencoded=Array.isArray(sig.R)?sig.R:sig.Rencoded,this._Sencoded=Array.isArray(sig.S)?sig.S:sig.Sencoded}cachedProperty(Signature,"S",function(){return this.eddsa.decodeInt(this.Sencoded())}),cachedProperty(Signature,"R",function(){return this.eddsa.decodePoint(this.Rencoded())}),cachedProperty(Signature,"Rencoded",function(){return this.eddsa.encodePoint(this.R())}),cachedProperty(Signature,"Sencoded",function(){return this.eddsa.encodeInt(this.S())}),Signature.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},Signature.prototype.toHex=function(){return utils.encode(this.toBytes(),"hex").toUpperCase()},module.exports=Signature},{"../../elliptic":318,"bn.js":217}],331:[function(require,module,exports){module.exports={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}},{}],332:[function(require,module,exports){"use strict";var utils=exports,BN=require("bn.js"),minAssert=require("minimalistic-assert"),minUtils=require("minimalistic-crypto-utils");utils.assert=minAssert,utils.toArray=minUtils.toArray,utils.zero2=minUtils.zero2,utils.toHex=minUtils.toHex,utils.encode=minUtils.encode;utils.getNAF=function(num,w){for(var naf=[],ws=1<<w+1,k=num.clone();k.cmpn(1)>=0;){var z;if(k.isOdd()){var mod=k.andln(ws-1);z=mod>(ws>>1)-1?(ws>>1)-mod:mod,k.isubn(z)}else z=0;naf.push(z);for(var shift=0!==k.cmpn(0)&&0===k.andln(ws-1)?w+1:1,i=1;i<shift;i++)naf.push(0);k.iushrn(shift)}return naf};utils.getJSF=function(k1,k2){var jsf=[[],[]];k1=k1.clone(),k2=k2.clone();for(var d1=0,d2=0;k1.cmpn(-d1)>0||k2.cmpn(-d2)>0;){var m14=k1.andln(3)+d1&3,m24=k2.andln(3)+d2&3;3===m14&&(m14=-1),3===m24&&(m24=-1);var u1;u1=0==(1&m14)?0:3!=(m8=k1.andln(7)+d1&7)&&5!==m8||2!==m24?m14:-m14,jsf[0].push(u1);var u2;if(0==(1&m24))u2=0;else{var m8;u2=3!=(m8=k2.andln(7)+d2&7)&&5!==m8||2!==m14?m24:-m24}jsf[1].push(u2),2*d1===u1+1&&(d1=1-d1),2*d2===u2+1&&(d2=1-d2),k1.iushrn(1),k2.iushrn(1)}return jsf};utils.cachedProperty=function(obj,name,computer){var key="_"+name;obj.prototype[name]=function(){return void 0!==this[key]?this[key]:this[key]=computer.call(this)}};utils.parseBytes=function(bytes){return"string"==typeof bytes?utils.toArray(bytes,"hex"):bytes};utils.intFromLE=function(bytes){return new BN(bytes,"hex","le")}},{"bn.js":217,"minimalistic-assert":358,"minimalistic-crypto-utils":359}],333:[function(require,module,exports){module.exports={_from:"elliptic@^6.2.3",_id:"elliptic@6.4.0",_inBundle:!1,_integrity:"sha1-ysmvh2LIWDYYcAPI3+GT5eLq5d8=",_location:"/elliptic",_phantomChildren:{},_requested:{type:"range",registry:!0,raw:"elliptic@^6.2.3",name:"elliptic",escapedName:"elliptic",rawSpec:"^6.2.3",saveSpec:null,fetchSpec:"^6.2.3"},_requiredBy:["/browserify-sign","/create-ecdh","/secp256k1"],_resolved:"https://registry.npmjs.org/elliptic/-/elliptic-6.4.0.tgz",_shasum:"cac9af8762c85836187003c8dfe193e5e2eae5df",_spec:"elliptic@^6.2.3",_where:"/home/bcoin/node_modules/secp256k1",author:{name:"Fedor Indutny",email:"fedor@indutny.com"},bugs:{url:"https://github.com/indutny/elliptic/issues"},bundleDependencies:!1,dependencies:{"bn.js":"^4.4.0",brorand:"^1.0.1","hash.js":"^1.0.0","hmac-drbg":"^1.0.0",inherits:"^2.0.1","minimalistic-assert":"^1.0.0","minimalistic-crypto-utils":"^1.0.0"},deprecated:!1,description:"EC cryptography",devDependencies:{brfs:"^1.4.3",coveralls:"^2.11.3",grunt:"^0.4.5","grunt-browserify":"^5.0.0","grunt-cli":"^1.2.0","grunt-contrib-connect":"^1.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-uglify":"^1.0.1","grunt-mocha-istanbul":"^3.0.1","grunt-saucelabs":"^8.6.2",istanbul:"^0.4.2",jscs:"^2.9.0",jshint:"^2.6.0",mocha:"^2.1.0"},files:["lib"],homepage:"https://github.com/indutny/elliptic",keywords:["EC","Elliptic","curve","Cryptography"],license:"MIT",main:"lib/elliptic.js",name:"elliptic",repository:{type:"git",url:"git+ssh://git@github.com/indutny/elliptic.git"},scripts:{jscs:"jscs benchmarks/*.js lib/*.js lib/**/*.js lib/**/**/*.js test/index.js",jshint:"jscs benchmarks/*.js lib/*.js lib/**/*.js lib/**/**/*.js test/index.js",lint:"npm run jscs && npm run jshint",test:"npm run lint && npm run unit",unit:"istanbul test _mocha --reporter=spec test/index.js",version:"grunt dist && git add dist/"},version:"6.4.0"}},{}],334:[function(require,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if("number"!=typeof n||n<0||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if((er=arguments[1])instanceof Error)throw er;var err=new Error('Uncaught, unspecified "error" event. ('+er+")");throw err.context=er,err}if(isUndefined(handler=this._events[type]))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1),handler.apply(this,args)}else if(isObject(handler))for(args=Array.prototype.slice.call(arguments,1),len=(listeners=handler.slice()).length,i=0;i<len;i++)listeners[i].apply(this,args);return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned&&(m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners)&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace()),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(length=(list=this._events[type]).length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-- >0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(position<0)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(isFunction(listeners=this._events[type]))this.removeListener(type,listeners);else if(listeners)for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){return this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;if(evlistener)return evlistener.length}return 0},EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)};function isFunction(arg){return"function"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}},{}],335:[function(require,module,exports){var Buffer=require("safe-buffer").Buffer,MD5=require("md5.js");module.exports=function(password,salt,keyBits,ivLen){if(Buffer.isBuffer(password)||(password=Buffer.from(password,"binary")),salt&&(Buffer.isBuffer(salt)||(salt=Buffer.from(salt,"binary")),8!==salt.length))throw new RangeError("salt should be Buffer with 8 byte length");for(var keyLen=keyBits/8,key=Buffer.alloc(keyLen),iv=Buffer.alloc(ivLen||0),tmp=Buffer.alloc(0);keyLen>0||ivLen>0;){var hash=new MD5;hash.update(tmp),hash.update(password),salt&&hash.update(salt),tmp=hash.digest();var used=0;if(keyLen>0){var keyStart=key.length-keyLen;used=Math.min(keyLen,tmp.length),tmp.copy(key,keyStart,0,used),keyLen-=used}if(used<tmp.length&&ivLen>0){var ivStart=iv.length-ivLen,length=Math.min(ivLen,tmp.length-used);tmp.copy(iv,ivStart,used,used+length),ivLen-=length}}return tmp.fill(0),{key:key,iv:iv}}},{"md5.js":355,"safe-buffer":401}],336:[function(require,module,exports){(function(Buffer){"use strict";var Transform=require("stream").Transform;function HashBase(blockSize){Transform.call(this),this._block=new Buffer(blockSize),this._blockSize=blockSize,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}require("inherits")(HashBase,Transform),HashBase.prototype._transform=function(chunk,encoding,callback){var error=null;try{"buffer"!==encoding&&(chunk=new Buffer(chunk,encoding)),this.update(chunk)}catch(err){error=err}callback(error)},HashBase.prototype._flush=function(callback){var error=null;try{this.push(this._digest())}catch(err){error=err}callback(error)},HashBase.prototype.update=function(data,encoding){if(!Buffer.isBuffer(data)&&"string"!=typeof data)throw new TypeError("Data must be a string or a buffer");if(this._finalized)throw new Error("Digest already called");Buffer.isBuffer(data)||(data=new Buffer(data,encoding||"binary"));for(var block=this._block,offset=0;this._blockOffset+data.length-offset>=this._blockSize;){for(var i=this._blockOffset;i<this._blockSize;)block[i++]=data[offset++];this._update(),this._blockOffset=0}for(;offset<data.length;)block[this._blockOffset++]=data[offset++];for(var j=0,carry=8*data.length;carry>0;++j)this._length[j]+=carry,(carry=this._length[j]/4294967296|0)>0&&(this._length[j]-=4294967296*carry);return this},HashBase.prototype._update=function(data){throw new Error("_update is not implemented")},HashBase.prototype.digest=function(encoding){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var digest=this._digest();return void 0!==encoding&&(digest=digest.toString(encoding)),digest},HashBase.prototype._digest=function(){throw new Error("_digest is not implemented")},module.exports=HashBase}).call(this,require("buffer").Buffer)},{buffer:269,inherits:352,stream:421}],337:[function(require,module,exports){var hash=exports;hash.utils=require("./hash/utils"),hash.common=require("./hash/common"),hash.sha=require("./hash/sha"),hash.ripemd=require("./hash/ripemd"),hash.hmac=require("./hash/hmac"),hash.sha1=hash.sha.sha1,hash.sha256=hash.sha.sha256,hash.sha224=hash.sha.sha224,hash.sha384=hash.sha.sha384,hash.sha512=hash.sha.sha512,hash.ripemd160=hash.ripemd.ripemd160},{"./hash/common":338,"./hash/hmac":339,"./hash/ripemd":340,"./hash/sha":341,"./hash/utils":348}],338:[function(require,module,exports){"use strict";var utils=require("./utils"),assert=require("minimalistic-assert");function BlockHash(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}exports.BlockHash=BlockHash,BlockHash.prototype.update=function(msg,enc){if(msg=utils.toArray(msg,enc),this.pending?this.pending=this.pending.concat(msg):this.pending=msg,this.pendingTotal+=msg.length,this.pending.length>=this._delta8){var r=(msg=this.pending).length%this._delta8;this.pending=msg.slice(msg.length-r,msg.length),0===this.pending.length&&(this.pending=null),msg=utils.join32(msg,0,msg.length-r,this.endian);for(var i=0;i<msg.length;i+=this._delta32)this._update(msg,i,i+this._delta32)}return this},BlockHash.prototype.digest=function(enc){return this.update(this._pad()),assert(null===this.pending),this._digest(enc)},BlockHash.prototype._pad=function(){var len=this.pendingTotal,bytes=this._delta8,k=bytes-(len+this.padLength)%bytes,res=new Array(k+this.padLength);res[0]=128;for(var i=1;i<k;i++)res[i]=0;if(len<<=3,"big"===this.endian){for(var t=8;t<this.padLength;t++)res[i++]=0;res[i++]=0,res[i++]=0,res[i++]=0,res[i++]=0,res[i++]=len>>>24&255,res[i++]=len>>>16&255,res[i++]=len>>>8&255,res[i++]=255&len}else for(res[i++]=255&len,res[i++]=len>>>8&255,res[i++]=len>>>16&255,res[i++]=len>>>24&255,res[i++]=0,res[i++]=0,res[i++]=0,res[i++]=0,t=8;t<this.padLength;t++)res[i++]=0;return res}},{"./utils":348,"minimalistic-assert":358}],339:[function(require,module,exports){"use strict";var utils=require("./utils"),assert=require("minimalistic-assert");function Hmac(hash,key,enc){if(!(this instanceof Hmac))return new Hmac(hash,key,enc);this.Hash=hash,this.blockSize=hash.blockSize/8,this.outSize=hash.outSize/8,this.inner=null,this.outer=null,this._init(utils.toArray(key,enc))}module.exports=Hmac,Hmac.prototype._init=function(key){key.length>this.blockSize&&(key=(new this.Hash).update(key).digest()),assert(key.length<=this.blockSize);for(var i=key.length;i<this.blockSize;i++)key.push(0);for(i=0;i<key.length;i++)key[i]^=54;for(this.inner=(new this.Hash).update(key),i=0;i<key.length;i++)key[i]^=106;this.outer=(new this.Hash).update(key)},Hmac.prototype.update=function(msg,enc){return this.inner.update(msg,enc),this},Hmac.prototype.digest=function(enc){return this.outer.update(this.inner.digest()),this.outer.digest(enc)}},{"./utils":348,"minimalistic-assert":358}],340:[function(require,module,exports){"use strict";var utils=require("./utils"),common=require("./common"),rotl32=utils.rotl32,sum32=utils.sum32,sum32_3=utils.sum32_3,sum32_4=utils.sum32_4,BlockHash=common.BlockHash;function RIPEMD160(){if(!(this instanceof RIPEMD160))return new RIPEMD160;BlockHash.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}utils.inherits(RIPEMD160,BlockHash),exports.ripemd160=RIPEMD160,RIPEMD160.blockSize=512,RIPEMD160.outSize=160,RIPEMD160.hmacStrength=192,RIPEMD160.padLength=64,RIPEMD160.prototype._update=function(msg,start){for(var A=this.h[0],B=this.h[1],C=this.h[2],D=this.h[3],E=this.h[4],Ah=A,Bh=B,Ch=C,Dh=D,Eh=E,j=0;j<80;j++){var T=sum32(rotl32(sum32_4(A,f(j,B,C,D),msg[r[j]+start],K(j)),s[j]),E);A=E,E=D,D=rotl32(C,10),C=B,B=T,T=sum32(rotl32(sum32_4(Ah,f(79-j,Bh,Ch,Dh),msg[rh[j]+start],Kh(j)),sh[j]),Eh),Ah=Eh,Eh=Dh,Dh=rotl32(Ch,10),Ch=Bh,Bh=T}T=sum32_3(this.h[1],C,Dh),this.h[1]=sum32_3(this.h[2],D,Eh),this.h[2]=sum32_3(this.h[3],E,Ah),this.h[3]=sum32_3(this.h[4],A,Bh),this.h[4]=sum32_3(this.h[0],B,Ch),this.h[0]=T},RIPEMD160.prototype._digest=function(enc){return"hex"===enc?utils.toHex32(this.h,"little"):utils.split32(this.h,"little")};function f(j,x,y,z){return j<=15?x^y^z:j<=31?x&y|~x&z:j<=47?(x|~y)^z:j<=63?x&z|y&~z:x^(y|~z)}function K(j){return j<=15?0:j<=31?1518500249:j<=47?1859775393:j<=63?2400959708:2840853838}function Kh(j){return j<=15?1352829926:j<=31?1548603684:j<=47?1836072691:j<=63?2053994217:0}var r=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],rh=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],s=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],sh=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]},{"./common":338,"./utils":348}],341:[function(require,module,exports){"use strict";exports.sha1=require("./sha/1"),exports.sha224=require("./sha/224"),exports.sha256=require("./sha/256"),exports.sha384=require("./sha/384"),exports.sha512=require("./sha/512")},{"./sha/1":342,"./sha/224":343,"./sha/256":344,"./sha/384":345,"./sha/512":346}],342:[function(require,module,exports){"use strict";var utils=require("../utils"),common=require("../common"),shaCommon=require("./common"),rotl32=utils.rotl32,sum32=utils.sum32,sum32_5=utils.sum32_5,ft_1=shaCommon.ft_1,BlockHash=common.BlockHash,sha1_K=[1518500249,1859775393,2400959708,3395469782];function SHA1(){if(!(this instanceof SHA1))return new SHA1;BlockHash.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}utils.inherits(SHA1,BlockHash),module.exports=SHA1,SHA1.blockSize=512,SHA1.outSize=160,SHA1.hmacStrength=80,SHA1.padLength=64,SHA1.prototype._update=function(msg,start){for(var W=this.W,i=0;i<16;i++)W[i]=msg[start+i];for(;i<W.length;i++)W[i]=rotl32(W[i-3]^W[i-8]^W[i-14]^W[i-16],1);var a=this.h[0],b=this.h[1],c=this.h[2],d=this.h[3],e=this.h[4];for(i=0;i<W.length;i++){var s=~~(i/20),t=sum32_5(rotl32(a,5),ft_1(s,b,c,d),e,W[i],sha1_K[s]);e=d,d=c,c=rotl32(b,30),b=a,a=t}this.h[0]=sum32(this.h[0],a),this.h[1]=sum32(this.h[1],b),this.h[2]=sum32(this.h[2],c),this.h[3]=sum32(this.h[3],d),this.h[4]=sum32(this.h[4],e)},SHA1.prototype._digest=function(enc){return"hex"===enc?utils.toHex32(this.h,"big"):utils.split32(this.h,"big")}},{"../common":338,"../utils":348,"./common":347}],343:[function(require,module,exports){"use strict";var utils=require("../utils"),SHA256=require("./256");function SHA224(){if(!(this instanceof SHA224))return new SHA224;SHA256.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}utils.inherits(SHA224,SHA256),module.exports=SHA224,SHA224.blockSize=512,SHA224.outSize=224,SHA224.hmacStrength=192,SHA224.padLength=64,SHA224.prototype._digest=function(enc){return"hex"===enc?utils.toHex32(this.h.slice(0,7),"big"):utils.split32(this.h.slice(0,7),"big")}},{"../utils":348,"./256":344}],344:[function(require,module,exports){"use strict";var utils=require("../utils"),common=require("../common"),shaCommon=require("./common"),assert=require("minimalistic-assert"),sum32=utils.sum32,sum32_4=utils.sum32_4,sum32_5=utils.sum32_5,ch32=shaCommon.ch32,maj32=shaCommon.maj32,s0_256=shaCommon.s0_256,s1_256=shaCommon.s1_256,g0_256=shaCommon.g0_256,g1_256=shaCommon.g1_256,BlockHash=common.BlockHash,sha256_K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function SHA256(){if(!(this instanceof SHA256))return new SHA256;BlockHash.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=sha256_K,this.W=new Array(64)}utils.inherits(SHA256,BlockHash),module.exports=SHA256,SHA256.blockSize=512,SHA256.outSize=256,SHA256.hmacStrength=192,SHA256.padLength=64,SHA256.prototype._update=function(msg,start){for(var W=this.W,i=0;i<16;i++)W[i]=msg[start+i];for(;i<W.length;i++)W[i]=sum32_4(g1_256(W[i-2]),W[i-7],g0_256(W[i-15]),W[i-16]);var a=this.h[0],b=this.h[1],c=this.h[2],d=this.h[3],e=this.h[4],f=this.h[5],g=this.h[6],h=this.h[7];for(assert(this.k.length===W.length),i=0;i<W.length;i++){var T1=sum32_5(h,s1_256(e),ch32(e,f,g),this.k[i],W[i]),T2=sum32(s0_256(a),maj32(a,b,c));h=g,g=f,f=e,e=sum32(d,T1),d=c,c=b,b=a,a=sum32(T1,T2)}this.h[0]=sum32(this.h[0],a),this.h[1]=sum32(this.h[1],b),this.h[2]=sum32(this.h[2],c),this.h[3]=sum32(this.h[3],d),this.h[4]=sum32(this.h[4],e),this.h[5]=sum32(this.h[5],f),this.h[6]=sum32(this.h[6],g),this.h[7]=sum32(this.h[7],h)},SHA256.prototype._digest=function(enc){return"hex"===enc?utils.toHex32(this.h,"big"):utils.split32(this.h,"big")}},{"../common":338,"../utils":348,"./common":347,"minimalistic-assert":358}],345:[function(require,module,exports){"use strict";var utils=require("../utils"),SHA512=require("./512");function SHA384(){if(!(this instanceof SHA384))return new SHA384;SHA512.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}utils.inherits(SHA384,SHA512),module.exports=SHA384,SHA384.blockSize=1024,SHA384.outSize=384,SHA384.hmacStrength=192,SHA384.padLength=128,SHA384.prototype._digest=function(enc){return"hex"===enc?utils.toHex32(this.h.slice(0,12),"big"):utils.split32(this.h.slice(0,12),"big")}},{"../utils":348,"./512":346}],346:[function(require,module,exports){"use strict";var utils=require("../utils"),common=require("../common"),assert=require("minimalistic-assert"),rotr64_hi=utils.rotr64_hi,rotr64_lo=utils.rotr64_lo,shr64_hi=utils.shr64_hi,shr64_lo=utils.shr64_lo,sum64=utils.sum64,sum64_hi=utils.sum64_hi,sum64_lo=utils.sum64_lo,sum64_4_hi=utils.sum64_4_hi,sum64_4_lo=utils.sum64_4_lo,sum64_5_hi=utils.sum64_5_hi,sum64_5_lo=utils.sum64_5_lo,BlockHash=common.BlockHash,sha512_K=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function SHA512(){if(!(this instanceof SHA512))return new SHA512;BlockHash.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=sha512_K,this.W=new Array(160)}utils.inherits(SHA512,BlockHash),module.exports=SHA512,SHA512.blockSize=1024,SHA512.outSize=512,SHA512.hmacStrength=192,SHA512.padLength=128,SHA512.prototype._prepareBlock=function(msg,start){for(var W=this.W,i=0;i<32;i++)W[i]=msg[start+i];for(;i<W.length;i+=2){var c0_hi=g1_512_hi(W[i-4],W[i-3]),c0_lo=g1_512_lo(W[i-4],W[i-3]),c1_hi=W[i-14],c1_lo=W[i-13],c2_hi=g0_512_hi(W[i-30],W[i-29]),c2_lo=g0_512_lo(W[i-30],W[i-29]),c3_hi=W[i-32],c3_lo=W[i-31];W[i]=sum64_4_hi(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo),W[i+1]=sum64_4_lo(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo)}},SHA512.prototype._update=function(msg,start){this._prepareBlock(msg,start);var W=this.W,ah=this.h[0],al=this.h[1],bh=this.h[2],bl=this.h[3],ch=this.h[4],cl=this.h[5],dh=this.h[6],dl=this.h[7],eh=this.h[8],el=this.h[9],fh=this.h[10],fl=this.h[11],gh=this.h[12],gl=this.h[13],hh=this.h[14],hl=this.h[15];assert(this.k.length===W.length);for(var i=0;i<W.length;i+=2){var c0_hi=hh,c0_lo=hl,c1_hi=s1_512_hi(eh,el),c1_lo=s1_512_lo(eh,el),c2_hi=ch64_hi(eh,el,fh,fl,gh),c2_lo=ch64_lo(eh,el,fh,fl,gh,gl),c3_hi=this.k[i],c3_lo=this.k[i+1],c4_hi=W[i],c4_lo=W[i+1],T1_hi=sum64_5_hi(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo,c4_hi,c4_lo),T1_lo=sum64_5_lo(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo,c4_hi,c4_lo);c0_hi=s0_512_hi(ah,al),c0_lo=s0_512_lo(ah,al),c1_hi=maj64_hi(ah,al,bh,bl,ch),c1_lo=maj64_lo(ah,al,bh,bl,ch,cl);var T2_hi=sum64_hi(c0_hi,c0_lo,c1_hi,c1_lo),T2_lo=sum64_lo(c0_hi,c0_lo,c1_hi,c1_lo);hh=gh,hl=gl,gh=fh,gl=fl,fh=eh,fl=el,eh=sum64_hi(dh,dl,T1_hi,T1_lo),el=sum64_lo(dl,dl,T1_hi,T1_lo),dh=ch,dl=cl,ch=bh,cl=bl,bh=ah,bl=al,ah=sum64_hi(T1_hi,T1_lo,T2_hi,T2_lo),al=sum64_lo(T1_hi,T1_lo,T2_hi,T2_lo)}sum64(this.h,0,ah,al),sum64(this.h,2,bh,bl),sum64(this.h,4,ch,cl),sum64(this.h,6,dh,dl),sum64(this.h,8,eh,el),sum64(this.h,10,fh,fl),sum64(this.h,12,gh,gl),sum64(this.h,14,hh,hl)},SHA512.prototype._digest=function(enc){return"hex"===enc?utils.toHex32(this.h,"big"):utils.split32(this.h,"big")};function ch64_hi(xh,xl,yh,yl,zh){var r=xh&yh^~xh&zh;return r<0&&(r+=4294967296),r}function ch64_lo(xh,xl,yh,yl,zh,zl){var r=xl&yl^~xl&zl;return r<0&&(r+=4294967296),r}function maj64_hi(xh,xl,yh,yl,zh){var r=xh&yh^xh&zh^yh&zh;return r<0&&(r+=4294967296),r}function maj64_lo(xh,xl,yh,yl,zh,zl){var r=xl&yl^xl&zl^yl&zl;return r<0&&(r+=4294967296),r}function s0_512_hi(xh,xl){var r=rotr64_hi(xh,xl,28)^rotr64_hi(xl,xh,2)^rotr64_hi(xl,xh,7);return r<0&&(r+=4294967296),r}function s0_512_lo(xh,xl){var r=rotr64_lo(xh,xl,28)^rotr64_lo(xl,xh,2)^rotr64_lo(xl,xh,7);return r<0&&(r+=4294967296),r}function s1_512_hi(xh,xl){var r=rotr64_hi(xh,xl,14)^rotr64_hi(xh,xl,18)^rotr64_hi(xl,xh,9);return r<0&&(r+=4294967296),r}function s1_512_lo(xh,xl){var r=rotr64_lo(xh,xl,14)^rotr64_lo(xh,xl,18)^rotr64_lo(xl,xh,9);return r<0&&(r+=4294967296),r}function g0_512_hi(xh,xl){var r=rotr64_hi(xh,xl,1)^rotr64_hi(xh,xl,8)^shr64_hi(xh,xl,7);return r<0&&(r+=4294967296),r}function g0_512_lo(xh,xl){var r=rotr64_lo(xh,xl,1)^rotr64_lo(xh,xl,8)^shr64_lo(xh,xl,7);return r<0&&(r+=4294967296),r}function g1_512_hi(xh,xl){var r=rotr64_hi(xh,xl,19)^rotr64_hi(xl,xh,29)^shr64_hi(xh,xl,6);return r<0&&(r+=4294967296),r}function g1_512_lo(xh,xl){var r=rotr64_lo(xh,xl,19)^rotr64_lo(xl,xh,29)^shr64_lo(xh,xl,6);return r<0&&(r+=4294967296),r}},{"../common":338,"../utils":348,"minimalistic-assert":358}],347:[function(require,module,exports){"use strict";var rotr32=require("../utils").rotr32;exports.ft_1=function(s,x,y,z){return 0===s?ch32(x,y,z):1===s||3===s?p32(x,y,z):2===s?maj32(x,y,z):void 0};function ch32(x,y,z){return x&y^~x&z}exports.ch32=ch32;function maj32(x,y,z){return x&y^x&z^y&z}exports.maj32=maj32;function p32(x,y,z){return x^y^z}exports.p32=p32;exports.s0_256=function(x){return rotr32(x,2)^rotr32(x,13)^rotr32(x,22)};exports.s1_256=function(x){return rotr32(x,6)^rotr32(x,11)^rotr32(x,25)};exports.g0_256=function(x){return rotr32(x,7)^rotr32(x,18)^x>>>3};exports.g1_256=function(x){return rotr32(x,17)^rotr32(x,19)^x>>>10}},{"../utils":348}],348:[function(require,module,exports){"use strict";var assert=require("minimalistic-assert"),inherits=require("inherits");exports.inherits=inherits;exports.toArray=function(msg,enc){if(Array.isArray(msg))return msg.slice();if(!msg)return[];var res=[];if("string"==typeof msg)if(enc){if("hex"===enc)for((msg=msg.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(msg="0"+msg),i=0;i<msg.length;i+=2)res.push(parseInt(msg[i]+msg[i+1],16))}else for(var i=0;i<msg.length;i++){var c=msg.charCodeAt(i),hi=c>>8,lo=255&c;hi?res.push(hi,lo):res.push(lo)}else for(i=0;i<msg.length;i++)res[i]=0|msg[i];return res};exports.toHex=function(msg){for(var res="",i=0;i<msg.length;i++)res+=zero2(msg[i].toString(16));return res};function htonl(w){return(w>>>24|w>>>8&65280|w<<8&16711680|(255&w)<<24)>>>0}exports.htonl=htonl;exports.toHex32=function(msg,endian){for(var res="",i=0;i<msg.length;i++){var w=msg[i];"little"===endian&&(w=htonl(w)),res+=zero8(w.toString(16))}return res};function zero2(word){return 1===word.length?"0"+word:word}exports.zero2=zero2;function zero8(word){return 7===word.length?"0"+word:6===word.length?"00"+word:5===word.length?"000"+word:4===word.length?"0000"+word:3===word.length?"00000"+word:2===word.length?"000000"+word:1===word.length?"0000000"+word:word}exports.zero8=zero8;exports.join32=function(msg,start,end,endian){var len=end-start;assert(len%4==0);for(var res=new Array(len/4),i=0,k=start;i<res.length;i++,k+=4){var w;w="big"===endian?msg[k]<<24|msg[k+1]<<16|msg[k+2]<<8|msg[k+3]:msg[k+3]<<24|msg[k+2]<<16|msg[k+1]<<8|msg[k],res[i]=w>>>0}return res};exports.split32=function(msg,endian){for(var res=new Array(4*msg.length),i=0,k=0;i<msg.length;i++,k+=4){var m=msg[i];"big"===endian?(res[k]=m>>>24,res[k+1]=m>>>16&255,res[k+2]=m>>>8&255,res[k+3]=255&m):(res[k+3]=m>>>24,res[k+2]=m>>>16&255,res[k+1]=m>>>8&255,res[k]=255&m)}return res};exports.rotr32=function(w,b){return w>>>b|w<<32-b};exports.rotl32=function(w,b){return w<<b|w>>>32-b};exports.sum32=function(a,b){return a+b>>>0};exports.sum32_3=function(a,b,c){return a+b+c>>>0};exports.sum32_4=function(a,b,c,d){return a+b+c+d>>>0};exports.sum32_5=function(a,b,c,d,e){return a+b+c+d+e>>>0};exports.sum64=function(buf,pos,ah,al){var bh=buf[pos],lo=al+buf[pos+1]>>>0,hi=(lo<al?1:0)+ah+bh;buf[pos]=hi>>>0,buf[pos+1]=lo};exports.sum64_hi=function(ah,al,bh,bl){return(al+bl>>>0<al?1:0)+ah+bh>>>0};exports.sum64_lo=function(ah,al,bh,bl){return al+bl>>>0};exports.sum64_4_hi=function(ah,al,bh,bl,ch,cl,dh,dl){var carry=0,lo=al;return carry+=(lo=lo+bl>>>0)<al?1:0,carry+=(lo=lo+cl>>>0)<cl?1:0,ah+bh+ch+dh+(carry+=(lo=lo+dl>>>0)<dl?1:0)>>>0};exports.sum64_4_lo=function(ah,al,bh,bl,ch,cl,dh,dl){return al+bl+cl+dl>>>0};exports.sum64_5_hi=function(ah,al,bh,bl,ch,cl,dh,dl,eh,el){var carry=0,lo=al;return carry+=(lo=lo+bl>>>0)<al?1:0,carry+=(lo=lo+cl>>>0)<cl?1:0,carry+=(lo=lo+dl>>>0)<dl?1:0,ah+bh+ch+dh+eh+(carry+=(lo=lo+el>>>0)<el?1:0)>>>0};exports.sum64_5_lo=function(ah,al,bh,bl,ch,cl,dh,dl,eh,el){return al+bl+cl+dl+el>>>0};exports.rotr64_hi=function(ah,al,num){return(al<<32-num|ah>>>num)>>>0};exports.rotr64_lo=function(ah,al,num){return(ah<<32-num|al>>>num)>>>0};exports.shr64_hi=function(ah,al,num){return ah>>>num};exports.shr64_lo=function(ah,al,num){return(ah<<32-num|al>>>num)>>>0}},{inherits:352,"minimalistic-assert":358}],349:[function(require,module,exports){"use strict";var hash=require("hash.js"),utils=require("minimalistic-crypto-utils"),assert=require("minimalistic-assert");function HmacDRBG(options){if(!(this instanceof HmacDRBG))return new HmacDRBG(options);this.hash=options.hash,this.predResist=!!options.predResist,this.outLen=this.hash.outSize,this.minEntropy=options.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var entropy=utils.toArray(options.entropy,options.entropyEnc||"hex"),nonce=utils.toArray(options.nonce,options.nonceEnc||"hex"),pers=utils.toArray(options.pers,options.persEnc||"hex");assert(entropy.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(entropy,nonce,pers)}module.exports=HmacDRBG,HmacDRBG.prototype._init=function(entropy,nonce,pers){var seed=entropy.concat(nonce).concat(pers);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var i=0;i<this.V.length;i++)this.K[i]=0,this.V[i]=1;this._update(seed),this._reseed=1,this.reseedInterval=281474976710656},HmacDRBG.prototype._hmac=function(){return new hash.hmac(this.hash,this.K)},HmacDRBG.prototype._update=function(seed){var kmac=this._hmac().update(this.V).update([0]);seed&&(kmac=kmac.update(seed)),this.K=kmac.digest(),this.V=this._hmac().update(this.V).digest(),seed&&(this.K=this._hmac().update(this.V).update([1]).update(seed).digest(),this.V=this._hmac().update(this.V).digest())},HmacDRBG.prototype.reseed=function(entropy,entropyEnc,add,addEnc){"string"!=typeof entropyEnc&&(addEnc=add,add=entropyEnc,entropyEnc=null),entropy=utils.toArray(entropy,entropyEnc),add=utils.toArray(add,addEnc),assert(entropy.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(entropy.concat(add||[])),this._reseed=1},HmacDRBG.prototype.generate=function(len,enc,add,addEnc){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");"string"!=typeof enc&&(addEnc=add,add=enc,enc=null),add&&(add=utils.toArray(add,addEnc||"hex"),this._update(add));for(var temp=[];temp.length<len;)this.V=this._hmac().update(this.V).digest(),temp=temp.concat(this.V);var res=temp.slice(0,len);return this._update(add),this._reseed++,utils.encode(res,enc)}},{"hash.js":337,"minimalistic-assert":358,"minimalistic-crypto-utils":359}],350:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),(value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias))*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],351:[function(require,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i)if(arr[i]===obj)return i;return-1}},{}],352:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],353:[function(require,module,exports){"use strict";module.exports=function(obj){return null!=obj&&(isBuffer(obj)||function(obj){return"function"==typeof obj.readFloatLE&&"function"==typeof obj.slice&&isBuffer(obj.slice(0,0))}(obj)||!!obj._isBuffer)};function isBuffer(obj){return!!obj.constructor&&"function"==typeof obj.constructor.isBuffer&&obj.constructor.isBuffer(obj)}},{}],354:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)}},{}],355:[function(require,module,exports){(function(Buffer){"use strict";var inherits=require("inherits"),HashBase=require("hash-base"),ARRAY16=new Array(16);function MD5(){HashBase.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878}inherits(MD5,HashBase),MD5.prototype._update=function(){for(var M=ARRAY16,i=0;i<16;++i)M[i]=this._block.readInt32LE(4*i);var a=this._a,b=this._b,c=this._c,d=this._d;b=fnI(b=fnI(b=fnI(b=fnI(b=fnH(b=fnH(b=fnH(b=fnH(b=fnG(b=fnG(b=fnG(b=fnG(b=fnF(b=fnF(b=fnF(b=fnF(b,c=fnF(c,d=fnF(d,a=fnF(a,b,c,d,M[0],3614090360,7),b,c,M[1],3905402710,12),a,b,M[2],606105819,17),d,a,M[3],3250441966,22),c=fnF(c,d=fnF(d,a=fnF(a,b,c,d,M[4],4118548399,7),b,c,M[5],1200080426,12),a,b,M[6],2821735955,17),d,a,M[7],4249261313,22),c=fnF(c,d=fnF(d,a=fnF(a,b,c,d,M[8],1770035416,7),b,c,M[9],2336552879,12),a,b,M[10],4294925233,17),d,a,M[11],2304563134,22),c=fnF(c,d=fnF(d,a=fnF(a,b,c,d,M[12],1804603682,7),b,c,M[13],4254626195,12),a,b,M[14],2792965006,17),d,a,M[15],1236535329,22),c=fnG(c,d=fnG(d,a=fnG(a,b,c,d,M[1],4129170786,5),b,c,M[6],3225465664,9),a,b,M[11],643717713,14),d,a,M[0],3921069994,20),c=fnG(c,d=fnG(d,a=fnG(a,b,c,d,M[5],3593408605,5),b,c,M[10],38016083,9),a,b,M[15],3634488961,14),d,a,M[4],3889429448,20),c=fnG(c,d=fnG(d,a=fnG(a,b,c,d,M[9],568446438,5),b,c,M[14],3275163606,9),a,b,M[3],4107603335,14),d,a,M[8],1163531501,20),c=fnG(c,d=fnG(d,a=fnG(a,b,c,d,M[13],2850285829,5),b,c,M[2],4243563512,9),a,b,M[7],1735328473,14),d,a,M[12],2368359562,20),c=fnH(c,d=fnH(d,a=fnH(a,b,c,d,M[5],4294588738,4),b,c,M[8],2272392833,11),a,b,M[11],1839030562,16),d,a,M[14],4259657740,23),c=fnH(c,d=fnH(d,a=fnH(a,b,c,d,M[1],2763975236,4),b,c,M[4],1272893353,11),a,b,M[7],4139469664,16),d,a,M[10],3200236656,23),c=fnH(c,d=fnH(d,a=fnH(a,b,c,d,M[13],681279174,4),b,c,M[0],3936430074,11),a,b,M[3],3572445317,16),d,a,M[6],76029189,23),c=fnH(c,d=fnH(d,a=fnH(a,b,c,d,M[9],3654602809,4),b,c,M[12],3873151461,11),a,b,M[15],530742520,16),d,a,M[2],3299628645,23),c=fnI(c,d=fnI(d,a=fnI(a,b,c,d,M[0],4096336452,6),b,c,M[7],1126891415,10),a,b,M[14],2878612391,15),d,a,M[5],4237533241,21),c=fnI(c,d=fnI(d,a=fnI(a,b,c,d,M[12],1700485571,6),b,c,M[3],2399980690,10),a,b,M[10],4293915773,15),d,a,M[1],2240044497,21),c=fnI(c,d=fnI(d,a=fnI(a,b,c,d,M[8],1873313359,6),b,c,M[15],4264355552,10),a,b,M[6],2734768916,15),d,a,M[13],1309151649,21),c=fnI(c,d=fnI(d,a=fnI(a,b,c,d,M[4],4149444226,6),b,c,M[11],3174756917,10),a,b,M[2],718787259,15),d,a,M[9],3951481745,21),this._a=this._a+a|0,this._b=this._b+b|0,this._c=this._c+c|0,this._d=this._d+d|0},MD5.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var buffer=new Buffer(16);return buffer.writeInt32LE(this._a,0),buffer.writeInt32LE(this._b,4),buffer.writeInt32LE(this._c,8),buffer.writeInt32LE(this._d,12),buffer};function rotl(x,n){return x<<n|x>>>32-n}function fnF(a,b,c,d,m,k,s){return rotl(a+(b&c|~b&d)+m+k|0,s)+b|0}function fnG(a,b,c,d,m,k,s){return rotl(a+(b&d|c&~d)+m+k|0,s)+b|0}function fnH(a,b,c,d,m,k,s){return rotl(a+(b^c^d)+m+k|0,s)+b|0}function fnI(a,b,c,d,m,k,s){return rotl(a+(c^(b|~d))+m+k|0,s)+b|0}module.exports=MD5}).call(this,require("buffer").Buffer)},{buffer:269,"hash-base":356,inherits:352}],356:[function(require,module,exports){"use strict";var Buffer=require("safe-buffer").Buffer,Transform=require("stream").Transform;function HashBase(blockSize){Transform.call(this),this._block=Buffer.allocUnsafe(blockSize),this._blockSize=blockSize,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}require("inherits")(HashBase,Transform),HashBase.prototype._transform=function(chunk,encoding,callback){var error=null;try{this.update(chunk,encoding)}catch(err){error=err}callback(error)},HashBase.prototype._flush=function(callback){var error=null;try{this.push(this.digest())}catch(err){error=err}callback(error)},HashBase.prototype.update=function(data,encoding){if(function(val,prefix){if(!Buffer.isBuffer(val)&&"string"!=typeof val)throw new TypeError(prefix+" must be a string or a buffer")}(data,"Data"),this._finalized)throw new Error("Digest already called");Buffer.isBuffer(data)||(data=Buffer.from(data,encoding));for(var block=this._block,offset=0;this._blockOffset+data.length-offset>=this._blockSize;){for(var i=this._blockOffset;i<this._blockSize;)block[i++]=data[offset++];this._update(),this._blockOffset=0}for(;offset<data.length;)block[this._blockOffset++]=data[offset++];for(var j=0,carry=8*data.length;carry>0;++j)this._length[j]+=carry,(carry=this._length[j]/4294967296|0)>0&&(this._length[j]-=4294967296*carry);return this},HashBase.prototype._update=function(){throw new Error("_update is not implemented")},HashBase.prototype.digest=function(encoding){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var digest=this._digest();void 0!==encoding&&(digest=digest.toString(encoding)),this._block.fill(0),this._blockOffset=0;for(var i=0;i<4;++i)this._length[i]=0;return digest},HashBase.prototype._digest=function(){throw new Error("_digest is not implemented")},module.exports=HashBase},{inherits:352,"safe-buffer":401,stream:421}],357:[function(require,module,exports){var bn=require("bn.js"),brorand=require("brorand");function MillerRabin(rand){this.rand=rand||new brorand.Rand}module.exports=MillerRabin,MillerRabin.create=function(rand){return new MillerRabin(rand)},MillerRabin.prototype._randbelow=function(n){var len=n.bitLength(),min_bytes=Math.ceil(len/8);do{var a=new bn(this.rand.generate(min_bytes))}while(a.cmp(n)>=0);return a},MillerRabin.prototype._randrange=function(start,stop){var size=stop.sub(start);return start.add(this._randbelow(size))},MillerRabin.prototype.test=function(n,k,cb){var len=n.bitLength(),red=bn.mont(n),rone=new bn(1).toRed(red);k||(k=Math.max(1,len/48|0));for(var n1=n.subn(1),s=0;!n1.testn(s);s++);for(var d=n.shrn(s),rn1=n1.toRed(red);k>0;k--){var a=this._randrange(new bn(2),n1);cb&&cb(a);var x=a.toRed(red).redPow(d);if(0!==x.cmp(rone)&&0!==x.cmp(rn1)){for(var i=1;i<s;i++){if(0===(x=x.redSqr()).cmp(rone))return!1;if(0===x.cmp(rn1))break}if(i===s)return!1}}return!0},MillerRabin.prototype.getDivisor=function(n,k){var len=n.bitLength(),red=bn.mont(n),rone=new bn(1).toRed(red);k||(k=Math.max(1,len/48|0));for(var n1=n.subn(1),s=0;!n1.testn(s);s++);for(var d=n.shrn(s),rn1=n1.toRed(red);k>0;k--){var a=this._randrange(new bn(2),n1),g=n.gcd(a);if(0!==g.cmpn(1))return g;var x=a.toRed(red).redPow(d);if(0!==x.cmp(rone)&&0!==x.cmp(rn1)){for(var i=1;i<s;i++){if(0===(x=x.redSqr()).cmp(rone))return x.fromRed().subn(1).gcd(n);if(0===x.cmp(rn1))break}if(i===s)return(x=x.redSqr()).fromRed().subn(1).gcd(n)}}return!1}},{"bn.js":217,brorand:218}],358:[function(require,module,exports){module.exports=assert;function assert(val,msg){if(!val)throw new Error(msg||"Assertion failed")}assert.equal=function(l,r,msg){if(l!=r)throw new Error(msg||"Assertion failed: "+l+" != "+r)}},{}],359:[function(require,module,exports){"use strict";var utils=exports;utils.toArray=function(msg,enc){if(Array.isArray(msg))return msg.slice();if(!msg)return[];var res=[];if("string"!=typeof msg){for(var i=0;i<msg.length;i++)res[i]=0|msg[i];return res}if("hex"===enc)for((msg=msg.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(msg="0"+msg),i=0;i<msg.length;i+=2)res.push(parseInt(msg[i]+msg[i+1],16));else for(i=0;i<msg.length;i++){var c=msg.charCodeAt(i),hi=c>>8,lo=255&c;hi?res.push(hi,lo):res.push(lo)}return res};function zero2(word){return 1===word.length?"0"+word:word}utils.zero2=zero2;function toHex(msg){for(var res="",i=0;i<msg.length;i++)res+=zero2(msg[i].toString(16));return res}utils.toHex=toHex,utils.encode=function(arr,enc){return"hex"===enc?toHex(arr):arr}},{}],360:[function(require,module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function N64(sign){enforce(this instanceof N64,"this","N64"),enforce(0===sign||1===sign,"sign","bit"),this.hi=0,this.lo=0,this.sign=sign}N64.prototype._add=function(bhi,blo){var ahi=this.hi,alo=this.lo,lo=alo+blo|0,as=alo>>31,bs=blo>>31,hi=(ahi+bhi|0)+(1&(as&bs|~(lo>>31)&(as^bs)));return this.hi=0|hi,this.lo=lo,this},N64.prototype.iadd=function(b){return enforce(N64.isN64(b),"operand","int64"),this._add(b.hi,b.lo)},N64.prototype.iaddn=function(num){return enforce(isNumber(num),"operand","number"),this._add(num>>31&-this.sign,0|num)},N64.prototype.add=function(b){return this.clone().iadd(b)},N64.prototype.addn=function(num){return this.clone().iaddn(num)},N64.prototype._sub=function(bhi,blo){return bhi=~bhi,-1===(blo=~blo)?(blo=0,bhi+=1,bhi|=0):blo+=1,this._add(bhi,blo)},N64.prototype.isub=function(b){return enforce(N64.isN64(b),"operand","int64"),this._sub(b.hi,b.lo)},N64.prototype.isubn=function(num){return enforce(isNumber(num),"operand","number"),this._sub(num>>31&-this.sign,0|num)},N64.prototype.sub=function(b){return this.clone().isub(b)},N64.prototype.subn=function(num){return this.clone().isubn(num)},N64.prototype._mul=function(bhi,blo){var ahi=this.hi,alo=this.lo,a32=65535&ahi,a16=alo>>>16,a00=65535&alo,b32=65535&bhi,b16=blo>>>16,b00=65535&blo,c48=0,c32=0,c16=0,c00=0;c16+=(c00+=a00*b00)>>>16,c32+=(c16+=a16*b00)>>>16,c16&=65535,c32+=(c16+=a00*b16)>>>16,c48+=(c32+=a32*b00)>>>16,c32&=65535,c48+=(c32+=a16*b16)>>>16,c32&=65535,c48+=(c32+=a00*b32)>>>16,c48+=(ahi>>>16)*b00+a32*b16+a16*b32+a00*(bhi>>>16);var hi=(c48&=65535)<<16|(c32&=65535),lo=(c16&=65535)<<16|(c00&=65535);return this.hi=hi,this.lo=lo,this},N64.prototype.imul=function(b){return enforce(N64.isN64(b),"multiplicand","int64"),this._mul(b.hi,b.lo)},N64.prototype.imuln=function(num){return enforce(isNumber(num),"multiplicand","number"),this._mul(num>>31&-this.sign,0|num)},N64.prototype.mul=function(b){return this.clone().imul(b)},N64.prototype.muln=function(num){return this.clone().imuln(num)},N64.prototype.idiv=function(b){var a=this;if(enforce(N64.isN64(b),"divisor","int64"),b.isZero())throw new Error("Cannot divide by zero.");if(a.isZero())return a;if(a.eq(b))return a.set(1);if(a.isSafe()&&b.isSafe()){var _q=function(n){return n<0?-Math.floor(-n):Math.floor(n)}(a.toDouble()/b.toDouble());return a.set(_q)}var neg=!1;a.sign&&(a.hi<0?b.hi<0?(a=a.ineg(),b=b.neg()):(a=a.ineg(),neg=!0):b.hi<0&&(b=b.neg(),neg=!0));var n=a.toU64(),d=b.toU64();if(n.lt(d))return a.set(0);if(n.ushrn(1).lt(d))return a.set(neg?-1:1);for(var q=new U64,r=new U64,bit=n.bitLength();bit--;)r.ishln(1),r.lo|=n.testn(bit),r.gte(d)&&(r.isub(d),q.setn(bit,1));return a.hi=q.hi,a.lo=q.lo,neg&&a.ineg(),a},N64.prototype.idivn=function(num){return enforce(isNumber(num),"divisor","number"),this.idiv(this._small(num))},N64.prototype.div=function(b){return this.clone().idiv(b)},N64.prototype.divn=function(num){return this.clone().idivn(num)},N64.prototype.imod=function(b){var a=this;if(enforce(N64.isN64(b),"divisor","int64"),b.isZero())throw new Error("Cannot divide by zero.");if(a.isZero())return a;if(a.eq(b))return a.set(0);if(a.isSafe()&&b.isSafe()){var r=a.toDouble()%b.toDouble();return a.set(r)}return a.isub(a.div(b).imul(b))},N64.prototype.imodn=function(num){return enforce(isNumber(num),"divisor","number"),this.imod(this._small(num))},N64.prototype.mod=function(b){return this.clone().imod(b)},N64.prototype.modn=function(num){return this.clone().imodn(num)},N64.prototype.ipow=function(b){return enforce(N64.isN64(b),"exponent","int64"),this.ipown(b.lo)},N64.prototype.ipown=function(num){if(enforce(isNumber(num),"exponent","number"),this.isZero())return this;var x=this.clone(),n=this,y=num>>>0;for(n.set(1);y>0;)1&y&&n.imul(x),y>>>=1,x.imul(x);return n},N64.prototype.pow=function(b){return this.clone().ipow(b)},N64.prototype.pown=function(num){return this.clone().ipown(num)},N64.prototype.sqr=function(){return this.mul(this)},N64.prototype.isqr=function(){return this.imul(this)},N64.prototype.iand=function(b){return enforce(N64.isN64(b),"operand","int64"),this.hi&=b.hi,this.lo&=b.lo,this},N64.prototype.iandn=function(num){return enforce(isNumber(num),"operand","number"),this.hi&=num>>31&-this.sign,this.lo&=0|num,this},N64.prototype.and=function(b){return this.clone().iand(b)},N64.prototype.andn=function(num){return this.clone().iandn(num)},N64.prototype.ior=function(b){return enforce(N64.isN64(b),"operand","int64"),this.hi|=b.hi,this.lo|=b.lo,this},N64.prototype.iorn=function(num){return enforce(isNumber(num),"operand","number"),this.hi|=num>>31&-this.sign,this.lo|=0|num,this},N64.prototype.or=function(b){return this.clone().ior(b)},N64.prototype.orn=function(num){return this.clone().iorn(num)},N64.prototype.ixor=function(b){return enforce(N64.isN64(b),"operand","int64"),this.hi^=b.hi,this.lo^=b.lo,this},N64.prototype.ixorn=function(num){return enforce(isNumber(num),"operand","number"),this.hi^=num>>31&-this.sign,this.lo^=0|num,this},N64.prototype.xor=function(b){return this.clone().ixor(b)},N64.prototype.xorn=function(num){return this.clone().ixorn(num)},N64.prototype.inot=function(){return this.hi=~this.hi,this.lo=~this.lo,this},N64.prototype.not=function(){return this.clone().inot()},N64.prototype.ishl=function(b){return enforce(N64.isN64(b),"bits","int64"),this.ishln(b.lo)},N64.prototype.ishln=function(bits){if(enforce(isNumber(bits),"bits","number"),0===(bits&=63))return this;var hi=this.hi,lo=this.lo;return bits<32?(hi<<=bits,hi|=lo>>>32-bits,lo<<=bits):(hi=lo<<bits-32,lo=0),this.hi=hi,this.lo=lo,this},N64.prototype.shl=function(b){return this.clone().ishl(b)},N64.prototype.shln=function(bits){return this.clone().ishln(bits)},N64.prototype.ishr=function(b){return enforce(N64.isN64(b),"bits","int64"),this.ishrn(b.lo)},N64.prototype.ishrn=function(bits){if(!this.sign)return this.iushrn(bits);if(enforce(isNumber(bits),"bits","number"),0===(bits&=63))return this;var hi=this.hi,lo=this.lo;return bits<32?(lo>>>=bits,lo|=hi<<32-bits,hi>>=bits):(lo=hi>>bits-32,hi>>=31),this.hi=hi,this.lo=lo,this},N64.prototype.shr=function(b){return this.clone().ishr(b)},N64.prototype.shrn=function(bits){return this.clone().ishrn(bits)},N64.prototype.iushr=function(b){return enforce(N64.isN64(b),"bits","int64"),this.iushrn(b.lo)},N64.prototype.iushrn=function(bits){if(enforce(isNumber(bits),"bits","number"),0===(bits&=63))return this;var hi=this.hi,lo=this.lo;return bits<32?(lo>>>=bits,lo|=hi<<32-bits,hi>>>=bits):(lo=hi>>>bits-32,hi=0),this.hi=0|hi,this.lo=0|lo,this},N64.prototype.ushr=function(b){return this.clone().iushr(b)},N64.prototype.ushrn=function(bits){return this.clone().iushrn(bits)},N64.prototype.setn=function(bit,val){return enforce(isNumber(bit),"bit","number"),(bit&=63)<32?val?this.lo|=1<<bit:this.lo&=~(1<<bit):val?this.hi|=1<<bit-32:this.hi&=~(1<<bit-32),this},N64.prototype.testn=function(bit){return enforce(isNumber(bit),"bit","number"),(bit&=63)<32?this.lo>>>bit&1:this.hi>>>bit-32&1},N64.prototype.setb=function(pos,ch){return enforce(isNumber(pos),"pos","number"),enforce(isNumber(ch),"ch","number"),ch&=255,(pos&=7)<4?(this.lo&=~(255<<8*pos),this.lo|=ch<<8*pos):(this.hi&=~(255<<8*(pos-4)),this.hi|=ch<<8*(pos-4)),this},N64.prototype.orb=function(pos,ch){return enforce(isNumber(pos),"pos","number"),enforce(isNumber(ch),"ch","number"),ch&=255,(pos&=7)<4?this.lo|=ch<<8*pos:this.hi|=ch<<8*(pos-4),this},N64.prototype.getb=function(pos){return enforce(isNumber(pos),"pos","number"),(pos&=7)<4?this.lo>>8*pos&255:this.hi>>8*(pos-4)&255},N64.prototype.imaskn=function(bit){return enforce(isNumber(bit),"bit","number"),(bit&=63)<32?(this.hi=0,this.lo&=(1<<bit)-1):(this.hi&=(1<<bit-32)-1,this.lo&=4294967295),this},N64.prototype.maskn=function(bit){return this.clone().imaskn(bit)},N64.prototype.andln=function(num){return enforce(isNumber(num),"operand","number"),this.lo&num},N64.prototype.ineg=function(){var hi=~this.hi,lo=~this.lo;return-1===lo?(lo=0,hi+=1,hi|=0):lo+=1,this.hi=hi,this.lo=lo,this},N64.prototype.neg=function(){return this.clone().ineg()},N64.prototype.iabs=function(){return this.isNeg()&&this.ineg(),this},N64.prototype.abs=function(){return this.clone().iabs()},N64.prototype._cmp=function(bhi,blo){var a=this,ahi=a.hi,alo=a.lo;if(ahi===bhi&&alo===blo)return 0;var neg=!1;if(a.sign){var x=ahi<0,y=bhi<0;if(x&&!y)return-1;if(!x&&y)return 1;neg=x}return neg||(ahi>>>=0,bhi>>>=0),ahi<bhi?-1:ahi>bhi?1:(alo>>>=0)<(blo>>>=0)?-1:1},N64.prototype.cmp=function(b){return enforce(N64.isN64(b),"value","int64"),this._cmp(b.hi,b.lo)},N64.prototype.cmpn=function(num){return enforce(isNumber(num),"value","number"),this._cmp(num>>31&-this.sign,0|num)},N64.prototype.eq=function(b){return enforce(N64.isN64(b),"value","int64"),this.hi===b.hi&&this.lo===b.lo},N64.prototype.eqn=function(num){return enforce(isNumber(num),"value","number"),this.hi===(num>>31&-this.sign)&&this.lo===(0|num)},N64.prototype.gt=function(b){return this.cmp(b)>0},N64.prototype.gtn=function(num){return this.cmpn(num)>0},N64.prototype.gte=function(b){return this.cmp(b)>=0},N64.prototype.gten=function(num){return this.cmpn(num)>=0},N64.prototype.lt=function(b){return this.cmp(b)<0},N64.prototype.ltn=function(num){return this.cmpn(num)<0},N64.prototype.lte=function(b){return this.cmp(b)<=0},N64.prototype.lten=function(num){return this.cmpn(num)<=0},N64.prototype.isZero=function(){return 0===this.hi&&0===this.lo},N64.prototype.isNeg=function(){return 1===this.sign&&this.hi<0},N64.prototype.isOdd=function(){return 1==(1&this.lo)},N64.prototype.isEven=function(){return 0==(1&this.lo)},N64.prototype.clone=function(){var n=new this.constructor;return n.hi=this.hi,n.lo=this.lo,n},N64.prototype.inject=function(b){return enforce(N64.isN64(b),"value","int64"),this.hi=b.hi,this.lo=b.lo,this},N64.prototype.set=function(num){enforce(function(num){return Number.isSafeInteger?Number.isSafeInteger(num):isNumber(num)&&Math.floor(num)===num&&num>=-9007199254740991&&num<=9007199254740991}(num),"number","integer");var neg=!1;return num<0&&(num=-num,neg=!0),this.hi=num*(1/4294967296)|0,this.lo=0|num,neg&&this.ineg(),this},N64.prototype.join=function(hi,lo){return enforce(isNumber(hi),"hi","number"),enforce(isNumber(lo),"lo","number"),this.hi=0|hi,this.lo=0|lo,this},N64.prototype._small=function(num){var n=new this.constructor;return n.hi=num>>31&-this.sign,n.lo=0|num,n},N64.prototype.bitLength=function(){var a=this;return this.isNeg()&&(a=this.neg()),0===a.hi?countBits(a.lo):countBits(a.hi)+32},N64.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},N64.prototype.isSafe=function(){var hi=this.hi;return this.isNeg()&&(hi=~hi,0===this.lo&&(hi+=1)),0==(4292870144&hi)},N64.prototype.inspect=function(){var prefix="I64";return this.sign||(prefix="U64"),"<"+prefix+": "+this.toString(10)+">"},N64.prototype.readLE=function(data,off){return enforce(data&&"number"==typeof data.length,"data","arraylike"),enforce(off>>0===off,"offset","integer"),enforce(off+8<=data.length,"offset","valid offset"),this.lo=readI32LE(data,off),this.hi=readI32LE(data,off+4),off+8},N64.prototype.readBE=function(data,off){return enforce(data&&"number"==typeof data.length,"data","arraylike"),enforce(off>>0===off,"offset","integer"),enforce(off+8<=data.length,"offset","valid offset"),this.hi=readI32BE(data,off),this.lo=readI32BE(data,off+4),off+8},N64.prototype.readRaw=function(data,off){return this.readLE(data,off)},N64.prototype.writeLE=function(data,off){return enforce(data&&"number"==typeof data.length,"data","arraylike"),enforce(off>>0===off,"offset","integer"),enforce(off+8<=data.length,"offset","valid offset"),writeI32LE(data,this.lo,off),writeI32LE(data,this.hi,off+4),off+8},N64.prototype.writeBE=function(data,off){return enforce(data&&"number"==typeof data.length,"data","arraylike"),enforce(off>>0===off,"offset","integer"),enforce(off+8<=data.length,"offset","valid offset"),writeI32BE(data,this.hi,off),writeI32BE(data,this.lo,off+4),off+8},N64.prototype.writeRaw=function(data,off){return this.writeLE(data,off)},N64.prototype.toU64=function(){var n=new U64;return n.hi=this.hi,n.lo=this.lo,n},N64.prototype.toI64=function(){var n=new I64;return n.hi=this.hi,n.lo=this.lo,n},N64.prototype.toNumber=function(){if(!this.isSafe())throw new Error("Number exceeds 53 bits.");return this.toDouble()},N64.prototype.toDouble=function(){var hi=this.hi;return this.sign||(hi>>>=0),4294967296*hi+(this.lo>>>0)},N64.prototype.toInt=function(){return this.sign?this.lo:this.lo>>>0},N64.prototype.toBool=function(){return!this.isZero()},N64.prototype.toBits=function(){return[this.hi,this.lo]},N64.prototype.toObject=function(){return{hi:this.hi,lo:this.lo}},N64.prototype.toString=function(base,pad){if(base=getBase(base),null==pad&&(pad=0),enforce(base>>>0===base,"base","integer"),enforce(pad>>>0===pad,"pad","integer"),base<2||base>16)throw new Error("Base ranges between 2 and 16.");if(pad>64)throw new Error("Maximum padding is 64 characters.");var n=this,neg=!1;n.isNeg()&&(n=n.neg(),neg=!0);var hi=n.hi>>>0,lo=n.lo>>>0,str="";do{var mhi=hi%base;hi-=mhi,hi/=base;var mlo=(lo+=4294967296*mhi)%base;lo-=mlo,lo/=base;var ch=mlo;ch+=ch<10?48:87,str=String.fromCharCode(ch)+str}while(lo>0||hi>0);for(;str.length<pad;)str="0"+str;return neg&&(str="-"+str),str},N64.prototype.toJSON=function(){return this.toString(16,16)},N64.prototype.toBN=function(BN){var neg=this.isNeg(),hi=this.hi,lo=this.lo;neg&&(hi=~hi,-1===(lo=~lo)?(lo=0,hi+=1,hi|=0):lo+=1),lo>>>=0;var num=new BN(hi>>>=0);return num.ishln(32),num.iadd(new BN(lo)),neg&&num.ineg(),num},N64.prototype.toLE=function(ArrayLike){enforce("function"==typeof ArrayLike,"ArrayLike","constructor");var data=alloc(ArrayLike,8);return this.writeLE(data,0),data},N64.prototype.toBE=function(ArrayLike){enforce("function"==typeof ArrayLike,"ArrayLike","constructor");var data=alloc(ArrayLike,8);return this.writeBE(data,0),data},N64.prototype.toRaw=function(ArrayLike){return this.toLE(ArrayLike)},N64.prototype.fromNumber=function(num){return this.set(num)},N64.prototype.fromInt=function(num){return enforce(isNumber(num),"integer","number"),this.join(num>>31&-this.sign,num)},N64.prototype.fromBool=function(value){return enforce("boolean"==typeof value,"value","boolean"),this.hi=0,this.lo=value?1:0,this},N64.prototype.fromBits=function(hi,lo){return this.join(hi,lo)},N64.prototype.fromObject=function(num){return enforce(num&&"object"===(void 0===num?"undefined":_typeof(num)),"number","object"),this.fromBits(num.hi,num.lo)},N64.prototype.fromString=function(str,base){if(base=getBase(base),enforce("string"==typeof str,"string","string"),enforce(base>>>0===base,"base","integer"),base<2||base>16)throw new Error("Base ranges between 2 and 16.");var neg=!1,i=0;if(str.length>0&&"-"===str[0]&&(i+=1,neg=!0),str.length===i||str.length>i+64)throw new Error("Invalid string (bad length).");for(var hi=0,lo=0;i<str.length;i++){var ch=str.charCodeAt(i);if(ch>=48&&ch<=57?ch-=48:ch>=65&&ch<=90?ch-=55:ch>=97&&ch<=122?ch-=87:ch=base,ch>=base)throw new Error("Invalid string (parse error).");if(lo*=base,hi*=base,(lo+=ch)>4294967295&&(hi+=(lo-(ch=lo%4294967296))/4294967296,lo=ch),hi>4294967295)throw new Error("Invalid string (overflow).")}return this.hi=0|hi,this.lo=0|lo,neg&&this.ineg(),this},N64.prototype.fromJSON=function(json){return this.fromString(json,16)},N64.prototype.fromBN=function(num){enforce(num&&isArray(num.words),"number","big number");var a=this,b=num.clone(),neg=b.isNeg();if(a.sign&&b.testn(63))throw new Error("Big number overflow.");for(var i=0;!b.isZero();){if(8===i)throw new Error("Big number overflow.");a.orb(i,b.andln(255)),b.iushrn(8),i++}return neg&&a.ineg(),a},N64.prototype.fromLE=function(data){return this.readLE(data,0),this},N64.prototype.fromBE=function(data){return this.readBE(data,0),this},N64.prototype.fromRaw=function(data){return this.fromLE(data)},N64.prototype.from=function(num,base){if(null==num)return this;if("number"==typeof num)return"number"==typeof base?this.fromBits(num,base):this.fromNumber(num);if("string"==typeof num)return this.fromString(num,base);if("object"===(void 0===num?"undefined":_typeof(num)))return isArray(num.words)?this.fromBN(num):"number"==typeof num.length?this.fromRaw(num):this.fromObject(num);if("boolean"==typeof num)return this.fromBool(num);throw new TypeError("Non-numeric object passed to N64.")},N64.min=function(a,b){return a.cmp(b)<0?a:b},N64.max=function(a,b){return a.cmp(b)>0?a:b},N64.random=function(){var n=new this;return n.hi=4294967296*Math.random()|0,n.lo=4294967296*Math.random()|0,n},N64.pow=function(num,exp){return(new this).fromInt(num).ipown(exp)},N64.shift=function(num,bits){return(new this).fromInt(num).ishln(bits)},N64.readLE=function(data,off){var n=new this;return n.readLE(data,off),n},N64.readBE=function(data,off){var n=new this;return n.readBE(data,off),n},N64.readRaw=function(data,off){var n=new this;return n.readRaw(data,off),n},N64.fromNumber=function(num){return(new this).fromNumber(num)},N64.fromInt=function(num){return(new this).fromInt(num)},N64.fromBool=function(value){return(new this).fromBool(value)},N64.fromBits=function(hi,lo){return(new this).fromBits(hi,lo)},N64.fromObject=function(obj){return(new this).fromObject(obj)},N64.fromString=function(str,base){return(new this).fromString(str,base)},N64.fromJSON=function(json){return(new this).fromJSON(json)},N64.fromBN=function(num){return(new this).fromBN(num)},N64.fromLE=function(data){return(new this).fromLE(data)},N64.fromBE=function(data){return(new this).fromBE(data)},N64.fromRaw=function(data){return(new this).fromRaw(data)},N64.from=function(num,base){return(new this).from(num,base)},N64.isN64=function(obj){return obj instanceof N64},N64.isU64=function(obj){return obj instanceof U64},N64.isI64=function(obj){return obj instanceof I64};function U64(num,base){if(!(this instanceof U64))return new U64(num,base);N64.call(this,0),this.from(num,base)}U64.__proto__=N64,U64.prototype.__proto__=N64.prototype,U64.ULONG_MIN=0,U64.ULONG_MAX=4294967295,U64.UINT32_MIN=U64(0,0),U64.UINT32_MAX=U64(0,4294967295),U64.UINT64_MIN=U64(0,0),U64.UINT64_MAX=U64(4294967295,4294967295);function I64(num,base){if(!(this instanceof I64))return new I64(num,base);N64.call(this,1),this.from(num,base)}I64.__proto__=N64,I64.prototype.__proto__=N64.prototype,I64.LONG_MIN=-2147483648,I64.LONG_MAX=2147483647,I64.INT32_MIN=I64(4294967295,2147483648),I64.INT32_MAX=I64(0,2147483647),I64.INT64_MIN=I64(2147483648,0),I64.INT64_MAX=I64(2147483647,4294967295);function getBase(base){if(null==base)return 10;if("number"==typeof base)return base;switch(base){case"bin":return 2;case"oct":return 8;case"dec":return 10;case"hex":return 16}return 0}function countBits(word){if(Math.clz32)return 32-Math.clz32(word);for(var bit=31;bit>=0&&0==(word&1<<bit);bit--);return bit+1}function enforce(value,name,type){if(!value){var err=new TypeError("'"+name+"' must be a(n) "+type+".");throw Error.captureStackTrace&&Error.captureStackTrace(err,enforce),err}}function isNumber(num){return"number"==typeof num&&isFinite(num)}function isArray(num){return Array.isArray?Array.isArray(num):"Array"==={}.toString.call(num).slice(8,-1)}function alloc(ArrayLike,size){return ArrayLike.allocUnsafe?ArrayLike.allocUnsafe(size):new ArrayLike(size)}function readI32LE(data,off){return data[off]|data[off+1]<<8|data[off+2]<<16|data[off+3]<<24}function readI32BE(data,off){return data[off]<<24|data[off+1]<<16|data[off+2]<<8|data[off+3]}function writeI32LE(data,num,off){data[off]=255&num,data[off+1]=num>>>8&255,data[off+2]=num>>>16&255,data[off+3]=num>>>24&255}function writeI32BE(data,num,off){data[off]=num>>>24&255,data[off+1]=num>>>16&255,data[off+2]=num>>>8&255,data[off+3]=255&num}exports.N64=N64,exports.U64=U64,exports.I64=I64},{}],361:[function(require,module,exports){exports.endianness=function(){return"LE"},exports.hostname=function(){return"undefined"!=typeof location?location.hostname:""},exports.loadavg=function(){return[]},exports.uptime=function(){return 0},exports.freemem=function(){return Number.MAX_VALUE},exports.totalmem=function(){return Number.MAX_VALUE},exports.cpus=function(){return[]},exports.type=function(){return"Browser"},exports.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},exports.networkInterfaces=exports.getNetworkInterfaces=function(){return{}},exports.arch=function(){return"javascript"},exports.platform=function(){return"browser"},exports.tmpdir=exports.tmpDir=function(){return"/tmp"},exports.EOL="\n",exports.homedir=function(){return"/"}},{}],362:[function(require,module,exports){module.exports={"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"}},{}],363:[function(require,module,exports){"use strict";var asn1=require("asn1.js");exports.certificate=require("./certificate");var RSAPrivateKey=asn1.define("RSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())});exports.RSAPrivateKey=RSAPrivateKey;var RSAPublicKey=asn1.define("RSAPublicKey",function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())});exports.RSAPublicKey=RSAPublicKey;var PublicKey=asn1.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(AlgorithmIdentifier),this.key("subjectPublicKey").bitstr())});exports.PublicKey=PublicKey;var AlgorithmIdentifier=asn1.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("none").null_().optional(),this.key("curve").objid().optional(),this.key("params").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()).optional())}),PrivateKeyInfo=asn1.define("PrivateKeyInfo",function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(AlgorithmIdentifier),this.key("subjectPrivateKey").octstr())});exports.PrivateKey=PrivateKeyInfo;var EncryptedPrivateKeyInfo=asn1.define("EncryptedPrivateKeyInfo",function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())});exports.EncryptedPrivateKey=EncryptedPrivateKeyInfo;var DSAPrivateKey=asn1.define("DSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())});exports.DSAPrivateKey=DSAPrivateKey,exports.DSAparam=asn1.define("DSAparam",function(){this.int()});var ECPrivateKey=asn1.define("ECPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(ECParameters),this.key("publicKey").optional().explicit(1).bitstr())});exports.ECPrivateKey=ECPrivateKey;var ECParameters=asn1.define("ECParameters",function(){this.choice({namedCurve:this.objid()})});exports.signature=asn1.define("signature",function(){this.seq().obj(this.key("r").int(),this.key("s").int())})},{"./certificate":364,"asn1.js":132}],364:[function(require,module,exports){"use strict";var asn=require("asn1.js"),Time=asn.define("Time",function(){this.choice({utcTime:this.utctime(),generalTime:this.gentime()})}),AttributeTypeValue=asn.define("AttributeTypeValue",function(){this.seq().obj(this.key("type").objid(),this.key("value").any())}),AlgorithmIdentifier=asn.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional())}),SubjectPublicKeyInfo=asn.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(AlgorithmIdentifier),this.key("subjectPublicKey").bitstr())}),RelativeDistinguishedName=asn.define("RelativeDistinguishedName",function(){this.setof(AttributeTypeValue)}),RDNSequence=asn.define("RDNSequence",function(){this.seqof(RelativeDistinguishedName)}),Name=asn.define("Name",function(){this.choice({rdnSequence:this.use(RDNSequence)})}),Validity=asn.define("Validity",function(){this.seq().obj(this.key("notBefore").use(Time),this.key("notAfter").use(Time))}),Extension=asn.define("Extension",function(){this.seq().obj(this.key("extnID").objid(),this.key("critical").bool().def(!1),this.key("extnValue").octstr())}),TBSCertificate=asn.define("TBSCertificate",function(){this.seq().obj(this.key("version").explicit(0).int(),this.key("serialNumber").int(),this.key("signature").use(AlgorithmIdentifier),this.key("issuer").use(Name),this.key("validity").use(Validity),this.key("subject").use(Name),this.key("subjectPublicKeyInfo").use(SubjectPublicKeyInfo),this.key("issuerUniqueID").implicit(1).bitstr().optional(),this.key("subjectUniqueID").implicit(2).bitstr().optional(),this.key("extensions").explicit(3).seqof(Extension).optional())}),X509Certificate=asn.define("X509Certificate",function(){this.seq().obj(this.key("tbsCertificate").use(TBSCertificate),this.key("signatureAlgorithm").use(AlgorithmIdentifier),this.key("signatureValue").bitstr())});module.exports=X509Certificate},{"asn1.js":132}],365:[function(require,module,exports){(function(Buffer){var findProc=/Proc-Type: 4,ENCRYPTED\n\r?DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)\n\r?\n\r?([0-9A-z\n\r\+\/\=]+)\n\r?/m,startRegex=/^-----BEGIN ((?:.* KEY)|CERTIFICATE)-----\n/m,fullRegex=/^-----BEGIN ((?:.* KEY)|CERTIFICATE)-----\n\r?([0-9A-z\n\r\+\/\=]+)\n\r?-----END \1-----$/m,evp=require("evp_bytestokey"),ciphers=require("browserify-aes");module.exports=function(okey,password){var decrypted,key=okey.toString(),match=key.match(findProc);if(match){var suite="aes"+match[1],iv=new Buffer(match[2],"hex"),cipherText=new Buffer(match[3].replace(/\r?\n/g,""),"base64"),cipherKey=evp(password,iv.slice(0,8),parseInt(match[1],10)).key,out=[],cipher=ciphers.createDecipheriv(suite,cipherKey,iv);out.push(cipher.update(cipherText)),out.push(cipher.final()),decrypted=Buffer.concat(out)}else{var match2=key.match(fullRegex);decrypted=new Buffer(match2[2].replace(/\r?\n/g,""),"base64")}return{tag:key.match(startRegex)[1],data:decrypted}}}).call(this,require("buffer").Buffer)},{"browserify-aes":222,buffer:269,evp_bytestokey:335}],366:[function(require,module,exports){(function(Buffer){var asn1=require("./asn1"),aesid=require("./aesid.json"),fixProc=require("./fixProc"),ciphers=require("browserify-aes"),compat=require("pbkdf2");module.exports=parseKeys;function parseKeys(buffer){var password;"object"!=typeof buffer||Buffer.isBuffer(buffer)||(password=buffer.passphrase,buffer=buffer.key),"string"==typeof buffer&&(buffer=new Buffer(buffer));var subtype,ndata,stripped=fixProc(buffer,password),type=stripped.tag,data=stripped.data;switch(type){case"CERTIFICATE":ndata=asn1.certificate.decode(data,"der").tbsCertificate.subjectPublicKeyInfo;case"PUBLIC KEY":switch(ndata||(ndata=asn1.PublicKey.decode(data,"der")),subtype=ndata.algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return asn1.RSAPublicKey.decode(ndata.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":return ndata.subjectPrivateKey=ndata.subjectPublicKey,{type:"ec",data:ndata};case"1.2.840.10040.4.1":return ndata.algorithm.params.pub_key=asn1.DSAparam.decode(ndata.subjectPublicKey.data,"der"),{type:"dsa",data:ndata.algorithm.params};default:throw new Error("unknown key id "+subtype)}throw new Error("unknown key type "+type);case"ENCRYPTED PRIVATE KEY":data=function(data,password){var salt=data.algorithm.decrypt.kde.kdeparams.salt,iters=parseInt(data.algorithm.decrypt.kde.kdeparams.iters.toString(),10),algo=aesid[data.algorithm.decrypt.cipher.algo.join(".")],iv=data.algorithm.decrypt.cipher.iv,cipherText=data.subjectPrivateKey,keylen=parseInt(algo.split("-")[1],10)/8,key=compat.pbkdf2Sync(password,salt,iters,keylen),cipher=ciphers.createDecipheriv(algo,key,iv),out=[];return out.push(cipher.update(cipherText)),out.push(cipher.final()),Buffer.concat(out)}(data=asn1.EncryptedPrivateKey.decode(data,"der"),password);case"PRIVATE KEY":switch(subtype=(ndata=asn1.PrivateKey.decode(data,"der")).algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return asn1.RSAPrivateKey.decode(ndata.subjectPrivateKey,"der");case"1.2.840.10045.2.1":return{curve:ndata.algorithm.curve,privateKey:asn1.ECPrivateKey.decode(ndata.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":return ndata.algorithm.params.priv_key=asn1.DSAparam.decode(ndata.subjectPrivateKey,"der"),{type:"dsa",params:ndata.algorithm.params};default:throw new Error("unknown key id "+subtype)}throw new Error("unknown key type "+type);case"RSA PUBLIC KEY":return asn1.RSAPublicKey.decode(data,"der");case"RSA PRIVATE KEY":return asn1.RSAPrivateKey.decode(data,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:asn1.DSAPrivateKey.decode(data,"der")};case"EC PRIVATE KEY":return{curve:(data=asn1.ECPrivateKey.decode(data,"der")).parameters.value,privateKey:data.privateKey};default:throw new Error("unknown key type "+type)}}parseKeys.signature=asn1.signature}).call(this,require("buffer").Buffer)},{"./aesid.json":362,"./asn1":363,"./fixProc":365,"browserify-aes":222,buffer:269,pbkdf2:368}],367:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){for(var up=0,i=parts.length-1;i>=0;i--){var last=parts[i];"."===last?parts.splice(i,1):".."===last?(parts.splice(i,1),up++):up&&(parts.splice(i,1),up--)}if(allowAboveRoot)for(;up--;up)parts.unshift("..");return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){for(var resolvedPath="",resolvedAbsolute=!1,i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if("string"!=typeof path)throw new TypeError("Arguments to path.resolve must be strings");path&&(resolvedPath=path+"/"+resolvedPath,resolvedAbsolute="/"===path.charAt(0))}return resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/"),(resolvedAbsolute?"/":"")+resolvedPath||"."},exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash="/"===substr(path,-1);return(path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/"))||isAbsolute||(path="."),path&&trailingSlash&&(path+="/"),(isAbsolute?"/":"")+path},exports.isAbsolute=function(path){return"/"===path.charAt(0)},exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if("string"!=typeof p)throw new TypeError("Arguments to path.join must be strings");return p}).join("/"))},exports.relative=function(from,to){from=exports.resolve(from).substr(1),to=exports.resolve(to).substr(1);function trim(arr){for(var start=0;start<arr.length&&""===arr[start];start++);for(var end=arr.length-1;end>=0&&""===arr[end];end--);return start>end?[]:arr.slice(start,end-start+1)}for(var fromParts=trim(from.split("/")),toParts=trim(to.split("/")),length=Math.min(fromParts.length,toParts.length),samePartsLength=length,i=0;i<length;i++)if(fromParts[i]!==toParts[i]){samePartsLength=i;break}var outputParts=[];for(i=samePartsLength;i<fromParts.length;i++)outputParts.push("..");return(outputParts=outputParts.concat(toParts.slice(samePartsLength))).join("/")},exports.sep="/",exports.delimiter=":",exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];return root||dir?(dir&&(dir=dir.substr(0,dir.length-1)),root+dir):"."},exports.basename=function(path,ext){var f=splitPath(path)[2];return ext&&f.substr(-1*ext.length)===ext&&(f=f.substr(0,f.length-ext.length)),f},exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);for(var res=[],i=0;i<xs.length;i++)f(xs[i],i,xs)&&res.push(xs[i]);return res}var substr="b"==="ab".substr(-1)?function(str,start,len){return str.substr(start,len)}:function(str,start,len){return start<0&&(start=str.length+start),str.substr(start,len)}}).call(this,require("_process"))},{_process:374}],368:[function(require,module,exports){exports.pbkdf2=require("./lib/async"),exports.pbkdf2Sync=require("./lib/sync")},{"./lib/async":369,"./lib/sync":372}],369:[function(require,module,exports){(function(process,global){var ZERO_BUF,checkParameters=require("./precondition"),defaultEncoding=require("./default-encoding"),sync=require("./sync"),Buffer=require("safe-buffer").Buffer,subtle=global.crypto&&global.crypto.subtle,toBrowser={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},checks=[];function browserPbkdf2(password,salt,iterations,length,algo){return subtle.importKey("raw",password,{name:"PBKDF2"},!1,["deriveBits"]).then(function(key){return subtle.deriveBits({name:"PBKDF2",salt:salt,iterations:iterations,hash:{name:algo}},key,length<<3)}).then(function(res){return Buffer.from(res)})}module.exports=function(password,salt,iterations,keylen,digest,callback){if(Buffer.isBuffer(password)||(password=Buffer.from(password,defaultEncoding)),Buffer.isBuffer(salt)||(salt=Buffer.from(salt,defaultEncoding)),checkParameters(iterations,keylen),"function"==typeof digest&&(callback=digest,digest=void 0),"function"!=typeof callback)throw new Error("No callback provided to pbkdf2");var algo=toBrowser[(digest=digest||"sha1").toLowerCase()];if(!algo||"function"!=typeof global.Promise)return process.nextTick(function(){var out;try{out=sync(password,salt,iterations,keylen,digest)}catch(e){return callback(e)}callback(null,out)});!function(promise,callback){promise.then(function(out){process.nextTick(function(){callback(null,out)})},function(e){process.nextTick(function(){callback(e)})})}(function(algo){if(global.process&&!global.process.browser)return Promise.resolve(!1);if(!subtle||!subtle.importKey||!subtle.deriveBits)return Promise.resolve(!1);if(void 0!==checks[algo])return checks[algo];var prom=browserPbkdf2(ZERO_BUF=ZERO_BUF||Buffer.alloc(8),ZERO_BUF,10,128,algo).then(function(){return!0}).catch(function(){return!1});return checks[algo]=prom,prom}(algo).then(function(resp){return resp?browserPbkdf2(password,salt,iterations,keylen,algo):sync(password,salt,iterations,keylen,digest)}),callback)}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./default-encoding":370,"./precondition":371,"./sync":372,_process:374,"safe-buffer":401}],370:[function(require,module,exports){(function(process){var defaultEncoding;if(process.browser)defaultEncoding="utf-8";else{defaultEncoding=parseInt(process.version.split(".")[0].slice(1),10)>=6?"utf-8":"binary"}module.exports=defaultEncoding}).call(this,require("_process"))},{_process:374}],371:[function(require,module,exports){var MAX_ALLOC=Math.pow(2,30)-1;module.exports=function(iterations,keylen){if("number"!=typeof iterations)throw new TypeError("Iterations not a number");if(iterations<0)throw new TypeError("Bad iterations");if("number"!=typeof keylen)throw new TypeError("Key length not a number");if(keylen<0||keylen>MAX_ALLOC||keylen!=keylen)throw new TypeError("Bad key length")}},{}],372:[function(require,module,exports){var md5=require("create-hash/md5"),rmd160=require("ripemd160"),sha=require("sha.js"),checkParameters=require("./precondition"),defaultEncoding=require("./default-encoding"),Buffer=require("safe-buffer").Buffer,ZEROS=Buffer.alloc(128),sizes={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20};function Hmac(alg,key,saltLen){var hash=function(alg){return"rmd160"===alg||"ripemd160"===alg?rmd160:"md5"===alg?md5:function(data){return sha(alg).update(data).digest()}}(alg),blocksize="sha512"===alg||"sha384"===alg?128:64;key.length>blocksize?key=hash(key):key.length<blocksize&&(key=Buffer.concat([key,ZEROS],blocksize));for(var ipad=Buffer.allocUnsafe(blocksize+sizes[alg]),opad=Buffer.allocUnsafe(blocksize+sizes[alg]),i=0;i<blocksize;i++)ipad[i]=54^key[i],opad[i]=92^key[i];var ipad1=Buffer.allocUnsafe(blocksize+saltLen+4);ipad.copy(ipad1,0,0,blocksize),this.ipad1=ipad1,this.ipad2=ipad,this.opad=opad,this.alg=alg,this.blocksize=blocksize,this.hash=hash,this.size=sizes[alg]}Hmac.prototype.run=function(data,ipad){data.copy(ipad,this.blocksize);return this.hash(ipad).copy(this.opad,this.blocksize),this.hash(this.opad)};module.exports=function(password,salt,iterations,keylen,digest){Buffer.isBuffer(password)||(password=Buffer.from(password,defaultEncoding)),Buffer.isBuffer(salt)||(salt=Buffer.from(salt,defaultEncoding)),checkParameters(iterations,keylen);var hmac=new Hmac(digest=digest||"sha1",password,salt.length),DK=Buffer.allocUnsafe(keylen),block1=Buffer.allocUnsafe(salt.length+4);salt.copy(block1,0,0,salt.length);for(var destPos=0,hLen=sizes[digest],l=Math.ceil(keylen/hLen),i=1;i<=l;i++){block1.writeUInt32BE(i,salt.length);for(var T=hmac.run(block1,hmac.ipad1),U=T,j=1;j<iterations;j++){U=hmac.run(U,hmac.ipad2);for(var k=0;k<hLen;k++)T[k]^=U[k]}T.copy(DK,destPos),destPos+=hLen}return DK}},{"./default-encoding":370,"./precondition":371,"create-hash/md5":302,ripemd160:400,"safe-buffer":401,"sha.js":414}],373:[function(require,module,exports){(function(process){"use strict";!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?module.exports=nextTick:module.exports=process.nextTick;function nextTick(fn,arg1,arg2,arg3){if("function"!=typeof fn)throw new TypeError('"callback" argument must be a function');var args,i,len=arguments.length;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function(){fn.call(null,arg1)});case 3:return process.nextTick(function(){fn.call(null,arg1,arg2)});case 4:return process.nextTick(function(){fn.call(null,arg1,arg2,arg3)});default:for(args=new Array(len-1),i=0;i<args.length;)args[i++]=arguments[i];return process.nextTick(function(){fn.apply(null,args)})}}}).call(this,require("_process"))},{_process:374}],374:[function(require,module,exports){var cachedSetTimeout,cachedClearTimeout,process=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,function(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)};function Item(fun,array){this.fun=fun,this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={};function noop(){}process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],375:[function(require,module,exports){exports.publicEncrypt=require("./publicEncrypt"),exports.privateDecrypt=require("./privateDecrypt"),exports.privateEncrypt=function(key,buf){return exports.publicEncrypt(key,buf,!0)},exports.publicDecrypt=function(key,buf){return exports.privateDecrypt(key,buf,!0)}},{"./privateDecrypt":377,"./publicEncrypt":378}],376:[function(require,module,exports){(function(Buffer){var createHash=require("create-hash");module.exports=function(seed,len){for(var c,t=new Buffer(""),i=0;t.length<len;)c=i2ops(i++),t=Buffer.concat([t,createHash("sha1").update(seed).update(c).digest()]);return t.slice(0,len)};function i2ops(c){var out=new Buffer(4);return out.writeUInt32BE(c,0),out}}).call(this,require("buffer").Buffer)},{buffer:269,"create-hash":300}],377:[function(require,module,exports){(function(Buffer){var parseKeys=require("parse-asn1"),mgf=require("./mgf"),xor=require("./xor"),bn=require("bn.js"),crt=require("browserify-rsa"),createHash=require("create-hash"),withPublic=require("./withPublic");module.exports=function(private_key,enc,reverse){var padding;padding=private_key.padding?private_key.padding:reverse?1:4;var key=parseKeys(private_key),k=key.modulus.byteLength();if(enc.length>k||new bn(enc).cmp(key.modulus)>=0)throw new Error("decryption error");var msg;msg=reverse?withPublic(new bn(enc),key):crt(enc,key);var zBuffer=new Buffer(k-msg.length);if(zBuffer.fill(0),msg=Buffer.concat([zBuffer,msg],k),4===padding)return function(key,msg){key.modulus;var k=key.modulus.byteLength(),iHash=(msg.length,createHash("sha1").update(new Buffer("")).digest()),hLen=iHash.length;if(0!==msg[0])throw new Error("decryption error");var maskedSeed=msg.slice(1,hLen+1),maskedDb=msg.slice(hLen+1),seed=xor(maskedSeed,mgf(maskedDb,hLen)),db=xor(maskedDb,mgf(seed,k-hLen-1));if(function(a,b){a=new Buffer(a),b=new Buffer(b);var dif=0,len=a.length;a.length!==b.length&&(dif++,len=Math.min(a.length,b.length));var i=-1;for(;++i<len;)dif+=a[i]^b[i];return dif}(iHash,db.slice(0,hLen)))throw new Error("decryption error");var i=hLen;for(;0===db[i];)i++;if(1!==db[i++])throw new Error("decryption error");return db.slice(i)}(key,msg);if(1===padding)return function(key,msg,reverse){var p1=msg.slice(0,2),i=2,status=0;for(;0!==msg[i++];)if(i>=msg.length){status++;break}var ps=msg.slice(2,i-1);msg.slice(i-1,i);("0002"!==p1.toString("hex")&&!reverse||"0001"!==p1.toString("hex")&&reverse)&&status++;ps.length<8&&status++;if(status)throw new Error("decryption error");return msg.slice(i)}(0,msg,reverse);if(3===padding)return msg;throw new Error("unknown padding")}}).call(this,require("buffer").Buffer)},{"./mgf":376,"./withPublic":379,"./xor":380,"bn.js":217,"browserify-rsa":240,buffer:269,"create-hash":300,"parse-asn1":366}],378:[function(require,module,exports){(function(Buffer){var parseKeys=require("parse-asn1"),randomBytes=require("randombytes"),createHash=require("create-hash"),mgf=require("./mgf"),xor=require("./xor"),bn=require("bn.js"),withPublic=require("./withPublic"),crt=require("browserify-rsa");module.exports=function(public_key,msg,reverse){var padding;padding=public_key.padding?public_key.padding:reverse?1:4;var paddedMsg,key=parseKeys(public_key);if(4===padding)paddedMsg=function(key,msg){var k=key.modulus.byteLength(),mLen=msg.length,iHash=createHash("sha1").update(new Buffer("")).digest(),hLen=iHash.length,hLen2=2*hLen;if(mLen>k-hLen2-2)throw new Error("message too long");var ps=new Buffer(k-mLen-hLen2-2);ps.fill(0);var dblen=k-hLen-1,seed=randomBytes(hLen),maskedDb=xor(Buffer.concat([iHash,ps,new Buffer([1]),msg],dblen),mgf(seed,dblen)),maskedSeed=xor(seed,mgf(maskedDb,hLen));return new bn(Buffer.concat([new Buffer([0]),maskedSeed,maskedDb],k))}(key,msg);else if(1===padding)paddedMsg=function(key,msg,reverse){var mLen=msg.length,k=key.modulus.byteLength();if(mLen>k-11)throw new Error("message too long");var ps;reverse?(ps=new Buffer(k-mLen-3)).fill(255):ps=function(len,crypto){var num,out=new Buffer(len),i=0,cache=randomBytes(2*len),cur=0;for(;i<len;)cur===cache.length&&(cache=randomBytes(2*len),cur=0),(num=cache[cur++])&&(out[i++]=num);return out}(k-mLen-3);return new bn(Buffer.concat([new Buffer([0,reverse?1:2]),ps,new Buffer([0]),msg],k))}(key,msg,reverse);else{if(3!==padding)throw new Error("unknown padding");if((paddedMsg=new bn(msg)).cmp(key.modulus)>=0)throw new Error("data too long for modulus")}return reverse?crt(paddedMsg,key):withPublic(paddedMsg,key)}}).call(this,require("buffer").Buffer)},{"./mgf":376,"./withPublic":379,"./xor":380,"bn.js":217,"browserify-rsa":240,buffer:269,"create-hash":300,"parse-asn1":366,randombytes:385}],379:[function(require,module,exports){(function(Buffer){var bn=require("bn.js");module.exports=function(paddedMsg,key){return new Buffer(paddedMsg.toRed(bn.mont(key.modulus)).redPow(new bn(key.publicExponent)).fromRed().toArray())}}).call(this,require("buffer").Buffer)},{"bn.js":217,buffer:269}],380:[function(require,module,exports){module.exports=function(a,b){for(var len=a.length,i=-1;++i<len;)a[i]^=b[i];return a}},{}],381:[function(require,module,exports){(function(global){!function(root){var freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule="object"==typeof module&&module&&!module.nodeType&&module,freeGlobal="object"==typeof global&&global;freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self!==freeGlobal||(root=freeGlobal);var punycode,key,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode;function error(type){throw new RangeError(errors[type])}function map(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}function mapDomain(string,fn){var parts=string.split("@"),result="";parts.length>1&&(result=parts[0]+"@",string=parts[1]);return result+map((string=string.replace(regexSeparators,".")).split("."),fn).join(".")}function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;counter<length;)(value=string.charCodeAt(counter++))>=55296&&value<=56319&&counter<length?56320==(64512&(extra=string.charCodeAt(counter++)))?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--):output.push(value);return output}function ucs2encode(array){return map(array,function(value){var output="";return value>65535&&(output+=stringFromCharCode((value-=65536)>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value)}).join("")}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((0!=flag)<<5)}function adapt(delta,numPoints,firstTime){var k=0;for(delta=firstTime?floor(delta/damp):delta>>1,delta+=floor(delta/numPoints);delta>baseMinusTMin*tMax>>1;k+=base)delta=floor(delta/baseMinusTMin);return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var out,basic,j,index,oldi,w,k,digit,t,baseMinusT,output=[],inputLength=input.length,i=0,n=initialN,bias=initialBias;for((basic=input.lastIndexOf(delimiter))<0&&(basic=0),j=0;j<basic;++j)input.charCodeAt(j)>=128&&error("not-basic"),output.push(input.charCodeAt(j));for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;index>=inputLength&&error("invalid-input"),((digit=(codePoint=input.charCodeAt(index++))-48<10?codePoint-22:codePoint-65<26?codePoint-65:codePoint-97<26?codePoint-97:base)>=base||digit>floor((maxInt-i)/w))&&error("overflow"),i+=digit*w,!(digit<(t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias));k+=base)w>floor(maxInt/(baseMinusT=base-t))&&error("overflow"),w*=baseMinusT;bias=adapt(i-oldi,out=output.length+1,0==oldi),floor(i/out)>maxInt-n&&error("overflow"),n+=floor(i/out),i%=out,output.splice(i++,0,n)}var codePoint;return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,inputLength,handledCPCountPlusOne,baseMinusT,qMinusT,output=[];for(inputLength=(input=ucs2decode(input)).length,n=initialN,delta=0,bias=initialBias,j=0;j<inputLength;++j)(currentValue=input[j])<128&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push(delimiter);handledCPCount<inputLength;){for(m=maxInt,j=0;j<inputLength;++j)(currentValue=input[j])>=n&&currentValue<m&&(m=currentValue);for(m-n>floor((maxInt-delta)/(handledCPCountPlusOne=handledCPCount+1))&&error("overflow"),delta+=(m-n)*handledCPCountPlusOne,n=m,j=0;j<inputLength;++j)if((currentValue=input[j])<n&&++delta>maxInt&&error("overflow"),currentValue==n){for(q=delta,k=base;!(q<(t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias));k+=base)qMinusT=q-t,baseMinusT=base-t,output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n}return output.join("")}if(punycode={version:"1.4.1",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:function(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})},toUnicode:function(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return punycode});else if(freeExports&&freeModule)if(module.exports==freeExports)freeModule.exports=punycode;else for(key in punycode)punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key]);else root.punycode=punycode}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],382:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"!=typeof qs||0===qs.length)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&"number"==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;maxKeys>0&&len>maxKeys&&(len=maxKeys);for(var i=0;i<len;++i){var kstr,vstr,k,v,x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq);idx>=0?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty(obj,k)?isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)}},{}],383:[function(require,module,exports){"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",null===obj&&(obj=void 0),"object"==typeof obj?map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return isArray(obj[k])?map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)};function map(xs,f){if(xs.map)return xs.map(f);for(var res=[],i=0;i<xs.length;i++)res.push(f(xs[i],i));return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&res.push(key);return res}},{}],384:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode"),exports.encode=exports.stringify=require("./encode")},{"./decode":382,"./encode":383}],385:[function(require,module,exports){(function(process,global){"use strict";function oldBrowser(){throw new Error("secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11")}var Buffer=require("safe-buffer").Buffer,crypto=global.crypto||global.msCrypto;crypto&&crypto.getRandomValues?module.exports=randomBytes:module.exports=oldBrowser;function randomBytes(size,cb){if(size>65536)throw new Error("requested too many random bytes");var rawBytes=new global.Uint8Array(size);size>0&&crypto.getRandomValues(rawBytes);var bytes=Buffer.from(rawBytes.buffer);return"function"==typeof cb?process.nextTick(function(){cb(null,bytes)}):bytes}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:374,"safe-buffer":401}],386:[function(require,module,exports){(function(process,global){"use strict";function oldBrowser(){throw new Error("secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11")}var safeBuffer=require("safe-buffer"),randombytes=require("randombytes"),Buffer=safeBuffer.Buffer,kBufferMaxLength=safeBuffer.kMaxLength,crypto=global.crypto||global.msCrypto,kMaxUint32=Math.pow(2,32)-1;function assertOffset(offset,length){if("number"!=typeof offset||offset!=offset)throw new TypeError("offset must be a number");if(offset>kMaxUint32||offset<0)throw new TypeError("offset must be a uint32");if(offset>kBufferMaxLength||offset>length)throw new RangeError("offset out of range")}function assertSize(size,offset,length){if("number"!=typeof size||size!=size)throw new TypeError("size must be a number");if(size>kMaxUint32||size<0)throw new TypeError("size must be a uint32");if(size+offset>length||size>kBufferMaxLength)throw new RangeError("buffer too small")}crypto&&crypto.getRandomValues||!process.browser?(exports.randomFill=randomFill,exports.randomFillSync=randomFillSync):(exports.randomFill=oldBrowser,exports.randomFillSync=oldBrowser);function randomFill(buf,offset,size,cb){if(!(Buffer.isBuffer(buf)||buf instanceof global.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');if("function"==typeof offset)cb=offset,offset=0,size=buf.length;else if("function"==typeof size)cb=size,size=buf.length-offset;else if("function"!=typeof cb)throw new TypeError('"cb" argument must be a function');return assertOffset(offset,buf.length),assertSize(size,offset,buf.length),actualFill(buf,offset,size,cb)}function actualFill(buf,offset,size,cb){if(process.browser){var ourBuf=buf.buffer,uint=new Uint8Array(ourBuf,offset,size);return crypto.getRandomValues(uint),cb?void process.nextTick(function(){cb(null,buf)}):buf}if(!cb){return randombytes(size).copy(buf,offset),buf}randombytes(size,function(err,bytes){if(err)return cb(err);bytes.copy(buf,offset),cb(null,buf)})}function randomFillSync(buf,offset,size){if(void 0===offset&&(offset=0),!(Buffer.isBuffer(buf)||buf instanceof global.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');return assertOffset(offset,buf.length),void 0===size&&(size=buf.length-offset),assertSize(size,offset,buf.length),actualFill(buf,offset,size)}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:374,randombytes:385,"safe-buffer":401}],387:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":388}],388:[function(require,module,exports){"use strict";var processNextTick=require("process-nextick-args"),objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};module.exports=Duplex;var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable"),Writable=require("./_stream_writable");util.inherits(Duplex,Readable);for(var keys=objectKeys(Writable.prototype),v=0;v<keys.length;v++){var method=keys[v];Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options),Writable.call(this,options),options&&!1===options.readable&&(this.readable=!1),options&&!1===options.writable&&(this.writable=!1),this.allowHalfOpen=!0,options&&!1===options.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",onend)}function onend(){this.allowHalfOpen||this._writableState.ended||processNextTick(onEndNT,this)}function onEndNT(self){self.end()}Object.defineProperty(Duplex.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(value){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=value,this._writableState.destroyed=value)}}),Duplex.prototype._destroy=function(err,cb){this.push(null),this.end(),processNextTick(cb,err)}},{"./_stream_readable":390,"./_stream_writable":392,"core-util-is":298,inherits:352,"process-nextick-args":373}],389:[function(require,module,exports){"use strict";module.exports=PassThrough;var Transform=require("./_stream_transform"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":391,"core-util-is":298,inherits:352}],390:[function(require,module,exports){(function(process,global){"use strict";var processNextTick=require("process-nextick-args");module.exports=Readable;var Duplex,isArray=require("isarray");Readable.ReadableState=ReadableState;require("events").EventEmitter;var EElistenerCount=function(emitter,type){return emitter.listeners(type).length},Stream=require("./internal/streams/stream"),Buffer=require("safe-buffer").Buffer,OurUint8Array=global.Uint8Array||function(){};var util=require("core-util-is");util.inherits=require("inherits");var debugUtil=require("util"),debug=void 0;debug=debugUtil&&debugUtil.debuglog?debugUtil.debuglog("stream"):function(){};var StringDecoder,BufferList=require("./internal/streams/BufferList"),destroyImpl=require("./internal/streams/destroy");util.inherits(Readable,Stream);var kProxyEvents=["error","close","destroy","pause","resume"];function ReadableState(options,stream){Duplex=Duplex||require("./_stream_duplex"),options=options||{},this.objectMode=!!options.objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.readableObjectMode);var hwm=options.highWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new BufferList,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=options.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,options.encoding&&(StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this.decoder=new StringDecoder(options.encoding),this.encoding=options.encoding)}function Readable(options){if(Duplex=Duplex||require("./_stream_duplex"),!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this),this.readable=!0,options&&("function"==typeof options.read&&(this._read=options.read),"function"==typeof options.destroy&&(this._destroy=options.destroy)),Stream.call(this)}Object.defineProperty(Readable.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(value){this._readableState&&(this._readableState.destroyed=value)}}),Readable.prototype.destroy=destroyImpl.destroy,Readable.prototype._undestroy=destroyImpl.undestroy,Readable.prototype._destroy=function(err,cb){this.push(null),cb(err)},Readable.prototype.push=function(chunk,encoding){var skipChunkCheck,state=this._readableState;return state.objectMode?skipChunkCheck=!0:"string"==typeof chunk&&((encoding=encoding||state.defaultEncoding)!==state.encoding&&(chunk=Buffer.from(chunk,encoding),encoding=""),skipChunkCheck=!0),readableAddChunk(this,chunk,encoding,!1,skipChunkCheck)},Readable.prototype.unshift=function(chunk){return readableAddChunk(this,chunk,null,!0,!1)};function readableAddChunk(stream,chunk,encoding,addToFront,skipChunkCheck){var state=stream._readableState;if(null===chunk)state.reading=!1,function(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();chunk&&chunk.length&&(state.buffer.push(chunk),state.length+=state.objectMode?1:chunk.length)}state.ended=!0,emitReadable(stream)}(stream,state);else{var er;skipChunkCheck||(er=function(state,chunk){var er;obj=chunk,Buffer.isBuffer(obj)||obj instanceof OurUint8Array||"string"==typeof chunk||void 0===chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk"));var obj;return er}(state,chunk)),er?stream.emit("error",er):state.objectMode||chunk&&chunk.length>0?("string"==typeof chunk||state.objectMode||Object.getPrototypeOf(chunk)===Buffer.prototype||(chunk=function(chunk){return Buffer.from(chunk)}(chunk)),addToFront?state.endEmitted?stream.emit("error",new Error("stream.unshift() after end event")):addChunk(stream,state,chunk,!0):state.ended?stream.emit("error",new Error("stream.push() after EOF")):(state.reading=!1,state.decoder&&!encoding?(chunk=state.decoder.write(chunk),state.objectMode||0!==chunk.length?addChunk(stream,state,chunk,!1):maybeReadMore(stream,state)):addChunk(stream,state,chunk,!1))):addToFront||(state.reading=!1)}return function(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||0===state.length)}(state)}function addChunk(stream,state,chunk,addToFront){state.flowing&&0===state.length&&!state.sync?(stream.emit("data",chunk),stream.read(0)):(state.length+=state.objectMode?1:chunk.length,addToFront?state.buffer.unshift(chunk):state.buffer.push(chunk),state.needReadable&&emitReadable(stream)),maybeReadMore(stream,state)}Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(enc){return StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this._readableState.decoder=new StringDecoder(enc),this._readableState.encoding=enc,this};var MAX_HWM=8388608;function howMuchToRead(n,state){return n<=0||0===state.length&&state.ended?0:state.objectMode?1:n!=n?state.flowing&&state.length?state.buffer.head.data.length:state.length:(n>state.highWaterMark&&(state.highWaterMark=function(n){return n>=MAX_HWM?n=MAX_HWM:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n}(n)),n<=state.length?n:state.ended?state.length:(state.needReadable=!0,0))}Readable.prototype.read=function(n){debug("read",n),n=parseInt(n,10);var state=this._readableState,nOrig=n;if(0!==n&&(state.emittedReadable=!1),0===n&&state.needReadable&&(state.length>=state.highWaterMark||state.ended))return debug("read: emitReadable",state.length,state.ended),0===state.length&&state.ended?endReadable(this):emitReadable(this),null;if(0===(n=howMuchToRead(n,state))&&state.ended)return 0===state.length&&endReadable(this),null;var doRead=state.needReadable;debug("need readable",doRead),(0===state.length||state.length-n<state.highWaterMark)&&debug("length less than watermark",doRead=!0),state.ended||state.reading?debug("reading or ended",doRead=!1):doRead&&(debug("do read"),state.reading=!0,state.sync=!0,0===state.length&&(state.needReadable=!0),this._read(state.highWaterMark),state.sync=!1,state.reading||(n=howMuchToRead(nOrig,state)));var ret;return null===(ret=n>0?fromList(n,state):null)?(state.needReadable=!0,n=0):state.length-=n,0===state.length&&(state.ended||(state.needReadable=!0),nOrig!==n&&state.ended&&endReadable(this)),null!==ret&&this.emit("data",ret),ret};function emitReadable(stream){var state=stream._readableState;state.needReadable=!1,state.emittedReadable||(debug("emitReadable",state.flowing),state.emittedReadable=!0,state.sync?processNextTick(emitReadable_,stream):emitReadable_(stream))}function emitReadable_(stream){debug("emit readable"),stream.emit("readable"),flow(stream)}function maybeReadMore(stream,state){state.readingMore||(state.readingMore=!0,processNextTick(maybeReadMore_,stream,state))}function maybeReadMore_(stream,state){for(var len=state.length;!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark&&(debug("maybeReadMore read 0"),stream.read(0),len!==state.length);)len=state.length;state.readingMore=!1}Readable.prototype._read=function(n){this.emit("error",new Error("_read() is not implemented"))},Readable.prototype.pipe=function(dest,pipeOpts){var src=this,state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest)}state.pipesCount+=1,debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var endFn=(!pipeOpts||!1!==pipeOpts.end)&&dest!==process.stdout&&dest!==process.stderr?onend:unpipe;state.endEmitted?processNextTick(endFn):src.once("end",endFn),dest.on("unpipe",onunpipe);function onunpipe(readable,unpipeInfo){debug("onunpipe"),readable===src&&unpipeInfo&&!1===unpipeInfo.hasUnpiped&&(unpipeInfo.hasUnpiped=!0,debug("cleanup"),dest.removeListener("close",onclose),dest.removeListener("finish",onfinish),dest.removeListener("drain",ondrain),dest.removeListener("error",onerror),dest.removeListener("unpipe",onunpipe),src.removeListener("end",onend),src.removeListener("end",unpipe),src.removeListener("data",ondata),cleanedUp=!0,!state.awaitDrain||dest._writableState&&!dest._writableState.needDrain||ondrain())}function onend(){debug("onend"),dest.end()}var ondrain=function(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain),state.awaitDrain&&state.awaitDrain--,0===state.awaitDrain&&EElistenerCount(src,"data")&&(state.flowing=!0,flow(src))}}(src);dest.on("drain",ondrain);var cleanedUp=!1;var increasedAwaitDrain=!1;src.on("data",ondata);function ondata(chunk){debug("ondata"),increasedAwaitDrain=!1;!1!==dest.write(chunk)||increasedAwaitDrain||((1===state.pipesCount&&state.pipes===dest||state.pipesCount>1&&-1!==indexOf(state.pipes,dest))&&!cleanedUp&&(debug("false write response, pause",src._readableState.awaitDrain),src._readableState.awaitDrain++,increasedAwaitDrain=!0),src.pause())}function onerror(er){debug("onerror",er),unpipe(),dest.removeListener("error",onerror),0===EElistenerCount(dest,"error")&&dest.emit("error",er)}!function(emitter,event,fn){if("function"==typeof emitter.prependListener)return emitter.prependListener(event,fn);emitter._events&&emitter._events[event]?isArray(emitter._events[event])?emitter._events[event].unshift(fn):emitter._events[event]=[fn,emitter._events[event]]:emitter.on(event,fn)}(dest,"error",onerror);function onclose(){dest.removeListener("finish",onfinish),unpipe()}dest.once("close",onclose);function onfinish(){debug("onfinish"),dest.removeListener("close",onclose),unpipe()}dest.once("finish",onfinish);function unpipe(){debug("unpipe"),src.unpipe(dest)}return dest.emit("pipe",src),state.flowing||(debug("pipe resume"),src.resume()),dest};Readable.prototype.unpipe=function(dest){var state=this._readableState,unpipeInfo={hasUnpiped:!1};if(0===state.pipesCount)return this;if(1===state.pipesCount)return dest&&dest!==state.pipes?this:(dest||(dest=state.pipes),state.pipes=null,state.pipesCount=0,state.flowing=!1,dest&&dest.emit("unpipe",this,unpipeInfo),this);if(!dest){var dests=state.pipes,len=state.pipesCount;state.pipes=null,state.pipesCount=0,state.flowing=!1;for(var i=0;i<len;i++)dests[i].emit("unpipe",this,unpipeInfo);return this}var index=indexOf(state.pipes,dest);return-1===index?this:(state.pipes.splice(index,1),state.pipesCount-=1,1===state.pipesCount&&(state.pipes=state.pipes[0]),dest.emit("unpipe",this,unpipeInfo),this)},Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if("data"===ev)!1!==this._readableState.flowing&&this.resume();else if("readable"===ev){var state=this._readableState;state.endEmitted||state.readableListening||(state.readableListening=state.needReadable=!0,state.emittedReadable=!1,state.reading?state.length&&emitReadable(this):processNextTick(nReadingNextTick,this))}return res},Readable.prototype.addListener=Readable.prototype.on;function nReadingNextTick(self){debug("readable nexttick read 0"),self.read(0)}Readable.prototype.resume=function(){var state=this._readableState;return state.flowing||(debug("resume"),state.flowing=!0,function(stream,state){state.resumeScheduled||(state.resumeScheduled=!0,processNextTick(resume_,stream,state))}(this,state)),this};function resume_(stream,state){state.reading||(debug("resume read 0"),stream.read(0)),state.resumeScheduled=!1,state.awaitDrain=0,stream.emit("resume"),flow(stream),state.flowing&&!state.reading&&stream.read(0)}Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this};function flow(stream){var state=stream._readableState;for(debug("flow",state.flowing);state.flowing&&null!==stream.read(););}Readable.prototype.wrap=function(stream){var state=this._readableState,paused=!1,self=this;stream.on("end",function(){if(debug("wrapped end"),state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&self.push(chunk)}self.push(null)}),stream.on("data",function(chunk){if(debug("wrapped data"),state.decoder&&(chunk=state.decoder.write(chunk)),(!state.objectMode||null!==chunk&&void 0!==chunk)&&(state.objectMode||chunk&&chunk.length)){self.push(chunk)||(paused=!0,stream.pause())}});for(var i in stream)void 0===this[i]&&"function"==typeof stream[i]&&(this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i));for(var n=0;n<kProxyEvents.length;n++)stream.on(kProxyEvents[n],self.emit.bind(self,kProxyEvents[n]));return self._read=function(n){debug("wrapped _read",n),paused&&(paused=!1,stream.resume())},self},Readable._fromList=fromList;function fromList(n,state){if(0===state.length)return null;var ret;return state.objectMode?ret=state.buffer.shift():!n||n>=state.length?(ret=state.decoder?state.buffer.join(""):1===state.buffer.length?state.buffer.head.data:state.buffer.concat(state.length),state.buffer.clear()):ret=function(n,list,hasStrings){var ret;n<list.head.data.length?(ret=list.head.data.slice(0,n),list.head.data=list.head.data.slice(n)):ret=n===list.head.data.length?list.shift():hasStrings?function(n,list){var p=list.head,c=1,ret=p.data;n-=ret.length;for(;p=p.next;){var str=p.data,nb=n>str.length?str.length:n;if(nb===str.length?ret+=str:ret+=str.slice(0,n),0===(n-=nb)){nb===str.length?(++c,p.next?list.head=p.next:list.head=list.tail=null):(list.head=p,p.data=str.slice(nb));break}++c}return list.length-=c,ret}(n,list):function(n,list){var ret=Buffer.allocUnsafe(n),p=list.head,c=1;p.data.copy(ret),n-=p.data.length;for(;p=p.next;){var buf=p.data,nb=n>buf.length?buf.length:n;if(buf.copy(ret,ret.length-n,0,nb),0===(n-=nb)){nb===buf.length?(++c,p.next?list.head=p.next:list.head=list.tail=null):(list.head=p,p.data=buf.slice(nb));break}++c}return list.length-=c,ret}(n,list);return ret}(n,state.buffer,state.decoder),ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error('"endReadable()" called on non-empty stream');state.endEmitted||(state.ended=!0,processNextTick(endReadableNT,state,stream))}function endReadableNT(state,stream){state.endEmitted||0!==state.length||(state.endEmitted=!0,stream.readable=!1,stream.emit("end"))}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++)if(xs[i]===x)return i;return-1}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":388,"./internal/streams/BufferList":393,"./internal/streams/destroy":394,"./internal/streams/stream":395,_process:374,"core-util-is":298,events:334,inherits:352,isarray:354,"process-nextick-args":373,"safe-buffer":401,"string_decoder/":422,util:219}],391:[function(require,module,exports){"use strict";module.exports=Transform;var Duplex=require("./_stream_duplex"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(Transform,Duplex);function TransformState(stream){this.afterTransform=function(er,data){return function(stream,er,data){var ts=stream._transformState;ts.transforming=!1;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("write callback called multiple times"));ts.writechunk=null,ts.writecb=null,null!==data&&void 0!==data&&stream.push(data);cb(er);var rs=stream._readableState;rs.reading=!1,(rs.needReadable||rs.length<rs.highWaterMark)&&stream._read(rs.highWaterMark)}(stream,er,data)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options),this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=!0,this._readableState.sync=!1,options&&("function"==typeof options.transform&&(this._transform=options.transform),"function"==typeof options.flush&&(this._flush=options.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(er,data){done(stream,er,data)}):done(stream)})}Transform.prototype.push=function(chunk,encoding){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,chunk,encoding)},Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("_transform() is not implemented")},Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;if(ts.writecb=cb,ts.writechunk=chunk,ts.writeencoding=encoding,!ts.transforming){var rs=this._readableState;(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)&&this._read(rs.highWaterMark)}},Transform.prototype._read=function(n){var ts=this._transformState;null!==ts.writechunk&&ts.writecb&&!ts.transforming?(ts.transforming=!0,this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)):ts.needTransform=!0},Transform.prototype._destroy=function(err,cb){var _this=this;Duplex.prototype._destroy.call(this,err,function(err2){cb(err2),_this.emit("close")})};function done(stream,er,data){if(er)return stream.emit("error",er);null!==data&&void 0!==data&&stream.push(data);var ws=stream._writableState,ts=stream._transformState;if(ws.length)throw new Error("Calling transform done when ws.length != 0");if(ts.transforming)throw new Error("Calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":388,"core-util-is":298,inherits:352}],392:[function(require,module,exports){(function(process,global){"use strict";var processNextTick=require("process-nextick-args");module.exports=Writable;function CorkedRequest(state){var _this=this;this.next=null,this.entry=null,this.finish=function(){!function(corkReq,state,err){var entry=corkReq.entry;corkReq.entry=null;for(;entry;){var cb=entry.callback;state.pendingcb--,cb(err),entry=entry.next}state.corkedRequestsFree?state.corkedRequestsFree.next=corkReq:state.corkedRequestsFree=corkReq}(_this,state)}}var Duplex,asyncWrite=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:processNextTick;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var internalUtil={deprecate:require("util-deprecate")},Stream=require("./internal/streams/stream"),Buffer=require("safe-buffer").Buffer,OurUint8Array=global.Uint8Array||function(){};var destroyImpl=require("./internal/streams/destroy");util.inherits(Writable,Stream);function nop(){}function WritableState(options,stream){Duplex=Duplex||require("./_stream_duplex"),options=options||{},this.objectMode=!!options.objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.writableObjectMode);var hwm=options.highWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var noDecode=!1===options.decodeStrings;this.decodeStrings=!noDecode,this.defaultEncoding=options.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(er){!function(stream,er){var state=stream._writableState,sync=state.sync,cb=state.writecb;if(function(state){state.writing=!1,state.writecb=null,state.length-=state.writelen,state.writelen=0}(state),er)!function(stream,state,sync,er,cb){--state.pendingcb,sync?(processNextTick(cb,er),processNextTick(finishMaybe,stream,state),stream._writableState.errorEmitted=!0,stream.emit("error",er)):(cb(er),stream._writableState.errorEmitted=!0,stream.emit("error",er),finishMaybe(stream,state))}(stream,state,sync,er,cb);else{var finished=needFinish(state);finished||state.corked||state.bufferProcessing||!state.bufferedRequest||clearBuffer(stream,state),sync?asyncWrite(afterWrite,stream,state,finished,cb):afterWrite(stream,state,finished,cb)}}(stream,er)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}WritableState.prototype.getBuffer=function(){for(var current=this.bufferedRequest,out=[];current;)out.push(current),current=current.next;return out},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(_){}}();var realHasInstance;"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(realHasInstance=Function.prototype[Symbol.hasInstance],Object.defineProperty(Writable,Symbol.hasInstance,{value:function(object){return!!realHasInstance.call(this,object)||object&&object._writableState instanceof WritableState}})):realHasInstance=function(object){return object instanceof this};function Writable(options){if(Duplex=Duplex||require("./_stream_duplex"),!(realHasInstance.call(Writable,this)||this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this),this.writable=!0,options&&("function"==typeof options.write&&(this._write=options.write),"function"==typeof options.writev&&(this._writev=options.writev),"function"==typeof options.destroy&&(this._destroy=options.destroy),"function"==typeof options.final&&(this._final=options.final)),Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};Writable.prototype.write=function(chunk,encoding,cb){var obj,state=this._writableState,ret=!1,isBuf=(obj=chunk,(Buffer.isBuffer(obj)||obj instanceof OurUint8Array)&&!state.objectMode);return isBuf&&!Buffer.isBuffer(chunk)&&(chunk=function(chunk){return Buffer.from(chunk)}(chunk)),"function"==typeof encoding&&(cb=encoding,encoding=null),isBuf?encoding="buffer":encoding||(encoding=state.defaultEncoding),"function"!=typeof cb&&(cb=nop),state.ended?function(stream,cb){var er=new Error("write after end");stream.emit("error",er),processNextTick(cb,er)}(this,cb):(isBuf||function(stream,state,chunk,cb){var valid=!0,er=!1;return null===chunk?er=new TypeError("May not write null values to stream"):"string"==typeof chunk||void 0===chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk")),er&&(stream.emit("error",er),processNextTick(cb,er),valid=!1),valid}(this,state,chunk,cb))&&(state.pendingcb++,ret=function(stream,state,isBuf,chunk,encoding,cb){if(!isBuf){var newChunk=function(state,chunk,encoding){state.objectMode||!1===state.decodeStrings||"string"!=typeof chunk||(chunk=Buffer.from(chunk,encoding));return chunk}(state,chunk,encoding);chunk!==newChunk&&(isBuf=!0,encoding="buffer",chunk=newChunk)}var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;ret||(state.needDrain=!0);if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest={chunk:chunk,encoding:encoding,isBuf:isBuf,callback:cb,next:null},last?last.next=state.lastBufferedRequest:state.bufferedRequest=state.lastBufferedRequest,state.bufferedRequestCount+=1}else doWrite(stream,state,!1,len,chunk,encoding,cb);return ret}(this,state,isBuf,chunk,encoding,cb)),ret},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var state=this._writableState;state.corked&&(state.corked--,state.writing||state.corked||state.finished||state.bufferProcessing||!state.bufferedRequest||clearBuffer(this,state))},Writable.prototype.setDefaultEncoding=function(encoding){if("string"==typeof encoding&&(encoding=encoding.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);return this._writableState.defaultEncoding=encoding,this};function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len,state.writecb=cb,state.writing=!0,state.sync=!0,writev?stream._writev(chunk,state.onwrite):stream._write(chunk,encoding,state.onwrite),state.sync=!1}function afterWrite(stream,state,finished,cb){finished||function(stream,state){0===state.length&&state.needDrain&&(state.needDrain=!1,stream.emit("drain"))}(stream,state),state.pendingcb--,cb(),finishMaybe(stream,state)}function clearBuffer(stream,state){state.bufferProcessing=!0;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount,buffer=new Array(l),holder=state.corkedRequestsFree;holder.entry=entry;for(var count=0,allBuffers=!0;entry;)buffer[count]=entry,entry.isBuf||(allBuffers=!1),entry=entry.next,count+=1;buffer.allBuffers=allBuffers,doWrite(stream,state,!0,state.length,buffer,"",holder.finish),state.pendingcb++,state.lastBufferedRequest=null,holder.next?(state.corkedRequestsFree=holder.next,holder.next=null):state.corkedRequestsFree=new CorkedRequest(state)}else{for(;entry;){var chunk=entry.chunk,encoding=entry.encoding,cb=entry.callback;if(doWrite(stream,state,!1,state.objectMode?1:chunk.length,chunk,encoding,cb),entry=entry.next,state.writing)break}null===entry&&(state.lastBufferedRequest=null)}state.bufferedRequestCount=0,state.bufferedRequest=entry,state.bufferProcessing=!1}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("_write() is not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;"function"==typeof chunk?(cb=chunk,chunk=null,encoding=null):"function"==typeof encoding&&(cb=encoding,encoding=null),null!==chunk&&void 0!==chunk&&this.write(chunk,encoding),state.corked&&(state.corked=1,this.uncork()),state.ending||state.finished||function(stream,state,cb){state.ending=!0,finishMaybe(stream,state),cb&&(state.finished?processNextTick(cb):stream.once("finish",cb));state.ended=!0,stream.writable=!1}(this,state,cb)};function needFinish(state){return state.ending&&0===state.length&&null===state.bufferedRequest&&!state.finished&&!state.writing}function callFinal(stream,state){stream._final(function(err){state.pendingcb--,err&&stream.emit("error",err),state.prefinished=!0,stream.emit("prefinish"),finishMaybe(stream,state)})}function finishMaybe(stream,state){var need=needFinish(state);return need&&(!function(stream,state){state.prefinished||state.finalCalled||("function"==typeof stream._final?(state.pendingcb++,state.finalCalled=!0,processNextTick(callFinal,stream,state)):(state.prefinished=!0,stream.emit("prefinish")))}(stream,state),0===state.pendingcb&&(state.finished=!0,stream.emit("finish"))),need}Object.defineProperty(Writable.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(value){this._writableState&&(this._writableState.destroyed=value)}}),Writable.prototype.destroy=destroyImpl.destroy,Writable.prototype._undestroy=destroyImpl.undestroy,Writable.prototype._destroy=function(err,cb){this.end(),cb(err)}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":388,"./internal/streams/destroy":394,"./internal/streams/stream":395,_process:374,"core-util-is":298,inherits:352,"process-nextick-args":373,"safe-buffer":401,"util-deprecate":425}],393:[function(require,module,exports){"use strict";var Buffer=require("safe-buffer").Buffer;module.exports=function(){function BufferList(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BufferList),this.head=null,this.tail=null,this.length=0}return BufferList.prototype.push=function(v){var entry={data:v,next:null};this.length>0?this.tail.next=entry:this.head=entry,this.tail=entry,++this.length},BufferList.prototype.unshift=function(v){var entry={data:v,next:this.head};0===this.length&&(this.tail=entry),this.head=entry,++this.length},BufferList.prototype.shift=function(){if(0!==this.length){var ret=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,ret}},BufferList.prototype.clear=function(){this.head=this.tail=null,this.length=0},BufferList.prototype.join=function(s){if(0===this.length)return"";for(var p=this.head,ret=""+p.data;p=p.next;)ret+=s+p.data;return ret},BufferList.prototype.concat=function(n){if(0===this.length)return Buffer.alloc(0);if(1===this.length)return this.head.data;for(var ret=Buffer.allocUnsafe(n>>>0),p=this.head,i=0;p;)src=p.data,target=ret,offset=i,src.copy(target,offset),i+=p.data.length,p=p.next;var src,target,offset;return ret},BufferList}()},{"safe-buffer":401}],394:[function(require,module,exports){"use strict";var processNextTick=require("process-nextick-args");function emitErrorNT(self,err){self.emit("error",err)}module.exports={destroy:function(err,cb){var _this=this,readableDestroyed=this._readableState&&this._readableState.destroyed,writableDestroyed=this._writableState&&this._writableState.destroyed;readableDestroyed||writableDestroyed?cb?cb(err):!err||this._writableState&&this._writableState.errorEmitted||processNextTick(emitErrorNT,this,err):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(err||null,function(err){!cb&&err?(processNextTick(emitErrorNT,_this,err),_this._writableState&&(_this._writableState.errorEmitted=!0)):cb&&cb(err)}))},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},{"process-nextick-args":373}],395:[function(require,module,exports){module.exports=require("events").EventEmitter},{events:334}],396:[function(require,module,exports){module.exports=require("./readable").PassThrough},{"./readable":397}],397:[function(require,module,exports){(exports=module.exports=require("./lib/_stream_readable.js")).Stream=exports,exports.Readable=exports,exports.Writable=require("./lib/_stream_writable.js"),exports.Duplex=require("./lib/_stream_duplex.js"),exports.Transform=require("./lib/_stream_transform.js"),exports.PassThrough=require("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":388,"./lib/_stream_passthrough.js":389,"./lib/_stream_readable.js":390,"./lib/_stream_transform.js":391,"./lib/_stream_writable.js":392}],398:[function(require,module,exports){module.exports=require("./readable").Transform},{"./readable":397}],399:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":392}],400:[function(require,module,exports){(function(Buffer){"use strict";var inherits=require("inherits"),HashBase=require("hash-base");function RIPEMD160(){HashBase.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520}inherits(RIPEMD160,HashBase),RIPEMD160.prototype._update=function(){for(var m=new Array(16),i=0;i<16;++i)m[i]=this._block.readInt32LE(4*i);var al=this._a,bl=this._b,cl=this._c,dl=this._d,el=this._e;el=fn1(el,al=fn1(al,bl,cl,dl,el,m[0],0,11),bl,cl=rotl(cl,10),dl,m[1],0,14),bl=fn1(bl=rotl(bl,10),cl=fn1(cl,dl=fn1(dl,el,al,bl,cl,m[2],0,15),el,al=rotl(al,10),bl,m[3],0,12),dl,el=rotl(el,10),al,m[4],0,5),dl=fn1(dl=rotl(dl,10),el=fn1(el,al=fn1(al,bl,cl,dl,el,m[5],0,8),bl,cl=rotl(cl,10),dl,m[6],0,7),al,bl=rotl(bl,10),cl,m[7],0,9),al=fn1(al=rotl(al,10),bl=fn1(bl,cl=fn1(cl,dl,el,al,bl,m[8],0,11),dl,el=rotl(el,10),al,m[9],0,13),cl,dl=rotl(dl,10),el,m[10],0,14),cl=fn1(cl=rotl(cl,10),dl=fn1(dl,el=fn1(el,al,bl,cl,dl,m[11],0,15),al,bl=rotl(bl,10),cl,m[12],0,6),el,al=rotl(al,10),bl,m[13],0,7),el=fn2(el=rotl(el,10),al=fn1(al,bl=fn1(bl,cl,dl,el,al,m[14],0,9),cl,dl=rotl(dl,10),el,m[15],0,8),bl,cl=rotl(cl,10),dl,m[7],1518500249,7),bl=fn2(bl=rotl(bl,10),cl=fn2(cl,dl=fn2(dl,el,al,bl,cl,m[4],1518500249,6),el,al=rotl(al,10),bl,m[13],1518500249,8),dl,el=rotl(el,10),al,m[1],1518500249,13),dl=fn2(dl=rotl(dl,10),el=fn2(el,al=fn2(al,bl,cl,dl,el,m[10],1518500249,11),bl,cl=rotl(cl,10),dl,m[6],1518500249,9),al,bl=rotl(bl,10),cl,m[15],1518500249,7),al=fn2(al=rotl(al,10),bl=fn2(bl,cl=fn2(cl,dl,el,al,bl,m[3],1518500249,15),dl,el=rotl(el,10),al,m[12],1518500249,7),cl,dl=rotl(dl,10),el,m[0],1518500249,12),cl=fn2(cl=rotl(cl,10),dl=fn2(dl,el=fn2(el,al,bl,cl,dl,m[9],1518500249,15),al,bl=rotl(bl,10),cl,m[5],1518500249,9),el,al=rotl(al,10),bl,m[2],1518500249,11),el=fn2(el=rotl(el,10),al=fn2(al,bl=fn2(bl,cl,dl,el,al,m[14],1518500249,7),cl,dl=rotl(dl,10),el,m[11],1518500249,13),bl,cl=rotl(cl,10),dl,m[8],1518500249,12),bl=fn3(bl=rotl(bl,10),cl=fn3(cl,dl=fn3(dl,el,al,bl,cl,m[3],1859775393,11),el,al=rotl(al,10),bl,m[10],1859775393,13),dl,el=rotl(el,10),al,m[14],1859775393,6),dl=fn3(dl=rotl(dl,10),el=fn3(el,al=fn3(al,bl,cl,dl,el,m[4],1859775393,7),bl,cl=rotl(cl,10),dl,m[9],1859775393,14),al,bl=rotl(bl,10),cl,m[15],1859775393,9),al=fn3(al=rotl(al,10),bl=fn3(bl,cl=fn3(cl,dl,el,al,bl,m[8],1859775393,13),dl,el=rotl(el,10),al,m[1],1859775393,15),cl,dl=rotl(dl,10),el,m[2],1859775393,14),cl=fn3(cl=rotl(cl,10),dl=fn3(dl,el=fn3(el,al,bl,cl,dl,m[7],1859775393,8),al,bl=rotl(bl,10),cl,m[0],1859775393,13),el,al=rotl(al,10),bl,m[6],1859775393,6),el=fn3(el=rotl(el,10),al=fn3(al,bl=fn3(bl,cl,dl,el,al,m[13],1859775393,5),cl,dl=rotl(dl,10),el,m[11],1859775393,12),bl,cl=rotl(cl,10),dl,m[5],1859775393,7),bl=fn4(bl=rotl(bl,10),cl=fn4(cl,dl=fn3(dl,el,al,bl,cl,m[12],1859775393,5),el,al=rotl(al,10),bl,m[1],2400959708,11),dl,el=rotl(el,10),al,m[9],2400959708,12),dl=fn4(dl=rotl(dl,10),el=fn4(el,al=fn4(al,bl,cl,dl,el,m[11],2400959708,14),bl,cl=rotl(cl,10),dl,m[10],2400959708,15),al,bl=rotl(bl,10),cl,m[0],2400959708,14),al=fn4(al=rotl(al,10),bl=fn4(bl,cl=fn4(cl,dl,el,al,bl,m[8],2400959708,15),dl,el=rotl(el,10),al,m[12],2400959708,9),cl,dl=rotl(dl,10),el,m[4],2400959708,8),cl=fn4(cl=rotl(cl,10),dl=fn4(dl,el=fn4(el,al,bl,cl,dl,m[13],2400959708,9),al,bl=rotl(bl,10),cl,m[3],2400959708,14),el,al=rotl(al,10),bl,m[7],2400959708,5),el=fn4(el=rotl(el,10),al=fn4(al,bl=fn4(bl,cl,dl,el,al,m[15],2400959708,6),cl,dl=rotl(dl,10),el,m[14],2400959708,8),bl,cl=rotl(cl,10),dl,m[5],2400959708,6),bl=fn5(bl=rotl(bl,10),cl=fn4(cl,dl=fn4(dl,el,al,bl,cl,m[6],2400959708,5),el,al=rotl(al,10),bl,m[2],2400959708,12),dl,el=rotl(el,10),al,m[4],2840853838,9),dl=fn5(dl=rotl(dl,10),el=fn5(el,al=fn5(al,bl,cl,dl,el,m[0],2840853838,15),bl,cl=rotl(cl,10),dl,m[5],2840853838,5),al,bl=rotl(bl,10),cl,m[9],2840853838,11),al=fn5(al=rotl(al,10),bl=fn5(bl,cl=fn5(cl,dl,el,al,bl,m[7],2840853838,6),dl,el=rotl(el,10),al,m[12],2840853838,8),cl,dl=rotl(dl,10),el,m[2],2840853838,13),cl=fn5(cl=rotl(cl,10),dl=fn5(dl,el=fn5(el,al,bl,cl,dl,m[10],2840853838,12),al,bl=rotl(bl,10),cl,m[14],2840853838,5),el,al=rotl(al,10),bl,m[1],2840853838,12),el=fn5(el=rotl(el,10),al=fn5(al,bl=fn5(bl,cl,dl,el,al,m[3],2840853838,13),cl,dl=rotl(dl,10),el,m[8],2840853838,14),bl,cl=rotl(cl,10),dl,m[11],2840853838,11),bl=fn5(bl=rotl(bl,10),cl=fn5(cl,dl=fn5(dl,el,al,bl,cl,m[6],2840853838,8),el,al=rotl(al,10),bl,m[15],2840853838,5),dl,el=rotl(el,10),al,m[13],2840853838,6),dl=rotl(dl,10);var ar=this._a,br=this._b,cr=this._c,dr=this._d,er=this._e;er=fn5(er,ar=fn5(ar,br,cr,dr,er,m[5],1352829926,8),br,cr=rotl(cr,10),dr,m[14],1352829926,9),br=fn5(br=rotl(br,10),cr=fn5(cr,dr=fn5(dr,er,ar,br,cr,m[7],1352829926,9),er,ar=rotl(ar,10),br,m[0],1352829926,11),dr,er=rotl(er,10),ar,m[9],1352829926,13),dr=fn5(dr=rotl(dr,10),er=fn5(er,ar=fn5(ar,br,cr,dr,er,m[2],1352829926,15),br,cr=rotl(cr,10),dr,m[11],1352829926,15),ar,br=rotl(br,10),cr,m[4],1352829926,5),ar=fn5(ar=rotl(ar,10),br=fn5(br,cr=fn5(cr,dr,er,ar,br,m[13],1352829926,7),dr,er=rotl(er,10),ar,m[6],1352829926,7),cr,dr=rotl(dr,10),er,m[15],1352829926,8),cr=fn5(cr=rotl(cr,10),dr=fn5(dr,er=fn5(er,ar,br,cr,dr,m[8],1352829926,11),ar,br=rotl(br,10),cr,m[1],1352829926,14),er,ar=rotl(ar,10),br,m[10],1352829926,14),er=fn4(er=rotl(er,10),ar=fn5(ar,br=fn5(br,cr,dr,er,ar,m[3],1352829926,12),cr,dr=rotl(dr,10),er,m[12],1352829926,6),br,cr=rotl(cr,10),dr,m[6],1548603684,9),br=fn4(br=rotl(br,10),cr=fn4(cr,dr=fn4(dr,er,ar,br,cr,m[11],1548603684,13),er,ar=rotl(ar,10),br,m[3],1548603684,15),dr,er=rotl(er,10),ar,m[7],1548603684,7),dr=fn4(dr=rotl(dr,10),er=fn4(er,ar=fn4(ar,br,cr,dr,er,m[0],1548603684,12),br,cr=rotl(cr,10),dr,m[13],1548603684,8),ar,br=rotl(br,10),cr,m[5],1548603684,9),ar=fn4(ar=rotl(ar,10),br=fn4(br,cr=fn4(cr,dr,er,ar,br,m[10],1548603684,11),dr,er=rotl(er,10),ar,m[14],1548603684,7),cr,dr=rotl(dr,10),er,m[15],1548603684,7),cr=fn4(cr=rotl(cr,10),dr=fn4(dr,er=fn4(er,ar,br,cr,dr,m[8],1548603684,12),ar,br=rotl(br,10),cr,m[12],1548603684,7),er,ar=rotl(ar,10),br,m[4],1548603684,6),er=fn4(er=rotl(er,10),ar=fn4(ar,br=fn4(br,cr,dr,er,ar,m[9],1548603684,15),cr,dr=rotl(dr,10),er,m[1],1548603684,13),br,cr=rotl(cr,10),dr,m[2],1548603684,11),br=fn3(br=rotl(br,10),cr=fn3(cr,dr=fn3(dr,er,ar,br,cr,m[15],1836072691,9),er,ar=rotl(ar,10),br,m[5],1836072691,7),dr,er=rotl(er,10),ar,m[1],1836072691,15),dr=fn3(dr=rotl(dr,10),er=fn3(er,ar=fn3(ar,br,cr,dr,er,m[3],1836072691,11),br,cr=rotl(cr,10),dr,m[7],1836072691,8),ar,br=rotl(br,10),cr,m[14],1836072691,6),ar=fn3(ar=rotl(ar,10),br=fn3(br,cr=fn3(cr,dr,er,ar,br,m[6],1836072691,6),dr,er=rotl(er,10),ar,m[9],1836072691,14),cr,dr=rotl(dr,10),er,m[11],1836072691,12),cr=fn3(cr=rotl(cr,10),dr=fn3(dr,er=fn3(er,ar,br,cr,dr,m[8],1836072691,13),ar,br=rotl(br,10),cr,m[12],1836072691,5),er,ar=rotl(ar,10),br,m[2],1836072691,14),er=fn3(er=rotl(er,10),ar=fn3(ar,br=fn3(br,cr,dr,er,ar,m[10],1836072691,13),cr,dr=rotl(dr,10),er,m[0],1836072691,13),br,cr=rotl(cr,10),dr,m[4],1836072691,7),br=fn2(br=rotl(br,10),cr=fn2(cr,dr=fn3(dr,er,ar,br,cr,m[13],1836072691,5),er,ar=rotl(ar,10),br,m[8],2053994217,15),dr,er=rotl(er,10),ar,m[6],2053994217,5),dr=fn2(dr=rotl(dr,10),er=fn2(er,ar=fn2(ar,br,cr,dr,er,m[4],2053994217,8),br,cr=rotl(cr,10),dr,m[1],2053994217,11),ar,br=rotl(br,10),cr,m[3],2053994217,14),ar=fn2(ar=rotl(ar,10),br=fn2(br,cr=fn2(cr,dr,er,ar,br,m[11],2053994217,14),dr,er=rotl(er,10),ar,m[15],2053994217,6),cr,dr=rotl(dr,10),er,m[0],2053994217,14),cr=fn2(cr=rotl(cr,10),dr=fn2(dr,er=fn2(er,ar,br,cr,dr,m[5],2053994217,6),ar,br=rotl(br,10),cr,m[12],2053994217,9),er,ar=rotl(ar,10),br,m[2],2053994217,12),er=fn2(er=rotl(er,10),ar=fn2(ar,br=fn2(br,cr,dr,er,ar,m[13],2053994217,9),cr,dr=rotl(dr,10),er,m[9],2053994217,12),br,cr=rotl(cr,10),dr,m[7],2053994217,5),br=fn1(br=rotl(br,10),cr=fn2(cr,dr=fn2(dr,er,ar,br,cr,m[10],2053994217,15),er,ar=rotl(ar,10),br,m[14],2053994217,8),dr,er=rotl(er,10),ar,m[12],0,8),dr=fn1(dr=rotl(dr,10),er=fn1(er,ar=fn1(ar,br,cr,dr,er,m[15],0,5),br,cr=rotl(cr,10),dr,m[10],0,12),ar,br=rotl(br,10),cr,m[4],0,9),ar=fn1(ar=rotl(ar,10),br=fn1(br,cr=fn1(cr,dr,er,ar,br,m[1],0,12),dr,er=rotl(er,10),ar,m[5],0,5),cr,dr=rotl(dr,10),er,m[8],0,14),cr=fn1(cr=rotl(cr,10),dr=fn1(dr,er=fn1(er,ar,br,cr,dr,m[7],0,6),ar,br=rotl(br,10),cr,m[6],0,8),er,ar=rotl(ar,10),br,m[2],0,13),er=fn1(er=rotl(er,10),ar=fn1(ar,br=fn1(br,cr,dr,er,ar,m[13],0,6),cr,dr=rotl(dr,10),er,m[14],0,5),br,cr=rotl(cr,10),dr,m[0],0,15),br=fn1(br=rotl(br,10),cr=fn1(cr,dr=fn1(dr,er,ar,br,cr,m[3],0,13),er,ar=rotl(ar,10),br,m[9],0,11),dr,er=rotl(er,10),ar,m[11],0,11),dr=rotl(dr,10);var t=this._b+cl+dr|0;this._b=this._c+dl+er|0,this._c=this._d+el+ar|0,this._d=this._e+al+br|0,this._e=this._a+bl+cr|0,this._a=t},RIPEMD160.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var buffer=new Buffer(20);return buffer.writeInt32LE(this._a,0),buffer.writeInt32LE(this._b,4),buffer.writeInt32LE(this._c,8),buffer.writeInt32LE(this._d,12),buffer.writeInt32LE(this._e,16),buffer};function rotl(x,n){return x<<n|x>>>32-n}function fn1(a,b,c,d,e,m,k,s){return rotl(a+(b^c^d)+m+k|0,s)+e|0}function fn2(a,b,c,d,e,m,k,s){return rotl(a+(b&c|~b&d)+m+k|0,s)+e|0}function fn3(a,b,c,d,e,m,k,s){return rotl(a+((b|~c)^d)+m+k|0,s)+e|0}function fn4(a,b,c,d,e,m,k,s){return rotl(a+(b&d|c&~d)+m+k|0,s)+e|0}function fn5(a,b,c,d,e,m,k,s){return rotl(a+(b^(c|~d))+m+k|0,s)+e|0}module.exports=RIPEMD160}).call(this,require("buffer").Buffer)},{buffer:269,"hash-base":336,inherits:352}],401:[function(require,module,exports){var buffer=require("buffer"),Buffer=buffer.Buffer;function copyProps(src,dst){for(var key in src)dst[key]=src[key]}Buffer.from&&Buffer.alloc&&Buffer.allocUnsafe&&Buffer.allocUnsafeSlow?module.exports=buffer:(copyProps(buffer,exports),exports.Buffer=SafeBuffer);function SafeBuffer(arg,encodingOrOffset,length){return Buffer(arg,encodingOrOffset,length)}copyProps(Buffer,SafeBuffer),SafeBuffer.from=function(arg,encodingOrOffset,length){if("number"==typeof arg)throw new TypeError("Argument must not be a number");return Buffer(arg,encodingOrOffset,length)},SafeBuffer.alloc=function(size,fill,encoding){if("number"!=typeof size)throw new TypeError("Argument must be a number");var buf=Buffer(size);return void 0!==fill?"string"==typeof encoding?buf.fill(fill,encoding):buf.fill(fill):buf.fill(0),buf},SafeBuffer.allocUnsafe=function(size){if("number"!=typeof size)throw new TypeError("Argument must be a number");return Buffer(size)},SafeBuffer.allocUnsafeSlow=function(size){if("number"!=typeof size)throw new TypeError("Argument must be a number");return buffer.SlowBuffer(size)}},{buffer:269}],402:[function(require,module,exports){"use strict";module.exports=require("./lib")(require("./lib/js"))},{"./lib":405,"./lib/js":411}],403:[function(require,module,exports){(function(Buffer){"use strict";var toString=Object.prototype.toString;exports.isArray=function(value,message){if(!Array.isArray(value))throw TypeError(message)},exports.isBoolean=function(value,message){if("[object Boolean]"!==toString.call(value))throw TypeError(message)},exports.isBuffer=function(value,message){if(!Buffer.isBuffer(value))throw TypeError(message)},exports.isFunction=function(value,message){if("[object Function]"!==toString.call(value))throw TypeError(message)},exports.isNumber=function(value,message){if("[object Number]"!==toString.call(value))throw TypeError(message)},exports.isObject=function(value,message){if("[object Object]"!==toString.call(value))throw TypeError(message)},exports.isBufferLength=function(buffer,length,message){if(buffer.length!==length)throw RangeError(message)},exports.isBufferLength2=function(buffer,length1,length2,message){if(buffer.length!==length1&&buffer.length!==length2)throw RangeError(message)},exports.isLengthGTZero=function(value,message){if(0===value.length)throw RangeError(message)},exports.isNumberInInterval=function(number,x,y,message){if(number<=x||number>=y)throw RangeError(message)}}).call(this,{isBuffer:require("../../is-buffer/index.js")})},{"../../is-buffer/index.js":353}],404:[function(require,module,exports){"use strict";var Buffer=require("safe-buffer").Buffer,bip66=require("bip66"),EC_PRIVKEY_EXPORT_DER_COMPRESSED=Buffer.from([48,129,211,2,1,1,4,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,160,129,133,48,129,130,2,1,1,48,44,6,7,42,134,72,206,61,1,1,2,33,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,255,255,252,47,48,6,4,1,0,4,1,7,4,33,2,121,190,102,126,249,220,187,172,85,160,98,149,206,135,11,7,2,155,252,219,45,206,40,217,89,242,129,91,22,248,23,152,2,33,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,186,174,220,230,175,72,160,59,191,210,94,140,208,54,65,65,2,1,1,161,36,3,34,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),EC_PRIVKEY_EXPORT_DER_UNCOMPRESSED=Buffer.from([48,130,1,19,2,1,1,4,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,160,129,165,48,129,162,2,1,1,48,44,6,7,42,134,72,206,61,1,1,2,33,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,255,255,252,47,48,6,4,1,0,4,1,7,4,65,4,121,190,102,126,249,220,187,172,85,160,98,149,206,135,11,7,2,155,252,219,45,206,40,217,89,242,129,91,22,248,23,152,72,58,218,119,38,163,196,101,93,164,251,252,14,17,8,168,253,23,180,72,166,133,84,25,156,71,208,143,251,16,212,184,2,33,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,186,174,220,230,175,72,160,59,191,210,94,140,208,54,65,65,2,1,1,161,68,3,66,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);exports.privateKeyExport=function(privateKey,publicKey,compressed){var result=Buffer.from(compressed?EC_PRIVKEY_EXPORT_DER_COMPRESSED:EC_PRIVKEY_EXPORT_DER_UNCOMPRESSED);return privateKey.copy(result,compressed?8:9),publicKey.copy(result,compressed?181:214),result},exports.privateKeyImport=function(privateKey){var length=privateKey.length,index=0;if(!(length<index+1||48!==privateKey[index])&&!(length<(index+=1)+1)&&128&privateKey[index]){var lenb=127&privateKey[index];if(index+=1,!(lenb<1||lenb>2||length<index+lenb)){var len=privateKey[index+lenb-1]|(lenb>1?privateKey[index+lenb-2]<<8:0);if(!(length<(index+=lenb)+len||length<index+3||2!==privateKey[index]||1!==privateKey[index+1]||1!==privateKey[index+2]||length<(index+=3)+2||4!==privateKey[index]||privateKey[index+1]>32||length<index+2+privateKey[index+1]))return privateKey.slice(index+2,index+2+privateKey[index+1])}}},exports.signatureExport=function(sigObj){for(var r=Buffer.concat([Buffer.from([0]),sigObj.r]),lenR=33,posR=0;lenR>1&&0===r[posR]&&!(128&r[posR+1]);--lenR,++posR);for(var s=Buffer.concat([Buffer.from([0]),sigObj.s]),lenS=33,posS=0;lenS>1&&0===s[posS]&&!(128&s[posS+1]);--lenS,++posS);return bip66.encode(r.slice(posR),s.slice(posS))},exports.signatureImport=function(sig){var r=Buffer.alloc(32,0),s=Buffer.alloc(32,0);try{var sigObj=bip66.decode(sig);if(33===sigObj.r.length&&0===sigObj.r[0]&&(sigObj.r=sigObj.r.slice(1)),sigObj.r.length>32)throw new Error("R length is too long");if(33===sigObj.s.length&&0===sigObj.s[0]&&(sigObj.s=sigObj.s.slice(1)),sigObj.s.length>32)throw new Error("S length is too long")}catch(err){return}return sigObj.r.copy(r,32-sigObj.r.length),sigObj.s.copy(s,32-sigObj.s.length),{r:r,s:s}},exports.signatureImportLax=function(sig){var r=Buffer.alloc(32,0),s=Buffer.alloc(32,0),length=sig.length,index=0;if(48===sig[index++]){var lenbyte=sig[index++];if(!(128&lenbyte&&(index+=lenbyte-128)>length)&&2===sig[index++]){var rlen=sig[index++];if(128&rlen){if(index+(lenbyte=rlen-128)>length)return;for(;lenbyte>0&&0===sig[index];index+=1,lenbyte-=1);for(rlen=0;lenbyte>0;index+=1,lenbyte-=1)rlen=(rlen<<8)+sig[index]}if(!(rlen>length-index)){var rindex=index;if(index+=rlen,2===sig[index++]){var slen=sig[index++];if(128&slen){if(index+(lenbyte=slen-128)>length)return;for(;lenbyte>0&&0===sig[index];index+=1,lenbyte-=1);for(slen=0;lenbyte>0;index+=1,lenbyte-=1)slen=(slen<<8)+sig[index]}if(!(slen>length-index)){var sindex=index;for(index+=slen;rlen>0&&0===sig[rindex];rlen-=1,rindex+=1);if(!(rlen>32)){var rvalue=sig.slice(rindex,rindex+rlen);for(rvalue.copy(r,32-rvalue.length);slen>0&&0===sig[sindex];slen-=1,sindex+=1);if(!(slen>32)){var svalue=sig.slice(sindex,sindex+slen);return svalue.copy(s,32-svalue.length),{r:r,s:s}}}}}}}}}},{bip66:210,"safe-buffer":401}],405:[function(require,module,exports){"use strict";var assert=require("./assert"),der=require("./der"),messages=require("./messages.json");function initCompressedValue(value,defaultValue){return void 0===value?defaultValue:(assert.isBoolean(value,messages.COMPRESSED_TYPE_INVALID),value)}module.exports=function(secp256k1){return{privateKeyVerify:function(privateKey){return assert.isBuffer(privateKey,messages.EC_PRIVATE_KEY_TYPE_INVALID),32===privateKey.length&&secp256k1.privateKeyVerify(privateKey)},privateKeyExport:function(privateKey,compressed){assert.isBuffer(privateKey,messages.EC_PRIVATE_KEY_TYPE_INVALID),assert.isBufferLength(privateKey,32,messages.EC_PRIVATE_KEY_LENGTH_INVALID),compressed=initCompressedValue(compressed,!0);var publicKey=secp256k1.privateKeyExport(privateKey,compressed);return der.privateKeyExport(privateKey,publicKey,compressed)},privateKeyImport:function(privateKey){if(assert.isBuffer(privateKey,messages.EC_PRIVATE_KEY_TYPE_INVALID),(privateKey=der.privateKeyImport(privateKey))&&32===privateKey.length&&secp256k1.privateKeyVerify(privateKey))return privateKey;throw new Error(messages.EC_PRIVATE_KEY_IMPORT_DER_FAIL)},privateKeyTweakAdd:function(privateKey,tweak){return assert.isBuffer(privateKey,messages.EC_PRIVATE_KEY_TYPE_INVALID),assert.isBufferLength(privateKey,32,messages.EC_PRIVATE_KEY_LENGTH_INVALID),assert.isBuffer(tweak,messages.TWEAK_TYPE_INVALID),assert.isBufferLength(tweak,32,messages.TWEAK_LENGTH_INVALID),secp256k1.privateKeyTweakAdd(privateKey,tweak)},privateKeyTweakMul:function(privateKey,tweak){return assert.isBuffer(privateKey,messages.EC_PRIVATE_KEY_TYPE_INVALID),assert.isBufferLength(privateKey,32,messages.EC_PRIVATE_KEY_LENGTH_INVALID),assert.isBuffer(tweak,messages.TWEAK_TYPE_INVALID),assert.isBufferLength(tweak,32,messages.TWEAK_LENGTH_INVALID),secp256k1.privateKeyTweakMul(privateKey,tweak)},publicKeyCreate:function(privateKey,compressed){return assert.isBuffer(privateKey,messages.EC_PRIVATE_KEY_TYPE_INVALID),assert.isBufferLength(privateKey,32,messages.EC_PRIVATE_KEY_LENGTH_INVALID),compressed=initCompressedValue(compressed,!0),secp256k1.publicKeyCreate(privateKey,compressed)},publicKeyConvert:function(publicKey,compressed){return assert.isBuffer(publicKey,messages.EC_PUBLIC_KEY_TYPE_INVALID),assert.isBufferLength2(publicKey,33,65,messages.EC_PUBLIC_KEY_LENGTH_INVALID),compressed=initCompressedValue(compressed,!0),secp256k1.publicKeyConvert(publicKey,compressed)},publicKeyVerify:function(publicKey){return assert.isBuffer(publicKey,messages.EC_PUBLIC_KEY_TYPE_INVALID),secp256k1.publicKeyVerify(publicKey)},publicKeyTweakAdd:function(publicKey,tweak,compressed){return assert.isBuffer(publicKey,messages.EC_PUBLIC_KEY_TYPE_INVALID),assert.isBufferLength2(publicKey,33,65,messages.EC_PUBLIC_KEY_LENGTH_INVALID),assert.isBuffer(tweak,messages.TWEAK_TYPE_INVALID),assert.isBufferLength(tweak,32,messages.TWEAK_LENGTH_INVALID),compressed=initCompressedValue(compressed,!0),secp256k1.publicKeyTweakAdd(publicKey,tweak,compressed)},publicKeyTweakMul:function(publicKey,tweak,compressed){return assert.isBuffer(publicKey,messages.EC_PUBLIC_KEY_TYPE_INVALID),assert.isBufferLength2(publicKey,33,65,messages.EC_PUBLIC_KEY_LENGTH_INVALID),assert.isBuffer(tweak,messages.TWEAK_TYPE_INVALID),assert.isBufferLength(tweak,32,messages.TWEAK_LENGTH_INVALID),compressed=initCompressedValue(compressed,!0),secp256k1.publicKeyTweakMul(publicKey,tweak,compressed)},publicKeyCombine:function(publicKeys,compressed){assert.isArray(publicKeys,messages.EC_PUBLIC_KEYS_TYPE_INVALID),assert.isLengthGTZero(publicKeys,messages.EC_PUBLIC_KEYS_LENGTH_INVALID);for(var i=0;i<publicKeys.length;++i)assert.isBuffer(publicKeys[i],messages.EC_PUBLIC_KEY_TYPE_INVALID),assert.isBufferLength2(publicKeys[i],33,65,messages.EC_PUBLIC_KEY_LENGTH_INVALID);return compressed=initCompressedValue(compressed,!0),secp256k1.publicKeyCombine(publicKeys,compressed)},signatureNormalize:function(signature){return assert.isBuffer(signature,messages.ECDSA_SIGNATURE_TYPE_INVALID),assert.isBufferLength(signature,64,messages.ECDSA_SIGNATURE_LENGTH_INVALID),secp256k1.signatureNormalize(signature)},signatureExport:function(signature){assert.isBuffer(signature,messages.ECDSA_SIGNATURE_TYPE_INVALID),assert.isBufferLength(signature,64,messages.ECDSA_SIGNATURE_LENGTH_INVALID);var sigObj=secp256k1.signatureExport(signature);return der.signatureExport(sigObj)},signatureImport:function(sig){assert.isBuffer(sig,messages.ECDSA_SIGNATURE_TYPE_INVALID),assert.isLengthGTZero(sig,messages.ECDSA_SIGNATURE_LENGTH_INVALID);var sigObj=der.signatureImport(sig);if(sigObj)return secp256k1.signatureImport(sigObj);throw new Error(messages.ECDSA_SIGNATURE_PARSE_DER_FAIL)},signatureImportLax:function(sig){assert.isBuffer(sig,messages.ECDSA_SIGNATURE_TYPE_INVALID),assert.isLengthGTZero(sig,messages.ECDSA_SIGNATURE_LENGTH_INVALID);var sigObj=der.signatureImportLax(sig);if(sigObj)return secp256k1.signatureImport(sigObj);throw new Error(messages.ECDSA_SIGNATURE_PARSE_DER_FAIL)},sign:function(message,privateKey,options){assert.isBuffer(message,messages.MSG32_TYPE_INVALID),assert.isBufferLength(message,32,messages.MSG32_LENGTH_INVALID),assert.isBuffer(privateKey,messages.EC_PRIVATE_KEY_TYPE_INVALID),assert.isBufferLength(privateKey,32,messages.EC_PRIVATE_KEY_LENGTH_INVALID);var data=null,noncefn=null;return void 0!==options&&(assert.isObject(options,messages.OPTIONS_TYPE_INVALID),void 0!==options.data&&(assert.isBuffer(options.data,messages.OPTIONS_DATA_TYPE_INVALID),assert.isBufferLength(options.data,32,messages.OPTIONS_DATA_LENGTH_INVALID),data=options.data),void 0!==options.noncefn&&(assert.isFunction(options.noncefn,messages.OPTIONS_NONCEFN_TYPE_INVALID),noncefn=options.noncefn)),secp256k1.sign(message,privateKey,noncefn,data)},verify:function(message,signature,publicKey){return assert.isBuffer(message,messages.MSG32_TYPE_INVALID),assert.isBufferLength(message,32,messages.MSG32_LENGTH_INVALID),assert.isBuffer(signature,messages.ECDSA_SIGNATURE_TYPE_INVALID),assert.isBufferLength(signature,64,messages.ECDSA_SIGNATURE_LENGTH_INVALID),assert.isBuffer(publicKey,messages.EC_PUBLIC_KEY_TYPE_INVALID),assert.isBufferLength2(publicKey,33,65,messages.EC_PUBLIC_KEY_LENGTH_INVALID),secp256k1.verify(message,signature,publicKey)},recover:function(message,signature,recovery,compressed){return assert.isBuffer(message,messages.MSG32_TYPE_INVALID),assert.isBufferLength(message,32,messages.MSG32_LENGTH_INVALID),assert.isBuffer(signature,messages.ECDSA_SIGNATURE_TYPE_INVALID),assert.isBufferLength(signature,64,messages.ECDSA_SIGNATURE_LENGTH_INVALID),assert.isNumber(recovery,messages.RECOVERY_ID_TYPE_INVALID),assert.isNumberInInterval(recovery,-1,4,messages.RECOVERY_ID_VALUE_INVALID),compressed=initCompressedValue(compressed,!0),secp256k1.recover(message,signature,recovery,compressed)},ecdh:function(publicKey,privateKey){return assert.isBuffer(publicKey,messages.EC_PUBLIC_KEY_TYPE_INVALID),assert.isBufferLength2(publicKey,33,65,messages.EC_PUBLIC_KEY_LENGTH_INVALID),assert.isBuffer(privateKey,messages.EC_PRIVATE_KEY_TYPE_INVALID),assert.isBufferLength(privateKey,32,messages.EC_PRIVATE_KEY_LENGTH_INVALID),secp256k1.ecdh(publicKey,privateKey)},ecdhUnsafe:function(publicKey,privateKey,compressed){return assert.isBuffer(publicKey,messages.EC_PUBLIC_KEY_TYPE_INVALID),assert.isBufferLength2(publicKey,33,65,messages.EC_PUBLIC_KEY_LENGTH_INVALID),assert.isBuffer(privateKey,messages.EC_PRIVATE_KEY_TYPE_INVALID),assert.isBufferLength(privateKey,32,messages.EC_PRIVATE_KEY_LENGTH_INVALID),compressed=initCompressedValue(compressed,!0),secp256k1.ecdhUnsafe(publicKey,privateKey,compressed)}}}},{"./assert":403,"./der":404,"./messages.json":412}],406:[function(require,module,exports){"use strict";var Buffer=require("safe-buffer").Buffer,optimized=require("./optimized");function BN(){this.negative=0,this.words=null,this.length=0}BN.fromNumber=function(n){var bn=new BN;return bn.words=[67108863&n],bn.length=1,bn},BN.fromBuffer=function(b32){var bn=new BN;return bn.words=new Array(10),bn.words[0]=(3&b32[28])<<24|b32[29]<<16|b32[30]<<8|b32[31],bn.words[1]=(15&b32[25])<<22|b32[26]<<14|b32[27]<<6|b32[28]>>>2,bn.words[2]=(63&b32[22])<<20|b32[23]<<12|b32[24]<<4|b32[25]>>>4,bn.words[3]=(255&b32[19])<<18|b32[20]<<10|b32[21]<<2|b32[22]>>>6,bn.words[4]=(3&b32[15])<<24|b32[16]<<16|b32[17]<<8|b32[18],bn.words[5]=(15&b32[12])<<22|b32[13]<<14|b32[14]<<6|b32[15]>>>2,bn.words[6]=(63&b32[9])<<20|b32[10]<<12|b32[11]<<4|b32[12]>>>4,bn.words[7]=(255&b32[6])<<18|b32[7]<<10|b32[8]<<2|b32[9]>>>6,bn.words[8]=(3&b32[2])<<24|b32[3]<<16|b32[4]<<8|b32[5],bn.words[9]=b32[0]<<14|b32[1]<<6|b32[2]>>>2,bn.length=10,bn.strip()},BN.prototype.toBuffer=function(){for(var w=this.words,i=this.length;i<10;++i)w[i]=0;return Buffer.from([w[9]>>>14&255,w[9]>>>6&255,(63&w[9])<<2|w[8]>>>24&3,w[8]>>>16&255,w[8]>>>8&255,255&w[8],w[7]>>>18&255,w[7]>>>10&255,w[7]>>>2&255,(3&w[7])<<6|w[6]>>>20&63,w[6]>>>12&255,w[6]>>>4&255,(15&w[6])<<4|w[5]>>>22&15,w[5]>>>14&255,w[5]>>>6&255,(63&w[5])<<2|w[4]>>>24&3,w[4]>>>16&255,w[4]>>>8&255,255&w[4],w[3]>>>18&255,w[3]>>>10&255,w[3]>>>2&255,(3&w[3])<<6|w[2]>>>20&63,w[2]>>>12&255,w[2]>>>4&255,(15&w[2])<<4|w[1]>>>22&15,w[1]>>>14&255,w[1]>>>6&255,(63&w[1])<<2|w[0]>>>24&3,w[0]>>>16&255,w[0]>>>8&255,255&w[0]])},BN.prototype.clone=function(){var r=new BN;r.words=new Array(this.length);for(var i=0;i<this.length;i++)r.words[i]=this.words[i];return r.length=this.length,r.negative=this.negative,r},BN.prototype.strip=function(){for(;this.length>1&&0==(0|this.words[this.length-1]);)this.length--;return this},BN.prototype.normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},BN.prototype.isEven=function(){return 0==(1&this.words[0])},BN.prototype.isOdd=function(){return 1==(1&this.words[0])},BN.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},BN.prototype.ucmp=function(num){if(this.length!==num.length)return this.length>num.length?1:-1;for(var i=this.length-1;i>=0;--i)if(this.words[i]!==num.words[i])return this.words[i]>num.words[i]?1:-1;return 0},BN.prototype.gtOne=function(){return this.length>1||this.words[0]>1},BN.prototype.isOverflow=function(){return this.ucmp(BN.n)>=0},BN.prototype.isHigh=function(){return 1===this.ucmp(BN.nh)},BN.prototype.bitLengthGT256=function(){return this.length>10||10===this.length&&this.words[9]>4194303},BN.prototype.iuaddn=function(num){this.words[0]+=num;for(var i=0;this.words[i]>67108863&&i<this.length;++i)this.words[i]-=67108864,this.words[i+1]+=1;return i===this.length&&(this.words[i]=1,this.length+=1),this},BN.prototype.iadd=function(num){if(this.negative!==num.negative)return 0!==this.negative?(this.negative=0,this.isub(num),this.negative^=1):(num.negative=0,this.isub(num),num.negative=1),this.normSign();var a,b;this.length>num.length?(a=this,b=num):(a=num,b=this);for(var i=0,carry=0;i<b.length;++i){var word=a.words[i]+b.words[i]+carry;this.words[i]=67108863&word,carry=word>>>26}for(;0!==carry&&i<a.length;++i)word=a.words[i]+carry,this.words[i]=67108863&word,carry=word>>>26;if(this.length=a.length,0!==carry)this.words[this.length++]=carry;else if(a!==this)for(;i<a.length;++i)this.words[i]=a.words[i];return this},BN.prototype.add=function(num){return this.clone().iadd(num)},BN.prototype.isub=function(num){if(this.negative!==num.negative)return 0!==this.negative?(this.negative=0,this.iadd(num),this.negative=1):(num.negative=0,this.iadd(num),num.negative=1),this.normSign();var cmp=this.ucmp(num);if(0===cmp)return this.negative=0,this.words[0]=0,this.length=1,this;var a,b;cmp>0?(a=this,b=num):(a=num,b=this);for(var i=0,carry=0;i<b.length;++i){var word=a.words[i]-b.words[i]+carry;carry=word>>26,this.words[i]=67108863&word}for(;0!==carry&&i<a.length;++i)carry=(word=a.words[i]+carry)>>26,this.words[i]=67108863&word;if(0===carry&&i<a.length&&a!==this)for(;i<a.length;++i)this.words[i]=a.words[i];return this.length=Math.max(this.length,i),a!==this&&(this.negative^=1),this.strip().normSign()},BN.prototype.sub=function(num){return this.clone().isub(num)},BN.umulTo=function(num1,num2,out){out.length=num1.length+num2.length-1;var r1=num1.words[0]*num2.words[0],carry=r1/67108864|0;out.words[0]=67108863&r1;for(var k=1,maxK=out.length;k<maxK;k++){for(var ncarry=carry>>>26,rword=67108863&carry,j=Math.max(0,k-num1.length+1),maxJ=Math.min(k,num2.length-1);j<=maxJ;j++){var i=k-j,r=num1.words[i]*num2.words[j]+rword;ncarry+=r/67108864|0,rword=67108863&r}out.words[k]=rword,carry=ncarry}return 0!==carry&&(out.words[out.length++]=carry),out.strip()},BN.umulTo10x10=Math.imul?optimized.umulTo10x10:BN.umulTo,BN.umulnTo=function(num,k,out){if(0===k)return out.words=[0],out.length=1,out;for(var i=0,carry=0;i<num.length;++i){var r=num.words[i]*k+carry;out.words[i]=67108863&r,carry=r/67108864|0}return carry>0?(out.words[i]=carry,out.length=num.length+1):out.length=num.length,out},BN.prototype.umul=function(num){var out=new BN;return out.words=new Array(this.length+num.length),10===this.length&&10===num.length?BN.umulTo10x10(this,num,out):1===this.length?BN.umulnTo(num,this.words[0],out):1===num.length?BN.umulnTo(this,num.words[0],out):BN.umulTo(this,num,out)},BN.prototype.isplit=function(output){output.length=Math.min(this.length,9);for(var i=0;i<output.length;++i)output.words[i]=this.words[i];if(this.length<=9)return this.words[0]=0,this.length=1,this;var prev=this.words[9];for(output.words[output.length++]=4194303&prev,i=10;i<this.length;++i){var word=this.words[i];this.words[i-10]=(4194303&word)<<4|prev>>>22,prev=word}return prev>>>=22,this.words[i-10]=prev,0===prev&&this.length>10?this.length-=10:this.length-=9,this},BN.prototype.fireduce=function(){return this.isOverflow()&&this.isub(BN.n),this},BN.prototype.ureduce=function(){var num=this.clone().isplit(BN.tmp).umul(BN.nc).iadd(BN.tmp);return num.bitLengthGT256()&&(num=num.isplit(BN.tmp).umul(BN.nc).iadd(BN.tmp)).bitLengthGT256()&&(num=num.isplit(BN.tmp).umul(BN.nc).iadd(BN.tmp)),num.fireduce()},BN.prototype.ishrn=function(n){for(var mask=(1<<n)-1,m=26-n,i=this.length-1,carry=0;i>=0;--i){var word=this.words[i];this.words[i]=carry<<m|word>>>n,carry=word&mask}return this.length>1&&0===this.words[this.length-1]&&(this.length-=1),this},BN.prototype.uinvm=function(){for(var x=this.clone(),y=BN.n.clone(),A=BN.fromNumber(1),B=BN.fromNumber(0),C=BN.fromNumber(0),D=BN.fromNumber(1);x.isEven()&&y.isEven();){for(var k=1,m=1;0==(x.words[0]&m)&&0==(y.words[0]&m)&&k<26;++k,m<<=1);x.ishrn(k),y.ishrn(k)}for(var yp=y.clone(),xp=x.clone();!x.isZero();){for(var i=0,im=1;0==(x.words[0]&im)&&i<26;++i,im<<=1);if(i>0)for(x.ishrn(i);i-- >0;)(A.isOdd()||B.isOdd())&&(A.iadd(yp),B.isub(xp)),A.ishrn(1),B.ishrn(1);for(var j=0,jm=1;0==(y.words[0]&jm)&&j<26;++j,jm<<=1);if(j>0)for(y.ishrn(j);j-- >0;)(C.isOdd()||D.isOdd())&&(C.iadd(yp),D.isub(xp)),C.ishrn(1),D.ishrn(1);x.ucmp(y)>=0?(x.isub(y),A.isub(C),B.isub(D)):(y.isub(x),C.isub(A),D.isub(B))}if(1===C.negative){C.negative=0;var result=C.ureduce();return result.negative^=1,result.normSign().iadd(BN.n)}return C.ureduce()},BN.prototype.imulK=function(){this.words[this.length]=0,this.words[this.length+1]=0,this.length+=2;for(var i=0,lo=0;i<this.length;++i){var w=0|this.words[i];lo+=977*w,this.words[i]=67108863&lo,lo=64*w+(lo/67108864|0)}return 0===this.words[this.length-1]&&(this.length-=1,0===this.words[this.length-1]&&(this.length-=1)),this},BN.prototype.redIReduce=function(){this.isplit(BN.tmp).imulK().iadd(BN.tmp),this.bitLengthGT256()&&this.isplit(BN.tmp).imulK().iadd(BN.tmp);var cmp=this.ucmp(BN.p);return 0===cmp?(this.words[0]=0,this.length=1):cmp>0?this.isub(BN.p):this.strip(),this},BN.prototype.redNeg=function(){return this.isZero()?BN.fromNumber(0):BN.p.sub(this)},BN.prototype.redAdd=function(num){return this.clone().redIAdd(num)},BN.prototype.redIAdd=function(num){return this.iadd(num),this.ucmp(BN.p)>=0&&this.isub(BN.p),this},BN.prototype.redIAdd7=function(){return this.iuaddn(7),this.ucmp(BN.p)>=0&&this.isub(BN.p),this},BN.prototype.redSub=function(num){return this.clone().redISub(num)},BN.prototype.redISub=function(num){return this.isub(num),0!==this.negative&&this.iadd(BN.p),this},BN.prototype.redMul=function(num){return this.umul(num).redIReduce()},BN.prototype.redSqr=function(){return this.umul(this).redIReduce()},BN.prototype.redSqrt=function(){if(this.isZero())return this.clone();for(var wv2=this.redSqr(),wv4=wv2.redSqr(),wv12=wv4.redSqr().redMul(wv4),wv14=wv12.redMul(wv2),wv15=wv14.redMul(this),out=wv15,i=0;i<54;++i)out=out.redSqr().redSqr().redSqr().redSqr().redMul(wv15);for(out=out.redSqr().redSqr().redSqr().redSqr().redMul(wv14),i=0;i<5;++i)out=out.redSqr().redSqr().redSqr().redSqr().redMul(wv15);return 0===(out=(out=out.redSqr().redSqr().redSqr().redSqr().redMul(wv12)).redSqr().redSqr().redSqr().redSqr().redSqr().redSqr().redMul(wv12)).redSqr().ucmp(this)?out:null},BN.prototype.redInvm=function(){for(var a=this.clone(),b=BN.p.clone(),x1=BN.fromNumber(1),x2=BN.fromNumber(0);a.gtOne()&&b.gtOne();){for(var i=0,im=1;0==(a.words[0]&im)&&i<26;++i,im<<=1);if(i>0)for(a.ishrn(i);i-- >0;)x1.isOdd()&&x1.iadd(BN.p),x1.ishrn(1);for(var j=0,jm=1;0==(b.words[0]&jm)&&j<26;++j,jm<<=1);if(j>0)for(b.ishrn(j);j-- >0;)x2.isOdd()&&x2.iadd(BN.p),x2.ishrn(1);a.ucmp(b)>=0?(a.isub(b),x1.isub(x2)):(b.isub(a),x2.isub(x1))}var res;return 0!==(res=1===a.length&&1===a.words[0]?x1:x2).negative&&res.iadd(BN.p),0!==res.negative?(res.negative=0,res.redIReduce().redNeg()):res.redIReduce()},BN.prototype.getNAF=function(w){for(var naf=[],ws=1<<w+1,wsm1=ws-1,ws2=ws>>1,k=this.clone();!k.isZero();){for(var i=0,m=1;0==(k.words[0]&m)&&i<26;++i,m<<=1)naf.push(0);if(0!==i)k.ishrn(i);else{var mod=k.words[0]&wsm1;if(mod>=ws2)naf.push(ws2-mod),k.iuaddn(mod-ws2).ishrn(1);else if(naf.push(mod),k.words[0]-=mod,!k.isZero()){for(i=w-1;i>0;--i)naf.push(0);k.ishrn(w)}}}return naf},BN.prototype.inspect=function(){if(this.isZero())return"0";for(var buffer=this.toBuffer().toString("hex"),i=0;"0"===buffer[i];++i);return buffer.slice(i)},BN.n=BN.fromBuffer(Buffer.from("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","hex")),BN.nh=BN.n.clone().ishrn(1),BN.nc=BN.fromBuffer(Buffer.from("000000000000000000000000000000014551231950B75FC4402DA1732FC9BEBF","hex")),BN.p=BN.fromBuffer(Buffer.from("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","hex")),BN.psn=BN.p.sub(BN.n),BN.tmp=new BN,BN.tmp.words=new Array(10),BN.fromNumber(1).words[3]=0,module.exports=BN},{"./optimized":407,"safe-buffer":401}],407:[function(require,module,exports){"use strict";exports.umulTo10x10=function(num1,num2,out){var lo,mid,hi,a=num1.words,b=num2.words,o=out.words,c=0,a0=0|a[0],al0=8191&a0,ah0=a0>>>13,a1=0|a[1],al1=8191&a1,ah1=a1>>>13,a2=0|a[2],al2=8191&a2,ah2=a2>>>13,a3=0|a[3],al3=8191&a3,ah3=a3>>>13,a4=0|a[4],al4=8191&a4,ah4=a4>>>13,a5=0|a[5],al5=8191&a5,ah5=a5>>>13,a6=0|a[6],al6=8191&a6,ah6=a6>>>13,a7=0|a[7],al7=8191&a7,ah7=a7>>>13,a8=0|a[8],al8=8191&a8,ah8=a8>>>13,a9=0|a[9],al9=8191&a9,ah9=a9>>>13,b0=0|b[0],bl0=8191&b0,bh0=b0>>>13,b1=0|b[1],bl1=8191&b1,bh1=b1>>>13,b2=0|b[2],bl2=8191&b2,bh2=b2>>>13,b3=0|b[3],bl3=8191&b3,bh3=b3>>>13,b4=0|b[4],bl4=8191&b4,bh4=b4>>>13,b5=0|b[5],bl5=8191&b5,bh5=b5>>>13,b6=0|b[6],bl6=8191&b6,bh6=b6>>>13,b7=0|b[7],bl7=8191&b7,bh7=b7>>>13,b8=0|b[8],bl8=8191&b8,bh8=b8>>>13,b9=0|b[9],bl9=8191&b9,bh9=b9>>>13;out.length=19,lo=Math.imul(al0,bl0),mid=Math.imul(al0,bh0);var w0=c+lo+((8191&(mid+=Math.imul(ah0,bl0)))<<13);c=(hi=Math.imul(ah0,bh0))+(mid>>>13)+(w0>>>26),w0&=67108863,lo=Math.imul(al1,bl0),mid=Math.imul(al1,bh0),mid+=Math.imul(ah1,bl0),hi=Math.imul(ah1,bh0),lo+=Math.imul(al0,bl1),mid+=Math.imul(al0,bh1);var w1=c+lo+((8191&(mid+=Math.imul(ah0,bl1)))<<13);c=(hi+=Math.imul(ah0,bh1))+(mid>>>13)+(w1>>>26),w1&=67108863,lo=Math.imul(al2,bl0),mid=Math.imul(al2,bh0),mid+=Math.imul(ah2,bl0),hi=Math.imul(ah2,bh0),lo+=Math.imul(al1,bl1),mid+=Math.imul(al1,bh1),mid+=Math.imul(ah1,bl1),hi+=Math.imul(ah1,bh1),lo+=Math.imul(al0,bl2),mid+=Math.imul(al0,bh2);var w2=c+lo+((8191&(mid+=Math.imul(ah0,bl2)))<<13);c=(hi+=Math.imul(ah0,bh2))+(mid>>>13)+(w2>>>26),w2&=67108863,lo=Math.imul(al3,bl0),mid=Math.imul(al3,bh0),mid+=Math.imul(ah3,bl0),hi=Math.imul(ah3,bh0),lo+=Math.imul(al2,bl1),mid+=Math.imul(al2,bh1),mid+=Math.imul(ah2,bl1),hi+=Math.imul(ah2,bh1),lo+=Math.imul(al1,bl2),mid+=Math.imul(al1,bh2),mid+=Math.imul(ah1,bl2),hi+=Math.imul(ah1,bh2),lo+=Math.imul(al0,bl3),mid+=Math.imul(al0,bh3);var w3=c+lo+((8191&(mid+=Math.imul(ah0,bl3)))<<13);c=(hi+=Math.imul(ah0,bh3))+(mid>>>13)+(w3>>>26),w3&=67108863,lo=Math.imul(al4,bl0),mid=Math.imul(al4,bh0),mid+=Math.imul(ah4,bl0),hi=Math.imul(ah4,bh0),lo+=Math.imul(al3,bl1),mid+=Math.imul(al3,bh1),mid+=Math.imul(ah3,bl1),hi+=Math.imul(ah3,bh1),lo+=Math.imul(al2,bl2),mid+=Math.imul(al2,bh2),mid+=Math.imul(ah2,bl2),hi+=Math.imul(ah2,bh2),lo+=Math.imul(al1,bl3),mid+=Math.imul(al1,bh3),mid+=Math.imul(ah1,bl3),hi+=Math.imul(ah1,bh3),lo+=Math.imul(al0,bl4),mid+=Math.imul(al0,bh4);var w4=c+lo+((8191&(mid+=Math.imul(ah0,bl4)))<<13);c=(hi+=Math.imul(ah0,bh4))+(mid>>>13)+(w4>>>26),w4&=67108863,lo=Math.imul(al5,bl0),mid=Math.imul(al5,bh0),mid+=Math.imul(ah5,bl0),hi=Math.imul(ah5,bh0),lo+=Math.imul(al4,bl1),mid+=Math.imul(al4,bh1),mid+=Math.imul(ah4,bl1),hi+=Math.imul(ah4,bh1),lo+=Math.imul(al3,bl2),mid+=Math.imul(al3,bh2),mid+=Math.imul(ah3,bl2),hi+=Math.imul(ah3,bh2),lo+=Math.imul(al2,bl3),mid+=Math.imul(al2,bh3),mid+=Math.imul(ah2,bl3),hi+=Math.imul(ah2,bh3),lo+=Math.imul(al1,bl4),mid+=Math.imul(al1,bh4),mid+=Math.imul(ah1,bl4),hi+=Math.imul(ah1,bh4),lo+=Math.imul(al0,bl5),mid+=Math.imul(al0,bh5);var w5=c+lo+((8191&(mid+=Math.imul(ah0,bl5)))<<13);c=(hi+=Math.imul(ah0,bh5))+(mid>>>13)+(w5>>>26),w5&=67108863,lo=Math.imul(al6,bl0),mid=Math.imul(al6,bh0),mid+=Math.imul(ah6,bl0),hi=Math.imul(ah6,bh0),lo+=Math.imul(al5,bl1),mid+=Math.imul(al5,bh1),mid+=Math.imul(ah5,bl1),hi+=Math.imul(ah5,bh1),lo+=Math.imul(al4,bl2),mid+=Math.imul(al4,bh2),mid+=Math.imul(ah4,bl2),hi+=Math.imul(ah4,bh2),lo+=Math.imul(al3,bl3),mid+=Math.imul(al3,bh3),mid+=Math.imul(ah3,bl3),hi+=Math.imul(ah3,bh3),lo+=Math.imul(al2,bl4),mid+=Math.imul(al2,bh4),mid+=Math.imul(ah2,bl4),hi+=Math.imul(ah2,bh4),lo+=Math.imul(al1,bl5),mid+=Math.imul(al1,bh5),mid+=Math.imul(ah1,bl5),hi+=Math.imul(ah1,bh5),lo+=Math.imul(al0,bl6),mid+=Math.imul(al0,bh6);var w6=c+lo+((8191&(mid+=Math.imul(ah0,bl6)))<<13);c=(hi+=Math.imul(ah0,bh6))+(mid>>>13)+(w6>>>26),w6&=67108863,lo=Math.imul(al7,bl0),mid=Math.imul(al7,bh0),mid+=Math.imul(ah7,bl0),hi=Math.imul(ah7,bh0),lo+=Math.imul(al6,bl1),mid+=Math.imul(al6,bh1),mid+=Math.imul(ah6,bl1),hi+=Math.imul(ah6,bh1),lo+=Math.imul(al5,bl2),mid+=Math.imul(al5,bh2),mid+=Math.imul(ah5,bl2),hi+=Math.imul(ah5,bh2),lo+=Math.imul(al4,bl3),mid+=Math.imul(al4,bh3),mid+=Math.imul(ah4,bl3),hi+=Math.imul(ah4,bh3),lo+=Math.imul(al3,bl4),mid+=Math.imul(al3,bh4),mid+=Math.imul(ah3,bl4),hi+=Math.imul(ah3,bh4),lo+=Math.imul(al2,bl5),mid+=Math.imul(al2,bh5),mid+=Math.imul(ah2,bl5),hi+=Math.imul(ah2,bh5),lo+=Math.imul(al1,bl6),mid+=Math.imul(al1,bh6),mid+=Math.imul(ah1,bl6),hi+=Math.imul(ah1,bh6),lo+=Math.imul(al0,bl7),mid+=Math.imul(al0,bh7);var w7=c+lo+((8191&(mid+=Math.imul(ah0,bl7)))<<13);c=(hi+=Math.imul(ah0,bh7))+(mid>>>13)+(w7>>>26),w7&=67108863,lo=Math.imul(al8,bl0),mid=Math.imul(al8,bh0),mid+=Math.imul(ah8,bl0),hi=Math.imul(ah8,bh0),lo+=Math.imul(al7,bl1),mid+=Math.imul(al7,bh1),mid+=Math.imul(ah7,bl1),hi+=Math.imul(ah7,bh1),lo+=Math.imul(al6,bl2),mid+=Math.imul(al6,bh2),mid+=Math.imul(ah6,bl2),hi+=Math.imul(ah6,bh2),lo+=Math.imul(al5,bl3),mid+=Math.imul(al5,bh3),mid+=Math.imul(ah5,bl3),hi+=Math.imul(ah5,bh3),lo+=Math.imul(al4,bl4),mid+=Math.imul(al4,bh4),mid+=Math.imul(ah4,bl4),hi+=Math.imul(ah4,bh4),lo+=Math.imul(al3,bl5),mid+=Math.imul(al3,bh5),mid+=Math.imul(ah3,bl5),hi+=Math.imul(ah3,bh5),lo+=Math.imul(al2,bl6),mid+=Math.imul(al2,bh6),mid+=Math.imul(ah2,bl6),hi+=Math.imul(ah2,bh6),lo+=Math.imul(al1,bl7),mid+=Math.imul(al1,bh7),mid+=Math.imul(ah1,bl7),hi+=Math.imul(ah1,bh7),lo+=Math.imul(al0,bl8),mid+=Math.imul(al0,bh8);var w8=c+lo+((8191&(mid+=Math.imul(ah0,bl8)))<<13);c=(hi+=Math.imul(ah0,bh8))+(mid>>>13)+(w8>>>26),w8&=67108863,lo=Math.imul(al9,bl0),mid=Math.imul(al9,bh0),mid+=Math.imul(ah9,bl0),hi=Math.imul(ah9,bh0),lo+=Math.imul(al8,bl1),mid+=Math.imul(al8,bh1),mid+=Math.imul(ah8,bl1),hi+=Math.imul(ah8,bh1),lo+=Math.imul(al7,bl2),mid+=Math.imul(al7,bh2),mid+=Math.imul(ah7,bl2),hi+=Math.imul(ah7,bh2),lo+=Math.imul(al6,bl3),mid+=Math.imul(al6,bh3),mid+=Math.imul(ah6,bl3),hi+=Math.imul(ah6,bh3),lo+=Math.imul(al5,bl4),mid+=Math.imul(al5,bh4),mid+=Math.imul(ah5,bl4),hi+=Math.imul(ah5,bh4),lo+=Math.imul(al4,bl5),mid+=Math.imul(al4,bh5),mid+=Math.imul(ah4,bl5),hi+=Math.imul(ah4,bh5),lo+=Math.imul(al3,bl6),mid+=Math.imul(al3,bh6),mid+=Math.imul(ah3,bl6),hi+=Math.imul(ah3,bh6),lo+=Math.imul(al2,bl7),mid+=Math.imul(al2,bh7),mid+=Math.imul(ah2,bl7),hi+=Math.imul(ah2,bh7),lo+=Math.imul(al1,bl8),mid+=Math.imul(al1,bh8),mid+=Math.imul(ah1,bl8),hi+=Math.imul(ah1,bh8),lo+=Math.imul(al0,bl9),mid+=Math.imul(al0,bh9);var w9=c+lo+((8191&(mid+=Math.imul(ah0,bl9)))<<13);c=(hi+=Math.imul(ah0,bh9))+(mid>>>13)+(w9>>>26),w9&=67108863,lo=Math.imul(al9,bl1),mid=Math.imul(al9,bh1),mid+=Math.imul(ah9,bl1),hi=Math.imul(ah9,bh1),lo+=Math.imul(al8,bl2),mid+=Math.imul(al8,bh2),mid+=Math.imul(ah8,bl2),hi+=Math.imul(ah8,bh2),lo+=Math.imul(al7,bl3),mid+=Math.imul(al7,bh3),mid+=Math.imul(ah7,bl3),hi+=Math.imul(ah7,bh3),lo+=Math.imul(al6,bl4),mid+=Math.imul(al6,bh4),mid+=Math.imul(ah6,bl4),hi+=Math.imul(ah6,bh4),lo+=Math.imul(al5,bl5),mid+=Math.imul(al5,bh5),mid+=Math.imul(ah5,bl5),hi+=Math.imul(ah5,bh5),lo+=Math.imul(al4,bl6),mid+=Math.imul(al4,bh6),mid+=Math.imul(ah4,bl6),hi+=Math.imul(ah4,bh6),lo+=Math.imul(al3,bl7),mid+=Math.imul(al3,bh7),mid+=Math.imul(ah3,bl7),hi+=Math.imul(ah3,bh7),lo+=Math.imul(al2,bl8),mid+=Math.imul(al2,bh8),mid+=Math.imul(ah2,bl8),hi+=Math.imul(ah2,bh8),lo+=Math.imul(al1,bl9),mid+=Math.imul(al1,bh9);var w10=c+lo+((8191&(mid+=Math.imul(ah1,bl9)))<<13);c=(hi+=Math.imul(ah1,bh9))+(mid>>>13)+(w10>>>26),w10&=67108863,lo=Math.imul(al9,bl2),mid=Math.imul(al9,bh2),mid+=Math.imul(ah9,bl2),hi=Math.imul(ah9,bh2),lo+=Math.imul(al8,bl3),mid+=Math.imul(al8,bh3),mid+=Math.imul(ah8,bl3),hi+=Math.imul(ah8,bh3),lo+=Math.imul(al7,bl4),mid+=Math.imul(al7,bh4),mid+=Math.imul(ah7,bl4),hi+=Math.imul(ah7,bh4),lo+=Math.imul(al6,bl5),mid+=Math.imul(al6,bh5),mid+=Math.imul(ah6,bl5),hi+=Math.imul(ah6,bh5),lo+=Math.imul(al5,bl6),mid+=Math.imul(al5,bh6),mid+=Math.imul(ah5,bl6),hi+=Math.imul(ah5,bh6),lo+=Math.imul(al4,bl7),mid+=Math.imul(al4,bh7),mid+=Math.imul(ah4,bl7),hi+=Math.imul(ah4,bh7),lo+=Math.imul(al3,bl8),mid+=Math.imul(al3,bh8),mid+=Math.imul(ah3,bl8),hi+=Math.imul(ah3,bh8),lo+=Math.imul(al2,bl9),mid+=Math.imul(al2,bh9);var w11=c+lo+((8191&(mid+=Math.imul(ah2,bl9)))<<13);c=(hi+=Math.imul(ah2,bh9))+(mid>>>13)+(w11>>>26),w11&=67108863,lo=Math.imul(al9,bl3),mid=Math.imul(al9,bh3),mid+=Math.imul(ah9,bl3),hi=Math.imul(ah9,bh3),lo+=Math.imul(al8,bl4),mid+=Math.imul(al8,bh4),mid+=Math.imul(ah8,bl4),hi+=Math.imul(ah8,bh4),lo+=Math.imul(al7,bl5),mid+=Math.imul(al7,bh5),mid+=Math.imul(ah7,bl5),hi+=Math.imul(ah7,bh5),lo+=Math.imul(al6,bl6),mid+=Math.imul(al6,bh6),mid+=Math.imul(ah6,bl6),hi+=Math.imul(ah6,bh6),lo+=Math.imul(al5,bl7),mid+=Math.imul(al5,bh7),mid+=Math.imul(ah5,bl7),hi+=Math.imul(ah5,bh7),lo+=Math.imul(al4,bl8),mid+=Math.imul(al4,bh8),mid+=Math.imul(ah4,bl8),hi+=Math.imul(ah4,bh8),lo+=Math.imul(al3,bl9),mid+=Math.imul(al3,bh9);var w12=c+lo+((8191&(mid+=Math.imul(ah3,bl9)))<<13);c=(hi+=Math.imul(ah3,bh9))+(mid>>>13)+(w12>>>26),w12&=67108863,lo=Math.imul(al9,bl4),mid=Math.imul(al9,bh4),mid+=Math.imul(ah9,bl4),hi=Math.imul(ah9,bh4),lo+=Math.imul(al8,bl5),mid+=Math.imul(al8,bh5),mid+=Math.imul(ah8,bl5),hi+=Math.imul(ah8,bh5),lo+=Math.imul(al7,bl6),mid+=Math.imul(al7,bh6),mid+=Math.imul(ah7,bl6),hi+=Math.imul(ah7,bh6),lo+=Math.imul(al6,bl7),mid+=Math.imul(al6,bh7),mid+=Math.imul(ah6,bl7),hi+=Math.imul(ah6,bh7),lo+=Math.imul(al5,bl8),mid+=Math.imul(al5,bh8),mid+=Math.imul(ah5,bl8),hi+=Math.imul(ah5,bh8),lo+=Math.imul(al4,bl9),mid+=Math.imul(al4,bh9);var w13=c+lo+((8191&(mid+=Math.imul(ah4,bl9)))<<13);c=(hi+=Math.imul(ah4,bh9))+(mid>>>13)+(w13>>>26),w13&=67108863,lo=Math.imul(al9,bl5),mid=Math.imul(al9,bh5),mid+=Math.imul(ah9,bl5),hi=Math.imul(ah9,bh5),lo+=Math.imul(al8,bl6),mid+=Math.imul(al8,bh6),mid+=Math.imul(ah8,bl6),hi+=Math.imul(ah8,bh6),lo+=Math.imul(al7,bl7),mid+=Math.imul(al7,bh7),mid+=Math.imul(ah7,bl7),hi+=Math.imul(ah7,bh7),lo+=Math.imul(al6,bl8),mid+=Math.imul(al6,bh8),mid+=Math.imul(ah6,bl8),hi+=Math.imul(ah6,bh8),lo+=Math.imul(al5,bl9),mid+=Math.imul(al5,bh9);var w14=c+lo+((8191&(mid+=Math.imul(ah5,bl9)))<<13);c=(hi+=Math.imul(ah5,bh9))+(mid>>>13)+(w14>>>26),w14&=67108863,lo=Math.imul(al9,bl6),mid=Math.imul(al9,bh6),mid+=Math.imul(ah9,bl6),hi=Math.imul(ah9,bh6),lo+=Math.imul(al8,bl7),mid+=Math.imul(al8,bh7),mid+=Math.imul(ah8,bl7),hi+=Math.imul(ah8,bh7),lo+=Math.imul(al7,bl8),mid+=Math.imul(al7,bh8),mid+=Math.imul(ah7,bl8),hi+=Math.imul(ah7,bh8),lo+=Math.imul(al6,bl9),mid+=Math.imul(al6,bh9);var w15=c+lo+((8191&(mid+=Math.imul(ah6,bl9)))<<13);c=(hi+=Math.imul(ah6,bh9))+(mid>>>13)+(w15>>>26),w15&=67108863,lo=Math.imul(al9,bl7),mid=Math.imul(al9,bh7),mid+=Math.imul(ah9,bl7),hi=Math.imul(ah9,bh7),lo+=Math.imul(al8,bl8),mid+=Math.imul(al8,bh8),mid+=Math.imul(ah8,bl8),hi+=Math.imul(ah8,bh8),lo+=Math.imul(al7,bl9),mid+=Math.imul(al7,bh9);var w16=c+lo+((8191&(mid+=Math.imul(ah7,bl9)))<<13);c=(hi+=Math.imul(ah7,bh9))+(mid>>>13)+(w16>>>26),w16&=67108863,lo=Math.imul(al9,bl8),mid=Math.imul(al9,bh8),mid+=Math.imul(ah9,bl8),hi=Math.imul(ah9,bh8),lo+=Math.imul(al8,bl9),mid+=Math.imul(al8,bh9);var w17=c+lo+((8191&(mid+=Math.imul(ah8,bl9)))<<13);c=(hi+=Math.imul(ah8,bh9))+(mid>>>13)+(w17>>>26),w17&=67108863,lo=Math.imul(al9,bl9),mid=Math.imul(al9,bh9);var w18=c+lo+((8191&(mid+=Math.imul(ah9,bl9)))<<13);return c=(hi=Math.imul(ah9,bh9))+(mid>>>13)+(w18>>>26),w18&=67108863,o[0]=w0,o[1]=w1,o[2]=w2,o[3]=w3,o[4]=w4,o[5]=w5,o[6]=w6,o[7]=w7,o[8]=w8,o[9]=w9,o[10]=w10,o[11]=w11,o[12]=w12,o[13]=w13,o[14]=w14,o[15]=w15,o[16]=w16,o[17]=w17,o[18]=w18,0!==c&&(o[19]=c,out.length++),out}},{}],408:[function(require,module,exports){"use strict";var BN=require("./bn");function ECJPoint(x,y,z){null===x&&null===y&&null===z?(this.x=ECJPoint.one,this.y=ECJPoint.one,this.z=ECJPoint.zero):(this.x=x,this.y=y,this.z=z),this.zOne=this.z===ECJPoint.one}ECJPoint.zero=BN.fromNumber(0),ECJPoint.one=BN.fromNumber(1),ECJPoint.prototype.neg=function(){return this.inf?this:new ECJPoint(this.x,this.y.redNeg(),this.z)},ECJPoint.prototype.add=function(p){if(this.inf)return p;if(p.inf)return this;var pz2=p.z.redSqr(),z2=this.z.redSqr(),u1=this.x.redMul(pz2),u2=p.x.redMul(z2),s1=this.y.redMul(pz2).redMul(p.z),s2=p.y.redMul(z2).redMul(this.z),h=u1.redSub(u2),r=s1.redSub(s2);if(h.isZero())return r.isZero()?this.dbl():new ECJPoint(null,null,null);var h2=h.redSqr(),v=u1.redMul(h2),h3=h2.redMul(h),nx=r.redSqr().redIAdd(h3).redISub(v).redISub(v);return new ECJPoint(nx,r.redMul(v.redISub(nx)).redISub(s1.redMul(h3)),this.z.redMul(p.z).redMul(h))},ECJPoint.prototype.mixedAdd=function(p){if(this.inf)return p.toECJPoint();if(p.inf)return this;var z2=this.z.redSqr(),u1=this.x,u2=p.x.redMul(z2),s1=this.y,s2=p.y.redMul(z2).redMul(this.z),h=u1.redSub(u2),r=s1.redSub(s2);if(h.isZero())return r.isZero()?this.dbl():new ECJPoint(null,null,null);var h2=h.redSqr(),v=u1.redMul(h2),h3=h2.redMul(h),nx=r.redSqr().redIAdd(h3).redISub(v).redISub(v);return new ECJPoint(nx,r.redMul(v.redISub(nx)).redISub(s1.redMul(h3)),this.z.redMul(h))},ECJPoint.prototype.dbl=function(){if(this.inf)return this;var nx,ny,nz;if(this.zOne){var xx=this.x.redSqr(),yy=this.y.redSqr(),yyyy=yy.redSqr(),s=this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);s=s.redIAdd(s);var m=xx.redAdd(xx).redIAdd(xx),t=m.redSqr().redISub(s).redISub(s),yyyy8=yyyy.redIAdd(yyyy).redIAdd(yyyy).redIAdd(yyyy);nx=t,ny=m.redMul(s.redISub(t)).redISub(yyyy8),nz=this.y.redAdd(this.y)}else{var a=this.x.redSqr(),b=this.y.redSqr(),c=b.redSqr(),d=this.x.redAdd(b).redSqr().redISub(a).redISub(c);d=d.redIAdd(d);var e=a.redAdd(a).redIAdd(a),f=e.redSqr(),c8=c.redIAdd(c).redIAdd(c).redIAdd(c);nx=f.redISub(d).redISub(d),ny=e.redMul(d.redISub(nx)).redISub(c8),nz=(nz=this.y.redMul(this.z)).redIAdd(nz)}return new ECJPoint(nx,ny,nz)},ECJPoint.prototype.dblp=function(pow){if(0===pow||this.inf)return this;for(var point=this,i=0;i<pow;i++)point=point.dbl();return point},Object.defineProperty(ECJPoint.prototype,"inf",{enumerable:!0,get:function(){return this.z.isZero()}}),module.exports=ECJPoint},{"./bn":406}],409:[function(require,module,exports){"use strict";var Buffer=require("safe-buffer").Buffer,BN=require("./bn"),ECJPoint=require("./ecjpoint");function ECPoint(x,y){null===x&&null===y?(this.x=this.y=null,this.inf=!0):(this.x=x,this.y=y,this.inf=!1)}ECPoint.fromPublicKey=function(publicKey){var x,y,first=publicKey[0];return 33!==publicKey.length||2!==first&&3!==first?65!==publicKey.length||4!==first&&6!==first&&7!==first?null:(x=BN.fromBuffer(publicKey.slice(1,33)),y=BN.fromBuffer(publicKey.slice(33,65)),x.ucmp(BN.p)>=0||y.ucmp(BN.p)>=0?null:6!==first&&7!==first||y.isOdd()===(7===first)?0!==x.redSqr().redMul(x).redIAdd7().ucmp(y.redSqr())?null:new ECPoint(x,y):null):(x=BN.fromBuffer(publicKey.slice(1,33))).ucmp(BN.p)>=0?null:null===(y=x.redSqr().redMul(x).redIAdd7().redSqrt())?null:(3===first!==y.isOdd()&&(y=y.redNeg()),new ECPoint(x,y))},ECPoint.prototype.toPublicKey=function(compressed){var publicKey,x=this.x,y=this.y;return compressed?((publicKey=Buffer.alloc(33))[0]=y.isOdd()?3:2,x.toBuffer().copy(publicKey,1)):((publicKey=Buffer.alloc(65))[0]=4,x.toBuffer().copy(publicKey,1),y.toBuffer().copy(publicKey,33)),publicKey},ECPoint.fromECJPoint=function(p){if(p.inf)return new ECPoint(null,null);var zinv=p.z.redInvm(),zinv2=zinv.redSqr();return new ECPoint(p.x.redMul(zinv2),p.y.redMul(zinv2).redMul(zinv))},ECPoint.prototype.toECJPoint=function(){return this.inf?new ECJPoint(null,null,null):new ECJPoint(this.x,this.y,ECJPoint.one)},ECPoint.prototype.neg=function(){return this.inf?this:new ECPoint(this.x,this.y.redNeg())},ECPoint.prototype.add=function(p){if(this.inf)return p;if(p.inf)return this;if(0===this.x.ucmp(p.x))return 0===this.y.ucmp(p.y)?this.dbl():new ECPoint(null,null);var s=this.y.redSub(p.y);s.isZero()||(s=s.redMul(this.x.redSub(p.x).redInvm()));var nx=s.redSqr().redISub(this.x).redISub(p.x);return new ECPoint(nx,s.redMul(this.x.redSub(nx)).redISub(this.y))},ECPoint.prototype.dbl=function(){if(this.inf)return this;var yy=this.y.redAdd(this.y);if(yy.isZero())return new ECPoint(null,null);var x2=this.x.redSqr(),s=x2.redAdd(x2).redIAdd(x2).redMul(yy.redInvm()),nx=s.redSqr().redISub(this.x.redAdd(this.x));return new ECPoint(nx,s.redMul(this.x.redSub(nx)).redISub(this.y))},ECPoint.prototype.mul=function(num){for(var nafPoints=this._getNAFPoints(4),points=nafPoints.points,naf=num.getNAF(nafPoints.wnd),acc=new ECJPoint(null,null,null),i=naf.length-1;i>=0;i--){for(var k=0;i>=0&&0===naf[i];i--,++k);if(i>=0&&(k+=1),acc=acc.dblp(k),i<0)break;var z=naf[i];acc=z>0?acc.mixedAdd(points[z-1>>1]):acc.mixedAdd(points[-z-1>>1].neg())}return ECPoint.fromECJPoint(acc)},ECPoint.prototype._getNAFPoints1=function(){return{wnd:1,points:[this]}},ECPoint.prototype._getNAFPoints=function(wnd){var points=new Array((1<<wnd)-1);points[0]=this;for(var dbl=this.dbl(),i=1;i<points.length;++i)points[i]=points[i-1].add(dbl);return{wnd:wnd,points:points}},module.exports=ECPoint},{"./bn":406,"./ecjpoint":408,"safe-buffer":401}],410:[function(require,module,exports){"use strict";var Buffer=require("safe-buffer").Buffer,BN=require("./bn"),ECPoint=require("./ecpoint"),ECJPoint=require("./ecjpoint");function ECPointG(){this.x=BN.fromBuffer(Buffer.from("79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","hex")),this.y=BN.fromBuffer(Buffer.from("483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8","hex")),this.inf=!1,this._precompute()}ECPointG.prototype._precompute=function(){for(var ecpoint=new ECPoint(this.x,this.y),points=new Array(1+Math.ceil(64.25)),acc=points[0]=ecpoint,i=1;i<points.length;++i){for(var j=0;j<4;j++)acc=acc.dbl();points[i]=acc}this.precomputed={naf:ecpoint._getNAFPoints(7),doubles:{step:4,points:points,negpoints:points.map(function(p){return p.neg()})}}},ECPointG.prototype.mul=function(num){for(var step=this.precomputed.doubles.step,points=this.precomputed.doubles.points,negpoints=this.precomputed.doubles.negpoints,naf=num.getNAF(1),I=((1<<step+1)-(step%2==0?2:1))/3,repr=[],j=0;j<naf.length;j+=step){for(var nafW=0,k=j+step-1;k>=j;k--)nafW=(nafW<<1)+naf[k];repr.push(nafW)}for(var a=new ECJPoint(null,null,null),b=new ECJPoint(null,null,null),i=I;i>0;i--){for(var jj=0;jj<repr.length;jj++)repr[jj]===i?b=b.mixedAdd(points[jj]):repr[jj]===-i&&(b=b.mixedAdd(negpoints[jj]));a=a.add(b)}return ECPoint.fromECJPoint(a)},ECPointG.prototype.mulAdd=function(k1,p2,k2){for(var nafPointsP1=this.precomputed.naf,nafPointsP2=p2._getNAFPoints1(),wnd=[nafPointsP1.points,nafPointsP2.points],naf=[k1.getNAF(nafPointsP1.wnd),k2.getNAF(nafPointsP2.wnd)],acc=new ECJPoint(null,null,null),tmp=[null,null],i=Math.max(naf[0].length,naf[1].length);i>=0;i--){for(var k=0;i>=0&&(tmp[0]=0|naf[0][i],tmp[1]=0|naf[1][i],0===tmp[0]&&0===tmp[1]);++k,--i);if(i>=0&&(k+=1),acc=acc.dblp(k),i<0)break;for(var jj=0;jj<2;jj++){var p,z=tmp[jj];0!==z&&(z>0?p=wnd[jj][z>>1]:z<0&&(p=wnd[jj][-z>>1].neg()),acc=void 0===p.z?acc.mixedAdd(p):acc.add(p))}}return acc},module.exports=new ECPointG},{"./bn":406,"./ecjpoint":408,"./ecpoint":409,"safe-buffer":401}],411:[function(require,module,exports){"use strict";var Buffer=require("safe-buffer").Buffer,createHash=require("create-hash"),HmacDRBG=require("drbg.js/hmac"),messages=require("../messages.json"),BN=require("./bn"),ECPoint=require("./ecpoint"),g=require("./ecpointg");exports.privateKeyVerify=function(privateKey){var bn=BN.fromBuffer(privateKey);return!(bn.isOverflow()||bn.isZero())},exports.privateKeyExport=function(privateKey,compressed){var d=BN.fromBuffer(privateKey);if(d.isOverflow()||d.isZero())throw new Error(messages.EC_PRIVATE_KEY_EXPORT_DER_FAIL);return g.mul(d).toPublicKey(compressed)},exports.privateKeyTweakAdd=function(privateKey,tweak){var bn=BN.fromBuffer(tweak);if(bn.isOverflow())throw new Error(messages.EC_PRIVATE_KEY_TWEAK_ADD_FAIL);if(bn.iadd(BN.fromBuffer(privateKey)),bn.isOverflow()&&bn.isub(BN.n),bn.isZero())throw new Error(messages.EC_PRIVATE_KEY_TWEAK_ADD_FAIL);return bn.toBuffer()},exports.privateKeyTweakMul=function(privateKey,tweak){var bn=BN.fromBuffer(tweak);if(bn.isOverflow()||bn.isZero())throw new Error(messages.EC_PRIVATE_KEY_TWEAK_MUL_FAIL);var d=BN.fromBuffer(privateKey);return bn.umul(d).ureduce().toBuffer()},exports.publicKeyCreate=function(privateKey,compressed){var d=BN.fromBuffer(privateKey);if(d.isOverflow()||d.isZero())throw new Error(messages.EC_PUBLIC_KEY_CREATE_FAIL);return g.mul(d).toPublicKey(compressed)},exports.publicKeyConvert=function(publicKey,compressed){var point=ECPoint.fromPublicKey(publicKey);if(null===point)throw new Error(messages.EC_PUBLIC_KEY_PARSE_FAIL);return point.toPublicKey(compressed)},exports.publicKeyVerify=function(publicKey){return null!==ECPoint.fromPublicKey(publicKey)},exports.publicKeyTweakAdd=function(publicKey,tweak,compressed){var point=ECPoint.fromPublicKey(publicKey);if(null===point)throw new Error(messages.EC_PUBLIC_KEY_PARSE_FAIL);if((tweak=BN.fromBuffer(tweak)).isOverflow())throw new Error(messages.EC_PUBLIC_KEY_TWEAK_ADD_FAIL);return g.mul(tweak).add(point).toPublicKey(compressed)},exports.publicKeyTweakMul=function(publicKey,tweak,compressed){var point=ECPoint.fromPublicKey(publicKey);if(null===point)throw new Error(messages.EC_PUBLIC_KEY_PARSE_FAIL);if((tweak=BN.fromBuffer(tweak)).isOverflow()||tweak.isZero())throw new Error(messages.EC_PUBLIC_KEY_TWEAK_MUL_FAIL);return point.mul(tweak).toPublicKey(compressed)},exports.publicKeyCombine=function(publicKeys,compressed){for(var points=new Array(publicKeys.length),i=0;i<publicKeys.length;++i)if(points[i]=ECPoint.fromPublicKey(publicKeys[i]),null===points[i])throw new Error(messages.EC_PUBLIC_KEY_PARSE_FAIL);for(var point=points[0],j=1;j<points.length;++j)point=point.add(points[j]);if(point.inf)throw new Error(messages.EC_PUBLIC_KEY_COMBINE_FAIL);return point.toPublicKey(compressed)},exports.signatureNormalize=function(signature){var r=BN.fromBuffer(signature.slice(0,32)),s=BN.fromBuffer(signature.slice(32,64));if(r.isOverflow()||s.isOverflow())throw new Error(messages.ECDSA_SIGNATURE_PARSE_FAIL);var result=Buffer.from(signature);return s.isHigh()&&BN.n.sub(s).toBuffer().copy(result,32),result},exports.signatureExport=function(signature){var r=signature.slice(0,32),s=signature.slice(32,64);if(BN.fromBuffer(r).isOverflow()||BN.fromBuffer(s).isOverflow())throw new Error(messages.ECDSA_SIGNATURE_PARSE_FAIL);return{r:r,s:s}},exports.signatureImport=function(sigObj){var r=BN.fromBuffer(sigObj.r);r.isOverflow()&&(r=BN.fromNumber(0));var s=BN.fromBuffer(sigObj.s);return s.isOverflow()&&(s=BN.fromNumber(0)),Buffer.concat([r.toBuffer(),s.toBuffer()])},exports.sign=function(message,privateKey,noncefn,data){var d=BN.fromBuffer(privateKey);if(d.isOverflow()||d.isZero())throw new Error(messages.ECDSA_SIGN_FAIL);if(null===noncefn){var drbg=new HmacDRBG("sha256",privateKey,message,data);noncefn=function(){return drbg.generate(32)}}for(var bnMessage=BN.fromBuffer(message),count=0;;++count){var nonce=noncefn(message,privateKey,null,data,count);if(!Buffer.isBuffer(nonce)||32!==nonce.length)throw new Error(messages.ECDSA_SIGN_FAIL);var k=BN.fromBuffer(nonce);if(!k.isOverflow()&&!k.isZero()){var kp=g.mul(k),r=kp.x.fireduce();if(!r.isZero()){var s=k.uinvm().umul(r.umul(d).ureduce().iadd(bnMessage).fireduce()).ureduce();if(!s.isZero()){var recovery=(0!==kp.x.ucmp(r)?2:0)|(kp.y.isOdd()?1:0);return s.isHigh()&&(s=BN.n.sub(s),recovery^=1),{signature:Buffer.concat([r.toBuffer(),s.toBuffer()]),recovery:recovery}}}}}},exports.verify=function(message,signature,publicKey){var sigr=BN.fromBuffer(signature.slice(0,32)),sigs=BN.fromBuffer(signature.slice(32,64));if(sigr.isOverflow()||sigs.isOverflow())throw new Error(messages.ECDSA_SIGNATURE_PARSE_FAIL);if(sigs.isHigh()||sigr.isZero()||sigs.isZero())return!1;var pub=ECPoint.fromPublicKey(publicKey);if(null===pub)throw new Error(messages.EC_PUBLIC_KEY_PARSE_FAIL);var sinv=sigs.uinvm(),u1=sinv.umul(BN.fromBuffer(message)).ureduce(),u2=sinv.umul(sigr).ureduce(),point=g.mulAdd(u1,pub,u2);if(point.inf)return!1;var z2=point.z.redSqr();return 0===sigr.redMul(z2).ucmp(point.x)||!(sigr.ucmp(BN.psn)>=0)&&0===sigr.iadd(BN.psn).redMul(z2).ucmp(point.x)},exports.recover=function(message,signature,recovery,compressed){var sigr=BN.fromBuffer(signature.slice(0,32)),sigs=BN.fromBuffer(signature.slice(32,64));if(sigr.isOverflow()||sigs.isOverflow())throw new Error(messages.ECDSA_SIGNATURE_PARSE_FAIL);do{if(sigr.isZero()||sigs.isZero())break;var kpx=sigr;if(recovery>>1){if(kpx.ucmp(BN.psn)>=0)break;kpx=sigr.add(BN.n)}var kpPublicKey=Buffer.concat([Buffer.from([2+(1&recovery)]),kpx.toBuffer()]),kp=ECPoint.fromPublicKey(kpPublicKey);if(null===kp)break;var rInv=sigr.uinvm(),s1=BN.n.sub(BN.fromBuffer(message)).umul(rInv).ureduce(),s2=sigs.umul(rInv).ureduce();return ECPoint.fromECJPoint(g.mulAdd(s1,kp,s2)).toPublicKey(compressed)}while(0);throw new Error(messages.ECDSA_RECOVER_FAIL)},exports.ecdh=function(publicKey,privateKey){var shared=exports.ecdhUnsafe(publicKey,privateKey,!0);return createHash("sha256").update(shared).digest()},exports.ecdhUnsafe=function(publicKey,privateKey,compressed){var point=ECPoint.fromPublicKey(publicKey);if(null===point)throw new Error(messages.EC_PUBLIC_KEY_PARSE_FAIL);var scalar=BN.fromBuffer(privateKey);if(scalar.isOverflow()||scalar.isZero())throw new Error(messages.ECDH_FAIL);return point.mul(scalar).toPublicKey(compressed)}},{"../messages.json":412,"./bn":406,"./ecpoint":409,"./ecpointg":410,"create-hash":300,"drbg.js/hmac":316,"safe-buffer":401}],412:[function(require,module,exports){module.exports={COMPRESSED_TYPE_INVALID:"compressed should be a boolean",EC_PRIVATE_KEY_TYPE_INVALID:"private key should be a Buffer",EC_PRIVATE_KEY_LENGTH_INVALID:"private key length is invalid",EC_PRIVATE_KEY_TWEAK_ADD_FAIL:"tweak out of range or resulting private key is invalid",EC_PRIVATE_KEY_TWEAK_MUL_FAIL:"tweak out of range",EC_PRIVATE_KEY_EXPORT_DER_FAIL:"couldn't export to DER format",EC_PRIVATE_KEY_IMPORT_DER_FAIL:"couldn't import from DER format",EC_PUBLIC_KEYS_TYPE_INVALID:"public keys should be an Array",EC_PUBLIC_KEYS_LENGTH_INVALID:"public keys Array should have at least 1 element",EC_PUBLIC_KEY_TYPE_INVALID:"public key should be a Buffer",EC_PUBLIC_KEY_LENGTH_INVALID:"public key length is invalid",EC_PUBLIC_KEY_PARSE_FAIL:"the public key could not be parsed or is invalid",EC_PUBLIC_KEY_CREATE_FAIL:"private was invalid, try again",EC_PUBLIC_KEY_TWEAK_ADD_FAIL:"tweak out of range or resulting public key is invalid",EC_PUBLIC_KEY_TWEAK_MUL_FAIL:"tweak out of range",EC_PUBLIC_KEY_COMBINE_FAIL:"the sum of the public keys is not valid",ECDH_FAIL:"scalar was invalid (zero or overflow)",ECDSA_SIGNATURE_TYPE_INVALID:"signature should be a Buffer",ECDSA_SIGNATURE_LENGTH_INVALID:"signature length is invalid",ECDSA_SIGNATURE_PARSE_FAIL:"couldn't parse signature",ECDSA_SIGNATURE_PARSE_DER_FAIL:"couldn't parse DER signature",ECDSA_SIGNATURE_SERIALIZE_DER_FAIL:"couldn't serialize signature to DER format",ECDSA_SIGN_FAIL:"nonce generation function failed or private key is invalid",ECDSA_RECOVER_FAIL:"couldn't recover public key from signature",MSG32_TYPE_INVALID:"message should be a Buffer",MSG32_LENGTH_INVALID:"message length is invalid",OPTIONS_TYPE_INVALID:"options should be an Object",OPTIONS_DATA_TYPE_INVALID:"options.data should be a Buffer",OPTIONS_DATA_LENGTH_INVALID:"options.data length is invalid",OPTIONS_NONCEFN_TYPE_INVALID:"options.noncefn should be a Function",RECOVERY_ID_TYPE_INVALID:"recovery should be a Number",RECOVERY_ID_VALUE_INVALID:"recovery should have value between -1 and 4",TWEAK_TYPE_INVALID:"tweak should be a Buffer",TWEAK_LENGTH_INVALID:"tweak length is invalid"}},{}],413:[function(require,module,exports){var Buffer=require("safe-buffer").Buffer;function Hash(blockSize,finalSize){this._block=Buffer.alloc(blockSize),this._finalSize=finalSize,this._blockSize=blockSize,this._len=0}Hash.prototype.update=function(data,enc){"string"==typeof data&&(enc=enc||"utf8",data=Buffer.from(data,enc));for(var block=this._block,blockSize=this._blockSize,length=data.length,accum=this._len,offset=0;offset<length;){for(var assigned=accum%blockSize,remainder=Math.min(length-offset,blockSize-assigned),i=0;i<remainder;i++)block[assigned+i]=data[offset+i];offset+=remainder,(accum+=remainder)%blockSize==0&&this._update(block)}return this._len+=length,this},Hash.prototype.digest=function(enc){var rem=this._len%this._blockSize;this._block[rem]=128,this._block.fill(0,rem+1),rem>=this._finalSize&&(this._update(this._block),this._block.fill(0));var bits=8*this._len;if(bits<=4294967295)this._block.writeUInt32BE(bits,this._blockSize-4);else{var lowBits=4294967295&bits,highBits=(bits-lowBits)/4294967296;this._block.writeUInt32BE(highBits,this._blockSize-8),this._block.writeUInt32BE(lowBits,this._blockSize-4)}this._update(this._block);var hash=this._hash();return enc?hash.toString(enc):hash},Hash.prototype._update=function(){throw new Error("_update must be implemented by subclass")},module.exports=Hash},{"safe-buffer":401}],414:[function(require,module,exports){(exports=module.exports=function(algorithm){algorithm=algorithm.toLowerCase();var Algorithm=exports[algorithm];if(!Algorithm)throw new Error(algorithm+" is not supported (we accept pull requests)");return new Algorithm}).sha=require("./sha"),exports.sha1=require("./sha1"),exports.sha224=require("./sha224"),exports.sha256=require("./sha256"),exports.sha384=require("./sha384"),exports.sha512=require("./sha512")},{"./sha":415,"./sha1":416,"./sha224":417,"./sha256":418,"./sha384":419,"./sha512":420}],415:[function(require,module,exports){var inherits=require("inherits"),Hash=require("./hash"),Buffer=require("safe-buffer").Buffer,K=[1518500249,1859775393,-1894007588,-899497514],W=new Array(80);function Sha(){this.init(),this._w=W,Hash.call(this,64,56)}inherits(Sha,Hash),Sha.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function rotl30(num){return num<<30|num>>>2}function ft(s,b,c,d){return 0===s?b&c|~b&d:2===s?b&c|b&d|c&d:b^c^d}Sha.prototype._update=function(M){for(var W=this._w,a=0|this._a,b=0|this._b,c=0|this._c,d=0|this._d,e=0|this._e,i=0;i<16;++i)W[i]=M.readInt32BE(4*i);for(;i<80;++i)W[i]=W[i-3]^W[i-8]^W[i-14]^W[i-16];for(var j=0;j<80;++j){var s=~~(j/20),t=0|(num=a,(num<<5|num>>>27)+ft(s,b,c,d)+e+W[j]+K[s]);e=d,d=c,c=rotl30(b),b=a,a=t}var num;this._a=a+this._a|0,this._b=b+this._b|0,this._c=c+this._c|0,this._d=d+this._d|0,this._e=e+this._e|0},Sha.prototype._hash=function(){var H=Buffer.allocUnsafe(20);return H.writeInt32BE(0|this._a,0),H.writeInt32BE(0|this._b,4),H.writeInt32BE(0|this._c,8),H.writeInt32BE(0|this._d,12),H.writeInt32BE(0|this._e,16),H},module.exports=Sha},{"./hash":413,inherits:352,"safe-buffer":401}],416:[function(require,module,exports){var inherits=require("inherits"),Hash=require("./hash"),Buffer=require("safe-buffer").Buffer,K=[1518500249,1859775393,-1894007588,-899497514],W=new Array(80);function Sha1(){this.init(),this._w=W,Hash.call(this,64,56)}inherits(Sha1,Hash),Sha1.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function rotl5(num){return num<<5|num>>>27}function rotl30(num){return num<<30|num>>>2}function ft(s,b,c,d){return 0===s?b&c|~b&d:2===s?b&c|b&d|c&d:b^c^d}Sha1.prototype._update=function(M){for(var W=this._w,a=0|this._a,b=0|this._b,c=0|this._c,d=0|this._d,e=0|this._e,i=0;i<16;++i)W[i]=M.readInt32BE(4*i);for(;i<80;++i)W[i]=(num=W[i-3]^W[i-8]^W[i-14]^W[i-16],num<<1|num>>>31);for(var num,j=0;j<80;++j){var s=~~(j/20),t=rotl5(a)+ft(s,b,c,d)+e+W[j]+K[s]|0;e=d,d=c,c=rotl30(b),b=a,a=t}this._a=a+this._a|0,this._b=b+this._b|0,this._c=c+this._c|0,this._d=d+this._d|0,this._e=e+this._e|0},Sha1.prototype._hash=function(){var H=Buffer.allocUnsafe(20);return H.writeInt32BE(0|this._a,0),H.writeInt32BE(0|this._b,4),H.writeInt32BE(0|this._c,8),H.writeInt32BE(0|this._d,12),H.writeInt32BE(0|this._e,16),H},module.exports=Sha1},{"./hash":413,inherits:352,"safe-buffer":401}],417:[function(require,module,exports){var inherits=require("inherits"),Sha256=require("./sha256"),Hash=require("./hash"),Buffer=require("safe-buffer").Buffer,W=new Array(64);function Sha224(){this.init(),this._w=W,Hash.call(this,64,56)}inherits(Sha224,Sha256),Sha224.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},Sha224.prototype._hash=function(){var H=Buffer.allocUnsafe(28);return H.writeInt32BE(this._a,0),H.writeInt32BE(this._b,4),H.writeInt32BE(this._c,8),H.writeInt32BE(this._d,12),H.writeInt32BE(this._e,16),H.writeInt32BE(this._f,20),H.writeInt32BE(this._g,24),H},module.exports=Sha224},{"./hash":413,"./sha256":418,inherits:352,"safe-buffer":401}],418:[function(require,module,exports){var inherits=require("inherits"),Hash=require("./hash"),Buffer=require("safe-buffer").Buffer,K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],W=new Array(64);function Sha256(){this.init(),this._w=W,Hash.call(this,64,56)}inherits(Sha256,Hash),Sha256.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this};function ch(x,y,z){return z^x&(y^z)}function maj(x,y,z){return x&y|z&(x|y)}function sigma0(x){return(x>>>2|x<<30)^(x>>>13|x<<19)^(x>>>22|x<<10)}function sigma1(x){return(x>>>6|x<<26)^(x>>>11|x<<21)^(x>>>25|x<<7)}function gamma0(x){return(x>>>7|x<<25)^(x>>>18|x<<14)^x>>>3}Sha256.prototype._update=function(M){for(var W=this._w,a=0|this._a,b=0|this._b,c=0|this._c,d=0|this._d,e=0|this._e,f=0|this._f,g=0|this._g,h=0|this._h,i=0;i<16;++i)W[i]=M.readInt32BE(4*i);for(;i<64;++i)W[i]=0|(x=W[i-2],((x>>>17|x<<15)^(x>>>19|x<<13)^x>>>10)+W[i-7]+gamma0(W[i-15])+W[i-16]);for(var x,j=0;j<64;++j){var T1=h+sigma1(e)+ch(e,f,g)+K[j]+W[j]|0,T2=sigma0(a)+maj(a,b,c)|0;h=g,g=f,f=e,e=d+T1|0,d=c,c=b,b=a,a=T1+T2|0}this._a=a+this._a|0,this._b=b+this._b|0,this._c=c+this._c|0,this._d=d+this._d|0,this._e=e+this._e|0,this._f=f+this._f|0,this._g=g+this._g|0,this._h=h+this._h|0},Sha256.prototype._hash=function(){var H=Buffer.allocUnsafe(32);return H.writeInt32BE(this._a,0),H.writeInt32BE(this._b,4),H.writeInt32BE(this._c,8),H.writeInt32BE(this._d,12),H.writeInt32BE(this._e,16),H.writeInt32BE(this._f,20),H.writeInt32BE(this._g,24),H.writeInt32BE(this._h,28),H},module.exports=Sha256},{"./hash":413,inherits:352,"safe-buffer":401}],419:[function(require,module,exports){var inherits=require("inherits"),SHA512=require("./sha512"),Hash=require("./hash"),Buffer=require("safe-buffer").Buffer,W=new Array(160);function Sha384(){this.init(),this._w=W,Hash.call(this,128,112)}inherits(Sha384,SHA512),Sha384.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},Sha384.prototype._hash=function(){var H=Buffer.allocUnsafe(48);function writeInt64BE(h,l,offset){H.writeInt32BE(h,offset),H.writeInt32BE(l,offset+4)}return writeInt64BE(this._ah,this._al,0),writeInt64BE(this._bh,this._bl,8),writeInt64BE(this._ch,this._cl,16),writeInt64BE(this._dh,this._dl,24),writeInt64BE(this._eh,this._el,32),writeInt64BE(this._fh,this._fl,40),H},module.exports=Sha384},{"./hash":413,"./sha512":420,inherits:352,"safe-buffer":401}],420:[function(require,module,exports){var inherits=require("inherits"),Hash=require("./hash"),Buffer=require("safe-buffer").Buffer,K=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],W=new Array(160);function Sha512(){this.init(),this._w=W,Hash.call(this,128,112)}inherits(Sha512,Hash),Sha512.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this};function Ch(x,y,z){return z^x&(y^z)}function maj(x,y,z){return x&y|z&(x|y)}function sigma0(x,xl){return(x>>>28|xl<<4)^(xl>>>2|x<<30)^(xl>>>7|x<<25)}function sigma1(x,xl){return(x>>>14|xl<<18)^(x>>>18|xl<<14)^(xl>>>9|x<<23)}function Gamma0(x,xl){return(x>>>1|xl<<31)^(x>>>8|xl<<24)^x>>>7}function Gamma0l(x,xl){return(x>>>1|xl<<31)^(x>>>8|xl<<24)^(x>>>7|xl<<25)}function Gamma1(x,xl){return(x>>>19|xl<<13)^(xl>>>29|x<<3)^x>>>6}function Gamma1l(x,xl){return(x>>>19|xl<<13)^(xl>>>29|x<<3)^(x>>>6|xl<<26)}function getCarry(a,b){return a>>>0<b>>>0?1:0}Sha512.prototype._update=function(M){for(var W=this._w,ah=0|this._ah,bh=0|this._bh,ch=0|this._ch,dh=0|this._dh,eh=0|this._eh,fh=0|this._fh,gh=0|this._gh,hh=0|this._hh,al=0|this._al,bl=0|this._bl,cl=0|this._cl,dl=0|this._dl,el=0|this._el,fl=0|this._fl,gl=0|this._gl,hl=0|this._hl,i=0;i<32;i+=2)W[i]=M.readInt32BE(4*i),W[i+1]=M.readInt32BE(4*i+4);for(;i<160;i+=2){var xh=W[i-30],xl=W[i-30+1],gamma0=Gamma0(xh,xl),gamma0l=Gamma0l(xl,xh),gamma1=Gamma1(xh=W[i-4],xl=W[i-4+1]),gamma1l=Gamma1l(xl,xh),Wi7h=W[i-14],Wi7l=W[i-14+1],Wi16h=W[i-32],Wi16l=W[i-32+1],Wil=gamma0l+Wi7l|0,Wih=gamma0+Wi7h+getCarry(Wil,gamma0l)|0;Wih=(Wih=Wih+gamma1+getCarry(Wil=Wil+gamma1l|0,gamma1l)|0)+Wi16h+getCarry(Wil=Wil+Wi16l|0,Wi16l)|0,W[i]=Wih,W[i+1]=Wil}for(var j=0;j<160;j+=2){Wih=W[j],Wil=W[j+1];var majh=maj(ah,bh,ch),majl=maj(al,bl,cl),sigma0h=sigma0(ah,al),sigma0l=sigma0(al,ah),sigma1h=sigma1(eh,el),sigma1l=sigma1(el,eh),Kih=K[j],Kil=K[j+1],chh=Ch(eh,fh,gh),chl=Ch(el,fl,gl),t1l=hl+sigma1l|0,t1h=hh+sigma1h+getCarry(t1l,hl)|0;t1h=(t1h=(t1h=t1h+chh+getCarry(t1l=t1l+chl|0,chl)|0)+Kih+getCarry(t1l=t1l+Kil|0,Kil)|0)+Wih+getCarry(t1l=t1l+Wil|0,Wil)|0;var t2l=sigma0l+majl|0,t2h=sigma0h+majh+getCarry(t2l,sigma0l)|0;hh=gh,hl=gl,gh=fh,gl=fl,fh=eh,fl=el,eh=dh+t1h+getCarry(el=dl+t1l|0,dl)|0,dh=ch,dl=cl,ch=bh,cl=bl,bh=ah,bl=al,ah=t1h+t2h+getCarry(al=t1l+t2l|0,t1l)|0}this._al=this._al+al|0,this._bl=this._bl+bl|0,this._cl=this._cl+cl|0,this._dl=this._dl+dl|0,this._el=this._el+el|0,this._fl=this._fl+fl|0,this._gl=this._gl+gl|0,this._hl=this._hl+hl|0,this._ah=this._ah+ah+getCarry(this._al,al)|0,this._bh=this._bh+bh+getCarry(this._bl,bl)|0,this._ch=this._ch+ch+getCarry(this._cl,cl)|0,this._dh=this._dh+dh+getCarry(this._dl,dl)|0,this._eh=this._eh+eh+getCarry(this._el,el)|0,this._fh=this._fh+fh+getCarry(this._fl,fl)|0,this._gh=this._gh+gh+getCarry(this._gl,gl)|0,this._hh=this._hh+hh+getCarry(this._hl,hl)|0},Sha512.prototype._hash=function(){var H=Buffer.allocUnsafe(64);function writeInt64BE(h,l,offset){H.writeInt32BE(h,offset),H.writeInt32BE(l,offset+4)}return writeInt64BE(this._ah,this._al,0),writeInt64BE(this._bh,this._bl,8),writeInt64BE(this._ch,this._cl,16),writeInt64BE(this._dh,this._dl,24),writeInt64BE(this._eh,this._el,32),writeInt64BE(this._fh,this._fl,40),writeInt64BE(this._gh,this._gl,48),writeInt64BE(this._hh,this._hl,56),H},module.exports=Sha512},{"./hash":413,inherits:352,"safe-buffer":401}],421:[function(require,module,exports){module.exports=Stream;var EE=require("events").EventEmitter;require("inherits")(Stream,EE),Stream.Readable=require("readable-stream/readable.js"),Stream.Writable=require("readable-stream/writable.js"),Stream.Duplex=require("readable-stream/duplex.js"),Stream.Transform=require("readable-stream/transform.js"),Stream.PassThrough=require("readable-stream/passthrough.js"),Stream.Stream=Stream;function Stream(){EE.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){dest.writable&&!1===dest.write(chunk)&&source.pause&&source.pause()}source.on("data",ondata);function ondrain(){source.readable&&source.resume&&source.resume()}dest.on("drain",ondrain),dest._isStdio||options&&!1===options.end||(source.on("end",onend),source.on("close",onclose));var didOnEnd=!1;function onend(){didOnEnd||(didOnEnd=!0,dest.end())}function onclose(){didOnEnd||(didOnEnd=!0,"function"==typeof dest.destroy&&dest.destroy())}function onerror(er){if(cleanup(),0===EE.listenerCount(this,"error"))throw er}source.on("error",onerror),dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata),dest.removeListener("drain",ondrain),source.removeListener("end",onend),source.removeListener("close",onclose),source.removeListener("error",onerror),dest.removeListener("error",onerror),source.removeListener("end",cleanup),source.removeListener("close",cleanup),dest.removeListener("close",cleanup)}return source.on("end",cleanup),source.on("close",cleanup),dest.on("close",cleanup),dest.emit("pipe",source),dest}},{events:334,inherits:352,"readable-stream/duplex.js":387,"readable-stream/passthrough.js":396,"readable-stream/readable.js":397,"readable-stream/transform.js":398,"readable-stream/writable.js":399}],422:[function(require,module,exports){"use strict";var Buffer=require("safe-buffer").Buffer,isEncoding=Buffer.isEncoding||function(encoding){switch((encoding=""+encoding)&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};exports.StringDecoder=StringDecoder;function StringDecoder(encoding){this.encoding=function(enc){var nenc=function(enc){if(!enc)return"utf8";for(var retried;;)switch(enc){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return enc;default:if(retried)return;enc=(""+enc).toLowerCase(),retried=!0}}(enc);if("string"!=typeof nenc&&(Buffer.isEncoding===isEncoding||!isEncoding(enc)))throw new Error("Unknown encoding: "+enc);return nenc||enc}(encoding);var nb;switch(this.encoding){case"utf16le":this.text=utf16Text,this.end=utf16End,nb=4;break;case"utf8":this.fillLast=utf8FillLast,nb=4;break;case"base64":this.text=base64Text,this.end=base64End,nb=3;break;default:return this.write=simpleWrite,void(this.end=simpleEnd)}this.lastNeed=0,this.lastTotal=0,this.lastChar=Buffer.allocUnsafe(nb)}StringDecoder.prototype.write=function(buf){if(0===buf.length)return"";var r,i;if(this.lastNeed){if(void 0===(r=this.fillLast(buf)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<buf.length?r?r+this.text(buf,i):this.text(buf,i):r||""},StringDecoder.prototype.end=function(buf){var r=buf&&buf.length?this.write(buf):"";return this.lastNeed?r+"".repeat(this.lastTotal-this.lastNeed):r},StringDecoder.prototype.text=function(buf,i){var total=function(self,buf,i){var j=buf.length-1;if(j<i)return 0;var nb=utf8CheckByte(buf[j]);if(nb>=0)return nb>0&&(self.lastNeed=nb-1),nb;if(--j<i)return 0;if((nb=utf8CheckByte(buf[j]))>=0)return nb>0&&(self.lastNeed=nb-2),nb;if(--j<i)return 0;if((nb=utf8CheckByte(buf[j]))>=0)return nb>0&&(2===nb?nb=0:self.lastNeed=nb-3),nb;return 0}(this,buf,i);if(!this.lastNeed)return buf.toString("utf8",i);this.lastTotal=total;var end=buf.length-(total-this.lastNeed);return buf.copy(this.lastChar,0,end),buf.toString("utf8",i,end)},StringDecoder.prototype.fillLast=function(buf){if(this.lastNeed<=buf.length)return buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,buf.length),this.lastNeed-=buf.length};function utf8CheckByte(byte){return byte<=127?0:byte>>5==6?2:byte>>4==14?3:byte>>3==30?4:-1}function utf8FillLast(buf){var p=this.lastTotal-this.lastNeed,r=function(self,buf,p){if(128!=(192&buf[0]))return self.lastNeed=0,"".repeat(p);if(self.lastNeed>1&&buf.length>1){if(128!=(192&buf[1]))return self.lastNeed=1,"".repeat(p+1);if(self.lastNeed>2&&buf.length>2&&128!=(192&buf[2]))return self.lastNeed=2,"".repeat(p+2)}}(this,buf,p);return void 0!==r?r:this.lastNeed<=buf.length?(buf.copy(this.lastChar,p,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(buf.copy(this.lastChar,p,0,buf.length),void(this.lastNeed-=buf.length))}function utf16Text(buf,i){if((buf.length-i)%2==0){var r=buf.toString("utf16le",i);if(r){var c=r.charCodeAt(r.length-1);if(c>=55296&&c<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=buf[buf.length-2],this.lastChar[1]=buf[buf.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=buf[buf.length-1],buf.toString("utf16le",i,buf.length-1)}function utf16End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed){var end=this.lastTotal-this.lastNeed;return r+this.lastChar.toString("utf16le",0,end)}return r}function base64Text(buf,i){var n=(buf.length-i)%3;return 0===n?buf.toString("base64",i):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=buf[buf.length-1]:(this.lastChar[0]=buf[buf.length-2],this.lastChar[1]=buf[buf.length-1]),buf.toString("base64",i,buf.length-n))}function base64End(buf){var r=buf&&buf.length?this.write(buf):"";return this.lastNeed?r+this.lastChar.toString("base64",0,3-this.lastNeed):r}function simpleWrite(buf){return buf.toString(this.encoding)}function simpleEnd(buf){return buf&&buf.length?this.write(buf):""}},{"safe-buffer":401}],423:[function(require,module,exports){"use strict";var punycode=require("punycode"),util=require("./util");exports.parse=urlParse,exports.resolve=function(source,relative){return urlParse(source,!1,!0).resolve(relative)},exports.resolveObject=function(source,relative){return source?urlParse(source,!1,!0).resolveObject(relative):relative},exports.format=function(obj){util.isString(obj)&&(obj=urlParse(obj));return obj instanceof Url?obj.format():Url.prototype.format.call(obj)},exports.Url=Url;function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,unwise=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=require("querystring");function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&util.isObject(url)&&url instanceof Url)return url;var u=new Url;return u.parse(url,parseQueryString,slashesDenoteHost),u}Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!util.isString(url))throw new TypeError("Parameter 'url' must be a string, not "+typeof url);var queryIndex=url.indexOf("?"),splitter=-1!==queryIndex&&queryIndex<url.indexOf("#")?"?":"#",uSplit=url.split(splitter);uSplit[0]=uSplit[0].replace(/\\/g,"/");var rest=url=uSplit.join(splitter);if(rest=rest.trim(),!slashesDenoteHost&&1===url.split("#").length){var simplePath=simplePathPattern.exec(rest);if(simplePath)return this.path=rest,this.href=rest,this.pathname=simplePath[1],simplePath[2]?(this.search=simplePath[2],this.query=parseQueryString?querystring.parse(this.search.substr(1)):this.search.substr(1)):parseQueryString&&(this.search="",this.query={}),this}var proto=protocolPattern.exec(rest);if(proto){var lowerProto=(proto=proto[0]).toLowerCase();this.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes="//"===rest.substr(0,2);!slashes||proto&&hostlessProtocol[proto]||(rest=rest.substr(2),this.slashes=!0)}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){for(var hostEnd=-1,i=0;i<hostEndingChars.length;i++){-1!==(hec=rest.indexOf(hostEndingChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec)}var auth,atSign;-1!==(atSign=-1===hostEnd?rest.lastIndexOf("@"):rest.lastIndexOf("@",hostEnd))&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=decodeURIComponent(auth)),hostEnd=-1;for(i=0;i<nonHostChars.length;i++){var hec;-1!==(hec=rest.indexOf(nonHostChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec)}-1===hostEnd&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||"";var ipv6Hostname="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),l=(i=0,hostparts.length);i<l;i++){var part=hostparts[i];if(part&&!part.match(hostnamePartPattern)){for(var newpart="",j=0,k=part.length;j<k;j++)part.charCodeAt(j)>127?newpart+="x":newpart+=part[j];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),ipv6Hostname||(this.hostname=punycode.toASCII(this.hostname));var p=this.port?":"+this.port:"",h=this.hostname||"";this.host=h+p,this.href+=this.host,ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==rest[0]&&(rest="/"+rest))}if(!unsafeProtocol[lowerProto])for(i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(-1!==rest.indexOf(ae)){var esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");-1!==hash&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");if(-1!==qm?(this.search=rest.substr(qm),this.query=rest.substr(qm+1),parseQueryString&&(this.query=querystring.parse(this.query)),rest=rest.slice(0,qm)):parseQueryString&&(this.search="",this.query={}),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){p=this.pathname||"";var s=this.search||"";this.path=p+s}return this.href=this.format(),this};Url.prototype.format=function(){var auth=this.auth||"";auth&&(auth=(auth=encodeURIComponent(auth)).replace(/%3A/i,":"),auth+="@");var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=!1,query="";this.host?host=auth+this.host:this.hostname&&(host=auth+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(host+=":"+this.port)),this.query&&util.isObject(this.query)&&Object.keys(this.query).length&&(query=querystring.stringify(this.query));var search=this.search||query&&"?"+query||"";return protocol&&":"!==protocol.substr(-1)&&(protocol+=":"),this.slashes||(!protocol||slashedProtocol[protocol])&&!1!==host?(host="//"+(host||""),pathname&&"/"!==pathname.charAt(0)&&(pathname="/"+pathname)):host||(host=""),hash&&"#"!==hash.charAt(0)&&(hash="#"+hash),search&&"?"!==search.charAt(0)&&(search="?"+search),protocol+host+(pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)}))+(search=search.replace("#","%23"))+hash};Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()};Url.prototype.resolveObject=function(relative){if(util.isString(relative)){var rel=new Url;rel.parse(relative,!1,!0),relative=rel}for(var result=new Url,tkeys=Object.keys(this),tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}if(result.hash=relative.hash,""===relative.href)return result.href=result.format(),result;if(relative.slashes&&!relative.protocol){for(var rkeys=Object.keys(relative),rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];"protocol"!==rkey&&(result[rkey]=relative[rkey])}return slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/"),result.href=result.format(),result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){for(var keys=Object.keys(relative),v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}return result.href=result.format(),result}if(result.protocol=relative.protocol,relative.host||hostlessProtocol[relative.protocol])result.pathname=relative.pathname;else{for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),""!==relPath[0]&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}if(result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p=result.pathname||"",s=result.search||"";result.path=p+s}return result.slashes=result.slashes||relative.slashes,result.href=result.format(),result}var isSourceAbs=result.pathname&&"/"===result.pathname.charAt(0),isRelAbs=relative.host||relative.pathname&&"/"===relative.pathname.charAt(0),mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],psychotic=(relPath=relative.pathname&&relative.pathname.split("/")||[],result.protocol&&!slashedProtocol[result.protocol]);if(psychotic&&(result.hostname="",result.port=null,result.host&&(""===srcPath[0]?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(""===relPath[0]?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(""===relPath[0]||""===srcPath[0])),isRelAbs)result.host=relative.host||""===relative.host?relative.host:result.host,result.hostname=relative.hostname||""===relative.hostname?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)srcPath||(srcPath=[]),srcPath.pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(!util.isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();(authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@"))&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return result.search=relative.search,result.query=relative.query,util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.href=result.format(),result}if(!srcPath.length)return result.pathname=null,result.search?result.path="/"+result.search:result.path=null,result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&("."===last||".."===last)||""===last,up=0,i=srcPath.length;i>=0;i--)"."===(last=srcPath[i])?srcPath.splice(i,1):".."===last?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;up)srcPath.unshift("..");!mustEndAbs||""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0)||srcPath.unshift(""),hasTrailingSlash&&"/"!==srcPath.join("/").substr(-1)&&srcPath.push("");var isAbsolute=""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0);if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost;(authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@"))&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return(mustEndAbs=mustEndAbs||result.host&&srcPath.length)&&!isAbsolute&&srcPath.unshift(""),srcPath.length?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes,result.href=result.format(),result},Url.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);port&&(":"!==(port=port[0])&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)}},{"./util":424,punycode:381,querystring:384}],424:[function(require,module,exports){"use strict";module.exports={isString:function(arg){return"string"==typeof arg},isObject:function(arg){return"object"==typeof arg&&null!==arg},isNull:function(arg){return null===arg},isNullOrUndefined:function(arg){return null==arg}}},{}],425:[function(require,module,exports){(function(global){module.exports=function(fn,msg){if(config("noDeprecation"))return fn;var warned=!1;return function(){if(!warned){if(config("throwDeprecation"))throw new Error(msg);config("traceDeprecation")?console.trace(msg):console.warn(msg),warned=!0}return fn.apply(this,arguments)}};function config(name){try{if(!global.localStorage)return!1}catch(_){return!1}var val=global.localStorage[name];return null!=val&&"true"===String(val).toLowerCase()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],426:[function(require,module,exports){arguments[4][352][0].apply(exports,arguments)},{dup:352}],427:[function(require,module,exports){module.exports=function(arg){return arg&&"object"==typeof arg&&"function"==typeof arg.copy&&"function"==typeof arg.fill&&"function"==typeof arg.readUInt8}},{}],428:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){for(var objects=[],i=0;i<arguments.length;i++)objects.push(inspect(arguments[i]));return objects.join(" ")}i=1;for(var args=arguments,len=args.length,str=String(f).replace(formatRegExp,function(x){if("%%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}}),x=args[i];i<len;x=args[++i])isNull(x)||!isObject(x)?str+=" "+x:str+=" "+inspect(x);return str},exports.deprecate=function(fn,msg){if(isUndefined(global.process))return function(){return exports.deprecate(fn,msg).apply(this,arguments)};if(!0===process.noDeprecation)return fn;var warned=!1;return function(){if(!warned){if(process.throwDeprecation)throw new Error(msg);process.traceDeprecation?console.trace(msg):console.error(msg),warned=!0}return fn.apply(this,arguments)}};var debugEnviron,debugs={};exports.debuglog=function(set){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),set=set.toUpperCase(),!debugs[set])if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else debugs[set]=function(){};return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(ctx.depth=arguments[2]),arguments.length>=4&&(ctx.colors=arguments[3]),isBoolean(opts)?ctx.showHidden=opts:opts&&exports._extend(ctx,opts),isUndefined(ctx.showHidden)&&(ctx.showHidden=!1),isUndefined(ctx.depth)&&(ctx.depth=2),isUndefined(ctx.colors)&&(ctx.colors=!1),isUndefined(ctx.customInspect)&&(ctx.customInspect=!0),ctx.colors&&(ctx.stylize=stylizeWithColor),formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];return style?"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m":str}function stylizeNoColor(str,styleType){return str}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&(!value.constructor||value.constructor.prototype!==value)){var ret=value.inspect(recurseTimes,ctx);return isString(ret)||(ret=formatValue(ctx,ret,recurseTimes)),ret}var primitive=function(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}(ctx,value);if(primitive)return primitive;var keys=Object.keys(value),visibleKeys=function(array){var hash={};return array.forEach(function(val,idx){hash[val]=!0}),hash}(keys);if(ctx.showHidden&&(keys=Object.getOwnPropertyNames(value)),isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0))return formatError(value);if(0===keys.length){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value))return ctx.stylize(RegExp.prototype.toString.call(value),"regexp");if(isDate(value))return ctx.stylize(Date.prototype.toString.call(value),"date");if(isError(value))return formatError(value)}var base="",array=!1,braces=["{","}"];if(isArray(value)&&(array=!0,braces=["[","]"]),isFunction(value)){base=" [Function"+(value.name?": "+value.name:"")+"]"}if(isRegExp(value)&&(base=" "+RegExp.prototype.toString.call(value)),isDate(value)&&(base=" "+Date.prototype.toUTCString.call(value)),isError(value)&&(base=" "+formatError(value)),0===keys.length&&(!array||0==value.length))return braces[0]+base+braces[1];if(recurseTimes<0)return isRegExp(value)?ctx.stylize(RegExp.prototype.toString.call(value),"regexp"):ctx.stylize("[Object]","special");ctx.seen.push(value);var output;return output=array?function(ctx,value,recurseTimes,visibleKeys,keys){for(var output=[],i=0,l=value.length;i<l;++i)hasOwnProperty(value,String(i))?output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0)):output.push("");return keys.forEach(function(key){key.match(/^\d+$/)||output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))}),output}(ctx,value,recurseTimes,visibleKeys,keys):keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)}),ctx.seen.pop(),function(output,base,braces){if(output.reduce(function(prev,cur){return 0,cur.indexOf("\n")>=0&&0,prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1];return braces[0]+base+" "+output.join(", ")+" "+braces[1]}(output,base,braces)}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;if((desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]}).get?str=desc.set?ctx.stylize("[Getter/Setter]","special"):ctx.stylize("[Getter]","special"):desc.set&&(str=ctx.stylize("[Setter]","special")),hasOwnProperty(visibleKeys,key)||(name="["+key+"]"),str||(ctx.seen.indexOf(desc.value)<0?(str=isNull(recurseTimes)?formatValue(ctx,desc.value,null):formatValue(ctx,desc.value,recurseTimes-1)).indexOf("\n")>-1&&(str=array?str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2):"\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")):str=ctx.stylize("[Circular]","special")),isUndefined(name)){if(array&&key.match(/^\d+$/))return str;(name=JSON.stringify(""+key)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(name=name.substr(1,name.length-2),name=ctx.stylize(name,"name")):(name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),name=ctx.stylize(name,"string"))}return name+": "+str}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return"boolean"==typeof arg}exports.isBoolean=isBoolean;function isNull(arg){return null===arg}exports.isNull=isNull;exports.isNullOrUndefined=function(arg){return null==arg};function isNumber(arg){return"number"==typeof arg}exports.isNumber=isNumber;function isString(arg){return"string"==typeof arg}exports.isString=isString;exports.isSymbol=function(arg){return"symbol"==typeof arg};function isUndefined(arg){return void 0===arg}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}exports.isRegExp=isRegExp;function isObject(arg){return"object"==typeof arg&&null!==arg}exports.isObject=isObject;function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}exports.isDate=isDate;function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}exports.isError=isError;function isFunction(arg){return"function"==typeof arg}exports.isFunction=isFunction;exports.isPrimitive=function(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||void 0===arg},exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",function(){var d=new Date,time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}(),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(origin,add){if(!add||!isObject(add))return origin;for(var keys=Object.keys(add),i=keys.length;i--;)origin[keys[i]]=add[keys[i]];return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":427,_process:374,inherits:426}],429:[function(require,module,exports){var indexOf=require("indexof"),Object_keys=function(obj){if(Object.keys)return Object.keys(obj);var res=[];for(var key in obj)res.push(key);return res},forEach=function(xs,fn){if(xs.forEach)return xs.forEach(fn);for(var i=0;i<xs.length;i++)fn(xs[i],i,xs)},defineProp=function(){try{return Object.defineProperty({},"_",{}),function(obj,name,value){Object.defineProperty(obj,name,{writable:!0,enumerable:!1,configurable:!0,value:value})}}catch(e){return function(obj,name,value){obj[name]=value}}}(),globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];function Context(){}Context.prototype={};var Script=exports.Script=function(code){if(!(this instanceof Script))return new Script(code);this.code=code};Script.prototype.runInContext=function(context){if(!(context instanceof Context))throw new TypeError("needs a 'context' argument.");var iframe=document.createElement("iframe");iframe.style||(iframe.style={}),iframe.style.display="none",document.body.appendChild(iframe);var win=iframe.contentWindow,wEval=win.eval,wExecScript=win.execScript;!wEval&&wExecScript&&(wExecScript.call(win,"null"),wEval=win.eval),forEach(Object_keys(context),function(key){win[key]=context[key]}),forEach(globals,function(key){context[key]&&(win[key]=context[key])});var winKeys=Object_keys(win),res=wEval.call(win,this.code);return forEach(Object_keys(win),function(key){(key in context||-1===indexOf(winKeys,key))&&(context[key]=win[key])}),forEach(globals,function(key){key in context||defineProp(context,key,win[key])}),document.body.removeChild(iframe),res},Script.prototype.runInThisContext=function(){return eval(this.code)},Script.prototype.runInNewContext=function(context){var ctx=Script.createContext(context),res=this.runInContext(ctx);return forEach(Object_keys(ctx),function(key){context[key]=ctx[key]}),res},forEach(Object_keys(Script.prototype),function(name){exports[name]=Script[name]=function(code){var s=Script(code);return s[name].apply(s,[].slice.call(arguments,1))}}),exports.createScript=function(code){return exports.Script(code)},exports.createContext=Script.createContext=function(context){var copy=new Context;return"object"==typeof context&&forEach(Object_keys(context),function(key){copy[key]=context[key]}),copy}},{indexof:351}]},{},[1])(1)});
